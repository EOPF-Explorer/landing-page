const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/index.ByQ--BLW.js","assets/chunks/main.ClCgYaDc.js","assets/chunks/addCommonStyleSheet.YyUQWdJ3.js","assets/chunks/map.BaSrMuqw.js","assets/chunks/index.OUYS7i6-.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/getElement.CdRlZPdn.js"])))=>i.map(i=>d[i]);
import{h as _,ao as me,a2 as ae,p as w,ap as re,v as ee,c as Y,o as X,j as k,e as K,k as t,N as H,G as ve,x as pe,q as ye,a5 as ge}from"./framework.CdhR1Bap.js";import{t as xe}from"./main.ClCgYaDc.js";import"./index.CrOJC_Ts.js";import{_ as he,aU as N,u as Ce,s as oe,a as te,m as Pe,b2 as Se,d as ne,f as Q,b3 as _e,i as g,z as x,A as h,b4 as we,l as j,k as Ne,C as Te,b5 as Me,b6 as Oe,g as Ie,b7 as ke,R as ie,D as E,o as je}from"./eo-dash.BrAFMXsE.js";import{c as se}from"./create-layers-config-UGVCBNr2.DgvMwI7b.js";import{i as ze}from"./easing-CH0-9wR8.CTB3jml5.js";import Le from"./EodashMapBtns-DCykaOFx.BcP9uPdp.js";import"./index.Du0sVlOV.js";import"./map.BaSrMuqw.js";import"./addCommonStyleSheet.YyUQWdJ3.js";import"./commonjsHelpers.BosuxZz1.js";import"./getElement.CdRlZPdn.js";import"./XYZ.8i23LU2V.js";import"./index.OUYS7i6-.js";import"./Vector.CNch74hV.js";import"./Layer.oC_4GxQq.js";import"./Tile.BqihDqU8.js";import"./DataTile.CjqBuOpj.js";import"./item.Bx-rtsOD.js";import"./mdi.CilvuGMU.js";import"./ExportState-C9TFqSK9.CCIXMCYr.js";import"./PopUp-DcoPttVx.CFugxl_d.js";import"./forwardRefs-DEQUrLOm.DuK4WorR.js";import"./transition-SOSjTaDQ.aoKyh-Jl.js";import"./main.Dk9E39A0.js";import"./sequential.BT5PQCvq.js";import"./orient2d.DArCjZZA.js";import"./VImg-BgH1ZQ5u.B0PiSy4N.js";import"./EodashItemFilter-DGUsQ9Xo.-ECaFvsc.js";import"./handling-Ej7BqU1f.C6WnmuCn.js";import"./async-DvGyyFLl.C1GGZAsm.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./mosaic-CKPeN3Vy.Dh9ua2FV.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.vfgftS71.js";import"./index.BUIxO2d3.js";let W=null;const Be=(e,s)=>{const c=o=>{var b;const r=o.map,l=(b=e.value)==null?void 0:b.lonLatCenter,T=r==null?void 0:r.getView().getZoom();l&&!Number.isNaN(l[0])&&!Number.isNaN(l[1])&&!Number.isNaN(T)&&(s.value=[l[0],l[1],T])};ee(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.on("moveend",c)}),pe(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.un("moveend",c)})},le=(e,s,c,o,r,l,T,b)=>{j.debug("InitMap",e.value,s.value,c.values,o.value);const R=ye(b?[s,o,b]:[s,o],async(M,C)=>{var F,v,P,Z,J,U,$,L,D,B,V,a,i,m,u;const[n,O,f]=b?M:[M[0],M[1],null],[z,A,I]=b?C:[C[0],C[1],null];if(n){j.debug("Selected Indicator watch triggered",n,O),((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&W!==null&&((v=e==null?void 0:e.value)==null||v.map.setView(W),W=null);let p=[];const y=(n==null?void 0:n.id)===(z==null?void 0:z.id)&&(O!==A||f&&(f==null?void 0:f.id)!==(I==null?void 0:I.id)),{selectedCompareStac:G}=oe(te());if(((P=e==null?void 0:e.value)==null?void 0:P.id)==="main"?await ke(n):G.value!==null&&(W=((Z=e==null?void 0:e.value)==null?void 0:Z.map.getView())??null,e.value.sync=l.value),y){p=await se(n,c,f??O),j.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(p))),r.value=p,ie(((J=e.value)==null?void 0:J.id)==="compare"?"compareTime:updated":"time:updated",e.value,p);return}let S=null;const q=($=(U=n==null?void 0:n.extent)==null?void 0:U.temporal)==null?void 0:$.interval;if(q&&q.length>0&&q[0].length>1&&(S=new Date(q[0][1]),j.debug("Indicator load: found stac extent, setting time to latest value",S)),(!f&&S!==null&&S.toISOString()!==o.value&&!E.value||E.value&&!o.value&&S)&&(o.value=S.toISOString()),p=await se(n,c,f??O),T&&!f&&((L=e==null?void 0:e.value)==null?void 0:L.id)==="main"&&(D=n.extent)!=null&&D.spatial.bbox&&!(E.value&&((B=N.value)!=null&&B[0])&&((V=N.value)!=null&&V[1]))){const de=(a=n.extent)==null?void 0:a.spatial.bbox[0],fe=je([...de]),be=xe(fe,"EPSG:4326",(m=(i=e.value)==null?void 0:i.map)==null?void 0:m.getView().getProjection());e.value.zoomExtent=be}j.debug("Assigned layers",JSON.parse(JSON.stringify(p))),r.value=p,await ie(((u=e.value)==null?void 0:u.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});pe(()=>{R()})},ce=(e,s)=>{Ne(async(c,o)=>{if(c.includes("compare"))return;const r=[];for(const l of e)r.push(...await l.getToolTipProperties());s.value=r,j.debug("Updated tooltip properties",s.value)})},Ve="#cursor-coordinates[data-v-3f47d93f]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:10px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-3f47d93f]{display:none}}#scale-line[data-v-3f47d93f]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-3f47d93f]{bottom:102px}}[data-v-3f47d93f] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-3f47d93f] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-3f47d93f]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-3f47d93f]>*{pointer-events:auto}",Ge=[".enabled"],Re=[".center",".zoom",".layers",".controls"],Ae=[".propertyTransform"],Fe=[".layers"],Ze=[".propertyTransform"],Je={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ue={key:1,id:"scale-line",ref:"scale-line"};var ue;const $e={__name:"index",props:{initialLayers:{type:Array,default:()=>[{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]},enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,s;return[((e=N.value)==null?void 0:e[0])??15,((s=N.value)==null?void 0:s[1])??48]}},zoom:{type:Number,default:((ue=N.value)==null?void 0:ue[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,enableGlobe:!0,enableMosaic:!0,searchParams:{}})}},async setup(e){var V;let s,c;const o=e,{width:r}=Ce(),l=a=>{if(typeof a=="number")return a;if(typeof a=="string"){const i=a.split("/"),m=r.value;return m<960?parseInt(i[0])||1:m<1920?parseInt(i[1]||i[0])||1:parseInt(i[2]||i[1]||i[0])||1}return 1},T=_(()=>l(o.btnsPosition.x)),b=_(()=>l(o.btnsPosition.y)),d=_(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0,enableGlobe:o.btns.enableGlobe??!0,enableMosaic:o.btns.enableMosaic??!0,searchParams:o.btns.searchParams}));d.value.enableGlobe&&([s,c]=me(()=>ge(()=>import("./index.ByQ--BLW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),await s,c());const R=ae("scale-line"),M=ae("cursor-coords"),C=w([]),n=w([]),O=_(()=>{const a={Attribution:{collapsible:!0}};return o.enableScaleLine&&R.value&&(a.ScaleLine={target:R.value}),o.enableCursorCoordinates&&M.value&&(a.MousePosition={projection:"EPSG:4326",coordinateFormat:i=>`${i[1].toFixed(3)} °N, ${i[0].toFixed(3)} °E`,target:M.value}),a}),f=re(o.center),z=re(((V=N.value)==null?void 0:V[2])??o.zoom),A=w(o.initialLayers),I=w([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),F={duration:1200,easing:ze},v=w(null),P=w(null),{selectedCompareStac:Z}=oe(te()),J=_(()=>o.enableCompare&&Z.value?"":"first");Be(v,N),ee(()=>{const{selectedCompareStac:a,selectedStac:i,selectedItem:m}=oe(te());Pe.value=v.value,o.enableCompare&&(Se.value=P.value),o.enableCompare&&(le(P,a,Ie,ne,I,v,!1),ce(Q,n)),le(v,i,Q,ne,A,P,o.zoomToExtent,m)}),ce(Q,C);const U=_(()=>({visibility:C.value.length?"visible":"hidden"})),$=_(()=>({visibility:n.value.length?"visible":"hidden"})),L=a=>{const i=a==="main"?C:n,m=a=="main"?Me:Oe;return u=>{const p=JSON.parse(Te.render(JSON.stringify(i.value),{...m.value??{}})),y=p==null?void 0:p.find(G=>G.id===u.key);if(y){if(typeof u.value=="object"&&(u.value=JSON.stringify(u.value)),!isNaN(Number(u.value))){const G=isNaN(Number(y.decimals))?4:Number(y.decimals);u.value=Number(u.value).toFixed(G).toString()}return{key:y.title||y.id,value:u.value+" "+(y.appendix||"")}}}},{mainRect:D}=_e(),B=w(0);return ee(()=>{const a=document.querySelector("eo-dash");B.value=(D.value.top||(a==null?void 0:a.getBoundingClientRect().top))??0}),(a,i)=>(X(),Y("span",null,[k("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":J.value},[k("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:v,id:"main",".animationOptions":F,".center":t(f),".zoom":t(z),".layers":A.value,".controls":O.value},[k("eox-map-tooltip",{style:H(U.value),".propertyTransform":L("main")},null,44,Ae)],40,Re),k("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:P,".layers":I.value},[k("eox-map-tooltip",{style:H($.value),".propertyTransform":L("compare")},null,44,Ze)],40,Fe)],40,Ge),e.enableCursorCoordinates?(X(),Y("div",Je,null,512)):K("v-if",!0),e.enableScaleLine?(X(),Y("span",Ue,null,512)):K("v-if",!0),k("div",{class:"map-buttons-container",style:H(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${B.value}px;`)},[K(" prettier-ignore "),ve(Le,{style:H({gridColumn:(t(g)||t(x)||t(h))&&!t(we)?T.value:"12",gridRow:b.value}),exportMap:t(g)||t(x)||t(h)?d.value.exportMap:!1,changeProjection:t(g)||t(x)||t(h)?d.value.changeProjection:!1,compareIndicators:t(g)||t(x)||t(h)?d.value.compareIndicators:!1,backToPOIs:t(g)||t(x)||t(h)?d.value.backToPOIs:!1,enableSearch:t(g)||t(x)||t(h)?d.value.enableSearch:!1,enableZoom:t(g)||t(x)||t(h)?d.value.enableZoom:!1,enableGlobe:t(g)||t(x)||t(h)?d.value.enableGlobe:!1,searchParams:d.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","enableGlobe","searchParams"])],4)]))}},Oo=he($e,[["styles",[Ve]],["__scopeId","data-v-3f47d93f"]]);export{Oo as default};
