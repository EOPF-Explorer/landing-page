const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.DVwrCGKH.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/XYZ.zMTP1uvH.js","assets/chunks/index.OUYS7i6-.js","assets/chunks/Tile.-LbONiFy.js","assets/chunks/Layer.BBoFQbFB.js","assets/chunks/Vector.HAw8Ogek.js","assets/chunks/DataTile.2Hs0Wrd9.js","assets/chunks/item.Bx-rtsOD.js","assets/chunks/framework.DIX4mz6K.js","assets/chunks/index.BYzJOi-i.js","assets/chunks/webimage.CU41Mh7j.js","assets/chunks/proj4.Bo6rV-Sx.js"])))=>i.map(i=>d[i]);
var Nc=Object.defineProperty;var Uc=(r,e,t)=>e in r?Nc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Z=(r,e,t)=>Uc(r,typeof e!="symbol"?e+"":e,t);import{a3 as ot,cy as ai,bI as we,cz as Sl,ag as Dn,bK as Gc,a9 as Q,f as cn,j as Ar,cA as El,aY as Bc,ao as $s,aP as nr,aQ as ir,cB as Vc,aU as qc,H as sr,aV as $c,aX as Hc,cn as li,cC as Kc,b1 as Ne,cm as zn,bL as Yr,cD as xn,cE as Zc,Z as Hs,cF as Il,e as se,p as Pt,cG as oa,cH as jn,cI as Xc,b0 as ui,a$ as fn,bo as Wt,t as Yt,b4 as Wc,aN as Ks,k as Pl,bD as Al,cJ as Yc,aw as aa,bJ as Dt,ax as Zs,ay as Jc,a6 as Qc,cK as Rl,cL as ef,a5 as Nn,a4 as tf,a_ as rf,cM as Xs,bF as nf,cN as Cl,cO as sf,aR as of,cP as af,cQ as lf,cR as uf,cS as cf,cT as la,P as Ml,N as Fl,ab as ke,cU as Ol,cc as ff,ca as hf,cV as df,cW as pf,cf as gf,cX as Rr,c4 as kl,L as Ws,bM as yf,W as Ll,bC as mf,cY as ds,as as Ui,ar as ua,au as bf,bO as wf,a2 as vf,cZ as _n,c_ as Dl,ci as xf,F as gr,d as Vr,S as Kt,c$ as zl,d0 as ca,cw as _f,h as Tf,i as Sf,y as Ef,d1 as If,d2 as Pf,d3 as jl,_ as fa,b5 as Un,d4 as Af,$ as ci,M as Gn,u as Rf,bH as ha,d5 as Cf,V as Mf,d6 as ps,l as gs,d7 as Ff}from"./XYZ.zMTP1uvH.js";import{T as Bn,C as Of}from"./Tile.-LbONiFy.js";import{l as kf,R as Jr,G as Lf,b as Nl,M as Ul,c as Gl,L as Bl,F as Vl,B as Df,E as zf,H as Gi,d as jf,h as Nf,D as da,r as pa,g as Uf,V as Hr,a as fi,e as Gf}from"./Vector.HAw8Ogek.js";import{c as Bf,D as ql,W as ga}from"./DataTile.2Hs0Wrd9.js";import{S as Vf,a as qf,u as Ys,b as $l,C as ys,I as Vn,M as $f,A as Tn,c as Nr,i as Bi,d as Hf,f as Kf,g as ya}from"./item.Bx-rtsOD.js";import{g as Hl}from"./commonjsHelpers.BosuxZz1.js";import{a5 as Ct}from"./framework.DIX4mz6K.js";import{P as Zf}from"./index.BYzJOi-i.js";import{C as Xf,Z as Wf}from"./Layer.BBoFQbFB.js";function Kl(r,e){const t=(""+r).split("."),n=(""+e).split(".");for(let i=0;i<Math.max(t.length,n.length);i++){const s=parseInt(t[i]||"0",10),o=parseInt(n[i]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function Yf(r,e,t,n){const i=document.createElement("script"),s="olc_"+ot(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class Jf extends ai{constructor(e,t,n,i,s){const o=s!==void 0?we.IDLE:we.LOADED;super(e,t,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=we.ERROR):this.state=we.LOADED,this.changed()}load(){this.state==we.IDLE&&(this.state=we.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const ma=[];class Qf extends Sl{constructor(e,t,n,i,s){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=s,this.wrappedTileCoord=n}getContext(){return this.context_||(this.context_=Dn(1,1,ma)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const t=ot(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedPixelRatio:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(Gc(this.context_),ma.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let Zl=class extends Sl{constructor(e,t,n,i,s,o){super(e,t,o),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=n,this.key=n}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==Q.IDLE&&(this.setState(Q.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(Q.ERROR)}setFeatures(e){this.features_=e,this.setState(Q.LOADED)}setLoader(e){this.loader_=e}};function Re(r){return(e,...t)=>eh(r,e,t)}function Cr(r,e){return Re(Xl(r,e).get)}const{apply:eh,getOwnPropertyDescriptor:Xl,getPrototypeOf:Js,ownKeys:th}=Reflect,{iterator:hn,toStringTag:rh}=Symbol,nh=Object,{create:Qs,defineProperty:ih}=nh,sh=Array,oh=sh.prototype,Wl=oh[hn],ah=Re(Wl),Yl=ArrayBuffer,lh=Yl.prototype;Cr(lh,"byteLength");const ba=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;ba&&Cr(ba.prototype,"byteLength");const Jl=Js(Uint8Array);Jl.from;const Ge=Jl.prototype;Ge[hn];Re(Ge.keys);Re(Ge.values);Re(Ge.entries);Re(Ge.set);Re(Ge.reverse);Re(Ge.fill);Re(Ge.copyWithin);Re(Ge.sort);Re(Ge.slice);Re(Ge.subarray);Cr(Ge,"buffer");Cr(Ge,"byteOffset");Cr(Ge,"length");Cr(Ge,rh);const uh=Uint8Array,Ql=Uint16Array,eo=Uint32Array,ch=Float32Array,Qr=Js([][hn]()),eu=Re(Qr.next),fh=Re(function*(){}().next),hh=Js(Qr),dh=DataView.prototype,ph=Re(dh.getUint16),to=WeakMap,tu=to.prototype,ru=Re(tu.get),gh=Re(tu.set),nu=new to,yh=Qs(null,{next:{value:function(){const e=ru(nu,this);return eu(e)}},[hn]:{value:function(){return this}}});function mh(r){if(r[hn]===Wl&&Qr.next===eu)return r;const e=Qs(yh);return gh(nu,e,ah(r)),e}const bh=new to,wh=Qs(hh,{next:{value:function(){const e=ru(bh,this);return fh(e)},writable:!0,configurable:!0}});for(const r of th(Qr))r!=="next"&&ih(wh,r,Xl(Qr,r));const iu=new Yl(4),vh=new ch(iu),xh=new eo(iu),mt=new Ql(512),bt=new uh(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(mt[r]=0,mt[r|256]=32768,bt[r]=24,bt[r|256]=24):e<-14?(mt[r]=1024>>-e-14,mt[r|256]=1024>>-e-14|32768,bt[r]=-e-1,bt[r|256]=-e-1):e<=15?(mt[r]=e+15<<10,mt[r|256]=e+15<<10|32768,bt[r]=13,bt[r|256]=13):e<128?(mt[r]=31744,mt[r|256]=64512,bt[r]=24,bt[r|256]=24):(mt[r]=31744,mt[r|256]=64512,bt[r]=13,bt[r|256]=13)}const ro=new eo(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,ro[r]=e|t}for(let r=1024;r<2048;++r)ro[r]=939524096+(r-1024<<13);const Mr=new eo(64);for(let r=1;r<31;++r)Mr[r]=r<<23;Mr[31]=1199570944;Mr[32]=2147483648;for(let r=33;r<63;++r)Mr[r]=2147483648+(r-32<<23);Mr[63]=3347054592;const su=new Ql(64);for(let r=1;r<64;++r)r!==32&&(su[r]=1024);function _h(r){const e=r>>10;return xh[0]=ro[su[e]+(r&1023)]+Mr[e],vh[0]}function ou(r,e,...t){return _h(ph(r,e,...mh(t)))}var no={exports:{}};function au(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],u=e+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",u);const f=new RegExp(u).exec(s);if(n&&console.log("[xml-utils] match:",f),f)return f[1]}}no.exports=au;no.exports.default=au;var Th=no.exports;const Vi=Hl(Th);var io={exports:{}},so={exports:{}},oo={exports:{}};function lu(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}oo.exports=lu;oo.exports.default=lu;var Sh=oo.exports,ao={exports:{}};function uu(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}ao.exports=uu;ao.exports.default=uu;var Eh=ao.exports,lo={exports:{}};function cu(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}lo.exports=cu;lo.exports.default=cu;var Ih=lo.exports;const Ph=Sh,qi=Eh,wa=Ih;function fu(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=Ph(r,`<${e}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let l=qi(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",u),u===!1)if(i){let p=0,d=1,g=0;for(;(l=qi(a,"[ /]"+e+">",p))!==-1;){const y=a.substring(p,l+1);if(d+=wa(y,"<"+e+`[ 
	>]`),g+=wa(y,"</"+e+">"),g>=d)break;p=l}}else l=qi(a,"[ /]"+e+">",0);const c=o+e.length+l+1;if(n&&console.log("[xml-utils] end:",c),c===-1)return;const f=r.slice(o,c);let h;return u?h=null:h=f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:h,outer:f,start:o,end:c}}so.exports=fu;so.exports.default=fu;var Ah=so.exports;const Rh=Ah;function hu(r,e,t){const n=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=Rh(r,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}io.exports=hu;io.exports.default=hu;var Ch=io.exports;const Mh=Hl(Ch),Kr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},wt={};for(const r in Kr)Kr.hasOwnProperty(r)&&(wt[Kr[r]]=parseInt(r,10));const Fh=[wt.BitsPerSample,wt.ExtraSamples,wt.SampleFormat,wt.StripByteCounts,wt.StripOffsets,wt.StripRowCounts,wt.TileByteCounts,wt.TileOffsets,wt.SubIFDs],$i={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},B={};for(const r in $i)$i.hasOwnProperty(r)&&(B[$i[r]]=parseInt(r,10));const qe={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Oh={Unspecified:0},t1={AddCompression:1},r1={None:0,Deflate:1,Zstandard:2},kh={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Lh(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function Dh(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function zh(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const u=r[a];i[l]=e[u]/65536*256,i[l+1]=e[u+s]/65536*256,i[l+2]=e[u+o]/65536*256}return i}function jh(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],u=r[i+3];n[s]=255*((255-o)/256)*((255-u)/256),n[s+1]=255*((255-a)/256)*((255-u)/256),n[s+2]=255*((255-l)/256)*((255-u)/256)}return n}function Nh(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const Uh=.95047,Gh=1,Bh=1.08883;function Vh(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let u=(o+16)/116,c=a/500+u,f=u-l/200,h,p,d;c=Uh*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),u=Gh*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),f=Bh*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),h=c*3.2406+u*-1.5372+f*-.4986,p=c*-.9689+u*1.8758+f*.0415,d=c*.0557+u*-.204+f*1.057,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,n[s]=Math.max(0,Math.min(1,h))*255,n[s+1]=Math.max(0,Math.min(1,p))*255,n[s+2]=Math.max(0,Math.min(1,d))*255}return n}const du=new Map;function Gt(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>du.set(t,e))}async function pu(r){const e=du.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Gt([void 0,1],()=>Ct(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(r=>r.default));Gt(5,()=>Ct(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(r=>r.default));Gt(6,()=>{throw new Error("old style JPEG compression is not supported.")});Gt(7,()=>Ct(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(r=>r.default));Gt([8,32946],()=>Ct(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));Gt(32773,()=>Ct(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(r=>r.default));Gt(34887,()=>Ct(()=>import("./lerc.DVwrCGKH.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15,16,17])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));Gt(50001,()=>Ct(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([18,1])).then(r=>r.default));function hi(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function qh(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=hi(a,n,i);for(let u=0;u<i;++u){const c=Math.min(Math.round(o*u),t-1);for(let f=0;f<n;++f){const h=Math.min(Math.round(s*f),e-1),p=a[c*e+h];l[u*n+f]=p}}return l})}function br(r,e,t){return(1-t)*r+t*e}function $h(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=hi(a,n,i);for(let u=0;u<i;++u){const c=o*u,f=Math.floor(c),h=Math.min(Math.ceil(c),t-1);for(let p=0;p<n;++p){const d=s*p,g=d%1,y=Math.floor(d),b=Math.min(Math.ceil(d),e-1),m=a[f*e+y],w=a[f*e+b],I=a[h*e+y],v=a[h*e+b],P=br(br(m,w,g),br(I,v,g),c%1);l[u*n+p]=P}}return l})}function Hh(r,e,t,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return qh(r,e,t,n,i);case"bilinear":case"linear":return $h(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function Kh(r,e,t,n,i,s){const o=e/n,a=t/i,l=hi(r,n,i,s);for(let u=0;u<i;++u){const c=Math.min(Math.round(a*u),t-1);for(let f=0;f<n;++f){const h=Math.min(Math.round(o*f),e-1);for(let p=0;p<s;++p){const d=r[c*e*s+h*s+p];l[u*n*s+f*s+p]=d}}}return l}function Zh(r,e,t,n,i,s){const o=e/n,a=t/i,l=hi(r,n,i,s);for(let u=0;u<i;++u){const c=a*u,f=Math.floor(c),h=Math.min(Math.ceil(c),t-1);for(let p=0;p<n;++p){const d=o*p,g=d%1,y=Math.floor(d),b=Math.min(Math.ceil(d),e-1);for(let m=0;m<s;++m){const w=r[f*e*s+y*s+m],I=r[f*e*s+b*s+m],v=r[h*e*s+y*s+m],P=r[h*e*s+b*s+m],_=br(br(w,I,g),br(v,P,g),c%1);l[u*n*s+p*s+m]=_}}}return l}function Xh(r,e,t,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return Kh(r,e,t,n,i,s);case"bilinear":case"linear":return Zh(r,e,t,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Wh(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function ms(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function Yh(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function Jh(r,e,t,n,i,s,o){const a=new DataView(r),l=t===2?o*s:o*s*n,u=t===2?1:n,c=ms(e,i,l),f=parseInt("1".repeat(i),2);if(e===1){let h;t===1?h=n*i:h=i;let p=s*h;p&7&&(p=p+7&-8);for(let d=0;d<o;++d){const g=d*p;for(let y=0;y<s;++y){const b=g+y*u*i;for(let m=0;m<u;++m){const w=b+m*i,I=(d*s+y)*u+m,v=Math.floor(w/8),P=w%8;if(P+i<=8)c[I]=a.getUint8(v)>>8-i-P&f;else if(P+i<=16)c[I]=a.getUint16(v)>>16-i-P&f;else if(P+i<=24){const _=a.getUint16(v)<<8|a.getUint8(v+2);c[I]=_>>24-i-P&f}else c[I]=a.getUint32(v)>>32-i-P&f}}}}return c.buffer}class gu{constructor(e,t,n,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return ou(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return ms(n,i,t)}async getTileOrStrip(e,t,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=n*o*a+t*o+e);let c,f;this.isTiled?(c=this.fileDirectory.TileOffsets[l],f=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],f=this.fileDirectory.StripByteCounts[l]);const h=(await this.source.fetch([{offset:c,length:f}],s))[0];let p;return u===null||!u[l]?(p=(async()=>{let d=await i.decode(this.fileDirectory,h);const g=this.getSampleFormat(),y=this.getBitsPerSample();return Yh(g,y)&&(d=Jh(d,g,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(t))),d})(),u!==null&&(u[l]=p)):p=u[l],{x:e,y:t,sample:n,data:await p}}async _readRaster(e,t,n,i,s,o,a,l,u){const c=this.getTileWidth(),f=this.getTileHeight(),h=this.getWidth(),p=this.getHeight(),d=Math.max(Math.floor(e[0]/c),0),g=Math.min(Math.ceil(e[2]/c),Math.ceil(h/c)),y=Math.max(Math.floor(e[1]/f),0),b=Math.min(Math.ceil(e[3]/f),Math.ceil(p/f)),m=e[2]-e[0];let w=this.getBytesPerPixel();const I=[],v=[];for(let x=0;x<t.length;++x)this.planarConfiguration===1?I.push(Wh(this.fileDirectory.BitsPerSample,0,t[x])/8):I.push(0),v.push(this.getReaderForSample(t[x]));const P=[],{littleEndian:_}=this;for(let x=y;x<b;++x)for(let S=d;S<g;++S){let M;this.planarConfiguration===1&&(M=this.getTileOrStrip(S,x,0,s,u));for(let E=0;E<t.length;++E){const O=E,j=t[E];this.planarConfiguration===2&&(w=this.getSampleByteSize(j),M=this.getTileOrStrip(S,x,j,s,u));const F=M.then(T=>{const A=T.data,z=new DataView(A),q=this.getBlockHeight(T.y),H=T.y*f,ue=T.x*c,Le=H+q,Be=(T.x+1)*c,be=v[O],C=Math.min(q,q-(Le-e[3]),p-H),Ke=Math.min(c,c-(Be-e[2]),h-ue);for(let Ee=Math.max(0,e[1]-H);Ee<C;++Ee)for(let ye=Math.max(0,e[0]-ue);ye<Ke;++ye){const Ve=(Ee*c+ye)*w,me=be.call(z,Ve+I[O],_);let Ce;i?(Ce=(Ee+H-e[1])*m*t.length+(ye+ue-e[0])*t.length+O,n[Ce]=me):(Ce=(Ee+H-e[1])*m+ye+ue-e[0],n[O][Ce]=me)}});P.push(F)}}if(await Promise.all(P),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let x;return i?x=Xh(n,e[2]-e[0],e[3]-e[1],o,a,t.length,l):x=Hh(n,e[2]-e[0],e[3]-e[1],o,a,l),x.width=o,x.height=a,x}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const f=c[2]-c[0],h=c[3]-c[1],p=f*h,d=this.getSamplesPerPixel();if(!t||!t.length)for(let m=0;m<d;++m)t.push(m);else for(let m=0;m<t.length;++m)if(t[m]>=d)return Promise.reject(new RangeError(`Invalid sample index '${t[m]}'.`));let g;if(n){const m=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);g=ms(m,w,p*t.length),l&&g.fill(l)}else{g=[];for(let m=0;m<t.length;++m){const w=this.getArrayForSample(t[m],p);Array.isArray(l)&&m<l.length?w.fill(l[m]):l&&!Array.isArray(l)&&w.fill(l),g.push(w)}}const y=i||await pu(this.fileDirectory);return await this._readRaster(c,t,g,n,y,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===qe.RGB){let b=[0,1,2];if(this.fileDirectory.ExtraSamples!==Oh.Unspecified&&a){b=[];for(let m=0;m<this.fileDirectory.BitsPerSample.length;m+=1)b.push(m)}return this.readRasters({window:e,interleave:t,samples:b,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let f;switch(c){case qe.WhiteIsZero:case qe.BlackIsZero:case qe.Palette:f=[0];break;case qe.CMYK:f=[0,1,2,3];break;case qe.YCbCr:case qe.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const h={window:u,interleave:!0,samples:f,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:p}=this,d=await this.readRasters(h),g=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case qe.WhiteIsZero:y=Lh(d,g);break;case qe.BlackIsZero:y=Dh(d,g);break;case qe.Palette:y=zh(d,p.ColorMap);break;case qe.CMYK:y=jh(d);break;case qe.YCbCr:y=Nh(d);break;case qe.CIELab:y=Vh(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const b=new Uint8Array(y.length/3),m=new Uint8Array(y.length/3),w=new Uint8Array(y.length/3);for(let I=0,v=0;I<y.length;I+=3,++v)b[v]=y[I],m[v]=y[I+1],w[v]=y[I+2];y=[b,m,w]}return y.width=d.width,y.height=d.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=Mh(n,"Item");e===null?i=i.filter(s=>Vi(s,"sample")===void 0):i=i.filter(s=>Number(Vi(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[Vi(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,u,c,f]=this.fileDirectory.ModelTransformation,p=[[0,0],[0,t],[n,0],[n,t]].map(([y,b])=>[a+i*y+s*b,f+l*y+u*b]),d=p.map(y=>y[0]),g=p.map(y=>y[1]);return[Math.min(...d),Math.min(...g),Math.max(...d),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*n,u=a+s[1]*t;return[Math.min(o,l),Math.min(a,u),Math.max(o,l),Math.max(a,u)]}}}class Qh{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return ou(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class ed{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const td=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class rd{constructor(e=td,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{Ct(()=>import("./decoder.tqM1uIvc.js"),[]).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?pu(e).then(n=>n.decode(e,t)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const va=`\r
\r
`;function yu(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,n]of r)e[t.toLowerCase()]=n;return e}function nd(r){const e=r.split(`\r
`).map(t=>{const n=t.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return yu(e)}function id(r){const[e,...t]=r.split(";").map(i=>i.trim()),n=t.map(i=>i.split("="));return{type:e,params:yu(n)}}function bs(r){let e,t,n;return r&&([,e,t,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function sd(r,e){let t=null;const n=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=n.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(va),c=nd(l.substr(0,u)),{start:f,end:h,total:p}=bs(c["content-range"]),d=t+s.length+u+va.length,g=parseInt(h,10)+1-parseInt(f,10);i.push({headers:c,data:r.slice(d,d+g),offset:f,length:g,fileSize:p}),t=d+g+4}return i}class uo{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class od extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function ad(r){return new Promise(e=>setTimeout(e,r))}function ld(r,e){const t=Array.isArray(r)?r:Array.from(r),n=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,n[s]])}class Tr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Tr),this.name="AbortError"}}class ud extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const cd=ud;class fd{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class xa{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class hd extends uo{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new od({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:h,length:p}of e){let d=h+p;const{fileSize:g}=this;g!==null&&(d=Math.min(d,g));const y=Math.floor(h/this.blockSize)*this.blockSize;for(let b=y;b<d;b+=this.blockSize){const m=Math.floor(b/this.blockSize);!this.blockCache.has(m)&&!this.blockRequests.has(m)&&(this.blockIdsToFetch.add(m),i.push(m)),this.blockRequests.has(m)&&n.push(this.blockRequests.get(m)),s.push(m)}}await ad(),this.fetchBlocks(t);const o=[];for(const h of i)this.blockRequests.has(h)&&o.push(this.blockRequests.get(h));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(h=>this.abortedBlockIds.has(h)||!this.blockCache.has(h));if(l.forEach(h=>this.blockIdsToFetch.add(h)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const h of l){const p=this.blockRequests.get(h);if(!p)throw new Error(`Block ${h} is not in the block requests`);a.push(p)}await Promise.allSettled(a)}if(t&&t.aborted)throw new Tr("Request was aborted");const u=s.map(h=>this.blockCache.get(h)||this.evictedBlocks.get(h)),c=u.filter(h=>!h);if(c.length)throw new cd(c,"Request failed");const f=new Map(ld(s,u));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,u=l-a.offset,c=Math.min(u+this.blockSize,a.data.byteLength),f=a.data.slice(u,c),h=new fd(l,f.byteLength,f,o);this.blockCache.set(o,h),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(n.push(o),i=o):(s.push(new xa(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new xa(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(e,t){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const c=t.get(u),f=c.offset-n.offset,h=c.top-i;let p=0,d=0,g;f<0?p=-f:f>0&&(d=f),h<0?g=c.length-p:g=i-c.offset-p;const y=new Uint8Array(c.data,p,g);l.set(y,d)}return a})}}class co{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class fo{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class dd extends co{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class pd extends fo{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new dd(n)}}class gd extends co{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class yd extends fo{constructRequest(e,t){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new gd(s,o))},s.onerror=i,s.onabort=()=>i(new Tr("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Hi={};class md extends co{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class bd extends fo{constructor(e){super(e),this.parsedUrl=Hi.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Hi)}constructRequest(e,t){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",c=>{u.push(c)}),o.on("end",()=>{const c=Buffer.concat(u).buffer;l(c)}),o.on("error",i)});n(new md(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new Tr("Request aborted")),t.addEventListener("abort",()=>s.destroy(new Tr("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class ho extends uo{constructor(e,t,n,i){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:i,params:s}=id(n.getHeader("content-type"));if(i==="multipart/byteranges"){const f=sd(await n.getData(),s.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await n.getData(),{start:a,end:l,total:u}=bs(n.getHeader("content-range"));this._fileSize=u||null;const c=[{data:o,offset:a,length:l-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(h=>this.fetchSlice(h,t)));return c.concat(f)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=bs(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function po(r,{blockSize:e,cacheSize:t}){return e===null?r:new hd(r,{blockSize:e,cacheSize:t})}function wd(r,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new pd(r,t),a=new ho(o,e,n,i);return po(a,s)}function vd(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new yd(r),o=new ho(s,e,t,n);return po(o,i)}function xd(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new bd(r),o=new ho(s,e,t,n);return po(o,i)}function ws(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?wd(r,t):typeof XMLHttpRequest<"u"?vd(r,t):xd(r,t)}class _d extends uo{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function Td(r){return new _d(r)}function vs(r){switch(r){case B.BYTE:case B.ASCII:case B.SBYTE:case B.UNDEFINED:return 1;case B.SHORT:case B.SSHORT:return 2;case B.LONG:case B.SLONG:case B.FLOAT:case B.IFD:return 4;case B.RATIONAL:case B.SRATIONAL:case B.DOUBLE:case B.LONG8:case B.SLONG8:case B.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function Sd(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=kh[e[n]],s=e[n+1]?Kr[e[n+1]]:null,o=e[n+2],a=e[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function ur(r,e,t,n){let i=null,s=null;const o=vs(e);switch(e){case B.BYTE:case B.ASCII:case B.UNDEFINED:i=new Uint8Array(t),s=r.readUint8;break;case B.SBYTE:i=new Int8Array(t),s=r.readInt8;break;case B.SHORT:i=new Uint16Array(t),s=r.readUint16;break;case B.SSHORT:i=new Int16Array(t),s=r.readInt16;break;case B.LONG:case B.IFD:i=new Uint32Array(t),s=r.readUint32;break;case B.SLONG:i=new Int32Array(t),s=r.readInt32;break;case B.LONG8:case B.IFD8:i=new Array(t),s=r.readUint64;break;case B.SLONG8:i=new Array(t),s=r.readInt64;break;case B.RATIONAL:i=new Uint32Array(t*2),s=r.readUint32;break;case B.SRATIONAL:i=new Int32Array(t*2),s=r.readInt32;break;case B.FLOAT:i=new Float32Array(t),s=r.readFloat32;break;case B.DOUBLE:i=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===B.RATIONAL||e===B.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(r,n+a*o);return e===B.ASCII?new TextDecoder("utf-8").decode(i):i}class Ed{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class Sn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class mu{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const c=await this.getImageCount(),f=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[d,g]=l.getOrigin(),[y,b]=l.getResolution();a=[d+t[0]*y,g+t[1]*b,d+t[2]*y,g+t[3]*b]}const p=a||f;if(n){if(s)throw new Error("Both width and resX passed");s=(p[2]-p[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(p[3]-p[1])/i}}if(s||o){const p=[];for(let d=0;d<c;++d){const g=await this.getImage(d),{SubfileType:y,NewSubfileType:b}=g.fileDirectory;(d===0||y===2||b&1)&&p.push(g)}p.sort((d,g)=>d.getWidth()-g.getWidth());for(let d=0;d<p.length;++d){const g=p[d],y=(f[2]-f[0])/g.getWidth(),b=(f[3]-f[1])/g.getHeight();if(u=g,s&&s>y||o&&o>b)break}}let h=t;if(a){const[p,d]=l.getOrigin(),[g,y]=u.getResolution(l);h=[Math.round((a[0]-p)/g),Math.round((a[1]-d)/y),Math.round((a[2]-p)/g),Math.round((a[3]-d)/y)],h=[Math.min(h[0],h[2]),Math.min(h[1],h[3]),Math.max(h[0],h[2]),Math.max(h[1],h[3])]}return u.readRasters({...e,window:h})}}class Sr extends mu{constructor(e,t,n,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new ed((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let f=0;f<s;l+=t,++f){const h=i.readUint16(l),p=i.readUint16(l+2),d=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let g,y;const b=vs(p),m=l+(this.bigTiff?12:8);if(b*d<=(this.bigTiff?8:4))g=ur(i,p,d,m);else{const w=i.readOffset(m),I=vs(p)*d;if(i.covers(w,I))g=ur(i,p,d,w);else{const v=await this.getSlice(w,I);g=ur(v,p,d,w)}}d===1&&Fh.indexOf(h)===-1&&!(p===B.RATIONAL||p===B.SRATIONAL)?y=g[0]:y=g,a[Kr[h]]=y}const u=Sd(a),c=i.readOffset(e+n+t*s);return new Ed(a,u,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Sn?new Sn(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Sn(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new gu(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Sn)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===ur(i,B.ASCII,t.length,e)){const o=ur(i,B.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(i=await this.getSlice(e,a));const l=ur(i,B.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,c])=>{this.ghostValues[u]=c})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],s=new Qh(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=u?s.getUint64(8,a):s.getUint32(4,a);return new Sr(e,a,u,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class Id extends mu{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(n);return new gu(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function Pd(r,e={},t){return Sr.fromSource(ws(r,e),t)}async function Ad(r,e){return Sr.fromSource(Td(r),e)}async function Rd(r,e=[],t={},n){const i=await Sr.fromSource(ws(r,t),n),s=await Promise.all(e.map(o=>Sr.fromSource(ws(o,t))));return new Id(i,s)}function xs(r){return Array.isArray(r)?Math.min(...r):r}class Cd extends ai{constructor(e,t,n,i,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?cn(n,u):n,f=Ar(c),h=El(e,t,f,i),p=Hc,d=new Bc(e,t,c,l,h*p,i),g=d.calculateSourceExtent(),y=$s(g)?null:o(g,h,s),b=y?we.IDLE:we.EMPTY,m=y?y.getPixelRatio():1;super(n,i,m,b),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=d,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=y,this.sourcePixelRatio_=m,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==we.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==we.LOADED){const t=nr(this.targetExtent_)/this.targetResolution_,n=ir(this.targetExtent_)/this.targetResolution_;this.canvas_=Vc(t,n,this.sourcePixelRatio_,xs(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==we.IDLE){this.state=we.LOADING,this.changed();const e=this.sourceImage_.getState();e==we.LOADED||e==we.ERROR?this.reproject_():(this.sourceListenerKey_=qc(this.sourceImage_,sr.CHANGE,t=>{const n=this.sourceImage_.getState();(n==we.LOADED||n==we.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){$c(this.sourceListenerKey_),this.sourceListenerKey_=null}}const yr=4,Ki={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Md extends Hs{constructor(e,t){super(e),this.image=t}}class go extends li{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const n=Kc(t,e,0);e=t[n]}return e}getImage(e,t,n,i){const s=this.getProjection();if(!s||!i||Ne(s,i))return s&&(i=s),this.getImageInternal(e,t,n,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ne(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==t&&zn(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Cd(s,i,e,t,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,i){if(this.loader){const s=Od(e,t,n,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&Yr(this.wantedExtent_,s)||Yr(this.image.getExtent(),s))&&(this.wantedResolution_&&xs(this.wantedResolution_)===o||xs(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new ai(s,o,n,this.loader),this.image.addEventListener(sr.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case we.LOADING:this.loading=!0,n=Ki.IMAGELOADSTART;break;case we.LOADED:this.loading=!1,n=Ki.IMAGELOADEND;break;case we.ERROR:this.loading=!1,n=Ki.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Md(n,t))}}function Fd(r,e){r.getImage().src=e}function Od(r,e,t,n){const i=e/t,s=Ar(r),o=xn(nr(r)/i,yr),a=xn(ir(r)/i,yr),l=xn((n-1)*o/2,yr),u=o+2*l,c=xn((n-1)*a/2,yr),f=a+2*c;return Zc(s,i,0,[u,f])}function kd(r){const e=r.load||Il,t=r.imageExtent,n=r.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=n,e(i,r.url).then(s=>{const o=nr(t)/s.width,a=ir(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class Ld extends go{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,n=e.imageLoadFunction!==void 0?e.imageLoadFunction:Fd;super({attributions:e.attributions,interpolate:e.interpolate,projection:se(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new ai(this.imageExtent_,void 0,1,kd({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),n(this.image,s),Il(i))})),this.image.addEventListener(sr.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return Pt(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const _s="1.3.0";function Dd(r,e,t,n,i){i.WIDTH=t[0],i.HEIGHT=t[1];const s=n.getAxisOrientation(),o=Kl(i.VERSION,"1.3")>=0;i[o?"CRS":"SRS"]=n.getCode();const a=o&&s.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return i.BBOX=a.join(","),jn(r,i)}function zd(r,e,t,n,i,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=e/t,l=[oa(nr(r)/a,yr),oa(ir(r)/a,yr)];if(t!=1)switch(o){case"geoserver":const c=90*t+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+c:s.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":s.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":s.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return Dd(i,r,l,n,s)}function _a(r,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:_s,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},r)}class dn extends Xc{constructor(e){const t=e.projection||"EPSG:3857",n=e.extent||ui(t),i=e.tileGrid||fn({extent:n,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:i,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:bu,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Zl,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,n){if(n.getState()===Q.IDLE){n.setState(Q.LOADING);const i=n.wrappedTileCoord,s=this.getTileGridForProjection(t);let o=s.getTileCoordExtent(i);const a=i[0],l=s.getResolution(a);Wt(o,-l,o);const u=this.projection;t&&this.projection&&!Ne(t,u)&&(o=Yt(o,t,u));const c=this.tileGrid,f=c.getExtent();f&&cn(o,f,o);let h=l;t&&u&&!Ne(t,u)&&(h=l/u.getMetersPerUnit()/t.getMetersPerUnit());const p=c.getZForResolution(h,this.zDirection);c.forEachTileCoord(o,p,d=>{const g=this.tileUrlFunction(d,e,t);this.sourceTiles_[g]||(this.sourceTiles_[g]=new this.tileClass(d,g?Q.IDLE:Q.EMPTY,g,this.format_,this.tileLoadFunction));const y=this.sourceTiles_[g];n.sourceTiles.push(y),this.tileKeysBySourceTileUrl_[g]||(this.tileKeysBySourceTileUrl_[g]=[]),this.tileKeysBySourceTileUrl_[g].push(n.getKey());const b=y.getState();if(b<Q.LOADED){const m=w=>{this.handleTileChange(w);const I=y.getState();if(I===Q.LOADED||I===Q.ERROR){const v=y.getKey();v in n.errorTileKeys?y.getState()===Q.LOADED&&delete n.errorTileKeys[v]:n.loadingSourceTiles--,I===Q.ERROR?n.errorTileKeys[v]=!0:y.removeEventListener(sr.CHANGE,m),n.loadingSourceTiles===0&&n.setState(Al(n.errorTileKeys)?Q.LOADED:Q.ERROR)}};y.addEventListener(sr.CHANGE,m),n.loadingSourceTiles++}b===Q.IDLE&&(y.extent=c.getTileCoordExtent(d),y.projection=this.projection,y.resolution=c.getResolution(d[0]),y.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(d=>d.getState()===Q.ERROR)?Q.ERROR:Q.LOADED)}return n.sourceTiles}removeSourceTiles(e){const t=e.getKey(),n=e.sourceTiles;for(let i=0,s=n.length;i<s;++i){const o=n[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[o])return;const a=this.tileKeysBySourceTileUrl_[o].indexOf(t);a!==-1&&(this.tileKeysBySourceTileUrl_[o].splice(a,1),this.tileKeysBySourceTileUrl_[o].length===0&&(delete this.tileKeysBySourceTileUrl_[o],delete this.sourceTiles_[o]))}}getTile(e,t,n,i,s){const o=[e,t,n];let a=this.getTileCoordForTileUrlFunction(o,s);const l=this.getTileGrid().getExtent(),u=this.projection,c=this.getTileGridForProjection(s);if(a&&l){const p=c.getTileCoordExtent(a);Wt(p,-c.getResolution(e),p),Pt(l,!s||!u||Ne(s,u)?p:Yt(p,s,u))||(a=null)}let f=!0;if(a!==null){const p=this.tileGrid,d=c.getResolution(e);let g=d;s&&u&&!Ne(s,u)&&(g=d/u.getMetersPerUnit()/s.getMetersPerUnit());const y=p.getZForResolution(g,1),b=c.getTileCoordExtent(a);Wt(b,-d,b),p.forEachTileCoord(!s||!u||Ne(s,u)?b:Yt(b,s,u),y,m=>{f=f&&!this.tileUrlFunction(m,i,u)})}const h=new Qf(o,f?Q.EMPTY:Q.IDLE,a,this.getSourceTiles.bind(this,i,s),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(e){const t=e.getCode();let n=this.tileGrids_[t];if(!n){const i=this.projection;if(i!==null&&!Ne(i,e))return Wc(e);const s=this.tileGrid,o=s.getResolutions().slice(),a=o.map(function(c,f){return s.getOrigin(f)}),l=o.map(function(c,f){return s.getTileSize(f)}),u=Yc+1;for(let c=o.length;c<u;++c)o.push(o[c-1]/2),a.push(a[c-1]),l.push(l[c-1]);n=new Ks({extent:s.getExtent(),origins:a,resolutions:o,tileSizes:l}),this.tileGrids_[t]=n}return n}getTilePixelRatio(e){return e}getTilePixelSize(e,t,n){const i=this.getTileGridForProjection(n),s=Pl(i.getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function bu(r,e){r.setLoader(function(t,n,i){kf(e,r.getFormat(),t,n,i,r.onLoad.bind(r),r.onError.bind(r))})}class jd extends Xf{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,i=e.viewState,s=i.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=cn(l,aa(t.extent,i.projection))),!a[Dt.ANIMATING]&&!a[Dt.INTERACTING]&&!$s(l))if(o){const u=i.projection,c=o.getImage(l,s,n,u);c&&(this.loadImage(c)?this.image=c:c.getState()===we.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),i=Zs(t.pixelToCoordinateTransform,e.slice()),s=n.getExtent();if(s&&!Jc(s,i))return null;const o=this.image.getExtent(),a=this.image.getImage(),l=nr(o),u=Math.floor(a.width*((i[0]-o[0])/l));if(u<0||u>=a.width)return null;const c=ir(o),f=Math.floor(a.height*((o[3]-i[1])/c));return f<0||f>=a.height?null:this.getImageData(a,u,f)}renderFrame(e,t){const n=this.image,i=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),u=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,f=e.viewState,h=f.center,p=f.resolution,d=c*o/(p*l),g=c*a/(p*l);this.prepareContainer(e,t);const y=this.context.canvas.width,b=this.context.canvas.height,m=this.getRenderContext(e);let w=!1,I=!0;if(u.extent){const S=aa(u.extent,f.projection);I=Pt(S,e.extent),w=I&&!Yr(S,e.extent),w&&this.clipUnrotated(m,e,S)}const v=n.getImage(),P=Qc(this.tempTransform,y/2,b/2,d,g,0,l*(i[0]-h[0])/o,l*(h[1]-i[3])/a);this.renderedResolution=a*c/l;const _=v.width*P[0],x=v.height*P[3];if(this.getLayer().getSource().getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e),I&&_>=.5&&x>=.5){const S=P[4],M=P[5],E=u.opacity;E!==1&&(m.save(),m.globalAlpha=E),m.drawImage(v,0,0,+v.width,+v.height,S,M,_,x),E!==1&&m.restore()}return this.postRender(this.context,e),w&&m.restore(),m.imageSmoothingEnabled=!0,this.container}}class Nd extends Rl{constructor(e){e=e||{},super(e)}}class di extends Nd{constructor(e){super(e)}createRenderer(){return new jd(this)}getData(e){return super.getData(e)}}function wu(r){return function(e){const t=e.buffers,n=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const h=new Array(a);for(let d=0;d<a;++d)h[d]=new ImageData(new Uint8ClampedArray(t[d]),s,o);return r(h,n).data.buffer}const u=new Uint8ClampedArray(l),c=new Array(a),f=new Array(a);for(let h=0;h<a;++h)c[h]=new Uint8ClampedArray(t[h]),f[h]=[0,0,0,0];for(let h=0;h<l;h+=4){for(let d=0;d<a;++d){const g=c[d];f[d][0]=g[h],f[d][1]=g[h+1],f[d][2]=g[h+2],f[d][3]=g[h+3]}const p=r(f,n);u[h]=p[0],u[h+1]=p[1],u[h+2]=p[2],u[h+3]=p[3]}return u.buffer}}function Ud(r,e){const n=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+wu.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",e),i}function Gd(r,e){const t=wu(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class Bd extends tf{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const n=new Array(t);if(t)for(let i=0;i<t;++i)n[i]=Ud(e,this.onWorkerMessage_.bind(this,i));else n[0]=Gd(e,this.onWorkerMessage_.bind(this,0));this.workers_=n,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,n){this.enqueue_({inputs:e,meta:t,callback:n}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,n=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,c=[];for(let f=0,h=i.length;f<h;++f)c.push(i[f].slice(u,u+a));this.workers_[l].postMessage({buffers:c,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},c)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let n,i;if(t===1)n=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,u=a*o;n.set(new Uint8ClampedArray(l),u),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(n,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const Ta={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Sa extends Hs{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class yo extends go{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=$d(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(sr.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new ef(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Nn(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:qd(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Nn(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ot(this),renderTargets:{}},this.setAttributions(function(n){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],u=l instanceof li?l:l.getSource();if(!u)continue;const c=(s=u.getAttributions())==null?void 0:s(n);typeof c=="string"?i.push(c):c!==void 0&&i.push(...c)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Bd({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Ar(e);i.size[0]=Math.ceil(nr(e)/t),i.size[1]=Math.ceil(ir(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let n=0,i=this.layers_.length;n<i;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!zn(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=Vd(this.layers_[s],e);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new Sa(Ta.BEFOREOPERATIONS,e,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,i){if(t||!n)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!zn(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(nr(s)/o),u=Math.round(ir(s)/o);a=Dn(l,u),this.renderedImageCanvas_=new Jf(s,o,1,a.canvas)}a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Sa(Ta.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,i=this.layers_.length;n<i&&(t=this.layers_[n].getSource().getResolutions(e),!t);++n);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}yo.prototype.dispose;let qt=null;function Vd(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const n=e.size[0],i=e.size[1];if(n===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!qt)qt=Dn(n,i,void 0,{willReadFrequently:!0});else{const a=qt.canvas;a.width!==n||a.height!==i?qt=Dn(n,i,void 0,{willReadFrequently:!0}):qt.clearRect(0,0,n,i)}return qt.drawImage(o,0,0,n,i),qt.getImageData(0,0,n,i)}function qd(r){return r.map(function(e){return e.getLayerState()})}function $d(r){const e=r.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=Hd(r[n]);return t}function Hd(r){let e;return r instanceof li?r instanceof rf?e=new Bn({source:r}):r instanceof go&&(e=new di({source:r})):e=r,e}class mo extends Xs{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:se("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Yf(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=se("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const u=nf(t,n);i=Cl(e.bounds,u)}const s=ui(n),o=e.minzoom||0,a=e.maxzoom||22,l=fn({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=sf(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(c){return Pt(u,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class Kd extends Xs{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=of(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,n,i){const s=se(n),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=af(e,s,o),u=El(o,s,e,t),c=a.getZForResolution(u,this.zDirection),f=a.getResolution(c),h=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=h[0])return;let p=a.getTileCoordExtent(h,this.tmpExtent_);const d=this.gutter_;d!==0&&(p=Wt(p,f*d,p));const g={QUERY_LAYERS:this.params_.LAYERS};Object.assign(g,_a(this.params_,"GetFeatureInfo"),i);const y=Math.floor((l[0]-p[0])/f),b=Math.floor((p[3]-l[1])/f);return g[this.v13_?"I":"X"]=y,g[this.v13_?"J":"Y"]=b,this.getRequestUrl_(h,p,1,o||s,g)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:_s,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;n.LAYER=i}if(e!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;n.SCALE=e*i/s}return Object.assign(n,t),jn(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,n,i,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=lf(uf(e),o.length);a=o[l]}return zd(t,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(e[0]),n,i,a,s,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const n in this.params_)t[e++]=n+"-"+this.params_[n];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||_s;this.v13_=Kl(e,"1.3")>=0}tileUrlFunction(e,t,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const s=i.getResolution(e[0]);let o=i.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Wt(o,s*a,o));const l=Object.assign({},_a(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,n,l)}}class Zd extends Xs{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",n=e.tileGrid;let i=e.urls;i===void 0&&e.url!==void 0&&(i=cf(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:i,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=la(i.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(la(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?jn(e,n):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const u={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(u,s);let c=e;return t=="KVP"?c=jn(c,u):c=c.replace(/\{(\w+?)\}/g,function(f,h){return encodeURIComponent(u[h])}),c}}}function Xd(r,e){var j;const t=r.Contents.Layer,n=t==null?void 0:t.find(function(F){return F.Identifier==e.layer});if(!n)return null;const i=r.Contents.TileMatrixSet;let s;n.TileMatrixSetLink.length>1?"projection"in e?s=n.TileMatrixSetLink.findIndex(function(F){const A=i.find(function(H){return H.Identifier==F.TileMatrixSet}).SupportedCRS,z=se(A),q=se(e.projection);return z&&q?Ne(z,q):A==e.projection}):s=n.TileMatrixSetLink.findIndex(function(F){return F.TileMatrixSet==e.matrixSet}):s=0,s<0&&(s=0);const o=n.TileMatrixSetLink[s].TileMatrixSet,a=n.TileMatrixSetLink[s].TileMatrixSetLimits;let l=n.Format[0];"format"in e&&(l=e.format),s=n.Style.findIndex(function(F){return"style"in e?F.Title==e.style:F.isDefault}),s<0&&(s=0);const u=n.Style[s].Identifier,c={};"Dimension"in n&&n.Dimension.forEach(function(F,T,A){const z=F.Identifier;let q=F.Default;q===void 0&&(q=F.Value[0]),c[z]=q});const h=r.Contents.TileMatrixSet.find(function(F){return F.Identifier==o});let p;const d=h.SupportedCRS;if(d&&(p=se(d)),"projection"in e){const F=se(e.projection);F&&(!p||Ne(F,p))&&(p=F)}let g=!1;const y=p.getAxisOrientation().startsWith("ne");let b=h.TileMatrix[0],m={MinTileCol:0,MinTileRow:0,MaxTileCol:b.MatrixWidth-1,MaxTileRow:b.MatrixHeight-1};if(a){m=a[a.length-1];const F=h.TileMatrix.find(T=>T.Identifier===m.TileMatrix||h.Identifier+":"+T.Identifier===m.TileMatrix);F&&(b=F)}const w=(j=n.BoundingBox)==null?void 0:j.find(F=>se(F.crs)&&Ne(se(F.crs),p)),I=b.ScaleDenominator*28e-5/p.getMetersPerUnit(),v=y?[b.TopLeftCorner[1],b.TopLeftCorner[0]]:b.TopLeftCorner,P=b.TileWidth*I,_=b.TileHeight*I;let x=(w==null?void 0:w.extent)??h.BoundingBox;x&&y&&(x=[x[1],x[0],x[3],x[2]]);let S=[v[0]+P*m.MinTileCol,v[1]-_*(1+m.MaxTileRow),v[0]+P*(1+m.MaxTileCol),v[1]-_*m.MinTileRow];if(x!==void 0&&!Yr(x,S)){const F=n.WGS84BoundingBox,T=se("EPSG:4326").getExtent();if(S=x,F)g=F[0]===T[0]&&F[2]===T[2];else{const A=Yt(x,h.SupportedCRS,"EPSG:4326");g=A[0]-1e-10<=T[0]&&A[2]+1e-10>=T[2]}}const M=Bf(h,S,a),E=[];let O=e.requestEncoding;if(O=O!==void 0?O:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata){const F=r.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let T=0,A=F.length;T<A;++T)if(F[T].Constraint){const q=F[T].Constraint.find(function(H){return H.name=="GetEncoding"}).AllowedValues.Value;if(O===""&&(O=q[0]),O==="KVP")q.includes("KVP")&&E.push(F[T].href);else break}else F[T].href&&(O="KVP",E.push(F[T].href))}return E.length===0&&(O="REST",n.ResourceURL.forEach(function(F){F.resourceType==="tile"&&(l=F.format,E.push(F.template))})),{urls:E,layer:e.layer,matrixSet:o,format:l,projection:p,requestEncoding:O,tileGrid:M,style:u,dimensions:c,wrapX:g,crossOrigin:e.crossOrigin}}class bo extends Vf{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class Wd extends qf{constructor(e,t=null){super(e,t)}}class vu extends bo{constructor(e,t=null){const n={collections:i=>i.map(s=>s instanceof ys?s:new ys(s))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Ys(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return $l(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class xu extends bo{constructor(e,t=null){const n={features:i=>i.map(s=>s instanceof Vn?s:new Vn(s))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Ys(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return $l(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function En(r,e=!0,t=!1){return e&&(r=$f.stac(r,t)),r.type==="Feature"?new Vn(r):r.type==="FeatureCollection"?new xu(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new ys(r):!r.type&&Array.isArray(r.collections)?new vu(r):new Wd(r)}class _u{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Vl,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?se(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()==="tile-pixels"&&(n=se(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return ke()}readFeature(e,t){return ke()}readFeatures(e,t){return ke()}readGeometry(e,t){return ke()}readProjection(e){return ke()}writeFeature(e,t){return ke()}writeFeatures(e,t){return ke()}writeGeometry(e,t){return ke()}}function pi(r,e,t){const n=t?se(t.featureProjection):null,i=t?se(t.dataProjection):null;let s=r;if(n&&i&&!Ne(n,i)){e&&(s=r.clone());const o=e?n:i,a=e?i:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(Ol(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let u=0,c=l.length;u<c;++u)l[u]=Math.round(l[u]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}const Yd={Point:Fl,LineString:Bl,Polygon:Ml,MultiPoint:Gl,MultiLineString:Ul,MultiPolygon:Nl};function Jd(r,e,t){return Array.isArray(e[0])?(ff(r,0,e,t)||(r=r.slice(),hf(r,0,e,t)),r):(df(r,0,e,t)||(r=r.slice(),pf(r,0,e,t)),r)}function Tu(r,e){var s;const t=r.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Tu({...r,geometry:o})).flat();const n=t.type==="MultiPolygon"?"Polygon":t.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const i=t.layout.length;return pi(new Jr(n,n==="Polygon"?Jd(t.flatCoordinates,t.ends,i):t.flatCoordinates,(s=t.ends)==null?void 0:s.flat(),i,r.properties||{},r.id).enableSimplifyTransformed(),!1,e)}function wo(r,e){if(!r)return null;if(Array.isArray(r)){const n=r.map(i=>wo(i,e));return new Lf(n)}const t=Yd[r.type];return pi(new t(r.flatCoordinates,r.layout||"XY",r.ends),!1,e)}class Qd extends _u{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(In(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(In(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ke()}readFeaturesFromObject(e,t){return ke()}readGeometry(e,t){return this.readGeometryFromObject(In(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ke()}readProjection(e){return this.readProjectionFromObject(In(e))}readProjectionFromObject(e){return ke()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ke()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ke()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ke()}}function In(r){if(typeof r=="string"){const e=JSON.parse(r);return e||null}return r!==null?r:null}class Ts extends Qd{constructor(e){e=e||{},super(),this.dataProjection=se(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=se(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const i=vo(n.geometry);if(this.featureClass===Jr)return Tu({geometry:i,id:n.id,properties:n.properties},t);const s=new Vl;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(wo(i,t)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(e,t){const n=e;let i=null;if(n.type==="FeatureCollection"){const s=e;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const u=this.readFeatureFromObject(o[a],t);u&&i.push(u)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return ep(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if(t.type=="name")n=se(t.properties.name);else if(t.type==="EPSG")n=se("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(n.id=i),!e.hasProperties())return n;const s=e.getProperties(),o=e.getGeometry();return o&&(n.geometry=Ss(o,t),delete s[e.getGeometryName()]),Al(s)||(n.properties=s),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,s=e.length;i<s;++i)n.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return Ss(e,this.adaptOptions(t))}}function vo(r,e){if(!r)return null;let t;switch(r.type){case"Point":{t=rp(r);break}case"LineString":{t=np(r);break}case"Polygon":{t=ap(r);break}case"MultiPoint":{t=sp(r);break}case"MultiLineString":{t=ip(r);break}case"MultiPolygon":{t=op(r);break}case"GeometryCollection":{t=tp(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return t}function ep(r,e){const t=vo(r);return wo(t,e)}function tp(r,e){return r.geometries.map(function(n){return vo(n)})}function rp(r){const e=r.coordinates;return{type:"Point",flatCoordinates:e,layout:Rr(e.length)}}function np(r){var n;const e=r.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:Rr(((n=e[0])==null?void 0:n.length)||2)}}function ip(r){var s,o;const e=r.coordinates,t=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length)||2,n=[],i=kl(n,0,e,t);return{type:"MultiLineString",flatCoordinates:n,ends:i,layout:Rr(t)}}function sp(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Rr(((t=e[0])==null?void 0:t.length)||2)}}function op(r){var s,o;const e=r.coordinates,t=[],n=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,i=gf(t,0,e,n);return{type:"MultiPolygon",flatCoordinates:t,ends:i,layout:Rr(n)}}function ap(r){var s,o;const e=r.coordinates,t=[],n=(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length,i=kl(t,0,e,n);return{type:"Polygon",flatCoordinates:t,ends:i,layout:Rr(n)}}function Ss(r,e){r=pi(r,!0,e);const t=r.getType();let n;switch(t){case"Point":{n=dp(r);break}case"LineString":{n=up(r);break}case"Polygon":{n=pp(r,e);break}case"MultiPoint":{n=fp(r);break}case"MultiLineString":{n=cp(r);break}case"MultiPolygon":{n=hp(r,e);break}case"GeometryCollection":{n=lp(r,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function lp(r,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return Ss(n,e)})}}function up(r,e){return{type:"LineString",coordinates:r.getCoordinates()}}function cp(r,e){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function fp(r,e){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function hp(r,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}function dp(r,e){return{type:"Point",coordinates:r.getCoordinates()}}function pp(r,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}function xo(r,e){return Su(r,e,[]).join("")}function Su(r,e,t){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)t.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)Su(n,e,t)}return t}function gp(r){return"documentElement"in r}function yp(r){return new DOMParser().parseFromString(r,"application/xml")}function Es(r,e){return function(t,n){const i=r.call(this,t,n);i!==void 0&&n[n.length-1].push(i)}}function $e(r,e,t){return function(n,i){const s=r.call(this,n,i);if(s!==void 0){const o=i[i.length-1],a=n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function N(r,e,t){return function(n,i){const s=r.call(this,n,i);if(s!==void 0){const o=i[i.length-1],a=n.localName;o[a]=s}}}function te(r,e,t){t=t!==void 0?t:{};let n,i;for(n=0,i=r.length;n<i;++n)t[r[n]]=e;return t}function mp(r,e,t,n){let i;for(i=e.firstElementChild;i;i=i.nextElementSibling){const s=r[i.namespaceURI];if(s!==void 0){const o=s[i.localName];o!==void 0&&o.call(n,i,t)}}}function oe(r,e,t,n,i){return n.push(r),mp(e,t,n,i),n.pop()}class Eu{read(e){if(!e)return null;if(typeof e=="string"){const t=yp(e);return this.readFromDocument(t)}return gp(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){ke()}}const bp="http://www.w3.org/1999/xlink";function _o(r){return r.getAttributeNS(bp,"href")}function wp(r){const e=xo(r,!1);return vp(e)}function vp(r){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(e)return parseFloat(e[1])}function jt(r){const e=xo(r,!1);return xp(e)}function xp(r){const e=/^\s*(\d+)\s*$/.exec(r);if(e)return parseInt(e[1],10)}function X(r){return xo(r,!1).trim()}const He=[null,"http://www.opengis.net/ows/1.1"],_p=te(He,{ServiceIdentification:N(Kp),ServiceProvider:N(Xp),OperationsMetadata:N($p)});class Tp extends Eu{constructor(){super()}readFromNode(e){const t=oe({},_p,e,[]);return t||null}}const Sp=te(He,{DeliveryPoint:N(X),City:N(X),AdministrativeArea:N(X),PostalCode:N(X),Country:N(X),ElectronicMailAddress:N(X)}),Ep=te(He,{Value:$e(Wp)}),Ip=te(He,{AllowedValues:N(jp)}),Pp=te(He,{Phone:N(Hp),Address:N(zp)}),Ap=te(He,{HTTP:N(Vp)}),Rp=te(He,{Get:$e(Bp),Post:void 0}),Cp=te(He,{DCP:N(Gp)}),Mp=te(He,{Operation:qp}),Fp=te(He,{Voice:N(X),Facsimile:N(X)}),Op=te(He,{Constraint:$e(Np)}),kp=te(He,{IndividualName:N(X),PositionName:N(X),ContactInfo:N(Up)}),Lp=te(He,{Abstract:N(X),AccessConstraints:N(X),Fees:N(X),Title:N(X),ServiceTypeVersion:N(X),ServiceType:N(X)}),Dp=te(He,{ProviderName:N(X),ProviderSite:N(_o),ServiceContact:N(Zp)});function zp(r,e){return oe({},Sp,r,e)}function jp(r,e){return oe({},Ep,r,e)}function Np(r,e){const t=r.getAttribute("name");if(t)return oe({name:t},Ip,r,e)}function Up(r,e){return oe({},Pp,r,e)}function Gp(r,e){return oe({},Ap,r,e)}function Bp(r,e){const t=_o(r);if(t)return oe({href:t},Op,r,e)}function Vp(r,e){return oe({},Rp,r,e)}function qp(r,e){const t=r.getAttribute("name"),n=oe({},Cp,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function $p(r,e){return oe({},Mp,r,e)}function Hp(r,e){return oe({},Fp,r,e)}function Kp(r,e){return oe({},Lp,r,e)}function Zp(r,e){return oe({},kp,r,e)}function Xp(r,e){return oe({},Dp,r,e)}function Wp(r,e){return X(r)}const It=[null,"http://www.opengis.net/wmts/1.0"],Fr=[null,"http://www.opengis.net/ows/1.1"],Yp=te(It,{Contents:N(lg)});class Jp extends Eu{constructor(){super(),this.owsParser_=new Tp}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=oe(n,Yp,e,[]),n||null):null}}const Qp=te(It,{Layer:$e(ug),TileMatrixSet:$e(cg)}),eg=te(It,{Style:$e(fg),Format:$e(X),TileMatrixSetLink:$e(hg),Dimension:$e(dg),ResourceURL:$e(pg)},te(Fr,{Title:N(X),Abstract:N(X),WGS84BoundingBox:N(Pu),BoundingBox:$e(gg),Identifier:N(X)})),tg=te(It,{LegendURL:$e(yg)},te(Fr,{Title:N(X),Identifier:N(X)})),rg=te(It,{TileMatrixSet:N(X),TileMatrixSetLimits:N(bg)}),ng=te(It,{TileMatrixLimits:Es(wg)}),ig=te(It,{TileMatrix:N(X),MinTileRow:N(jt),MaxTileRow:N(jt),MinTileCol:N(jt),MaxTileCol:N(jt)}),sg=te(It,{Default:N(X),Value:$e(X)},te(Fr,{Identifier:N(X)})),Iu=te(Fr,{LowerCorner:Es(Is),UpperCorner:Es(Is)}),og=te(It,{WellKnownScaleSet:N(X),TileMatrix:$e(mg)},te(Fr,{SupportedCRS:N(X),Identifier:N(X),BoundingBox:N(Pu)})),ag=te(It,{TopLeftCorner:N(Is),ScaleDenominator:N(wp),TileWidth:N(jt),TileHeight:N(jt),MatrixWidth:N(jt),MatrixHeight:N(jt)},te(Fr,{Identifier:N(X)}));function lg(r,e){return oe({},Qp,r,e)}function ug(r,e){return oe({},eg,r,e)}function cg(r,e){return oe({},og,r,e)}function fg(r,e){const t=oe({},tg,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function hg(r,e){return oe({},rg,r,e)}function dg(r,e){return oe({},sg,r,e)}function pg(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return t&&(s.format=t),n&&(s.template=n),i&&(s.resourceType=i),s}function Pu(r,e){const t=oe([],Iu,r,e);if(t.length==2)return Ws(t)}function gg(r,e){const t=r.getAttribute("crs"),n=oe([],Iu,r,e);if(n.length==2)return{extent:Ws(n),crs:t}}function yg(r,e){const t={};return t.format=r.getAttribute("format"),t.href=_o(r),t}function Is(r,e){const t=X(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function mg(r,e){return oe({},ag,r,e)}function bg(r,e){return oe([],ng,r,e)}function wg(r,e){return oe({},ig,r,e)}const vg={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Ea={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class xg extends Of{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Nn(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,n,i,s,o,a,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,n,i,s,o,a,l)}getTile(e,t,n,i){const s=this.getOrCreateTile(e,t,n,i);if(!s)return null;const o=i.viewState,a=o.resolution,l=i.viewHints,u=this.getLayer().getSource(),c=u.getTileGridForProjection(o.projection),f=!(l[Dt.ANIMATING]||l[Dt.INTERACTING]),h=c.getZForResolution(a,u.zDirection)===e;return f&&h?s.wantedResolution=a:s.wantedResolution||(s.wantedResolution=c.getResolution(e)),s}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,n){const i=this.getLayer(),s=i.getRevision(),o=i.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedPixelRatio===t&&l.renderedRenderOrder==o)return;const u=i.getSource(),c=!!i.getDeclutter(),f=u.getTileGrid(),p=u.getTileGridForProjection(n).getTileCoordExtent(e.wrappedTileCoord),d=u.getSourceTiles(t,n,e),g=ot(i);delete e.hitDetectionImageData[g],e.executorGroups[g]=[],l.dirty=!1;for(let y=0,b=d.length;y<b;++y){const m=d[y];if(m.getState()!=Q.LOADED)continue;const w=u.getProjection(),I=m.tileCoord;let v=f.getTileCoordExtent(I);n&&w&&!Ne(n,w)&&(v=Yt(v,w,n,32));const P=cn(p,v),_=Wt(P,i.getRenderBuffer()*a,this.tempExtent),x=zn(v,P)?null:_,S=new Df(0,P,a,t),M=Uf(a,t),E=function(A,z){let q;const H=A.getStyleFunction()||i.getStyleFunction();if(H&&(q=H(A,a)),q){const ue=this.renderFeature(A,M,q,S,c,z);l.dirty=l.dirty||ue}},O=m.getFeatures();o&&o!==l.renderedRenderOrder&&O.sort(o);for(let A=0,z=O.length;A<z;++A){let q=O[A];n&&m.projection&&!Ne(n,m.projection)&&(q=q.clone(),q.getGeometry().applyTransform(Ol(m.projection,n))),(!x||Pt(x,q.getGeometry().getExtent()))&&E.call(this,q,A)}const j=S.finish(),F=i.getRenderMode()!=="vector"&&c&&d.length===1?null:P,T=new zf(F,a,t,u.getOverlaps(),j,i.getRenderBuffer(),!0);e.executorGroups[g].push(T)}l.renderedRevision=s,l.renderedPixelRatio=t,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,n,i,s){var w,I;const o=t.viewState.resolution,a=t.viewState.rotation;n=n??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),f=Ws([e]);Wt(f,o*n,f);const h={},p=function(v,P,_){let x=v.getId();x===void 0&&(x=ot(v));const S=h[x];if(S){if(S!==!0&&_<S.distanceSq){if(_===0)return h[x]=!0,s.splice(s.lastIndexOf(S),1),i(v,l,P);S.geometry=P,S.distanceSq=_}}else{if(_===0)return h[x]=!0,i(v,l,P);s.push(h[x]={feature:v,layer:l,geometry:P,distanceSq:_,callback:i})}},d=this.renderedTiles,g=ot(l),y=l.getDeclutter(),b=y?(I=(w=t.declutter)==null?void 0:w[y])==null?void 0:I.all().map(v=>v.value):null;let m;e:for(let v=0,P=d.length;v<P;++v){const _=d[v],x=c.getTileCoordExtent(_.wrappedTileCoord);if(!Pt(x,f))continue;const S=_.executorGroups[g];for(let M=0,E=S.length;M<E;++M)if(m=S[M].forEachFeatureAtCoordinate(e,o,a,n,p,b),m)break e}return m}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,n)=>{const i=this.getLayer(),s=i.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,u=s.getTileGridForProjection(o),c=Zs(this.renderedPixelToCoordinateTransform_,e.slice()),f=u.getTileCoordForCoordAndResolution(c,l).toString(),h=this.renderedTiles.find(w=>w.tileCoord.toString()===f&&w.getState()===Q.LOADED);if(!h||h.loadingSourceTiles>0){t([]);return}s.getWrapX()&&o.canWrapX()&&!Yr(a,u.getTileCoordExtent(h.tileCoord))&&yf(c,o);const p=ot(i),d=u.getTileCoordExtent(h.wrappedTileCoord),g=Ll(d),y=[(c[0]-g[0])/l,(g[1]-c[1])/l],b=h.getSourceTiles().reduce((w,I)=>w.concat(I.getFeatures()),[]);let m=h.hitDetectionImageData[p];if(!m){const w=Pl(u.getTileSize(u.getZForResolution(l,s.zDirection))),I=this.renderedRotation_,v=[this.getRenderTransform(u.getTileCoordCenter(h.wrappedTileCoord),l,0,Gi,w[0]*Gi,w[1]*Gi,0)];m=jf(w,v,b,i.getStyleFunction(),u.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(i).renderedResolution,I),h.hitDetectionImageData[p]=m}t(Nf(y,b,m))})}getFeaturesInExtent(e){const t=[],n=this.getTileCache();if(n.getCount()===0)return t;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=s.getZForResolution(this.renderedResolution),a={};return n.forEach(l=>{if(l.tileCoord[0]!==o||l.getState()!==Q.LOADED)return;const u=l.getSourceTiles();for(let c=0,f=u.length;c<f;++c){const h=u[c],p=h.getKey();if(p in a)continue;a[p]=!0;const d=h.tileCoord;if(Pt(e,s.getTileCoordExtent(d))){const g=h.getFeatures();if(g)for(let y=0,b=g.length;y<b;++y){const m=g[y],w=m.getGeometry();Pt(e,w.getExtent())&&t.push(m)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){var h;const n=this.context,i=n.globalAlpha;n.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[Dt.ANIMATING]||s[Dt.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),u=l?(h=e.declutter)==null?void 0:h[l]:void 0,c=ot(this.getLayer()),f=this.renderedTiles;for(let p=0,d=f.length;p<d;++p){const g=f[p],y=g.executorGroups[c];if(y)for(let b=y.length-1;b>=0;--b)y[b].execute(this.context,a,this.getTileRenderTransform(g,e),e.viewState.rotation,o,da,u)}n.globalAlpha=i}renderDeferredInternal(e){const t=this.renderedTiles,n=ot(this.getLayer()),i=t.reduce((l,u,c)=>(u.executorGroups[n].forEach(f=>l.push({executorGroup:f,index:c})),l),[]),s=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),o={};for(let l=0,u=i.length;l<u;++l){const c=i[l].executorGroup.getDeferredZIndexContexts();for(const f in c)o[f]=!0}Object.keys(o).map(Number).sort(mf).forEach(l=>{s.forEach((u,c)=>{u[l]&&(u[l].forEach(f=>{const{executorGroup:h,index:p}=i[c],d=h.getRenderedContext(),g=d.globalAlpha;d.globalAlpha=this.renderedOpacity_;const y=this.tileClipContexts_[p];y&&y.draw(d),f.draw(d),y&&d.restore(),d.globalAlpha=g,f.clear()}),u[l].length=0)})})}getTileRenderTransform(e,t){const n=t.pixelRatio,i=t.viewState,s=i.center,o=i.resolution,a=i.rotation,l=t.size,u=Math.round(l[0]*n),c=Math.round(l[1]*n),h=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),p=e.tileCoord,d=h.getTileCoordExtent(e.wrappedTileCoord),g=h.getTileCoordExtent(p,this.tempExtent)[0]-d[0];return ds(Ui(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(s,o,a,n,u,c,g))}postRender(e,t){var v;const n=t.viewHints,i=!(n[Dt.ANIMATING]||n[Dt.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),u=l?Ea[o].filter(P=>!da.includes(P)):Ea[o],c=t.viewState,f=c.rotation,h=s.getSource(),d=h.getTileGridForProjection(c.projection).getZForResolution(c.resolution,h.zDirection),g=this.renderedTiles,y=[],b=[],m=[],w=ot(s);let I=!0;for(let P=g.length-1;P>=0;--P){const _=g[P];I=I&&!_.getReplayState(s).dirty;const x=_.executorGroups[w].filter(T=>T.hasExecutors(u));if(x.length===0)continue;const S=this.getTileRenderTransform(_,t),M=_.tileCoord[0];let E=!1;const O=x[0].getClipCoords(S);let j=e,F;if(O){F=new Wf,j=F.getContext();for(let T=0,A=y.length;T<A;++T)if(d!==M&&M<b[T]){const z=y[T];Pt([O[0],O[3],O[4],O[7]],[z[0],z[3],z[4],z[7]])&&(E||(j.save(),E=!0),j.beginPath(),j.moveTo(O[0],O[1]),j.lineTo(O[2],O[3]),j.lineTo(O[4],O[5]),j.lineTo(O[6],O[7]),j.moveTo(z[6],z[7]),j.lineTo(z[4],z[5]),j.lineTo(z[2],z[3]),j.lineTo(z[0],z[1]),j.clip())}y.push(O),b.push(M)}for(let T=0,A=x.length;T<A;++T)x[T].execute(e,[e.canvas.width,e.canvas.height],S,f,i,u,(v=t.declutter)==null?void 0:v[l]);E&&(j===e?j.restore():m[P]=F)}e.globalAlpha=a,this.ready=I,this.tileClipContexts_=m,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,n,i,s,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,u=n.length;l<u;++l)a=pa(i,e,n[l],t,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=pa(i,e,n,t,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const n=e.getReplayState(t),i=t.getRevision(),s=e.wantedResolution;return n.renderedTileResolution!==s||n.renderedTileRevision!==i}renderTileImage_(e,t){const n=this.getLayer(),i=e.getReplayState(n),s=n.getRevision(),o=e.executorGroups[ot(n)];i.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],u=n.getSource();let c=t.pixelRatio;const h=t.viewState.projection,p=u.getTileGridForProjection(h),d=p.getResolution(e.tileCoord[0]),g=t.pixelRatio/e.wantedResolution*d,y=p.getResolution(l),b=e.getContext();c=Math.round(Math.max(c,g/c));const m=u.getTilePixelSize(l,c,h);b.canvas.width=m[0],b.canvas.height=m[1];const w=c/g;if(w!==1){const _=ua(this.tmpTransform_);Ui(_,w,w),b.setTransform.apply(b,_)}const I=p.getTileCoordExtent(a,this.tempExtent),v=g/y,P=ua(this.tmpTransform_);Ui(P,v,-v),bf(P,-I[0],-I[3]);for(let _=0,x=o.length;_<x;++_)o[_].execute(b,[b.canvas.width*w,b.canvas.height*w],P,0,!0,vg[n.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}}class wr extends wf{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const n=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n;const i=e.renderMode||"hybrid";vf(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new xg(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(_n.PRELOAD)}getUseInterimTilesOnError(){return this.get(_n.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(_n.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(_n.USE_INTERIM_TILES_ON_ERROR,e)}}class To extends _u{constructor(e){super(),e=e||{},this.dataProjection=new Dl({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:Jr,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,n,i){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,u=0,c=0,f=0;for(;e.pos<s;){if(!a){const h=e.readVarint();o=h&7,a=h>>3}if(a--,o===1||o===2)l+=e.readSVarint(),u+=e.readSVarint(),o===1&&c>f&&(i.push(c),f=c),n.push(l,u),c+=2;else if(o===7)c>f&&(n.push(n[f],n[f+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>f&&(i.push(c),f=c)}createFeature_(e,t,n){const i=t.type;if(i===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],u=[];this.readRawGeometry_(e,t,l,u);const c=Ig(i,u.length);if(this.featureClass===Jr)s=new this.featureClass(c,l,u,2,o,a),s.transform(n.dataProjection);else{let f;if(c=="Polygon"){const d=xf(l,u);f=d.length>1?new Nl(l,"XY",d):new Ml(l,"XY",u)}else f=c==="Point"?new Fl(l,"XY"):c==="LineString"?new Bl(l,"XY"):c==="MultiPoint"?new Gl(l,"XY"):c==="MultiLineString"?new Ul(l,"XY",u):null;const h=this.featureClass;s=new h,this.geometryName_&&s.setGeometryName(this.geometryName_);const p=pi(f,!1,n);s.setGeometry(p),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const n=this.layers_;t=this.adaptOptions(t);const i=se(t.dataProjection);i.setWorldExtent(t.extent),t.dataProjection=i;const s=new Zf(e),o=s.readFields(_g,{}),a=[];for(const l in o){if(n&&!n.includes(l))continue;const u=o[l],c=u?[0,0,u.extent,u.extent]:null;i.setExtent(c);for(let f=0,h=u.length;f<h;++f){const p=Eg(s,u,f),d=this.createFeature_(s,p,t);d!==null&&a.push(d)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function _g(r,e,t){if(r===3){const n={keys:[],values:[],features:[]},i=t.readVarint()+t.pos;t.readFields(Tg,n,i),n.length=n.features.length,n.length&&(e[n.name]=n)}}function Tg(r,e,t){if(r===15)e.version=t.readVarint();else if(r===1)e.name=t.readString();else if(r===5)e.extent=t.readVarint();else if(r===2)e.features.push(t.pos);else if(r===3)e.keys.push(t.readString());else if(r===4){let n=null;const i=t.readVarint()+t.pos;for(;t.pos<i;)r=t.readVarint()>>3,n=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null;e.values.push(n)}}function Sg(r,e,t){if(r==1)e.id=t.readVarint();else if(r==2){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[i]=s}}else r==3?e.type=t.readVarint():r==4&&(e.geometry=t.pos)}function Eg(r,e,t){r.pos=e.features[t];const n=r.readVarint()+r.pos,i={layer:e,type:0,properties:{}};return r.readFields(Sg,i,n),i}function Ig(r,e){let t;return r===1?t=e===1?"Point":"MultiPoint":r===2?t=e===1?"LineString":"MultiLineString":r===3&&(t="Polygon"),t}var Ye=Uint8Array,mr=Uint16Array,Pg=Int32Array,Au=new Ye([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ru=new Ye([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ag=new Ye([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cu=function(r,e){for(var t=new mr(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Pg(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},Mu=Cu(Au,2),Fu=Mu.b,Rg=Mu.r;Fu[28]=258,Rg[258]=28;var Cg=Cu(Ru,0),Mg=Cg.b,Ps=new mr(32768);for(var le=0;le<32768;++le){var Ot=(le&43690)>>1|(le&21845)<<1;Ot=(Ot&52428)>>2|(Ot&13107)<<2,Ot=(Ot&61680)>>4|(Ot&3855)<<4,Ps[le]=((Ot&65280)>>8|(Ot&255)<<8)>>1}var Zr=function(r,e,t){for(var n=r.length,i=0,s=new mr(e);i<n;++i)r[i]&&++s[r[i]-1];var o=new mr(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new mr(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],c=e-r[i],f=o[r[i]-1]++<<c,h=f|(1<<c)-1;f<=h;++f)a[Ps[f]>>l]=u}else for(a=new mr(n),i=0;i<n;++i)r[i]&&(a[i]=Ps[o[r[i]-1]++]>>15-r[i]);return a},pn=new Ye(288);for(var le=0;le<144;++le)pn[le]=8;for(var le=144;le<256;++le)pn[le]=9;for(var le=256;le<280;++le)pn[le]=7;for(var le=280;le<288;++le)pn[le]=8;var Ou=new Ye(32);for(var le=0;le<32;++le)Ou[le]=5;var Fg=Zr(pn,9,1),Og=Zr(Ou,5,1),Zi=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ut=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Xi=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},kg=function(r){return(r+7)/8|0},Lg=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Ye(r.subarray(e,t))},Dg=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],We=function(r,e,t){var n=new Error(e||Dg[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,We),!t)throw n;return n},So=function(r,e,t,n){var i=r.length,s=0;if(!i||e.f&&!e.l)return t||new Ye(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new Ye(i*3));var u=function(Vt){var Ze=t.length;if(Vt>Ze){var rt=new Ye(Math.max(Ze*2,Vt));rt.set(t),t=rt}},c=e.f||0,f=e.p||0,h=e.b||0,p=e.l,d=e.d,g=e.m,y=e.n,b=i*8;do{if(!p){c=ut(r,f,1);var m=ut(r,f+1,3);if(f+=3,m)if(m==1)p=Fg,d=Og,g=9,y=5;else if(m==2){var P=ut(r,f,31)+257,_=ut(r,f+10,15)+4,x=P+ut(r,f+5,31)+1;f+=14;for(var S=new Ye(x),M=new Ye(19),E=0;E<_;++E)M[Ag[E]]=ut(r,f+E*3,7);f+=_*3;for(var O=Zi(M),j=(1<<O)-1,F=Zr(M,O,1),E=0;E<x;){var T=F[ut(r,f,j)];f+=T&15;var w=T>>4;if(w<16)S[E++]=w;else{var A=0,z=0;for(w==16?(z=3+ut(r,f,3),f+=2,A=S[E-1]):w==17?(z=3+ut(r,f,7),f+=3):w==18&&(z=11+ut(r,f,127),f+=7);z--;)S[E++]=A}}var q=S.subarray(0,P),H=S.subarray(P);g=Zi(q),y=Zi(H),p=Zr(q,g,1),d=Zr(H,y,1)}else We(1);else{var w=kg(f)+4,I=r[w-4]|r[w-3]<<8,v=w+I;if(v>i){l&&We(0);break}a&&u(h+I),t.set(r.subarray(w,v),h),e.b=h+=I,e.p=f=v*8,e.f=c;continue}if(f>b){l&&We(0);break}}a&&u(h+131072);for(var ue=(1<<g)-1,Le=(1<<y)-1,Be=f;;Be=f){var A=p[Xi(r,f)&ue],be=A>>4;if(f+=A&15,f>b){l&&We(0);break}if(A||We(2),be<256)t[h++]=be;else if(be==256){Be=f,p=null;break}else{var C=be-254;if(be>264){var E=be-257,Ke=Au[E];C=ut(r,f,(1<<Ke)-1)+Fu[E],f+=Ke}var Ee=d[Xi(r,f)&Le],ye=Ee>>4;Ee||We(3),f+=Ee&15;var H=Mg[ye];if(ye>3){var Ke=Ru[ye];H+=Xi(r,f)&(1<<Ke)-1,f+=Ke}if(f>b){l&&We(0);break}a&&u(h+131072);var Ve=h+C;if(h<H){var me=s-H,Ce=Math.min(H,Ve);for(me+h<0&&We(3);h<Ce;++h)t[h]=n[me+h]}for(;h<Ve;++h)t[h]=t[h-H]}}e.l=p,e.p=Be,e.b=h,e.f=c,p&&(c=1,e.m=g,e.d=d,e.n=y)}while(!c);return h!=t.length&&o?Lg(t,0,h):t.subarray(0,h)},zg=new Ye(0),jg=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&We(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Ng=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Ug=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&We(6,"invalid zlib data"),(r[1]>>5&1)==1&&We(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Gg(r,e){return So(r,{i:2},e,e)}function Bg(r,e){var t=jg(r);return t+8>r.length&&We(6,"invalid gzip data"),So(r.subarray(t,-8),{i:2},new Ye(Ng(r)),e)}function Vg(r,e){return So(r.subarray(Ug(r),-4),{i:2},e,e)}function qg(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Bg(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Gg(r,e):Vg(r,e)}var $g=typeof TextDecoder<"u"&&new TextDecoder,Hg=0;try{$g.decode(zg,{stream:!0}),Hg=1}catch{}var Kg=Object.defineProperty,Zg=Math.pow,ne=(r,e)=>Kg(r,"name",{value:e,configurable:!0}),Se=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())});ne((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:ne((s,o)=>{let a=document.createElement("img"),l=new AbortController,u=l.signal;return a.cancel=()=>{l.abort()},t||(r.getHeader().then(c=>{c.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):c.tileType===2?n="image/png":c.tileType===3?n="image/jpeg":c.tileType===4?n="image/webp":c.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(s.z,s.x,s.y,u).then(c=>{if(c){let f=new Blob([c.data],{type:n}),h=window.URL.createObjectURL(f);a.src=h}else a.style.display="none";a.cancel=void 0,o(void 0,a)}).catch(c=>{if(c.name!=="AbortError")throw c}),a},"createTile"),_removeTile:ne(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var Xg=ne(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:ne(()=>n.abort(),"cancel")}},"v3compat"),Wg=class{constructor(e){this.tilev4=ne((t,n)=>Se(this,null,function*(){if(t.type==="json"){let p=t.url.substr(10),d=this.tiles.get(p);if(d||(d=new en(p),this.tiles.set(p,d)),this.metadata){let y=yield d.getTileJson(t.url);return n.signal.throwIfAborted(),{data:y}}let g=yield d.getHeader();return n.signal.throwIfAborted(),(g.minLon>=g.maxLon||g.minLat>=g.maxLat)&&console.error(`Bounds of PMTiles archive ${g.minLon},${g.minLat},${g.maxLon},${g.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:g.minZoom,maxzoom:g.maxZoom,bounds:[g.minLon,g.minLat,g.maxLon,g.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new en(o),this.tiles.set(o,a));let l=s[2],u=s[3],c=s[4],f=yield a.getHeader(),h=yield a==null?void 0:a.getZxy(+l,+u,+c,n.signal);if(n.signal.throwIfAborted(),h)return{data:new Uint8Array(h.data),cacheControl:h.cacheControl,expires:h.expires};if(f.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Xg(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};ne(Wg,"Protocol");function ku(r,e){return(e>>>0)*4294967296+(r>>>0)}ne(ku,"toNum");function Lu(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return ku(r,i);throw new Error("Expected varint not more than 10 bytes")}ne(Lu,"readVarintRemainder");function fr(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Lu(n,r))}ne(fr,"readVarint");function Eo(r,e,t,n,i){return i===0?n!==0?[r-1-t,r-1-e]:[t,e]:[e,t]}ne(Eo,"rotate");function Du(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<r||t>=1<<r)throw new Error("tile x/y outside zoom level bounds");let n=((1<<r)*(1<<r)-1)/3,i=r-1,[s,o]=[e,t];for(let a=1<<i;a>0;a>>=1){let l=s&a,u=o&a;n+=(3*l^u)*(1<<i),[s,o]=Eo(a,s,o,l,u),i--}return n}ne(Du,"zxyToTileId");function zu(r){let e=3*r+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}ne(zu,"tileIdToZ");function Yg(r){let e=zu(r)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,n=r-t,i=0,s=0,o=1<<e;for(let a=1;a<o;a<<=1){let l=a&n/2,u=a&(n^l);[i,s]=Eo(a,i,s,l,u),n=n/2,i+=l,s+=u}return[e,i,s]}ne(Yg,"tileIdToZxy");var Jg=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(Jg||{});function gi(r,e){return Se(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return qg(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}ne(gi,"defaultDecompress");var hr=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(hr||{});function ju(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}ne(ju,"tileTypeExt");var Qg=127;function Nu(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,s=e-r[i].tileId;if(s>0)t=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}ne(Nu,"findTile");var ey=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return Se(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};ne(ey,"FileSource");var Uu=class{constructor(e,t=new Headers){var n,i;this.url=e,this.customHeaders=t,this.mustReload=!1;let s="";"navigator"in globalThis&&(s=(i=(n=globalThis.navigator)==null?void 0:n.userAgent)!=null?i:"");let o=s.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(s);this.chromeWindowsNoCache=!1,o&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return Se(this,null,function*(){let s,o;n?o=n:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&u.status===416){let h=u.headers.get("Content-Range");if(!h||!h.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let p=+h.substr(8);u=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${p-1}`}})}let c=u.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),u.status===416||i&&c&&c!==i)throw this.mustReload=!0,new As(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let f=u.headers.get("Content-Length");if(u.status===200&&(!f||+f>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:c||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};ne(Uu,"FetchSource");var ty=Uu;function it(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Zg(2,32)+n}ne(it,"getUint64");function Gu(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:it(t,8),rootDirectoryLength:it(t,16),jsonMetadataOffset:it(t,24),jsonMetadataLength:it(t,32),leafDirectoryOffset:it(t,40),leafDirectoryLength:it(t,48),tileDataOffset:it(t,56),tileDataLength:it(t,64),numAddressedTiles:it(t,72),numTileEntries:it(t,80),numTileContents:it(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}ne(Gu,"bytesToHeader");function Io(r){let e={buf:new Uint8Array(r),pos:0},t=fr(e),n=[],i=0;for(let s=0;s<t;s++){let o=fr(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)n[s].runLength=fr(e);for(let s=0;s<t;s++)n[s].length=fr(e);for(let s=0;s<t;s++){let o=fr(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}ne(Io,"deserializeIndex");var Bu=class extends Error{};ne(Bu,"EtagMismatch");var As=Bu;function Po(r,e){return Se(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,Qg),i=Gu(n,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=Io(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}ne(Po,"getHeaderAndRoot");function Ao(r,e,t,n,i){return Se(this,null,function*(){let s=yield r.getBytes(t,n,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=Io(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}ne(Ao,"getDirectory");var ry=class{constructor(e=100,t=!0,n=gi){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return Se(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield Po(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return Se(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield Ao(e,this.decompress,t,n,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return Se(this,null,function*(){this.cache.delete(e.getKey())})}};ne(ry,"ResolvedValueCache");var Vu=class{constructor(e=100,t=!0,n=gi){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return Se(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((s,o)=>{Po(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return Se(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,u)=>{Ao(e,this.decompress,t,n,i).then(c=>{l(c),this.prune()}).catch(c=>{u(c)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return Se(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,n)})}};ne(Vu,"SharedPromiseCache");var ny=Vu,qu=class{constructor(e,t,n){typeof e=="string"?this.source=new ty(e):this.source=e,n?this.decompress=n:this.decompress=gi,t?this.cache=t:this.cache=new ny}getHeader(){return Se(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return Se(this,null,function*(){let s=Du(e,t,n),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let u=0;u<=3;u++){let c=yield this.cache.getDirectory(this.source,a,l,o),f=Nu(c,s);if(f){if(f.runLength>0){let h=yield this.source.getBytes(o.tileDataOffset+f.offset,f.length,i,o.etag);return{data:yield this.decompress(h.data,o.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}a=o.leafDirectoryOffset+f.offset,l=f.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return Se(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(s){if(s instanceof As)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw s}})}getMetadataAttempt(){return Se(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return Se(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof As)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return Se(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=ju(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};ne(qu,"PMTiles");var en=qu,$u=Object.defineProperty,Ia=Object.getOwnPropertySymbols,iy=Object.prototype.hasOwnProperty,sy=Object.prototype.propertyIsEnumerable,Pa=(r,e,t)=>e in r?$u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qn=(r,e)=>{for(var t in e||(e={}))iy.call(e,t)&&Pa(r,t,e[t]);if(Ia)for(var t of Ia(e))sy.call(e,t)&&Pa(r,t,e[t]);return r},yi=(r,e)=>$u(r,"name",{value:e,configurable:!0}),oy=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())}),Hu=class extends ql{constructor(e){super(qn(qn({},e),{state:"loading"})),this.loadImage=yi(n=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=n}),"loadImage");const t=new en(e.url);t.getHeader().then(n=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||fn({extent:ui(i),maxResolution:e.maxResolution,minZoom:n.minZoom,maxZoom:n.maxZoom,tileSize:e.tileSize}),this.setLoader((s,o,a)=>oy(this,null,function*(){const l=yield t.getZxy(s,o,a);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),c=yield this.loadImage(u);return URL.revokeObjectURL(u),c})),this.setState("ready")})}};yi(Hu,"PMTilesRasterSource");var Aa=Hu,Ku=class extends dn{constructor(e){super(qn(qn({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new To})),this.tileLoadFunction=yi((t,n)=>{const i=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),o=n.match(s);if(!(o&&o.length>=4))throw Error("Could not parse tile URL");const a=+o[1],l=+o[2],u=+o[3];i.setLoader((c,f,h)=>{this.pmtiles_.getZxy(a,l,u).then(p=>{if(p){const d=i.getFormat();i.setFeatures(d.readFeatures(p.data,{extent:c,featureProjection:h})),i.setState(Q.LOADED)}else i.setFeatures([]),i.setState(Q.EMPTY)}).catch(p=>{i.setFeatures([]),i.setState(Q.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new en(e.url),this.pmtiles_.getHeader().then(t=>{const n=e.projection||"EPSG:3857",i=e.extent||ui(n);this.tileGrid=e.tileGrid||fn({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};yi(Ku,"PMTilesVectorSource");var ay=Ku;class ly extends Hs{constructor(e){super(sr.ERROR),this.error=e}}const uy="https://stac-extensions.github.io/label/v1.*/schema.json",Zu=new gr({color:"rgba(0,0,0,0)"});function Xu(r,e,t="rgba(255,255,255,0.4)",n=5){let i=Zu;t&&(i=new gr({color:t}));const s=new Vr({color:r,width:e});return new Kt({image:new zl({fill:i,stroke:s,radius:n}),fill:i,stroke:s})}const cy=Xu("#3399CC",3),Ra=Xu("#ff9933",2,null);function fy(r,e){const t={url:r.getAbsoluteUrl()};let n=r,i=r.getBands();i.length===1&&(n=i[0],i=[]);const{minimum:s,maximum:o}=n.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof o=="number"&&(t.max=o),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:u,maximum:c}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof c=="number"&&(typeof t.max>"u"||c>t.max)&&(t.max=c)}const a=n.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const u of i){const c=u.getNoDataValues();if(c.length>0){if(typeof l>"u")l=c[0];else if(l!==c[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=r.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function hy(r){try{const{fromProjectionCode:e,fromEPSGCode:t}=await Ct(async()=>{const{fromProjectionCode:n,fromEPSGCode:i}=await import("./proj4.Bo6rV-Sx.js");return{fromProjectionCode:n,fromEPSGCode:i}},__vite__mapDeps([19,9,10]));return typeof e=="function"?await e(r):await t(r)}catch{return null}}async function Ca(r,e=void 0){return void 0||e}function Ma(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(Zu),t}function dy(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}function Fa(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"}function py(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function gy(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=qe;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const Oa="STATISTICS_MAXIMUM",ka="STATISTICS_MINIMUM",Wi=256;let Yi;function yy(){return Yi||(Yi=new rd),Yi}function my(r){try{return r.getBoundingBox(!0)}catch{return[0,0,r.getWidth(),r.getHeight()]}}function by(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function wy(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}async function La(r,e,t,n){const i=r[e];if(i&&i!==32767){const s="EPSG:"+i;let o=se(s);if(!o&&n&&(o=await hy(s)),!o){const a=If(r[t]);a&&(o=new Dl({code:s,units:a}))}return o||null}}async function vy(r,e){const t=r.geoKeys;if(!t)return null;const n=await La(t,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",e);return n||await La(t,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",e)}function xy(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function _y(r,e){let t;return r.blob?t=Ad(r.blob):r.overviews?t=Rd(r.url,r.overviews,e):t=Pd(r.url,e),t.then(xy)}function qr(r,e,t,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)qr(r[o],e[o],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function Ty(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function Sy(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class Wu extends ql{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=_y(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){return n.configure_(s)}).catch(function(s){ca(s),n.error_=s,n.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],s=await vy(i,this.loadMissingProjection_);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const s=t[n].fileDirectory.ModelTransformation;if(s){const[o,a,l,u,c,f,h,p]=s,d=ds(ds([1/Math.sqrt(o*o+c*c),0,0,-1/Math.sqrt(a*a+f*f),u,p],[o,c,a,f,0,0]),[1,0,0,1,-u,-p]);this.transformMatrix=d,this.addAlpha_=!0;break}}}async configure_(e){let t,n,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let c=0;const f=e.length;for(let y=0;y<f;++y){const b=[],m=[];e[y].forEach(S=>{py(S)?m.push(S):b.push(S)});const w=b.length;if(m.length>0&&m.length!==w)throw new Error(`Expected one mask per image found ${m.length} masks and ${w} images`);let I,v;const P=new Array(w),_=new Array(w),x=new Array(w);l[y]=new Array(w),u[y]=new Array(w);for(let S=0;S<w;++S){const M=b[S],E=M.getGDALNoData();u[y][S]=M.getGDALMetadata(0),l[y][S]=E;const O=this.sourceInfo_[y].bands;a[y]=O?O.length:M.getSamplesPerPixel();const j=w-(S+1);I||(I=my(M)),v||(v=by(M));const F=wy(M,b[0]);x[j]=F[0];const T=[M.getTileWidth(),M.getTileHeight()];T[0]!==T[1]&&T[1]<Wi&&(T[0]=Wi,T[1]=Wi),P[j]=T;const A=F[0]/Math.abs(F[1]);_[j]=[T[0],T[1]/A]}if(t?cn(t,I,t):t=I,!n)n=v;else{const S=`Origin mismatch for source ${y}, got [${v}] but expected [${n}]`;qr(n,v,0,S,this.viewRejector)}if(!o)o=x,this.resolutionFactors_[y]=1;else{o.length-c>x.length&&(c=o.length-x.length);const S=o[o.length-1]/x[x.length-1];this.resolutionFactors_[y]=S;const M=x.map(O=>O*=S),E=`Resolution mismatch for source ${y}, got [${M}] but expected [${o}]`;qr(o.slice(c,o.length),M,.02,E,this.viewRejector)}i?qr(i.slice(c,i.length),_,.01,`Tile size mismatch for source ${y}`,this.viewRejector):i=_,s?qr(s.slice(c,s.length),P,0,`Tile size mismatch for source ${y}`,this.viewRejector):s=P,this.sourceImagery_[y]=b.reverse(),this.sourceMasks_[y]=m.reverse()}for(let y=0,b=this.sourceImagery_.length;y<b;++y){const m=this.sourceImagery_[y];for(;m.length<o.length;)m.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let y=0;y<f;++y){if(this.sourceInfo_[y].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[y].length){this.addAlpha_=!0;break}const b=l[y],m=this.sourceInfo_[y].bands;if(m){for(let w=0;w<m.length;++w)if(b[m[w]-1]!==null){this.addAlpha_=!0;break e}continue}for(let w=0;w<b.length;++w)if(b[w]!==null){this.addAlpha_=!0;break e}}let h=this.addAlpha_?1:0;for(let y=0;y<f;++y)h+=a[y];this.bandCount=h;const p=new Ks({extent:t,minZoom:c,origin:n,resolutions:o,tileSizes:i});this.tileGrid=p,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const d=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const y=_f(Nn(),this.transformMatrix.slice()),b=Pf(m=>Zs(y,m));g=Cl(t,b)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:Sf(Ar(g),this.projection),extent:Tf(g,this.projection),zoom:d})}loadTile_(e,t,n,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,u=this.sourceInfo_,c=yy();for(let f=0;f<o;++f){const h=u[f],p=this.resolutionFactors_[f],d=[Math.round(t*(s[0]*p)),Math.round(n*(s[1]*p)),Math.round((t+1)*(s[0]*p)),Math.round((n+1)*(s[1]*p))],g=this.sourceImagery_[f][e];let y;h.bands&&(y=h.bands.map(function(v){return v-1}));let b;"nodata"in h&&h.nodata!==null?b=h.nodata:y?b=y.map(function(v){return l[f][v]}):b=l[f];const m={window:d,width:s[0],height:s[1],samples:y,fillValue:b,pool:c,interleave:!1,signal:i.signal};gy(this.convertToRGB_,g)?a[f]=g.readRGB(m):a[f]=g.readRasters(m);const w=o+f,I=this.sourceMasks_[f][e];if(!I){a[w]=Promise.resolve(null);continue}a[w]=I.readRasters({window:d,width:s[0],height:s[1],samples:[0],pool:c,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(f){throw ca(f),f})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,c=this.addAlpha_,f=e[0]*e[1],h=f*o;let p;u?p=new Uint8Array(h):p=new Float32Array(h);let d=0;for(let g=0;g<f;++g){let y=c;for(let b=0;b<s;++b){const m=i[b];let w=m.min,I=m.max,v,P;if(u){const _=n[b][0];w===void 0&&(_&&ka in _?w=parseFloat(_[ka]):w=Ty(t[b][0])),I===void 0&&(_&&Oa in _?I=parseFloat(_[Oa]):I=Sy(t[b][0])),v=255/(I-w),P=-w*v}for(let _=0;_<a[b];++_){const x=t[b][_][g];let S;if(u?S=Ef(v*x+P,0,255):S=x,!c)p[d]=S;else{let M=m.nodata;if(M===void 0){let O;m.bands?O=m.bands[_]-1:O=_,M=l[b][O]}const E=isNaN(M);(!E&&x!==M||E&&!isNaN(x))&&(y=!1,p[d]=S)}d++}if(!y){const _=s+b,x=t[_];x&&!x[0][g]&&(y=!0)}}c&&(y||(p[d]=255),d++)}return p}}Wu.prototype.getView;class ae{constructor(e){this.name=e}toString(){return this.name}}ae.GeoTIFF=new ae("GeoTIFF");ae.ImageStatic=new ae("ImageStatic");ae.PMTilesRaster=new ae("PMTilesRaster");ae.PMTilesVector=new ae("PMTilesVector");ae.TileJSON=new ae("TileJSON");ae.TileWMS=new ae("TileWMS");ae.WMTS=new ae("WMTS");ae.XYZ=new ae("XYZ");class Yu extends jl{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||cy,this.collectionStyle_=e.collectionStyle||Ra,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(n=>this.configure_(n,e.url,e.children,e.assets,e.bands)).catch(n=>this.handleError_(n))}async fetch_(e,t="json"){const n=await fetch(e);if(!n.ok)throw new Error(`Unexpected response from ${e}: ${n.status}`);return t==="json"?await n.json():t==="text"?await n.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const n=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!n||$s(n)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new ly(e))}configure_(e,t=null,n=null,i=null,s=[]){let o;e instanceof Tn||e instanceof Nr?o=e:(o=En(e,!this.disableMigration_),t&&t.includes("://")&&o.setAbsoluteUrl(t)),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Ma(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=c=>this.handleError_(c),u=[];n&&u.push(this.setChildren(n,null,!1).catch(l)),i&&u.push(this.setAssets(i,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const n=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new Yu(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(n)}async addPreviewImage_(e){const t=await Ca(e,"EPSG:4326"),n=e.getContext().getBoundingBoxes();if(n.length!==1)return;const i=n[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:Yt(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(ae.ImageStatic,s,e));const o=new di({source:new Ld(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=dy(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new en(n.url).getHeader();let l;switch(a.tileType){case hr.Mvt:l=new ay(await i(ae.PMTilesVector,n));break;case hr.Avif:case hr.Jpeg:case hr.Png:case hr.Webp:l=new Aa(await i(ae.PMTilesRaster,n));break;default:return}s.push(l);break;case"tilejson":s.push(new mo(await i(ae.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const f in e["wms:layers"]){const h=e["wms:layers"][f]||"";let p="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][f]=="string"&&(p=e["wms:styles"][f]);const d=Object.assign({LAYERS:h,STYLES:p},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(d.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(d.FORMAT=e.type);const g=await i(ae.TileWMS,Object.assign({},n,{params:d}));s.push(new Kd(g))}break;case"wmts":const u=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!u)return;let c=[];Array.isArray(e["wmts:layer"])?c=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(c=[e["wmts:layer"]]);for(const f of c){let h=Object.assign({},n,{layer:f,requestEncoding:e["wmts:encoding"]==="rest"?"REST":"KVP"});typeof e.type=="string"&&e.type.startsWith("image/")&&(h.format=e.type),h=await i(ae.WMTS,h);const p=Xd(u,h);if(p!==null){if(typeof e.uriTemplate=="string"){let d=e.uriTemplate;const g=Bi(e.variables)?e.variables:{};for(const y in g){const b=g[y];let m;if(Fa(b.const)?m=b.const:Fa(b.default)?m=b.default:Array.isArray(b.enum)&&b.enum.length>0&&(m=b.enum[0]),typeof m<"u")d=d.replaceAll(`{${y}}`,String(m));else continue}delete p.urls,p.url=d}s.push(new Zd(p))}}break;case"xyz":s.push(new fa(await i(ae.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof dn?a=new wr({source:o,declutter:!0}):o instanceof Aa?a=new ga({source:o}):a=new Bn({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[fy(e,this.bands_)],convertToRGB:"auto",loadMissingProjection:!0};const i=await Ca();i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(ae.GeoTIFF,n,e));const s=new Wu(n),o=new Promise((a,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):a()})});try{await o;const a=new ga({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let n={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(n=await this.getSourceOptions_(ae.XYZ,n,e));const i=new Bn({source:new fa(n)});return this.addLayer_(i,e),i}addLayer_(e,t=null,n=0){t&&e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Hf(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=this.createGeoJsonLayer_(e,Ma(this.boundsStyle_,this),this.displayFootprint_);return n.set("bounds",!0),n.on("change",()=>this.setMap_(n.getMapInternal())),this.addLayer_(n,t,1),n}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),n=this.createGeoJsonLayer_(t);return this.addLayer_(n,e),n}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,n=!0){const i=new Ts,s=new Hr({format:i,loader:(o,a,l)=>{e=Kf(e);const u=i.readFeatures(e,{featureProjection:l});s.addFeatures(u)}});return t||(t=Ra),new fi({source:s,style:t,visible:n})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Vn))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),n;t.length>1&&(n=t.find(s=>s.roles.includes("labels-vector"))),n||(n=e.getAsset("vector_labels")),n||(t=e.getAssets().filter(s=>s.type===ya&&!s.roles),t.length===1&&(n=t[0]));const i=e.getLinksWithRels(["source"]);if(n&&i.length>0){const s=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return En(l)}catch(l){return this.handleError_(l),null}}),o=(await Promise.all(s)).filter(a=>a instanceof Nr);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(n)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const o=t.item(s);o.get("stac")&&!o.get("bounds")&&t.removeAt(s)}const n=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async o=>await this.addLayerForLink(o));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const s=i.map(async o=>{if(o){if(o.type===ya)return await this.addGeoJson_(o);if(o.isGeoTIFF())return await this.addGeoTiff_(o);if(o.canBrowserDisplayImage())return await this.addPreviewImage_(o)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(n instanceof bo)await this.addChildren_(n.getAll(),this.childrenOptions_);else if(n instanceof Nr){if(n.isItem()&&n.supportsExtension(uy)&&n.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const o=n.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(o&&this.displayOverview_&&(a=await this.addGeoTiff_(o)),this.displayPreview_&&(!o||!a)){const l=n.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof Tn)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let n=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?n=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=n.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):n.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),n}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const n=this.getData();this.assets_=e.map(i=>n instanceof Nr&&typeof i=="string"?n.getAsset(i):i instanceof Tn?i:new Tn(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,n=!0){e instanceof xu?this.children_=e.getAll():e instanceof vu?this.children_=e.getAll():Bi(e)&&e.type==="FeatureCollection"?this.children_=En(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof Nr?i:En(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&Bi(t)&&(this.childrenOptions_=t),n&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const n=this.getData();n&&(t=n.getBoundingBox());const i=this.getChildren();if(i){const s=i.map(o=>o.getBoundingBox());t=Ys(s)}if(t)return Yt(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const n=t.getMetadata("attribution");n&&n.push(n)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const n=new URL(e);t!=="rest"&&(n.searchParams.set("service","wmts"),n.searchParams.set("request","GetCapabilities"));const i=await this.fetch_(n.toString(),"text");return new Jp().read(i)}catch{return null}}}var Ey=8,Iy={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},Py={"*":{type:"source"}},Ay=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],Ry={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Cy={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},My={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Fy={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},Oy={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},ky={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Ly={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Dy=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],zy={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jy={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Ny={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Uy={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Gy={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},By={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Vy={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},qy={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$y={type:"array",value:"*"},Hy={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Ky={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},Zy={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},Xy={type:"array",value:"*",minimum:1},Wy={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Yy={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Jy={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},Qy={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},em=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],tm={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},rm={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},nm={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},im={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},sm={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},om={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},am={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},lm={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},um={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},cm={"*":{type:"string"}},fm={$version:Ey,$root:Iy,sources:Py,source:Ay,source_vector:Ry,source_raster:Cy,source_raster_dem:My,source_geojson:Fy,source_video:Oy,source_image:ky,layer:Ly,layout:Dy,layout_background:zy,layout_fill:jy,layout_circle:Ny,layout_heatmap:Uy,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Gy,layout_symbol:By,layout_raster:Vy,layout_hillshade:qy,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:$y,filter_operator:Hy,geometry_type:Ky,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:Zy,expression:Xy,light:Wy,sky:Yy,terrain:Jy,projection:Qy,paint:em,paint_fill:tm,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:rm,paint_circle:nm,paint_heatmap:im,paint_symbol:sm,paint_raster:om,paint_hillshade:am,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:lm,transition:um,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:cm};const hm=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dm(r,e){const t={};for(const n in r)n!=="ref"&&(t[n]=r[n]);return hm.forEach(n=>{n in e&&(t[n]=e[n])}),t}function Ju(r){r=r.slice();const e=Object.create(null);for(let t=0;t<r.length;t++)e[r[t].id]=r[t];for(let t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=dm(r[t],e[r[t].ref]));return r}class vt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Ro{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Ro(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const mi={kind:"null"},R={kind:"number"},V={kind:"string"},G={kind:"boolean"},_t={kind:"color"},bi={kind:"projectionDefinition"},Jt={kind:"object"},U={kind:"value"},pm={kind:"error"},wi={kind:"collator"},vi={kind:"formatted"},xi={kind:"padding"},tn={kind:"colorArray"},_i={kind:"numberArray"},gn={kind:"resolvedImage"},Ti={kind:"variableAnchorOffsetCollection"};function Je(r,e){return{kind:"array",itemType:r,N:e}}function fe(r){if(r.kind==="array"){const e=fe(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}else return r.kind}const gm=[mi,R,V,G,_t,bi,vi,Jt,Je(U),xi,_i,tn,gn,Ti];function rn(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!rn(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of gm)if(!rn(t,e))return null}}return`Expected ${fe(r)} but found ${fe(e)} instead.`}function Co(r,e){return e.some(t=>t.kind===r.kind)}function Qt(r,e){return e.some(t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r)}function kt(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Qu=.96422,ec=1,tc=.82521,rc=4/29,vr=6/29,nc=3*vr*vr,ym=vr*vr*vr,mm=Math.PI/180,bm=180/Math.PI;function ic(r){return r=r%360,r<0&&(r+=360),r}function sc([r,e,t,n]){r=Ji(r),e=Ji(e),t=Ji(t);let i,s;const o=Qi((.2225045*r+.7168786*e+.0606169*t)/ec);r===e&&e===t?i=s=o:(i=Qi((.4360747*r+.3850649*e+.1430804*t)/Qu),s=Qi((.0139322*r+.0971045*e+.7141733*t)/tc));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),n]}function Ji(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Qi(r){return r>ym?Math.pow(r,1/3):r/nc+rc}function oc([r,e,t,n]){let i=(r+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=ec*ts(i),s=Qu*ts(s),o=tc*ts(o),[es(3.1338561*s-1.6168667*i-.4906146*o),es(-.9787684*s+1.9161415*i+.033454*o),es(.0719453*s-.2289914*i+1.4052427*o),n]}function es(r){return r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055,r<0?0:r>1?1:r}function ts(r){return r>vr?r*r*r:nc*(r-rc)}function wm(r){const[e,t,n,i]=sc(r),s=Math.sqrt(t*t+n*n);return[Math.round(s*1e4)?ic(Math.atan2(n,t)*bm):NaN,s,e,i]}function vm([r,e,t,n]){return r=isNaN(r)?0:r*mm,oc([t,Math.cos(r)*e,Math.sin(r)*e,n])}function xm([r,e,t,n]){r=ic(r),e/=100,t/=100;function i(s){const o=(s+r/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),n]}const _m=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function ac(r,e){return _m(r,e)?r[e]:void 0}function Tm(r){if(r=r.toLowerCase().trim(),r==="transparent")return[0,0,0,0];const e=ac(Sm,r);if(e){const[i,s,o]=e;return[i/255,s/255,o/255,1]}if(r.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(r)){const s=r.length<6?1:2;let o=1;return[Pn(r.slice(o,o+=s)),Pn(r.slice(o,o+=s)),Pn(r.slice(o,o+=s)),Pn(r.slice(o,o+s)||"ff")]}if(r.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=r.match(i);if(s){const[o,a,l,u,c,f,h,p,d,g,y,b]=s,m=[u||" ",h||" ",g].join("");if(m==="  "||m==="  /"||m===",,"||m===",,,"){const w=[l,f,d].join(""),I=w==="%%%"?100:w===""?255:0;if(I){const v=[dr(+a/I,0,1),dr(+c/I,0,1),dr(+p/I,0,1),y?Da(+y,b):1];if(za(v))return v}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=r.match(t);if(n){const[i,s,o,a,l,u,c,f,h]=n,p=[o||" ",l||" ",c].join("");if(p==="  "||p==="  /"||p===",,"||p===",,,"){const d=[+s,dr(+a,0,100),dr(+u,0,100),f?Da(+f,h):1];if(za(d))return xm(d)}}}function Pn(r){return parseInt(r.padEnd(2,r),16)/255}function Da(r,e){return dr(e?r/100:r,0,1)}function dr(r,e,t){return Math.min(Math.max(e,r),t)}function za(r){return!r.some(Number.isNaN)}const Sm={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function er(r,e,t){return r+t*(e-r)}function nn(r,e,t){return r.map((n,i)=>er(n,e[i],t))}class ee{constructor(e,t,n,i=1,s=!0){this.r=e,this.g=t,this.b=n,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof ee)return e;if(typeof e!="string")return;const t=Tm(e);if(t)return new ee(...t,!1)}get rgb(){const{r:e,g:t,b:n,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,n/s,i])}get hcl(){return this.overwriteGetter("hcl",wm(this.rgb))}get lab(){return this.overwriteGetter("lab",sc(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(e,t,n,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=nn(e.rgb,t.rgb,n);return new ee(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=e.hcl,[u,c,f,h]=t.hcl;let p,d;if(!isNaN(s)&&!isNaN(u)){let w=u-s;u>s&&w>180?w-=360:u<s&&s-u>180&&(w+=360),p=s+n*w}else isNaN(s)?isNaN(u)?p=NaN:(p=u,(a===1||a===0)&&(d=c)):(p=s,(f===1||f===0)&&(d=o));const[g,y,b,m]=vm([p,d??er(o,c,n),er(a,f,n),er(l,h,n)]);return new ee(g,y,b,m,!1)}case"lab":{const[s,o,a,l]=oc(nn(e.lab,t.lab,n));return new ee(s,o,a,l,!1)}}}}ee.black=new ee(0,0,0,1);ee.white=new ee(1,1,1,1);ee.transparent=new ee(0,0,0,0);ee.red=new ee(1,0,0,1);class Mo{constructor(e,t,n){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Em=["bottom","center","top"];class Rs{constructor(e,t,n,i,s,o){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=s,this.verticalAlign=o}}class At{constructor(e){this.sections=e}static fromString(e){return new At([new Rs(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof At?e:At.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ht{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ht)return e;if(typeof e=="number")return new ht([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ht(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new ht(nn(e.values,t.values,n))}}class dt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof dt)return e;if(typeof e=="number")return new dt([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new dt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new dt(nn(e.values,t.values,n))}}class et{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof et)return e;if(typeof e=="string"){const n=ee.parse(e);return n?new et([n]):void 0}if(!Array.isArray(e))return;const t=[];for(const n of e){if(typeof n!="string")return;const i=ee.parse(n);if(!i)return;t.push(i)}return new et(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n,i="rgb"){const s=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)s.push(ee.interpolate(e.values[o],t.values[o],n,i));return new et(s)}}class de extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Im=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Tt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Tt)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if(typeof n!="string"||!Im.has(n)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new Tt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const i=e.values,s=t.values;if(i.length!==s.length)throw new de(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new de(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,u]=i[a+1],[c,f]=s[a+1];o.push([er(l,c,n),er(u,f,n)])}return new Tt(o)}}class Bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Bt({name:e,available:!1}):null}}class ct{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new ct(e,t,n)}static parse(e){if(e instanceof ct)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new ct(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new ct(e.from,e.to,e.transition);if(typeof e=="string")return new ct(e,e,1)}}function lc(r,e,t,n){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ct||r instanceof ee||r instanceof Mo||r instanceof At||r instanceof ht||r instanceof dt||r instanceof et||r instanceof Tt||r instanceof Bt)return!0;if(Array.isArray(r)){for(const e of r)if(!sn(e))return!1;return!0}else if(typeof r=="object"){for(const e in r)if(!sn(r[e]))return!1;return!0}else return!1}function ve(r){if(r===null)return mi;if(typeof r=="string")return V;if(typeof r=="boolean")return G;if(typeof r=="number")return R;if(r instanceof ee)return _t;if(r instanceof ct)return bi;if(r instanceof Mo)return wi;if(r instanceof At)return vi;if(r instanceof ht)return xi;if(r instanceof dt)return _i;if(r instanceof et)return tn;if(r instanceof Tt)return Ti;if(r instanceof Bt)return gn;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=ve(n);if(!t)t=i;else{if(t===i)continue;t=U;break}}return Je(t||U,e)}else return Jt}function Xr(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ee||r instanceof ct||r instanceof At||r instanceof ht||r instanceof dt||r instanceof et||r instanceof Tt||r instanceof Bt?r.toString():JSON.stringify(r)}class Er{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!sn(e[1]))return t.error("invalid value");const n=e[1];let i=ve(n);const s=t.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new Er(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const An={string:V,number:R,boolean:G,object:Jt};class ft{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=1,i;const s=e[0];if(s==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in An)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=An[u],n++}else a=U;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],n++}i=Je(a,l)}else{if(!An[s])throw new Error(`Types doesn't contain name = ${s}`);i=An[s]}const o=[];for(;n<e.length;n++){const a=t.parse(e[n],n,U);if(!a)return null;o.push(a)}return new ft(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(rn(this.type,ve(n))){if(t===this.args.length-1)throw new de(`Expected value to be of type ${fe(this.type)}, but found ${fe(ve(n))} instead.`)}else return n}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ja={"to-boolean":G,"to-color":_t,"to-number":R,"to-string":V};class Nt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!ja[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=ja[n],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,U);if(!a)return null;s.push(a)}return new Nt(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof ee)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?n=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:n=lc(t[0],t[1],t[2],t[3]),!n))return new ee(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new de(n||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=ht.parse(t);if(i)return i}throw new de(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=dt.parse(t);if(i)return i}throw new de(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=et.parse(t);if(i)return i}throw new de(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=Tt.parse(t);if(i)return i}throw new de(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new de(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return At.fromString(Xr(this.args[0].evaluate(e)));case"resolvedImage":return Bt.fromString(Xr(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Xr(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Pm=["Unknown","Point","LineString","Polygon"];class uc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=ee.parse(e),this._parseColorCache.set(e,t)),t}}class Si{constructor(e,t,n=[],i,s=new Ro,o=[]){this.registry=e,this.path=n,this.key=n.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,s={}){return t?this.concat(t,n,i)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function n(i,s,o){return o==="assert"?new ft(s,[i]):o==="coerce"?new Nt(s,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=n(o,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=n(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof Er)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new uc;try{o=new Er(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i=typeof e=="number"?this.path.concat(e):this.path,s=n?this.scope.concat(n):this.scope;return new Si(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const n=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new vt(n,e))}checkSubtype(e,t){const n=rn(e,t);return n&&this.error(n),n}}class Ei{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;n.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Ei(n,i):null}outputDefined(){return this.result.outputDefined()}}class Ii{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Ii(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Fo{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,R),i=t.parse(e[2],2,Je(t.expectedType||U));if(!n||!i)return null;const s=i.type;return new Fo(s.itemType,n,i)}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new de(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new de(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new de(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Oo{constructor(e,t){this.type=G,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,U),i=t.parse(e[2],2,U);return!n||!i?null:Co(n.type,[G,V,R,mi,U])?new Oo(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${fe(n.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Qt(t,["boolean","string","number","null"]))throw new de(`Expected first argument to be of type boolean, string, number or null, but found ${fe(ve(t))} instead.`);if(!Qt(n,["string","array"]))throw new de(`Expected second argument to be of type array or string, but found ${fe(ve(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class $n{constructor(e,t,n){this.type=R,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,U),i=t.parse(e[2],2,U);if(!n||!i)return null;if(!Co(n.type,[G,V,R,mi,U]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${fe(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,R);return s?new $n(n,i,s):null}else return new $n(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Qt(t,["boolean","string","number","null"]))throw new de(`Expected first argument to be of type boolean, string, number or null, but found ${fe(ve(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),Qt(n,["string"])){const s=n.indexOf(t,i);return s===-1?-1:[...n.slice(0,s)].length}else{if(Qt(n,["array"]))return n.indexOf(t,i);throw new de(`Expected second argument to be of type array or string, but found ${fe(ve(n))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ko{constructor(e,t,n,i,s,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const f=e[u+1];Array.isArray(c)||(c=[c]);const h=t.concat(u);if(c.length===0)return h.error("Expected at least one branch label.");for(const d of c){if(typeof d!="number"&&typeof d!="string")return h.error("Branch labels must be numbers or strings.");if(typeof d=="number"&&Math.abs(d)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof d=="number"&&Math.floor(d)!==d)return h.error("Numeric branch labels must be integer values.");if(!n)n=ve(d);else if(h.checkSubtype(n,ve(d)))return null;if(typeof s[String(d)]<"u")return h.error("Branch labels must be unique.");s[String(d)]=o.length}const p=t.parse(f,u,i);if(!p)return null;i=i||p.type,o.push(p)}const a=t.parse(e[1],1,U);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(n,a.type)?null:new ko(n,i,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(ve(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Lo{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,G);if(!a)return null;const l=t.parse(e[o+1],o+1,n);if(!l)return null;i.push([a,l]),n=n||l.type}const s=t.parse(e[e.length-1],e.length-1,n);if(!s)return null;if(!n)throw new Error("Can't infer output type");return new Lo(n,i,s)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class Hn{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,U),i=t.parse(e[2],2,R);if(!n||!i)return null;if(!Co(n.type,[Je(U),V,U]))return t.error(`Expected first argument to be of type array or string, but found ${fe(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,R);return s?new Hn(n.type,n,i,s):null}else return new Hn(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),Qt(t,["string"]))return[...t].slice(n,i).join("");if(Qt(t,["array"]))return t.slice(n,i);throw new de(`Expected first argument to be of type array or string, but found ${fe(ve(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function cc(r,e){const t=r.length-1;let n=0,i=t,s=0,o,a;for(;n<=i;)if(s=Math.floor((n+i)/2),o=r[s],a=r[s+1],o<=e){if(s===t||e<a)return s;n=s+1}else if(o>e)i=s-1;else throw new de("Input is not a number.");return 0}class Pi{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of n)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,R);if(!n)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const f=t.parse(l,c,s);if(!f)return null;s=s||f.type,i.push([a,f])}return new Pi(s,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const o=cc(t,i);return n[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Am(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var rs,Na;function Rm(){if(Na)return rs;Na=1,rs=r;function r(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var s=this.sampleCurveX(n)-e;if(Math.abs(s)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n=n-s/o}var a=0,l=1;for(n=e,i=0;i<20&&(s=this.sampleCurveX(n),!(Math.abs(s-e)<t));i++)e>s?a=n:l=n,n=(l-a)*.5+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},rs}var Cm=Rm(),Mm=Am(Cm);class St{constructor(e,t,n,i,s){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let s=0;if(e.name==="exponential")s=ns(t,e.base,n,i);else if(e.name==="linear")s=ns(t,1,n,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new Mm(o[0],o[1],o[2],o[3]).solve(ns(t,1,n,i))}return s}static parse(e,t){let[n,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,R),!s)return null;const a=[];let l=null;(n==="interpolate-hcl"||n==="interpolate-lab")&&t.expectedType!=tn?l=_t:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],f=o[u+1],h=u+3,p=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);const d=t.parse(f,p,l);if(!d)return null;l=l||d.type,a.push([c,d])}return!kt(l,R)&&!kt(l,bi)&&!kt(l,_t)&&!kt(l,xi)&&!kt(l,_i)&&!kt(l,tn)&&!kt(l,Ti)&&!kt(l,Je(R))?t.error(`Type ${fe(l)} is not interpolatable.`):new St(l,n,i,s,a)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const o=cc(t,i),a=t[o],l=t[o+1],u=St.interpolationFactor(this.interpolation,i,a,l),c=n[o].evaluate(e),f=n[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return er(c,f,u);case"color":return ee.interpolate(c,f,u);case"padding":return ht.interpolate(c,f,u);case"colorArray":return et.interpolate(c,f,u);case"numberArray":return dt.interpolate(c,f,u);case"variableAnchorOffsetCollection":return Tt.interpolate(c,f,u);case"array":return nn(c,f,u);case"projectionDefinition":return ct.interpolate(c,f,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return ee.interpolate(c,f,u,"hcl");case"colorArray":return et.interpolate(c,f,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ee.interpolate(c,f,u,"lab");case"colorArray":return et.interpolate(c,f,u,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ns(r,e,t,n){const i=n-t,s=r-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class on{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const i=t.expectedType;i&&i.kind!=="value"&&(n=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,s.push(l)}if(!n)throw new Error("No output type");return i&&s.some(a=>rn(i,a.type))?new on(U,s):new on(n,s)}evaluate(e){let t=null,n=0,i;for(const s of this.args)if(n++,t=s.evaluate(e),t&&t instanceof Bt&&!t.available&&(i||(i=t.name),t=null,n===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Ua(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fm(r,e,t){return e===t}function Om(r,e,t){return e!==t}function km(r,e,t){return e<t}function Lm(r,e,t){return e>t}function Dm(r,e,t){return e<=t}function zm(r,e,t){return e>=t}function fc(r,e,t,n){return n.compare(e,t)===0}function jm(r,e,t,n){return!fc(r,e,t,n)}function Nm(r,e,t,n){return n.compare(e,t)<0}function Um(r,e,t,n){return n.compare(e,t)>0}function Gm(r,e,t,n){return n.compare(e,t)<=0}function Bm(r,e,t,n){return n.compare(e,t)>=0}function Or(r,e,t){const n=r!=="=="&&r!=="!=";return class hc{constructor(s,o,a){this.type=G,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,U);if(!l)return null;if(!Ua(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${fe(l.type)}'.`);let u=o.parse(s[2],2,U);if(!u)return null;if(!Ua(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${fe(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${fe(l.type)}' and '${fe(u.type)}'.`);n&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new ft(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new ft(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,wi),!c)return null}return new hc(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const l=ve(o),u=ve(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new de(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=ve(o),u=ve(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const Vm=Or("==",Fm,fc),qm=Or("!=",Om,jm),$m=Or("<",km,Nm),Hm=Or(">",Lm,Um),Km=Or("<=",Dm,Gm),Zm=Or(">=",zm,Bm);class Ai{constructor(e,t,n){this.type=wi,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,G);if(!i)return null;const s=t.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,G);if(!s)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,V),!o)?null:new Ai(i,s,o)}evaluate(e){return new Mo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Do{constructor(e,t,n,i,s){this.type=V,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,R);if(!n)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,V),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,V),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,R),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,R),!l)?null:new Do(n,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class zo{constructor(e){this.type=vi,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,R),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,Je(V)),!u))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,_t),!c))return null;let f=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!Em.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(f=t.parse(a["vertical-align"],1,V),!f)return null}const h=i[i.length-1];h.scale=l,h.font=u,h.textColor=c,h.verticalAlign=f}else{const l=t.parse(e[o],1,U);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new zo(i)}evaluate(e){const t=n=>{const i=n.content.evaluate(e);return ve(i)===gn?new Rs("",i,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Rs(Xr(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)};return new At(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class jo{constructor(e){this.type=gn,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,V);return n?new jo(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Bt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class No{constructor(e){this.type=R,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${fe(n.type)} instead.`):new No(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new de(`Expected value to be of type string or array, but found ${fe(ve(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Et=8192;function Xm(r,e){const t=Wm(r[0]),n=Jm(r[1]),i=Math.pow(2,e.z);return[Math.round(t*i*Et),Math.round(n*i*Et)]}function Uo(r,e){const t=Math.pow(2,e.z),n=(r[0]/Et+e.x)/t,i=(r[1]/Et+e.y)/t;return[Ym(n),Qm(i)]}function Wm(r){return(180+r)/360}function Ym(r){return r*360-180}function Jm(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Qm(r){return 360/Math.PI*Math.atan(Math.exp((180-r*360)*Math.PI/180))-90}function yn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function an(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function e0(r,e,t){return e[1]>r[1]!=t[1]>r[1]&&r[0]<(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1])+e[0]}function t0(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],s=r[0]-t[0],o=r[1]-t[1];return n*o-s*i===0&&n*s<=0&&i*o<=0}function Ri(r,e,t,n){const i=[e[0]-r[0],e[1]-r[1]],s=[n[0]-t[0],n[1]-t[1]];return s0(s,i)===0?!1:!!(Ga(r,e,t,n)&&Ga(t,n,r,e))}function r0(r,e,t){for(const n of t)for(let i=0;i<n.length-1;++i)if(Ri(r,e,n[i],n[i+1]))return!0;return!1}function kr(r,e,t=!1){let n=!1;for(const i of e)for(let s=0;s<i.length-1;s++){if(t0(r,i[s],i[s+1]))return t;e0(r,i[s],i[s+1])&&(n=!n)}return n}function n0(r,e){for(const t of e)if(kr(r,t))return!0;return!1}function dc(r,e){for(const t of r)if(!kr(t,e))return!1;for(let t=0;t<r.length-1;++t)if(r0(r[t],r[t+1],e))return!1;return!0}function i0(r,e){for(const t of e)if(dc(r,t))return!0;return!1}function s0(r,e){return r[0]*e[1]-r[1]*e[0]}function Ga(r,e,t,n){const i=r[0]-t[0],s=r[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=n[0]-t[0],u=n[1]-t[1],c=i*u-l*s,f=o*u-l*a;return c>0&&f<0||c<0&&f>0}function Go(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=[];for(let o=0;o<r[i].length;o++){const a=Xm(r[i][o],t);yn(e,a),s.push(a)}n.push(s)}return n}function pc(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=Go(r[i],e,t);n.push(s)}return n}function gc(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=n*.5;let s=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;s===0&&(s=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=s}yn(e,r)}function o0(r){r[0]=r[1]=1/0,r[2]=r[3]=-1/0}function Ba(r,e,t,n){const i=Math.pow(2,n.z)*Et,s=[n.x*Et,n.y*Et],o=[];for(const a of r)for(const l of a){const u=[l.x+s[0],l.y+s[1]];gc(u,e,t,i),o.push(u)}return o}function Va(r,e,t,n){const i=Math.pow(2,n.z)*Et,s=[n.x*Et,n.y*Et],o=[];for(const a of r){const l=[];for(const u of a){const c=[u.x+s[0],u.y+s[1]];yn(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=i/2){o0(e);for(const a of o)for(const l of a)gc(l,e,t,i)}return o}function a0(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const s=Go(e.coordinates,n,i),o=Ba(r.geometry(),t,n,i);if(!an(t,n))return!1;for(const a of o)if(!kr(a,s))return!1}if(e.type==="MultiPolygon"){const s=pc(e.coordinates,n,i),o=Ba(r.geometry(),t,n,i);if(!an(t,n))return!1;for(const a of o)if(!n0(a,s))return!1}return!0}function l0(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const s=Go(e.coordinates,n,i),o=Va(r.geometry(),t,n,i);if(!an(t,n))return!1;for(const a of o)if(!dc(a,s))return!1}if(e.type==="MultiPolygon"){const s=pc(e.coordinates,n,i),o=Va(r.geometry(),t,n,i);if(!an(t,n))return!1;for(const a of o)if(!i0(a,s))return!1}return!0}class tr{constructor(e,t){this.type=G,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(sn(e[1])){const n=e[1];if(n.type==="FeatureCollection"){const i=[];for(const s of n.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new tr(n,s)}}else if(n.type==="Feature"){const i=n.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new tr(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new tr(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return a0(e,this.geometries);if(e.geometryType()==="LineString")return l0(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class yc{constructor(e=[],t=(n,i)=>n<i?-1:n>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(n(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=(e<<1)+1;const a=o+1;if(a<this.length&&n(t[a],t[o])<0&&(o=a),n(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function u0(r,e){if(r.length<=1)return[r];const n=[];let i,s;for(const o of r){const a=c0(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&n.push(i),i=[o]):i.push(o))}return i&&n.push(i),n}function c0(r){let e=0;for(let t=0,n=r.length,i=n-1,s,o;t<n;i=t++)s=r[t],o=r[i],e+=(o.x-s.x)*(s.y+o.y);return e}const f0=6378.137,qa=1/298.257223563,$a=qa*(2-qa),Ha=Math.PI/180;class Bo{constructor(e){const t=Ha*f0*1e3,n=Math.cos(e*Ha),i=1/(1-$a*(1-n*n)),s=Math.sqrt(i);this.kx=t*s*n,this.ky=t*s*i*(1-$a)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n=1/0,i,s,o,a;for(let l=0;l<e.length-1;l++){let u=e[l][0],c=e[l][1],f=this.wrap(e[l+1][0]-u)*this.kx,h=(e[l+1][1]-c)*this.ky,p=0;(f!==0||h!==0)&&(p=(this.wrap(t[0]-u)*this.kx*f+(t[1]-c)*this.ky*h)/(f*f+h*h),p>1?(u=e[l+1][0],c=e[l+1][1]):p>0&&(u+=f/this.kx*p,c+=h/this.ky*p)),f=this.wrap(t[0]-u)*this.kx,h=(t[1]-c)*this.ky;const d=f*f+h*h;d<n&&(n=d,i=u,s=c,o=l,a=p)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Cs=100,Ms=50;function mc(r,e){return e[0]-r[0]}function Kn(r){return r[1]-r[0]+1}function Rt(r,e){return r[1]>=r[0]&&r[1]<e}function Fs(r,e){if(r[0]>r[1])return[null,null];const t=Kn(r);if(e){if(t===2)return[r,null];const i=Math.floor(t/2);return[[r[0],r[0]+i],[r[0]+i,r[1]]]}if(t===1)return[r,null];const n=Math.floor(t/2)-1;return[[r[0],r[0]+n],[r[0]+n+1,r[1]]]}function Os(r,e){if(!Rt(e,r.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)yn(t,r[n]);return t}function ks(r){const e=[1/0,1/0,-1/0,-1/0];for(const t of r)for(const n of t)yn(e,n);return e}function Ka(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Vo(r,e,t){if(!Ka(r)||!Ka(e))return NaN;let n=0,i=0;return r[2]<e[0]&&(n=e[0]-r[2]),r[0]>e[2]&&(n=r[0]-e[2]),r[1]>e[3]&&(i=r[1]-e[3]),r[3]<e[1]&&(i=e[1]-r[3]),t.distance([0,0],[n,i])}function Xt(r,e,t){const n=t.pointOnLine(e,r);return t.distance(r,n.point)}function qo(r,e,t,n,i){const s=Math.min(Xt(r,[t,n],i),Xt(e,[t,n],i)),o=Math.min(Xt(t,[r,e],i),Xt(n,[r,e],i));return Math.min(s,o)}function h0(r,e,t,n,i){if(!(Rt(e,r.length)&&Rt(n,t.length)))return 1/0;let o=1/0;for(let a=e[0];a<e[1];++a){const l=r[a],u=r[a+1];for(let c=n[0];c<n[1];++c){const f=t[c],h=t[c+1];if(Ri(l,u,f,h))return 0;o=Math.min(o,qo(l,u,f,h,i))}}return o}function d0(r,e,t,n,i){if(!(Rt(e,r.length)&&Rt(n,t.length)))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let l=n[0];l<=n[1];++l)if(o=Math.min(o,i.distance(r[a],t[l])),o===0)return o;return o}function p0(r,e,t){if(kr(r,e,!0))return 0;let n=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(n=Math.min(n,Xt(r,[o,s],t)),n===0))return n;const a=t.pointOnLine(i,r);if(n=Math.min(n,t.distance(r,a.point)),n===0)return n}return n}function g0(r,e,t,n){if(!Rt(e,r.length))return NaN;for(let s=e[0];s<=e[1];++s)if(kr(r[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=r[s],a=r[s+1];for(const l of t)for(let u=0,c=l.length,f=c-1;u<c;f=u++){const h=l[f],p=l[u];if(Ri(o,a,h,p))return 0;i=Math.min(i,qo(o,a,h,p,n))}}return i}function Za(r,e){for(const t of r)for(const n of t)if(kr(n,e,!0))return!0;return!1}function y0(r,e,t,n=1/0){const i=ks(r),s=ks(e);if(n!==1/0&&Vo(i,s,t)>=n)return n;if(an(i,s)){if(Za(r,e))return 0}else if(Za(e,r))return 0;let o=1/0;for(const a of r)for(let l=0,u=a.length,c=u-1;l<u;c=l++){const f=a[c],h=a[l];for(const p of e)for(let d=0,g=p.length,y=g-1;d<g;y=d++){const b=p[y],m=p[d];if(Ri(f,h,b,m))return 0;o=Math.min(o,qo(f,h,b,m,t))}}return o}function Xa(r,e,t,n,i,s){if(!s)return;const o=Vo(Os(n,s),i,t);o<e&&r.push([o,s,[0,0]])}function Rn(r,e,t,n,i,s,o){if(!s||!o)return;const a=Vo(Os(n,s),Os(i,o),t);a<e&&r.push([a,s,o])}function Zn(r,e,t,n,i=1/0){let s=Math.min(n.distance(r[0],t[0][0]),i);if(s===0)return s;const o=new yc([[0,[0,r.length-1],[0,0]]],mc),a=ks(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],c=e?Ms:Cs;if(Kn(u)<=c){if(!Rt(u,r.length))return NaN;if(e){const f=g0(r,u,t,n);if(isNaN(f)||f===0)return f;s=Math.min(s,f)}else for(let f=u[0];f<=u[1];++f){const h=p0(r[f],t,n);if(s=Math.min(s,h),s===0)return 0}}else{const f=Fs(u,e);Xa(o,s,n,r,a,f[0]),Xa(o,s,n,r,a,f[1])}}return s}function Xn(r,e,t,n,i,s=1/0){let o=Math.min(s,i.distance(r[0],t[0]));if(o===0)return o;const a=new yc([[0,[0,r.length-1],[0,t.length-1]]],mc);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=l[2],f=e?Ms:Cs,h=n?Ms:Cs;if(Kn(u)<=f&&Kn(c)<=h){if(!Rt(u,r.length)&&Rt(c,t.length))return NaN;let p;if(e&&n)p=h0(r,u,t,c,i),o=Math.min(o,p);else if(e&&!n){const d=r.slice(u[0],u[1]+1);for(let g=c[0];g<=c[1];++g)if(p=Xt(t[g],d,i),o=Math.min(o,p),o===0)return o}else if(!e&&n){const d=t.slice(c[0],c[1]+1);for(let g=u[0];g<=u[1];++g)if(p=Xt(r[g],d,i),o=Math.min(o,p),o===0)return o}else p=d0(r,u,t,c,i),o=Math.min(o,p)}else{const p=Fs(u,e),d=Fs(c,n);Rn(a,o,i,r,t,p[0],d[0]),Rn(a,o,i,r,t,p[0],d[1]),Rn(a,o,i,r,t,p[1],d[0]),Rn(a,o,i,r,t,p[1],d[1])}}return o}function m0(r,e){const t=r.geometry(),n=t.flat().map(o=>Uo([o.x,o.y],r.canonical));if(t.length===0)return NaN;const i=new Bo(n[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Xn(n,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Xn(n,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Zn(n,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function b0(r,e){const t=r.geometry(),n=t.flat().map(o=>Uo([o.x,o.y],r.canonical));if(t.length===0)return NaN;const i=new Bo(n[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Xn(n,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Xn(n,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Zn(n,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function w0(r,e){const t=r.geometry();if(t.length===0||t[0].length===0)return NaN;const n=u0(t).map(o=>o.map(a=>a.map(l=>Uo([l.x,l.y],r.canonical)))),i=new Bo(n[0][0][0][1]);let s=1/0;for(const o of e)for(const a of n){switch(o.type){case"Point":s=Math.min(s,Zn([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,Zn(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,y0(a,o.coordinates,i,s));break}if(s===0)return s}return s}function is(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class rr{constructor(e,t){this.type=R,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(sn(e[1])){const n=e[1];if(n.type==="FeatureCollection")return new rr(n,n.features.map(i=>is(i.geometry)).flat());if(n.type==="Feature")return new rr(n,is(n.geometry));if("type"in n&&"coordinates"in n)return new rr(n,is(n))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return m0(e,this.geometries);if(e.geometryType()==="LineString")return b0(e,this.geometries);if(e.geometryType()==="Polygon")return w0(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class mn{constructor(e){this.type=U,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return n==null?t.error("Global state property must be defined."):typeof n!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new mn(n)}evaluate(e){var t;const n=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!n||Object.keys(n).length===0?null:ac(n,this.key)}eachChild(){}outputDefined(){return!1}}const Ci={"==":Vm,"!=":qm,">":Hm,"<":$m,">=":Zm,"<=":Km,array:ft,at:Fo,boolean:ft,case:Lo,coalesce:on,collator:Ai,format:zo,image:jo,in:Oo,"index-of":$n,interpolate:St,"interpolate-hcl":St,"interpolate-lab":St,length:No,let:Ei,literal:Er,match:ko,number:ft,"number-format":Do,object:ft,slice:Hn,step:Pi,string:ft,"to-boolean":Nt,"to-color":Nt,"to-number":Nt,"to-string":Nt,var:Ii,within:tr,distance:rr,"global-state":mn};class tt{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=tt.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of a){l=new Si(t.registry,Wn,t.path,null,t.scope);const f=[];let h=!1;for(let p=1;p<e.length;p++){const d=e[p],g=Array.isArray(u)?u[p-1]:u.type,y=l.parse(d,1+f.length,g);if(!y){h=!0;break}f.push(y)}if(!h){if(Array.isArray(u)&&u.length!==f.length){l.error(`Expected ${u.length} arguments, but found ${f.length} instead.`);continue}for(let p=0;p<f.length;p++){const d=Array.isArray(u)?u[p]:u.type,g=f[p];l.concat(p+1).checkSubtype(d,g.type)}if(l.errors.length===0)return new tt(n,s,c,f)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([h])=>x0(h)).join(" | "),f=[];for(let h=1;h<e.length;h++){const p=t.parse(e[h],1+f.length);if(!p)return null;f.push(fe(p.type))}t.error(`Expected arguments of type ${c}, but found (${f.join(", ")}) instead.`)}return null}static register(e,t){tt.definitions=t;for(const n in t)e[n]=tt}}function Wa(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const s=i?i.evaluate(r):1,o=lc(e,t,n,s);if(o)throw new de(o);return new ee(e/255,t/255,n/255,s,!1)}function Ya(r,e){return r in e}function ss(r,e){const t=e[r];return typeof t>"u"?null:t}function v0(r,e,t,n){for(;t<=n;){const i=t+n>>1;if(e[i]===r)return!0;e[i]>r?n=i-1:t=i+1}return!1}function $t(r){return{type:r}}tt.register(Ci,{error:[pm,[V],(r,[e])=>{throw new de(e.evaluate(r))}],typeof:[V,[U],(r,[e])=>fe(ve(e.evaluate(r)))],"to-rgba":[Je(R,4),[_t],(r,[e])=>{const[t,n,i,s]=e.evaluate(r).rgb;return[t*255,n*255,i*255,s]}],rgb:[_t,[R,R,R],Wa],rgba:[_t,[R,R,R,R],Wa],has:{type:G,overloads:[[[V],(r,[e])=>Ya(e.evaluate(r),r.properties())],[[V,Jt],(r,[e,t])=>Ya(e.evaluate(r),t.evaluate(r))]]},get:{type:U,overloads:[[[V],(r,[e])=>ss(e.evaluate(r),r.properties())],[[V,Jt],(r,[e,t])=>ss(e.evaluate(r),t.evaluate(r))]]},"feature-state":[U,[V],(r,[e])=>ss(e.evaluate(r),r.featureState||{})],properties:[Jt,[],r=>r.properties()],"geometry-type":[V,[],r=>r.geometryType()],id:[U,[],r=>r.id()],zoom:[R,[],r=>r.globals.zoom],"heatmap-density":[R,[],r=>r.globals.heatmapDensity||0],elevation:[R,[],r=>r.globals.elevation||0],"line-progress":[R,[],r=>r.globals.lineProgress||0],accumulated:[U,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[R,$t(R),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[R,$t(R),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:R,overloads:[[[R,R],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[R],(r,[e])=>-e.evaluate(r)]]},"/":[R,[R,R],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[R,[R,R],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[R,[],()=>Math.LN2],pi:[R,[],()=>Math.PI],e:[R,[],()=>Math.E],"^":[R,[R,R],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[R,[R],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[R,[R],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[R,[R],(r,[e])=>Math.log(e.evaluate(r))],log2:[R,[R],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[R,[R],(r,[e])=>Math.sin(e.evaluate(r))],cos:[R,[R],(r,[e])=>Math.cos(e.evaluate(r))],tan:[R,[R],(r,[e])=>Math.tan(e.evaluate(r))],asin:[R,[R],(r,[e])=>Math.asin(e.evaluate(r))],acos:[R,[R],(r,[e])=>Math.acos(e.evaluate(r))],atan:[R,[R],(r,[e])=>Math.atan(e.evaluate(r))],min:[R,$t(R),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[R,$t(R),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[R,[R],(r,[e])=>Math.abs(e.evaluate(r))],round:[R,[R],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[R,[R],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[R,[R],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[G,[V,U],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[G,[U],(r,[e])=>r.id()===e.value],"filter-type-==":[G,[V],(r,[e])=>r.geometryType()===e.value],"filter-<":[G,[V,U],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[G,[U],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[G,[V,U],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[G,[U],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[G,[V,U],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[G,[U],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[G,[V,U],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[G,[U],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[G,[U],(r,[e])=>e.value in r.properties()],"filter-has-id":[G,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[G,[Je(V)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[G,[Je(U)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[G,[V,Je(U)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[G,[V,Je(U)],(r,[e,t])=>v0(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:G,overloads:[[[G,G],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[$t(G),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:G,overloads:[[[G,G],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[$t(G),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[G,[G],(r,[e])=>!e.evaluate(r)],"is-supported-script":[G,[V],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return t?t(e.evaluate(r)):!0}],upcase:[V,[V],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[V,[V],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[V,$t(U),(r,e)=>e.map(t=>Xr(t.evaluate(r))).join("")],"resolved-locale":[V,[wi],(r,[e])=>e.evaluate(r).resolvedLocale()]});function x0(r){return Array.isArray(r)?`(${r.map(fe).join(", ")})`:`(${fe(r.type)}...)`}function Wn(r){if(r instanceof Ii)return Wn(r.boundExpression);if(r instanceof tt&&r.name==="error")return!1;if(r instanceof Ai)return!1;if(r instanceof tr)return!1;if(r instanceof rr)return!1;if(r instanceof mn)return!1;const e=r instanceof Nt||r instanceof ft;let t=!0;return r.eachChild(n=>{e?t=t&&Wn(n):t=t&&n instanceof Er}),t?$o(r)&&Ko(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function $o(r){if(r instanceof tt){if(r.name==="get"&&r.args.length===1)return!1;if(r.name==="feature-state")return!1;if(r.name==="has"&&r.args.length===1)return!1;if(r.name==="properties"||r.name==="geometry-type"||r.name==="id")return!1;if(/^filter-/.test(r.name))return!1}if(r instanceof tr||r instanceof rr)return!1;let e=!0;return r.eachChild(t=>{e&&!$o(t)&&(e=!1)}),e}function Ho(r){if(r instanceof tt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(t=>{e&&!Ho(t)&&(e=!1)}),e}function Ko(r,e){if(r instanceof tt&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(n=>{t&&!Ko(n,e)&&(t=!1)}),t}function Ls(r){return{result:"success",value:r}}function pr(r){return{result:"error",value:r}}function _0(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function T0(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function S0(r){return!!r.expression&&r.expression.interpolated}function bc(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&ve(r)===Jt}class E0{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new uc,this._defaultValue=t?R0(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new de(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function I0(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ci}function wc(r,e){const t=new Si(Ci,Wn,[],e?A0(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Ls(new E0(n,e)):pr(t.errors)}class Ja{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Ho(t.expression),this.globalStateRefs=Mi(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}}class Qa{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Ho(t.expression),this.globalStateRefs=Mi(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}interpolationFactor(e,t,n){return this.interpolationType?St.interpolationFactor(this.interpolationType,e,t,n):0}}function P0(r,e){const t=wc(r,e);if(t.result==="error")return t;const n=t.value.expression,i=$o(n);if(!i&&!_0(e))return pr([new vt("","data expressions not supported")]);const s=Ko(n,["zoom"]);if(!s&&!T0(e))return pr([new vt("","zoom expressions not supported")]);const o=kn(n);if(!o&&!s)return pr([new vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof vt)return pr([o]);if(o instanceof St&&!S0(e))return pr([new vt("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Ls(i?new Ja("constant",t.value):new Ja("source",t.value));const a=o instanceof St?o.interpolation:void 0;return Ls(i?new Qa("camera",t.value,o.labels,a):new Qa("composite",t.value,o.labels,a))}function kn(r){let e=null;if(r instanceof Ei)e=kn(r.result);else if(r instanceof on){for(const t of r.args)if(e=kn(t),e)break}else(r instanceof Pi||r instanceof St)&&r.input instanceof tt&&r.input.name==="zoom"&&(e=r);return e instanceof vt||r.eachChild(t=>{const n=kn(t);n instanceof vt?e=n:!e&&n?e=new vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Mi(r,e=new Set){return r instanceof mn&&e.add(r.key),r.eachChild(t=>{Mi(t,e)}),e}function A0(r){const e={color:_t,string:V,number:R,enum:V,boolean:G,formatted:vi,padding:xi,numberArray:_i,colorArray:tn,projectionDefinition:bi,resolvedImage:gn,variableAnchorOffsetCollection:Ti};return r.type==="array"?Je(e[r.value]||U,r.length):e[r.type]}function R0(r){if(r.type==="color"&&bc(r.default))return new ee(0,0,0,0);switch(r.type){case"color":return ee.parse(r.default)||null;case"padding":return ht.parse(r.default)||null;case"numberArray":return dt.parse(r.default)||null;case"colorArray":return et.parse(r.default)||null;case"variableAnchorOffsetCollection":return Tt.parse(r.default)||null;case"projectionDefinition":return ct.parse(r.default)||null;default:return r.default===void 0?null:r.default}}function vc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!vc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const C0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function M0(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};vc(r)||(r=Yn(r));const e=wc(r,C0);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=xc(r);return{filter:(n,i,s)=>e.value.evaluate(n,i,{},s),needGeometry:t,getGlobalStateRefs:()=>Mi(e.value.expression)}}}function F0(r,e){return r<e?-1:r>e?1:0}function xc(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(xc(r[e]))return!0;return!1}function Yn(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?os(r[1],r[2],"=="):e==="!="?Cn(os(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?os(r[1],r[2],e):e==="any"?O0(r.slice(1)):e==="all"?["all"].concat(r.slice(1).map(Yn)):e==="none"?["all"].concat(r.slice(1).map(Yn).map(Cn)):e==="in"?el(r[1],r.slice(2)):e==="!in"?Cn(el(r[1],r.slice(2))):e==="has"?tl(r[1]):e==="!has"?Cn(tl(r[1])):!0}function os(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function O0(r){return["any"].concat(r.map(Yn))}function el(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(F0)]]:["filter-in-small",r,["literal",e]]}}function tl(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Cn(r){return["!",r]}function ln(r){return typeof r=="object"?["literal",r]:r}function k0(r,e){let t=r.stops;if(!t)return L0(r,e);const n=t&&typeof t[0][0]=="object",i=n||r.property!==void 0,s=n||!i;return t=t.map(o=>!i&&e.tokens&&typeof o[1]=="string"?[o[0],N0(o[1])]:[o[0],ln(o[1])]),n?D0(r,e,t):s?j0(r,e,t):Ds(r,e,t)}function L0(r,e){const t=["get",r.property];if(r.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,r.default];{const n=[e.type==="color"?"to-color":e.type,t,ln(r.default)];return e.type==="array"&&n.splice(1,0,e.value,e.length||null),n}}function Zo(r){switch(r.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function D0(r,e,t){const n={},i={},s=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;n[u]===void 0&&(n[u]={zoom:u,type:r.type,property:r.property,default:r.default},i[u]=[],s.push(u)),i[u].push([l[0].value,l[1]])}if(Wo({},e)==="exponential"){const a=[Zo(r),["linear"],["zoom"]];for(const l of s){const u=Ds(n[l],e,i[l]);xr(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const u=Ds(n[l],e,i[l]);xr(a,l,u,!0)}return Xo(a),a}}function z0(r,e){if(r!==void 0)return r;if(e!==void 0)return e}function rl(r,e){const t=ln(z0(r.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function Ds(r,e,t){const n=Wo(r,e),i=["get",r.property];if(n==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",i,o[0]],o[1]);return s.push(rl(r,e)),s}else if(n==="categorical"){const s=["match",i];for(const o of t)xr(s,o[0],o[1],!1);return s.push(rl(r,e)),s}else if(n==="interval"){const s=["step",["number",i]];for(const o of t)xr(s,o[0],o[1],!0);return Xo(s),r.default===void 0?s:["case",["==",["typeof",i],"number"],s,ln(r.default)]}else if(n==="exponential"){const s=r.base!==void 0?r.base:1,o=[Zo(r),s===1?["linear"]:["exponential",s],["number",i]];for(const a of t)xr(o,a[0],a[1],!1);return r.default===void 0?o:["case",["==",["typeof",i],"number"],o,ln(r.default)]}else throw new Error(`Unknown property function type ${n}`)}function j0(r,e,t,n=["zoom"]){const i=Wo(r,e);let s,o=!1;if(i==="interval")s=["step",n],o=!0;else if(i==="exponential"){const a=r.base!==void 0?r.base:1;s=[Zo(r),a===1?["linear"]:["exponential",a],n]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)xr(s,a[0],a[1],o);return Xo(s),s}function Xo(r){r[0]==="step"&&r.length===3&&(r.push(0),r.push(r[3]))}function xr(r,e,t,n){r.length>3&&e===r[r.length-2]||(n&&r.length===2||r.push(e),r.push(t))}function Wo(r,e){return r.type?r.type:e.expression.interpolated?"exponential":"interval"}function N0(r){const e=["concat"],t=/{([^{}]+)}/g;let n=0;for(let i=t.exec(r);i!==null;i=t.exec(r)){const s=r.slice(n,t.lastIndex-i[0].length);n=t.lastIndex,s.length>0&&e.push(s),e.push(["get",i[1]])}if(e.length===1)return r;if(n<r.length)e.push(r.slice(n));else if(e.length===2)return["to-string",e[1]];return e}const U0=fm;var nl={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Ur=" ",il=/(italic|oblique)$/i,sl={};function zs(r,e,t){var n=sl[r];if(!n){Array.isArray(r)||(r=[r]);for(var i=400,s="normal",o=[],a,l,u=0,c=r.length;u<c;++u){var f=r[u],h=f.split(" "),p=h[h.length-1].toLowerCase();p=="normal"||p=="italic"||p=="oblique"?(s=l?s:p,l=!0,h.pop(),p=h[h.length-1].toLowerCase()):il.test(p)&&(p=p.replace(il,""),s=l?s:h[h.length-1].replace(p,""),l=!0);for(var d in nl){var g=h.length>1?h[h.length-2].toLowerCase():"";if(p==d||p==d.replace("-","")||g+"-"+p==d){i=a?i:nl[d],h.pop(),g&&d.startsWith(g)&&h.pop();break}}!a&&typeof p=="number"&&(i=p,a=!0);var y=h.join(Ur).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");y.indexOf(Ur)!==-1&&(y='"'+y+'"'),o.push(y)}n=sl[r]=[s,i,o]}return n[0]+Ur+n[1]+Ur+e+"px"+(t?"/"+t:"")+Ur+n[2]}const _c="https://api.mapbox.com";function Yo(r){const e="mapbox://";return r.indexOf(e)!==0?"":r.slice(e.length)}function G0(r,e,t){if(typeof r=="string")return[{id:"default",url:ol(r,e,t)}];for(const n of r)n.url=ol(n.url,e,t);return r}function ol(r,e,t){const n=Yo(r);if(!n)return decodeURI(new URL(r,t).href);const i="sprites/";if(n.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${r}`);const s=n.slice(i.length);return`${_c}/styles/v1/${s}/sprite?access_token=${e}`}function Jn(r,e){const t=Yo(r);if(!t)return decodeURI(new URL(r,location.href).href);const n="styles/";if(t.indexOf(n)!==0)throw new Error(`unexpected style url: ${r}`);const i=t.slice(n.length);return`${_c}/styles/v1/${i}?&access_token=${e}`}const B0=["a","b","c","d"];function Ln(r,e,t,n){const i=new URL(r,n||location.href),s=Yo(r);if(!s)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`]}return B0.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const Oe=Object.freeze({}),al={},ll={};let V0=0;function Jo(r){return r.id||(r.id=V0++),r.id}function q0(r,e){return Jo(r)+"."+ot(e)}function Tc(r){let e=al[r.id];return e||(e={},al[Jo(r)]=e),e}function $0(r){let e=ll[r.id];return e||(e={},ll[Jo(r)]=e),e}function as(r){return r*Math.PI/180}const pt=function(){const r=[];for(let e=78271.51696402048;r.length<=24;e/=2)r.push(e);return r}();function Fi(r,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(r,e);const t=document.createElement("canvas");return t.width=r,t.height=e,t}function Qn(r,e){let t=0;const n=e.length;for(;t<n;++t)if(e[t]<r&&t+1<n){const s=e[t]/e[t+1];return t+Math.log(e[t]/r)/Math.log(s)}return n-1}function $r(r,e){const t=Math.floor(r),n=Math.pow(2,r-t);return e[t]/n}const cr={};function Ir(r,e,t={},n){if(e in cr)return n&&(n.url=cr[e][0].url),cr[e][1];const i=t.transformRequest&&t.transformRequest(e,r)||e,s=function(l){return delete cr[e],Promise.reject(new Error("Error fetching source "+e))},o=function(l){return delete cr[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=Un(()=>i).then(l=>l instanceof Response?(n&&(n.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),n&&(n.url=l.url),fetch(l).then(o).catch(s))).catch(s);return cr[e]=[i,a],a}function Sc(r,e){if(typeof r=="string")if(r.trim().startsWith("{"))try{const t=JSON.parse(r);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return r=Jn(r,e.accessToken),Ir("Style",r,e);else return Promise.resolve(r)}const ul={};function Ec(r,e,t={}){const n=[e,JSON.stringify(r)].toString();let i=ul[n];if(!i||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof Zl)a.setLoader((c,f,h)=>{const p=function(d){d.arrayBuffer().then(g=>{const b=a.getFormat().readFeatures(g,{extent:c,featureProjection:h});a.setFeatures(b)})};Un(()=>u).then(d=>{if(d instanceof Response)return p(d);fetch(d).then(p).catch(g=>a.setState(Q.ERROR))}).catch(d=>a.setState(Q.ERROR))});else{const c=a.getImage();Un(()=>u).then(f=>{if(typeof f=="string"){c.src=f;return}const h=p=>p.blob().then(d=>{const g=URL.createObjectURL(d);c.addEventListener("load",()=>URL.revokeObjectURL(g)),c.addEventListener("error",()=>URL.revokeObjectURL(g)),c.src=g});if(f instanceof Response)return h(f);fetch(f).then(h).catch(p=>a.setState(Q.ERROR))}).catch(f=>a.setState(Q.ERROR))}});const o=r.url;if(o&&!r.tiles){const a=Ln(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},r,{url:void 0,tiles:a}),tileLoadFunction:s});else{const l={};i=Ir("Source",a[0],t,l).then(function(u){return u.tiles=u.tiles.map(function(c){return u.scheme==="tms"&&(c=c.replace("{y}","{-y}")),Ln(c,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else r.tiles?(r=Object.assign({},r,{tiles:r.tiles.map(function(a){return r.scheme==="tms"&&(a=a.replace("{y}","{-y}")),Ln(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},r),tileLoadFunction:s})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));ul[n]=i}return i}function cl(r,e,t,n){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],s=Fi(i[0],i[1]),o=s.getContext("2d");o.drawImage(r,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,i[0],i[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;const l=a.data;for(let u=0,c=a.width;u<c;++u)for(let f=0,h=a.height;f<h;++f){const p=(f*c+u)*4;l[p+3]>0&&o.arc(u,f,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function H0(r,e,t){const n=Math.max(0,Math.min(1,(t-r)/(e-r)));return n*n*(3-2*n)}function fl(r,e,t){const n=Fi(e.width,e.height),i=n.getContext("2d");i.drawImage(r,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let u=0,c=s.height;u<c;++u){const f=(u*l+a)*4,h=o[f+3]/255,p=.75,d=.1,g=H0(p-d,p+d,h);g>0?(o[f+0]=Math.round(255*t.r*g),o[f+1]=Math.round(255*t.g*g),o[f+2]=Math.round(255*t.b*g),o[f+3]=Math.round(255*g)):o[f+3]=0}return i.putImageData(s,0,0),n}const K0=Array(256).join("");function js(r,e){if(e>=.05){let t="";const n=r.split(`
`),i=K0.slice(0,Math.round(e/.1));for(let s=0,o=n.length;s<o;++s)s>0&&(t+=`
`),t+=n[s].split("").join(i);return t}return r}let ls;function Ic(){return ls||(ls=Fi(1,1).getContext("2d")),ls}function Ht(r,e){return Ic().measureText(r).width+(r.length-1)*e}const ei={};Af.on("propertychange",()=>{for(const r in ei)delete ei[r]});function Ns(r,e,t,n){if(r.indexOf(`
`)!==-1){const o=r.split(`
`),a=[];for(let l=0,u=o.length;l<u;++l)a.push(Ns(o[l],e,t,n));return a.join(`
`)}const i=t+","+e+","+r+","+n;let s=ei[i];if(!s){const o=r.split(" ");if(o.length>1){const a=Ic();a.font=e;const u=a.measureText("M").width*t;let c="";const f=[];for(let h=0,p=o.length;h<p;++h){const d=o[h],g=c+(c?" ":"")+d;Ht(g,n)<=u?c=g:(c&&f.push(c),c=d)}c&&f.push(c);for(let h=0,p=f.length;h<p&&p>1;++h){const d=f[h];if(Ht(d,n)<u*.35){const g=h>0?Ht(f[h-1],n):1/0,y=h<p-1?Ht(f[h+1],n):1/0;f.splice(h,1),p-=1,g<y?(f[h-1]+=" "+d,h-=1):f[h]=d+" "+f[h]}}for(let h=0,p=f.length-1;h<p;++h){const d=f[h],g=f[h+1];if(Ht(d,n)>u*.7&&Ht(g,n)<u*.6){const y=d.split(" "),b=y.pop();Ht(b,n)<u*.2&&(f[h]=y.join(" "),f[h+1]=b+" "+g),p-=1}}s=f.join(`
`)}else s=r;s=js(s,n),ei[i]=s}return s}const Z0=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],hl={};function X0(r,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(ci)return r;let t;for(let n=0,i=r.length;n<i;++n){const s=r[n];if(s in hl)continue;hl[s]=!0;const a=zs(s,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let n=0,i=t.length;n<i;++n){const s=t[n],o=s[0];if(Z0.includes(o))continue;const a=s[1],l=s[2];if(!(await document.fonts.load(`${l} ${a} 16px "${o}"`)).some(c=>c.family.replace(/^['"]|['"]$/g,"").toLowerCase()===o.toLowerCase()&&c.weight==a&&c.style===l)){const c=e.replace("{font-family}",o.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",o.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+c+'"]')){const f=document.createElement("link");f.href=c,f.rel="stylesheet",document.head.appendChild(f)}}}})(),r}const W0={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},Y0={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},J0=function(r,e){const t=P0(r,e);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return t.value},Ue={zoom:0,distanceFromCenter:0};tt.register(Ci,{...tt.definitions,pitch:[{kind:"number"},[],r=>Ue.pitch||90],"distance-from-center":[{kind:"number"},[],r=>Ue.distanceFromCenter||0]});let Mn,us;function D(r,e,t,n,i,s){const o=r.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[o]||(i[o]={});const a=i[o];if(!a[t]){let l=(r[e]||Oe)[t];const u=U0[`${e}_${r.type}`][t];l===void 0&&(l=u.default);let c=I0(l);if(!c&&bc(l)&&(l=k0(l,u),c=!0),c){const f=J0(l,u);a[t]=f.evaluate.bind(f)}else{const f=u.type;(f==="color"||f==="colorArray")&&(l=ee.parse(l)),a[t]=function(){return l}}}return a[t](Ue,n,s)}function dl(r,e,t,n){return D(r,"layout",`${t}-allow-overlap`,e,n)?D(r,"layout",`${t}-ignore-placement`,e,n)?"none":"obstacle":"declutter"}function Q0(r,e,t,n){if(n||console.warn("No filterCache provided to evaluateFilter()"),!(r in n))try{n[r]=M0(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),n[r]=function(){return!1}}return n[r](Ue,t)}function Lt(r,e){if(r){if(r.a===0||e===0)return;const t=r.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(r.r*255/t)+","+Math.round(r.g*255/t)+","+Math.round(r.b*255/t)+","+t*e+")"}return r}const eb=/\{[^{}}]*\}/g;function cs(r,e){return r.replace(eb,function(t){return e[t.slice(1,-1)]||""})}function pl(r,e){let t=r.split(":")[0];return t===r&&(t="default"),e[t]}const tb={};function rb(r,e,t,n=pt,i=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");tb[q0(e,r)]=Array.from(arguments);const l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(const v in s){const P=s[v];Un(()=>P).then(async _=>{let x;if(typeof Image<"u"){const S=new Image;if(typeof _=="string")S.crossOrigin="anonymous",S.src=_;else{let M;_ instanceof Request?M=await fetch(_):_ instanceof Response&&(M=_);const E=await M.blob();x=URL.createObjectURL(E),S.src=x}S.addEventListener("load",function M(){S.removeEventListener("load",M),l[v]={image:S,size:[S.width,S.height]},r.changed(),x&&URL.revokeObjectURL(x)}),S.addEventListener("error",function M(){URL.revokeObjectURL(x),S.removeEventListener("error",M)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const S=self;S.postMessage({action:"loadImage",src:_}),S.addEventListener("message",function(E){E.data.action==="imageLoaded"&&E.data.src===_&&(l[v]={image:E.data.image,size:[E.data.image.width,E.data.image.height]})})}})}const u=Ju(e.layers),c={},f=[],h={},p={},d=Tc(e),g=$0(e);let y;for(let v=0,P=u.length;v<P;++v){const _=u[v],x=_.id;if(typeof t=="string"&&_.source==t||Array.isArray(t)&&t.indexOf(x)!==-1){const S=_["source-layer"];if(y){if(_.source!==y)throw new Error(`Layer "${x}" does not use source "${y}`)}else{y=_.source;const E=e.sources[y];if(!E)throw new Error(`Source "${y}" is not defined`);const O=E.type;if(O!=="vector"&&O!=="geojson")throw new Error(`Source "${y}" is not of type "vector" or "geojson", but "${O}"`)}let M=c[S];M||(M=[],c[S]=M),M.push({layer:_,index:v}),f.push(x)}}const b=new Vr,m=new gr,w=[],I=function(v,P,_){var q,H,ue;const x=((ue=(H=(q=r.getSource)==null?void 0:q.call(r))==null?void 0:H.format_)==null?void 0:ue.layerName_)??"mvt:layer",S=v.getProperties(),M=c[S[x]];if(!M)return;let E=n.indexOf(P);E==-1&&(E=Qn(P,n)),Ue.zoom=E,Ue.distanceFromCenter=0;const O=v.getGeometry(),j=W0[O.getType()],F=r.get("map");if(F&&F instanceof Gn&&j===1){const Le=F.getSize();if(Le){const Be=F.getView().getCenter(),be=Ar(O.getExtent());Ue.distanceFromCenter=Rf(Be,be)/P/Le[1]}}const T={id:v.getId(),properties:S,type:j},A=r.get("mapbox-featurestate")[v.getId()];let z=-1;for(let Le=0,Be=M.length;Le<Be;++Le){const be=M[Le],C=be.layer,Ke=C.id;if(_!==void 0&&_!==Ke)continue;const Ee=C.layout||Oe,ye=C.paint||Oe;if(Ee.visibility==="none"||"minzoom"in C&&E<C.minzoom||"maxzoom"in C&&E>=C.maxzoom)continue;const Ve=C.filter;if(!Ve||Q0(Ke,Ve,T,g)){let me,Ce,Vt,Ze,rt,k;const ar=be.index;if(j==3&&(C.type=="fill"||C.type=="fill-extrusion"))if(Ce=D(C,"paint",C.type+"-opacity",T,d,A),C.type+"-pattern"in ye){const he=D(C,"paint",C.type+"-pattern",T,d,A);if(he){const ce=typeof he=="string"?cs(he,S):he.toString(),ie=pl(ce,l);if(i&&i[ce]&&ie){++z,k=w[z],(!k||!k.getFill()||k.getStroke()||k.getText())&&(k=new Kt({fill:new gr}),w[z]=k),Vt=k.getFill(),k.setZIndex(ar);const re=ce+"."+Ce;let xe=p[re];if(!xe){const K=i[ce],Y=Fi(K.width,K.height),_e=Y.getContext("2d");_e.globalAlpha=Ce,_e.drawImage(ie.image,K.x,K.y,K.width,K.height,0,0,K.width,K.height),xe=_e.createPattern(Y,"repeat"),p[re]=xe}Vt.setColor(xe)}}}else me=Lt(D(C,"paint",C.type+"-color",T,d,A),Ce),C.type+"-outline-color"in ye&&(rt=Lt(D(C,"paint",C.type+"-outline-color",T,d,A),Ce)),rt||(rt=me),(me||rt)&&(++z,k=w[z],(!k||me&&!k.getFill()||!me&&k.getFill()||rt&&!k.getStroke()||!rt&&k.getStroke()||k.getText())&&(k=new Kt({fill:me?new gr:void 0,stroke:rt?new Vr:void 0}),w[z]=k),me&&(Vt=k.getFill(),Vt.setColor(me)),rt&&(Ze=k.getStroke(),Ze.setColor(rt),Ze.setWidth(.5)),k.setZIndex(ar));if(j!=1&&C.type=="line"){"line-pattern"in ye?me=void 0:me=Lt(D(C,"paint","line-color",T,d,A),D(C,"paint","line-opacity",T,d,A));const he=D(C,"paint","line-width",T,d,A);me&&he>0&&(++z,k=w[z],(!k||!k.getStroke()||k.getFill()||k.getText())&&(k=new Kt({stroke:new Vr}),w[z]=k),Ze=k.getStroke(),Ze.setLineCap(D(C,"layout","line-cap",T,d,A)),Ze.setLineJoin(D(C,"layout","line-join",T,d,A)),Ze.setMiterLimit(D(C,"layout","line-miter-limit",T,d,A)),Ze.setColor(me),Ze.setWidth(he),Ze.setLineDash(ye["line-dasharray"]?D(C,"paint","line-dasharray",T,d,A).map(function(ce){return ce*he}):null),k.setZIndex(ar))}let vn=!1,W=null,sa=0,lr,De,zi;if((j==1||j==2)&&"icon-image"in Ee){const he=D(C,"layout","icon-image",T,d,A);if(he){lr=typeof he=="string"?cs(he,S):he.toString();let ce;const ie=a?a(r,lr):void 0,re=pl(lr,l);if(i&&i[lr]&&re||ie){const xe=D(C,"layout","icon-rotation-alignment",T,d,A);if(j==2){const K=v.getGeometry();if(K.getFlatMidpoint||K.getFlatMidpoints){const Y=K.getExtent();if(Math.sqrt(Math.max(Math.pow((Y[2]-Y[0])/P,2),Math.pow((Y[3]-Y[1])/P,2)))>150){const Pe=K.getType()==="MultiLineString"?K.getFlatMidpoints():K.getFlatMidpoint();if(us||(Mn=[NaN,NaN],us=new Jr("Point",Mn,[],2,{},void 0)),ce=us,Mn[0]=Pe[0],Mn[1]=Pe[1],D(C,"layout","symbol-placement",T,d,A)==="line"&&xe==="map"){const lt=K.getStride(),ze=K.getFlatCoordinates();for(let Xe=0,pe=ze.length-lt;Xe<pe;Xe+=lt){const Me=ze[Xe],nt=ze[Xe+1],ge=ze[Xe+lt],Ft=ze[Xe+lt+1],Lc=Math.min(Me,ge),Dc=Math.max(Me,ge),Ni=Pe[0],zc=Pe[1],jc=(Ft-nt)*(Ni-Me)-(ge-Me)*(zc-nt);if(Math.abs(jc)<.001&&Ni<=Dc&&Ni>=Lc){sa=Math.atan2(nt-Ft,ge-Me);break}}}}}}if(j!==2||ce){const K=D(C,"layout","icon-size",T,d,A),Y=ye["icon-color"]!==void 0?D(C,"paint","icon-color",T,d,A):null;if(!Y||Y.a!==0){const _e=D(C,"paint","icon-halo-color",T,d,A),Pe=D(C,"paint","icon-halo-width",T,d,A);let yt=`${lr}.${K}.${Pe}.${_e}`;if(Y!==null&&(yt+=`.${Y}`),De=h[yt],!De){const lt=dl(C,T,"icon",d);let ze;"icon-offset"in Ee&&(ze=D(C,"layout","icon-offset",T,d,A).slice(0),ze[0]*=K,ze[1]*=-K);let Xe=Y?[Y.r*255,Y.g*255,Y.b*255,Y.a]:void 0;if(ie){const pe={color:Xe,rotateWithView:xe==="map",displacement:ze,declutterMode:lt,scale:K};typeof ie=="string"?pe.src=ie:(pe.img=ie,pe.imgSize=[ie.width,ie.height]),De=new ha(pe)}else{const pe=i[lr];let Me,nt,ge;if(Pe)pe.sdf?(Me=cl(fl(re.image,pe,Y||[0,0,0,1]),{x:0,y:0,width:pe.width,height:pe.height,pixelRatio:pe.pixelRatio},Pe,_e),Xe=void 0):Me=cl(re.image,pe,Pe,_e);else{if(pe.sdf&&!re.unSDFed){const Ft=fl(re.image,{x:0,y:0,width:re.size[0],height:re.size[1]},{r:1,g:1,b:1});re.image=Ft,re.unSDFed=!0}Me=re.image,nt=[pe.width,pe.height],ge=[pe.x,pe.y]}De=new ha({color:Xe,img:Me,imgSize:re.size,size:nt,offset:ge,rotateWithView:xe==="map",scale:K/pe.pixelRatio,displacement:ze,declutterMode:lt})}h[yt]=De}}De&&(++z,k=w[z],(!k||!k.getImage()||k.getFill()||k.getStroke())&&(k=new Kt,w[z]=k),k.setGeometry(ce),De.setRotation(sa+as(D(C,"layout","icon-rotate",T,d,A))),De.setOpacity(D(C,"paint","icon-opacity",T,d,A)),De.setAnchor(Y0[D(C,"layout","icon-anchor",T,d,A)]),k.setImage(De),W=k.getText(),k.setText(void 0),k.setZIndex(ar),vn=!0,zi=!1)}else zi=!0}}}if(j==1&&C.type==="circle"){++z,k=w[z],(!k||!k.getImage()||k.getFill()||k.getStroke())&&(k=new Kt,w[z]=k);const he="circle-radius"in ye?D(C,"paint","circle-radius",T,d,A):5,ce=Lt(D(C,"paint","circle-stroke-color",T,d,A),D(C,"paint","circle-stroke-opacity",T,d,A)),ie=D(C,"paint","circle-translate",T,d,A),re=Lt(D(C,"paint","circle-color",T,d,A),D(C,"paint","circle-opacity",T,d,A)),xe=D(C,"paint","circle-stroke-width",T,d,A),K=he+"."+ce+"."+re+"."+xe+"."+ie[0]+"."+ie[1];De=h[K],De||(De=new zl({radius:he,displacement:[ie[0],-ie[1]],stroke:ce&&xe>0?new Vr({width:xe,color:ce}):void 0,fill:re?new gr({color:re}):void 0,declutterMode:"none"}),h[K]=De),k.setImage(De),W=k.getText(),k.setText(void 0),k.setGeometry(void 0),k.setZIndex(ar),vn=!0}let Ie,Dr,zr,Mt,jr,ji;if("text-field"in Ee){Mt=Math.round(D(C,"layout","text-size",T,d,A));const he=D(C,"layout","text-font",T,d,A);zr=D(C,"layout","text-line-height",T,d,A),Dr=zs(o?o(he,e.metadata?e.metadata["ol:webfonts"]:void 0):he,Mt,zr),Dr.includes("sans-serif")||(Dr+=",sans-serif"),jr=D(C,"layout","text-letter-spacing",T,d,A),ji=D(C,"layout","text-max-width",T,d,A);const ce=D(C,"layout","text-field",T,d,A);typeof ce=="object"&&ce.sections?ce.sections.length===1?Ie=ce.toString():Ie=ce.sections.reduce((ie,re,xe)=>{const K=re.fontStack?re.fontStack.split(","):he,Y=zs(o?o(K):K,Mt*(re.scale||1),zr);let _e=re.text;if(_e===`
`)return ie.push(`
`,""),ie;if(j==2)return ie.push(js(_e,jr),Y),ie;_e=Ns(_e,Y,ji,jr).split(`
`);for(let Pe=0,yt=_e.length;Pe<yt;++Pe)Pe>0&&ie.push(`
`,""),ie.push(_e[Pe],Y);return ie},[]):Ie=cs(ce,S).trim(),Ce=D(C,"paint","text-opacity",T,d,A)}if(Ie&&Ce&&!zi){vn||(++z,k=w[z],(!k||!k.getText()||k.getFill()||k.getStroke())&&(k=new Kt,w[z]=k),k.setImage(void 0),k.setGeometry(void 0));const he=dl(C,T,"text",d);k.getText()||k.setText(W),W=k.getText(),(!W||"getDeclutterMode"in W&&W.getDeclutterMode()!==he)&&(W=new Cf({padding:[2,2,2,2],declutterMode:he}),k.setText(W));const ce=D(C,"layout","text-transform",T,d,A);ce=="uppercase"?Ie=Array.isArray(Ie)?Ie.map((ge,Ft)=>Ft%2?ge:ge.toUpperCase()):Ie.toUpperCase():ce=="lowercase"&&(Ie=Array.isArray(Ie)?Ie.map((ge,Ft)=>Ft%2?ge:ge.toLowerCase()):Ie.toLowerCase());const ie=Array.isArray(Ie)?Ie:j==2?js(Ie,jr):Ns(Ie,Dr,ji,jr);if(W.setText(ie),W.setFont(Dr),W.setRotation(as(D(C,"layout","text-rotate",T,d,A))),typeof W.setKeepUpright=="function"){const ge=D(C,"layout","text-keep-upright",T,d,A);W.setKeepUpright(ge)}const re=D(C,"layout","text-anchor",T,d,A),xe=vn||j==1?"point":D(C,"layout","symbol-placement",T,d,A);let K;if(xe==="line-center"?(W.setPlacement("line"),K="center"):W.setPlacement(xe),xe==="line"&&typeof W.setRepeat=="function"){const ge=D(C,"layout","symbol-spacing",T,d,A);W.setRepeat(ge*2)}W.setOverflow(xe==="point");let Y=D(C,"paint","text-halo-width",T,d,A);const _e=D(C,"layout","text-offset",T,d,A),Pe=D(C,"paint","text-translate",T,d,A);let yt=0,lt=0;if(xe=="point"){K="center",re.indexOf("left")!==-1?(K="left",lt=Y):re.indexOf("right")!==-1&&(K="right",lt=-Y);const ge=D(C,"layout","text-rotation-alignment",T,d,A);W.setRotateWithView(ge=="map")}else W.setMaxAngle(as(D(C,"layout","text-max-angle",T,d,A))*Ie.length/ie.length),W.setRotateWithView(!1);W.setTextAlign(K);let ze="middle";re.indexOf("bottom")==0?(ze="bottom",yt=-Y-.5*(zr-1)*Mt):re.indexOf("top")==0&&(ze="top",yt=Y+.5*(zr-1)*Mt),W.setTextBaseline(ze);const Xe=D(C,"layout","text-justify",T,d,A);W.setJustify(Xe==="auto"?void 0:Xe),W.setOffsetX(_e[0]*Mt+lt+Pe[0]),W.setOffsetY(_e[1]*Mt+yt+Pe[1]),m.setColor(Lt(D(C,"paint","text-color",T,d,A),Ce)),W.setFill(m);const pe=Lt(D(C,"paint","text-halo-color",T,d,A),Ce);if(pe&&Y>0){b.setColor(pe),Y*=2;const ge=.5*Mt;b.setWidth(Y<=ge?Y:ge),W.setStroke(b)}else W.setStroke(void 0);const Me=D(C,"layout","text-padding",T,d,A),nt=W.getPadding();Me!==nt[0]&&(nt[0]=Me,nt[1]=Me,nt[2]=Me,nt[3]=Me),k.setZIndex(ar)}}}if(z>-1)return w.length=z+1,w};return r.setStyle(I),r.set("mapbox-layers",f),r.set("mapbox-source",y),r.set("mapbox-featurestate",r.get("mapbox-featurestate")||{}),I}function nb(r,e){const t=r[0],n=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=n-1,u=i-1,c=[0,0,0,0],f=2*Math.PI,h=Math.PI/2,p=Math.PI*e.sunEl/180,d=Math.PI*e.sunAz/180,g=Math.cos(p),y=Math.sin(p),b=e.highlightColor,m=e.shadowColor,w=e.accentColor,I=e.encoding;let v,P,_,x,S,M,E,O,j,F,T,A,z,q,H,ue,Le,Be,be,C,Ke,Ee;function ye(Ve,me="mapbox"){if(me==="mapbox")return(Ve[0]*256*256+Ve[1]*256+Ve[2])*.1-1e4;if(me==="terrarium")return Ve[0]*256+Ve[1]+Ve[2]/256-32768}for(P=0;P<=u;++P)for(S=P===0?0:P-1,M=P===u?u:P+1,v=0;v<=l;++v)_=v===0?0:v-1,x=v===l?l:v+1,E=(P*n+_)*4,c[0]=s[E],c[1]=s[E+1],c[2]=s[E+2],c[3]=s[E+3],O=e.vert*ye(c,I),E=(P*n+x)*4,c[0]=s[E],c[1]=s[E+1],c[2]=s[E+2],c[3]=s[E+3],j=e.vert*ye(c,I),F=(j-O)/a,E=(S*n+v)*4,c[0]=s[E],c[1]=s[E+1],c[2]=s[E+2],c[3]=s[E+3],O=e.vert*ye(c,I),E=(M*n+v)*4,c[0]=s[E],c[1]=s[E+1],c[2]=s[E+2],c[3]=s[E+3],j=e.vert*ye(c,I),T=(j-O)/a,z=Math.atan2(T,-F),z<0?z=h-z:z>h?z=f-z+h:z=h-z,A=Math.atan(Math.sqrt(F*F+T*T)),Ee=y*Math.cos(A)+g*Math.sin(A)*Math.cos(d-z),q=Math.cos(A),H=255*Ee,be=Math.min(Math.max(2*e.sunEl,0),1),C=1.875-e.opacity*1.75,Ke=e.opacity!==.5?h*((Math.pow(C,A)-1)/(Math.pow(C,h)-1)):A,Le={r:(1-q)*w.r*be*255,g:(1-q)*w.g*be*255,b:(1-q)*w.b*be*255,a:(1-q)*w.a*be*255},ue=Math.abs(((z+d)/Math.PI+.5)%2-1),Be={r:(b.r*(1-ue)+m.r*ue)*H,g:(b.g*(1-ue)+m.g*ue)*H,b:(b.b*(1-ue)+m.b*ue)*H,a:(b.a*(1-ue)+m.a*ue)*H},E=(P*n+v)*4,o[E]=Le.r*(1-ue)+Be.r,o[E+1]=Le.g*(1-ue)+Be.g,o[E+2]=Le.b*(1-ue)+Be.b,o[E+3]=s[E+3]*e.opacity*be*Math.sin(Ke);return new ImageData(o,n,i)}function ib(r,e){const t=r[0],n=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=n-1,l=i-1,u=[0,0,0,0];let c,f,h;function p(x){return x>0?1/(1-x):1+x}function d(x){return x>0?1-1/(1.001-x):-x}function g(x){x*=Math.PI/180;const S=Math.sin(x),M=Math.cos(x);return[(2*M+1)/3,(-Math.sqrt(3)*S-M+1)/3,(Math.sqrt(3)*S-M+1)/3]}const y=d(e.saturation),b=p(e.contrast),m=g(e.hueRotate),w=m,I=[m[2],m[0],m[1]],v=[m[1],m[2],m[0]],P=e.brightnessLow,_=e.brightnessHigh;for(f=0;f<=l;++f)for(c=0;c<=a;++c){h=(f*n+c)*4,u[0]=s[h],u[1]=s[h+1],u[2]=s[h+2],u[3]=s[h+3];const x=u[0],S=u[1],M=u[2],E=(A,z)=>{let q=0;for(let H=0;H<A.length;H++)q+=A[H]*z[H];return q};let O=E([x,S,M],w),j=E([x,S,M],I),F=E([x,S,M],v);const T=(O+j+F)/3;O+=(T-O)*y,j+=(T-j)*y,F+=(T-F)*y,O=(O-.5)*b+.5,j=(j-.5)*b+.5,F=(F-.5)*b+.5,O=P*(255-O)+_*O,j=P*(255-j)+_*j,F=P*(255-F)+_*F,o[h]=O,o[h+1]=j,o[h+2]=F,o[h+3]=u[3]}return new ImageData(o,n,i)}function sb(r,e=512){return r.getExtent()?fn({extent:r.getExtent(),tileSize:e,maxZoom:22}).getResolutions():pt}function Pc(r,e){return e.accessToken||(e=Object.assign({},e),new URL(r).searchParams.forEach((n,i)=>{e.accessToken=n,e.accessTokenParam=i})),e}function ob(r,e,t="",n={},i=void 0){let s,o,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,n=a):l=t,typeof n=="string"?(s=n,a={}):(s=n.styleUrl,a=n),a.updateSource===!1&&(u=!1),i||(i=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:Jn(s,a.accessToken),a=Pc(s,a)),new Promise(function(c,f){Sc(e,a).then(function(h){if(h.version!=8)return f(new Error("glStyle version 8 required."));if(!(r instanceof fi||r instanceof wr))return f(new Error("Can only apply to VectorLayer or VectorTileLayer"));const p=r instanceof wr?"vector":"geojson";if(l?Array.isArray(l)?o=h.layers.find(function(I){return I.id===l[0]}).source:o=l:(o=h.layers.find(function(I){return I.source&&h.sources[I.source].type===p}).source,l=o),!o)return f(new Error(`No ${p} source found in the glStyle.`));function d(){if(!u)return Promise.resolve();if(r instanceof wr)return Cc(h.sources[o],s,a).then(function(_){const x=r.getSource();x?_!==x&&(x.setTileUrlFunction(_.getTileUrlFunction()),typeof x.setUrls=="function"&&typeof _.getUrls=="function"&&x.setUrls(_.getUrls()),x.format_||(x.format_=_.format_),x.getAttributions()||x.setAttributions(_.getAttributions()),x.getTileLoadFunction()===bu&&x.setTileLoadFunction(_.getTileLoadFunction()),Ne(x.getProjection(),_.getProjection())&&(x.tileGrid=_.getTileGrid())):r.setSource(_);const S=r.getSource().getTileGrid();!isFinite(r.getMaxResolution())&&!isFinite(r.getMinZoom())&&S.getMinZoom()>0&&r.setMaxResolution($r(Math.max(0,S.getMinZoom()-1e-12),S.getResolutions()))});const I=h.sources[o];let v=r.getSource();(!v||v.get("mapbox-source")!==I)&&(v=Fc(I,s,a));const P=r.getSource();return P?v!==P&&(P.getAttributions()||P.setAttributions(v.getAttributions()),P.format_||(P.format_=v.getFormat()),P.url_=v.getUrl()):r.setSource(v),Promise.resolve()}let g,y;const b={},m={};function w(){if(!y&&(!h.sprite||b)){if(a.projection&&!i){const _=se(a.projection).getUnits();_!=="m"&&(i=pt.map(x=>x/ps[_]))}let I;const v=r.getSource();v instanceof dn&&v.format_ instanceof To&&(I=v.format_.layerName_),y=rb(r,h,l,i,b,m,(P,_=a.webfonts)=>X0(P,_),a.getImage,I),r.getStyle()?d().then(c).catch(f):f(new Error(`Nothing to show for source [${o}]`))}else y?(r.setStyle(y),d().then(c).catch(f)):f(new Error("Something went wrong trying to apply style."))}if(h.sprite){const I=G0(h.sprite,a.accessToken,s||location.href);g=ci?1:window.devicePixelRatio>=1.5?.5:1;const v=g==.5?"@2x":"";Promise.all(I.map(function(P){const _=new URL(P.url);let x=_.origin+_.pathname+v+".json"+_.search;return new Promise(function(S,M){Ir("Sprite",x,a).then(S).catch(function(E){x=_.origin+_.pathname+".json"+_.search,Ir("Sprite",x,a).then(S).catch(M)})}).then(function(S){S===void 0&&f(new Error("No sprites found."));let M;if(M=_.origin+_.pathname+v+".png"+_.search,a.transformRequest){const E=a.transformRequest(M,"SpriteImage")||M;(E instanceof Request||E instanceof Promise)&&(M=E)}m[P.id]=M;for(const E in S){const O=P.id=="default"?E:`${P.id}:${E}`;b[O]=S[E]}}).catch(function(S){f(new Error(`Sprites cannot be loaded: ${x}: ${S.message}`))})})).then(w).catch(f)}else w()}).catch(f)})}function Ac(r,e){let t;return r.some(function(n){if(n.id==e)return t=n.source,!0}),t}function ab(r,e){const t=r.bounds;if(t){const n=gs([t[0],t[1]],e),i=gs([t[2],t[3]],e);return[n[0],n[1],i[0],i[1]]}return se(e).getExtent()}function Rc(r,e,t){const n=new mo({tileJSON:e,tileSize:r.tileSize||e.tileSize||512}),i=n.getTileJSON(),s=n.getTileGrid(),o=se(t.projection||"EPSG:3857"),a=ab(i,o),l=o.getExtent(),u=i.minzoom||0,c=i.maxzoom||22,f={attributions:n.getAttributions(),projection:o,tileGrid:new Ks({origin:l?Ll(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:sb(o,e.tileSize).slice(0,c+1),tileSize:s.getTileSize(0)})};return Array.isArray(i.tiles)?f.urls=i.tiles:f.url=i.tiles,f}function lb(r,e,t,n){const i={id:r.id,type:r.type},s=r.layout||{},o=r.paint||{};i.paint=o,Ue.zoom=Qn(e,t.resolutions||pt),Ue.distanceFromCenter=0;let a;const l=D(i,"paint","background-color",Oe,n);return o["background-opacity"]!==void 0&&(a=D(i,"paint","background-opacity",Oe,n)),s.visibility=="none"?void 0:Lt(l,a)}function ub(r,e,t){const n=ci?{style:{}}:document.createElement("div");return n.className="ol-mapbox-style-background",n.style.position="absolute",n.style.width="100%",n.style.height="100%",new Rl({source:new li({}),render(i){const s=lb(r,i.viewState.resolution,e,t);return n.style.backgroundColor=s,n}})}function Cc(r,e,t){return new Promise(function(n,i){Ec(r,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=Rc(r,s,t);a.tileLoadFunction=o,a.format=new To({layerName:"mvt:layer"});const l=new dn(a);l.set("mapbox-source",r),n(l)}).catch(i)})}function cb(r,e,t){const n=new wr({declutter:!0,visible:!1});return Cc(r,e,t).then(function(i){n.setSource(i)}).catch(function(i){n.setSource(void 0)}),n}function Mc(r){return`{bbox-${(r?r.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function fb(r,e,t){return new Promise(function(n,i){Ec(r,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new mo({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=Rc(r,s,t).tileGrid,t.projection&&(a.projection=se(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(u,c,f){const h=Mc(f);let p=l(u,c,f);if(p.indexOf(h)!=-1){const d=a.getTileGrid().getTileCoordExtent(u);p=p.replace(h,d.toString())}return p}),a.set("mapbox-source",r),n(a)}).catch(function(s){i(s)})})}function Qo(r,e,t){const n=new Bn;return fb(r,e,t).then(function(i){n.setSource(i)}).catch(function(){n.setSource(void 0)}),n}function hb(r,e,t){const n=Qo(r,e,t);return new di({source:new yo({operationType:"image",operation:ib,sources:[n]})})}function db(r,e,t){const n=Qo(r,e,t);return new di({source:new yo({operationType:"image",operation:nb,sources:[n]})})}function Fc(r,e,t){const n=t.projection?new Ts({dataProjection:t.projection}):new Ts,i=r.data,s={};if(typeof i=="string"){const[a]=Ln(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(f,h,p)=>{const d=Mc(p);return a.replace(d,`${f.join(",")}`)},c=new Hr({attributions:r.attribution,format:n,loader:(f,h,p,d,g)=>{const y=typeof u=="function"?u(f,h,p):u;Ir("GeoJSON",y,t).then(b=>{const m=c.getFormat().readFeatures(b,{featureProjection:p});c.addFeatures(m),d(m)}).catch(b=>{c.removeLoadedExtent(f),g()})},strategy:Gf});return c.set("mapbox-source",r),c}const l=new Hr({attributions:r.attribution,format:n,url:a,loader:(u,c,f,h,p)=>{Ir("GeoJSON",a,t).then(d=>{const g=l.getFormat().readFeatures(d,{featureProjection:f});l.addFeatures(g),h(g)}).catch(d=>{l.removeLoadedExtent(u),p()})}});return l}s.features=n.readFeatures(i,{featureProjection:"EPSG:3857"});const o=new Hr(Object.assign({attributions:r.attribution,format:n},s));return o.set("mapbox-source",r),o}function pb(r,e,t){return new fi({declutter:!0,source:Fc(r,e,t),visible:!1})}function gb(r,e,t){let n=null;return function(i){r.paint&&"raster-opacity"in r.paint&&i.frameState.viewState.zoom!==n&&(n=i.frameState.viewState.zoom,delete t[r.id],yb(r,e,n,t))}}function yb(r,e,t,n){Ue.zoom=t,Ue.distanceFromCenter=0;const i=D(r,"paint","raster-opacity",Oe,n);e.setOpacity(i)}function mb(r,e){function t(){const n=e.get("mapbox-style");if(!n)return;const i=Ju(n.layers),s=r.get("mapbox-layers"),o=i.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});r.get("visible")!==o&&r.setVisible(o)}r.on("change",t),t()}function bb(r,e,t,n){const i=Tc(r),s=r.layers,o=t.type,a=t.source||Ac(s,t.ref),l=r.sources[a];let u;if(o=="background")u=ub(t,n,i);else if(l.type=="vector")u=cb(l,e,n);else if(l.type=="raster"){const f=["raster-saturation","raster-contrast","raster-brightness-max","raster-brightness-min","raster-hue-rotate"];!!Object.keys(t.paint||{}).find(p=>f.includes(p))?(u=hb(l,e,n),u.getSource().on("beforeoperations",function(p){Ue.zoom=Qn(p.resolution,n.resolutions||pt),Ue.distanceFromCenter=0;const d=p.data;d.saturation=D(t,"paint","raster-saturation",Oe,i),d.contrast=D(t,"paint","raster-contrast",Oe,i),d.brightnessHigh=D(t,"paint","raster-brightness-max",Oe,i),d.brightnessLow=D(t,"paint","raster-brightness-min",Oe,i),d.hueRotate=D(t,"paint","raster-hue-rotate",Oe,i)})):u=Qo(l,e,n),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",gb(t,u,i))}else if(l.type=="geojson")u=pb(l,e,n);else if(l.type=="raster-dem"&&t.type=="hillshade"){const f=db(l,e,n);u=f,f.getSource().on("beforeoperations",function(h){const p=h.data;p.resolution=Ff(n.projection||"EPSG:3857",h.resolution,Ar(h.extent),"m"),Ue.zoom=Qn(h.resolution,n.resolutions||pt),Ue.distanceFromCenter=0,p.encoding=l.encoding,p.vert=5*D(t,"paint","hillshade-exaggeration",Oe,i),p.sunAz=D(t,"paint","hillshade-illumination-direction",Oe,i),p.sunEl=35,p.opacity=.3,p.highlightColor=D(t,"paint","hillshade-highlight-color",Oe,i),p.shadowColor=D(t,"paint","hillshade-shadow-color",Oe,i),p.accentColor=D(t,"paint","hillshade-accent-color",Oe,i)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const c=a;return u&&u.set("mapbox-source",c),u}function gl(r,e,t,n){const i=[];let s=null;if(e instanceof Gn){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const f=n.projection?se(n.projection):s.getProjection();s=new Mf(Object.assign(s.getProperties(),{maxResolution:pt[0]/ps[f.getUnits()],projection:n.projection||s.getProjection()})),e.setView(s)}"center"in r&&!s.getCenter()&&s.setCenter(gs(r.center,s.getProjection())),"zoom"in r&&s.getZoom()===void 0&&s.setResolution(pt[0]/ps[s.getProjection().getUnits()]/Math.pow(2,r.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",r),e.set("mapbox-metadata",{styleUrl:t,options:n});const o=r.layers;let a=[],l,u,c;for(let f=0,h=o.length;f<h;++f){const p=o[f],d=p.type;if(d=="heatmap"){console.debug(`layers[${f}].type "${d}" not supported`);continue}else c=p.source||Ac(o,p.ref),(!c||c!=u)&&(a.length&&(i.push(yl(l,a,r,t,e,n)),a=[]),l=bb(r,t,p,n),l instanceof fi||l instanceof wr||(a=[]),u=l.get("mapbox-source")),a.push(p.id)}return i.push(yl(l,a,r,t,e,n)),Promise.all(i)}function h1(r,e,t={}){let n,i;if(ci){if(!(r instanceof Gn)&&!(r instanceof jl))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=r}else typeof r=="string"||r instanceof HTMLElement?i=new Gn({target:r}):i=r;if(typeof e=="string"){const s=e.startsWith("data:")?location.href:Jn(e,t.accessToken);t=Pc(s,t),n=new Promise(function(o,a){Sc(e,t).then(function(l){gl(l,i,s,t).then(function(){o(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else n=new Promise(function(s,o){gl(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:Jn(t.styleUrl,t.accessToken),t).then(function(){s(i)}).catch(o)});return n}function yl(r,e,t,n,i,s={}){let o=24,a=0;const l=t.layers;for(let u=0,c=l.length;u<c;++u){const f=l[u];e.indexOf(f.id)!==-1&&(o=Math.min("minzoom"in f?f.minzoom:0,o),a=Math.max("maxzoom"in f?f.maxzoom:24,a))}return new Promise(function(u,c){const f=function(){const p=r.getSource();if(!p||p.getState()==="error"){c(new Error("Error accessing data for source "+r.get("mapbox-source")));return}if("getTileGrid"in p){const d=p.getTileGrid();if(d){const g=d.getMinZoom();(o>0||g>0)&&r.setMaxResolution(Math.min($r(Math.max(0,o-1e-12),pt),$r(Math.max(0,g-1e-12),d.getResolutions()))),a<24&&r.setMinResolution($r(a,pt))}}else o>0&&r.setMaxResolution($r(Math.max(0,o-1e-12),pt));p instanceof Hr||p instanceof dn?ob(r,t,e,Object.assign({styleUrl:n},s)).then(function(){mb(r,i),u()}).catch(c):u()};r.set("mapbox-layers",e);const h=i.getLayers();h.getArray().indexOf(r)===-1&&h.push(r),r.getSource()?f():r.once("change:source",f)})}const Qe=new Uint8Array([102,103,98,3,102,103,98,0]),xt=4,Gr=4,Br=4,bn=4,zt=new Int32Array(2),ml=new Float32Array(zt.buffer),bl=new Float64Array(zt.buffer),Fn=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Us;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(Us||(Us={}));class gt{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new gt(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return zt[0]=this.readInt32(e),ml[0]}readFloat64(e){return zt[Fn?0:1]=this.readInt32(e),zt[Fn?1:0]=this.readInt32(e+4),bl[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){ml[0]=t,this.writeInt32(e,zt[0])}writeFloat64(e,t){bl[0]=t,this.writeInt32(e,zt[Fn?0:1]),this.writeInt32(e+4,zt[Fn?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Gr+Br)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Br;t++)e+=String.fromCharCode(this.readInt8(this.position_+Gr+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=Gr;const i=this.bytes_.subarray(e,e+n);return t===Us.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Gr}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Br)throw new Error("FlatBuffers: file identifier must be length "+Br);for(let t=0;t<Br;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Gr+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}var J,Ae=((J={})[J.Byte=0]="Byte",J[J.UByte=1]="UByte",J[J.Bool=2]="Bool",J[J.Short=3]="Short",J[J.UShort=4]="UShort",J[J.Int=5]="Int",J[J.UInt=6]="UInt",J[J.Long=7]="Long",J[J.ULong=8]="ULong",J[J.Float=9]="Float",J[J.Double=10]="Double",J[J.String=11]="String",J[J.Json=12]="Json",J[J.DateTime=13]="DateTime",J[J.Binary=14]="Binary",J);class Te{constructor(){Z(this,"bb",null);Z(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Te).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+bn),(t||new Te).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Ae.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Ae.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,o,a,l,u,c,f,h){return Te.startColumn(e),Te.addName(e,t),Te.addType(e,n),Te.addTitle(e,i),Te.addDescription(e,s),Te.addWidth(e,o),Te.addPrecision(e,a),Te.addScale(e,l),Te.addNullable(e,u),Te.addUnique(e,c),Te.addPrimaryKey(e,f),Te.addMetadata(e,h),Te.endColumn(e)}}var $,Fe=(($={})[$.Unknown=0]="Unknown",$[$.Point=1]="Point",$[$.LineString=2]="LineString",$[$.Polygon=3]="Polygon",$[$.MultiPoint=4]="MultiPoint",$[$.MultiLineString=5]="MultiLineString",$[$.MultiPolygon=6]="MultiPolygon",$[$.GeometryCollection=7]="GeometryCollection",$[$.CircularString=8]="CircularString",$[$.CompoundCurve=9]="CompoundCurve",$[$.CurvePolygon=10]="CurvePolygon",$[$.MultiCurve=11]="MultiCurve",$[$.MultiSurface=12]="MultiSurface",$[$.Curve=13]="Curve",$[$.Surface=14]="Surface",$[$.PolyhedralSurface=15]="PolyhedralSurface",$[$.TIN=16]="TIN",$[$.Triangle=17]="Triangle",$);class je{constructor(){Z(this,"bb",null);Z(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new je).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+bn),(t||new je).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Fe.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new je).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Fe.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,o,a,l,u){return je.startGeometry(e),je.addEnds(e,t),je.addXy(e,n),je.addZ(e,i),je.addM(e,s),je.addT(e,o),je.addTm(e,a),je.addType(e,l),je.addParts(e,u),je.endGeometry(e)}}class at{constructor(){Z(this,"bb",null);Z(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new at).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+bn),(t||new at).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new je).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new Te).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return at.startFeature(e),at.addGeometry(e,t),at.addProperties(e,n),at.addColumns(e,i),at.endFeature(e)}}function fs(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let wl=new TextDecoder;function wb(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],u=l.name;switch(l.type){case Ae.Bool:t[u]=!!i.getUint8(o),o+=1;break;case Ae.Byte:t[u]=i.getInt8(o),o+=1;break;case Ae.UByte:t[u]=i.getUint8(o),o+=1;break;case Ae.Short:t[u]=i.getInt16(o,!0),o+=2;break;case Ae.UShort:t[u]=i.getUint16(o,!0),o+=2;break;case Ae.Int:t[u]=i.getInt32(o,!0),o+=4;break;case Ae.UInt:t[u]=i.getUint32(o,!0),o+=4;break;case Ae.Long:t[u]=Number(i.getBigInt64(o,!0)),o+=8;break;case Ae.ULong:t[u]=Number(i.getBigUint64(o,!0)),o+=8;break;case Ae.Float:t[u]=i.getFloat32(o,!0),o+=4;break;case Ae.Double:t[u]=i.getFloat64(o,!0),o+=8;break;case Ae.DateTime:case Ae.String:{let c=i.getUint32(o,!0);o+=4,t[u]=wl.decode(n.subarray(o,o+c)),o+=c;break}case Ae.Json:{let c=i.getUint32(o,!0);o+=4;let f=wl.decode(n.subarray(o,o+c));t[u]=JSON.parse(f),o+=c;break}case Ae.Binary:{let c=i.getUint32(o,!0);o+=4,t[u]=n.subarray(o,o+c),o+=c;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const ea=new Uint8Array(0);function vb(){return this._source.cancel()}function xb(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function _b(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=ea,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:xb(e,t.value)}})}function Tb(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=ea,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function Sb(r){return typeof r.slice=="function"?r:new Oi(typeof r.read=="function"?r:r.getReader())}function Oi(r){this._source=r,this._array=ea,this._index=0}Oi.prototype.read=_b;Oi.prototype.slice=Tb;Oi.prototype.cancel=vb;class st{constructor(){Z(this,"bb",null);Z(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new st).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+bn),(t||new st).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,o,a){return st.startCrs(e),st.addOrg(e,t),st.addCode(e,n),st.addName(e,i),st.addDescription(e,s),st.addWkt(e,o),st.addCodeString(e,a),st.endCrs(e)}}class ti{constructor(){Z(this,"bb",null);Z(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new ti).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+bn),(t||new ti).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Fe.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Te).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new st).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Fe.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function ki(r){let e=ti.getSizePrefixedRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:e.envelopeLength()>0?e.envelopeArray():null,featuresCount:Number(t),indexNodeSize:n,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}const oi=class oi{constructor(){Z(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};Z(oi,"global",new oi);let ri=oi;const Eb=40,Ib=16;function Li(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function Pb(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=n,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*Oc(r,e,t,n){class i{constructor(p,d){Z(this,"_level");Z(this,"nodes");this._level=d,this.nodes=p}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(p){this.nodes[1]=p}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,u=Pb(r,e),c=u[0][0],f=[new i([0,1],u.length-1)];for(;f.length!==0;){let h=f.shift(),p=h.startNodeIdx(),d=p>=c,g=(()=>{let[,m]=u[h.level()],w=Math.min(h.endNodeIdx()+e,m);return d&&w<m?w+1:w})(),y=g-p,b=new DataView(await n(40*p,40*y));for(let m=p;m<g;m++){let w=m-p,I=40*w;if(a<b.getFloat64(I+0,!0)||l<b.getFloat64(I+8,!0)||s>b.getFloat64(I+16,!0)||o>b.getFloat64(I+24,!0))continue;let v=b.getBigUint64(I+32,!0);if(d){let S=(()=>{if(m<r-1){let E=(w+1)*40;return b.getBigUint64(E+32,!0)-v}return null})(),M=m-c;yield[Number(v),M,Number(S)];continue}let P=ri.global.extraRequestThreshold()/40,_=f[f.length-1];if(_!==void 0&&_.level()===h.level()-1&&v<_.endNodeIdx()+P){_.extendEndNodeIdx(Number(v));continue}let x=(()=>{let S=h.level()-1;return new i([Number(v),Number(v)+1],S)})();_!==void 0&&(_.level(),x.level()),f.push(x)}}}class ta{constructor(e,t,n,i){Z(this,"bytes");Z(this,"header");Z(this,"headerLength");Z(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=n,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((o,a)=>Qe[a]===o))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(Qe.length,!0);if(t>10485760||t<8)throw Error("Invalid header size");let n=e.subarray(Qe.length,Qe.length+xt+t),i=ki(new gt(n)),s=Li(i.featuresCount,i.indexNodeSize);return new ta(e,i,t,s)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=async(i,s)=>{let o=t+i;return this.bytes.slice(o,o+s).buffer};for await(let i of Oc(this.header.featuresCount,this.header.indexNodeSize,e,n)){let[s,o]=i,a=this.readFeature(s);yield{id:o,feature:a}}}lengthBeforeTree(){return Qe.length+xt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),n=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+n),s=new Uint8Array(n+xt);s.set(i,xt);let o=new gt(s);return at.getSizePrefixedRootAsFeature(o)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Gs=function(r,e){return Gs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Gs(r,e)};function Ab(r,e){Gs(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pr(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(n.next(c))}catch(f){o(f)}}function l(c){try{u(n.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((n=n.apply(r,[])).next())})}function Ut(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Lr(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function un(r){return this instanceof un?(this.v=r,this):new un(r)}function Rb(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(p){return new Promise(function(d,g){s.push([h,p,d,g])>1||a(h,p)})})}function a(h,p){try{l(n[h](p))}catch(d){f(s[0][3],d)}}function l(h){h.value instanceof un?Promise.resolve(h.value.v).then(u,c):f(s[0][2],h)}function u(h){a("next",h)}function c(h){a("throw",h)}function f(h,p){h(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}var kc=function(r){Ab(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();function Bs(r){r!=null&&typeof r.then=="function"&&r.then(si,si)}var hs=0,vl=1,or=2,ni=3,Vs=4,ii=1024,si=function(){};function _r(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function Zt(r,e){var t=r.state>=ni;return Promise.resolve(e).then(function(n){return!t&&r.state>=Vs?_r(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function ra(r,e){var t,n;if(!(r.state>=or))if(r.state=or,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Wr(r);else try{for(var i=Lr(r.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Wr(r){var e,t;if(!(r.state>=ni)){r.state<or&&ra(r),r.state=ni,r.buffer=void 0;try{for(var n=Lr(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,o=r.pending===void 0?_r(r):r.pending.then(function(){return _r(r)});s.resolve(Zt(r,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function xl(r){r.state>=Vs||(r.state<ni&&Wr(r),r.state=Vs)}function Cb(r,e){if(Bs(e),r.pushes.length>=ii)throw new kc("No more than "+ii+" pending calls to push are allowed on a single repeater.");if(r.state>=or)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(l){r.state<or&&(r.err=l),xl(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Zt(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(l){return r.onnext=l})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(l){return r.pushes.push({resolve:l,value:t})});var s=!0,o={},a=n.catch(function(l){if(s)throw l});return o.then=function(l,u){return s=!1,Promise.prototype.then.call(n,l,u)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(n,l)},o.finally=n.finally.bind(n),r.pending=t.then(function(){return a}).catch(function(l){r.err=l,xl(r)}),o}function Mb(r){var e=ra.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function Fb(r){if(!(r.state>=vl)){r.state=vl;var e=Cb.bind(null,r),t=Mb(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return ra(r)})}}var On=new WeakMap,wn=function(){function r(e,t){On.set(this,{executor:e,buffer:t,err:void 0,state:hs,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:si,onstop:si})}return r.prototype.next=function(e){Bs(e);var t=On.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=ii)throw new kc("No more than "+ii+" pending calls to next are allowed on a single repeater.");if(t.state<=hs&&Fb(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=Zt(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,Zt(t,s.value)}else if(t.state>=or)return Wr(t),Zt(t,_r(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},r.prototype.return=function(e){Bs(e);var t=On.get(this);if(t===void 0)throw new Error("WeakMap error");return Wr(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),Zt(t,_r(t))},r.prototype.throw=function(e){var t=On.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=hs||t.state>=or||typeof t.buffer<"u"&&!t.buffer.empty?(Wr(t),t.err==null&&(t.err=e),Zt(t,_r(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=Ob,r.merge=kb,r.zip=Lb,r.latest=Db,r}();function Di(r,e){var t,n,i=[],s=function(u){u!=null&&typeof u[Symbol.asyncIterator]=="function"?i.push(u[Symbol.asyncIterator]()):u!=null&&typeof u[Symbol.iterator]=="function"?i.push(u[Symbol.iterator]()):i.push(function(){return Rb(this,arguments,function(){return Ut(this,function(h){switch(h.label){case 0:return e.yieldValues?[4,un(u)]:[3,3];case 1:return[4,h.sent()];case 2:h.sent(),h.label=3;case 3:return e.returnValues?[4,un(u)]:[3,5];case 4:return[2,h.sent()];case 5:return[2]}})})}())};try{for(var o=Lr(r),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function Ob(r){var e=this,t=Di(r,{returnValues:!0});return new wn(function(n,i){return Pr(e,void 0,void 0,function(){var s,o,a,l,u,c;return Ut(this,function(f){switch(f.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),f.label=1;case 1:f.trys.push([1,,5,7]),l=void 0,u=0,c=function(){var h,p,d,g,y,b;return Ut(this,function(m){switch(m.label){case 0:h=u;try{for(p=(y=void 0,Lr(t)),d=p.next();!d.done;d=p.next())g=d.value,Promise.resolve(g.next()).then(function(w){w.done?(i(),a===void 0&&(a=w)):u===h&&(u++,s(w))},function(w){return i(w)})}catch(w){y={error:w}}finally{try{d&&!d.done&&(b=p.return)&&b.call(p)}finally{if(y)throw y.error}}return[4,new Promise(function(w){return s=w})];case 1:return l=m.sent(),l===void 0?[3,3]:[4,n(l.value)];case 2:m.sent(),m.label=3;case 3:return[2]}})},f.label=2;case 2:return o?[3,4]:[5,c()];case 3:return f.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(h){return h.return&&h.return()}))];case 6:return f.sent(),[7];case 7:return[2]}})})})}function kb(r){var e=this,t=Di(r,{yieldValues:!0});return new wn(function(n,i){return Pr(e,void 0,void 0,function(){var s,o,a,l=this;return Ut(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var c,f;o=!0;try{for(var h=Lr(s),p=h.next();!p.done;p=h.next()){var d=p.value;d()}}catch(g){c={error:g}}finally{try{p&&!p.done&&(f=h.return)&&f.call(h)}finally{if(c)throw c.error}}}),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,Promise.all(t.map(function(c,f){return Pr(l,void 0,void 0,function(){var h,p;return Ut(this,function(d){switch(d.label){case 0:d.trys.push([0,,6,9]),d.label=1;case 1:return o?[3,5]:(Promise.resolve(c.next()).then(function(g){return s[f](g)},function(g){return i(g)}),[4,new Promise(function(g){s[f]=g})]);case 2:return h=d.sent(),h===void 0?[3,4]:h.done?(a=h,[2]):[4,n(h.value)];case 3:d.sent(),d.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return p=c.return,p?[4,c.return()]:[3,8];case 7:p=d.sent(),d.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return u.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function Lb(r){var e=this,t=Di(r,{returnValues:!0});return new wn(function(n,i){return Pr(e,void 0,void 0,function(){var s,o,a,l;return Ut(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),u.label=1;case 1:u.trys.push([1,,6,8]),u.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(c){return c.next()})).then(function(c){return s(c)},function(c){return i(c)}),[4,new Promise(function(c){return s=c})]);case 3:return a=u.sent(),a===void 0?[2]:(l=a.map(function(c){return c.value}),a.some(function(c){return c.done})?[2,l]:[4,n(l)]);case 4:return u.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(c){return c.return&&c.return()}))];case 7:return u.sent(),[7];case 8:return[2]}})})})}function Db(r){var e=this,t=Di(r,{yieldValues:!0,returnValues:!0});return new wn(function(n,i){return Pr(e,void 0,void 0,function(){var s,o,a,l,u,c=this;return Ut(this,function(f){switch(f.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var h,p;s();try{for(var d=Lr(o),g=d.next();!g.done;g=d.next()){var y=g.value;y()}}catch(b){h={error:b}}finally{try{g&&!g.done&&(p=d.return)&&p.call(d)}finally{if(h)throw h.error}}a=!0}),f.label=1;case 1:return f.trys.push([1,,5,7]),Promise.all(t.map(function(h){return h.next()})).then(function(h){return s(h)},function(h){return i(h)}),[4,new Promise(function(h){return s=h})];case 2:return l=f.sent(),l===void 0?[2]:(u=l.map(function(h){return h.value}),l.every(function(h){return h.done})?[2,u]:[4,n(u.slice())]);case 3:return f.sent(),[4,Promise.all(t.map(function(h,p){return Pr(c,void 0,void 0,function(){var d;return Ut(this,function(g){switch(g.label){case 0:if(l[p].done)return[2,l[p].value];g.label=1;case 1:return a?[3,4]:(Promise.resolve(h.next()).then(function(y){return o[p](y)},function(y){return i(y)}),[4,new Promise(function(y){return o[p]=y})]);case 2:return d=g.sent(),d===void 0?[2,l[p].value]:d.done?[2,d.value]:(u[p]=d.value,[4,n(u.slice())]);case 3:return g.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,f.sent()];case 5:return i(),[4,Promise.all(t.map(function(h){return h.return&&h.return()}))];case 6:return f.sent(),[7];case 7:return[2]}})})})}class na{constructor(e,t,n,i,s,o={}){Z(this,"headerClient");Z(this,"header");Z(this,"headerLength");Z(this,"indexLength");Z(this,"nocache");Z(this,"headers");this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s,this.headers=o}static async open(e,t,n={}){let i,s=new _l(e,t,n),o=2024+(()=>{let c,f=0;for(c=0;c<3;c++)f+=Ib**c*Eb;return f})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((c,f)=>Qe[f]===c))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await s.getRange(Qe.length,xt+i,o,"header"),l=ki(new gt(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let u=Li(l.featuresCount,l.indexNodeSize);return new na(s,l,i,u,t,n)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(l,u)=>n.getRange(t+l,u,0,"index"),s=[],o=[];for await(let l of Oc(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[u,c]=l,[,,f]=l;if(f||(f=4),o.length===0){o.push([u,f,c]);continue}let h=o[o.length-1];u-(h[0]+h[1])>ri.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([u,f,c])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*wn.merge(a)}lengthBeforeTree(){return Qe.length+xt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new _l(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[n]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-n;for(let[l,,u]of e){let c=await this.readFeature(o,l,a);yield{id:u,feature:c},a=0}o.logUsage("feature")}async readFeature(e,t,n){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,n,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,n,"feature data")),a=new Uint8Array(i+xt);a.set(o,xt);let l=new gt(a);return at.getSizePrefixedRootAsFeature(l)}}class _l{constructor(e,t,n={}){Z(this,"httpClient");Z(this,"bytesEverUsed",0);Z(this,"bytesEverFetched",0);Z(this,"buffer",new ArrayBuffer(0));Z(this,"head",0);if(typeof e=="string")this.httpClient=new Tl(e,t,n);else if(e instanceof Tl)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,n);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Tl{constructor(e,t,n={}){Z(this,"url");Z(this,"nocache");Z(this,"headers");Z(this,"requestsEverMade",0);Z(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=n}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}async function*zb(r,e,t,n){if(!r.subarray(0,3).every((f,h)=>Qe[h]===f))throw Error("Not a FlatGeobuf file");if(t){let f=ta.open(r);for await(let h of f.selectBbox(t))yield e(h.id,h.feature,f.header);return}let i=new gt(r),s=i.readUint32(Qe.length);i.setPosition(Qe.length);let o=ki(i),a=Qe.length+xt+s,{indexNodeSize:l,featuresCount:u}=o;l>0&&(a+=Li(u,l));let c=0;for(;a<i.capacity();){let f=i.readUint32(a);i.setPosition(a);let h=at.getSizePrefixedRootAsFeature(i);yield e(c++,h,o),a+=xt+f}}async function*jb(r,e,t){let n,i=Sb(r),s=async g=>await i.slice(g),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((g,y)=>Qe[y]===g))throw Error("Not a FlatGeobuf file");let a=new Uint8Array(await s(4)),l=new gt(a),u=l.readUint32(0),c=new Uint8Array(await s(u));(o=new Uint8Array(a.length+c.length)).set(a),o.set(c,a.length);let f=ki(l=new gt(o)),{indexNodeSize:h,featuresCount:p}=f;if(h>0){let g=Li(p,h);await s(g)}let d=0;for(;n=await Ub(s,f,e,d++);)yield n}async function*Nb(r,e,t,n,i=!1,s={}){let o=await na.open(r,i,s);for await(let a of o.selectBbox(e))yield t(a.id,a.feature,o.header)}async function Ub(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new gt(i),o=s.readUint32(0);i=new Uint8Array(await r(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),s=new gt(a),t(n,at.getSizePrefixedRootAsFeature(s),e)}function qs(r,e){let t=e;if(t===Fe.Unknown&&(t=r.type()),t===Fe.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let o=r.parts(s),a=o.type();i.push(qs(o,a))}return{type:Fe[t],geometries:i}}if(t===Fe.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(qs(r.parts(s),Fe.Polygon));return{type:Fe[t],coordinates:i.map(s=>s.coordinates)}}let n=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case Fe.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case Fe.MultiPoint:case Fe.LineString:return fs(o,a);case Fe.MultiLineString:case Fe.Polygon:return function(l,u,c){let f;if(!c||c.length===0)return[fs(l,u)];let h=0,p=Array.from(c).map(d=>l.slice(h,h=d<<1));return u&&(h=0,f=Array.from(c).map(d=>u.slice(h,h=d))),p.map((d,g)=>fs(d,f?f[g]:void 0))}(o,a,i.endsArray())}}(r,t);return{type:Fe[t],coordinates:n}}function ia(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:qs(e.geometry(),t.geometryType),properties:wb(e,n)}}async function*Gb(r,e,t){yield*zb(r,ia,e)}function Bb(r,e){return jb(r,ia)}function Vb(r,e,t,n=!1,i={}){return Nb(r,e,ia,t,n,i)}function d1(r,e,t,n=!1,i={}){return r instanceof Uint8Array?Gb(r,e):r instanceof ReadableStream?Bb(r):Vb(r,e,t,n,i)}export{t1 as L,rd as P,Yu as S,h1 as a,Rd as b,Pd as c,d1 as d,r1 as e,Ad as f,qe as p};
