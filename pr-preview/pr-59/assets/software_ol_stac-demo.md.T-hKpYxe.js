import{_ as Y,v as H,p as i,P as K,c as f,o as p,j as a,a as F,e as x,a0 as V,ak as U,t as v}from"./chunks/framework.DIX4mz6K.js";import{S as A,F as N,d as Z,M as Q,V as X,t as I,P as ee}from"./chunks/XYZ.zMTP1uvH.js";import{W as B}from"./chunks/DataTile.2Hs0Wrd9.js";import{V as O,a as $,F as te}from"./chunks/Vector.HAw8Ogek.js";import{G as ae}from"./chunks/GeoZarr.DRyGnkYi.js";import{O as oe}from"./chunks/ol.DhRacvPf.js";import{D as ne,c as se}from"./chunks/Draw.D5s9n0Qc.js";import{c as re}from"./chunks/index.KPY1M44e.js";import"./chunks/index.OUYS7i6-.js";import"./chunks/Layer.BBoFQbFB.js";import"./chunks/open.D2U_mLDX.js";const le={key:0,class:"warning"},ie={key:1,class:"demo-container"},ce={class:"controls-panel"},de={class:"compact-controls"},ue={class:"control-group compact"},fe={class:"date-input-container"},pe=["max"],me={class:"date-display"},ve={class:"control-group compact"},ge={class:"date-input-container"},he=["min","max"],ye={class:"date-display"},be={class:"button-group compact"},we=["disabled"],Se={key:0,class:"warning"},_e={key:0,class:"results-panel"},xe={key:0,class:"loading-info"},Le={key:1,class:"loading-info",style:{color:"#28a745"}},De={key:1,class:"results-panel no-results"},$e=JSON.parse('{"title":"STAC Demo","description":"","frontmatter":{"title":"STAC Demo","layout":"page"},"headers":[],"relativePath":"software/ol/stac-demo.md","filePath":"software/ol/stac-demo.md"}'),ke={name:"software/ol/stac-demo.md"},Te=Object.assign(ke,{setup(Pe){const L=i(null),D=i();let y=null,S=null,k=null,_=null,T=[];const d=i(""),u=i(""),P=i(""),b=i(!1),c=i([]),m=i(null),l=i([]),g=i([]);H(()=>{z(),L.value=re(),L.value&&K(()=>{M()})});function z(){const t=new Date,e=new Date;e.setDate(t.getDate()-15),P.value=t.toISOString().split("T")[0],u.value=t.toISOString().split("T")[0],d.value=e.toISOString().split("T")[0]}function M(){if(D.value)try{const t=new B({source:new oe}),e=new O;k=new $({source:e,style:new A({stroke:new Z({color:"#2563eb",width:2}),fill:new N({color:"rgba(37, 99, 235, 0.1)"})})});const o=new O;_=new $({source:o,style:new A({stroke:new Z({color:"#f97316",width:2}),fill:new N({color:"rgba(249, 115, 22, 0.15)"})})}),y=new Q({layers:[t,k,_],target:D.value,view:new X({center:[26e4,625e4],zoom:8})}),S=new ne({source:e,type:"Circle",geometryFunction:se()}),y.addInteraction(S),S.on("drawstart",()=>{e.clear(),o.clear(),G(),c.value=[],l.value=[],g.value=[]}),S.on("drawend",s=>{const n=s.feature.getGeometry().getExtent(),r=I(n,"EPSG:3857","EPSG:4326");m.value=r,console.log("Selected bbox:",r)})}catch(t){console.error("Failed to initialize map:",t)}}async function R(){if(!m.value){alert("Please draw a bounding box on the map first");return}if(!d.value||!u.value){alert("Please select start and end dates");return}b.value=!0,c.value=[],l.value=[],g.value=[];try{const[t,e,o,s]=m.value,n=new URL("https://api.explorer.eopf.copernicus.eu/stac/search");n.searchParams.set("bbox",`${t},${e},${o},${s}`),n.searchParams.set("datetime",`${d.value}T00:00:00Z/${u.value}T23:59:59Z`),n.searchParams.set("collections","sentinel-2-l2a"),n.searchParams.set("limit","8"),console.log("Fetching from:",n.toString());const r=await fetch(n);if(!r.ok)throw new Error(`STAC API error: ${r.status}`);const h=await r.json();h.features&&h.features.length>0?(c.value=h.features,W(h.features)):c.value=[]}catch(t){console.error("Search error:",t),c.value=[]}finally{b.value=!1}}function W(t){const e=_.getSource();if(e.clear(),t.forEach(o=>{if(o.geometry){const s=new te({geometry:new ee(o.geometry.coordinates).transform("EPSG:4326","EPSG:3857")});s.setProperties({id:o.id,datetime:o.properties.datetime,collection:o.collection,stacItem:o}),e.addFeature(s)}}),t.length>0){const o=e.getExtent();y.getView().fit(o,{padding:[50,50,50,50]}),console.log("Auto-loading all scenes..."),t.forEach((s,n)=>{setTimeout(()=>{j(s)},n*500)})}}async function j(t){var e,o;console.log("Loading scene:",t.id),l.value.push(t.id);try{const s=(e=t.assets)==null?void 0:e.reflectance;let n=null,r;if(s)n=s.href,console.log("Using reflectance asset:",n);else{const w=(o=t.links)==null?void 0:o.find(J=>J.rel==="store");w&&(n=w.href,console.log("Using store link:",n))}if(!n){console.warn("No Zarr URL found in STAC item:",t.id),l.value=l.value.filter(w=>w!==t.id);return}console.log("Loading Zarr data from:",n),s&&n.includes("/measurements/reflectance")?r={url:n.replace("/measurements/reflectance",""),group:"measurements/reflectance",bands:["b04","b03","b02"]}:r={url:n,group:"measurements/reflectance",bands:["b04","b03","b02"]},console.log("Creating GeoZarr source with config:",r);const h=new ae(r),E=new B({source:h,style:{gamma:1.5,color:["color",["interpolate",["linear"],["band",1],0,0,.5,255],["interpolate",["linear"],["band",2],0,0,.5,255],["interpolate",["linear"],["band",3],0,0,.5,255],["case",["==",["+",["band",1],["band",2],["band",3]],0],0,1]]}});y.addLayer(E),T.push(E),console.log("GeoZarr layer added to map for scene:",t.id),g.value.push(t.id)}catch(s){console.error("Failed to load scene:",s)}finally{l.value=l.value.filter(s=>s!==t.id)}}function G(){T.forEach(t=>{y.removeLayer(t)}),T=[]}function q(){k.getSource().clear(),m.value=null,_.getSource().clear(),c.value=[],l.value=[],g.value=[],G()}function C(t){return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}return(t,e)=>(p(),f("div",null,[L.value===!1?(p(),f("div",le,[...e[2]||(e[2]=[a("strong",null,"âš ï¸ WebGL Not Supported:",-1),F(" Your browser doesn't support WebGL, which is required for this demo. ",-1)])])):(p(),f("div",ie,[a("div",ce,[a("div",de,[a("div",ue,[e[4]||(e[4]=a("label",{for:"start-date"},"Start Date:",-1)),a("div",fe,[V(a("input",{id:"start-date",type:"date","onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),max:u.value,title:"Select start date for search"},null,8,pe),[[U,d.value]]),a("div",me,v(d.value?C(d.value+"T00:00:00Z"):"Not selected"),1),e[3]||(e[3]=a("span",{class:"date-icon"},"ðŸ“…",-1))])]),a("div",ve,[e[6]||(e[6]=a("label",{for:"end-date"},"End Date:",-1)),a("div",ge,[V(a("input",{id:"end-date",type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),min:d.value,max:P.value,title:"Select end date for search"},null,8,he),[[U,u.value]]),a("div",ye,v(u.value?C(u.value+"T00:00:00Z"):"Not selected"),1),e[5]||(e[5]=a("span",{class:"date-icon"},"ðŸ“…",-1))])]),a("div",be,[a("button",{onClick:R,disabled:b.value||!m.value,class:"button"},v(b.value?"Searching...":"ðŸ” Search"),9,we),a("button",{onClick:q,class:"button border"}," Clear ")])]),m.value?x("",!0):(p(),f("div",Se,[...e[7]||(e[7]=[a("strong",null,"Draw a bounding box:",-1),F(" Click and drag on the map to define your search area. ",-1)])]))]),a("div",{ref_key:"mapRef",ref:D,class:"map-container"},null,512),c.value.length>0?(p(),f("div",_e,[a("h3",null,"ðŸ›°ï¸ Found "+v(c.value.length)+" Sentinel-2 scenes",1),e[8]||(e[8]=a("p",null,"Loading satellite imagery automatically...",-1)),l.value.length>0?(p(),f("div",xe," â³ Loading "+v(l.value.length)+" scene(s)... ",1)):x("",!0),g.value.length>0?(p(),f("div",Le," âœ… "+v(g.value.length)+" of "+v(c.value.length)+" scenes loaded ",1)):x("",!0)])):!b.value&&m.value?(p(),f("div",De," No results found for the selected area and time range. Try expanding your search criteria. ")):x("",!0)]))]))}}),ze=Y(Te,[["__scopeId","data-v-47789319"]]);export{$e as __pageData,ze as default};
