var gi=Object.defineProperty;var lt=n=>{throw TypeError(n)};var fi=(n,e,t)=>e in n?gi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var N=(n,e,t)=>fi(n,typeof e!="symbol"?e+"":e,t),Oe=(n,e,t)=>e.has(n)||lt("Cannot "+t);var v=(n,e,t)=>(Oe(n,e,"read from private field"),t?t.call(n):e.get(n)),x=(n,e,t)=>e.has(n)?lt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),P=(n,e,t,i)=>(Oe(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),T=(n,e,t)=>(Oe(n,e,"access private method"),t);import{i as tt,x as B,E as mi,e as pi,a as _i}from"./addCommonStyleSheet.BIp1szw2.js";import{S as yi,c as bi,i as vi,f as Ci,d as wi,r as xi,b as F,a as E,g as ct,e as Ft,h as Si,j as it,P as Me,k as It,F as Pi,T as Ti,s as Pe,V as D,l as Re,n as Ei,m as $e,o as Li,I as Fi,E as G,M,p as Ii,q as Te,t as I,u as H,L as K,v as ht,w as ki,x as kt,y as Mt,z as Mi,A as Rt,B as st,G as Ri,C as Nt,D as Ni,H as qe,J as Ai,K as Vi,N as ji,R as Oi,O as ae,Q as dt,U as ut,W as De,X as A,Y as k,Z as Ee,_ as At,$ as Di,a0 as Vt,a1 as Gi,a2 as zi,a3 as Ui,a4 as Bi,a5 as Hi,a6 as Ne,a7 as Zi,a8 as Wi,a9 as Y,aa as nt,ab as j,ac as $i,ad as Ae,ae as qi,af as Ke,ag as we,ah as gt,ai as Ki,aj as jt,ak as Yi,al as Ji,am as ot,an as Z,ao as Ot,ap as Xi,aq as Qi,ar as Dt,as as es,at as ts,au as is,av as ss,aw as ns,ax as os,ay as rs,az as xe,aA as as,aB as ls,aC as Ye,aD as cs,aE as hs,aF as ds,aG as Gt,aH as us,aI as gs,aJ as fs,aK as ms,aL as Je,aM as ps,aN as zt,aO as _s,aP as ys,aQ as Ut,aR as Bt,aS as bs,aT as vs,aU as Cs,aV as z,aW as te,aX as Le,aY as ws,aZ as Ve,a_ as Fe,a$ as oe,b0 as ft,b1 as U,b2 as xs,b3 as Ss,b4 as Ht,b5 as mt,b6 as Ps,b7 as rt,b8 as pt,b9 as Ts,ba as Es,bb as Zt,bc as Ls,bd as Wt,be as $t,bf as Fs,bg as Is,bh as ks,bi as Ms,bj as Rs,bk as Ns,bl as As,bm as Vs}from"./WMTS.DqfTZ5CB.js";import{g as js}from"./getElement.CdRlZPdn.js";const Os=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.ol-overviewmap .ol-viewport:hover{cursor:pointer}';class je extends yi{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new je(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const o=this.flatCoordinates,r=e-o[0],a=t-o[1],l=r*r+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)i[h]=o[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=o[0]+h*r,i[1]=o[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=o[c]}return i.length=this.stride,l}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],o=t-i[1];return s*s+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return bi(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(vi(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Ci(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let o=1;o<t;++o)s[t+o]=e[o];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let o=wi(s,0,e,this.stride);s[o++]=s[0]+t;for(let r=1,a=this.stride;r<a;++r)s[o++]=s[r];s.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(xi(i,0,i.length,s,e,t,i)),this.changed()}}je.prototype.transform;const pe={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class _e extends st{constructor(e,t){super(e),this.feature=t}}function Ds(n,e){const t=[];for(let i=0;i<e.length;++i){const o=e[i].getGeometry();qt(n,o,t)}return t}function ye(n,e){return Nt(n[0],n[1],e[0],e[1])}function $(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function be(n,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const o=Math.ceil(i),r=Math.floor(s);if(o>r){const l=q(n,i),h=q(n,s);return ye(l,h)}let a=0;if(i<o){const l=q(n,i),h=$(n,o);a+=ye(l,h)}if(r<s){const l=$(n,r),h=q(n,s);a+=ye(l,h)}for(let l=o;l<r-1;++l){const h=$(n,l),c=$(n,l+1);a+=ye(h,c)}return a}function qt(n,e,t){if(e instanceof K){ve(n,e.getCoordinates(),!1,t);return}if(e instanceof kt){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)ve(n,i[s],!1,t);return}if(e instanceof Me){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)ve(n,i[s],!0,t);return}if(e instanceof Mt){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a)ve(n,r[a],!0,t)}return}if(e instanceof Ri){const i=e.getGeometries();for(let s=0;s<i.length;++s)qt(n,i[s],t);return}}const Ge={index:-1,endIndex:NaN};function Gs(n,e,t,i){const s=n[0],o=n[1];let r=1/0,a=-1,l=NaN;for(let g=0;g<e.targets.length;++g){const d=e.targets[g],u=d.coordinates;let f=1/0,m;for(let p=0;p<u.length-1;++p){const _=u[p],y=u[p+1],b=Kt(s,o,_,y);b.squaredDistance<f&&(f=b.squaredDistance,m=p+b.along)}f<r&&(r=f,d.ring&&e.targetIndex===g&&(d.endIndex>d.startIndex?m<d.startIndex&&(m+=u.length):d.endIndex<d.startIndex&&m>d.startIndex&&(m-=u.length)),l=m,a=g)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const g=q(h.coordinates,l),d=t.getPixelFromCoordinate(g);Te(d,e.startPx)>i&&(c=!1)}if(c){const g=h.coordinates,d=g.length,u=h.startIndex,f=l;if(u<f){const m=be(g,u,f);be(g,u,f-d)<m&&(l-=d)}else{const m=be(g,u,f);be(g,u,f+d)<m&&(l+=d)}}return Ge.index=a,Ge.endIndex=l,Ge}function ve(n,e,t,i){const s=n[0],o=n[1];for(let r=0,a=e.length-1;r<a;++r){const l=e[r],h=e[r+1],c=Kt(s,o,l,h);if(c.squaredDistance===0){const g=r+c.along;i.push({coordinates:e,ring:t,startIndex:g,endIndex:g});return}}}const ze={along:0,squaredDistance:0};function Kt(n,e,t,i){const s=t[0],o=t[1],r=i[0],a=i[1],l=r-s,h=a-o;let c=0,g=s,d=o;return(l!==0||h!==0)&&(c=qe(((n-s)*l+(e-o)*h)/(l*l+h*h),0,1),g+=l*c,d+=h*c),ze.along=c,ze.squaredDistance=Ni(Nt(n,e,g,d),10),ze}function q(n,e){const t=n.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let o=i+1;o>=t&&(o-=t);const r=n[i],a=r[0],l=r[1],h=n[o],c=h[0]-a,g=h[1]-l;return[a+c*s,l+g*s]}class zs extends It{constructor(e){const t=e;t.stopDown||(t.stopDown=Pi),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Hs(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Ti,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=(o,r,a)=>{const l=r||new je([NaN,NaN]),h=E(o[0]),c=Pe(h,E(o[o.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let o;s==="Point"?o=H:s==="LineString"?o=K:s==="Polygon"&&(o=Me),i=(r,a,l)=>(a?s==="Polygon"?r[0].length?a.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(r,this.geometryLayout_):a=new o(r,this.geometryLayout_),a)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new D({source:new Re({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Us(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Ei,this.freehandCondition_,e.freehand?this.freehandCondition_=$e:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Li,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Fi.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=$e:t=e:t=Mi,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===G.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===M.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===M.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===M.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===M.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===M.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===M.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===M.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Ii(M.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=F([i,s]),r=this.traceSource_.getFeaturesInExtent(o);if(r.length===0)return;const a=Ds(e.coordinate,r);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-s+1}else{const s=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=s-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const o=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let a=o;a<=r;++a)s.push($(e.coordinates,a))}else{const o=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let a=o;a>=r;--a)s.push($(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Te(t.startPx,e.pixel)<this.snapTolerance_)return;const i=Gs(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const o=q(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],o=t[1]-i[1],r=s*s+o*o;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,o=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,o=[a[0][0],a[0][a[0].length-2]],t?o=[a[0][0]]:o=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,h=o.length;l<h;l++){const c=o[l],g=a.getPixelFromCoordinate(c),d=e[0]-g[0],u=e[1]-g[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+u*u)<=f,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new I(new H(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new I);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new K(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=ht(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new I(new K(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new I,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new _e(pe.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),o=ht(this.geometryLayout_);let r,a;for(;e.length<o;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],a=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,a=r[r.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,o;const r=this.mode_;return r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):r==="Polygon"&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),s&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let o=0;o<e;++o){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const a=this.finishCoordinate_.slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(r,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const a=this.sketchLine_.getGeometry();if(r.length>=2){const l=r[r.length-2].slice();r[r.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new ki([t])):this.type_==="MultiLineString"?e.setGeometry(new kt([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Mt([t])),this.dispatchEvent(new _e(pe.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new _e(pe.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new I(new H(s)),this.updateSketchFeatures_(),this.dispatchEvent(new _e(pe.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Us(){const n=Rt();return function(e,t){return n[e.getGeometry().getType()]}}function Bs(){return function(n,e,t){const i=F([n[0],n[n.length-1]].map(function(o){return E(o)})),s=[[ct(i),Ft(i),Si(i),it(i),ct(i)]];return e?e.setCoordinates(s):e=new Me(s),e}}function Hs(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const _t=0,re=1,yt=[0,0,0,0],J=[],Ue={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Be extends st{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Zs extends It{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Ai,this.defaultDeleteCondition_=function(i){return Vi(i)&&ji(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:$e,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Oi,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new D({source:new Re({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:$s(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new ae(this.source_.getFeatures()),this.source_.addEventListener(dt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(dt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ut.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ut.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(i.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(G.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new ae;const i=this.featuresBeingModified_.getArray();for(let s=0,o=t.length;s<o;++s){const r=t[s].feature;r&&!i.includes(r)&&this.featuresBeingModified_.push(r)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Be(Ue.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(G.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const o=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===o&&this.dragSegments_.splice(r,1);t.remove(o)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length-1;s<o;++s){const r=i.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert(F(r),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const h=r.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(F(h),c)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const h=r.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(F(h),c)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a){const h=r[a];for(let c=0,g=h.length-1;c<g;++c){const d=h.slice(c,c+2),u={feature:e,geometry:t,depth:[a,s],index:c,segment:d};this.rBush_.insert(F(d),u)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:_t,segment:[i,i]},o={feature:e,geometry:t,index:re,segment:[i,i]},r=[s,o];s.featureSegments=r,o.featureSegments=r,this.rBush_.insert(De(i),s);let a=t;this.rBush_.insert(a.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const o=i[s],r=this.SEGMENT_WRITERS_[o.getType()];r(e,o)}}createOrUpdateVertexFeature_(e,t,i,s){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(e):(o=new I(new H(e)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",t),o.set("geometries",i),o.set("existing",s),o}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==M.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=M.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==M.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;this.getMap().getView().getProjection();const i=[],s=t.getGeometry().getCoordinates(),o=F([s]),r=this.rBush_.getInExtent(o),a={};r.sort(Ws);for(let l=0,h=r.length;l<h;++l){const c=r[l],g=c.segment;let d=A(c.geometry);const u=c.depth;if(u&&(d+="-"+u.join("-")),a[d]||(a[d]=new Array(2)),c.geometry.getType()==="Circle"&&c.index===re){const f=vt(e,c);k(f,s)&&!a[d][0]&&(this.dragSegments_.push([c,0]),a[d][0]=c);continue}if(k(g[0],s)&&!a[d][0]){this.dragSegments_.push([c,0]),a[d][0]=c;continue}if(k(g[1],s)&&!a[d][1]){if(a[d][0]&&a[d][0].index===0){let f=c.geometry.getCoordinates();switch(c.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":f=f[u[1]];case"Polygon":if(c.index!==f[u[0]].length-2)continue;break}}this.dragSegments_.push([c,1]),a[d][1]=c;continue}A(g)in this.vertexSegments_&&!a[d][0]&&!a[d][1]&&i.push(c)}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[];for(let o=0,r=this.dragSegments_.length;o<r;++o){const a=this.dragSegments_[o],l=a[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;s.includes(c)||s.push(c);const g=l.depth;let d;const u=l.segment,f=a[1];for(;t.length<c.getStride();)t.push(u[f][t.length]);switch(c.getType()){case"Point":d=t,u[0]=t,u[1]=t;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=t,u[0]=t,u[1]=t;break;case"LineString":d=c.getCoordinates(),d[l.index+f]=t,u[f]=t;break;case"MultiLineString":d=c.getCoordinates(),d[g[0]][l.index+f]=t,u[f]=t;break;case"Polygon":d=c.getCoordinates(),d[g[0]][l.index+f]=t,u[f]=t;break;case"MultiPolygon":d=c.getCoordinates(),d[g[1]][g[0]][l.index+f]=t,u[f]=t;break;case"Circle":const m=c;if(u[0]=t,u[1]=t,l.index===_t)this.changingFeature_=!0,m.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let p=Te(E(m.getCenter()),E(t));m.setRadius(p),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(t,i,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i!=null&&i.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let o=i.length-1;o>=0;--o)this.insertVertex_(i[o],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const o=s,r=o.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=r,a.segment[1]=r,l.segment[0]=r,l.segment[1]=r,this.rBush_.update(De(r),a);let h=o;this.rBush_.update(h.getExtent(),l)}else this.rBush_.update(F(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Be(Ue.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const s=function(a,l){return bt(e,a)-bt(e,l)};let o,r;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(l,h,c)=>{c&&c.getType()==="Point"&&(c=new H(Ee(c.getCoordinates())));const g=c||l.getGeometry();if(g&&g.getType()==="Point"&&l instanceof I&&this.features_.getArray().includes(l)){r=g;const d=l.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:l,geometry:r,segment:[d,d]}]}return!0},{layerFilter:a})}if(!o){const a=At(De(e,yt)),l=t.getView().getResolution()*this.pixelTolerance_,h=Di(Vt(a,l,yt));o=this.rBush_.getInExtent(h)}if(o&&o.length>0){const a=o.sort(s)[0],l=a.segment;let h=vt(e,a);const c=t.getPixelFromCoordinate(h);let g=Te(i,c);if(r||g<=this.pixelTolerance_){const d={};if(d[A(l)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),a.geometry.getType()==="Circle"&&a.index===re)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);else{const u=t.getPixelFromCoordinate(l[0]),f=t.getPixelFromCoordinate(l[1]),m=Pe(c,u),p=Pe(c,f);if(g=Math.sqrt(Math.min(m,p)),this.snappedToVertex_=g<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=m>p?l[1]:l[0]),this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);const _={};_[A(a.geometry)]=!0;for(let y=1,b=o.length;y<b;++y){const L=o[y].segment;if(k(l[0],L[0])&&k(l[1],L[1])||k(l[0],L[1])&&k(l[1],L[0])){const R=A(o[y].geometry);R in _||(_[R]=!0,d[A(L)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,o=e.geometry,r=e.depth,a=e.index;let l;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"Polygon":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"MultiPolygon":l=o.getCoordinates(),l[r[1]][r[0]].splice(a+1,0,t);break;case"LineString":l=o.getCoordinates(),l.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(o,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(o,a,r,1);const c={segment:[i[0],t],feature:s,geometry:o,depth:r,index:a};h.insert(F(c.segment),c),this.dragSegments_.push([c,1]);const g={segment:[t,i[1]],feature:s,geometry:o,depth:r,index:a+1};return h.insert(F(g.segment),g),this.dragSegments_.push([g,0]),!0}updatePointer_(e){var t;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates()}getPoint(){var t;const e=(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates();return e?Ee(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(F([e])).some(({segment:i})=>k(i[0],e)||k(i[1],e))}removePoint(e){if(e&&(e=E(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=M.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Be(Ue.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,o,r,a,l,h,c,g,d,u,f;for(l=e.length-1;l>=0;--l)r=e[l],u=r[0],f=A(u.feature),u.depth&&(f+="-"+u.depth.join("-")),f in t||(t[f]={}),r[1]===0?(t[f].right=u,t[f].index=u.index):r[1]==1&&(t[f].left=u,t[f].index=u.index+1);for(f in t){switch(d=t[f].right,c=t[f].left,h=t[f].index,g=h-1,c!==void 0?u=c:u=d,g<0&&(g=0),a=u.geometry,o=a.getCoordinates(),s=o,i=!1,a.getType()){case"MultiLineString":o[u.depth[0]].length>2&&(o[u.depth[0]].splice(h,1),i=!0);break;case"LineString":o.length>2&&(o.splice(h,1),i=!0);break;case"MultiPolygon":s=s[u.depth[1]];case"Polygon":s=s[u.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),i=!0,h===0&&(s.pop(),s.push(s[0]),g=s.length-1));break}if(i){this.setGeometryCoordinates_(a,o);const m=[];if(c!==void 0&&(this.rBush_.remove(c),m.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),m.push(d.segment[1])),c!==void 0&&d!==void 0){const p={depth:u.depth,feature:u.feature,geometry:u.geometry,index:g,segment:m};this.rBush_.insert(F(p.segment),p)}this.updateSegmentIndices_(a,h,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(F([e])).some(({segment:i})=>!(k(i[0],e)||k(i[1],e)))}insertPoint(e){var s;const t=e?E(e,this.getMap().getView().getProjection()):(s=this.vertexFeature_)==null?void 0:s.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((o,r)=>o||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(i===void 0||o.depth===void 0||Gi(o.depth,i))&&o.index>t&&(o.index+=s)})}}function Ws(n,e){return n.index-e.index}function bt(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let o=i;if(e.index===re){const r=Pe(o.getCenter(),E(n)),a=Math.sqrt(r)-o.getRadius();return a*a}}const s=E(n);return J[0]=E(e.segment[0]),J[1]=E(e.segment[1]),Ui(s,J)}function vt(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===re)return Ee(i.getClosestPoint(E(n)));const s=E(n);return J[0]=E(e.segment[0]),J[1]=E(e.segment[1]),Ee(zi(s,J))}function $s(){const n=Rt();return function(e,t){return n.Point}}const qs='.geolocation{top:85px;left:.5em}.geolocation button{background:var(--primary);color:var(--on-primary)}.geolocation button>svg{fill:var(--on-primary);min-inline-size:1.25rem!important;max-inline-size:1.25rem!important;min-block-size:1.25rem!important;max-block-size:1.25rem!important}.ol-touch.geolocation{top:100px}.loading-indicator{position:absolute;pointer-events:none!important;display:flex;align-items:center;justify-content:center;background-color:#0000}.loading-indicator.small{bottom:.5em;left:.5em;width:30px;height:30px}.loading-indicator.fullscreen{width:100%;height:100%}.disabled{filter:brightness(1.7);pointer-events:none}.ol-unselectable{pointer-events:none}.ol-control{background:none}.ol-control button,.ol-control button:hover,.ol-control button:focus{--_round: 32px;border-radius:var(--_round);background:var(--primary);color:var(--on-primary);width:32px;height:32px;cursor:pointer;border:none;outline:none;pointer-events:all;position:relative;font-size:1rem}.ol-control button:hover:after{background-size:15000%;opacity:.1;transition:background-size var(--speed2) linear;content:"";position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;border-radius:inherit;inline-size:100%;block-size:100%;background-position:center;background-image:radial-gradient(circle,currentColor 1%,transparent 1%)}.ol-control button.ol-zoom-in,.ol-control button.ol-zoom-in:hover{border-top-left-radius:var(--_round);border-top-right-radius:var(--_round);border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem;margin-bottom:.125rem}.ol-control button.ol-zoom-out,.ol-control button.ol-zoom-out:hover{border-top-left-radius:.5rem;border-top-right-radius:.5rem;border-bottom-left-radius:var(--_round);border-bottom-right-radius:var(--_round)}';/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ks=(n,e,t)=>{for(const i of e)if(i[0]===n)return(0,i[1])();return t==null?void 0:t()};var Ie,Yt;class Ys extends tt{constructor(){super();x(this,Ie);this.value=50,this.enabled="true"}static get properties(){return{value:{attribute:"value",type:Number},enabled:{attribute:"enabled",type:String}}}render(){return B`
      <style>
        :host {
          display: block;
          --thumb-size: 3rem;
        }
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: var(--thumb-size);

          position: relative;
          height: 100%;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
        .slider-bar,
        .slider-thumb {
          position: absolute;
          box-shadow: 0 0.125rem 0.125rem 0 rgb(0 0 0 / 0.32);
        }
        .slider-bar {
          pointer-events: none;
          top: 0;
          width: 0.3rem;
          height: 100%;
          background-color: var(--thumb-bgc);
          z-index: 2;
          left: calc(${this.value}% - 0.15rem);
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .slider-thumb {
          pointer-events: none;
          top: calc(50% - var(--thumb-size) / 2);
          background: var(--primary);
          z-index: 3;
          width: var(--thumb-size);
          aspect-ratio: 1;
          left: calc(${this.value}% - var(--thumb-size) / 2);
          border-radius: 50%;
          padding: 0.7rem;
          color: var(--on-primary);
          display: flex;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
        }
        .slider-thumb svg {
          fill: currentColor;
        }
      </style>
      ${Ks(this.enabled,[["first",()=>B`<slot name="first"></slot>`],["second",()=>B`<slot name="second"></slot>`]],()=>B`
          <div class="eox-map-compare">
            <div class="eox-map-compare__first">
              <slot name="first"></slot>
            </div>
            <div class="eox-map-compare__second">
              <slot name="second"></slot>
            </div>
            <input
              type="range"
              class="eox-map-compare__range"
              min="0"
              max="100"
              value=${this.value}
              @input=${T(this,Ie,Yt)}
            />
            <div class="slider-bar"></div>
            <div class="slider-thumb">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title>arrow-left-right</title>
                <path
                  d="M6.45,17.45L1,12L6.45,6.55L7.86,7.96L4.83,11H19.17L16.14,7.96L17.55,6.55L23,12L17.55,17.45L16.14,16.04L19.17,13H4.83L7.86,16.04L6.45,17.45Z"
                />
              </svg>
            </div>
          </div>
        `)}
    `}}Ie=new WeakSet,Yt=function(t){this.value=parseInt(t.target.value)};customElements.define("eox-map-compare",Ys);const Jt={dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"};function Xt(n,e,t,i=!1,s=!1,o=!0){const r=i?[n.feature]:n.features;s&&e.getSource().clear();const a=e.getSource().getFeatures();if(!e.get("multipleFeatures")&&(a.length||r.length>1))return console.error("Multiple features detected!");r.forEach(c=>{const g=c.getGeometry();if(g instanceof K){const u=Bi(g,{radius:6378137,projection:t.projection});c.set("measure",u)}else if(g instanceof Me){const u=Hi(g,{radius:6378137,projection:t.projection});c.set("measure",u)}const d=A(c);c.set("id",d),c.setId(d)}),!i&&r.length&&(e.getSource().addFeatures(r),t.map.getView().fit(e.getSource().getExtent(),{duration:o?750:0}));const l=new Ne,h=JSON.parse(l.writeFeatures(r,Jt));(i||s)&&Ct(t,"drawend",n,h),Ct(t,"addfeatures",n,h)}function Ct(n,e,t,i){const s=new CustomEvent(e,{detail:{originalEvent:t,geoJSON:i}});n.dispatchEvent(s)}function Qt(n){n.setRotation(n.getRotation())}function Js(n,e){const o=n.readFeatures(e)[0].getGeometry().getCoordinates();if(o&&o.length>0){const r=o[0][0][0];return r>=-180&&r<=180?"EPSG:4326":"EPSG:3857"}}function Xs(n,e,t,i=!1,s=!0){try{const o=Qs(n);if(!o){console.error("Unsupported format or invalid data");return}const r=Js(o,n),a=o.readFeatures(n,{dataProjection:r||Jt.dataProjection,featureProjection:t.projection});Xt({features:a},e,t,!1,i,s)}catch(o){console.error("Error parsing data:",o)}}function Qs(n){return en(n)?new Ne:tn(n)?new Zi({extractStyles:!1}):sn(n)?new Wi:null}function en(n){try{const e=JSON.parse(n);return e.type==="FeatureCollection"||e.type==="Feature"}catch{return!1}}function tn(n){return n.includes("<kml")&&n.includes("</kml>")}function sn(n){try{const e=JSON.parse(n);return e.type==="Topology"&&e.objects}catch{return!1}}function nn(n,e,t=void 0){Y.defs(n,e),nt(Y),typeof t<"u"&&j(n).setExtent(t)}async function on(n){return nt(Y),await $i(n)}function rn(n){return new Ne().writeFeaturesObject(n)}function ei(n,e,t=void 0){return t||(t="EPSG:4326"),Ae(n,e,t)}function ti(n,e,t=void 0){return t||(t="EPSG:4326"),qi(n,e,t)}function wt(n,e=!1){e?(n.addInteraction(new Ke({condition:gt})),"ontouchstart"in window||navigator.maxTouchPoints>0?n.addInteraction(new we({condition:function(i){return this.getPointerCount()===2||gt(i)}})):n.addInteraction(new we)):(n.addInteraction(new Ke),n.addInteraction(new we))}function an(n){n.getInteractions().getArray().forEach(e=>{(e instanceof Ke||e instanceof we)&&n.removeInteraction(e)})}function ln(n,e,t=.001){let i=!0;for(let s=n.length-1;s>=0;--s)if(!cn(n[s],e[s],t)){i=!1;break}return i}function cn(n,e,t=.001){return Math.abs(n-e)<t}function ii(n){if(n){const e=n;return!k(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90?Ki(e):e}return[0,0]}function hn(n,e,t){const i=Object.assign({},t);if(n.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const s=e.getSource();i.type==="Box"&&(i.geometryFunction=Bs(),i.type="Circle");const o=new zs({...i,source:s});i.active===!1&&o.setActive(!1),o.on("drawend",l=>{e.get("isDrawingEnabled")&&Xt(l,e,n,!0)}),n.map.addInteraction(o),n.interactions[i.id]=o;const r=new Zs({source:s});r.setActive(i.modify),n.map.addInteraction(r),n.interactions[`${i.id}_modify`]=r;const a=()=>{n.getLayerById(e.get("id"))||(n.removeInteraction(i.id),n.removeInteraction(`${i.id}_modify`),n.map.getLayerGroup().un("change",a))};n.map.getLayerGroup().on("change",a)}const S={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class si extends jt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Yi,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(S.ELEMENT,this.handleElementChanged),this.addChangeListener(S.MAP,this.handleMapChanged),this.addChangeListener(S.OFFSET,this.handleOffsetChanged),this.addChangeListener(S.POSITION,this.handlePositionChanged),this.addChangeListener(S.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(S.ELEMENT)}getId(){return this.id}getMap(){return this.get(S.MAP)||null}getOffset(){return this.get(S.OFFSET)}getPosition(){return this.get(S.POSITION)}getPositioning(){return this.get(S.POSITIONING)}handleElementChanged(){Ji(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),ot(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Z(e,Ot.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(S.ELEMENT,e)}setMap(e){this.set(S.MAP,e)}setOffset(e){this.set(S.OFFSET,e)}setPosition(e){this.set(S.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(S.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),o=this.getRect(s,[Xi(s),Qi(s)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Dt(i,o)){const a=o[0]-i[0],l=i[2]-o[2],h=o[1]-i[1],c=i[3]-o[3],g=[0,0];if(a<0?g[0]=a-r:l<0&&(g[0]=Math.abs(l)+r),h<0?g[1]=h-r:c<0&&(g[1]=Math.abs(c)+r),g[0]!==0||g[1]!==0){const d=t.getView().getCenterInternal(),u=t.getPixelFromCoordinateInternal(d);if(!u)return;const f=[u[0]+g[0],u[1]+g[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:m.duration,easing:m.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[s,o,s+t[0],o+t[1]]}setPositioning(e){this.set(S.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const r=`${e[0]+s[0]}px`,a=`${e[1]+s[1]}px`;let l="0%",h="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?h="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${r}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}class dn extends tt{static get properties(){return{feature:{attribute:!1,property:!0,type:Object},propertyTransform:{attribute:!1,property:!0,type:Function}}}constructor(){super(),this.feature=null,this.propertyTransform=(e,t)=>e}render(){return this.feature?B` <style>
            ul {
              margin: 0;
              padding: 1rem 1rem 1rem 2rem;
              border-radius: 0.5rem;
              max-width: 250px;
              font-size: small;
              background-color: var(--inverse-surface);
              color: var(--inverse-on-surface);
              box-shadow: 0 0.25rem 0.5rem 0 rgb(0 0 0 / 0.4);
              line-height: normal;
              white-space: normal;
            }
            span {
              font-weight: bold;
            }
          </style>
          <ul>
            ${Object.entries(this.feature.getProperties()).map(([e,t])=>this.propertyTransform({key:e,value:t},this.feature)).filter(e=>e).map(({key:e,value:t})=>B`<li><span>${e}</span>: ${t}</li>`)}
          </ul>`:mi}}customElements.define("eox-map-tooltip",dn);class ni extends es{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ts,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,s){const o=j(i),r=this.getProjection();r&&r!==o&&(t=is(r,o,e,t),e=Ae(e,o,r));const a={url:this.url_,params:{...this.params_,...s},projection:r||o};return ss(a,e,t)}getLegendUrl(e,t){return ns({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=os({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(o,r)=>(this.image.setImage(o),this.imageLoadFunction_(this.image,r),rs(o))})),super.getImageInternal(e,t,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const un={GeoJSON:Ne,MVT:fs},gn={Group:Ye,Image:ls,Tile:as,Vector:D,VectorTile:xe},fn={ImageWMS:ni,OSM:gs,Tile:us,TileWMS:Gt,Vector:Re,VectorTile:ds,WMTS:hs,XYZ:cs};function ie(n,e,t=!0){var r;e=JSON.parse(JSON.stringify(e));const s={...window.eoxMapAdvancedOlLayers,...gn}[e.type];if(!s)throw new Error(`Layer type ${e.type} not supported!`);const o=new s({...e,...e.type!=="MapboxStyle"&&e.source&&{source:oi(e.source)},...e.type==="Group"&&{layers:[]},...e.properties,style:void 0});if(o.set("_jsonDefinition",e,!0),e.type==="Group"){const a=e.layers.reverse().map(l=>ie(n,l));a.forEach(l=>l.set("_group",o,!0)),o.setLayers(new ae(a))}if("style"in e&&o.setStyle(e.style),t&&((r=e.interactions)!=null&&r.length))for(let a=0;a<e.interactions.length;a++){const l=e.interactions[a];ri(n,o,l)}return li(o,e),o}function oi(n){const t={...window.eoxMapAdvancedOlSources,...fn}[n.type];if(n&&!t)throw new Error(`Source type ${n.type} not supported!`);const i={...window.eoxMapAdvancedOlFormats,...un},s=xn(n);return new t({...n,..."format"in n&&n.type!=="WMTS"&&{format:new i[typeof n.format=="object"?n.format.type:n.format]({...typeof n.format=="object"&&{...n.format}})},..."source"in n&&{source:oi(n.source)},..."tileGrid"in n&&{tileGrid:s},..."projection"in n&&{projection:j(n.projection)}})}function ri(n,e,t){t.type==="draw"?hn(n,e,t.options):t.type==="select"?_n(n,e,t.options):t.type==="clusterExplode"&&wn(n,e,t.options)}function ai(n,e,t){var o,r,a,l;const i=t.get("_jsonDefinition");if(e.type!==i.type||e.type!=="MapboxStyle"&&((o=e.source)==null?void 0:o.type)!==((r=i.source)==null?void 0:r.type))throw new Error("Layers are not compatible to be updated");const s=ie(n,e,!1);if(e.type!=="MapboxStyle"&&JSON.stringify(e.source)!==JSON.stringify(i.source)&&t.setSource(s.getSource()),e.type==="MapboxStyle"&&JSON.stringify(e.properties.mapboxStyle)!==JSON.stringify(i.properties.mapboxStyle)&&(t.getLayers().clear(),t.applyMapboxStyle(e.properties.mapboxStyle,e.properties.applyOptions)),["Vector","VectorTile"].includes(e.type)&&JSON.stringify(e.style)!==JSON.stringify(i.style)&&t.setStyle(s.getStyle()),JSON.stringify(e.properties)!==JSON.stringify(i.properties)&&t.setProperties(e.properties),e.visible!==i.visible&&t.setVisible(e.visible),e.opacity&&e.opacity!==i.opacity&&t.setOpacity(e.opacity),JSON.stringify(e.interactions)!==JSON.stringify(i.interactions)&&((a=i.interactions)==null||a.forEach(h=>{const c=e.interactions.find(g=>{var d,u;return g.type===h.type&&((d=g.options)==null?void 0:d.id)===((u=h.options)==null?void 0:u.id)});c?c.type==="draw"?(n.interactions[c.options.id].setActive(c.options.active),n.interactions[`${c.options.id}_modify`].setActive(c.options.modify)):(n.selectInteractions[c.options.id]||n.interactions[c.options.id]).setActive(c.options.active):h.type==="select"?n.removeSelect(h.options.id):n.removeInteraction(h.options.id)}),(l=e.interactions)==null||l.forEach(h=>{i.interactions.find(g=>{var d,u;return g.type===h.type&&((d=g.options)==null?void 0:d.id)===((u=h.options)==null?void 0:u.id)})||ri(n,t,h)})),e.type==="Group"){const h=e.layers.map(u=>{var f;return(f=u.properties)==null?void 0:f.id}),c=t.getLayers();c.getArray().slice().forEach(u=>{h.includes(u.get("id"))||c.remove(u)}),e.layers.forEach(u=>{const f=u.properties.id;if(c.getArray().map(m=>m.get("id")).includes(f))ai(n,u,n.getLayerById(f));else{const m=ie(n,u);c.push(m)}});const d=h.toReversed();c.getArray().sort((u,f)=>d.indexOf(u.get("id"))-d.indexOf(f.get("id"))),c.changed()}return li(t,e),t.set("_jsonDefinition",e,!0),t}const mn=(n,e)=>e?[...e].reverse().map(t=>ie(n,t)):[];function li(n,e){n.on("change:opacity",()=>{e.opacity=n.getOpacity()}),n.on("change:visible",()=>{e.visible=n.getVisible()}),n.on("change:zIndex",()=>{e.zIndex=n.getZIndex()}),n.on("propertychange",t=>{t.key!=="map"&&(e.properties[t.key]=t.target.get(t.key))})}class pn{constructor(e,t,i){N(this,"panIntoFeature",(e,t)=>{const i=e instanceof I||e instanceof ms?e.getGeometry().getExtent():e;this.eoxMap.map.getView().fit(i,t||{duration:750})});var h,c,g;this.eoxMap=e,this.selectLayer=t,this.options=i,this.active=i.active||t.getVisible(),this.panIn=i.panIn||!1,this.tooltip=i.tooltip!==!1;const s=this.eoxMap.map.getOverlayById("eox-map-tooltip");let o;this.tooltip&&(s?(this.tooltipElement=s.getElement(),o=s):(this.tooltipElement=this.eoxMap.querySelector("eox-map-tooltip")||this.eoxMap.querySelector("[is=eox-map-tooltip]")||((h=i.overlay)==null?void 0:h.element),this.tooltipElement&&(o=new si({element:this.tooltipElement,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(o))));const r=()=>{o&&i.condition==="pointermove"&&o.setPosition(void 0)};e.map.on("change:target",d=>{var u,f;(u=d.oldValue)==null||u.removeEventListener("pointerleave",r),(f=d.target.getTargetElement())==null||f.addEventListener("pointerleave",r)}),(c=e.map.getTargetElement())==null||c.addEventListener("pointerleave",r);const a=d=>{var p,_,y,b;i!=null&&i.projection&&(Y.defs((p=i.projection)==null?void 0:p.name)||(Y.defs((_=i.projection)==null?void 0:_.name,(y=i==null?void 0:i.projection)==null?void 0:y.proj4_string),nt(Y)));const u=j(((b=i==null?void 0:i.projection)==null?void 0:b.name)||"EPSG:4326"),f=e.map.getView().getProjection().getCode(),m=Ae(d.coordinate,f,u);return{lon:m[0].toFixed((i==null?void 0:i.precision)||2),lat:m[1].toFixed((i==null?void 0:i.precision)||2)}},l=d=>Object.values(d).every(u=>u===0);if(this.selectLayer instanceof D||this.selectLayer instanceof xe){this.selectedFids=[];let d;if(this.options.layer)d=this.options.layer;else{const m=this.selectLayer.get("_jsonDefinition");d={...m,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:m.type}}}d.renderMode="vector",delete d.interactions,this.selectStyleLayer=ie(e,d),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const u=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((m,p)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(m))?u(m,p):null),this.listener=m=>{if(!this.active||m.dragging)return;const p=this.eoxMap.map.getView().getZoom();if(p<this.selectLayer.getMinZoom()||p>this.selectLayer.getMaxZoom())return;const _=this.eoxMap.map.forEachFeatureAtPixel(m.pixel,R=>R,{layerFilter:R=>R===this.selectLayer}),y=_?[this.getId(_)]:[],b=this.selectedFids[0]!==y[0];if(this.selectedFids=y,b&&(this.selectStyleLayer.changed(),_&&this.panIn&&this.panIntoFeature(_)),o){const R=m.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",ui=m.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";o.setPositioning(`${ui}-${R}`),o.setPosition(_?m.coordinate:null),_&&this.tooltipElement&&(this.tooltipElement.feature=_)}const L=new CustomEvent("select",{detail:{id:i.id,originalEvent:m,feature:_}});this.eoxMap.dispatchEvent(L)},this.eoxMap.map.on(i.condition||"click",this.listener),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const m=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(m),this.setActive(m)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener);const f=()=>{var m,p;e.getLayerById(t.get("id"))?((m=this.selectStyleLayer)==null||m.setMap(this.eoxMap.map),o==null||o.setMap(this.eoxMap.map)):((p=this.selectStyleLayer)==null||p.setMap(null),o==null||o.setMap(null))};e.map.getLayerGroup().on("change",f),this.pointerMoveListener=m=>{var p;m.dragging||(e.map.getTargetElement().style.cursor=e.map.hasFeatureAtPixel(m.pixel,{layerFilter:_=>{var y,b;return(b=(y=_.get("_jsonDefinition"))==null?void 0:y.interactions)==null?void 0:b.find(L=>{var R;return L.type=="select"&&((R=L.options)==null?void 0:R.condition)==="click"})},...i.atPixelOptions})?i.cursor||"pointer":(p=this.eoxMap.interactions.drawInteraction)!=null&&p.getActive()?"crosshair":"auto")},e.map.on("pointermove",this.pointerMoveListener)}(this.selectLayer.getSource()instanceof ni||this.selectLayer.getSource()instanceof Gt)&&(this.listener=d=>{if(!this.active||d.dragging)return;const u=e.map.getView().getResolution(),f=this.selectLayer.getSource().getFeatureInfoUrl(d.coordinate,u,e.map.getView().getProjection(),{INFO_FORMAT:"application/json"});f&&fetch(f).then(m=>m.text()).then(m=>{if(o){const p=d.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",_=d.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";o.setPositioning(`${_}-${p}`)}if(m&&this.tooltipElement){const p=JSON.parse(m);let _;p.type==="FeatureCollection"&&p.features.length>0?_=p.features[0]:p.type==="Feature"?(_=p,this.tooltipElement.innerHTML=`<pre>${JSON.stringify(_.properties,null,2)}</pre>`):o==null||o.setPosition(null),i!=null&&i.coordinates&&_&&Object.assign(_==null?void 0:_.properties,a(d));const y=new I({..._==null?void 0:_.properties});this.tooltipElement.feature=y,o.setPosition(_?d.coordinate:null)}})},i.condition=="click"&&this.eoxMap.map.on(i.condition,this.listener)),((g=this.selectLayer.getProperties())==null?void 0:g.type)==="WebGLTile"&&(this.listener=d=>{if(!this.active||d.dragging)return;const u=this.selectLayer.getData(d.pixel);if(u){if(o){const f=d.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",m=d.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";o.setPositioning(`${m}-${f}`),o.setPosition(d.coordinate);let p={};for(const[_,y]of u.entries()){const b=(_+1).toString();p[`band${b}`]=y}if(l(p))o==null||o.setPosition(null);else if(this.tooltipElement){i!=null&&i.coordinates&&Object.assign(p,a(d));const _=new I({...p});this.tooltipElement.feature=_,o.setPosition(Object.keys(p).length>0?d.coordinate:null)}}}else o==null||o.setPosition(null)},this.eoxMap.map.on(i.condition||"click",this.listener))}setActive(e){this.active=e}highlightById(e,t){if(this.selectedFids=e,e.length&&t){const i=zt();if(this.selectLayer instanceof D)for(let s=0;s<this.selectedFids.length;s++){const o=this.selectedFids[s],r=this.selectLayer.getSource().getFeatureById(o);r&&r.getGeometry()&&Je(i,r.getGeometry().getExtent())}else if(this.selectLayer instanceof xe){const s=this.eoxMap.map,o=this.selectLayer.getFeaturesInExtent(s.getView().calculateExtent(s.getSize()));for(let r=0;r<o.length;r++){const a=o[r];this.selectedFids.includes(this.getId(a))&&Je(i,a.getGeometry().getExtent())}}ps(i)||this.panIntoFeature(i,t)}this.selectStyleLayer.changed()}remove(){this.eoxMap.map.un(this.options.condition||"click",this.listener),(this.selectLayer instanceof D||this.selectLayer instanceof xe)&&(this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.un("pointermove",this.pointerMoveListener))}getId(e){if(this.options.idProperty)return e.get(this.options.idProperty);if(e.getId()!==void 0)return e.getId();if(e.get("id")!==void 0)return e.get("id");if(A(e)!==void 0)return A(e);throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function _n(n,e,t){if(n.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);return n.selectInteractions[t.id]=new pn(n,e,t),n.selectInteractions[t.id]}const yn=1,bn=28,vn=Math.PI/2;var O,le,V,w,Xe,W,ke,Se,ci,Qe;class Cn extends _s{constructor(t,i,s){super(s);x(this,w);x(this,O,null);x(this,le,null);x(this,V,null);x(this,ke,t=>new Promise(i=>{const s=this.eoxMap.map.getView().getZoom(),o={...v(this,O).fitOptions};o.callback=r=>{var a,l;i(this.eoxMap.map.getView().getZoom()!==s),(l=(a=v(this,O).fitOptions).callback)==null||l.call(a,r)},this.eoxMap.map.getView().fit(t,o)}));this.clusterLayer=i,this.eoxMap=t;const o={maxZoom:20,atPixelOptions:{},fitOptions:{duration:500,padding:[40,40,40,40]}},r=structuredClone(s);r.fitOptions&&(o.fitOptions={...o.fitOptions,...r.fitOptions},delete r.fitOptions),P(this,O,{...o,...r}),this.active=s.active||i.getVisible();const a=new D;a.setStyle(s.style),P(this,le,a.getStyleFunction())}handleEvent(t){if(!this.getActive())return!0;if(t.type==="pointermove"){const i=this.eoxMap.map.hasFeatureAtPixel(t.pixel,{layerFilter:s=>s===this.clusterLayer,...v(this,O).atPixelOptions});return this.eoxMap.map.getTargetElement().style.cursor=i?"pointer":"default",!i}if(t.type==="click"){const i=this.eoxMap.map.getFeaturesAtPixel(t.pixel,{layerFilter:a=>a===this.clusterLayer,...v(this,O).atPixelOptions});if(i.length===0)return T(this,w,W).call(this),!0;const s=i[0],o=s.get("features");if(o.length===1)return T(this,w,Xe).call(this,t,o[0]),T(this,w,W).call(this),!0;if(v(this,V)&&v(this,V)===s){const a=T(this,w,ci).call(this,s,t.coordinate);T(this,w,Xe).call(this,t,a.feature)}if(this.eoxMap.map.getView().getZoom()>v(this,O).maxZoom-1)return T(this,w,Se).call(this,s),!1;const r=zt();return o.forEach(a=>{Je(r,a.getGeometry().getExtent())}),ys(r)<100?(T(this,w,Se).call(this,s),!1):(v(this,ke).call(this,r).then(a=>{a||T(this,w,Se).call(this,s)}),!1)}return!0}setActive(t){t||(T(this,w,W).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setActive(t)}setMap(t){t||(T(this,w,W).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setMap(t)}remove(){this.setMap(null)}}O=new WeakMap,le=new WeakMap,V=new WeakMap,w=new WeakSet,Xe=function(t,i){const s=new CustomEvent("clusterSelect",{detail:{originalEvent:t,feature:i}});this.eoxMap.dispatchEvent(s)},W=function(){v(this,V)&&(v(this,V).setStyle(void 0),P(this,V,null))},ke=new WeakMap,Se=function(t){v(this,V)&&T(this,w,W).call(this);const i=t.getGeometry().getCoordinates(),s=t.get("features"),o=T(this,w,Qe).call(this,s.length,i,this.eoxMap.map.getView().getResolution()).reduce((r,a,l)=>{const h=new H(a),c=new K([i,a]);r.unshift(new Ut({geometry:c,stroke:new Bt({color:"rgba(50, 50, 50, 0.5)",width:2.5})}));const g=new I({...s[l].getProperties()}),d=v(this,le).call(this,g,this.eoxMap.map.getView().getResolution());return d!=null&&d.length&&d.forEach(u=>{const f=u.clone();f.setGeometry(h),r.unshift(f)}),r},[]);t.setStyle(o),P(this,V,t)},ci=function(t,i){const s=t.get("features"),o=T(this,w,Qe).call(this,s.length,t.getGeometry().getCoordinates(),this.eoxMap.map.getView().getResolution());let r=1/0,a;for(let l=0,h=o.length;l<h;++l){const c=(i[0]-o[l][0])**2+(i[1]-o[l][1])**2;c<r&&(a=l,r=c)}return{feature:s[a],coords:o[a]}},Qe=function(t,i,s){let r=yn*bn*(2+t)/(Math.PI*2);const a=Math.PI*2/t,l=[];let h;r=Math.max(r,35)*s;for(let c=0;c<t;++c)h=vn+c*a,l.push([i[0]+r*Math.cos(h),i[1]+r*Math.sin(h)]);return l};function wn(n,e,t){if(n.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);const i=new Cn(n,e,t);n.interactions[t.id]=i,n.map.addInteraction(i)}function xn(n){let e;if(!(!n||!("tileGrid"in n))){if(n.type==="WMTS"){const i=j("EPSG:3857").getExtent(),s=bs(i)/128,o=new Array(19),r=new Array(19);for(let a=0;a<19;++a)o[a]=s/Math.pow(2,a),r[a]=a;e=new vs({resolutions:o,origin:it(i),projection:n.tileGrid.projection||"EPSG:3857",matrixIds:r,...n.tileGrid})}else e=Cs({...n.tileGrid});return e}}function at(n,e){return hi(n.map.getLayers().getArray()).find(i=>i.get("id")===e)}function hi(n){const e=[];e.push(...n);let t=e.filter(i=>i instanceof Ye);for(;t.length;){const i=[];for(let s=0;s<t.length;s++){const o=t[s].getLayers().getArray();e.push(...o),i.push(...o.filter(r=>r instanceof Ye))}t=i}return e}function et(n){const e=Object.assign({},n.animationOptions),t=n.map.getView();if(Qt(t),!e||!Object.keys(e).length){t.setCenter(n.center),t.setZoom(n.zoom);return}e.center=ii(n.center),e.zoom=n.zoom,t.animate(e)}const He="units",Sn=[1,2,5],se=25.4/.28;class Pn extends z{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+te,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(He,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(He)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(He,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),o=s=="degrees"?"degrees":"m";let r=Le(i,e.resolution,t,o);const a=this.minWidth_*(this.dpi_||se)/se,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||se)/se:void 0;let h=a*r,c="";if(s=="degrees"){const b=ws.degrees;h*=b,h<b/60?(c="",r*=3600):h<b?(c="",r*=60):c=""}else if(s=="imperial")h<.9144?(c="in",r/=.0254):h<1609.344?(c="ft",r/=.3048):(c="mi",r/=1609.344);else if(s=="nautical")r/=1852,c="NM";else if(s=="metric")h<1e-6?(c="nm",r*=1e9):h<.001?(c="m",r*=1e6):h<1?(c="mm",r*=1e3):h<1e3?c="m":(c="km",r/=1e3);else if(s=="us")h<.9144?(c="in",r*=39.37):h<1609.344?(c="ft",r/=.30480061):(c="mi",r/=1609.3472);else throw new Error("Invalid units");let g=3*Math.floor(Math.log(a*r)/Math.log(10)),d,u,f,m=0,p,_;for(;;){f=Math.floor(g/3);const b=Math.pow(10,f);if(d=Sn[(g%3+3)%3]*b,u=Math.round(d/r),isNaN(u)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&u>=l){d=m,u=p,f=_;break}else if(u>=a)break;m=d,p=u,_=f,++g}const y=this.scaleBar_?this.createScaleBar(u,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=y&&(this.innerElement_.innerHTML=y,this.renderedHTML_=y),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),o=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,a=e/r,l=[this.createMarker("absolute")];for(let c=0;c<r;++c){const g=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${g}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||r===2?this.createStepText(c,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(r,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,o){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=Le(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||se,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const xt=["fullscreenchange","webkitfullscreenchange"],St={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class Tn extends z{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(G.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${te} ${Ve}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Pt(t))if(Tt(t))Ln(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?En(i):di(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Tt(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Fe(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(St.ENTERFULLSCREEN)):(Fe(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(St.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(oe.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(oe.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,s=e.length;i<s;++i)ot(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Pt(i)?this.element.classList.remove(ft):this.element.classList.add(ft);for(let s=0,o=xt.length;s<o;++s)e.push(Z(i,xt[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Pt(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function Tt(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function di(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function En(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():di(n)}function Ln(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const ne={VERTICAL:0,HORIZONTAL:1};class Fn extends z{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=ne.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+te;const s=this.element;s.className=t+" "+te+" "+Ve,s.appendChild(i),s.addEventListener(U.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),s.addEventListener(U.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),s.addEventListener(U.POINTERUP,this.handleDraggerEnd_.bind(this),!1),s.addEventListener(G.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(G.CLICK,xs,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),i-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const o=e.firstElementChild,r=getComputedStyle(o),a=o.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),l=o.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);return this.thumbSize_=[a,l],t>i?(this.direction_=ne.HORIZONTAL,this.widthLimit_=t-a):(this.direction_=ne.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(i),o=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:o,duration:this.duration_,easing:Ss})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,s=this.handleDraggerEnd_,o=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(Z(o,U.POINTERMOVE,i,this),Z(o,U.POINTERUP,s,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,s=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(ot),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==ne.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===ne.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,qe(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return qe(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const Ze=.75,Ce=.1;class In extends z{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",s=e.collapseLabel!==void 0?e.collapseLabel:"";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const o=e.label!==void 0?e.label:"";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o):this.label_=o;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(r),a.addEventListener(G.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Ht({view:e.view,controls:new ae,interactions:new ae});this.ovmap_=l,e.layers&&e.layers.forEach(function(_){l.addLayer(_)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new si({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const c=t+" "+te+" "+Ve+(this.collapsed_&&this.collapsible_?" "+mt:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=c,g.appendChild(this.ovmapDiv_),g.appendChild(a);const d=this.boxOverlay_,u=this.boxOverlay_.getElement(),f=_=>({clientX:_.clientX,clientY:_.clientY}),m=function(_){const y=f(_),b=l.getEventCoordinate(y);d.setPosition(b)},p=_=>{const y=l.getEventCoordinateInternal(_),b=this.getMap();b.getView().setCenterInternal(y);const L=b.getOwnerDocument();L.removeEventListener("pointermove",m),L.removeEventListener("pointerup",p)};this.ovmapDiv_.addEventListener("pointerdown",_=>{const y=this.getMap().getOwnerDocument();_.target===u&&y.addEventListener("pointermove",m),y.addEventListener("pointerup",p)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(Z(e,Ps.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&this.bindView_(i),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===oe.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===oe.TARGET||e.key===oe.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new rt({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(pt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(pt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),o=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&Ts(o,this.viewExtent_))return;this.viewExtent_=o;const r=t.getSize(),l=t.getView().calculateExtentInternal(r),h=t.getPixelFromCoordinateInternal(it(o)),c=t.getPixelFromCoordinateInternal(Ft(o)),g=Math.abs(h[0]-c[0]),d=Math.abs(h[1]-c[1]),u=r[0],f=r[1];g<u*Ce||d<f*Ce||g>u*Ze||d>f*Ze?this.resetExtent_():Dt(l,o)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),o=e.getView().calculateExtentInternal(i),r=t.getView(),a=Math.log(Ze/Ce)/Math.LN2,l=1/(Math.pow(2,a/2)*Ce);Es(o,l),r.fitInternal(Zt(o))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),s=e.getView(),o=t.getView(),r=this.rotateWithView_?0:-s.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=s.getCenter(),c=s.getResolution(),g=o.getResolution(),d=i[0]*c/g,u=i[1]*c/g;if(a.setPosition(h),l){l.style.width=d+"px",l.style.height=u+"px";const f="rotate("+r+"rad)";l.style.transform=f}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Ls(this.ovmap_,Ot.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(mt),this.collapsed_?Fe(this.collapseLabel_,this.label_):Fe(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}class kn extends z{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",s=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",o=document.createElement("button");o.setAttribute("type","button"),o.title=s,o.appendChild(typeof i=="string"?document.createTextNode(i):i),o.addEventListener(G.CLICK,this.handleClick_.bind(this),!1);const r=t+" "+te+" "+Ve,a=this.element;a.className=r,a.appendChild(o)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?At(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(Zt(i))}}const We="projection",Et="coordinateFormat";class Mn extends z{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(We,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Et)}getProjection(){return this.get(We)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(Z(t,U.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(Z(t,U.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Et,e)}setProjection(e){this.set(We,j(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const o=this.getProjection();o?this.transform_=Wt(this.mapProjection_,o):this.transform_=$t}const s=this.getMap().getCoordinateFromPixelInternal(e);if(s){if(this.transform_(s,s),this.wrapX_){const r=this.getProjection()||this.mapProjection_;Fs(s,r)}const o=this.getCoordinateFormat();o?t=o(s):t=s.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const C={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Rn={ERROR:"error"};class Nn extends st{constructor(e){super(Rn.ERROR),this.code=e.code,this.message=e.message}}class An extends jt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=$t,this.watchId_=void 0,this.addChangeListener(C.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(C.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Wt(j("EPSG:4326"),e),this.position_&&this.set(C.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(C.ACCURACY,t.accuracy),this.set(C.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(C.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(C.HEADING,t.heading===null?void 0:Is(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(C.POSITION,i.slice()),this.set(C.SPEED,t.speed===null?void 0:t.speed);const s=ks(this.position_,t.accuracy);s.applyTransform(this.transform_),this.set(C.ACCURACY_GEOMETRY,s),this.changed()}positionError_(e){this.dispatchEvent(new Nn(e))}getAccuracy(){return this.get(C.ACCURACY)}getAccuracyGeometry(){return this.get(C.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(C.ALTITUDE)}getAltitudeAccuracy(){return this.get(C.ALTITUDE_ACCURACY)}getHeading(){return this.get(C.HEADING)}getPosition(){return this.get(C.POSITION)}getProjection(){return this.get(C.PROJECTION)}getSpeed(){return this.get(C.SPEED)}getTracking(){return this.get(C.TRACKING)}getTrackingOptions(){return this.get(C.TRACKING_OPTIONS)}setProjection(e){this.set(C.PROJECTION,j(e))}setTracking(e){this.set(C.TRACKING,e)}setTrackingOptions(e){this.set(C.TRACKING_OPTIONS,e)}}class Vn extends z{constructor(e){const t=e||{},i=document.createElement("div");i.className="geolocation ol-unselectable ol-control";const s=document.createElement("button");s.title="Show your location",s.innerHTML=t.buttonIcon?`
      <img src="${t.buttonIcon}" alt="Geolocation" />
    `:`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>crosshairs-gps</title><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z" /></svg>
    `,i.appendChild(s),super({element:i}),this._centerWhenReady=t.centerWhenReady,this._highAccuracy=t.highAccuracy,this._trackAccuracy=t.trackAccuracy,this._trackHeading=t.trackHeading,this._positionFeature=new I({geometry:new H([NaN,NaN]),heading:0}),this._source=new Re({features:[this._positionFeature]}),this._trackAccuracy&&(this._accuracyFeature=new I,this._accuracyFeature.setStyle(new Ut({fill:new Ms({color:"rgba(0, 0, 0, 0.2)"}),stroke:new Bt({width:2,color:"rgba(0, 0, 0, 0.7)"})})),this._source.addFeature(this._accuracyFeature)),this._layer=new D({source:this._source}),t.style&&this._layer.setStyle(t.style),s.addEventListener("click",this.centerOnPosition.bind(this),!1)}setMap(e){this._layer.setMap(e),super.setMap(e),e&&this._centerWhenReady&&this.initGeolocation()}initGeolocation(){return new Promise((e,t)=>{const i=this.getMap();i&&(this._geolocation=new An({tracking:!0,trackingOptions:{enableHighAccuracy:this._highAccuracy},projection:i.getView().getProjection()})),this._centerWhenReady&&this._geolocation.once("change:position",s=>{i.getView().setCenter(s.target.getPosition())}),this._geolocation.on("error",s=>t(s)),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())}),this._geolocation.on("change:heading",s=>{this._trackHeading&&this._highAccuracy&&this._positionFeature.set("heading",s.target.getHeading())}),this._geolocation.on("change:position",()=>{const s=this._geolocation.getPosition();this._positionFeature.getGeometry().setCoordinates(s||null),e(s)})})}getElement(){return this.element}async centerOnPosition(){var e,t;try{await this.initGeolocation();const i=(e=this._geolocation)==null?void 0:e.getPosition();i&&((t=this.getMap())==null||t.getView().setCenter(i))}catch(i){console.error(i)}}}class jn extends z{constructor(e){const t=e||{};t.opacity===void 0&&(t.opacity=1),t.type===void 0&&(t.type="small");const i=document.createElement("div");i.className="LoadingIndicator ol-unselectable ol-control",i.classList.add("loading-indicator"),i.style.opacity=String(t.opacity),t.spinnerSvg?i.innerHTML=t.spinnerSvg:i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="50" height="50" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="12" stroke="#1a467c" fill="none" cy="50" cx="50">
      <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1.2222222222222223s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
      </circle></g></svg>`,t.type==="fullscreen"?i.classList.add("fullscreen"):i.classList.add("small"),super({element:i})}setMap(e){super.setMap(e),e&&(e.on("loadstart",()=>{this.getElement().style.visibility="visible"}),e.on("loadend",()=>{this.getElement().style.visibility="hidden"}))}getElement(){return this.element}}const On={Zoom:As,Rotate:Ns,ScaleLine:Pn,FullScreen:Tn,ZoomSlider:Fn,Attribution:Rs,OverviewMap:In,ZoomToExtent:kn,MousePosition:Mn,Geolocation:Vn,LoadingIndicator:jn};function Dn(n,e,t,i){e&&e[t]?JSON.stringify(e[t])!==JSON.stringify(i)&&(n.removeControl(t),Lt(n,t,i)):Lt(n,t,i)}function Lt(n,e,t){const i=Object.assign({},t);t&&t.layers&&(i.layers=mn(n,t.layers));const s=new On[e](i);n.map.addControl(s),n.mapControls[e]=s}function Gn(n,e){let t;const i=(n==null?void 0:n.length)&&ln(n,e.map.getView().getCenter());return n&&!i&&(!e.projection||e.projection==="EPSG:3857"?t=ii(n):t=n),t}function zn(n,e){if(!n||!n.length)return;const t=e.map.getView();return Qt(t),setTimeout(()=>t.fit(n,e.animationOptions),0),n}function Un(n,e,t){const i=n;if(e){const s=Object.keys(e),o=Object.keys(i);for(let r=0,a=s.length;r<a;r++){const l=s[r];o.includes(l)||t.removeControl(l)}}if(i){const s=Object.keys(n);for(let o=0,r=s.length;o<r;o++){const a=s[o];Dn(t,e,a,n[a])}}return i}function Bn(n){return JSON.parse(JSON.stringify(n)).reverse()}function Hn(n,e,t){const i=Bn(n);e&&e.forEach(l=>{var h,c;if(!((h=l.properties)!=null&&h.id)||!i.find(g=>g.properties.id===l.properties.id)){const g=at(t,(c=l.properties)==null?void 0:c.id),u=g.get("_jsonDefinition").interactions;u==null||u.forEach(f=>{f.type==="select"?t.removeSelect(f.options.id):t.removeInteraction(f.options.id)}),t.map.removeLayer(g)}}),i.forEach(l=>{t.addOrUpdateLayer(l)});const s=i.map(l=>{var h;return(h=l.properties)==null?void 0:h.id});t.map.getLayers().getArray().sort((l,h)=>s.indexOf(l.get("id"))-s.indexOf(h.get("id")));let o=t.map.getLayers().getArray().reduce((l,h)=>{var c,g,d,u,f,m,p,_;return l.maxZoom=(g=(c=t.config)==null?void 0:c.view)!=null&&g.maxZoom?(u=(d=t.config)==null?void 0:d.view)==null?void 0:u.maxZoom:l.maxZoom===void 0||h.get("maxZoom")<l.maxZoom?h.get("maxZoom"):l.maxZoom,l.minZoom=(m=(f=t.config)==null?void 0:f.view)!=null&&m.minZoom?(_=(p=t.config)==null?void 0:p.view)==null?void 0:_.minZoom:l.minZoom===void 0||h.get("minZoom")>l.minZoom?h.get("minZoom"):l.minZoom,l},{minZoom:0,maxZoom:1/0});t.map.getLayers().getArray().map(l=>l.setMinZoom(l.get("minZoom")-1e-12));const r=t.map.getView().getMinZoom(),a=t.map.getView().getMaxZoom();return r!==o.minZoom&&t.map.getView().setMinZoom(o.minZoom>=0?o.minZoom:0),a!==o.maxZoom&&t.map.getView().setMaxZoom(o.maxZoom),t.map.on("moveend",()=>{var c;if(!((c=t==null?void 0:t.controls)!=null&&c.Zoom))return;const l=t.renderRoot.querySelector("button.ol-zoom-out"),h=t.renderRoot.querySelector("button.ol-zoom-in");t.map.getView().getZoom()>=o.maxZoom?h==null||h.classList.add("disabled"):h==null||h.classList.remove("disabled"),t.map.getView().getZoom()-1e-12<=o.minZoom?l==null||l.classList.add("disabled"):l==null||l.classList.remove("disabled")}),i}function Zn(n,e){return n?(an(e.map),wt(e.map,!0)):wt(e.map),n}function Wn(n,e){var t,i,s,o,r,a,l,h;return Object.assign(e,{...(n==null?void 0:n.animationOptions)!==void 0?{animationOptions:n.animationOptions}:{},projection:((t=n==null?void 0:n.view)==null?void 0:t.projection)||"EPSG:3857",layers:(n==null?void 0:n.layers)||[],controls:(n==null?void 0:n.controls)||{},...(n==null?void 0:n.preventScroll)!==void 0&&e.preventScroll===void 0?{preventScroll:n==null?void 0:n.preventScroll}:{},zoom:((i=n==null?void 0:n.view)==null?void 0:i.zoom)||0,center:((s=n==null?void 0:n.view)==null?void 0:s.center)||[0,0],zoomExtent:(o=n==null?void 0:n.view)==null?void 0:o.zoomExtent}),(r=n==null?void 0:n.view)!=null&&r.minZoom&&e.map.getView().setMinZoom((a=n==null?void 0:n.view)==null?void 0:a.minZoom),(l=n==null?void 0:n.view)!=null&&l.maxZoom&&e.map.getView().setMaxZoom((h=n==null?void 0:n.view)==null?void 0:h.maxZoom),n}function $n(n,e,t){let i=e;const s=t.map.getView();if(n&&j(n)&&n!==s.getProjection().getCode()){const o=Ae(s.getCenter(),s.getProjection().getCode(),n),r=j(n),a=s.getResolution(),l=s.getProjection().getMetersPerUnit(),h=r.getMetersPerUnit(),c=Le(s.getProjection(),1/l,s.getCenter(),"m")*l,g=Le(r,1/h,o,"m")*h,d=a*c/g,u=new rt({zoom:s.getZoom(),center:o,resolution:d,rotation:s.getRotation(),projection:n});["change:center","change:resolution","change:rotation","propertychange"].forEach(m=>{const p=s.getListeners(m);if(p!=null&&p.length)for(let _=p.length-1;_>=0;_--){const y=p[_];s.un(m,y),u.on(m,y)}}),t.map.setView(u),t.getFlatLayersArray(t.map.getLayers().getArray()).filter(m=>m instanceof D).forEach(m=>m.getSource().refresh()),i=n,t.center=o}return i}function qn(n,e){return n&&setTimeout(()=>{const t=js(n);t&&(e.clientHeight<1&&!t.zoom?t.map.setView(e.map.getView()):e.map.setView(t.map.getView()))}),n}function Kn(n){return n.projection==="EPSG:4326"?n.map.getView().getCenter():ei(n.map.getView().getCenter(),n.projection)}function Yn(n){const e=n.map.getView().calculateExtent(n.map.getSize());return n.projection==="EPSG:4326"?e:ti(e,n.projection)}function Jn(n,e){var o;n.interactions||(n.interactions=[]);const t=(o=n.properties)==null?void 0:o.id,i=t?at(e,t):!1;let s;return i?(ai(e,n,i),s=i):(s=ie(e,n),e.map.addLayer(s)),s}function Xn(n,e){e.map.removeInteraction(e.interactions[n]),delete e.interactions[n],e.interactions[`${n}_modify`]&&(e.map.removeInteraction(e.interactions[`${n}_modify`]),delete e.interactions[`${n}_modify`])}function Qn(n,e){e.selectInteractions[n].remove(),delete e.selectInteractions[n]}function eo(n,e){e.map.removeControl(e.mapControls[n]),delete e.mapControls[n]}function to(n,e){e.map.once("change:target",t=>{t.target.getView().setCenter(e.center)}),e.map.setTarget(e.renderRoot.querySelector("div")),n?e.map.getView().fit(n,e.animationOptions):et(e),e.map.on("loadend",()=>{e.dispatchEvent(new CustomEvent("loadend",{detail:e.map}))}),e.dispatchEvent(new CustomEvent("mapmounted",{detail:e.map}))}_i();var ce,X,Q,he,de,ue,ge,fe,me,ee;class io extends tt{constructor(){super();x(this,ce);x(this,X);x(this,Q);x(this,he);x(this,de);x(this,ue);x(this,ge);x(this,fe,[0,0]);x(this,me,0);x(this,ee,"EPSG:3857");N(this,"parseFeature",rn);N(this,"parseTextToFeature",Xs);N(this,"registerProjectionFromCode",on);N(this,"registerProjection",nn);N(this,"getFlatLayersArray",hi);N(this,"transform",ei);N(this,"transformExtent",ti);N(this,"buffer",Vt);this.map=new Ht({controls:[],interactions:Vs({altShiftDragRotate:!1,pinchRotate:!1}),layers:[],view:new rt({center:[0,0],zoom:0,projection:this.projection})}),this.interactions={},this.selectInteractions={},this.mapControls={}}static get properties(){return{center:{attribute:!1,type:Array},layers:{attribute:!1,type:Array},preventScroll:{attribute:"prevent-scroll",type:Boolean},config:{attribute:!1,type:Object},sync:{attribute:"sync",type:String},projection:{attribute:"projection",type:String},map:{attribute:!1,state:!0},intersections:{attribute:!1,state:!0,type:Object},selectInteractions:{attribute:!1,state:!0,type:Object},mapControls:{attribute:!1,state:!0,type:Object}}}set center(t){const i=Gn(t,this);i!==void 0&&(P(this,fe,i),et(this))}get center(){return v(this,fe)}get lonLatCenter(){return Kn(this)}get lonLatExtent(){return Yn(this)}set zoom(t){t!==void 0&&(P(this,me,t),et(this))}get zoom(){return v(this,me)}set zoomExtent(t){P(this,ce,zn(t,this))}set controls(t){P(this,X,Un(t,v(this,X),this))}get controls(){return v(this,X)}set layers(t){P(this,Q,Hn(t,v(this,Q),this))}get layers(){return v(this,Q)}set preventScroll(t){P(this,he,Zn(t,this))}get preventScroll(){return v(this,he)}set config(t){P(this,de,Wn(t,this))}get config(){return v(this,de)}set animationOptions(t){P(this,ue,t)}get animationOptions(){return v(this,ue)}set projection(t){P(this,ee,$n(t,v(this,ee),this))}get projection(){return v(this,ee)||"EPSG:3857"}set sync(t){P(this,ge,qn(t,this))}get sync(){return v(this,ge)}addOrUpdateLayer(t){return Jn(t,this)}removeInteraction(t){Xn(t,this)}removeSelect(t){Qn(t,this)}removeControl(t){eo(t,this)}getLayerById(t){return at(this,t)}firstUpdated(){to(v(this,ce),this)}render(){return B`
      <style>
        :host {
          display: block;
        }
        .eox-map-tooltip {
          pointer-events: none !important;
        }
        ${Os}
        ${pi}
        ${qs}
      </style>
      <div style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}}ce=new WeakMap,X=new WeakMap,Q=new WeakMap,he=new WeakMap,de=new WeakMap,ue=new WeakMap,ge=new WeakMap,fe=new WeakMap,me=new WeakMap,ee=new WeakMap;customElements.define("eox-map",io);export{io as EOxMap};
