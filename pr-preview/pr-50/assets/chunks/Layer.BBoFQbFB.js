var T=Object.defineProperty;var E=(d,t,e)=>t in d?T(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var x=(d,t,e)=>E(d,typeof t!="symbol"?t+"":t,e);import{cs as g,ah as P,a5 as p,bm as w,aJ as R,ct as M,cu as D,cv as I,$ as L,ag as y,W as N,U as b,R as k,Q as z,ax as c,aP as B,aQ as O,a6 as v,cw as A,cx as F,ak as q,aj as f}from"./XYZ.zMTP1uvH.js";class W{constructor(){x(this,"pushMethodArgs_",(...t)=>(this.push_(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(g(),{get:(t,e)=>{if(typeof g()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,s)=>(this.push_(e,s),!0)})}push_(...t){const e=this.instructions_,s=this.zIndex+this.offset_;e[s]||(e[s]=[]),e[s].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let s=0,o=e.length;s<o;++s){const i=e[s];if(typeof i=="function"){i(t);continue}const n=e[++s];if(typeof t[i]=="function")t[i](...n);else{if(typeof n=="function"){t[i]=n(t);continue}t[i]=n}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const j=[];let l=null;function Q(){l=y(1,1,void 0,{willReadFrequently:!0})}class H extends P{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=p(),this.pixelTransform=p(),this.inversePixelTransform=p(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,s){l||Q(),l.clearRect(0,0,1,1);let o;try{l.drawImage(t,e,s,1,1,0,0,1,1),o=l.getImageData(0,0,1,1).data}catch{return l=null,null}return o}getBackground(t){let s=this.getLayer().getBackground();return typeof s=="function"&&(s=s(t.viewState.resolution)),s||void 0}useContainer(t,e,s){const o=this.getLayer().getClassName();let i,n;if(t&&t.className===o&&(!s||t&&t.style.backgroundColor&&w(R(t.style.backgroundColor),R(s)))){const r=t.firstElementChild;M(r)&&(n=r.getContext("2d"))}if(n&&D(n.canvas.style.transform,e)?(this.container=t,this.context=n,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){i=L?I():document.createElement("div"),i.className=o;let r=i.style;r.position="absolute",r.width="100%",r.height="100%",n=y();const a=n.canvas;i.appendChild(a),r=a.style,r.position="absolute",r.left="0",r.transformOrigin="top left",this.container=i,this.context=n}!this.containerReused&&s&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=s)}clipUnrotated(t,e,s){const o=N(s),i=b(s),n=k(s),r=z(s);c(e.coordinateToPixelTransform,o),c(e.coordinateToPixelTransform,i),c(e.coordinateToPixelTransform,n),c(e.coordinateToPixelTransform,r);const a=this.inversePixelTransform;c(a,o),c(a,i),c(a,n),c(a,r),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.clip()}prepareContainer(t,e){const s=t.extent,o=t.viewState.resolution,i=t.viewState.rotation,n=t.pixelRatio,r=Math.round(B(s)/o*n),a=Math.round(O(s)/o*n);v(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,i,-r/2,-a/2),A(this.inversePixelTransform,this.pixelTransform);const u=F(this.pixelTransform);if(this.useContainer(e,u,this.getBackground(t)),!this.containerReused){const h=this.context.canvas;h.width!=r||h.height!=a?(h.width=r,h.height=a):this.context.clearRect(0,0,r,a),u!==h.style.transform&&(h.style.transform=u)}}dispatchRenderEvent_(t,e,s){const o=this.getLayer();if(o.hasListener(t)){const i=new q(t,this.inversePixelTransform,s,e);o.dispatchEvent(i)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(f.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(f.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new W),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(f.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(f.POSTRENDER,this.context,t))}getRenderTransform(t,e,s,o,i,n,r){const a=i/2,u=n/2,h=o/e,C=-h,_=-t[0]+r,m=-t[1];return v(this.tempTransform,a,u,h,C,-s,_,m)}disposeInternal(){delete this.frameState,super.disposeInternal()}}export{H as C,W as Z,j as c};
