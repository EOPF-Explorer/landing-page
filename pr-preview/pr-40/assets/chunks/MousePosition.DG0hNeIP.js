import{l as rt,u as ot,S as at,U as Ne,V as lt,L as fe,G as _e,F as k,j as Ae,W as Ve,X as ht,v as ge,o as T,M as Ce,Y as Ge,N as ct,d as je,Z as dt,_ as ut,E as F,R as re,g as L,f as gt,C as ft,$ as _t,a0 as mt,r as pt,H as Ct,Q as xt}from"./math.CNQr2BuL.js";import{S as yt,a3 as bt,a4 as vt,a5 as Ue,T as Be,c as J,a6 as Tt,d as wt,_ as R,L as Z,m as We,P as me,M as ze,s as Pt,a7 as v,a8 as Q,F as M,a as j,q as xe,n as Et,e as P,a9 as He,X as ee,H as qe,W as St,aa as Ft,h as ye,$ as Lt,ab as Ke,ac as Mt}from"./GeoJSON.BxIvHmzC.js";import{bv as It,bw as kt,bx as Ye,by as Rt,bz as Ot,I as Dt,a$ as Nt,bA as At,bB as Vt,bC as Gt,bD as jt,a_ as Ut,bE as Xe,g as $e,V as Ze,bF as Bt,bG as U,bH as be,bI as Wt,bJ as w,bK as zt,bL as Je,bM as Qe,bN as Ht,bO as qt,bP as Kt,bQ as Yt,aQ as ve,C as A,bR as N,bS as se,bT as te,bU as B,bV as Te,bW as I,bX as Xt,w as $t,bY as we,v as Zt,bZ as Pe}from"./OSM.aQ6pgj5c.js";import{C as ie,b as Ee}from"./Group.CiSBx5zz.js";class ne extends yt{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new ne(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const n=this.flatCoordinates,r=e-n[0],o=t-n[1],a=r*r+o*o;if(a<s){if(a===0)for(let h=0;h<this.stride;++h)i[h]=n[h];else{const h=this.getRadius()/Math.sqrt(a);i[0]=n[0]+h*r,i[1]=n[1]+h*o;for(let l=2;l<this.stride;++l)i[l]=n[l]}return i.length=this.stride,a}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],n=t-i[1];return s*s+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return rt(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ot(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:at(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let n=1;n<t;++n)s[t+n]=e[n];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let n=bt(s,0,e,this.stride);s[n++]=s[0]+t;for(let r=1,o=this.stride;r<o;++r)s[n++]=s[r];s.length=n,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(vt(i,0,i.length,s,e,t,i)),this.changed()}}ne.prototype.transform;const m={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Jt={ERROR:"error"};class Qt extends fe{constructor(e){super(Jt.ERROR),this.code=e.code,this.message=e.message}}class ui extends Ne{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Ue,this.watchId_=void 0,this.addChangeListener(m.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(m.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Be(J("EPSG:4326"),e),this.position_&&this.set(m.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(m.ACCURACY,t.accuracy),this.set(m.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(m.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(m.HEADING,t.heading===null?void 0:lt(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(m.POSITION,i.slice()),this.set(m.SPEED,t.speed===null?void 0:t.speed);const s=Tt(this.position_,t.accuracy);s.applyTransform(this.transform_),this.set(m.ACCURACY_GEOMETRY,s),this.changed()}positionError_(e){this.dispatchEvent(new Qt(e))}getAccuracy(){return this.get(m.ACCURACY)}getAccuracyGeometry(){return this.get(m.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(m.ALTITUDE)}getAltitudeAccuracy(){return this.get(m.ALTITUDE_ACCURACY)}getHeading(){return this.get(m.HEADING)}getPosition(){return this.get(m.POSITION)}getProjection(){return this.get(m.PROJECTION)}getSpeed(){return this.get(m.SPEED)}getTracking(){return this.get(m.TRACKING)}getTrackingOptions(){return this.get(m.TRACKING_OPTIONS)}setProjection(e){this.set(m.PROJECTION,J(e))}setTracking(e){this.set(m.TRACKING,e)}setTrackingOptions(e){this.set(m.TRACKING_OPTIONS,e)}}const b={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ei extends Ne{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+It,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(b.ELEMENT,this.handleElementChanged),this.addChangeListener(b.MAP,this.handleMapChanged),this.addChangeListener(b.OFFSET,this.handleOffsetChanged),this.addChangeListener(b.POSITION,this.handlePositionChanged),this.addChangeListener(b.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(b.ELEMENT)}getId(){return this.id}getMap(){return this.get(b.MAP)||null}getOffset(){return this.get(b.OFFSET)}getPosition(){return this.get(b.POSITION)}getPositioning(){return this.get(b.POSITIONING)}handleElementChanged(){kt(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),_e(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=k(e,Ye.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(b.ELEMENT,e)}setMap(e){this.set(b.MAP,e)}setOffset(e){this.set(b.OFFSET,e)}setPosition(e){this.set(b.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(b.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),n=this.getRect(s,[Rt(s),Ot(s)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Ae(i,n)){const o=n[0]-i[0],a=i[2]-n[2],h=n[1]-i[1],l=i[3]-n[3],d=[0,0];if(o<0?d[0]=o-r:a<0&&(d[0]=Math.abs(a)+r),h<0?d[1]=h-r:l<0&&(d[1]=Math.abs(l)+r),d[0]!==0||d[1]!==0){const u=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(u);if(!g)return;const f=[g[0]+d[0],g[1]+d[1]],_=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:_.duration,easing:_.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[s,n,s+t[0],n+t[1]]}setPositioning(e){this.set(b.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),n=this.getPositioning();this.setVisible(!0);const r=`${e[0]+s[0]}px`,o=`${e[1]+s[1]}px`;let a="0%",h="0%";n=="bottom-right"||n=="center-right"||n=="top-right"?a="-100%":(n=="bottom-center"||n=="center-center"||n=="top-center")&&(a="-50%"),n=="bottom-left"||n=="bottom-center"||n=="bottom-right"?h="-100%":(n=="center-left"||n=="center-center"||n=="center-right")&&(h="-50%");const l=`translate(${a}, ${h}) translate(${r}, ${o})`;this.rendered.transform_!=l&&(this.rendered.transform_=l,i.transform=l)}getOptions(){return this.options}}class gi extends Dt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Nt,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,s){const n=J(i),r=this.getProjection();r&&r!==n&&(t=At(r,n,e,t),e=wt(e,n,r));const o={url:this.url_,params:{...this.params_,...s},projection:r||n};return Vt(o,e,t)}getLegendUrl(e,t){return Gt({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=jt({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,r)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,r),Ut(n))})),super.getImageInternal(e,t,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const fi=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.ol-overviewmap .ol-viewport:hover{cursor:pointer}';function S(c,e){const t=c.length;return e<0?c[e+t]:e>=t?c[e-t]:c[e]}function O(c,e){const t=c.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let n=i+1;n>=t&&(n-=t);const r=c[i],o=r[0],a=r[1],h=c[n],l=h[0]-o,d=h[1]-a;return[o+l*s,a+d*s]}const z={index:-1,endIndex:NaN,closestTargetDistance:1/0};function et(c,e,t,i){const s=c[0],n=c[1];let r=1/0,o=-1,a=NaN;for(let d=0;d<e.targets.length;++d){const u=e.targets[d],g=u.coordinates;let f=1/0,_;for(let p=0;p<g.length-1;++p){const C=g[p],x=g[p+1],y=st(s,n,C,x);y.squaredDistance<f&&(f=y.squaredDistance,_=p+y.along)}f<r&&(r=f,u.ring&&e.targetIndex===d&&(u.endIndex>u.startIndex?_<u.startIndex&&(_+=g.length):u.endIndex<u.startIndex&&_>u.startIndex&&(_-=g.length)),a=_,o=d)}const h=e.targets[o];let l=h.ring;if(e.targetIndex===o&&l){const d=O(h.coordinates,a),u=t.getPixelFromCoordinate(d),g=t.getPixelFromCoordinate(e.startCoord);R(u,g)>i&&(l=!1)}if(l){const d=h.coordinates,u=d.length,g=h.startIndex,f=a;if(g<f){const _=K(d,g,f);K(d,g,f-u)<_&&(a-=u)}else{const _=K(d,g,f);K(d,g,f+u)<_&&(a+=u)}}return z.index=o,z.endIndex=a,z.closestTargetDistance=r,z}function tt(c,e){const t=[];for(let i=0;i<e.length;++i){const n=e[i].getGeometry();it(c,n,t)}return t}function it(c,e,t){if(e instanceof Z){H(c,e.getCoordinates(),!1,t);return}if(e instanceof We){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)H(c,i[s],!1,t);return}if(e instanceof me){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)H(c,i[s],!0,t);return}if(e instanceof ze){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length;o<a;++o)H(c,r[o],!0,t)}return}if(e instanceof Pt){const i=e.getGeometries();for(let s=0;s<i.length;++s)it(c,i[s],t);return}}function H(c,e,t,i){const s=c[0],n=c[1];for(let r=0,o=e.length-1;r<o;++r){const a=e[r],h=e[r+1],l=st(s,n,a,h);if(l.squaredDistance===0){const d=r+l.along;i.push({coordinates:e,ring:t,startIndex:d,endIndex:d});return}}}function q(c,e){return Ve(c[0],c[1],e[0],e[1])}function K(c,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const n=Math.ceil(i),r=Math.floor(s);if(n>r){const a=O(c,i),h=O(c,s);return q(a,h)}let o=0;if(i<n){const a=O(c,i),h=S(c,n);o+=q(a,h)}if(r<s){const a=S(c,r),h=O(c,s);o+=q(a,h)}for(let a=n;a<r-1;++a){const h=S(c,a),l=S(c,a+1);o+=q(h,l)}return o}const oe={along:0,squaredDistance:0};function st(c,e,t,i){const s=t[0],n=t[1],r=i[0],o=i[1],a=r-s,h=o-n;let l=0,d=s,u=n;return(a!==0||h!==0)&&(l=ge(((c-s)*a+(e-n)*h)/(a*a+h*h),0,1),d+=a*l,u+=h*l),oe.along=l,oe.squaredDistance=ht(Ve(c,e,d,u),10),oe}const Y={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class X extends fe{constructor(e,t){super(e),this.feature=t}}class _i extends Xe{constructor(e){const t=e;t.stopDown||(t.stopDown=dt),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=ii(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:ut,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=(n,r,o)=>{const a=r||new ne([NaN,NaN]),h=v(n[0]),l=Q(h,v(n[n.length-1]));return a.setCenterAndRadius(h,Math.sqrt(l),this.geometryLayout_),a};else{let n;s==="Point"?n=j:s==="LineString"?n=Z:s==="Polygon"&&(n=me),i=(r,o,a)=>(o?s==="Polygon"?r[0].length?o.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(r,this.geometryLayout_):o=new n(r,this.geometryLayout_),o)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new $e({source:new Ze({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:ti(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Bt,this.freehandCondition_,e.freehand?this.freehandCondition_=U:this.freehandCondition_=e.freehandCondition?e.freehandCondition:be,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Wt.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=U:t=e:t=Je,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=U:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:be}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===F.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===w.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===w.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===w.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===w.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===w.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===w.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===w.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new zt(w.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),n=T([i,s]),r=this.traceSource_.getFeaturesInExtent(n);if(r.length===0)return;const o=tt(e.coordinate,r);o.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let n=Math.floor(t);n===t&&(n-=1),i=n-s+1}else{const s=Math.floor(e);let n=Math.ceil(t);n===t&&(n+=1),i=s-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const n=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let o=n;o<=r;++o)s.push(S(e.coordinates,o))}else{const n=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let o=n;o>=r;--o)s.push(S(e.coordinates,o))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const o=e.map.getPixelFromCoordinate(t.startCoord);if(R(o,e.pixel)<this.snapTolerance_)return}const i=et(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const a=t.targets[t.targetIndex];this.removeTracedCoordinates_(a.startIndex,a.endIndex)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const n=O(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(n);e.coordinate=n,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],n=t[1]-i[1],r=s*s+n*n;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,n=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const o=this.sketchCoords_;s=o[0].length>this.minPoints_,n=[o[0][0],o[0][o[0].length-2]],t?n=[o[0][0]]:n=[o[0][0],o[0][o[0].length-2]]}if(s){const o=this.getMap();for(let a=0,h=n.length;a<h;a++){const l=n[a],d=o.getPixelFromCoordinate(l),u=e[0]-d[0],g=e[1]-d[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(u*u+g*g)<=f,i){this.finishCoordinate_=l;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new M(new j(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new M);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new Z(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=xe(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new M(new Z(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new M,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new X(Y.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),n=xe(this.geometryLayout_);let r,o;for(;e.length<n;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,n;const r=this.mode_;return r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),this.geometryFunction_(n,t,i)):r==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),s&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let n=0;n<e;++n){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const o=this.finishCoordinate_.slice();r[r.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(r,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const o=this.sketchLine_.getGeometry();if(r.length>=2){const a=r[r.length-2].slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}o.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Et([t])):this.type_==="MultiLineString"?e.setGeometry(new We([t])):this.type_==="MultiPolygon"&&e.setGeometry(new ze([t])),this.dispatchEvent(new X(Y.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new X(Y.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const n=e[e.length-1];this.sketchFeature_=this.addToDrawing_(n),this.modifyDrawing_(n)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new M(new j(s)),this.updateSketchFeatures_(),this.dispatchEvent(new X(Y.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function ti(){const c=Qe();return function(e,t){return c[e.getGeometry().getType()]}}function mi(){return function(c,e,t){const i=T([c[0],c[c.length-1]].map(function(n){return v(n)})),s=[[Ce(i),Ge(i),ct(i),je(i),Ce(i)]];return e?e.setCoordinates(s):e=new me(s),e}}function ii(c){switch(c){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+c)}}const Se=0,W=1,Fe=[0,0,0,0],D=[],ae={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function le(c,e,t){let i;switch(e){case"LineString":i=c;break;case"MultiLineString":case"Polygon":i=c[t[0]];break;case"MultiPolygon":i=c[t[1]][t[0]];break}return i}class he extends fe{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class pi extends Xe{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Ht,this.defaultDeleteCondition_=function(i){return qt(i)&&Kt(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:U,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Yt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new $e({source:new Ze({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ni(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new ie(this.source_.getFeatures()),this.source_.addEventListener(ve.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(ve.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ee.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ee.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=U:t=e:t=Je,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(F.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new ie;const i=this.featuresBeingModified_.getArray();for(let s=0,n=t.length;s<n;++s){const r=t[s].feature;r&&!i.includes(r)&&this.featuresBeingModified_.push(r)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new he(ae.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(F.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const n=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===n&&this.dragSegments_.splice(r,1);t.remove(n)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s],o={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length-1;s<n;++s){const r=i.slice(s,s+2),o={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert(T(r),o)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length-1;o<a;++o){const h=r.slice(o,o+2),l={feature:e,geometry:t,depth:[s],index:o,segment:h};this.rBush_.insert(T(h),l)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length-1;o<a;++o){const h=r.slice(o,o+2),l={feature:e,geometry:t,depth:[s],index:o,segment:h};this.rBush_.insert(T(h),l)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length;o<a;++o){const h=r[o];for(let l=0,d=h.length-1;l<d;++l){const u=h.slice(l,l+2),g={feature:e,geometry:t,depth:[o,s],index:l,segment:u};this.rBush_.insert(T(u),g)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:Se,segment:[i,i]},n={feature:e,geometry:t,index:W,segment:[i,i]},r=[s,n];s.featureSegments=r,n.featureSegments=r,this.rBush_.insert(re(i),s);let o=t;this.rBush_.insert(o.getExtent(),n)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const n=i[s],r=this.SEGMENT_WRITERS_[n.getType()];r(e,n)}}createOrUpdateVertexFeature_(e,t,i,s){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new M(new j(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n.set("existing",s),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==w.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=w.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==w.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const i=[],s=this.vertexFeature_.getGeometry().getCoordinates(),n=T([s]),r=this.rBush_.getInExtent(n),o={};r.sort(si);for(let a=0,h=r.length;a<h;++a){const l=r[a],d=l.segment;let u=L(l.geometry);const g=l.depth;if(g&&(u+="-"+g.join("-")),o[u]||(o[u]=new Array(2)),l.geometry.getType()==="Circle"&&l.index===W){const f=Me(e,l);P(f,s)&&!o[u][0]&&(this.dragSegments_.push([l,0]),o[u][0]=l);continue}if(P(d[0],s)&&!o[u][0]){this.dragSegments_.push([l,0]),o[u][0]=l;continue}if(P(d[1],s)&&!o[u][1]){if(o[u][0]&&o[u][0].index===0){let f=l.geometry.getCoordinates();switch(l.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":f=f[g[1]];case"Polygon":if(l.index!==f[g[0]].length-2)continue;break}}this.dragSegments_.push([l,1]),o[u][1]=l;continue}L(d)in this.vertexSegments_&&!o[u][0]&&!o[u][1]&&i.push(l)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const n=e.map.getPixelFromCoordinate(t.startCoord);if(R(n,e.pixel)<this.pixelTolerance_)return}const i=et(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const r=t.targets[t.targetIndex];this.removeTracedCoordinates_(r.startIndex,r.endIndex)}else for(const r of this.traceSegments_){const o=r[0],a=o.geometry,h=r[1],l=a.getCoordinates();le(l,a.getType(),o.depth).splice(o.index+h,1),a.setCoordinates(l),h===0&&(o.index-=1)}const n=t.targets[i.index];this.addTracedCoordinates_(n,n.startIndex,i.endIndex)}else{const n=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(n,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex}getTraceCandidates_(e){const t=this.getMap(),i=this.pixelTolerance_,s=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),n=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),r=T([s,n]);return this.traceSource_.getFeaturesInExtent(r)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const i=tt(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let n=Math.floor(t);n===t&&(n-=1),i=n-s+1}else{const s=Math.floor(e);let n=Math.ceil(t);n===t&&(n+=1),i=s-n+1}if(i>0)for(const s of this.traceSegments_){const n=s[0],r=n.geometry,o=s[1];let a=s[0].index+1;o===1&&(a-=i);const h=r.getCoordinates();le(h,r.getType(),n.depth).splice(a,i),r.setCoordinates(h),o===1&&(n.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const n=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let o=n;o<=r;++o)s.push(S(e.coordinates,o))}else{const n=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let o=n;o>=r;--o)s.push(S(e.coordinates,o))}if(s.length)for(const n of this.traceSegments_){const r=n[0],o=r.geometry,a=n[1],h=r.index+1;a===0&&s.reverse();const l=o.getCoordinates();le(l,o.getType(),r.depth).splice(h,0,...s),o.setCoordinates(l),a===1&&(r.index+=s.length)}}updateGeometry_(e,t){const i=t[0],s=i.depth;let n;const r=i.segment,o=i.geometry,a=t[1];for(;e.length<o.getStride();)e.push(r[a][e.length]);switch(o.getType()){case"Point":n=e,r[0]=e,r[1]=e;break;case"MultiPoint":n=o.getCoordinates(),n[i.index]=e,r[0]=e,r[1]=e;break;case"LineString":n=o.getCoordinates(),n[i.index+a]=e,r[a]=e;break;case"MultiLineString":n=o.getCoordinates(),n[s[0]][i.index+a]=e,r[a]=e;break;case"Polygon":n=o.getCoordinates(),n[s[0]][i.index+a]=e,r[a]=e;break;case"MultiPolygon":n=o.getCoordinates(),n[s[1]][s[0]][i.index+a]=e,r[a]=e;break;case"Circle":const h=o;if(r[0]=e,r[1]=e,i.index===Se)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let l=R(v(h.getCenter()),v(e));h.setRadius(l),this.changingFeature_=!1}break}n&&this.setGeometryCoordinates_(o,n)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([r])=>r));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[],n=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(n){this.traceSegments_=[];for(const r of this.dragSegments_){const o=r[0];R(He(n,o.segment),n)/e.map.getView().getResolution()<1&&this.traceSegments_.push(r)}}for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],h=a[0],l=h.feature;i.includes(l)||i.push(l);const d=h.geometry;s.includes(d)||s.push(d),this.updateGeometry_(t,a)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i!=null&&i.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let n=i.length-1;n>=0;--n)this.insertVertex_(i[n],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const n=s,r=n.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(re(r),o);let h=n;this.rBush_.update(h.getExtent(),a)}else this.rBush_.update(T(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new he(ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const s=function(o,a){return Le(e,o)-Le(e,a)};let n,r;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?a=>a===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(a,h,l)=>{l&&l.getType()==="Point"&&(l=new j(ee(l.getCoordinates())));const d=l||a.getGeometry();if(d&&d.getType()==="Point"&&a instanceof M&&this.features_.getArray().includes(a)){r=d;const u=a.getGeometry().getFlatCoordinates().slice(0,2);n=[{feature:a,geometry:r,segment:[u,u]}]}return!0},{layerFilter:o})}if(!n){const o=qe(re(e,Fe)),a=t.getView().getResolution()*this.pixelTolerance_,h=St(gt(o,a,Fe));n=this.rBush_.getInExtent(h)}if(n&&n.length>0){const o=n.sort(s)[0],a=o.segment;let h=Me(e,o);const l=t.getPixelFromCoordinate(h);let d=R(i,l);if(r||d<=this.pixelTolerance_){const u={};if(u[L(a)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===W)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry],this.snappedToVertex_);else{const g=t.getPixelFromCoordinate(a[0]),f=t.getPixelFromCoordinate(a[1]),_=Q(l,g),p=Q(l,f);if(d=Math.sqrt(Math.min(_,p)),this.snappedToVertex_=d<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=_>p?a[1]:a[0]),this.createOrUpdateVertexFeature_(h,[o.feature],[o.geometry],this.snappedToVertex_);const C={};C[L(o.geometry)]=!0;for(let x=1,y=n.length;x<y;++x){const E=n[x].segment;if(P(a[0],E[0])&&P(a[1],E[1])||P(a[0],E[1])&&P(a[1],E[0])){const pe=L(n[x].geometry);pe in C||(C[pe]=!0,u[L(E)]=!0)}else break}}this.vertexSegments_=u;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,n=e.geometry,r=e.depth,o=e.index;let a;for(;t.length<n.getStride();)t.push(0);switch(n.getType()){case"MultiLineString":a=n.getCoordinates(),a[r[0]].splice(o+1,0,t);break;case"Polygon":a=n.getCoordinates(),a[r[0]].splice(o+1,0,t);break;case"MultiPolygon":a=n.getCoordinates(),a[r[1]][r[0]].splice(o+1,0,t);break;case"LineString":a=n.getCoordinates(),a.splice(o+1,0,t);break;default:return!1}this.setGeometryCoordinates_(n,a);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(n,o,r,1);const l={segment:[i[0],t],feature:s,geometry:n,depth:r,index:o};h.insert(T(l.segment),l),this.dragSegments_.push([l,1]);const d={segment:[t,i[1]],feature:s,geometry:n,depth:r,index:o+1};return h.insert(T(d.segment),d),this.dragSegments_.push([d,0]),!0}updatePointer_(e){var t;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates()}getPoint(){var t;const e=(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates();return e?ee(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(T([e])).some(({segment:i})=>P(i[0],e)||P(i[1],e))}removePoint(e){if(e&&(e=v(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=w.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new he(ae.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,n,r,o,a,h,l,d,u,g,f;for(a=e.length-1;a>=0;--a)r=e[a],g=r[0],f=L(g.feature),g.depth&&(f+="-"+g.depth.join("-")),f in t||(t[f]={}),r[1]===0?(t[f].right=g,t[f].index=g.index):r[1]==1&&(t[f].left=g,t[f].index=g.index+1);for(f in t){switch(u=t[f].right,l=t[f].left,h=t[f].index,d=h-1,l!==void 0?g=l:g=u,d<0&&(d=0),o=g.geometry,n=o.getCoordinates(),s=n,i=!1,o.getType()){case"MultiLineString":n[g.depth[0]].length>2&&(n[g.depth[0]].splice(h,1),i=!0);break;case"LineString":n.length>2&&(n.splice(h,1),i=!0);break;case"MultiPolygon":s=s[g.depth[1]];case"Polygon":s=s[g.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),i=!0,h===0&&(s.pop(),s.push(s[0]),d=s.length-1));break}if(i){this.setGeometryCoordinates_(o,n);const _=[];if(l!==void 0&&(this.rBush_.remove(l),_.push(l.segment[0])),u!==void 0&&(this.rBush_.remove(u),_.push(u.segment[1])),l!==void 0&&u!==void 0){const p={depth:g.depth,feature:g.feature,geometry:g.geometry,index:d,segment:_};this.rBush_.insert(T(p.segment),p)}this.updateSegmentIndices_(o,h,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(T([e])).some(({segment:i})=>!(P(i[0],e)||P(i[1],e)))}insertPoint(e){var s;const t=e?v(e,this.getMap().getView().getProjection()):(s=this.vertexFeature_)==null?void 0:s.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,r)=>n||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(n){n.geometry===e&&(i===void 0||n.depth===void 0||ft(n.depth,i))&&n.index>t&&(n.index+=s)})}}function si(c,e){return c.index-e.index}function Le(c,e,t){const i=e.geometry;if(i.getType()==="Circle"){let n=i;if(e.index===W){const r=Q(n.getCenter(),v(c)),o=Math.sqrt(r)-n.getRadius();return o*o}}const s=v(c);return D[0]=v(e.segment[0]),D[1]=v(e.segment[1]),Ft(s,D)}function Me(c,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===W)return ee(i.getClosestPoint(v(c)));const s=v(c);return D[0]=v(e.segment[0]),D[1]=v(e.segment[1]),ee(He(s,D))}function ni(){const c=Qe();return function(e,t){return c.Point}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ci=(c,e,t)=>{for(const i of e)if(i[0]===c)return(0,i[1])();return t==null?void 0:t()},ce="units",ri=[1,2,5],V=25.4/.28;class xi extends A{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+N,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ce,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ce)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ce,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),n=s=="degrees"?"degrees":"m";let r=ye(i,e.resolution,t,n);const o=this.minWidth_*(this.dpi_||V)/V,a=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||V)/V:void 0;let h=o*r,l="";if(s=="degrees"){const y=Lt.degrees;h*=y,h<y/60?(l="",r*=3600):h<y?(l="",r*=60):l=""}else if(s=="imperial")h<.9144?(l="in",r/=.0254):h<1609.344?(l="ft",r/=.3048):(l="mi",r/=1609.344);else if(s=="nautical")r/=1852,l="NM";else if(s=="metric")h<1e-6?(l="nm",r*=1e9):h<.001?(l="m",r*=1e6):h<1?(l="mm",r*=1e3):h<1e3?l="m":(l="km",r/=1e3);else if(s=="us")h<.9144?(l="in",r*=39.37):h<1609.344?(l="ft",r/=.30480061):(l="mi",r/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(o*r)/Math.log(10)),u,g,f,_=0,p,C;for(;;){f=Math.floor(d/3);const y=Math.pow(10,f);if(u=ri[(d%3+3)%3]*y,g=Math.round(u/r),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(a!==void 0&&g>=a){u=_,g=p,f=C;break}else if(g>=o)break;_=u,p=g,C=f,++d}const x=this.scaleBar_?this.createScaleBar(g,u,l):u.toFixed(f<0?-f:0)+" "+l;this.renderedHTML_!=x&&(this.innerElement_.innerHTML=x,this.renderedHTML_=x),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),n=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,o=e/r,a=[this.createMarker("absolute")];for(let l=0;l<r;++l){const d=l%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";a.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${o}px;"></div>`+this.createMarker("relative")+(l%2===0||r===2?this.createStepText(l,e,!1,t,i):"")+"</div>")}return a.push(this.createStepText(r,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+n+"</div>":"")+a.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,n){const o=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+n),a=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${a}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const e=ye(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||V,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const Ie=["fullscreenchange","webkitfullscreenchange"],ke={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class yi extends A{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(F.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${N} ${se}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Re(t))if(Oe(t))ai(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?oi(i):nt(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Oe(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(te(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(ke.ENTERFULLSCREEN)):(te(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(ke.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(B.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(B.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,s=e.length;i<s;++i)_e(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Re(i)?this.element.classList.remove(Te):this.element.classList.add(Te);for(let s=0,n=Ie.length;s<n;++s)e.push(k(i,Ie[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Re(c){const e=c.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&c.fullscreenEnabled)}function Oe(c){return!!(c.webkitIsFullScreen||c.fullscreenElement)}function nt(c){c.requestFullscreen?c.requestFullscreen():c.webkitRequestFullscreen&&c.webkitRequestFullscreen()}function oi(c){c.webkitRequestFullscreen?c.webkitRequestFullscreen():nt(c)}function ai(c){c.exitFullscreen?c.exitFullscreen():c.webkitExitFullscreen&&c.webkitExitFullscreen()}const G={VERTICAL:0,HORIZONTAL:1};class bi extends A{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=G.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+N;const s=this.element;s.className=t+" "+N+" "+se,s.appendChild(i),s.addEventListener(I.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),s.addEventListener(I.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),s.addEventListener(I.POINTERUP,this.handleDraggerEnd_.bind(this),!1),s.addEventListener(F.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(F.CLICK,_t,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),i-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const n=e.firstElementChild,r=getComputedStyle(n),o=n.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),a=n.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);return this.thumbSize_=[o,a],t>i?(this.direction_=G.HORIZONTAL,this.widthLimit_=t-o):(this.direction_=G.VERTICAL,this.heightLimit_=i-a),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(i),n=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:n,duration:this.duration_,easing:Xt})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,s=this.handleDraggerEnd_,n=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(k(n,I.POINTERMOVE,i,this),k(n,I.POINTERUP,s,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,s=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(_e),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==G.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===G.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,ge(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return ge(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const de=.75,$=.1;class vi extends A{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",s=e.collapseLabel!==void 0?e.collapseLabel:"";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const n=e.label!==void 0?e.label:"";typeof n=="string"?(this.label_=document.createElement("span"),this.label_.textContent=n):this.label_=n;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,o=document.createElement("button");o.setAttribute("type","button"),o.title=i,o.appendChild(r),o.addEventListener(F.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const a=new $t({view:e.view,controls:new ie,interactions:new ie});this.ovmap_=a,e.layers&&e.layers.forEach(function(C){a.addLayer(C)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new ei({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const l=t+" "+N+" "+se+(this.collapsed_&&this.collapsible_?" "+we:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=l,d.appendChild(this.ovmapDiv_),d.appendChild(o);const u=this.boxOverlay_,g=this.boxOverlay_.getElement(),f=C=>({clientX:C.clientX,clientY:C.clientY}),_=function(C){const x=f(C),y=a.getEventCoordinate(x);u.setPosition(y)},p=C=>{const x=a.getEventCoordinateInternal(C),y=this.getMap();y.getView().setCenterInternal(x);const E=y.getOwnerDocument();E.removeEventListener("pointermove",_),E.removeEventListener("pointerup",p)};this.ovmapDiv_.addEventListener("pointerdown",C=>{const x=this.getMap().getOwnerDocument();C.target===g&&x.addEventListener("pointermove",_),x.addEventListener("pointerup",p)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(k(e,mt.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&this.bindView_(i),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===B.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===B.TARGET||e.key===B.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new Zt({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Pe.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(Pe.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&pt(n,this.viewExtent_))return;this.viewExtent_=n;const r=t.getSize(),a=t.getView().calculateExtentInternal(r),h=t.getPixelFromCoordinateInternal(je(n)),l=t.getPixelFromCoordinateInternal(Ge(n)),d=Math.abs(h[0]-l[0]),u=Math.abs(h[1]-l[1]),g=r[0],f=r[1];d<g*$||u<f*$||d>g*de||u>f*de?this.resetExtent_():Ae(a,n)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),n=e.getView().calculateExtentInternal(i),r=t.getView(),o=Math.log(de/$)/Math.LN2,a=1/(Math.pow(2,o/2)*$);Ct(n,a),r.fitInternal(Ke(n))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),s=e.getView(),n=t.getView(),r=this.rotateWithView_?0:-s.getRotation(),o=this.boxOverlay_,a=this.boxOverlay_.getElement(),h=s.getCenter(),l=s.getResolution(),d=n.getResolution(),u=i[0]*l/d,g=i[1]*l/d;if(o.setPosition(h),a){a.style.width=u+"px",a.style.height=g+"px";const f="rotate("+r+"rad)";a.style.transform=f}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=xt(this.ovmap_,Ye.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(we),this.collapsed_?te(this.collapseLabel_,this.label_):te(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}class Ti extends A{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null,this.fitOptions=e.fitOptions||{};const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",s=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button"),n.title=s,n.appendChild(typeof i=="string"?document.createTextNode(i):i),n.addEventListener(F.CLICK,this.handleClick_.bind(this),!1);const r=t+" "+N+" "+se,o=this.element;o.className=r,o.appendChild(n)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?qe(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(Ke(i),this.fitOptions)}}const ue="projection",De="coordinateFormat";class wi extends A{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(ue,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(De)}getProjection(){return this.get(ue)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(k(t,I.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(k(t,I.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(De,e)}setProjection(e){this.set(ue,J(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const n=this.getProjection();n?this.transform_=Be(this.mapProjection_,n):this.transform_=Ue}const s=this.getMap().getCoordinateFromPixelInternal(e);if(s){if(this.transform_(s,s),this.wrapX_){const r=this.getProjection()||this.mapProjection_;Mt(s,r)}const n=this.getCoordinateFormat();n?t=n(s):t=s.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}export{_i as D,yi as F,ui as G,gi as I,pi as M,ei as O,xi as S,Ti as Z,wi as a,vi as b,mi as c,bi as d,fi as o,Ci as r};
