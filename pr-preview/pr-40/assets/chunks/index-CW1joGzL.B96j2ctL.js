const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.sId35tsV.js","assets/chunks/addCommonStyleSheet.PdNGfXkV.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.DxKaAqU1.js","assets/chunks/repeat.Bv7BTCoV.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.BoPa7QUb.js","assets/chunks/unsafe-html.ZDWJBRBo.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.CxojoGlr.js"])))=>i.map(i=>d[i]);
import{ao as I,a2 as E,v as f,x as g,p as M,c as C,o as O,G as F,j as h,w as V,t as A,k as c,a5 as R}from"./framework.CAmPm_0f.js";import{_ as H,a as S,h as K,i as k,j as T,k as D,m as n,n as N,o as j}from"./eo-dash.Bdmv6CG5.js";import{i as U}from"./easing-CH0-9wR8.CTB3jml5.js";import{c as G}from"./mdi.CilvuGMU.js";import J from"./EodashLayoutSwitcher-sq9_65PF.BFQNVqsh.js";import{u as z}from"./mosaic-Bqq-1bRX.CV0dYsnr.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./VTooltip-Dq-s2adQ.DIMzygfw.js";import"./forwardRefs-rYHk7jaR.BTWaUYCR.js";import"./transition-DsqRjwWc.BmEXNrNB.js";const Y=r=>o=>{let t="";return r.forEach(i=>{const s=i.property;if(!i.icon&&!i.unitLabel||!o.properties[s])return;i.icon&&(t+=i.icon);let e=o.properties[s];typeof e=="number"&&!Number.isInteger(e)&&(e=e.toFixed(1)),t+=e,i.unitLabel&&(t+=i.unitLabel)}),t},Z=r=>{var s;const t=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((s=S().stac)==null?void 0:s.map(e=>e.id))||[],...k.value&&{state:{[k.value]:!0}}}],i=r.map(e=>{const l=`properties.${e.property}`;return e.type==="range"?{key:l,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:l,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:l,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...t,...i]},q=(r,o)=>{const t=[];return o.forEach(i=>{const s=`properties.${i.property}`,e=r[s];if(e){if(i.type==="range"&&e.state){const{min:l,max:a}=e.state;l!==void 0&&l>(i.min||0)&&t.push(`${i.property}>=${l}`),a!==void 0&&a<(i.max||100)&&t.push(`${i.property}<=${a}`)}else if(i.type==="multiselect"&&e.stringifiedState){const l=e.stringifiedState;l.length>0&&t.push(`${i.property} IN (${l})`)}else if(i.type==="select"&&e.stringifiedState){const l=e.stringifiedState;l&&t.push(`${i.property}='${l}'`)}}}),t.join(" AND ")},Q=(r,o,t)=>{var l,a;const i=S(),s=new URLSearchParams;(l=r.collection)!=null&&l.stringifiedState&&s.append("collections",r.collection.stringifiedState.replaceAll(" ","")),(a=n.value)!=null&&a.lonLatExtent&&t&&s.append("bbox",j([...n.value.lonLatExtent]).join(","));const e=q(r,o);return e&&s.append("filter",e),s.append("limit","100"),`${i.stacEndpoint}/search?${s.toString()}`},W=(r,o)=>{let t=new AbortController;return(i,s)=>({url:Q(s,r,o),fetchFn:async e=>{t.abort(),t=new AbortController;const l=t.signal;return await T.get(e,{signal:l}).then(a=>a.data.features).catch(a=>a.message==="canceled"?[]:(console.error(a),[]))}})},X=r=>o=>{r.value=o.detail.results,x(r.value)},_=r=>async o=>{var i,s,e;const t=o.detail;t&&(((i=r.selectedStac)==null?void 0:i.id)===t.collection?r.selectedItem=t:await r.loadSelectedSTAC(t.collection,!1,t),N.showButton=!0,(e=(s=n.value)==null?void 0:s.selectInteractions["stac-items"])==null||e.highlightById([t.id],{padding:[100,100,100,100],duration:1200,easing:U}))},L=r=>{var o,t;(t=(o=n.value)==null?void 0:o.selectInteractions["stac-items"])==null||t.highlightById([r.detail.id])},P=()=>{var r,o;(o=(r=n.value)==null?void 0:r.selectInteractions["stac-items"])==null||o.highlightById([])};function x(r){var s,e;let o=(e=(s=n.value)==null?void 0:s.layers)==null?void 0:e.find(l=>{var a;return((a=l.properties)==null?void 0:a.id)==="AnalysisGroup"});if(!n.value||!r)return;o||(o={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},n.value.layers=[...n.value.layers,o]);const t={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:r})),format:"GeoJSON"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-items",condition:"pointermove",style:{"stroke-color":"white","stroke-width":3}}},{type:"select",options:{id:"stac-items",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]};if(o.layers.some(l=>{var a;return((a=l.properties)==null?void 0:a.id)==="stac-items"})){n.value.addOrUpdateLayer(t);return}else o.layers.push(t),n.value.layers=[...n.value.layers]}const ee=(r,o)=>{if(!o)return;let t;const i=()=>{clearTimeout(t),t=setTimeout(()=>{var s;(s=r.value)==null||s.search()},800)};f(()=>{var s;(s=n.value)==null||s.map.on("moveend",i)}),g(()=>{var s;(s=n.value)==null||s.map.un("moveend",i)})},te=r=>{f(()=>{x(r.value)}),D(()=>{x(r.value)})};function se(r){const o=t=>{var e,l,a;if(t.detail.originalEvent.type!=="pointermove")return;const i=(l=(e=t.detail)==null?void 0:e.feature)==null?void 0:l.getId();if(!i)return;const s=(a=r.value.results)==null?void 0:a.find(p=>p.id===i);s&&(r.value.selectedResult=s)};f(()=>{var t;(t=n.value)==null||t.addEventListener("select",o)}),g(()=>{var t;(t=n.value)==null||t.removeEventListener("select",o)})}function re(r,o){const t=_(o),i=s=>{var a,p,v;if(s.detail.originalEvent.type!=="click")return;const e=(p=(a=s.detail)==null?void 0:a.feature)==null?void 0:p.getId();if(!e)return;const l=(v=r.value.results)==null?void 0:v.find(m=>(m==null?void 0:m.id)===e);l&&t(new CustomEvent("select",{detail:l}))};f(()=>{var s;(s=n.value)==null||s.addEventListener("select",i)}),g(()=>{var s;(s=n.value)==null||s.removeEventListener("select",i)})}const ie=".item-catalog-container[data-v-7d906693]{overflow:hidden}.itemfilter-scroll[data-v-7d906693]{flex:1;min-height:0;overflow:hidden;padding:.5rem;--eox-itemfilter-results-color: var(--v-theme-primary) !important}.title[data-v-7d906693]{padding:1em;margin:.2em;flex-shrink:0}",le=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],oe={slot:"filterstitle",style:{margin:"14px 8px"}},ae={slot:"resultstitle",style:{margin:"14px 8px"}},ne={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:G},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]},useMosaic:{type:Boolean,default:!1}},async setup(r){let o,t;customElements.get("eox-itemfilter")||([o,t]=I(()=>R(()=>import("./main.sId35tsV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await o,t());const i=r,s=E("root"),e=E("itemfilter");let l=null;f(async()=>{var y;l=((y=s.value)==null?void 0:y.parentElement)??null,l&&(l.style.overflow="hidden",l.style.display="flex",l.style.flexDirection="column")}),g(()=>{l&&(l.style.overflow="",l.style.display="",l.style.flexDirection=""),a.selectedItem=null});const a=S();i.useMosaic&&a.mosaicEndpoint&&z(a.mosaicEndpoint,{},a);const p=M([]);a.stacEndpoint&&([o,t]=I(()=>T.get(a.stacEndpoint+"/search?limit=100").then(y=>p.value=y.data.features)),await o,t());const v=p.value,m=Z(i.filters),$=Y(i.filters),B=W(i.filters,i.bboxFilter),b=X(p),w=_(a);return te(p),ee(e,i.bboxFilter),re(e,a),se(e),(y,u)=>(O(),C("div",{ref_key:"root",ref:s,class:"d-flex flex-column item-catalog-container"},[F(K,{class:"title align-center justify-space-between flex-shrink-0"},{default:V(()=>[u[4]||(u[4]=h("h4",null,"Catalog Items",-1)),F(J,{target:r.layoutTarget,icon:r.layoutIcon},null,8,["target","icon"])]),_:1}),h("eox-itemfilter",{class:"itemfilter-scroll",ref:"itemfilter",titleProperty:"id",".imageProperty":r.imageProperty,".subTitleProperty":c($),".filterProperties":c(m),".items":c(v),onSelect:u[0]||(u[0]=(...d)=>c(w)&&c(w)(...d)),onFilter:u[1]||(u[1]=(...d)=>c(b)&&c(b)(...d)),"onMouseenter:result":u[2]||(u[2]=(...d)=>c(L)&&c(L)(...d)),"onMouseleave:result":u[3]||(u[3]=(...d)=>c(P)&&c(P)(...d)),externalFilter:c(B)},[h("h4",oe,A(r.filtersTitle),1),h("h4",ae,A(r.resultsTitle),1)],40,le)],512))}},Se=H(ne,[["styles",[ie]],["__scopeId","data-v-7d906693"]]);export{Se as default};
