import{o as P,j as D}from"./extent.ASDbTExA.js";const g={ADD:"add",REMOVE:"remove"},T={PROPERTYCHANGE:"propertychange"},b={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Y{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function j(i,e,t){let s,n;t=t||S;let r=0,h=i.length,l=!1;for(;r<h;)s=r+(h-r>>1),n=+t(i[s],e),n<0?r=s+1:(h=s,l=!n);return l?r:~r}function S(i,e){return i>e?1:i<e?-1:0}function H(i,e){return i<e?1:i>e?-1:0}function z(i,e,t){if(i[0]<=e)return 0;const s=i.length;if(e<=i[s-1])return s-1;if(typeof t=="function"){for(let n=1;n<s;++n){const r=i[n];if(r===e)return n;if(r<e)return t(e,i[n-1],r)>0?n-1:n}return s-1}if(t>0){for(let n=1;n<s;++n)if(i[n]<e)return n-1;return s-1}if(t<0){for(let n=1;n<s;++n)if(i[n]<=e)return n;return s-1}for(let n=1;n<s;++n){if(i[n]==e)return n;if(i[n]<e)return i[n-1]-e<e-i[n]?n-1:n}return s-1}function k(i,e,t){for(;e<t;){const s=i[e];i[e]=i[t],i[t]=s,++e,--t}}function F(i,e){const t=Array.isArray(e)?e:[e],s=t.length;for(let n=0;n<s;n++)i[i.length]=t[n]}function V(i,e){const t=i.length;if(t!==e.length)return!1;for(let s=0;s<t;s++)if(i[s]!==e[s])return!1;return!0}function $(i,e,t){const s=e||S;return i.every(function(n,r){if(r===0)return!0;const h=s(i[r-1],n);return!(h>0||h===0)})}function W(){return!0}function J(){return!1}function R(){}function Q(i){let e,t,s;return function(){const n=Array.prototype.slice.call(arguments);return(!t||this!==s||!V(n,t))&&(s=this,t=n,e=i.apply(this,arguments)),e}}function ee(i){function e(){let t;try{t=i()}catch(s){return Promise.reject(s)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function O(i){for(const e in i)delete i[e]}function K(i){let e;for(e in i)return!1;return!e}class E{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class U extends Y{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const s=this.listeners_||(this.listeners_={}),n=s[e]||(s[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",s=t?e:e.type,n=this.listeners_&&this.listeners_[s];if(!n)return;const r=t?new E(e):e;r.target||(r.target=this.eventTarget_||this);const h=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});s in h||(h[s]=0,l[s]=0),++h[s];let o;for(let f=0,C=n.length;f<C;++f)if("handleEvent"in n[f]?o=n[f].handleEvent(r):o=n[f].call(this,r),o===!1||r.propagationStopped){o=!1;break}if(--h[s]===0){let f=l[s];for(delete l[s];f--;)this.removeEventListener(s,R);delete h[s]}return o}disposeInternal(){this.listeners_&&O(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const s=this.listeners_[e];if(!s)return;const n=s.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(s[n]=R,++this.pendingRemovals_[e]):(s.splice(n,1),s.length===0&&delete this.listeners_[e]))}}function u(i,e,t,s,n){if(n){const h=t;t=function(l){return i.removeEventListener(e,t),h.call(s??this,l)}}else s&&s!==i&&(t=t.bind(s));const r={target:i,type:e,listener:t};return i.addEventListener(e,t),r}function I(i,e,t,s){return u(i,e,t,s,!0)}function y(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),O(i))}class p extends U{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(b.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const s=e.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=u(this,e[r],t);return n}return u(this,e,t)}onceInternal(e,t){let s;if(Array.isArray(e)){const n=e.length;s=new Array(n);for(let r=0;r<n;++r)s[r]=I(this,e[r],t)}else s=I(this,e,t);return t.ol_key=s,s}unInternal(e,t){const s=t.ol_key;if(s)G(s);else if(Array.isArray(e))for(let n=0,r=e.length;n<r;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}p.prototype.on;p.prototype.once;p.prototype.un;function G(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)y(i[e]);else y(i)}function m(){throw new Error("Unimplemented abstract method.")}let X=0;function v(i){return i.ol_uid||(i.ol_uid=String(++X))}class M extends E{constructor(e,t,s){super(e),this.key=t,this.oldValue=s}}class w extends p{constructor(e){super(),this.on,this.once,this.un,v(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let s;s=`change:${e}`,this.hasListener(s)&&this.dispatchEvent(new M(s,e,t)),s=T.PROPERTYCHANGE,this.hasListener(s)&&this.dispatchEvent(new M(s,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,s){const n=this.values_||(this.values_={});if(s)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const s in e)this.set(s,e[s],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const s=this.values_[e];delete this.values_[e],K(this.values_)&&(this.values_=null),t||this.notify(e,s)}}}const x={LENGTH:"length"};class _ extends E{constructor(e,t,s){super(e),this.element=t,this.index=s}}class N extends w{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let s=1,n=this.array_.length;s<n;++s)this.assertUnique_(this.array_[s],s);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,s=e.length;t<s;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let s=0,n=t.length;s<n;++s)e(t[s],s,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(x.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new _(g.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let s=0,n=t.length;s<n;++s)if(t[s]===e)return this.removeAt(s)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new _(g.REMOVE,t,e)),t}setAt(e,t){const s=this.getLength();if(e>=s){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new _(g.REMOVE,n,e)),this.dispatchEvent(new _(g.ADD,t,e))}updateLength_(){this.set(x.LENGTH,this.array_.length)}assertUnique_(e,t){const s=this.array_;for(let n=0,r=s.length;n<r;++n)if(s[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}function A(i,e){if(!i)throw new Error(e)}const a={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class q extends w{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[a.OPACITY]=e.opacity!==void 0?e.opacity:1,A(typeof t[a.OPACITY]=="number","Layer opacity must be a number"),t[a.VISIBLE]=e.visible!==void 0?e.visible:!0,t[a.Z_INDEX]=e.zIndex,t[a.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[a.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[a.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[a.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},s=this.getZIndex();return t.opacity=P(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=s===void 0&&!t.managed?1/0:s,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return m()}getLayerStatesArray(e){return m()}getExtent(){return this.get(a.EXTENT)}getMaxResolution(){return this.get(a.MAX_RESOLUTION)}getMinResolution(){return this.get(a.MIN_RESOLUTION)}getMinZoom(){return this.get(a.MIN_ZOOM)}getMaxZoom(){return this.get(a.MAX_ZOOM)}getOpacity(){return this.get(a.OPACITY)}getSourceState(){return m()}getVisible(){return this.get(a.VISIBLE)}getZIndex(){return this.get(a.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(a.EXTENT,e)}setMaxResolution(e){this.set(a.MAX_RESOLUTION,e)}setMinResolution(e){this.set(a.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(a.MAX_ZOOM,e)}setMinZoom(e){this.set(a.MIN_ZOOM,e)}setOpacity(e){A(typeof e=="number","Layer opacity must be a number"),this.set(a.OPACITY,e)}setVisible(e){this.set(a.VISIBLE,e)}setZIndex(e){this.set(a.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const c={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class d extends E{constructor(e,t){super(e),this.layer=t}}const L={LAYERS:"layers"};class Z extends q{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let s=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(L.LAYERS,this.handleLayersChanged_),s?Array.isArray(s)?s=new N(s.slice(),{unique:!0}):A(typeof s.getArray=="function","Expected `layers` to be an array or a `Collection`"):s=new N(void 0,{unique:!0}),this.setLayers(s)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(y),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(u(e,g.ADD,this.handleLayersAdd_,this),u(e,g.REMOVE,this.handleLayersRemove_,this));for(const s in this.listenerKeys_)this.listenerKeys_[s].forEach(y);O(this.listenerKeys_);const t=e.getArray();for(let s=0,n=t.length;s<n;s++){const r=t[s];this.registerLayerListeners_(r),this.dispatchEvent(new d(c.ADDLAYER,r))}this.changed()}registerLayerListeners_(e){const t=[u(e,T.PROPERTYCHANGE,this.handleLayerChange_,this),u(e,b.CHANGE,this.handleLayerChange_,this)];e instanceof Z&&t.push(u(e,c.ADDLAYER,this.handleLayerGroupAdd_,this),u(e,c.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[v(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new d(c.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new d(c.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new d(c.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,s=v(t);this.listenerKeys_[s].forEach(y),delete this.listenerKeys_[s],this.dispatchEvent(new d(c.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(L.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const s=t.getArray();for(let n=0,r=s.length;n<r;++n)this.dispatchEvent(new d(c.REMOVELAYER,s[n]))}this.set(L.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],s=t.length;this.getLayers().forEach(function(h){h.getLayerStatesArray(t)});const n=this.getLayerState();let r=n.zIndex;!e&&n.zIndex===void 0&&(r=0);for(let h=s,l=t.length;h<l;h++){const o=t[h];o.opacity*=n.opacity,o.visible=o.visible&&n.visible,o.maxResolution=Math.min(o.maxResolution,n.maxResolution),o.minResolution=Math.max(o.minResolution,n.minResolution),o.minZoom=Math.max(o.minZoom,n.minZoom),o.maxZoom=Math.min(o.maxZoom,n.maxZoom),n.extent!==void 0&&(o.extent!==void 0?o.extent=D(o.extent,n.extent):o.extent=n.extent),o.zIndex===void 0&&(o.zIndex=r)}return t}getSourceState(){return"ready"}}export{E as B,N as C,Y as D,b as E,J as F,d as G,Z as L,T as O,W as T,R as V,S as a,A as b,O as c,U as d,V as e,m as f,v as g,a as h,H as i,K as j,w as k,u as l,j as m,F as n,Q as o,g as p,z as q,k as r,q as s,ee as t,y as u,I as v,p as w,$ as x};
