var an=Object.defineProperty;var ln=(i,t,e)=>t in i?an(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Ie=(i,t,e)=>ln(i,typeof t!="symbol"?t+"":t,e);import{s as Ut,B as de,u as tt,V as hn,l as V,n as H,a as bt,aj as cn,O as un,E as et,m as nt,a4 as fn,ah as Me,ak as Be,al as gn,a3 as dn,am as mn,q as pn,an as _n}from"./Polygon.FVLon8Z8.js";import{m as B,C as zt,l as yn,B as ze,an as Ae,T as je,e as En,F as gt,E as P,u as me,ar as xn,d as Tn,j as wn,L as Ue,as as In,x as Mn,r as An,q as Rn,p as Ln,am as fe,n as Re,i as Sn,N as Xt,a6 as Vt,z as Cn,h as $e,G as Ft,J as Yt,g as $t,ao as vn,at as On,w as Ht}from"./proj.DNHHD1fb.js";import{a as bn}from"./easing.vFiYzKl6.js";const mt={ADD:"add",REMOVE:"remove"},Le={LENGTH:"length"};class Dt extends de{constructor(t,e,n){super(t),this.element=e,this.index=n}}class Se extends Ut{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t??[],this.unique_)for(let n=1,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Le.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Dt(mt.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Dt(mt.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Dt(mt.REMOVE,r,t)),this.dispatchEvent(new Dt(mt.ADD,e,t))}updateLength_(){this.set(Le.LENGTH,this.array_.length)}assertUnique_(t,e){const n=this.array_;for(let r=0,s=n.length;r<s;++r)if(n[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}}const it=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Xn=it.includes("safari")&&!it.includes("chrom"),lr=Xn&&(it.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(it)),hr=it.includes("webkit")&&!it.includes("edge"),cr=it.includes("macintosh"),ur=typeof devicePixelRatio<"u"?devicePixelRatio:1,jt=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pe=typeof Image<"u"&&Image.prototype.decode,We=typeof createImageBitmap=="function",fr=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),Pn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},gr={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},x={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Fn=42,ke=256,dr="ol-hidden",mr="ol-selectable",pr="ol-unselectable",_r="ol-unsupported",yr="ol-control",Er="ol-collapsed",Yn=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Ce=["style","variant","weight","size","lineHeight","family"],ve={normal:400,bold:700},xr=function(i){const t=i.match(Yn);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,r=Ce.length;n<r;++n){const s=t[n+1];s!==void 0&&(e[Ce[n]]=typeof s=="string"?s.trim():s)}return isNaN(Number(e.weight))&&e.weight in ve&&(e.weight=ve[e.weight]),e.families=e.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),e};function _t(i,t,e,n){let r;return e&&e.length?r=e.shift():jt?r=new class extends OffscreenCanvas{constructor(){super(...arguments);Ie(this,"style",{})}}(i??300,t??150):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let Qt;function Tr(){return Qt||(Qt=_t(1,1)),Qt}function _e(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function wr(i){let t=i.offsetWidth;const e=getComputedStyle(i);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Ir(i){let t=i.offsetHeight;const e=getComputedStyle(i);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Mr(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function Ar(i){for(;i.lastChild;)i.lastChild.remove()}function Rr(i,t){const e=i.childNodes;for(let n=0;;++n){const r=e[n],s=t[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}function Lr(){return new Proxy({childNodes:[],appendChild:function(t){return this.childNodes.push(t),t},remove:function(){},removeChild:function(t){const e=this.childNodes.indexOf(t);if(e===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(e,1),t},insertBefore:function(t,e){const n=this.childNodes.indexOf(e);if(n===-1)throw new Error("Reference node not found");return this.childNodes.splice(n,0,t),t},style:{}},{get(t,e,n){return e==="firstElementChild"?t.childNodes.length>0?t.childNodes[0]:null:Reflect.get(t,e,n)}})}function Sr(i){return typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}class Cr extends Ut{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let n=0,r=this.listenerKeys.length;n<r;++n)tt(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=t,t){const n=this.target_??t.getOverlayContainerStopEvent();this.element&&n.appendChild(this.element),this.render!==hn&&this.listenerKeys.push(V(t,Pn.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const L={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Dn extends Ut{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[L.OPACITY]=t.opacity!==void 0?t.opacity:1,H(typeof e[L.OPACITY]=="number","Layer opacity must be a number"),e[L.VISIBLE]=t.visible!==void 0?t.visible:!0,e[L.Z_INDEX]=t.zIndex,e[L.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[L.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[L.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[L.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=B(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return bt()}getLayerStatesArray(t){return bt()}getExtent(){return this.get(L.EXTENT)}getMaxResolution(){return this.get(L.MAX_RESOLUTION)}getMinResolution(){return this.get(L.MIN_RESOLUTION)}getMinZoom(){return this.get(L.MIN_ZOOM)}getMaxZoom(){return this.get(L.MAX_ZOOM)}getOpacity(){return this.get(L.OPACITY)}getSourceState(){return bt()}getVisible(){return this.get(L.VISIBLE)}getZIndex(){return this.get(L.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(L.EXTENT,t)}setMaxResolution(t){this.set(L.MAX_RESOLUTION,t)}setMinResolution(t){this.set(L.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(L.MAX_ZOOM,t)}setMinZoom(t){this.set(L.MIN_ZOOM,t)}setOpacity(t){H(typeof t=="number","Layer opacity must be a number"),this.set(L.OPACITY,t)}setVisible(t){this.set(L.VISIBLE,t)}setZIndex(t){this.set(L.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const k={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class lt extends de{constructor(t,e){super(t),this.layer=e}}const Jt={LAYERS:"layers"};class qe extends Dn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Jt.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Se(n.slice(),{unique:!0}):H(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Se(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(tt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(V(t,mt.ADD,this.handleLayersAdd_,this),V(t,mt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(tt);cn(this.listenerKeys_);const e=t.getArray();for(let n=0,r=e.length;n<r;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new lt(k.ADDLAYER,s))}this.changed()}registerLayerListeners_(t){const e=[V(t,un.PROPERTYCHANGE,this.handleLayerChange_,this),V(t,et.CHANGE,this.handleLayerChange_,this)];t instanceof qe&&e.push(V(t,k.ADDLAYER,this.handleLayerGroupAdd_,this),V(t,k.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[nt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new lt(k.ADDLAYER,t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new lt(k.REMOVELAYER,t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new lt(k.ADDLAYER,e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=nt(e);this.listenerKeys_[n].forEach(tt),delete this.listenerKeys_[n],this.dispatchEvent(new lt(k.REMOVELAYER,e)),this.changed()}getLayers(){return this.get(Jt.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new lt(k.REMOVELAYER,n[r]))}this.set(Jt.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=zt(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}function Ke(i,t,e=0,n=i.length-1,r=Nn){for(;n>e;){if(n-e>600){const l=n-e+1,c=t-e+1,u=Math.log(l),f=.5*Math.exp(2*u/3),R=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),v=Math.max(e,Math.floor(t-c*f/l+R)),g=Math.min(n,Math.floor(t+(l-c)*f/l+R));Ke(i,t,v,g,r)}const s=i[t];let o=e,a=n;for(It(i,e,t),r(i[n],s)>0&&It(i,e,n);o<a;){for(It(i,o,a),o++,a--;r(i[o],s)<0;)o++;for(;r(i[a],s)>0;)a--}r(i[e],s)===0?It(i,e,a):(a++,It(i,a,n)),a<=t&&(e=a+1),t<=a&&(n=a-1)}}function It(i,t,e){const n=i[t];i[t]=i[e],i[e]=n}function Nn(i,t){return i<t?-1:i>t?1:0}let vr=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Gt(t,e))return n;const r=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?r(a):a;Gt(t,l)&&(e.leaf?n.push(a):ee(t,l)?this._all(a,n):s.push(a))}e=s.pop()}return n}collides(t){let e=this.data;if(!Gt(t,e))return!1;const n=[];for(;e;){for(let r=0;r<e.children.length;r++){const s=e.children[r],o=e.leaf?this.toBBox(s):s;if(Gt(t,o)){if(e.leaf||ee(t,o))return!0;n.push(s)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=dt([]),this}remove(t,e){if(!t)return this;let n=this.data;const r=this.toBBox(t),s=[],o=[];let a,l,c;for(;n||s.length;){if(n||(n=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),n.leaf){const u=Gn(t,n.children,e);if(u!==-1)return n.children.splice(u,1),s.push(n),this._condense(s),this}!c&&!n.leaf&&ee(n,r)?(s.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,r){const s=n-e+1;let o=this._maxEntries,a;if(s<=o)return a=dt(t.slice(e,n+1)),ht(a,this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),a=dt([]),a.leaf=!1,a.height=r;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));Oe(t,e,n,c,this.compareMinX);for(let u=e;u<=n;u+=c){const f=Math.min(u+c-1,n);Oe(t,u,f,l,this.compareMinY);for(let R=u;R<=f;R+=l){const v=Math.min(R+l-1,f);a.children.push(this._build(t,R,v,r-1))}}return ht(a,this.toBBox),a}_chooseSubtree(t,e,n,r){for(;r.push(e),!(e.leaf||r.length-1===n);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const c=e.children[l],u=te(c),f=zn(t,c)-u;f<o?(o=f,s=u<s?u:s,a=c):f===o&&u<s&&(s=u,a=c)}e=a||e.children[0]}return e}_insert(t,e,n){const r=n?t:this.toBBox(t),s=[],o=this._chooseSubtree(r,this.data,e,s);for(o.children.push(t),Lt(o,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)}_split(t,e){const n=t[e],r=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,r);const o=this._chooseSplitIndex(n,s,r),a=dt(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,ht(n,this.toBBox),ht(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,e){this.data=dt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ht(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let r,s=1/0,o=1/0;for(let a=e;a<=n-e;a++){const l=Rt(t,0,a,this.toBBox),c=Rt(t,a,n,this.toBBox),u=jn(l,c),f=te(l)+te(c);u<s?(s=u,r=a,o=f<o?f:o):u===s&&f<o&&(o=f,r=a)}return r||n-e}_chooseSplitAxis(t,e,n){const r=t.leaf?this.compareMinX:Zn,s=t.leaf?this.compareMinY:Bn,o=this._allDistMargin(t,e,n,r),a=this._allDistMargin(t,e,n,s);o<a&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const s=this.toBBox,o=Rt(t,0,e,s),a=Rt(t,n-e,n,s);let l=Nt(o)+Nt(a);for(let c=e;c<n-e;c++){const u=t.children[c];Lt(o,t.leaf?s(u):u),l+=Nt(o)}for(let c=n-e-1;c>=e;c--){const u=t.children[c];Lt(a,t.leaf?s(u):u),l+=Nt(a)}return l}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)Lt(e[r],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():ht(t[e],this.toBBox)}};function Gn(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function ht(i,t){Rt(i,0,i.children.length,t,i)}function Rt(i,t,e,n,r){r||(r=dt(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<e;s++){const o=i.children[s];Lt(r,i.leaf?n(o):o)}return r}function Lt(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function Zn(i,t){return i.minX-t.minX}function Bn(i,t){return i.minY-t.minY}function te(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Nt(i){return i.maxX-i.minX+(i.maxY-i.minY)}function zn(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function jn(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),r=Math.min(i.maxX,t.maxX),s=Math.min(i.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,s-n)}function ee(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Gt(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function dt(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Oe(i,t,e,n,r){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;Ke(i,o,t,e,r),s.push(t,o,o,e)}}const Un=[NaN,NaN,NaN,0];let ne;function $n(){return ne||(ne=_t(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),ne}const Wn=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,kn=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,qn=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Kn=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Zt(i,t){return i.endsWith("%")?Number(i.substring(0,i.length-1))/t:Number(i)}function Pt(i){throw new Error('failed to parse "'+i+'" as color')}function Ve(i){if(i.toLowerCase().startsWith("rgb")){const s=i.match(kn)||i.match(Wn)||i.match(qn);if(s){const o=s[4],a=100/255;return[B(Zt(s[1],a)+.5|0,0,255),B(Zt(s[2],a)+.5|0,0,255),B(Zt(s[3],a)+.5|0,0,255),o!==void 0?B(Zt(o,100),0,1):1]}Pt(i)}if(i.startsWith("#")){if(Kn.test(i)){const s=i.substring(1),o=s.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=s.length;l<c;l+=o){let u=parseInt(s.substring(l,l+o),16);o===1&&(u+=u<<4),a[l/o]=u}return a[3]=a[3]/255,a}Pt(i)}const t=$n();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=i,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=i,t.fillStyle===e&&Pt(i));const n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return Ve(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const r=Array.from(t.getImageData(0,0,1,1).data);return r[3]=yn(r[3]/255,3),r}function br(i){return typeof i=="string"?i:He(i)}const Vn=1024,Mt={};let ie=0;function Hn(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function re(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function se(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function oe(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function ae(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function be(i){const t=oe(i[0]),e=oe(i[1]),n=oe(i[2]),r=ae(t*.222488403+e*.716873169+n*.06060791),s=500*(ae(t*.452247074+e*.399439023+n*.148375274)-r),o=200*(r-ae(t*.016863605+e*.117638439+n*.865350722)),a=Math.atan2(o,s)*(180/Math.PI);return[116*r-16,Math.sqrt(s*s+o*o),a<0?a+360:a,i[3]]}function Qn(i){const t=(i[0]+16)/116,e=i[1],n=i[2]*Math.PI/180,r=se(t),s=se(t+e/500*Math.cos(n)),o=se(t-e/200*Math.sin(n)),a=re(s*3.021973625-r*1.617392459-o*.404875592),l=re(s*-.943766287+r*1.916279586+o*.027607165),c=re(s*.069407491-r*.22898585+o*1.159737864);return[B(a+.5|0,0,255),B(l+.5|0,0,255),B(c+.5|0,0,255),i[3]]}function ye(i){if(i==="none")return Un;if(Mt.hasOwnProperty(i))return Mt[i];if(ie>=Vn){let e=0;for(const n in Mt)e++&3||(delete Mt[n],--ie)}const t=Ve(i);t.length!==4&&Pt(i);for(const e of t)isNaN(e)&&Pt(i);return Mt[i]=t,++ie,t}function Xr(i){return Array.isArray(i)?i:ye(i)}function He(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}function Pr(i){return i[0]>0&&i[1]>0}function Jn(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function Q(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let rt=0;const F=1<<rt++,w=1<<rt++,Y=1<<rt++,U=1<<rt++,ge=1<<rt++,St=1<<rt++,Bt=Math.pow(2,rt)-1,Ee={[F]:"boolean",[w]:"number",[Y]:"string",[U]:"color",[ge]:"number[]",[St]:"size"},ti=Object.keys(Ee).map(Number).sort(fn);function ei(i){return i in Ee}function Ct(i){const t=[];for(const e of ti)vt(i,e)&&t.push(Ee[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function vt(i,t){return(i&t)===t}function q(i,t){return i===t}class C{constructor(t,e){if(!ei(t))throw new Error(`literal expressions must have a specific type, got ${Ct(t)}`);this.type=t,this.value=e}}class ni{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Fr(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function O(i,t,e){switch(typeof i){case"boolean":{if(q(t,Y))return new C(Y,i?"true":"false");if(!vt(t,F))throw new Error(`got a boolean, but expected ${Ct(t)}`);return new C(F,i)}case"number":{if(q(t,St))return new C(St,Q(i));if(q(t,F))return new C(F,!!i);if(q(t,Y))return new C(Y,i.toString());if(!vt(t,w))throw new Error(`got a number, but expected ${Ct(t)}`);return new C(w,i)}case"string":{if(q(t,U))return new C(U,ye(i));if(q(t,F))return new C(F,!!i);if(!vt(t,Y))throw new Error(`got a string, but expected ${Ct(t)}`);return new C(Y,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return gi(i,t,e);for(const n of i)if(typeof n!="number")throw new Error("expected an array of numbers");if(q(t,St)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new C(St,i)}if(q(t,U)){if(i.length===3)return new C(U,[...i,1]);if(i.length===4)return new C(U,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!vt(t,ge))throw new Error(`got an array of numbers, but expected ${Ct(t)}`);return new C(ge,i)}const h={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},ii={[h.Get]:m(p(1,1/0),Xe),[h.Var]:m(p(1,1),ri),[h.Has]:m(p(1,1/0),Xe),[h.Id]:m(si,ct),[h.Concat]:m(p(2,1/0),M(Y)),[h.GeometryType]:m(oi,ct),[h.LineMetric]:m(ct),[h.Resolution]:m(le,ct),[h.Zoom]:m(le,ct),[h.Time]:m(le,ct),[h.Any]:m(p(2,1/0),M(F)),[h.All]:m(p(2,1/0),M(F)),[h.Not]:m(p(1,1),M(F)),[h.Equal]:m(p(2,2),M(Bt)),[h.NotEqual]:m(p(2,2),M(Bt)),[h.GreaterThan]:m(p(2,2),M(w)),[h.GreaterThanOrEqualTo]:m(p(2,2),M(w)),[h.LessThan]:m(p(2,2),M(w)),[h.LessThanOrEqualTo]:m(p(2,2),M(w)),[h.Multiply]:m(p(2,1/0),Pe),[h.Coalesce]:m(p(2,1/0),Pe),[h.Divide]:m(p(2,2),M(w)),[h.Add]:m(p(2,1/0),M(w)),[h.Subtract]:m(p(2,2),M(w)),[h.Clamp]:m(p(3,3),M(w)),[h.Mod]:m(p(2,2),M(w)),[h.Pow]:m(p(2,2),M(w)),[h.Abs]:m(p(1,1),M(w)),[h.Floor]:m(p(1,1),M(w)),[h.Ceil]:m(p(1,1),M(w)),[h.Round]:m(p(1,1),M(w)),[h.Sin]:m(p(1,1),M(w)),[h.Cos]:m(p(1,1),M(w)),[h.Atan]:m(p(1,2),M(w)),[h.Sqrt]:m(p(1,1),M(w)),[h.Match]:m(p(4,1/0),Fe,li),[h.Between]:m(p(3,3),M(w)),[h.Interpolate]:m(p(6,1/0),Fe,hi),[h.Case]:m(p(3,1/0),ai,ci),[h.In]:m(p(2,2),ui),[h.Number]:m(p(1,1/0),M(Bt)),[h.String]:m(p(1,1/0),M(Bt)),[h.Array]:m(p(1,1/0),M(w)),[h.Color]:m(p(1,4),M(w)),[h.Band]:m(p(1,3),M(w)),[h.Palette]:m(p(2,2),fi),[h.ToString]:m(p(1,1),M(F|w|Y|U))};function Xe(i,t,e){const n=i.length-1,r=new Array(n);for(let s=0;s<n;++s){const o=i[s+1];switch(typeof o){case"number":{r[s]=new C(w,o);break}case"string":{r[s]=new C(Y,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}s===0&&e.properties.add(String(o))}return r}function ri(i,t,e){const n=i[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return e.variables.add(n),[new C(Y,n)]}function si(i,t,e){e.featureId=!0}function oi(i,t,e){e.geometryType=!0}function le(i,t,e){e.mapState=!0}function ct(i,t,e){const n=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function p(i,t){return function(e,n,r){const s=e[0],o=e.length-1;if(i===t){if(o!==i){const a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${s}, got ${o}`)}}else if(o<i||o>t){const a=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${a} arguments for ${s}, got ${o}`)}}}function Pe(i,t,e){const n=i.length-1,r=new Array(n);for(let s=0;s<n;++s){const o=O(i[s+1],t,e);r[s]=o}return r}function M(i){return function(t,e,n){const r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=O(t[o+1],i,n);s[o]=a}return s}}function ai(i,t,e){const n=i[0],r=i.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${r} instead`)}function Fe(i,t,e){const n=i[0],r=i.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${r} instead`)}function li(i,t,e){const n=i.length-1,r=Y|w|F,s=O(i[1],r,e),o=O(i[i.length-1],t,e),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{const c=O(i[l+2],s.type,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{const c=O(i[l+3],o.type,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[s,...a,o]}function hi(i,t,e){const n=i[1];let r;switch(n[0]){case"linear":r=1;break;case"exponential":const l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);r=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const s=new C(w,r);let o;try{o=O(i[2],w,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{const c=O(i[l+3],w,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{const c=O(i[l+4],t,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[s,o,...a]}function ci(i,t,e){const n=O(i[i.length-1],t,e),r=new Array(i.length-1);for(let s=0;s<r.length-1;s+=2){try{const o=O(i[s+1],F,e);r[s]=o}catch(o){throw new Error(`failed to parse argument ${s} of case expression: ${o.message}`)}try{const o=O(i[s+2],n.type,e);r[s+1]=o}catch(o){throw new Error(`failed to parse argument ${s+1} of case expression: ${o.message}`)}}return r[r.length-1]=n,r}function ui(i,t,e){let n=i[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],r=Y}else r=w;const s=new Array(n.length);for(let a=0;a<s.length;a++)try{const l=O(n[a],r,e);s[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[O(i[1],r,e),...s]}function fi(i,t,e){let n;try{n=O(i[1],w,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const r=i[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const s=new Array(r.length);for(let o=0;o<s.length;o++){let a;try{a=O(r[o],U,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof C))throw new Error(`the palette color at index ${o} must be a literal value`);s[o]=a}return[n,...s]}function m(...i){return function(t,e,n){const r=t[0];let s;for(let o=0;o<i.length;o++){const a=i[o](t,e,n);if(o==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");s=a}}return new ni(e,r,...s)}}function gi(i,t,e){const n=i[0],r=ii[n];if(!r)throw new Error(`unknown operator: ${n}`);return r(i,t,e)}function di(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return di(i.getGeometries()[0]);default:return""}}function Yr(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Dr(i,t,e){const n=O(i,t,e);return z(n)}function z(i,t){if(i instanceof C){if(i.type===U&&typeof i.value=="string"){const n=ye(i.value);return function(){return n}}return function(){return i.value}}const e=i.operator;switch(e){case h.Number:case h.String:case h.Coalesce:return mi(i);case h.Get:case h.Var:case h.Has:return pi(i);case h.Id:return n=>n.featureId;case h.GeometryType:return n=>n.geometryType;case h.Concat:{const n=i.args.map(r=>z(r));return r=>"".concat(...n.map(s=>s(r).toString()))}case h.Resolution:return n=>n.resolution;case h.Any:case h.All:case h.Between:case h.In:case h.Not:return yi(i);case h.Equal:case h.NotEqual:case h.LessThan:case h.LessThanOrEqualTo:case h.GreaterThan:case h.GreaterThanOrEqualTo:return _i(i);case h.Multiply:case h.Divide:case h.Add:case h.Subtract:case h.Clamp:case h.Mod:case h.Pow:case h.Abs:case h.Floor:case h.Ceil:case h.Round:case h.Sin:case h.Cos:case h.Atan:case h.Sqrt:return Ei(i);case h.Case:return xi(i);case h.Match:return Ti(i);case h.Interpolate:return wi(i);case h.ToString:return Ii(i);default:throw new Error(`Unsupported operator ${e}`)}}function mi(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=z(i.args[s]);switch(e){case h.Coalesce:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case h.Number:case h.String:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function pi(i,t){const n=i.args[0].value;switch(i.operator){case h.Get:return r=>{const s=i.args;let o=r.properties[n];for(let a=1,l=s.length;a<l;++a){const u=s[a].value;o=o[u]}return o};case h.Var:return r=>r.variables[n];case h.Has:return r=>{const s=i.args;if(!(n in r.properties))return!1;let o=r.properties[n];for(let a=1,l=s.length;a<l;++a){const u=s[a].value;if(!o||!Object.hasOwn(o,u))return!1;o=o[u]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function _i(i,t){const e=i.operator,n=z(i.args[0]),r=z(i.args[1]);switch(e){case h.Equal:return s=>n(s)===r(s);case h.NotEqual:return s=>n(s)!==r(s);case h.LessThan:return s=>n(s)<r(s);case h.LessThanOrEqualTo:return s=>n(s)<=r(s);case h.GreaterThan:return s=>n(s)>r(s);case h.GreaterThanOrEqualTo:return s=>n(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function yi(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=z(i.args[s]);switch(e){case h.Any:return s=>{for(let o=0;o<n;++o)if(r[o](s))return!0;return!1};case h.All:return s=>{for(let o=0;o<n;++o)if(!r[o](s))return!1;return!0};case h.Between:return s=>{const o=r[0](s),a=r[1](s),l=r[2](s);return o>=a&&o<=l};case h.In:return s=>{const o=r[0](s);for(let a=1;a<n;++a)if(o===r[a](s))return!0;return!1};case h.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function Ei(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=z(i.args[s]);switch(e){case h.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=r[a](s);return o};case h.Divide:return s=>r[0](s)/r[1](s);case h.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=r[a](s);return o};case h.Subtract:return s=>r[0](s)-r[1](s);case h.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case h.Mod:return s=>r[0](s)%r[1](s);case h.Pow:return s=>Math.pow(r[0](s),r[1](s));case h.Abs:return s=>Math.abs(r[0](s));case h.Floor:return s=>Math.floor(r[0](s));case h.Ceil:return s=>Math.ceil(r[0](s));case h.Round:return s=>Math.round(r[0](s));case h.Sin:return s=>Math.sin(r[0](s));case h.Cos:return s=>Math.cos(r[0](s));case h.Atan:return n===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case h.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function xi(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=z(i.args[r]);return r=>{for(let s=0;s<e-1;s+=2)if(n[s](r))return n[s+1](r);return n[e-1](r)}}function Ti(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=z(i.args[r]);return r=>{const s=n[0](r);for(let o=1;o<e-1;o+=2)if(s===n[o](r))return n[o+1](r);return n[e-1](r)}}function wi(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=z(i.args[r]);return r=>{const s=n[0](r),o=n[1](r);let a,l;for(let c=2;c<e;c+=2){const u=n[c](r);let f=n[c+1](r);const R=Array.isArray(f);if(R&&(f=Hn(f)),u>=o)return c===2?f:R?Mi(s,o,a,l,u,f):Ot(s,o,a,l,u,f);a=u,l=f}return l}}function Ii(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=z(i.args[s]);switch(e){case h.ToString:return s=>{const o=r[0](s);return i.args[0].type===U?He(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Ot(i,t,e,n,r,s){const o=r-e;if(o===0)return n;const a=t-e,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(s-n)}function Mi(i,t,e,n,r,s){if(r-e===0)return n;const a=be(n),l=be(s);let c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);const u=[Ot(i,t,e,a[0],r,l[0]),Ot(i,t,e,a[1],r,l[1]),a[2]+Ot(i,t,e,0,r,c),Ot(i,t,e,n[3],r,s[3])];return Qn(u)}const At={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Nr extends Be{constructor(t,e,n,r){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof r=="function"?At.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(et.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==At.IDLE&&this.loader){this.state=At.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;gn(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||We&&n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=At.LOADED}).catch(n=>{this.state=At.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Ai(i,t,e){const n=i;let r=!0,s=!1,o=!1;const a=[Me(n,et.LOAD,function(){o=!0,s||t()})];return n.src&&pe?(s=!0,n.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(Me(n,et.ERROR,e)),function(){r=!1,a.forEach(tt)}}function Ri(i,t){return new Promise((e,n)=>{function r(){o(),e(i)}function s(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s)})}function Li(i,t){return t&&(i.src=t),i.src&&pe?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):Ri(i)}function Gr(i,t){return t&&(i.src=t),i.src&&pe&&We?i.decode().then(()=>createImageBitmap(i)).catch(e=>{if(i.complete&&i.width)return i;throw e}):Li(i)}class Qe extends Be{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(et.CHANGE)}release(){this.setState(x.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==x.EMPTY){if(this.state!==x.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){bt()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const r=e-n+1e3/60;return r>=this.transition_?1:bn(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class Si extends Qe{constructor(t,e,n,r,s,o){super(t,e,o),this.crossOrigin_=r==null?void 0:r.crossOrigin,this.referrerPolicy_=r==null?void 0:r.referrerPolicy,this.src_=n,this.key=n,this.image_,jt?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==void 0&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=x.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}getReferrerPolicy(){return this.referrerPolicy_}handleImageError_(){this.state=x.ERROR,this.unlistenImage_(),this.image_=Ci(),this.changed()}handleImageLoad_(){if(jt)this.state=x.LOADED;else{const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=x.LOADED:this.state=x.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==x.ERROR&&(this.state=x.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==void 0&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.state==x.IDLE&&(this.state=x.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ai(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function Ci(){const i=_t(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}let he;const pt=[];function Ye(i,t,e,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,r)),i.restore()}function ce(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function vi(){if(he===void 0){const i=_t(6,6,pt);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Ye(i,4,5,4,0),Ye(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;he=ce(t,0)||ce(t,4)||ce(t,8),_e(i),pt.push(i.canvas)}return he}function De(i,t,e,n){const r=ze(e,t,i);let s=Ae(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||je(l,r)){const c=Ae(i,s,r)/s;isFinite(c)&&c>0&&(s/=c)}return s}function Oi(i,t,e,n){const r=Tn(e);let s=De(i,t,r,n);return(!isFinite(s)||s<=0)&&wn(e,function(o){return s=De(i,t,o,n),isFinite(s)&&s>0}),s}function bi(i,t,e,n,r,s,o,a,l,c,u,f,R,v){const g=_t(Math.round(e*i),Math.round(e*t),pt);if(f||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function _(d){return Math.round(d*e)/e}g.globalCompositeOperation="lighter";const I=Ue();l.forEach(function(d,D,j){En(I,d.extent)});let y;const T=e/n,A=(f?1:1+Math.pow(2,-24))/T;if(!R||l.length!==1||c!==0){if(y=_t(Math.round(P(I)*T),Math.round(gt(I)*T),pt),f||(y.imageSmoothingEnabled=!1),r&&v){const d=(r[0]-I[0])*T,D=-(r[3]-I[3])*T,j=P(r)*T,S=gt(r)*T;y.rect(d,D,j,S),y.clip()}l.forEach(function(d,D,j){if(d.image.width>0&&d.image.height>0){if(d.clipExtent){y.save();const X=(d.clipExtent[0]-I[0])*T,G=-(d.clipExtent[3]-I[3])*T,W=P(d.clipExtent)*T,st=gt(d.clipExtent)*T;y.rect(f?X:Math.round(X),f?G:Math.round(G),f?W:Math.round(X+W)-Math.round(X),f?st:Math.round(G+st)-Math.round(G)),y.clip()}const S=(d.extent[0]-I[0])*T,b=-(d.extent[3]-I[3])*T,N=P(d.extent)*T,Z=gt(d.extent)*T;y.drawImage(d.image,c,c,d.image.width-2*c,d.image.height-2*c,f?S:Math.round(S),f?b:Math.round(b),f?N:Math.round(S+N)-Math.round(S),f?Z:Math.round(b+Z)-Math.round(b)),d.clipExtent&&y.restore()}})}const E=me(o);return a.getTriangles().forEach(function(d,D,j){const S=d.source,b=d.target;let N=S[0][0],Z=S[0][1],X=S[1][0],G=S[1][1],W=S[2][0],st=S[2][1];const yt=_((b[0][0]-E[0])/s),Et=_(-(b[0][1]-E[1])/s),ot=_((b[1][0]-E[0])/s),at=_(-(b[1][1]-E[1])/s),Wt=_((b[2][0]-E[0])/s),kt=_(-(b[2][1]-E[1])/s),qt=N,Kt=Z;N=0,Z=0,X-=qt,G-=Kt,W-=qt,st-=Kt;const on=[[X,G,0,0,ot-yt],[W,st,0,0,Wt-yt],[0,0,X,G,at-Et],[0,0,W,st,kt-Et]],xt=xn(on);if(!xt)return;if(g.save(),g.beginPath(),vi()||!f){g.moveTo(ot,at);const $=4,wt=yt-ot,we=Et-at;for(let J=0;J<$;J++)g.lineTo(ot+_((J+1)*wt/$),at+_(J*we/($-1))),J!=$-1&&g.lineTo(ot+_((J+1)*wt/$),at+_((J+1)*we/($-1)));g.lineTo(Wt,kt)}else g.moveTo(ot,at),g.lineTo(yt,Et),g.lineTo(Wt,kt);g.clip(),g.transform(xt[0],xt[2],xt[1],xt[3],yt,Et),g.translate(I[0]-qt,I[3]-Kt);let Tt;if(y)Tt=y.canvas,g.scale(A,-A);else{const $=l[0],wt=$.extent;Tt=$.image,g.scale(P(wt)/Tt.width,-gt(wt)/Tt.height)}g.drawImage(Tt,0,0),g.restore()}),y&&(_e(y),pt.push(y.canvas)),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(d,D,j){const S=d.target,b=(S[0][0]-E[0])/s,N=-(S[0][1]-E[1])/s,Z=(S[1][0]-E[0])/s,X=-(S[1][1]-E[1])/s,G=(S[2][0]-E[0])/s,W=-(S[2][1]-E[1])/s;g.beginPath(),g.moveTo(Z,X),g.lineTo(b,N),g.lineTo(G,W),g.closePath(),g.stroke()}),g.restore()),g.canvas}const Xi=10,Ne=.25;class Pi{constructor(t,e,n,r,s,o,a){this.sourceProj_=t,this.targetProj_=e;let l={};const c=a?In(A=>dn(a,ze(A,this.targetProj_,this.sourceProj_))):Mn(this.targetProj_,this.sourceProj_);this.transformInv_=function(A){const E=A[0]+"/"+A[1];return l[E]||(l[E]=c(A)),l[E]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&P(r)>=P(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?P(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?P(this.targetProj_.getExtent()):null;const u=me(n),f=An(n),R=Rn(n),v=Ln(n),g=this.transformInv_(u),_=this.transformInv_(f),I=this.transformInv_(R),y=this.transformInv_(v),T=Xi+(o?Math.max(0,Math.ceil(Math.log2(fe(n)/(o*o*256*256)))):0);if(this.addQuad_(u,f,R,v,g,_,I,y,T),this.wrapsXInSource_){let A=1/0;this.triangles_.forEach(function(E,d,D){A=Math.min(A,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-A>this.sourceWorldWidth_/2){const d=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];d[0][0]-A>this.sourceWorldWidth_/2&&(d[0][0]-=this.sourceWorldWidth_),d[1][0]-A>this.sourceWorldWidth_/2&&(d[1][0]-=this.sourceWorldWidth_),d[2][0]-A>this.sourceWorldWidth_/2&&(d[2][0]-=this.sourceWorldWidth_);const D=Math.min(d[0][0],d[1][0],d[2][0]);Math.max(d[0][0],d[1][0],d[2][0])-D<this.sourceWorldWidth_/2&&(E.source=d)}})}l={}}addTriangle_(t,e,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,n]})}addQuad_(t,e,n,r,s,o,a,l,c){const u=Re([s,o,a,l]),f=this.sourceWorldWidth_?P(u)/this.sourceWorldWidth_:null,R=this.sourceWorldWidth_,v=this.sourceProj_.canWrapX()&&f>.5&&f<1;let g=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const I=Re([t,e,n,r]);g=P(I)/this.targetWorldWidth_>Ne||g}!v&&this.sourceProj_.isGlobal()&&f&&(g=f>Ne||g)}if(!g&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Sn(u,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)g=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(c>0){if(!g){const I=[(t[0]+n[0])/2,(t[1]+n[1])/2],y=this.transformInv_(I);let T;v?T=(Xt(s[0],R)+Xt(a[0],R))/2-Xt(y[0],R):T=(s[0]+a[0])/2-y[0];const A=(s[1]+a[1])/2-y[1];g=T*T+A*A>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const I=[(e[0]+n[0])/2,(e[1]+n[1])/2],y=this.transformInv_(I),T=[(r[0]+t[0])/2,(r[1]+t[1])/2],A=this.transformInv_(T);this.addQuad_(t,e,I,T,s,o,y,A,c-1),this.addQuad_(T,I,n,r,A,y,a,l,c-1)}else{const I=[(t[0]+e[0])/2,(t[1]+e[1])/2],y=this.transformInv_(I),T=[(n[0]+r[0])/2,(n[1]+r[1])/2],A=this.transformInv_(T);this.addQuad_(t,I,T,r,s,y,A,l,c-1),this.addQuad_(I,e,n,T,y,o,a,A,c-1)}return}}if(v){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,r,s,a,l),_&14||this.addTriangle_(t,n,e,s,a,o),_&&(_&13||this.addTriangle_(e,r,t,o,l,s),_&7||this.addTriangle_(e,r,n,o,l,a))}calculateSourceExtent(){const t=Ue();return this.triangles_.forEach(function(e,n,r){const s=e.source;Vt(t,s[0]),Vt(t,s[1]),Vt(t,s[2])}),t}getTriangles(){return this.triangles_}}const Fi=.5;class Yi extends Qe{constructor(t,e,n,r,s,o,a,l,c,u,f,R){super(s,x.IDLE,R),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const v=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const I=g?zt(v,g):v;if(fe(I)===0){this.state=x.EMPTY;return}const y=t.getExtent();y&&(_?_=zt(_,y):_=y);const T=r.getResolution(this.wrappedTileCoord_[0]),A=Oi(t,n,I,T);if(!isFinite(A)||A<=0){this.state=x.EMPTY;return}const E=u!==void 0?u:Fi;if(this.triangulation_=new Pi(t,n,I,_,A*E,T),this.triangulation_.getTriangles().length===0){this.state=x.EMPTY;return}this.sourceZ_=e.getZForResolution(A);let d=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(d[1]=B(d[1],_[1],_[3]),d[3]=B(d[3],_[1],_[3])):d=zt(d,_)),!fe(d))this.state=x.EMPTY;else{let D=0,j=0;t.canWrapX()&&(D=P(y),j=Math.floor((d[0]-y[0])/D)),Cn(d.slice(),t,!0).forEach(b=>{const N=e.getTileRangeForExtentAndZ(b,this.sourceZ_);for(let Z=N.minX;Z<=N.maxX;Z++)for(let X=N.minY;X<=N.maxY;X++){const G=j*D;this.sourceTiles_.push({getTile:()=>c(this.sourceZ_,Z,X,a),offset:G})}++j}),this.sourceTiles_.length===0&&(this.state=x.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var r;const n=e.tile;if(n&&n.getState()==x.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const o=(r=this.clipExtent_)==null?void 0:r.slice();o&&(o[0]+=e.offset,o[2]+=e.offset),t.push({extent:s,clipExtent:o,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=x.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=bi(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=x.LOADED}this.changed()}load(){for(const t of this.sourceTiles_)t.tile=t.getTile();if(this.state==x.IDLE){this.state=x.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n==x.IDLE||n==x.LOADING){t++;const r=V(e,et.CHANGE,s=>{const o=e.getState();(o==x.LOADED||o==x.ERROR||o==x.EMPTY)&&(tt(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},n,r){e.getState()==x.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(tt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(_e(this.canvas_.getContext("2d")),pt.push(this.canvas_),this.canvas_=null),this.sourceTiles_.length=0,super.release()}}class Je{constructor(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ut(i,t,e,n,r){return r!==void 0?(r.minX=i,r.maxX=t,r.minY=e,r.maxY=n,r):new Je(i,t,e,n)}function Ge(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function tn(i,t,e){return i+"/"+t+"/"+e}function Zr(i){return tn(i[0],i[1],i[2])}function Di(i,t,e,n,r){return`${nt(i)},${t},${tn(e,n,r)}`}function Ni(i){return en(i[0],i[1],i[2])}function en(i,t,e){return(t<<i)+e}function Gi(i,t){const e=i[0],n=i[1],r=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,r):!0}const ft=[0,0,0],K=5;class nn{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,H(mn(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,H(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=me(n)),H(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,H(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:ke,H(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new Je(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,r){let s,o,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=ut(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,c,n),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getOrigins(){return this.origins_}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return ut(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return ut(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),c=Math.floor(s*l),u=Math.floor(o*l);if(e<r)return ut(c,c,u,u,n);const f=Math.floor(l*(s+1))-1,R=Math.floor(l*(o+1))-1;return ut(c,f,u,R,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ft);const r=ft[1],s=ft[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ft);const o=ft[1],a=ft[2];return ut(r,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=Q(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=Q(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*r,a=n[1]-(t[2]+1)*s[1]*r,l=o+s[0]*r,c=a+s[1]*r;return $e(o,a,l,c,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),c=Q(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/n/c[0],f=a*(l[1]-e)/n/c[1];return r?(u=Ft(u,K)-1,f=Ft(f,K)-1):(u=Yt(u,K),f=Yt(f,K)),Ge(o,u,f,s)}getTileCoordForXYAndZ_(t,e,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=Q(this.getTileSize(n),this.tmpSize_);let c=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return r?(c=Ft(c,K)-1,u=Ft(u,K)-1):(c=Yt(c,K),u=Yt(u,K)),Ge(n,c,u,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=pn(this.resolutions_,t,e||0);return B(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return _n(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n}}function rn(i){let t=i.getDefaultTileGrid();return t||(t=ji(i),i.setDefaultTileGrid(t)),t}function Zi(i,t,e){const n=t[0],r=i.getTileCoordCenter(t),s=xe(e);if(!je(s,r)){const o=P(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return t}function Bi(i,t,e,n){n=n!==void 0?n:"top-left";const r=sn(i,t,e);return new nn({extent:i,origin:On(i,n),resolutions:r,tileSize:e})}function zi(i){const t=i||{},e=t.extent||$t("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:sn(e,t.maxZoom,t.tileSize,t.maxResolution)};return new nn(n)}function sn(i,t,e,n){t=t!==void 0?t:Fn,e=Q(e!==void 0?e:ke);const r=gt(i),s=P(i);n=n>0?n:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function ji(i,t,e,n){const r=xe(i);return Bi(r,t,e,n)}function xe(i){i=$t(i);let t=i.getExtent();if(!t){const e=180*vn.degrees/i.getMetersPerUnit();t=$e(-e,-e,e,e)}return t}class Ui extends Ut{constructor(t){super(),this.projection=$t(t.projection),this.attributions_=Ze(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,r){e.viewResolver=n,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ze(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ze(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}class $i extends Ui{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Q(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||nt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,r,s,o){return bt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:rn(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=Q(r.getTileSize(t),this.tmpSize);return s==1?o:Jn(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const n=e!==void 0?e:this.getProjection(),r=e!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=Zi(r,t,n)),Gi(t,r)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Wi extends de{constructor(t,e){super(t),this.tile=e}}const ue={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function Br(i,t){const e=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&e.push(r+"="+encodeURIComponent(t[r]))});const n=e.join("&");return i=i.replace(/[?&]$/,""),i+=i.includes("?")?"&":"?",i+n}const ki=/\{z\}/g,qi=/\{x\}/g,Ki=/\{y\}/g,Vi=/\{-y\}/g;function Hi(i,t,e,n,r){return i.replace(ki,t.toString()).replace(qi,e.toString()).replace(Ki,n.toString()).replace(Vi,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-n).toString()})}function zr(i,t,e,n){const r=en(t,e,n),s=Xt(r,i.length);return i[s]}function Qi(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=n;s<=r;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=n;r++)t.push(i.replace(e[0],r.toString()));return t}return t.push(i),t}function Ji(i,t){return function(e,n,r){if(!e)return;let s;const o=e[0];if(t){const a=t.getFullTileRange(o);a&&(s=a.getHeight()-1)}return Hi(i,o,e[1],e[2],s)}}function tr(i,t){const e=i.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Ji(i[r],t);return er(n)}function er(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const r=Ni(t),s=Xt(r,i.length);return i[s](t,e,n)}}function jr(i,t,e){}class Te extends $i{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Te.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=nt(e),r=e.getState();let s;r==x.LOADING?(this.tileLoadingKeys_[n]=!0,s=ue.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==x.ERROR?ue.TILELOADERROR:r==x.LOADED?ue.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Wi(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Qi(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(tr(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}}class nr extends Te{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ir,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.referrerPolicy=t.referrerPolicy,this.tileClass=t.tileClass!==void 0?t.tileClass:Si,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Ht(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ht(e,t)))return this.tileGrid;const n=nt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=rn(t)),this.tileGridForProjection[n]}createTile_(t,e,n,r,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),c=l?this.tileUrlFunction(l,r,s):void 0,u=new this.tileClass(a,c!==void 0?x.IDLE:x.EMPTY,c!==void 0?c:"",{crossOrigin:this.crossOrigin,referrerPolicy:this.referrerPolicy},this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(et.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,n,r,s,o){const a=this.getProjection();if(!a||!s||Ht(a,s))return this.getTileInternal(t,e,n,r,a||s);const l=[t,e,n],c=this.getKey(),u=this.getTileGridForProjection(a),f=this.getTileGridForProjection(s),R=this.getTileCoordForTileUrlFunction(l,s),v=new Yi(a,u,s,f,l,R,this.getTilePixelRatio(r),this.getGutter(),(g,_,I,y)=>this.getTileInternal(g,_,I,y,a,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return v.key=c,v}getTileInternal(t,e,n,r,s,o){const a=this.getKey(),l=Di(this,a,t,e,n);if(o&&o.containsKey(l))return o.get(l);const c=this.createTile_(t,e,n,r,s,a);return o==null||o.set(l,c),c}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const n=$t(t);if(n){const r=nt(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}}function ir(i,t){if(jt){const e=i.getCrossOrigin();let n="same-origin",r="same-origin";e==="anonymous"||e===""?(n="cors",r="omit"):e==="use-credentials"&&(n="cors",r="include");const s={mode:n,credentials:r,referrerPolicy:i.getReferrerPolicy()};fetch(t,s).then(o=>{if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.blob()}).then(o=>createImageBitmap(o)).then(o=>{var c;const a=i.getImage();a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0),(c=o.close)==null||c.call(o),a.dispatchEvent(new Event("load"))}).catch(()=>{i.getImage().dispatchEvent(new Event("error"))});return}i.getImage().src=t}class Ur extends nr{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:zi({extent:xe(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,referrerPolicy:t.referrerPolicy,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}export{O as $,er as A,Xr as B,Se as C,Fn as D,Fi as E,mr as F,Ar as G,Pn as H,Nr as I,wr as J,Ir as K,qe as L,gr as M,$i as N,Er as O,lr as P,Si as Q,vr as R,Ui as S,nn as T,Te as U,Yi as V,L as W,Ur as X,Je as Y,Ge as Z,Zr as _,mt as a,ni as a0,w as a1,F as a2,Y as a3,U as a4,ge as a5,St as a6,Ct as a7,h as a8,q as a9,Hi as aA,Jn as aB,tr as aC,jr as aD,tn as aE,jt as aa,Oi as ab,Di as ac,Wi as ad,ue as ae,fr as af,ke as ag,dr as ah,hr as ai,cr as aj,Dn as ak,Tr as al,Li as am,br as an,He as ao,xr as ap,ve as aq,Un as ar,di as as,Lr as at,Rr as au,Sr as av,ur as aw,lt as ax,Pr as ay,zr as az,Cr as b,pr as c,yr as d,_r as e,zi as f,Dr as g,Yr as h,De as i,Pi as j,At as k,bi as l,Br as m,Fr as n,Gr as o,nr as p,Ni as q,Mr as r,Qe as s,_t as t,_e as u,x as v,xe as w,rn as x,Q as y,Qi as z};
