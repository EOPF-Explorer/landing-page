const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.Dbt7JrQA.js","assets/chunks/addCommonStyleSheet.d30cVcBS.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.BWoGWrHB.js","assets/chunks/repeat.D4A67Iq_.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.G8eYckay.js","assets/chunks/unsafe-html.CcMVKbGs.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.BSpBAx16.js"])))=>i.map(i=>d[i]);
import{ao as g,a2 as $,p as E,c as P,o as k,G as x,j as m,w as V,t as S,k as u,v as f,q as B,x as I,a5 as O}from"./framework.DR2qTddi.js";import{_ as R,a as v,g as M,h as K}from"./eo-dash.33q0hVoE.js";import{b as C,i as b,c as o,s as N,e as U}from"./mdi.C9UENT8G.js";import{i as H}from"./easing-CH0-9wR8.CTB3jml5.js";import j from"./EodashLayoutSwitcher-DsXC5F8p.BE04Wvfn.js";import"./item.BvIq34WH.js";import"./commonjsHelpers.BosuxZz1.js";import"./http.CF0OhjbI.js";import"./VTooltip-B2rGoyWm.BStuVFjX.js";import"./forwardRefs-CJuN_6IP.B8YaOvnr.js";import"./transition-C56wWGQC.COGra3sY.js";const D=s=>r=>{let t="";return s.forEach(a=>{const i=a.property;if(!a.icon&&!a.unitLabel||!r.properties[i])return;a.icon&&(t+=a.icon);let e=r.properties[i];typeof e=="number"&&!Number.isInteger(e)&&(e=e.toFixed(1)),t+=e,a.unitLabel&&(t+=a.unitLabel)}),t},G=s=>{var i;const t=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((i=v().stac)==null?void 0:i.map(e=>e.id))||[],...b.value&&{state:{[b.value]:!0}}}],a=s.map(e=>{const l=`properties.${e.property}`;return e.type==="range"?{key:l,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:l,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:l,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...t,...a]},J=(s,r)=>{const t=[];return r.forEach(a=>{const i=`properties.${a.property}`,e=s[i];if(e){if(a.type==="range"&&e.state){const{min:l,max:n}=e.state;l!==void 0&&l>(a.min||0)&&t.push(`${a.property}>=${l}`),n!==void 0&&n<(a.max||100)&&t.push(`${a.property}<=${n}`)}else if(a.type==="multiselect"&&e.stringifiedState){const l=e.stringifiedState;l.length>0&&t.push(`${a.property} IN (${l})`)}else if(a.type==="select"&&e.stringifiedState){const l=e.stringifiedState;l&&t.push(`${a.property}='${l}'`)}}}),t.join(" AND ")},q=(s,r,t)=>{var l,n;const a=v(),i=new URLSearchParams;(l=s.collection)!=null&&l.stringifiedState&&i.append("collections",s.collection.stringifiedState),(n=o.value)!=null&&n.lonLatExtent&&t&&i.append("bbox",N([...o.value.lonLatExtent]).join(","));const e=J(s,r);return e&&i.append("filter",e),i.append("limit","100"),`${a.stacEndpoint}/search?${i.toString()}`},z=(s,r,t)=>({url:q(s,r,t),key:"features"});function y(s){var i,e;let r=(e=(i=o.value)==null?void 0:i.layers)==null?void 0:e.find(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="AnalysisGroup"});if(!o.value||!s)return;r||(r={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},o.value.layers=[r,...o.value.layers.reverse()]);const t={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:s})),format:"GeoJSON"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-items",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]};if(r.layers.some(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="stac-items"})){o.value.addOrUpdateLayer(t);return}else r.layers.unshift(t),o.value.layers=[...o.value.layers].reverse()}const Y=(s,r)=>{if(!r)return;let t;const a=()=>{clearTimeout(t),t=setTimeout(()=>{var i;(i=s.value)==null||i.search()},800)};f(()=>{var i;(i=o.value)==null||i.map.on("moveend",a)}),I(()=>{var i;(i=o.value)==null||i.map.un("moveend",a)})},Z=s=>{const r=()=>K(()=>{y(s.value)});f(()=>{if(!o.value){B(o,()=>{y(s.value),r()},{once:!0,immediate:!1});return}y(s.value),r()})};function Q(s){const r=t=>{s.value.selectedResult=s.value.results.find(a=>{var i,e;return a.id===((e=(i=t.detail)==null?void 0:i.feature)==null?void 0:e.getId())})};f(()=>{var t;(t=o.value)==null||t.addEventListener("select",r)}),I(()=>{var t;(t=o.value)==null||t.removeEventListener("select",r)})}const W=(s,r)=>{r.value=s.detail.results,y(r.value)},X=s=>async r=>{var a,i,e;const t=r.detail;t&&(((a=s.selectedStac)==null?void 0:a.id)===t.collection?s.selectedItem=t:await s.loadSelectedSTAC(t.collection,!1,t),(e=(i=o.value)==null?void 0:i.selectInteractions["stac-items"])==null||e.highlightById([t.id],{padding:[100,100,100,100],duration:1200,easing:H}))},F=s=>{var r,t;(t=(r=o.value)==null?void 0:r.selectInteractions["stac-items"])==null||t.highlightById([s.detail.id])},w=()=>{var s,r;(r=(s=o.value)==null?void 0:s.selectInteractions["stac-items"])==null||r.highlightById([])},ee="eox-itemfilter[data-v-516b7de8]{flex-basis:20%;height:100%;overflow:hidden!important;padding:1rem;--eox-itemfilter-results-color: var(--v-theme-surface) !important}.title[data-v-516b7de8]{padding:1em;margin:.2em}",te=[".subTitleProperty",".filterProperties",".items"],se={slot:"filterstitle",style:{margin:"14px 8px"}},re={slot:"resultstitle",style:{margin:"14px 8px"}},ae={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:C},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]}},async setup(s){let r,t;customElements.get("eox-itemfilter")||([r,t]=g(()=>O(()=>import("./main.Dbt7JrQA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await r,t());const a=s,i=v(),e=$("itemfilter"),l=E([]);[r,t]=g(()=>U.get(i.stacEndpoint+"/search?limit=100").then(p=>l.value=p.data.features)),await r,t();const n=l.value,A=G(a.filters),_=D(a.filters),L=(p,c)=>z(c,a.filters,a.bboxFilter),T=p=>{W(p,l)},h=X(i);return Z(l),Y(e,a.bboxFilter),Q(e),(p,c)=>(k(),P("span",null,[x(M,{class:"title align-center justify-space-between"},{default:V(()=>[c[3]||(c[3]=m("h4",null,"Catalog Items",-1)),x(j,{target:s.layoutTarget,icon:s.layoutIcon},null,8,["target","icon"])]),_:1}),m("eox-itemfilter",{ref:"itemfilter",titleProperty:"id",imageProperty:"assets.thumbnail.href",".subTitleProperty":u(_),".filterProperties":u(A),".items":u(n),onSelect:c[0]||(c[0]=(...d)=>u(h)&&u(h)(...d)),onFilter:T,"onMouseenter:result":c[1]||(c[1]=(...d)=>u(F)&&u(F)(...d)),"onMouseleave:result":c[2]||(c[2]=(...d)=>u(w)&&u(w)(...d)),externalFilter:L},[m("h4",se,S(s.filtersTitle),1),m("h4",re,S(s.resultsTitle),1)],40,te)]))}},ve=R(ae,[["styles",[ee]],["__scopeId","data-v-516b7de8"]]);export{ve as default};
