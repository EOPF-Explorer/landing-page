import"./main.DpoXsJwq.js";import"./index.DEihagC9.js";import{f as O,c as be,g as me,d as Q,i as P,h as T,l as L,j as ge,s as xe}from"./mdi.nmTe2DWC.js";import{_ as he,u as Ce,s as Y,a as q,e as $,h as we,m as Se,l as Pe,i as Te,f as Ne,j as E,k as ee,E as oe}from"./eo-dash.C36II-_A.js";import{i as Oe}from"./easing-CH0-9wR8.CTB3jml5.js";import Le from"./EodashMapBtns-ckuTjH0a.D9SBhPr5.js";import{h as N,a2 as te,p as k,ap as ae,v as pe,c as H,o as W,j,e as re,k as u,N as R,G as Me,x as ce,q as _e}from"./framework.DR2qTddi.js";import"./addCommonStyleSheet.d30cVcBS.js";import"./OSM.CWnCwDu9.js";import"./GeoJSON.DY6lBxBJ.js";import"./math.XsT84g0F.js";import"./Group.CAdYY5EQ.js";import"./index.Rf_EwgyP.js";import"./getElement.CdRlZPdn.js";import"./WKT.DnpX7WKh.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.BvIq34WH.js";import"./http.CF0OhjbI.js";import"./ExportState-D6bUwLDq.DzfLCSOf.js";import"./PopUp-CNGyLH7f.c7lej5rw.js";import"./forwardRefs-DXCV8nvN.DJCzp_yV.js";import"./transition-DIXMC97r.BmwFJ-zj.js";import"./VImg-D9JM3UXq.Bf4AnSW_.js";import"./EodashItemFilter-rxO2LmKM.BkgXD9Sq.js";import"./main.jcjiKnEN.js";import"./unsafe-html.Byr6H8C5.js";import"./directive.CvdRHFdJ.js";import"./when.BR7zwNJC.js";import"./dayjs.min.Ba62AOpW.js";import"./index.BUIxO2d3.js";import"./static.BWoGWrHB.js";import"./repeat.D4A67Iq_.js";import"./directive-helpers.G8eYckay.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./orient2d.DArCjZZA.js";import"./index.BSpBAx16.js";import"./handling-C1s2iuvC.CgW0zpSB.js";import"./async-q13skYBW.13QgCX2_.js";import"./utils.DZj92Qv1.js";const ie=async(e,o,p)=>{L.debug("Creating layers config",e,o,p);const a=[],r={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const c of o){let t;if(p){const i=typeof p=="string"?new Date(p):p;t=await c.createLayersJson(i)}else t=await c.createLayersJson(void 0);t.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),r.layers.push(...t)}a.push(r);const d=await oe.getIndicatorLayers(e),f=oe.getObservationPointsLayer(o);f&&r.layers.unshift(f);const s={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=d.filter(c=>c.properties.group==="baselayer");if(b.length){let c=0,t=0;for(let i=0;i<b.length;i++){const y=b[i];"visible"in y.properties||(y.properties.visible=!1),y.properties.visible&&(c++,t=i)}c===0&&(b[0].properties.visible=!0),c>0&&b.forEach((i,y)=>{y!==t?i.properties.visible=!1:i.properties.visible=!0}),s.layers.push(...b),s.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else s.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});s.layers.length&&a.push(s);const h={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=d.filter(c=>c.properties.group==="overlay");return m.length&&(h.layers.push(...m),a.unshift(h)),a};let U=null;const ke=(e,o)=>{const p=a=>{var s;const r=a.map,d=(s=e.value)==null?void 0:s.lonLatCenter,f=r==null?void 0:r.getView().getZoom();d&&!Number.isNaN(d[0])&&!Number.isNaN(d[1])&&!Number.isNaN(f)&&(o.value=[d[0],d[1],f])};pe(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.on("moveend",p)}),ce(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.un("moveend",p)})},se=(e,o,p,a,r,d,f,s)=>{L.debug("InitMap",e.value,o.value,p.values,a.value);const h=_e(s?[o,a,s]:[o,a],async(m,c)=>{var C,V,F,G,J,B,z,n,l,x,v,_,w,Z,X,K;const[t,i,y]=s?m:[m[0],m[1],null],[M,D,g]=s?c:[c[0],c[1],null];if(t){L.debug("Selected Indicator watch triggered",t,i),((C=e==null?void 0:e.value)==null?void 0:C.id)==="main"&&U!==null&&((V=e==null?void 0:e.value)==null||V.map.setView(U),U=null);let S=[];const ue=(t==null?void 0:t.id)===(M==null?void 0:M.id)&&(i!==D||s&&(y==null?void 0:y.id)!==(g==null?void 0:g.id)),{selectedCompareStac:de}=Y(q());if(((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"?await ge(t):de.value!==null&&(U=((G=e==null?void 0:e.value)==null?void 0:G.map.getView())??null,e.value.sync=d.value),ue){S=await ie(t,p,s?y:i),L.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(S))),r.value=S,E(((J=e.value)==null?void 0:J.id)==="compare"?"compareTime:updated":"time:updated",e.value,S);return}S=await ie(t,p,s?y:i);let I=null;const A=(z=(B=t==null?void 0:t.extent)==null?void 0:B.temporal)==null?void 0:z.interval;if(A&&A.length>0&&A[0].length>1&&(I=new Date(A[0][1]),L.debug("Indicator load: found stac extent, setting time to latest value",I)),I!==null&&I.toISOString()!==a.value&&!ee.value&&(a.value=I.toISOString()),f&&((n=e==null?void 0:e.value)==null?void 0:n.id)==="main"&&(l=t.extent)!=null&&l.spatial.bbox&&!(ee.value&&((x=O.value)!=null&&x[0])&&((v=O.value)!=null&&v[1]))){const fe=(_=t.extent)==null?void 0:_.spatial.bbox[0],ye=xe(fe),ve=(X=e.value)==null?void 0:X.transformExtent(ye,"EPSG:4326",(Z=(w=e.value)==null?void 0:w.map)==null?void 0:Z.getView().getProjection());e.value.zoomExtent=ve}L.debug("Assigned layers",JSON.parse(JSON.stringify(S))),r.value=S,await E(((K=e.value)==null?void 0:K.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});ce(()=>{h()})},ne=(e,o)=>{we(async(p,a)=>{if(p.includes("compare"))return;const r=[];for(const d of e)r.push(...await d.getToolTipProperties());o.value=r,L.debug("Updated tooltip properties",o.value)})},je="#cursor-coordinates[data-v-a254cfa1]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-a254cfa1]{display:none}}#scale-line[data-v-a254cfa1]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-a254cfa1]{bottom:102px}}[data-v-a254cfa1] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-a254cfa1] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-a254cfa1]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-a254cfa1]>*{pointer-events:auto}",Be=[".enabled"],ze=[".center",".zoom",".layers",".controls"],Ie=[".propertyTransform"],Ve=[".layers"],Fe=[".propertyTransform"],Ge={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Je={key:1,id:"scale-line",ref:"scale-line"};var le;const Ze={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=O.value)==null?void 0:e[0])??15,((o=O.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((le=O.value)==null?void 0:le[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var z;const o=e,{width:p}=Ce(),a=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const l=n.split("/"),x=p.value;return x<960?parseInt(l[0])||1:x<1920?parseInt(l[1]||l[0])||1:parseInt(l[2]||l[1]||l[0])||1}return 1},r=N(()=>a(o.btnsPosition.x)),d=N(()=>a(o.btnsPosition.y)),f=N(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),s=te("scale-line"),b=te("cursor-coords"),h=k([]),m=k([]),c=N(()=>{const n={Attribution:{collapsible:!0}};return o.enableScaleLine&&s.value&&(n.ScaleLine={target:s.value}),o.enableCursorCoordinates&&b.value&&(n.MousePosition={projection:"EPSG:4326",coordinateFormat:l=>`${l[1].toFixed(3)} °N, ${l[0].toFixed(3)} °E`,target:b.value}),n}),t=ae(o.center),i=ae(((z=O.value)==null?void 0:z[2])??o.zoom),y=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),M=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),D={duration:1200,easing:Oe},g=k(null),C=k(null),{selectedCompareStac:V}=Y(q()),F=N(()=>o.enableCompare&&V.value?"":"first");ke(g,O),pe(()=>{const{selectedCompareStac:n,selectedStac:l,selectedItem:x}=Y(q());be.value=g.value,o.enableCompare&&(me.value=C.value),o.enableCompare&&(se(C,n,Ne,Q,M,g,!1),ne($,m)),se(g,l,$,Q,y,C,o.zoomToExtent,x)}),ne($,h);const G=N(()=>({visibility:h.value.length?"visible":"hidden"})),J=N(()=>({visibility:m.value.length?"visible":"hidden"})),B=n=>{const l=n==="main"?h:m,x=n=="main"?Pe:Te;return v=>{const _=JSON.parse(Se.render(JSON.stringify(l.value),{...x.value??{}})),w=_==null?void 0:_.find(Z=>Z.id===v.key);if(w)return typeof v.value=="object"&&(v.value=JSON.stringify(v.value)),isNaN(Number(v.value))||(v.value=Number(v.value).toFixed(4).toString()),{key:w.title||w.id,value:v.value+" "+(w.appendix||"")}}};return(n,l)=>(W(),H("span",null,[j("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":F.value},[j("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":D,".center":u(t),".zoom":u(i),".layers":y.value,".controls":c.value},[j("eox-map-tooltip",{style:R(G.value),".propertyTransform":B("main")},null,44,Ie)],40,ze),j("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:C,".layers":M.value},[j("eox-map-tooltip",{style:R(J.value),".propertyTransform":B("compare")},null,44,Fe)],40,Ve)],40,Be),e.enableCursorCoordinates?(W(),H("div",Ge,null,512)):re("v-if",!0),e.enableScaleLine?(W(),H("span",Je,null,512)):re("v-if",!0),j("div",{class:"map-buttons-container",style:R(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[Me(Le,{style:R({gridColumn:u(P)||u(T)?r.value:"12",gridRow:d.value}),exportMap:u(P)||u(T)?f.value.exportMap:!1,changeProjection:u(P)||u(T)?f.value.changeProjection:!1,compareIndicators:u(P)||u(T)?f.value.compareIndicators:!1,backToPOIs:u(P)||u(T)?f.value.backToPOIs:!1,enableSearch:u(P)||u(T)?f.value.enableSearch:!1,enableZoom:u(P)||u(T)?f.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},Oo=he(Ze,[["styles",[je]],["__scopeId","data-v-a254cfa1"]]);export{Oo as default};
