import{_ as F,a as m,g as $,h as w}from"./eo-dash.C36II-_A.js";import{b as I,i as y,c as n,s as k,e as T}from"./mdi.nmTe2DWC.js";import{i as A}from"./easing-CH0-9wR8.CTB3jml5.js";import E from"./EodashLayoutSwitcher-C-guT6Uj.BVz1mXvz.js";import{a2 as V,p as K,ao as L,c as B,o as O,G as h,j as d,w as P,t as f,k as g,v,q as U,x as G}from"./framework.DR2qTddi.js";import"./item.BvIq34WH.js";import"./commonjsHelpers.BosuxZz1.js";import"./http.CF0OhjbI.js";import"./VTooltip-MgW5MJBo.mkMP-1Ue.js";import"./forwardRefs-DXCV8nvN.DJCzp_yV.js";import"./transition-DIXMC97r.BmwFJ-zj.js";const N=t=>{var i;const r=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((i=m().stac)==null?void 0:i.map(e=>e.id))||[],...y.value&&{state:{[y.value]:!0}}}],o=t.map(e=>{const s=`properties.${e.property}`;return e.type==="range"?{key:s,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:s,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:s,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...r,...o]},j=(t,a)=>{const r=[];return a.forEach(o=>{const i=`properties.${o.property}`,e=t[i];if(e){if(o.type==="range"&&e.state){const{min:s,max:l}=e.state;s!==void 0&&s>(o.min||0)&&r.push(`${o.property}>=${s}`),l!==void 0&&l<(o.max||100)&&r.push(`${o.property}<=${l}`)}else if(o.type==="multiselect"&&e.stringifiedState){const s=e.stringifiedState;s.length>0&&r.push(`${o.property} IN (${s})`)}else if(o.type==="select"&&e.stringifiedState){const s=e.stringifiedState;s&&r.push(`${o.property}='${s}'`)}}}),r.join(" AND ")},R=(t,a,r)=>{var s,l;const o=m(),i=new URLSearchParams;(s=t.collection)!=null&&s.stringifiedState&&i.append("collections",t.collection.stringifiedState),(l=n.value)!=null&&l.lonLatExtent&&r&&i.append("bbox",k([...n.value.lonLatExtent]).join(","));const e=j(t,a);return e&&i.append("filter",e),i.append("limit","100"),`${o.stacEndpoint}/search?${i.toString()}`},D=(t,a,r)=>({url:R(t,a,r),key:"features"});function u(t){var i,e;let a=(e=(i=n.value)==null?void 0:i.layers)==null?void 0:e.find(s=>{var l;return((l=s.properties)==null?void 0:l.id)==="AnalysisGroup"});if(!n.value||!t)return;a||(a={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},n.value.layers=[a,...n.value.layers.reverse()]);const r={type:"Group",properties:{id:"stac-items",title:"STAC Items"},layers:t==null?void 0:t.map(s=>({type:"Vector",properties:{id:"item-"+s.id,title:s.id},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify(s)),format:"GeoJSON"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:s.id,condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]}))};if(a.layers.some(s=>{var l;return((l=s.properties)==null?void 0:l.id)==="stac-items"})){n.value.addOrUpdateLayer(r);return}else a.layers.unshift(r),n.value.layers=[...n.value.layers].reverse()}const M=(t,a)=>{if(!a)return;let r;const o=()=>{clearTimeout(r),r=setTimeout(()=>{var i;(i=t.value)==null||i.search()},800)};v(()=>{var i;(i=n.value)==null||i.map.on("moveend",o)}),G(()=>{var i;(i=n.value)==null||i.map.un("moveend",o)})},J=t=>{const a=()=>w(()=>{console.log("[eodash] map layers updated, re-rendering items..."),u(t.value)});v(()=>{if(!n.value){console.log("[eodash] waiting for map to be ready..."),U(n,()=>{console.log("[eodash] map is ready, rendering items..."),u(t.value),a()},{once:!0,immediate:!1});return}console.log("[eodash] map was found, rendering items..."),u(t.value),a()})},q=(t,a)=>{a.value=t.detail.results,u(a.value)},z=(t,a)=>{var o;const r=t.detail;r&&(a.$patch({selectedItem:r}),a.loadSelectedSTAC(r.collection),(o=n.value)==null||o.selectInteractions[r.id].highlightById([r.id],{padding:[100,100,100,100],duration:1200,easing:A}))},C="eox-itemfilter[data-v-7bc5e6cd]{flex-basis:20%;height:100%;overflow:hidden!important;padding:1rem;--eox-itemfilter-results-color: var(--v-theme-surface) !important}.title[data-v-7bc5e6cd]{padding:1em;margin:.2em}",H=[".filterProperties",".items"],Q={slot:"filterstitle",style:{margin:"14px 8px"}},W={slot:"resultstitle",style:{margin:"14px 8px"}},X={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:I},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100}]}},async setup(t){let a,r;const o=t,i=m(),e=V("itemfilter"),s=K([]);[a,r]=L(()=>T.get(i.stacEndpoint+"/search?limit=100").then(c=>s.value=c.data.features)),await a,r();const l=s.value,x=N(o.filters),S=(c,p)=>D(p,o.filters,o.bboxFilter),b=c=>{q(c,s)},_=c=>{z(c,i)};return J(s),M(e,o.bboxFilter),(c,p)=>(O(),B("span",null,[h($,{class:"title align-center justify-space-between"},{default:P(()=>[p[0]||(p[0]=d("h4",null,"Catalog Items",-1)),h(E,{target:t.layoutTarget,icon:t.layoutIcon},null,8,["target","icon"])]),_:1,__:[0]}),d("eox-itemfilter",{ref:"itemfilter",titleProperty:"id",imageProperty:"preview",".filterProperties":g(x),".items":g(l),onSelect:_,onFilter:b,externalFilter:S},[d("h4",Q,f(t.filtersTitle),1),d("h4",W,f(t.resultsTitle),1)],40,H)]))}},ce=F(X,[["styles",[C]],["__scopeId","data-v-7bc5e6cd"]]);export{ce as default};
