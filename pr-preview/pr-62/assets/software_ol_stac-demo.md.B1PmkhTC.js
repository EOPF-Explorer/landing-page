import{_ as Y,v as H,p as i,P as K,x as Q,c as p,o as m,j as a,a as G,e as x,a0 as F,aF as N,t as v}from"./chunks/framework.C5l8s31R.js";import{S as U,F as A,d as B,M as X,V as I,t as ee,P as te}from"./chunks/XYZ.DUxXAAi-.js";import{W as Z}from"./chunks/DataTile.DjcFEZpA.js";import{V as O,a as $,F as ae}from"./chunks/Vector.B05eZo5v.js";import{G as oe}from"./chunks/GeoZarr.BjpRrKjM.js";import{O as ne}from"./chunks/ol.BJb2ldX2.js";import{D as se,c as re}from"./chunks/Draw.BzbIXUPh.js";import{c as le}from"./chunks/index.KPY1M44e.js";import"./chunks/index.OUYS7i6-.js";import"./chunks/Layer.DfLjSwUf.js";const ie={key:0,class:"warning"},ce={key:1,class:"demo-container"},de={class:"controls-panel"},ue={class:"compact-controls"},pe={class:"control-group compact"},me={class:"date-input-container"},fe=["max"],ve={class:"date-display"},ge={class:"control-group compact"},he={class:"date-input-container"},ye=["min","max"],be={class:"date-display"},we={class:"button-group compact"},Se=["disabled"],_e={key:0,class:"warning"},xe={key:0,class:"results-panel"},Le={key:0,class:"loading-info"},De={key:1,class:"loading-info",style:{color:"#28a745"}},ke={key:1,class:"results-panel no-results"},$e=JSON.parse('{"title":"STAC Demo","description":"","frontmatter":{"title":"STAC Demo","layout":"page"},"headers":[],"relativePath":"software/ol/stac-demo.md","filePath":"software/ol/stac-demo.md"}'),Pe={name:"software/ol/stac-demo.md"},Te=Object.assign(Pe,{setup(Ce){const L=i(null),D=i();let y=null,S=null,k=null,_=null,P=[];const d=i(""),u=i(""),T=i(""),b=i(!1),c=i([]),f=i(null),l=i([]),g=i([]);H(()=>{const e=document.createElement("style");e.id="stac-demo-hide-chrome",e.textContent=`
    header,
    footer,
    nav.top-nav,
    .VPNav,
    .VPSidebar,
    .VPNavBar,
    .top-nav,
    [class*="cookie"],
    [class*="Cookie"] {
      display: none !important;
    }
    body {
      margin: 0 !important;
      padding: 0 !important;
    }
    .VPContent,
    .vp-doc,
    main {
      padding-top: 0 !important;
      margin-top: 0 !important;
      max-width: 100% !important;
    }
  `,document.head.appendChild(e),z(),L.value=le(),L.value&&K(()=>{M()})}),Q(()=>{const e=document.getElementById("stac-demo-hide-chrome");e&&e.remove()});function z(){const e=new Date,t=new Date;t.setDate(e.getDate()-15),T.value=e.toISOString().split("T")[0],u.value=e.toISOString().split("T")[0],d.value=t.toISOString().split("T")[0]}function M(){if(D.value)try{const e=new Z({source:new ne}),t=new O;k=new $({source:t,style:new U({stroke:new B({color:"#2563eb",width:2}),fill:new A({color:"rgba(37, 99, 235, 0.1)"})})});const o=new O;_=new $({source:o,style:new U({stroke:new B({color:"#f97316",width:2}),fill:new A({color:"rgba(249, 115, 22, 0.15)"})})}),y=new X({layers:[e,k,_],target:D.value,view:new I({center:[26e4,625e4],zoom:8})}),S=new se({source:t,type:"Circle",geometryFunction:re()}),y.addInteraction(S),S.on("drawstart",()=>{t.clear(),o.clear(),C(),c.value=[],l.value=[],g.value=[]}),S.on("drawend",s=>{const n=s.feature.getGeometry().getExtent(),r=ee(n,"EPSG:3857","EPSG:4326");f.value=r,console.log("Selected bbox:",r)})}catch(e){console.error("Failed to initialize map:",e)}}async function R(){if(!f.value){alert("Please draw a bounding box on the map first");return}if(!d.value||!u.value){alert("Please select start and end dates");return}b.value=!0,c.value=[],l.value=[],g.value=[];try{const[e,t,o,s]=f.value,n=new URL("https://api.explorer.eopf.copernicus.eu/stac/search");n.searchParams.set("bbox",`${e},${t},${o},${s}`),n.searchParams.set("datetime",`${d.value}T00:00:00Z/${u.value}T23:59:59Z`),n.searchParams.set("collections","sentinel-2-l2a"),n.searchParams.set("limit","8"),console.log("Fetching from:",n.toString());const r=await fetch(n);if(!r.ok)throw new Error(`STAC API error: ${r.status}`);const h=await r.json();h.features&&h.features.length>0?(c.value=h.features,W(h.features)):c.value=[]}catch(e){console.error("Search error:",e),c.value=[]}finally{b.value=!1}}function W(e){const t=_.getSource();if(t.clear(),e.forEach(o=>{if(o.geometry){const s=new ae({geometry:new te(o.geometry.coordinates).transform("EPSG:4326","EPSG:3857")});s.setProperties({id:o.id,datetime:o.properties.datetime,collection:o.collection,stacItem:o}),t.addFeature(s)}}),e.length>0){const o=t.getExtent();y.getView().fit(o,{padding:[50,50,50,50]}),console.log("Auto-loading all scenes..."),e.forEach((s,n)=>{setTimeout(()=>{j(s)},n*500)})}}async function j(e){var t,o;console.log("Loading scene:",e.id),l.value.push(e.id);try{const s=(t=e.assets)==null?void 0:t.reflectance;let n=null,r;if(s)n=s.href,console.log("Using reflectance asset:",n);else{const w=(o=e.links)==null?void 0:o.find(J=>J.rel==="store");w&&(n=w.href,console.log("Using store link:",n))}if(!n){console.warn("No Zarr URL found in STAC item:",e.id),l.value=l.value.filter(w=>w!==e.id);return}console.log("Loading Zarr data from:",n),s&&n.includes("/measurements/reflectance")?r={url:n.replace("/measurements/reflectance",""),group:"measurements/reflectance",bands:["b04","b03","b02"]}:r={url:n,group:"measurements/reflectance",bands:["b04","b03","b02"]},console.log("Creating GeoZarr source with config:",r);const h=new oe(r),V=new Z({source:h,style:{gamma:1.5,color:["color",["interpolate",["linear"],["band",1],0,0,.5,255],["interpolate",["linear"],["band",2],0,0,.5,255],["interpolate",["linear"],["band",3],0,0,.5,255],["case",["==",["+",["band",1],["band",2],["band",3]],0],0,1]]}});y.addLayer(V),P.push(V),console.log("GeoZarr layer added to map for scene:",e.id),g.value.push(e.id)}catch(s){console.error("Failed to load scene:",s)}finally{l.value=l.value.filter(s=>s!==e.id)}}function C(){P.forEach(e=>{y.removeLayer(e)}),P=[]}function q(){k.getSource().clear(),f.value=null,_.getSource().clear(),c.value=[],l.value=[],g.value=[],C()}function E(e){return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}return(e,t)=>(m(),p("div",null,[L.value===!1?(m(),p("div",ie,[...t[2]||(t[2]=[a("strong",null,"âš ï¸ WebGL Not Supported:",-1),G(" Your browser doesn't support WebGL, which is required for this demo. ",-1)])])):(m(),p("div",ce,[a("div",de,[a("div",ue,[a("div",pe,[t[4]||(t[4]=a("label",{for:"start-date"},"Start Date:",-1)),a("div",me,[F(a("input",{id:"start-date",type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),max:u.value,title:"Select start date for search"},null,8,fe),[[N,d.value]]),a("div",ve,v(d.value?E(d.value+"T00:00:00Z"):"Not selected"),1),t[3]||(t[3]=a("span",{class:"date-icon"},"ðŸ“…",-1))])]),a("div",ge,[t[6]||(t[6]=a("label",{for:"end-date"},"End Date:",-1)),a("div",he,[F(a("input",{id:"end-date",type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o),min:d.value,max:T.value,title:"Select end date for search"},null,8,ye),[[N,u.value]]),a("div",be,v(u.value?E(u.value+"T00:00:00Z"):"Not selected"),1),t[5]||(t[5]=a("span",{class:"date-icon"},"ðŸ“…",-1))])]),a("div",we,[a("button",{onClick:R,disabled:b.value||!f.value,class:"button"},v(b.value?"Searching...":"ðŸ” Search"),9,Se),a("button",{onClick:q,class:"button border"}," Clear ")])]),f.value?x("",!0):(m(),p("div",_e,[...t[7]||(t[7]=[a("strong",null,"Draw a bounding box:",-1),G(" Click and drag on the map to define your search area. ",-1)])]))]),a("div",{ref_key:"mapRef",ref:D,class:"map-container"},null,512),c.value.length>0?(m(),p("div",xe,[a("h3",null,"ðŸ›°ï¸ Found "+v(c.value.length)+" Sentinel-2 scenes",1),t[8]||(t[8]=a("p",null,"Loading satellite imagery automatically...",-1)),l.value.length>0?(m(),p("div",Le," â³ Loading "+v(l.value.length)+" scene(s)... ",1)):x("",!0),g.value.length>0?(m(),p("div",De," âœ… "+v(g.value.length)+" of "+v(c.value.length)+" scenes loaded ",1)):x("",!0)])):!b.value&&f.value?(m(),p("div",ke," No results found for the selected area and time range. Try expanding your search criteria. ")):x("",!0)]))]))}}),ze=Y(Te,[["__scopeId","data-v-8b8bff6a"]]);export{$e as __pageData,ze as default};
