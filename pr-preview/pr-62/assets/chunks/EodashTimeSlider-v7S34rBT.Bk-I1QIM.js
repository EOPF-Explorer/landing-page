import{u as D,i as M}from"./mosaic-BjrHHSap.8oXPpSLm.js";import{_ as b,u as w,af as A,f as C,aM as R,bd as p,i as u,ak as L}from"./eo-dash.DckP5olI.js";import"./main.BYiQqjEO.js";import"./main.BkQWY9sY.js";import{c as V}from"./create-layers-config-CICQTPbF.eMXxmIrp.js";import{q as j,o as x,c as I,j as v,k as g,e as S,p as F,h as G}from"./framework.-yi2pkQ4.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./mdi.CnJQHbhh.js";import"./lit-element.CBn2YVps.js";import"./addCommonStyleSheet.BN-d4VcA.js";import"./dayjs.min.Ba62AOpW.js";import"./when.BR7zwNJC.js";import"./map.DiiNQ3pp.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./getElement.CdRlZPdn.js";import"./index.BIJR-IiI.js";import"./index.BUIxO2d3.js";import"./static.DLFxBHrh.js";import"./repeat.Duc9p3Ra.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.Bj3rQkfn.js";import"./unsafe-html.C2DIGSw-.js";import"./orient2d.DArCjZZA.js";import"./index.CxojoGlr.js";const N="eox-itemfilter[data-v-3947b78d]{--inline-container-height: 40px}",P=[".for",".animate",".initDate"],q={class:"d-flex g-10 align-center"},z=[".range"],K=[".filters"],U={__name:"EodashTimeSlider",props:{filters:{type:Array,default:()=>[]},datepickerRange:{type:Boolean,default:!0},animate:{type:Boolean,default:!0},useMosaic:{type:Boolean,default:!0},mosaicIndicators:{type:Array,default:()=>["sentinel-2-l2a"]}},setup(n){const s=n,l=w(),h=G(()=>!s.useMosaic||!l.mosaicEndpoint?!1:!s.mosaicIndicators||!s.mosaicIndicators.length?!0:s.mosaicIndicators.includes(u.value)),m=F(!1);j(u,async()=>{var e,t,a,r;if(await new Promise(i=>setTimeout(i,400)),h.value){m.value=!0,p.value+=1;return}const o=(t=(e=R.value)==null?void 0:e.layers)==null?void 0:t.find(i=>{var f;return((f=i.properties)==null?void 0:f.id)==="AnalysisGroup"});if(!o||!(o!=null&&o.layers.length)){m.value=!1;return}for(const i of o.layers)if((r=(a=i==null?void 0:i.properties)==null?void 0:a.timeControlValues)!=null&&r.length){m.value=!0;return}m.value=!1,p.value+=1},{immediate:!0}),l.mosaicEndpoint&&s.useMosaic&&D(l.mosaicEndpoint,void 0,l,s.mosaicIndicators);let c=[0,0],E="";const T=async o=>{const{date:e}=o.detail,[t,a]=e;if(!(t==c[0]&&a==c[1])){if(E!==u.value&&(setTimeout(()=>{console.log("[eodash] Triggering timeslider update"),p.value+=1},400),E=u.value),c=[t,a],!h.value){C.value=t.toISOString();return}M(l.mosaicEndpoint,{timeRange:[t.toISOString(),a.toISOString()],collection:u.value,cloudCover:d||void 0})}};let d=null;const _=o=>{var a,r;if(!h.value)return;const{filters:e}=o.detail,t=((r=(a=e.find(i=>i.key==="eo:cloud_cover"))==null?void 0:a.state)==null?void 0:r.max)||null;t===null||t===d||[0,100].includes(t)||(d=t,t===100&&(d=null),M(l.mosaicEndpoint,{timeRange:c==null?void 0:c.map(i=>new Date(i).toISOString()),collection:u.value,cloudCover:t}))},{selectedStac:O}=A(w()),B=async o=>{const{generate:e,selectedRangeItems:t}=o.detail,a=await Promise.all(Object.values(t).flatMap(async r=>{const i=[];for(const f of r)await V(O.value,L,f.originalDate).then(y=>{y=k(y),i.push({layers:y,date:f.originalDate})});return i})).then(r=>r.flat());e({mapLayers:a})};function k(o){return o.map(e=>e.type==="Group"?(e.layers=k(e.layers),e):(e.source&&(e.source.crossOrigin="anonymous"),e))}return(o,e)=>m.value?(x(),I("eox-timecontrol",{key:g(p),ref:"eoxTimecontrol",".for":g(R),onSelect:T,titleKey:"title",externalMapRendering:"",".animate":n.animate,".initDate":g(C)},[v("div",q,[e[0]||(e[0]=v("eox-timecontrol-date",{class:"flex-grow-1"},null,-1)),v("eox-timecontrol-picker",{".range":n.datepickerRange,".showDots":!0,".showItems":!0,".popup":!0},null,40,z),n.filters.length?(x(),I("eox-itemfilter",{key:0,onFilter:_,".inlineMode":!0,showResults:!1,".filters":g(n.filters)},null,40,K)):S("v-if",!0),n.animate?(x(),I("eox-timecontrol-timelapse",{key:1,onExport:B},null,32)):S("v-if",!0)]),e[1]||(e[1]=v("eox-timecontrol-timeline",{class:"mt-2"},null,-1))],40,P)):S("v-if",!0)}},he=b(U,[["styles",[N]],["__scopeId","data-v-3947b78d"]]);export{he as default};
