var Wi=Object.defineProperty;var be=i=>{throw TypeError(i)};var zi=(i,t,e)=>t in i?Wi(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var k=(i,t,e)=>zi(i,typeof t!="symbol"?t+"":t,e),Re=(i,t,e)=>t.has(i)||be("Cannot "+e);var I=(i,t,e)=>(Re(i,t,"read from private field"),e?e.call(i):t.get(i)),T=(i,t,e)=>t.has(i)?be("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),b=(i,t,e,n)=>(Re(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);import"./main.BTnrixAB.js";import{A as ht,c as oe,b as M,a as Qi,e as Di}from"./addCommonStyleSheet.DUrvIzFc.js";import{e as tn,i as en}from"./directive.CvdRHFdJ.js";import{p as nn}from"./directive-helpers.DnmURua8.js";import{n as Yt}from"./when.BR7zwNJC.js";import{g as sn}from"./getElement.CdRlZPdn.js";import"./main.C7o8ClVc.js";import{_ as rn,s as on,a as an,am as ln,an as cn,r as hn,o as un,i as dn,V as Ne,bj as gn,aq as fn,bk as pn,m as yn,n as mn}from"./eo-dash.cLWOzis9.js";import{c as _n,j as Cn,P as wn}from"./ProcessList-uB_eyug3.CYCeBU6j.js";import vn from"./EodashChart-BoayIlhe.dwcLvihq.js";import{i as Bt,u as Mn,h as Fn}from"./handling-Cunj8Mf0.B5PQo5O_.js";import{g as Pn,f as Ln,n as Gn}from"./async-D6U1S0ym.BEqPIzA4.js";import{w as Sn,x as In}from"./mdi.CR6P03lb.js";import{a2 as En,c as Te,o as ct,G as bn,e as vt,b as Ut,j as Rn,k as Mt,p as K,h as Jt,w as xe,a as Ae,v as ni,q as Oe,P as Nn}from"./framework.C5l8s31R.js";import"./sequential.BT5PQCvq.js";import"./orient2d.DArCjZZA.js";import"./browser.CvBADTdS.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./index.BIJR-IiI.js";import"./item.Bx-rtsOD.js";import"./index-Chj0Ot0U.DiiLp8Mx.js";import"./VTooltip-CklgwkwQ.ssq3RyOW.js";import"./forwardRefs-3xpsjrxZ.B2_EY9dS.js";import"./transition-DniF_5gX.uMASfv0C.js";/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Tn=tn(class extends en{constructor(){super(...arguments),this.key=ht}render(i,t){return this.key=i,t}update(i,[t,e]){return t!==this.key&&(nn(i),this.key=t),e}}),xn=i=>{i.hoverInteraction=i.eoxMap.selectInteractions.SelectLayerHoverInteraction,i.clickInteraction=i.eoxMap.selectInteractions.SelectLayerClickInteraction;const t=()=>{i.requestUpdate()};i.hoverInteraction.selectStyleLayer.on("change",t),i.clickInteraction.selectStyleLayer.on("change",t)},An=(i,t,e)=>{if(i.clickId===t)return;const n=e?[]:[t];i.hoverInteraction.highlightById(n)},On=(i,t,e)=>{i.stopPropagation();const n=Number(i.target.getAttribute("index")),s=t.drawLayer.getSource().getFeatures()[n];t.drawLayer.getSource().removeFeature(s),t.drawnFeatures.splice(n,1),e.emitDrawnFeatures(),t.requestUpdate()},ke={duration:750,padding:[20,20,20,20]},He={type:"FeatureCollection",features:[]},kn=(i,t)=>{const{clickId:e,drawLayer:n,olMap:s,clickInteraction:r}=t,o=r.getId(i);if(e===o){const l=n.getSource().getExtent();s.getView().fit(l,ke),r.highlightById([])}else{const l=t.eoxMap.projection||"EPSG:3857",c=t.eoxDrawTools.projection,h=i.clone().getGeometry().transform(c,l).getExtent();r.highlightById([o]),s.getView().fit(h,ke)}t.requestUpdate()};class si extends oe{constructor(){super();k(this,"hoverInteraction");k(this,"clickInteraction");k(this,"hoverId");k(this,"clickId");this.eoxDrawTools=null,this.eoxMap=null,this.olMap=null,this.draw=null,this.drawLayer=null,this.drawnFeatures=[],this.featureName="Feature",this.featureNameKey=null,this.modify=null,this.unstyled=!1}_handleDelete(e){On(e,this,this.eoxDrawTools),this.dispatchEvent(new CustomEvent("changed",{bubbles:!0}))}_handleFeatureSelectAndDeselect(e){kn(e,this)}_handleHoverFeature(e,n=!1){An(this,e,n)}firstUpdated(){xn(this)}createRenderRoot(){return this}render(){var n,s;this.hoverId=(n=this.hoverInteraction)==null?void 0:n.selectedFids[0],this.clickId=(s=this.clickInteraction)==null?void 0:s.selectedFids[0];const e=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>trash-can-outline</title>
      <path
        d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
      />
    </svg>`;return M`
      <ul class="list no-space">
        ${this.drawnFeatures.map((r,o)=>{var f;const a=o+1,l=Object.values(this.eoxMap.selectInteractions)[0].getId(r),c=this.hoverId===l,h=this.clickId===l,u=c?"surface-container-low":h?"fill":ht,d=(f=this.featureNameKey)==null?void 0:f.split("."),g=r.get(this.featureNameKey)||(d==null?void 0:d.reduce((y,F)=>y==null?void 0:y[F],{...r.getProperties()})),p=g||`${this.featureName} ${a}`;return Tn(a,M`
              <li
                class="${u} no-round"
                @mouseover=${()=>this._handleHoverFeature(l)}
                @mouseout=${()=>this._handleHoverFeature(l,!0)}
                @click="${()=>this._handleFeatureSelectAndDeselect(r)}"
              >
                <div class="max">
                  <span class="title">${p}</span>
                </div>
                <button
                  index=${o}
                  data-cy="deleteFeatureBtn"
                  class="transparent square small error-text front"
                  @click="${this._handleDelete}"
                >
                  ${this.unstyled?"x":M`<i class="small">${e}</i>`}
                </button>
              </li>
            `)})}
      </ul>
    `}}k(si,"properties",{eoxDrawTools:{attribute:!1,state:!0},eoxMap:{attribute:!1,state:!0},olMap:{attribute:!1,state:!0},draw:{attribute:!1,state:!0},drawLayer:{attribute:!1,state:!0},drawnFeatures:{attribute:!1,state:!0,type:Array},featureName:{attribute:!1,state:!0,type:String},featureNameKey:{attribute:!1,state:!0,type:String},modify:{attribute:!1,state:!0},unstyled:{type:Boolean}});customElements.define("eox-drawtools-list",si);const Hn=i=>{const{multipleFeatures:t,drawnFeatures:e,currentlyDrawing:n}=i,s=!t&&(e==null?void 0:e.length)>0||n,r=!(e!=null&&e.length)&&!n;return{drawDisabled:s,discardDisabled:r}};function Vn(i){navigator.clipboard.writeText(i).then(function(){},function(t){console.error("Could not copy text: ",t)})}const jn={PROPERTYCHANGE:"propertychange"},ae={CHANGE:"change"};class $n{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Xn(i,t,e){let n,s;e=e||ri;let r=0,o=i.length,a=!1;for(;r<o;)n=r+(o-r>>1),s=+e(i[n],t),s<0?r=n+1:(o=n,a=!s);return a?r:~r}function ri(i,t){return i>t?1:i<t?-1:0}function R(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let s=0;s<n;s++)i[i.length]=e[s]}function Yn(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function Ve(){}function oi(i){let t,e,n;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==n||!Yn(s,e))&&(n=this,e=s,t=i.apply(this,arguments)),t}}function ai(i){for(const t in i)delete i[t]}function li(i){let t;for(t in i)return!1;return!t}class ci{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Bn extends $n{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=e?new ci(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let c=0,h=s.length;c<h;++c)if("handleEvent"in s[c]?l=s[c].handleEvent(r):l=s[c].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,Ve);delete o[n]}return l}disposeInternal(){this.listeners_&&ai(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Ve,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}function ut(i,t,e,n,s){if(s){const o=e;e=function(a){return i.removeEventListener(t,e),o.call(n??this,a)}}else n&&n!==i&&(e=e.bind(n));const r={target:i,type:t,listener:e};return i.addEventListener(t,e),r}function je(i,t,e,n){return ut(i,t,e,n,!0)}function St(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ai(i))}class Tt extends Bn{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ae.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ut(this,t[r],e);return s}return ut(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=je(this,t[r],e)}else n=je(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Un(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}Tt.prototype.on;Tt.prototype.once;Tt.prototype.un;function Un(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)St(i[t]);else St(i)}function m(){throw new Error("Unimplemented abstract method.")}let Jn=0;function qn(i){return i.ol_uid||(i.ol_uid=String(++Jn))}class $e extends ci{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class hi extends Tt{constructor(t){super(),this.on,this.once,this.un,qn(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new $e(n,t,e)),n=jn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new $e(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const s=this.values_||(this.values_={});if(n)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],li(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function Kn(i,t){if(!i)throw new Error(t)}class X extends hi{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new X(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(St(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ut(t,ae.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Zn(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Zn(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Kn(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}const P={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function U(i,t,e){let n,s;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,n*n+s*s}function ui(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Xe(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],o=t[0],a=t[1];let l=P.UNKNOWN;return o<e?l=l|P.LEFT:o>s&&(l=l|P.RIGHT),a<n?l=l|P.BELOW:a>r&&(l=l|P.ABOVE),l===P.UNKNOWN&&(l=P.INTERSECTING),l}function le(){return[1/0,1/0,-1/0,-1/0]}function di(i,t,e,n,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=n,s):[i,t,e,n]}function ce(i){return di(1/0,1/0,-1/0,-1/0,i)}function gi(i,t){const e=i[0],n=i[1];return di(e,n,e,n,t)}function he(i,t,e,n,s){const r=ce(s);return fi(r,i,t,e,n)}function Wn(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function fi(i,t,e,n,s){for(;e<n;e+=s)zn(i,t[e],t[e+1]);return i}function zn(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Qn(i,t){let e;return e=t(Dn(i)),e||(e=t(ts(i)),e)||(e=t(is(i)),e)||(e=t(es(i)),e)?e:!1}function Dn(i){return[i[0],i[1]]}function ts(i){return[i[2],i[1]]}function xt(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function It(i){return i[3]-i[1]}function es(i){return[i[0],i[3]]}function is(i){return[i[2],i[3]]}function ns(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function ss(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function rs(i,t,e){let n=!1;const s=Xe(i,t),r=Xe(i,e);if(s===P.INTERSECTING||r===P.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],c=i[3],h=t[0],u=t[1],d=e[0],g=e[1],p=(g-u)/(d-h);let f,y;r&P.ABOVE&&!(s&P.ABOVE)&&(f=d-(g-c)/p,n=f>=o&&f<=l),!n&&r&P.RIGHT&&!(s&P.RIGHT)&&(y=g-(d-l)*p,n=y>=a&&y<=c),!n&&r&P.BELOW&&!(s&P.BELOW)&&(f=d-(g-a)/p,n=f>=o&&f<=l),!n&&r&P.LEFT&&!(s&P.LEFT)&&(y=g-(d-o)*p,n=y>=a&&y<=c)}return n}function os(i,t,e,n,s,r){const o=s-e,a=r-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=s,n=r):l>0&&(e+=o*l,n+=a*l)}return $(i,t,e,n)}function $(i,t,e,n){const s=e-i,r=n-t;return s*s+r*r}function Ye(i){return i*180/Math.PI}function E(i){return i*Math.PI/180}function ue(i,t,e){return i+e*(t-i)}function Qt(i,t,e){if(i>=t&&i<e)return i;const n=e-t;return((i-t)%n+n)%n+t}const as={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class de{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||as[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Ct=6378137,z=Math.PI*Ct,ls=[-z,-z,z,z],cs=[-180,-85,180,85],Ft=Ct*Math.log(Math.tan(Math.PI/2));class Z extends de{constructor(t){super({code:t,units:"m",extent:ls,global:!0,worldExtent:cs,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Ct)}})}}const Be=[new Z("EPSG:3857"),new Z("EPSG:102100"),new Z("EPSG:102113"),new Z("EPSG:900913"),new Z("http://www.opengis.net/def/crs/EPSG/0/3857"),new Z("http://www.opengis.net/gml/srs/epsg.xml#3857")];function hs(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=z*i[r]/180;let o=Ct*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));o>Ft?o=Ft:o<-Ft&&(o=-Ft),t[r+1]=o}return t}function us(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*i[r]/z,t[r+1]=360*Math.atan(Math.exp(i[r+1]/Ct))/Math.PI-90;return t}const ds=6378137,Ue=[-180,-90,180,90],gs=Math.PI*ds/180;class H extends de{constructor(t,e){super({code:t,units:"degrees",extent:Ue,axisOrientation:e,global:!0,metersPerUnit:gs,worldExtent:Ue})}}const Je=[new H("CRS:84"),new H("EPSG:4326","neu"),new H("urn:ogc:def:crs:OGC:1.3:CRS84"),new H("urn:ogc:def:crs:OGC:2:84"),new H("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new H("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new H("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Dt={};function fs(i){return Dt[i]||Dt[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function ps(i,t){Dt[i]=t}let D={};function dt(i,t,e){const n=i.getCode(),s=t.getCode();n in D||(D[n]={}),D[n][s]=e}function qt(i,t){return i in D&&t in D[i]?D[i][t]:null}const Et=.9996,S=.00669438,At=S*S,Ot=At*S,V=S/(1-S),qe=Math.sqrt(1-S),nt=(1-qe)/(1+qe),pi=nt*nt,ge=pi*nt,fe=ge*nt,yi=fe*nt,mi=1-S/4-3*At/64-5*Ot/256,ys=3*S/8+3*At/32+45*Ot/1024,ms=15*At/256+45*Ot/1024,_s=35*Ot/3072,Cs=3/2*nt-27/32*ge+269/512*yi,ws=21/16*pi-55/32*fe,vs=151/96*ge-417/128*yi,Ms=1097/512*fe,bt=6378137;function Fs(i,t,e){const n=i-5e5,o=(e.north?t:t-1e7)/Et/(bt*mi),a=o+Cs*Math.sin(2*o)+ws*Math.sin(4*o)+vs*Math.sin(6*o)+Ms*Math.sin(8*o),l=Math.sin(a),c=l*l,h=Math.cos(a),u=l/h,d=u*u,g=d*d,p=1-S*c,f=Math.sqrt(1-S*c),y=bt/f,F=(1-S)/p,w=V*h**2,v=w*w,_=n/(y*Et),L=_*_,N=L*_,at=N*_,lt=at*_,$t=lt*_,Zi=a-u/F*(L/2-at/24*(5+3*d+10*w-4*v-9*V))+$t/720*(61+90*d+298*w+45*g-252*V-3*v);let Xt=(_-N/6*(1+2*d+w)+lt/120*(5-2*w+28*d-3*v+8*V+24*g))/h;return Xt=Qt(Xt+E(_i(e.number)),-Math.PI,Math.PI),[Ye(Xt),Ye(Zi)]}const Ke=-80,Ze=84,Ps=-180,Ls=180;function Gs(i,t,e){i=Qt(i,Ps,Ls),t<Ke?t=Ke:t>Ze&&(t=Ze);const n=E(t),s=Math.sin(n),r=Math.cos(n),o=s/r,a=o*o,l=a*a,c=E(i),h=_i(e.number),u=E(h),d=bt/Math.sqrt(1-S*s**2),g=V*r**2,p=r*Qt(c-u,-Math.PI,Math.PI),f=p*p,y=f*p,F=y*p,w=F*p,v=w*p,_=bt*(mi*n-ys*Math.sin(2*n)+ms*Math.sin(4*n)-_s*Math.sin(6*n)),L=Et*d*(p+y/6*(1-a+g)+w/120*(5-18*a+l+72*g-58*V))+5e5;let N=Et*(_+d*o*(f/2+F/24*(5-a+9*g+4*g**2)+v/720*(61-58*a+l+600*g-330*V)));return e.north||(N+=1e7),[L,N]}function _i(i){return(i-1)*6-180+3}const Ss=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Ci(i){let t=0;for(const s of Ss){const r=i.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let e=0,n=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(n=!0,e=t-32600),e?{number:e,north:n}:null}function We(i,t){return function(e,n,s,r){const o=e.length;s=s>1?s:2,r=r??s,n||(s>2?n=e.slice():n=new Array(o));for(let a=0;a<o;a+=r){const l=e[a],c=e[a+1],h=i(l,c,t);n[a]=h[0],n[a+1]=h[1]}return n}}function Is(i){return Ci(i)?new de({code:i,units:"m"}):null}function Es(i){const t=Ci(i.getCode());return t?{forward:We(Gs,t),inverse:We(Fs,t)}:null}const pe=63710088e-1;function bs(i,t,e){e=e||pe;const n=E(i[1]),s=E(t[1]),r=(s-n)/2,o=E(t[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Kt(i,t){let e=0;for(let n=0,s=i.length;n<s-1;++n)e+=bs(i[n],i[n+1],t);return e}function wi(i,t){t=t||{};const e=t.radius||pe,n=t.projection||"EPSG:3857",s=i.getType();s!=="GeometryCollection"&&(i=i.clone().transform(n,"EPSG:4326"));let r=0,o,a,l,c,h,u;switch(s){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{o=i.getCoordinates(),r=Kt(o,e);break}case"MultiLineString":case"Polygon":{for(o=i.getCoordinates(),l=0,c=o.length;l<c;++l)r+=Kt(o[l],e);break}case"MultiPolygon":{for(o=i.getCoordinates(),l=0,c=o.length;l<c;++l)for(a=o[l],h=0,u=a.length;h<u;++h)r+=Kt(a[h],e);break}case"GeometryCollection":{const d=i.getGeometries();for(l=0,c=d.length;l<c;++l)r+=wi(d[l],t);break}default:throw new Error("Unsupported geometry type: "+s)}return r}function Pt(i,t){let e=0;const n=i.length;let s=i[n-1][0],r=i[n-1][1];for(let o=0;o<n;o++){const a=i[o][0],l=i[o][1];e+=E(a-s)*(2+Math.sin(E(r))+Math.sin(E(l))),s=a,r=l}return e*t*t/2}function vi(i,t){t=t||{};const e=t.radius||pe,n=t.projection||"EPSG:3857",s=i.getType();s!=="GeometryCollection"&&(i=i.clone().transform(n,"EPSG:4326"));let r=0,o,a,l,c,h,u;switch(s){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(o=i.getCoordinates(),r=Math.abs(Pt(o[0],e)),l=1,c=o.length;l<c;++l)r-=Math.abs(Pt(o[l],e));break}case"MultiPolygon":{for(o=i.getCoordinates(),l=0,c=o.length;l<c;++l)for(a=o[l],r+=Math.abs(Pt(a[0],e)),h=1,u=a.length;h<u;++h)r-=Math.abs(Pt(a[h],e));break}case"GeometryCollection":{const d=i.getGeometries();for(l=0,c=d.length;l<c;++l)r+=vi(d[l],t);break}default:throw new Error("Unsupported geometry type: "+s)}return r}const Rs=[Es],Ns=[Is];function ye(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function te(i){ps(i.getCode(),i),dt(i,i,ye)}function Ts(i){i.forEach(te)}function G(i){if(typeof i!="string")return i;const t=fs(i);if(t)return t;for(const e of Ns){const n=e(i);if(n)return n}return null}function ze(i){Ts(i),i.forEach(function(t){i.forEach(function(e){t!==e&&dt(t,e,ye)})})}function xs(i,t,e,n){i.forEach(function(s){t.forEach(function(r){dt(s,r,e),dt(r,s,n)})})}function As(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Mi(i,t)===ye)&&e}function Mi(i,t){const e=i.getCode(),n=t.getCode();let s=qt(e,n);if(s)return s;let r=null,o=null;for(const l of Rs)r||(r=l(i)),o||(o=l(t));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=Zt(r.inverse,o.forward);else{const l=qt(e,a);l&&(s=Zt(l,o.forward))}else{const l=qt(a,n);l&&(s=Zt(r.inverse,l))}return s&&(te(i),te(t),dt(i,t,s)),s}function Zt(i,t){return function(e,n,s,r){return n=i(e,n,s,r),t(n,n,s,r)}}function ee(i,t){const e=G(i),n=G(t);return Mi(e,n)}function Os(){ze(Be),ze(Je),xs(Je,Be,hs,us)}Os();new Array(6);function Fi(){return[1,0,0,1,0,0]}function Pi(i,t,e,n,s,r,o,a){const l=Math.sin(r),c=Math.cos(r);return i[0]=n*c,i[1]=s*l,i[2]=-n*l,i[3]=s*c,i[4]=o*n*c-a*n*l+t,i[5]=o*s*l+a*s*c+e,i}function Li(i,t,e,n,s,r,o){r=r||[],o=o||2;let a=0;for(let l=t;l<e;l+=n){const c=i[l],h=i[l+1];r[a++]=s[0]*c+s[2]*h+s[4],r[a++]=s[1]*c+s[3]*h+s[5];for(let u=2;u<o;u++)r[a++]=i[l+u]}return r&&r.length!=a&&(r.length=a),r}function ks(i,t,e,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),c=r[0],h=r[1];let u=0;for(let d=t;d<e;d+=n){const g=i[d]-c,p=i[d+1]-h;o[u++]=c+g*a-p*l,o[u++]=h+g*l+p*a;for(let f=d+2;f<d+n;++f)o[u++]=i[f]}return o&&o.length!=u&&(o.length=u),o}function Hs(i,t,e,n,s,r,o,a){a=a||[];const l=o[0],c=o[1];let h=0;for(let u=t;u<e;u+=n){const d=i[u]-l,g=i[u+1]-c;a[h++]=l+s*d,a[h++]=c+r*g;for(let p=u+2;p<u+n;++p)a[h++]=i[p]}return a&&a.length!=h&&(a.length=h),a}function Vs(i,t,e,n,s,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+s,o[a++]=i[l+1]+r;for(let c=l+2;c<l+n;++c)o[a++]=i[c]}return o&&o.length!=a&&(o.length=a),o}const Qe=Fi(),js=[NaN,NaN];class Gi extends hi{constructor(){super(),this.extent_=le(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=oi((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return m()}closestPointXY(t,e,n,s){return m()}containsXY(t,e){return this.closestPointXY(t,e,js,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return m()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&ce(e),this.extentRevision_=this.getRevision()}return ss(this.extent_,t)}rotate(t,e){m()}scale(t,e,n){m()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return m()}getType(){return m()}applyTransform(t){m()}intersectsExtent(t){return m()}translate(t,e){m()}transform(t,e){const n=G(t),s=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),c=n.getWorldExtent(),h=It(c)/It(l);Pi(Qe,c[0],c[3],h,-h,0,0,0);const u=Li(r,0,r.length,a,Qe,o),d=ee(n,e);return d?d(u,u,a):u}:ee(n,e);return this.applyTransform(s),this}}class J extends Gi{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return he(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return m()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=De(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){m()}setLayout(t,e,n){let s;if(t)s=De(t);else{for(let r=0;r<n;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=q(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();ks(n,0,n.length,s,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=xt(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();Hs(s,0,s.length,r,t,e,n,s),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Vs(n,0,n.length,s,t,e,n),this.changed()}}}function q(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function De(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function $s(i,t,e,n){for(let s=0,r=e.length;s<r;++s)i[t++]=e[s];return t}function kt(i,t,e,n){for(let s=0,r=e.length;s<r;++s){const o=e[s];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function wt(i,t,e,n,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=kt(i,t,e[o],n);s[r++]=l,t=l}return s.length=r,s}function Si(i,t,e,n,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=wt(i,t,e[o],n,s[r]);l.length===0&&(l[0]=t),s[r++]=l,t=l[l.length-1]}return s.length=r,s}function Ii(i,t,e,n){const s=[];let r=le();for(let o=0,a=e.length;o<a;++o){const l=e[o];r=he(i,t,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}function Xs(i,t,e,n,s){return!Qn(s,function(o){return!j(i,t,e,n,o[0],o[1])})}function j(i,t,e,n,s,r){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const c=i[t],h=i[t+1];l<=r?h>r&&(c-a)*(r-l)-(s-a)*(h-l)>0&&o++:h<=r&&(c-a)*(r-l)-(s-a)*(h-l)<0&&o--,a=c,l=h}return o!==0}function me(i,t,e,n,s,r){if(e.length===0||!j(i,t,e[0],n,s,r))return!1;for(let o=1,a=e.length;o<a;++o)if(j(i,e[o-1],e[o],n,s,r))return!1;return!0}function Ys(i,t,e,n,s,r){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(me(i,t,l,n,s,r))return!0;t=l[l.length-1]}return!1}function _e(i,t,e,n,s,r,o){let a,l,c,h,u,d,g;const p=s[r+1],f=[];for(let w=0,v=e.length;w<v;++w){const _=e[w];for(h=i[_-n],d=i[_-n+1],a=t;a<_;a+=n)u=i[a],g=i[a+1],(p<=d&&g<=p||d<=p&&p<=g)&&(c=(p-d)/(g-d)*(u-h)+h,f.push(c)),h=u,d=g}let y=NaN,F=-1/0;for(f.sort(ri),h=f[0],a=1,l=f.length;a<l;++a){u=f[a];const w=Math.abs(u-h);w>F&&(c=(h+u)/2,me(i,t,e,n,c,p)&&(y=c,F=w)),h=u}return isNaN(y)&&(y=s[r]),o?(o.push(y,p,F),o):[y,p,F]}function Ei(i,t,e,n,s){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=_e(i,t,l,n,s,2*o,r),t=l[l.length-1]}return r}function Rt(i,t,e,n,s,r,o){let a,l;const c=(e-t)/n;if(c===1)a=t;else if(c===2)a=t,l=s;else if(c!==0){let h=i[t],u=i[t+1],d=0;const g=[0];for(let y=t+n;y<e;y+=n){const F=i[y],w=i[y+1];d+=Math.sqrt((F-h)*(F-h)+(w-u)*(w-u)),g.push(d),h=F,u=w}const p=s*d,f=Xn(g,p);f<0?(l=(p-g[-f-2])/(g[-f-1]-g[-f-2]),a=t+(-f-2)*n):a=t+f*n}o=o>1?o:2,r=r||new Array(o);for(let h=0;h<o;++h)r[h]=a===void 0?NaN:l===void 0?i[a+h]:ue(i[a+h],i[a+n+h],l);return r}function ie(i,t,e,n,s,r){if(e==t)return null;let o;if(s<i[t+n-1])return r?(o=i.slice(t,t+n),o[n-1]=s,o):null;if(i[e-1]<s)return r?(o=i.slice(e-n,e),o[n-1]=s,o):null;if(s==i[t+n-1])return i.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const d=a+l>>1;s<i[(d+1)*n-1]?l=d:a=d+1}const c=i[a*n-1];if(s==c)return i.slice((a-1)*n,(a-1)*n+n);const h=i[(a+1)*n-1],u=(s-c)/(h-c);o=[];for(let d=0;d<n-1;++d)o.push(ue(i[(a-1)*n+d],i[a*n+d],u));return o.push(s),o}function Bs(i,t,e,n,s,r,o){if(o)return ie(i,t,e[e.length-1],n,s,r);let a;if(s<i[n-1])return r?(a=i.slice(0,n),a[n-1]=s,a):null;if(i[i.length-1]<s)return r?(a=i.slice(i.length-n),a[n-1]=s,a):null;for(let l=0,c=e.length;l<c;++l){const h=e[l];if(t!=h){if(s<i[t+n-1])return null;if(s<=i[h-1])return ie(i,t,h,n,s,!1);t=h}}return null}function Us(i,t,e,n){for(;t<e-n;){for(let s=0;s<n;++s){const r=i[t+s];i[t+s]=i[e-n+s],i[e-n+s]=r}t+=n,e-=n}}function Ce(i,t,e,n){let s=0,r=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function we(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Ce(i,t,a,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=a}return!0}function bi(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(!we(i,t,a,n,s))return!1;a.length&&(t=a[a.length-1])}return!0}function Nt(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Ce(i,t,a,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&Us(i,t,a,n),t=a}return t}function ne(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r)t=Nt(i,t,e[r],n,s);return t}function Ri(i,t){const e=[];let n=0,s=0,r;for(let o=0,a=t.length;o<a;++o){const l=t[o],c=Ce(i,n,l,2);if(r===void 0&&(r=c),c===r)e.push(t.slice(s,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=o+1,n=l}return e}function Ht(i,t,e,n,s,r,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)r[o++]=i[t],r[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[t,e-n];let h=0;for(;c.length>0;){const u=c.pop(),d=c.pop();let g=0;const p=i[d],f=i[d+1],y=i[u],F=i[u+1];for(let w=d+n;w<u;w+=n){const v=i[w],_=i[w+1],L=os(v,_,p,f,y,F);L>g&&(h=w,g=L)}g>s&&(l[(h-t)/n]=1,d+n<h&&c.push(d,h),h+n<u&&c.push(h,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[t+u*n],r[o++]=i[t+u*n+1]);return o}function Ni(i,t,e,n,s,r,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l];o=Ht(i,t,h,n,s,r,o),a.push(o),t=h}return o}function W(i,t){return t*Math.round(i/t)}function Js(i,t,e,n,s,r,o){if(t==e)return o;let a=W(i[t],s),l=W(i[t+1],s);t+=n,r[o++]=a,r[o++]=l;let c,h;do if(c=W(i[t],s),h=W(i[t+1],s),t+=n,t==e)return r[o++]=c,r[o++]=h,o;while(c==a&&h==l);for(;t<e;){const u=W(i[t],s),d=W(i[t+1],s);if(t+=n,u==c&&d==h)continue;const g=c-a,p=h-l,f=u-a,y=d-l;if(g*y==p*f&&(g<0&&f<g||g==f||g>0&&f>g)&&(p<0&&y<p||p==y||p>0&&y>p)){c=u,h=d;continue}r[o++]=c,r[o++]=h,a=c,l=h,c=u,h=d}return r[o++]=c,r[o++]=h,o}function ve(i,t,e,n,s,r,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l];o=Js(i,t,h,n,s,r,o),a.push(o),t=h}return o}function qs(i,t,e,n,s,r,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l],u=[];o=ve(i,t,h,n,s,r,o,u),a.push(u),t=h[h.length-1]}return o}class Y extends Gi{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(St),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(ut(t[e],ae.CHANGE,this.changed,this))}clone(){const t=new Y(Wt(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<U(this.getExtent(),t,e))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(t,e,n,s);return s}containsXY(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(t,e))return!0;return!1}computeExtent(t){ce(t);const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)Wn(t,e[n].getExtent());return t}getGeometries(){return Wt(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let s=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(s=!0)}return s?new Y(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(t,e);this.changed()}scale(t,e,n){n||(n=xt(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Wt(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Wt(i){return i.map(t=>t.clone())}function Ti(i,t,e,n){let s=0;const r=i[e-n],o=i[e-n+1];let a=0,l=0;for(;t<e;t+=n){const c=i[t]-r,h=i[t+1]-o;s+=l*c-a*h,a=c,l=h}return s/2}function xi(i,t,e,n){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=Ti(i,t,a,n),t=a}return s}function Ks(i,t,e,n){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=xi(i,t,a,n),t=a[a.length-1]}return s}function ti(i,t,e,n,s,r,o){const a=i[t],l=i[t+1],c=i[e]-a,h=i[e+1]-l;let u;if(c===0&&h===0)u=t;else{const d=((s-a)*c+(r-l)*h)/(c*c+h*h);if(d>1)u=e;else if(d>0){for(let g=0;g<n;++g)o[g]=ue(i[t+g],i[e+g],d);o.length=n;return}else u=t}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function Me(i,t,e,n,s){let r=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],c=$(r,o,a,l);c>s&&(s=c),r=a,o=l}return s}function Fe(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=Me(i,t,a,n,s),t=a}return s}function Zs(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=Fe(i,t,a,n,s),t=a[a.length-1]}return s}function Pe(i,t,e,n,s,r,o,a,l,c,h){if(t==e)return c;let u,d;if(s===0){if(d=$(o,a,i[t],i[t+1]),d<c){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,d}return c}h=h||[NaN,NaN];let g=t+n;for(;g<e;)if(ti(i,g-n,g,n,o,a,h),d=$(o,a,h[0],h[1]),d<c){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/s|0,1);if(r&&(ti(i,e-n,t,n,o,a,h),d=$(o,a,h[0],h[1]),d<c)){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n}return c}function Le(i,t,e,n,s,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];c=Pe(i,t,g,n,s,r,o,a,l,c,h),t=g}return c}function Ws(i,t,e,n,s,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];c=Le(i,t,g,n,s,r,o,a,l,c,h),t=g[g.length-1]}return c}function Vt(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<e;o+=n)s[r++]=i.slice(o,o+n);return s.length=r,s}function Ge(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=Vt(i,t,l,n,s[r]),t=l}return s.length=r,s}function zs(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=l.length===1&&l[0]===t?[]:Ge(i,t,l,n,s[r]),t=l[l.length-1]}return s.length=r,s}class gt extends J{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new gt(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,s){return s<U(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Me(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,s))}getArea(){return Ti(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new gt(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=kt(this.flatCoordinates,0,t,this.stride),this.changed()}}function Ai(i,t,e,n,s){let r;for(t+=n;t<e;t+=n)if(r=s(i.slice(t-n,t),i.slice(t,t+n)),r)return r;return!1}function jt(i,t,e,n,s,r){return r=r??fi(le(),i,t,e,n),ns(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Ai(i,t,e,n,function(o,a){return rs(s,o,a)}):!1}function Qs(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){if(jt(i,t,e[r],n,s))return!0;t=e[r]}return!1}function Ds(i,t,e,n,s){return!!(jt(i,t,e,n,s)||j(i,t,e,n,s[0],s[1])||j(i,t,e,n,s[0],s[3])||j(i,t,e,n,s[2],s[1])||j(i,t,e,n,s[2],s[3]))}function Oi(i,t,e,n,s){if(!Ds(i,t,e[0],n,s))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(Xs(i,e[r-1],e[r],n,s)&&!jt(i,e[r-1],e[r],n,s))return!1;return!0}function tr(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(Oi(i,t,a,n,s))return!0;t=a[a.length-1]}return!1}function ki(i,t,e,n){let s=i[t],r=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=i[a],c=i[a+1];o+=Math.sqrt((l-s)*(l-s)+(c-r)*(c-r)),s=l,r=c}return o}class x extends J{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){R(this.flatCoordinates,t),this.changed()}clone(){const t=new x(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<U(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Me(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,s))}forEachSegment(t){return Ai(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,ie(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Rt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new x(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return jt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=kt(this.flatCoordinates,0,t,this.stride),this.changed()}}class st extends J{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const s=t,r=[],o=[];for(let l=0,c=s.length;l<c;++l){const h=s[l];R(r,h.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(t){R(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new st(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<U(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fe(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Le(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,s))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Bs(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Ge(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new x(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,s=[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],c=new x(t.slice(r,l),n);s.push(c),r=l}return s}getLength(){const t=this.ends_;let e=0,n=0;for(let s=0,r=t.length;s<r;++s)n+=ki(this.flatCoordinates,e,t[s],this.stride),e=t[s];return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],c=Rt(e,n,l,r,.5);R(t,c),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Ni(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new st(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Qs(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=wt(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class A extends J{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new A(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const r=this.flatCoordinates,o=$(t,e,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return gi(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ui(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$s(this.flatCoordinates,0,t,this.stride),this.changed()}}class ot extends J{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){R(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new ot(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<U(this.getExtent(),t,e))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const c=$(t,e,r[a],r[a+1]);if(c<s){s=c;for(let h=0;h<o;++h)n[h]=r[a+h];n.length=o}}return s}getCoordinates(){return Vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new A(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,s=[];for(let r=0,o=t.length;r<o;r+=n){const a=new A(t.slice(r,r+n),e);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let s=0,r=e.length;s<r;s+=n){const o=e[s],a=e[s+1];if(ui(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=kt(this.flatCoordinates,0,t,this.stride),this.changed()}}class O extends J{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?R(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new O(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<U(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fe(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Le(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return me(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return xi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Nt(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ge(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=xt(this.getExtent());this.flatInteriorPoint_=_e(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new A(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new gt(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],c=new gt(e.slice(r,l),t);s.push(c),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;we(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Nt(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=ve(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new O(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Oi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=wt(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class rt extends J{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const s=t,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const c=s[a],h=r.length,u=c.getEnds();for(let d=0,g=u.length;d<g;++d)u[d]+=h;R(r,c.getFlatCoordinates()),o.push(u)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;R(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const n=new rt(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,s){return s<U(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zs(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ws(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return Ys(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Ks(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ne(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,zs(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Ii(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Ei(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ot(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;bi(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ne(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=qs(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new rt(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(e!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=e;return new O(this.flatCoordinates.slice(e,s),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),c=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const h=new O(e.slice(r,c),t,l);s.push(h),r=c}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return tr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Si(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const ei=Fi();class B{constructor(t,e,n,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?gi(this.flatCoordinates_):he(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=xt(this.getExtent());this.flatInteriorPoints_=_e(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Ri(this.flatCoordinates_,this.ends_),e=Ii(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Ei(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Rt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const o=n[s],a=Rt(t,e,o,2,.5);R(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=G(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const s=It(n)/It(e);Pi(ei,n[0],n[3],s,-s,0,0,0),Li(this.flatCoordinates_,0,this.flatCoordinates_.length,2,ei,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new B(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=oi((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=Ht(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=Ni(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,s);break;case"Polygon":s=[],n.length=ve(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,s);break}return s&&(this.simplifiedGeometry_=new B(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}B.prototype.getFlatCoordinates=B.prototype.getOrientedFlatCoordinates;function er(i){const t=i.getType();switch(t){case"Point":return new A(i.getFlatCoordinates());case"MultiPoint":return new ot(i.getFlatCoordinates(),"XY");case"LineString":return new x(i.getFlatCoordinates(),"XY");case"MultiLineString":return new st(i.getFlatCoordinates(),"XY",i.getEnds());case"Polygon":const e=i.getFlatCoordinates(),n=i.getEnds(),s=Ri(e,n);return s.length>1?new rt(e,"XY",s):new O(e,"XY",n);default:throw new Error("Invalid geometry type:"+t)}}function ir(i,t){const e=i.getId(),n=er(i),s=i.getProperties(),r=new X;return r.setGeometry(n),e!==void 0&&r.setId(e),r.setProperties(s,!0),r}class Hi{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=X,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?G(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=G(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return m()}readFeature(t,e){return m()}readFeatures(t,e){return m()}readGeometry(t,e){return m()}readProjection(t){return m()}writeFeature(t,e){return m()}writeFeatures(t,e){return m()}writeGeometry(t,e){return m()}}function ft(i,t,e){const n=e?G(e.featureProjection):null,s=e?G(e.dataProjection):null;let r=i;if(n&&s&&!As(n,s)){t&&(r=i.clone());const o=t?n:s,a=t?s:n;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(ee(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let c=0,h=l.length;c<h;++c)l[c]=Math.round(l[c]*o)/o;return l};r===i&&(r=i.clone()),r.applyTransform(a)}return r}const nr={Point:A,LineString:x,Polygon:O,MultiPoint:ot,MultiLineString:st,MultiPolygon:rt};function sr(i,t,e){return Array.isArray(t[0])?(bi(i,0,t,e)||(i=i.slice(),ne(i,0,t,e)),i):(we(i,0,t,e)||(i=i.slice(),Nt(i,0,t,e)),i)}function Vi(i,t){var r;const e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(o=>Vi({...i,geometry:o})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const s=e.layout.length;return ft(new B(n,n==="Polygon"?sr(e.flatCoordinates,e.ends,s):e.flatCoordinates,(r=e.ends)==null?void 0:r.flat(),s,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function Se(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>Se(s,t));return new Y(n)}const e=nr[i.type];return ft(new e(i.flatCoordinates,i.layout||"XY",i.ends),!1,t)}class rr extends Hi{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Lt(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Lt(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return m()}readFeaturesFromObject(t,e){return m()}readGeometry(t,e){return this.readGeometryFromObject(Lt(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return m()}readProjection(t){return this.readProjectionFromObject(Lt(t))}readProjectionFromObject(t){return m()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return m()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return m()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return m()}}function Lt(i){if(typeof i=="string"){const t=JSON.parse(i);return t||null}return i!==null?i:null}class or extends rr{constructor(t){t=t||{},super(),this.dataProjection=G(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=G(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const s=Ie(n.geometry);if(this.featureClass===B)return Vi({geometry:s,id:n.id,properties:n.properties},e);const r=new X;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&r.setGeometryName(n.geometry_name),r.setGeometry(Se(s,e)),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(t,e){const n=t;let s=null;if(n.type==="FeatureCollection"){const r=t;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const c=this.readFeatureFromObject(o[a],e);c&&s.push(c)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return ar(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=G(e.properties.name);else if(e.type==="EPSG")n=G("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(n.id=s),!t.hasProperties())return n;const r=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=se(o,e),delete r[t.getGeometryName()]),li(r)||(n.properties=r),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let s=0,r=t.length;s<r;++s)n.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return se(t,this.adaptOptions(e))}}function Ie(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=cr(i);break}case"LineString":{e=hr(i);break}case"Polygon":{e=fr(i);break}case"MultiPoint":{e=dr(i);break}case"MultiLineString":{e=ur(i);break}case"MultiPolygon":{e=gr(i);break}case"GeometryCollection":{e=lr(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function ar(i,t){const e=Ie(i);return Se(e,t)}function lr(i,t){return i.geometries.map(function(n){return Ie(n)})}function cr(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:q(t.length)}}function hr(i){var n;const t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:q(((n=t[0])==null?void 0:n.length)||2)}}function ur(i){var r,o;const t=i.coordinates,e=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length)||2,n=[],s=wt(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:s,layout:q(e)}}function dr(i){var e;const t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:q(((e=t[0])==null?void 0:e.length)||2)}}function gr(i){var r,o;const t=i.coordinates,e=[],n=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o[0].length)||2,s=Si(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:q(n)}}function fr(i){var r,o;const t=i.coordinates,e=[],n=(o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length,s=wt(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:s,layout:q(n)}}function se(i,t){i=ft(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=wr(i);break}case"LineString":{n=yr(i);break}case"Polygon":{n=vr(i,t);break}case"MultiPoint":{n=_r(i);break}case"MultiLineString":{n=mr(i);break}case"MultiPolygon":{n=Cr(i,t);break}case"GeometryCollection":{n=pr(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function pr(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return se(n,t)})}}function yr(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function mr(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function _r(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function Cr(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function wr(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function vr(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}const Mr=(i,t)=>new or().writeFeaturesObject(i,t);class Fr extends Hi{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Gt(t),this.adaptOptions(e))}readFeatureFromText(t,e){return m()}readFeatures(t,e){return this.readFeaturesFromText(Gt(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return m()}readGeometry(t,e){return this.readGeometryFromText(Gt(t),this.adaptOptions(e))}readGeometryFromText(t,e){return m()}readProjection(t){return this.readProjectionFromText(Gt(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return m()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return m()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return m()}}function Gt(i){return typeof i=="string"?i:""}const Pr={POINT:A,LINESTRING:x,POLYGON:O,MULTIPOINT:ot,MULTILINESTRING:st,MULTIPOLYGON:rt},ji="EMPTY",$i="Z",Xi="M",Lr="ZM",C={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},Gr={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Sr{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let n=t,s;if(t=="(")s=C.LEFT_PAREN;else if(t==",")s=C.COMMA;else if(t==")")s=C.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")s=C.NUMBER,n=this.readNumber_();else if(this.isAlpha_(t))s=C.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")s=C.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:n,type:s}}readNumber_(){let t;const e=this.index_;let n=!1,s=!1;do t=="."?n=!0:(t=="e"||t=="E")&&(s=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!s&&(t=="e"||t=="E")||s&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}class Ir{constructor(t){this.lexer_=t,this.token_={position:0,type:C.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const e=this.isTokenType(t);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t="XY";const e=this.token_;if(this.isTokenType(C.TEXT)){const n=e.value;n===$i?t="XYZ":n===Xi?t="XYM":n===Lr&&(t="XYZM"),t!=="XY"&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(C.LEFT_PAREN)){const t=[];do t.push(this.parseGeometry_());while(this.match(C.COMMA));if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePoint_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePointList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(C.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(C.LEFT_PAREN)){let t;if(this.token_.type==C.LEFT_PAREN?t=this.parsePointTextList_():t=this.parsePointList_(),this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(C.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePolygonTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],e=this.layout_.length;for(let n=0;n<e;++n){const s=this.token_;if(this.match(C.NUMBER))t.push(s.value);else break}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(C.COMMA);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(C.COMMA);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(C.COMMA);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(C.COMMA);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(C.TEXT)&&this.token_.value==ji;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.token_;if(this.match(C.TEXT)){const e=t.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(e=="GEOMETRYCOLLECTION"){if(n)return new Y([]);const o=this.parseGeometryCollectionText_();return new Y(o)}const s=Pr[e];if(!s)throw new Error("Invalid geometry type: "+e);let r;if(n)e=="POINT"?r=[NaN,NaN]:r=[];else switch(e){case"POINT":{r=this.parsePointText_();break}case"LINESTRING":{r=this.parseLineStringText_();break}case"POLYGON":{r=this.parsePolygonText_();break}case"MULTIPOINT":{r=this.parseMultiPointText_();break}case"MULTILINESTRING":{r=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{r=this.parseMultiPolygonText_();break}}return new s(r,this.layout_)}throw new Error(this.formatErrorMessage_())}}class Er extends Fr{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new Sr(t);return new Ir(e).parse()}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e),s=new X;return s.setGeometry(n),s}readFeaturesFromText(t,e){let n=[];const s=this.readGeometryFromText(t,e);this.splitCollection_&&s.getType()=="GeometryCollection"?n=s.getGeometriesArray():n=[s];const r=[];for(let o=0,a=n.length;o<a;++o){const l=new X;l.setGeometry(n[o]),r.push(l)}return r}readGeometryFromText(t,e){const n=this.parse_(t);return ft(n,!1,e)}writeFeatureText(t,e){const n=t.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const n=[];for(let r=0,o=t.length;r<o;++r)n.push(t[r].getGeometry());const s=new Y(n);return this.writeGeometryText(s,e)}writeGeometryText(t,e){return Ui(ft(t,!0,e))}}function Yi(i){const t=i.getCoordinates();return t.length===0?"":t.join(" ")}function br(i){const t=[],e=i.getPoints();for(let n=0,s=e.length;n<s;++n)t.push("("+Yi(e[n])+")");return t.join(",")}function Rr(i){const t=[],e=i.getGeometries();for(let n=0,s=e.length;n<s;++n)t.push(Ui(e[n]));return t.join(",")}function Ee(i){const t=i.getCoordinates(),e=[];for(let n=0,s=t.length;n<s;++n)e.push(t[n].join(" "));return e.join(",")}function Nr(i){const t=[],e=i.getLineStrings();for(let n=0,s=e.length;n<s;++n)t.push("("+Ee(e[n])+")");return t.join(",")}function Bi(i){const t=[],e=i.getLinearRings();for(let n=0,s=e.length;n<s;++n)t.push("("+Ee(e[n])+")");return t.join(",")}function Tr(i){const t=[],e=i.getPolygons();for(let n=0,s=e.length;n<s;++n)t.push("("+Bi(e[n])+")");return t.join(",")}function xr(i){const t=i.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=$i),(t==="XYM"||t==="XYZM")&&(e+=Xi),e}const Ar={Point:Yi,LineString:Ee,Polygon:Bi,MultiPoint:br,MultiLineString:Nr,MultiPolygon:Tr,GeometryCollection:Rr};function Ui(i){const t=i.getType(),e=Ar[t],n=e(i);let s=Gr[t];if(typeof i.getFlatCoordinates=="function"){const r=xr(i);r.length>0&&(s+=" "+r)}return n.length===0?s+" "+ji:s+"("+n+")"}const Or=(i,t)=>new Er().writeFeatures(i,t);var pt,yt;class Ji extends oe{constructor(){super();T(this,pt,!0);T(this,yt,!0);this.multipleFeatures=!1,this.drawnFeatures=[],this.importFeatures=!1,this.showEditor=!1,this.currentlyDrawing=!1,this.drawFunc=null,this.geoJSON="",this.type="Polygon",this.unstyled=!1,this.select=!1}updateButtonStates(){const{drawDisabled:e,discardDisabled:n}=Hn(this);b(this,pt,e),b(this,yt,n)}createRenderRoot(){return this}render(){this.updateButtonStates();const e=this.currentlyDrawing?"drawing":"draw",n={Polygon:M`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <title>shape-polygon-plus</title>
        <path
          d="M17,15.7V13H19V17L10,21L3,14L7,5H11V7H8.3L5.4,13.6L10.4,18.6L17,15.7M22,5V7H19V10H17V7H14V5H17V2H19V5H22Z"
        />
      </svg>`,Point:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>vector-point-plus</title>
          <path
            d="M9 9V15H15V9H9M11 11H13V13H11V11M18 15V18H15V20H18V23H20V20H23V18H20V15H18Z"
          />
        </svg>
      `,Circle:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>shape-circle-plus</title>
          <path
            d="M11,19A6,6 0 0,0 17,13H19A8,8 0 0,1 11,21A8,8 0 0,1 3,13A8,8 0 0,1 11,5V7A6,6 0 0,0 5,13A6,6 0 0,0 11,19M19,5H22V7H19V10H17V7H14V5H17V2H19V5Z"
          />
        </svg>
      `,LineString:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>vector-polyline-plus</title>
          <path
            d="M2 3V9H4.95L6.95 15H6V21H12V16.41L17.41 11H22V5H16V9.57L10.59 15H9.06L7.06 9H8V3H2M4 5H6V7H4V5M18 7H20V9H18V7M18 15V18H15V20H18V23H20V20H23V18H20V15H18M8 17H10V19H8V17Z"
          />
        </svg>
      `,Box:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>shape-rectangle-plus</title>
          <path
            d="M19,6H22V8H19V11H17V8H14V6H17V3H19V6M17,17V14H19V19H3V6H11V8H5V17H17Z"
          />
        </svg>
      `},s=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>cursor-default-click</title>
      <path
        d="M10.76,8.69A0.76,0.76 0 0,0 10,9.45V20.9C10,21.32 10.34,21.66 10.76,21.66C10.95,21.66 11.11,21.6 11.24,21.5L13.15,19.95L14.81,23.57C14.94,23.84 15.21,24 15.5,24C15.61,24 15.72,24 15.83,23.92L18.59,22.64C18.97,22.46 19.15,22 18.95,21.63L17.28,18L19.69,17.55C19.85,17.5 20,17.43 20.12,17.29C20.39,16.97 20.35,16.5 20,16.21L11.26,8.86L11.25,8.87C11.12,8.76 10.95,8.69 10.76,8.69M15,10V8H20V10H15M13.83,4.76L16.66,1.93L18.07,3.34L15.24,6.17L13.83,4.76M10,0H12V5H10V0M3.93,14.66L6.76,11.83L8.17,13.24L5.34,16.07L3.93,14.66M3.93,3.34L5.34,1.93L8.17,4.76L6.76,6.17L3.93,3.34M7,10H2V8H7V10"
      />
    </svg>`,r=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>trash-can-outline</title>
      <path
        d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
      />
    </svg>`,o=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>pencil-outline</title>
      <path
        d="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"
      />
    </svg>`,a=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>import</title>
      <path
        d="M14,12L10,8V11H2V13H10V16M20,18V6C20,4.89 19.1,4 18,4H6A2,2 0 0,0 4,6V9H6V6H18V18H6V15H4V18A2,2 0 0,0 6,20H18A2,2 0 0,0 20,18Z"
      />
    </svg>`,l=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>content-copy</title>
      <path
        d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
      />
    </svg>`;return M`
      <nav>
        <slot></slot>
        <div class="max">
          <!-- Draw Button -->
          <button
            data-cy="drawBtn"
            class="transparent square primary-text no-margin small"
            title="${this.unstyled?this.select?"Select":"Draw":""}"
            ?disabled="${I(this,pt)||ht}"
            @click="${()=>this.drawFunc.start()}"
          >
            ${this.unstyled?e:M`
                  <i class="small"
                    >${this.select?s:n[this.type]}</i
                  >
                  <div class="tooltip bottom">
                    ${this.select?"Select":"Draw"}
                  </div>
                `}
          </button>

          <!-- Discard Button -->
          <button
            data-cy="discardBtn"
            class="transparent square error-text no-margin small"
            title="${this.unstyled?"Discard":""}"
            ?disabled="${I(this,yt)||ht}"
            @click="${()=>this.drawFunc.discard()}"
          >
            ${this.unstyled?"discard":M`
                  <i class="small">${r}</i>
                  <div class="tooltip bottom">Discard</div>
                `}
          </button>
        </div>

        <!-- Editor Button -->
        ${Yt(this.showEditor,()=>M`
            <button
              data-cy="editorBtn"
              class="transparent circle primary-text no-margin small"
              title="${this.unstyled?"Edit features":""}"
              @click=${()=>this.renderRoot.querySelector("#editor").classList.toggle("hidden")}
            >
              ${this.unstyled?"import":M`
                    <i class="small">${o}</i>
                    <div class="tooltip bottom">Edit features</div>
                  `}
            </button>
          `)}

        <!-- Import Button -->
        ${Yt(this.importFeatures,()=>M`
            <!-- Import Input Field : Hidden -->
            <input
              type="file"
              id="import-file"
              style="display: none;"
              @change=${this.drawFunc.import}
            />

            <!-- Main Import Button -->
            <button
              data-cy="importBtn"
              class="transparent circle primary-text no-margin small"
              title="${this.unstyled?"Import features":""}"
              @click=${()=>this.querySelector("#import-file").click()}
            >
              ${this.unstyled?"import":M`
                    <i class="small">${a}</i>
                    <div class="tooltip bottom">Import features</div>
                  `}
            </button>
          `)}
      </nav>

      <!-- Geo JSON Wrapper -->
      ${Yt(this.showEditor,()=>M`
          <div id="editor" class="field textarea border extra hidden">
            <!-- Geo JSON Editor -->
            <textarea
              style="font-family: monospace; font-size: small; line-height: 1.4; padding: 0.4rem;"
              @drop=${this.drawFunc.import}
              @input=${this.drawFunc.editor}
              .value=${this.geoJSON}
            ></textarea>

            <!-- Geo JSON Copy Button -->
            <button
              data-cy="copyBtn"
              class="circle absolute bottom right medium-margin aloha"
              style="z-index: 1"
              @click=${()=>Vn(this.geoJSON)}
            >
              ${this.unstyled?"copy":M`
                    <i class="tiny">${l}</i>
                    <div class="tooltip top">Copy</div>
                  `}
            </button>
          </div>
        `)}
    `}}pt=new WeakMap,yt=new WeakMap,k(Ji,"properties",{multipleFeatures:{attribute:!1,type:Boolean},drawnFeatures:{attribute:!1,state:!0,type:Array},currentlyDrawing:{attribute:!1,state:!0,type:Boolean},drawFunc:{attribute:!1,type:Object},select:{type:Boolean},importFeatures:{attribute:"import-features",type:Boolean},showEditor:{attribute:"show-editor",type:Boolean},geoJSON:{attribute:"geo-json",type:String},type:{attribute:"type",type:String},unstyled:{type:Boolean}});customElements.define("eox-drawtools-controller",Ji);Qi();const kr=`
  ${Di}
  :host {
    --padding: 0.5rem;
  }
  .drawtitle {
    padding-left: var(--padding);
    padding-right: var(--padding);
  }
  .hidden {
    display: none;
  }
`,Hr=i=>{(()=>{var e;if(i.emitDrawnFeatures(),!i.multipleFeatures)(e=i.draw)==null||e.setActive(!1),i.selectionEvents.removeSelectionEvent(),i.currentlyDrawing=!1;else if(i.continuous)if(!i.layerId)i.drawLayer.getSource().clear(),i.drawnFeatures=[];else{const s=i.drawLayer.getSource().getFeatures().at(-1);if(i.drawLayer.getSource().clear(),!s)return;i.drawLayer.getSource().addFeature(s),i.drawnFeatures=[s]}})(),i.requestUpdate()},Vr=i=>{const t=()=>{var n;i.drawLayer.set("isDrawingEnabled",!0),(n=i.draw)==null||n.setActive(!0),i.selectionEvents.addSelectionEvent()},e=()=>{i.currentlyDrawing=!0,i.requestUpdate()};t(),e(),document.addEventListener("keydown",({key:n})=>{var s;n==="Escape"&&i.currentlyDrawing&&((s=i.draw)==null||s.setActive(!1),i.currentlyDrawing=!1,i.requestUpdate())})},re=(i,t,e)=>{var l,c,h,u;if(!e||!t)return;const n=t.getLayerById(e),s=n?JSON.parse(JSON.stringify(n.get("_jsonDefinition"))):null;if(!s){console.error(`Layer with id ${e} not found`);return}const r={type:"select",active:!1,options:{id:"SelectLayerHoverInteraction",condition:"pointermove",active:!1,style:((l=i.featureStyles)==null?void 0:l.hover)||{"fill-color":"rgba(0, 0, 0,0.0)","stroke-color":"#3399CC","stroke-width":2.5}}},o={type:"select",options:{id:"SelectLayerClickInteraction",condition:"click",multi:i.multipleFeatures,modify:i.allowModify,active:!1,style:((c=i.featureStyles)==null?void 0:c.click)||{"fill-color":"rgba(0, 0, 0,0.0)","stroke-color":"rgba(0, 0, 0,0.0)"}}};s.interactions=[r,o],t.addOrUpdateLayer(s),qi(t.layers,e,[s]);const a=i.draw;i.draw=t.selectInteractions.SelectLayerClickInteraction,a==null||a.setActive(!1),(h=t.selectInteractions.SelectLayerClickInteraction)==null||h.setActive(!1),(u=t.selectInteractions.SelectLayerHoverInteraction)==null||u.setActive(!1)};function qi(i,t,e){const n=i.findIndex(s=>s.properties.id===t);if(n!==-1)return i.splice(n,1,...e),i;for(const s of i)if(s.type==="Group"){const r=qi(s.layers,t,e);r!=null&&r.length&&(s.layers=r)}return i}const Q=i=>{const t=i.getGeometry();if(!t)return;let e="";if(t.getType()==="Polygon"||t.getType()==="MultiPolygon"){const n=vi(t);n>1e6?e=(n/1e6).toFixed(2)+" km":e=n.toFixed(2)+" m"}else if(t.getType()==="LineString"||t.getType()==="MultiLineString"){const n=wi(t);n>1e3?e=(n/1e3).toFixed(2)+" km":e=n.toFixed(2)+" m"}else if(t.getType()==="Circle"){const n=t.getRadius(),s=Math.PI*Math.pow(n,2);s>1e6?e=(s/1e6).toFixed(2)+" km":e=s.toFixed(2)+" m"}e&&i.get("measure")!==e&&i.set("measure",e)},jr=i=>{const t=i.drawLayer.getSource(),e=n=>{const s=n.feature;s&&(Q(s),s.getGeometry().on("change",()=>Q(s)))};t.on("addfeature",e),t.getFeatures().forEach(n=>{Q(n),n.getGeometry().on("change",()=>Q(n))})},zt=(i,t)=>{var c,h,u,d,g,p;const n=sn(i.for),s=n.map,r="0, 65, 112";i.drawLayer=n.addOrUpdateLayer({zIndex:100,type:"Vector",properties:{id:"drawLayer",layerControlHide:!0,isDrawingEnabled:!1,multipleFeatures:t},source:{type:"Vector"},style:((c=i.featureStyles)==null?void 0:c.layer)||{"fill-color":`rgba(${r}, 0.1)`,"stroke-color":`rgba(${r}, 1)`,"stroke-width":2,"circle-radius":5,"circle-fill-color":`rgba(${r}, 1)`,...i.measure&&{"text-value":["coalesce",["get","measure"],""],"text-fill-color":`rgba(${r}, 1)`,"text-stroke-color":"white","text-stroke-width":3,"text-font":"bold 14px sans-serif","text-overflow":!0}},interactions:[{type:"draw",options:{active:!1,id:"drawInteraction",type:i.type,modify:i.allowModify,stopClick:!0,style:((h=i.featureStyles)==null?void 0:h.layer)||{"fill-color":`rgba(${r}, 0.1)`,"stroke-color":`rgba(${r}, 1)`,"stroke-width":1,"stroke-line-dash":[7,3],"circle-radius":5,"circle-fill-color":`rgba(${r}, 1)`,...i.measure&&{"text-value":["coalesce",["get","measure"],""],"text-fill-color":`rgba(${r}, 1)`,"text-stroke-color":"white","text-stroke-width":3,"text-font":"bold 14px sans-serif","text-overflow":!0}}}},{type:"select",options:{id:"SelectLayerHoverInteraction",condition:"pointermove",style:((u=i.featureStyles)==null?void 0:u.hover)||{"fill-color":`rgba(${r}, 0.2)`,"stroke-color":`rgba(${r}, 1)`,"stroke-width":2},tooltip:!1}},{type:"select",options:{id:"SelectLayerClickInteraction",condition:"click",panIn:!0,style:((d=i.featureStyles)==null?void 0:d.click)||{"fill-color":`rgba(${r}, 0.2)`,"stroke-color":`rgba(${r}, 1)`,"stroke-width":2}}}]}),i.draw=n.interactions.drawInteraction,i.modify=n.interactions.drawInteractionmodify,re(i,n,i.layerId),i.measure&&jr(i);const o=()=>i.onModifyEnd(),a=()=>Hr(i);return(g=i.modify)==null||g.on("modifyend",o),i.measure&&((p=i.draw)==null||p.on("drawstart",f=>{const y=f.feature;Q(y),y.getGeometry().on("change",()=>Q(y))})),n.addEventListener("addfeatures",a),i.drawnFeatures&&i.drawLayer.getSource().addFeatures(i.drawnFeatures),{EoxMap:n,OlMap:s,reset:f=>{var y;!f.eoxMap||!f.drawLayer||(f.drawLayer.getSource().clear(),f.eoxMap.map.removeLayer(f.drawLayer),(y=f.modify)==null||y.un("modifyend",o),f.eoxMap.removeEventListener("addfeatures",a),f.layerId||(f.draw=null),f.modify=null)}}},$r=i=>{const t=()=>{var s;i.drawnFeatures=[],(s=i.draw)==null||s.setActive(!1),!!i.layerId&&i.selectionEvents.removeSelectionEvent(),i.drawLayer.getSource().clear(),i.geoJSON=null},e=()=>{i.emitDrawnFeatures(),i.currentlyDrawing=!1,i.requestUpdate()};t(),e()},Xr=(i,t)=>{setTimeout(()=>{const n=i.drawLayer.getSource().getFeatures(),s=i.eoxMap.projection||"EPSG:3857",r=i.projection;i.drawnFeatures=r?n.map(a=>{a=a.clone();const l=a.getGeometry().transform(s,r);return a.setGeometry(l),a}):n;let o;switch(i.format){case"geojson":o=Mr(i.drawnFeatures);break;case"wkt":o=Or(i.drawnFeatures);break;case"feature":o=i.drawnFeatures;break;default:o=i.drawnFeatures;break}i.updateGeoJSON(),i.requestUpdate(),t(o)},0)},Yr=i=>{const t=s=>{(s==null?void 0:s.detail.id)!=="SelectLayerClickInteraction"||!s.detail.feature||(typeof s.detail.feature.getGeometry().getCoordinates!="function"&&(s.detail.feature=ir(s.detail.feature)),i.drawLayer.getSource().addFeature(s.detail.feature),i.eoxMap.dispatchEvent(new CustomEvent("addfeatures",{detail:s.detail})))};return{addSelectionEvent:()=>{if(i.layerId){const s=i.eoxMap.selectInteractions.SelectLayerHoverInteraction;s==null||s.setActive(!0),i.eoxMap.addEventListener("select",t)}},removeSelectionEvent:()=>{var r;const s=(r=i.eoxMap.selectInteractions)==null?void 0:r.SelectLayerHoverInteraction;s&&(s.selectedFids=[],s==null||s.setActive(!1)),i.eoxMap.removeEventListener("select",t)}}},Br=(i,t,e,n)=>{if(t){if(e){n&&e!==n&&ii(i,t),re(i,t,e);return}if(!e&&n){ii(i,t);return}}};function ii(i,t){t&&(i.discardDrawing(),i.selectionEvents.removeSelectionEvent(),i.draw=t.interactions.drawInteraction,t.selectInteractions.SelectLayerClickInteraction.remove(),t.selectInteractions.SelectLayerHoverInteraction.remove())}function Ur(i,t){function e(r){r.preventDefault(),r.stopPropagation()}function n(r){r.srcElement.style.opacity="0.4"}function s(r){r.srcElement.style.opacity="1"}["dragenter","dragover","dragleave","drop"].forEach(r=>{t.addEventListener(r,e,!1),["dragenter","dragover"].includes(r)?t.addEventListener(r,n,!1):t.addEventListener(r,s,!1)}),t.addEventListener("drop",r=>Ki(r,i),!1)}function Jr(i){i.preventDefault(),i.stopPropagation()}function Ki(i,t){Jr(i);let e;"dataTransfer"in i&&i.dataTransfer?e=i.dataTransfer.files:i.target&&"files"in i.target?e=i.target.files:e=[],Array.from(e).forEach(n=>qr(n,t)),i.target&&"value"in i.target&&(i.target.value="")}function qr(i,t){const e=new FileReader;e.readAsText(i),e.onloadend=function(){typeof e.result=="string"&&t.handleFeatureChange(e.result)}}var tt,et,mt,it,_t;class Kr extends oe{constructor(){super();T(this,tt);T(this,et);T(this,mt);T(this,it);T(this,_t);this.allowModify=!1,this.for="eox-map",this.currentlyDrawing=!1,this.draw=null,this.drawLayer=null,this.layerId="",this.drawnFeatures=[],this.featureName="Feature",this.featureNameKey=null,this.featureStyles=null,this.modify=null,this.multipleFeatures=!1,this.measure=!1,this.importFeatures=!1,this.showEditor=!1,this.showList=!1,this.projection="EPSG:4326",this.type="Polygon",this.selectionEvents=null,this.format="feature",this.unstyled=!1,this.noShadow=!1}static get properties(){return{allowModify:{attribute:"allow-modify",type:Boolean},for:{type:String},currentlyDrawing:{attribute:!1,state:!0,type:Boolean},continuous:{type:Boolean},draw:{attribute:!1,state:!0},drawLayer:{attribute:!1,state:!0},drawnFeatures:{attribute:!1,state:!0,type:Array},featureName:{attribute:"feature-name",type:String},featureNameKey:{attribute:"feature-name-key",type:String},layerId:{attribute:"layer-id",type:String},featureStyles:{attribute:!1},modify:{attribute:!1,state:!0},multipleFeatures:{attribute:"multiple-features",type:Boolean},measure:{type:Boolean},importFeatures:{attribute:"import-features",type:Boolean},showEditor:{attribute:"show-editor",type:Boolean},showList:{attribute:"show-list",type:Boolean},projection:{type:String},noShadow:{attribute:"no-shadow",type:Boolean},format:{type:String},type:{type:String},unstyled:{type:Boolean}}}set continuous(e){b(this,_t,e),e&&(this.multipleFeatures=!0)}get continuous(){return I(this,_t)}set layerId(e){Br(this,this.eoxMap,e,I(this,it)),b(this,it,e)}get layerId(){return I(this,it)}startDrawing(){Vr(this)}discardDrawing(){$r(this)}handleFeatureChange(e,n=!1,s=!0){this.eoxMap.parseTextToFeature(e||JSON.stringify(He),this.drawLayer,this.eoxMap,n,s)}handleFilesChange(e){Ki(e,this)}onModifyEnd(){this.emitDrawnFeatures()}updateGeoJSON(){b(this,mt,JSON.stringify(this.eoxMap.parseFeature(this.drawnFeatures)||He,void 0,2))}emitDrawnFeatures(){Xr(this,n=>{this.dispatchEvent(new CustomEvent("drawupdate",{detail:n}))})}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}firstUpdated(){const{EoxMap:e,OlMap:n,reset:s}=zt(this,this.multipleFeatures);this.resetLayer=s,this.eoxMap=e,b(this,et,n),this.selectionEvents=Yr(this),this.importFeatures&&Ur(this,this.eoxMap),this.updateGeoJSON(),this.requestUpdate()}updated(e){if(e.has("for")){const{EoxMap:n,OlMap:s}=zt(this,this.multipleFeatures);this.eoxMap=n,b(this,et,s)}(e.get("type")&&e.get("type")!==this.type||e.has("measure")&&e.get("measure")!==this.measure)&&(this.resetLayer(this),this.firstUpdated(),this.currentlyDrawing=!1)}get eoxMap(){return I(this,tt)}set eoxMap(e){const n=I(this,tt);b(this,tt,e),this.requestUpdate("eoxMap",n)}connectedCallback(){if(super.connectedCallback(),this.drawLayer&&this.eoxMap){const{reset:e}=zt(this,this.multipleFeatures);this.resetLayer=e}}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.resetLayer)==null||e.call(this,this)}render(){var e;return M`
      <style>
        :host { display: block; }
        ${!this.unstyled&&kr}
      </style>

      <div class="drawtitle">
        <slot name="drawtitle"
          ><p><strong>Draw</strong></p></slot
        >
      </div>

      <!-- Controller Component -->
      <eox-drawtools-controller
        .drawFunc=${{start:()=>this.startDrawing(),discard:()=>this.discardDrawing(),editor:n=>this.handleFeatureChange(n.target.value,!0),import:n=>this.handleFilesChange(n)}}
        ?select=${!!this.layerId}
        .unstyled=${this.unstyled}
        .drawnFeatures=${this.drawnFeatures}
        .currentlyDrawing=${this.currentlyDrawing}
        .multipleFeatures=${this.multipleFeatures}
        .importFeatures=${this.importFeatures}
        .showEditor=${this.showEditor}
        .geoJSON=${I(this,mt)}
        .type=${this.type}
      ></eox-drawtools-controller>

      <!-- List Component -->
      ${this.showList&&((e=this.drawnFeatures)!=null&&e.length)?M`<eox-drawtools-list
            .eoxDrawTools=${this}
            .eoxMap=${this.eoxMap}
            .olMap=${I(this,et)}
            .draw=${this.draw}
            .drawLayer=${this.drawLayer}
            .drawnFeatures=${this.drawnFeatures}
            .featureName=${this.featureName}
            .featureNameKey=${this.featureNameKey}
            .modify=${this.modify}
            .unstyled=${this.unstyled}
            @changed=${()=>{this.updateGeoJSON(),this.requestUpdate()}}
          ></eox-drawtools-list>`:ht}
    `}}tt=new WeakMap,et=new WeakMap,mt=new WeakMap,it=new WeakMap,_t=new WeakMap;customElements.define("eox-drawtools",Kr);const Zr=({selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:s,loading:r,isPolling:o,mapElement:a})=>{const l=gn(pn);ni(async()=>{((a==null?void 0:a.layers.length)??0)>1?await Bt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:s,loading:r,isPolling:o}):l.once(async()=>{await Bt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,loading:r,processResults:s,isPolling:o})})});const c=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";fn(async(h,u)=>{(h=="layertime:updated"||h=="compareLayertime:updated"||h=="time:updated"||h=="compareTime:updated")&&await Mn({jsonformSchema:e.value,newLayers:u}),h===c&&await Bt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:s,loading:r,isPolling:o})})};function Wr(i,t,e,n){const s=async a=>{await n()},r=async()=>{await Nn(()=>{var a;(a=t.value)==null||a.addEventListener("change",s)})},o=()=>{var a;(a=t.value)==null||a.removeEventListener("change",s)};Oe(e,a=>{var l;i.value=((l=a==null?void 0:a.options)==null?void 0:l.execute)||!1}),ni(()=>{Oe(i,async a=>{a?await r():o()},{immediate:!0})})}const zr="eox-jsonform{padding:.7em;min-height:0px}",Qr={ref:"container",class:"py-1"},Dr=[".schema"],to={class:"text-right"},eo={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(i){const t=K(!1),e=K(null),n=En("jsonformEl"),s=Jt(()=>{var v;return(v=h.value)==null?void 0:v.links.filter(_=>_.endpoint==="eoxhub_workspaces").length}),r=K(!1),o=K(!1),a=K(!1),l=K([]),c=Jt(()=>!o.value&&!!e.value&&!!n.value),{selectedStac:h,selectedCompareStac:u}=on(an()),d=i.enableCompare?u:h,g=i.enableCompare?ln:cn,p=i.enableCompare?hn:un,f=i.enableCompare?_n:Cn,y=Jt(()=>{var v;return p.value+((v=g.value)==null?void 0:v.id)});Zr({selectedStac:d,mapElement:g.value,jsonformEl:n,jsonformSchema:e,isProcessed:t,processResults:l,loading:r,isPolling:a});const F=()=>{l.value.forEach(v=>{var L;if(!v)return;let _="";typeof v=="string"?(_=v.includes("/")?v.split("/").pop()??"":v,_=_.includes("?")?_.split("?")[0]:_):_=((L=d.value)==null?void 0:L.id)+"_process_results.json",Gn(_,v)})},w=async()=>{var N,at,lt;const v=Pn(e.value);if(v&&Array.isArray((N=n.value)==null?void 0:N.value[v])&&!((at=n.value)!=null&&at.value[v].length)){t.value=!1;const $t=i.enableCompare?yn:mn;$t.value=null;return}const L=(lt=n.value)==null?void 0:lt.editor.validate();if(L!=null&&L.length){console.warn("[eodash] Form validation failed",L);return}l.value=[],await Fn({jobs:f,selectedStac:d,jsonformEl:n,jsonformSchema:e,loading:r,isPolling:a,processResults:l,mapElement:g.value}),t.value=!0,s.value&&Ln(f,p.value)};return Wr(o,n,e,w),(v,_)=>(ct(),Te("div",Qr,[bn(wn,{"map-element":Mt(g),"enable-compare":i.enableCompare},null,8,["map-element","enable-compare"]),e.value?(ct(),Te("eox-jsonform",{key:y.value,ref_key:"jsonformEl",ref:n,".schema":e.value},null,40,Dr)):vt("v-if",!0),Mt(dn)?vt("v-if",!0):(ct(),Ut(vn,{key:1,"vega-embed-options":i.vegaEmbedOptions,"enable-compare":i.enableCompare},null,8,["vega-embed-options","enable-compare"])),Rn("div",to,[c.value?(ct(),Ut(Ne,{key:0,loading:r.value,style:{"margin-right":"8px"},"append-icon":[Mt(Sn)],onClick:w,density:"comfortable",size:"small"},{default:xe(()=>[..._[0]||(_[0]=[Ae(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):vt("v-if",!0),l.value.length&&t.value&&!s.value?(ct(),Ut(Ne,{key:1,color:"primary",style:{"margin-right":"8px"},"append-icon":[Mt(In)],onClick:F,size:"small",density:"comfortable"},{default:xe(()=>[..._[1]||(_[1]=[Ae(" Download ",-1)])]),_:1},8,["append-icon"])):vt("v-if",!0)])],512))}},Ro=rn(eo,[["styles",[zr]]]);export{Ro as default};
