const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/index.BR2YYGV_.js","assets/chunks/openglobus.CoDWRVzN.js","assets/chunks/og.es.BUTD8K8h.js","assets/chunks/XYZ.khqhGb_1.js","assets/chunks/Polygon.FVLon8Z8.js","assets/chunks/proj.DNHHD1fb.js","assets/chunks/easing.vFiYzKl6.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/lit-element.CBn2YVps.js","assets/chunks/TileWMS.BLW71f-1.js","assets/chunks/Vector.DOS_GgfB.js","assets/chunks/Feature.DClIwY0Z.js","assets/chunks/commonjsHelpers.BosuxZz1.js"])))=>i.map(i=>d[i]);
import{aA as ve,a5 as ye,a2 as H,an as ne,p as A,v as te,o as K,c as Q,j as I,k as t,N as W,e as E,E as xe,h as w,x as de,q as ge}from"./framework.CHiWMs82.js";import"./main.CwJi0d0R.js";import"./index.Bxp3RQoi.js";import{_ as he,aZ as _,U as Ce,af as ae,u as re,an as Pe,b4 as Se,am as we,f as ie,ak as ee,b5 as _e,i as g,k as h,p as C,b6 as Te,n as k,aq as Ne,ar as Y,o as Me,b7 as Oe,b8 as Ie,b9 as ke,F as se,q as oe,as as je,al as Le}from"./eo-dash.Cd4PBJX-.js";import{c as le}from"./create-layers-config-FjlE0XoY.DrQs_rOz.js";import{i as ze}from"./easing-CH0-9wR8.CTB3jml5.js";import Be from"./EodashMapBtns-BuISWFtY.CAVuuKCZ.js";import{t as Ve}from"./openglobus.CoDWRVzN.js";import"./index.Du0sVlOV.js";import"./proj.DNHHD1fb.js";import"./lit-element.CBn2YVps.js";import"./Tile.CxQIIfjm.js";import"./XYZ.khqhGb_1.js";import"./Polygon.FVLon8Z8.js";import"./easing.vFiYzKl6.js";import"./VectorTile.Ded4Rg6b.js";import"./Vector.DOS_GgfB.js";import"./Feature.DClIwY0Z.js";import"./WMTS.DDNw7afE.js";import"./GeoJSON.BIOKqnY_.js";import"./GeometryCollection.DptEXo7b.js";import"./Vector.3nXA5aG4.js";import"./TileWMS.BLW71f-1.js";import"./Draw.BOSGVl0J.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.BN-d4VcA.js";import"./WKT.Cb3FS4Ec.js";import"./GeoZarr.C0Phgg7_.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./mdi.CnJQHbhh.js";import"./ExportState-iPkOJX_F.DEdKMtLU.js";import"./PopUp-DpEUgUw0.0PEMpPOt.js";import"./forwardRefs-XchW0dBb.B63_FlLD.js";import"./transition-VGU9P_OU.DbcSGej2.js";import"./main.9WrCP36n.js";import"./sequential.BT5PQCvq.js";import"./orient2d.DArCjZZA.js";import"./VImg-D32xU4Hb.DoZm_ASN.js";import"./EodashItemFilter-DQsmY_jh.DKYObJjq.js";import"./handling-BcwCaHu0.CWYB7Vtd.js";import"./async-DpdnqdOH.C-MU-FOl.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./mosaic-Cbksi-4M.C9RiDFlw.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.C2DIGSw-.js";import"./index.BUIxO2d3.js";import"./og.es.BUTD8K8h.js";let X=null;const Ae=(e,s)=>{const u=o=>{var m;const r=o.map,c=(m=e.value)==null?void 0:m.lonLatCenter,T=r==null?void 0:r.getView().getZoom();c&&!Number.isNaN(c[0])&&!Number.isNaN(c[1])&&!Number.isNaN(T)&&(s.value=[c[0],c[1],T])};te(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.on("moveend",u)}),de(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.un("moveend",u)})},ce=(e,s,u,o,r,c,T,m)=>{k.debug("InitMap",e.value,s.value,u.values,o.value);const G=ge(m?[s,o,m]:[s,o],async(N,P)=>{var F,f,S,Z,J,U,D,L,$,z,B,a,i,v,l;const[n,M,b]=m?N:[N[0],N[1],null],[j,R,O]=m?P:[P[0],P[1],null];if(n){k.debug("Selected Indicator watch triggered",n,M),((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&X!==null&&((f=e==null?void 0:e.value)==null||f.map.setView(X),X=null);let p=[];const x=(n==null?void 0:n.id)===(j==null?void 0:j.id)&&(M!==R||b&&(b==null?void 0:b.id)!==(O==null?void 0:O.id)),{selectedCompareStac:V}=ae(re());if(((S=e==null?void 0:e.value)==null?void 0:S.id)==="main"?await ke(n):V.value!==null&&(X=((Z=e==null?void 0:e.value)==null?void 0:Z.map.getView())??null,e.value.sync=c.value),x){p=await le(n,u,b??M),k.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(p))),r.value=p,se(((J=e.value)==null?void 0:J.id)==="compare"?"compareTime:updated":"time:updated",e.value,p);return}let y=null;const q=(D=(U=n==null?void 0:n.extent)==null?void 0:U.temporal)==null?void 0:D.interval;if(q&&q.length>0&&q[0].length>1&&(y=new Date(q[0][1]),y.getTime()>Date.now()&&(y=new Date),k.debug("Indicator load: found stac extent, setting time to latest value",y)),(!b&&y!==null&&y.toISOString()!==o.value&&!oe.value||oe.value&&!o.value&&y)&&(o.value=y.toISOString()),p=await le(n,u,b??M),T&&!b&&((L=e==null?void 0:e.value)==null?void 0:L.id)==="main"&&($=n.extent)!=null&&$.spatial.bbox&&!(oe.value&&((z=_.value)!=null&&z[0])&&((B=_.value)!=null&&B[1]))){const be=(a=n.extent)==null?void 0:a.spatial.bbox[0],fe=je([...be]),me=Ve(fe,"EPSG:4326",(v=(i=e.value)==null?void 0:i.map)==null?void 0:v.getView().getProjection());e.value.zoomExtent=me}k.debug("Assigned layers",JSON.parse(JSON.stringify(p))),r.value=p,await se(((l=e.value)==null?void 0:l.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});de(()=>{G()})},ue=(e,s)=>{Ne(async(u,o)=>{if(u.includes("compare"))return;const r=[];for(const c of e)r.push(...await c.getToolTipProperties());s.value=r,k.debug("Updated tooltip properties",s.value)})},Ge="#cursor-coordinates[data-v-b9ba5e8d]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:10px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-b9ba5e8d]{display:none}}#scale-line[data-v-b9ba5e8d]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-b9ba5e8d]{bottom:102px}}[data-v-b9ba5e8d] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-b9ba5e8d] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-b9ba5e8d]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-b9ba5e8d]>*{pointer-events:auto}",Re=[".enabled"],Fe=[".center",".zoom",".layers",".controls"],Ze=[".propertyTransform"],Je=[".layers"],Ue=[".propertyTransform"],De={key:0,id:"cursor-coordinates",ref:"cursor-coords"},$e={key:1,id:"scale-line",ref:"scale-line"};var pe;const qe={__name:"index",props:{initialLayers:{type:Array,default:()=>[{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]},enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,s;return[((e=_.value)==null?void 0:e[0])??15,((s=_.value)==null?void 0:s[1])??48]}},zoom:{type:Number,default:((pe=_.value)==null?void 0:pe[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,enableGlobe:!0,enableMosaic:!0,searchParams:{}})}},async setup(e){var B;let s,u;const o=e,{width:r}=Ce(),c=a=>{if(typeof a=="number")return a;if(typeof a=="string"){const i=a.split("/"),v=r.value;return v<960?parseInt(i[0])||1:v<1920?parseInt(i[1]||i[0])||1:parseInt(i[2]||i[1]||i[0])||1}return 1},T=w(()=>c(o.btnsPosition.x)),m=w(()=>c(o.btnsPosition.y)),d=w(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0,enableGlobe:o.btns.enableGlobe??!0,enableMosaic:o.btns.enableMosaic??!0,searchParams:o.btns.searchParams}));d.value.enableGlobe&&([s,u]=ve(()=>ye(()=>import("./index.BR2YYGV_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),await s,u());const G=H("scale-line"),N=H("cursor-coords"),P=A([]),n=A([]),M=w(()=>{const a={Attribution:{collapsible:!0}};return o.enableScaleLine&&G.value&&(a.ScaleLine={target:G.value}),o.enableCursorCoordinates&&N.value&&(a.MousePosition={projection:"EPSG:4326",coordinateFormat:i=>`${i[1].toFixed(3)} °N, ${i[0].toFixed(3)} °E`,target:N.value}),a}),b=ne(o.center),j=ne(((B=_.value)==null?void 0:B[2])??o.zoom),R=A(o.initialLayers),O=A([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),F={duration:1200,easing:ze},f=H("eoxMap"),S=H("compareMap"),{selectedCompareStac:Z}=ae(re()),J=w(()=>o.enableCompare&&Z.value?"":"first");Ae(f,_),te(()=>{const{selectedCompareStac:a,selectedStac:i,selectedItem:v,selectedCompareItem:l}=ae(re());if(!f.value){console.error("EOxMap reference is not available on mounted.");return}Pe.value=f.value,f.value.reducedGlobeLOD=!0,Se.value+=1,o.enableCompare&&(we.value=S.value),o.enableCompare&&(ce(S,a,Le,ie,O,f,!1,l),ue(ee,n)),ce(f,i,ee,ie,R,S,o.zoomToExtent,v)}),ue(ee,P);const U=w(()=>({visibility:P.value.length||Y.value?"visible":"hidden"})),D=w(()=>({visibility:n.value.length||Y.value?"visible":"hidden"})),L=a=>{const i=a==="main"?P:n,v=a=="main"?Oe:Ie;return l=>{if(Y.value)return Y.value(l,a);const p=JSON.parse(Me.render(JSON.stringify(i.value),{...v.value??{}})),x=p==null?void 0:p.find(V=>V.id===l.key);if(x){if(typeof l.value=="object"&&(l.value=JSON.stringify(l.value)),!isNaN(Number(l.value))){const V=isNaN(Number(x.decimals))?4:Number(x.decimals);l.value=Number(l.value).toFixed(V).toString()}return{key:x.title||x.id,value:l.value+" "+(x.appendix||"")}}}},{mainRect:$}=_e(),z=A(0);return te(()=>{const a=document.querySelector("eo-dash");z.value=($.value.top||(a==null?void 0:a.getBoundingClientRect().top))??0}),(a,i)=>(K(),Q("span",null,[I("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":J.value},[I("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:f,id:"main",".animationOptions":F,".center":t(b),".zoom":t(j),".layers":R.value,".controls":M.value},[I("eox-map-tooltip",{style:W(U.value),".propertyTransform":L("main")},null,44,Ze)],40,Fe),I("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:S,".layers":O.value},[I("eox-map-tooltip",{style:W(D.value),".propertyTransform":L("compare")},null,44,Ue)],40,Je)],40,Re),e.enableCursorCoordinates?(K(),Q("div",De,null,512)):E("v-if",!0),e.enableScaleLine?(K(),Q("span",$e,null,512)):E("v-if",!0),I("div",{class:"map-buttons-container",style:W(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${z.value}px;`)},[E(" prettier-ignore "),xe(Be,{style:W({gridColumn:(t(g)||t(h)||t(C))&&!t(Te)?T.value:"12",gridRow:m.value}),exportMap:t(g)||t(h)||t(C)?d.value.exportMap:!1,changeProjection:t(g)||t(h)||t(C)?d.value.changeProjection:!1,compareIndicators:t(g)||t(h)||t(C)?d.value.compareIndicators:!1,backToPOIs:t(g)||t(h)||t(C)?d.value.backToPOIs:!1,enableSearch:t(g)||t(h)||t(C)?d.value.enableSearch:!1,enableZoom:t(g)||t(h)||t(C)?d.value.enableZoom:!1,enableGlobe:t(g)||t(h)||t(C)?d.value.enableGlobe:!1,searchParams:d.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","enableGlobe","searchParams"])],4)]))}},Uo=he(qe,[["styles",[Ge]],["__scopeId","data-v-b9ba5e8d"]]);export{Uo as default};
