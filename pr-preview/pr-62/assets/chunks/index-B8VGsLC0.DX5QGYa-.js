const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.BifKH8ao.js","assets/chunks/addCommonStyleSheet.DUrvIzFc.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.BUEzJvWR.js","assets/chunks/repeat.BNuh9ekp.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.DnmURua8.js","assets/chunks/unsafe-html.CG9dpyk_.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.CxojoGlr.js"])))=>i.map(i=>d[i]);
import{ay as F,a2 as L,v as h,x,p as M,c as O,o as R,G as P,j as b,w as V,t as k,k as c,a5 as H}from"./framework.C5l8s31R.js";import{_ as K,a as w,am as d,an as p,ao as j,o as T,v as $,ap as N,aq as G,ar as _,as as U}from"./eo-dash.cLWOzis9.js";import{i as D}from"./easing-CH0-9wR8.CTB3jml5.js";import{e as J}from"./mdi.CR6P03lb.js";import q from"./EodashLayoutSwitcher-_dla1UDR.CVddso22.js";import{u as z}from"./mosaic-vSxR4Cwd.lR9syK-M.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./VTooltip-CklgwkwQ.ssq3RyOW.js";import"./forwardRefs-3xpsjrxZ.B2_EY9dS.js";import"./transition-DniF_5gX.uMASfv0C.js";const Y=a=>i=>{let r="";return a.forEach(t=>{const s=t.property;if(!t.icon&&!t.unitLabel||!i.properties[s])return;t.icon&&(r+=t.icon);let e=i.properties[s];typeof e=="number"&&!Number.isInteger(e)&&(e=e.toFixed(1)),r+=e,t.unitLabel&&(r+=t.unitLabel)}),r},Z=a=>{var s;const r=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((s=w().stac)==null?void 0:s.map(e=>e.id))||[],...T.value&&{state:{[T.value]:!0}}}],t=a.map(e=>{const o=`properties.${e.property}`;return e.type==="range"?{key:o,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:o,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:o,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...r,...t]},Q=(a,i)=>{const r=[];return i.forEach(t=>{const s=`properties.${t.property}`,e=a[s];if(e){if(t.type==="range"&&e.state){const{min:o,max:l}=e.state;o!==void 0&&o>(t.min||0)&&r.push(`${t.property}>=${o}`),l!==void 0&&l<(t.max||100)&&r.push(`${t.property}<=${l}`)}else if(t.type==="multiselect"&&e.stringifiedState){const o=e.stringifiedState;o.length>0&&r.push(`${t.property} IN (${o})`)}else if(t.type==="select"&&e.stringifiedState){const o=e.stringifiedState;o&&r.push(`${t.property}='${o}'`)}}}),r.join(" AND ")},W=(a,i,r)=>{var o,l;const t=w(),s=new URLSearchParams;(o=a.collection)!=null&&o.stringifiedState&&s.append("collections",a.collection.stringifiedState.replaceAll(" ","")),(l=p.value)!=null&&l.lonLatExtent&&r&&s.append("bbox",U([...p.value.lonLatExtent]).join(","));const e=Q(a,i);return e&&s.append("filter",e),s.append("limit","100"),`${t.stacEndpoint}/search?${s.toString()}`},X=(a,i,r)=>{let t=new AbortController;return(s,e)=>({url:W(e,a,i),fetchFn:async o=>{t.abort(),t=new AbortController;const l=t.signal;return await $.get(o,{signal:l}).then(n=>n.data.features).catch(n=>n.name==="AbortError"||n.name==="CanceledError"?r.value:(console.error(n),[]))}})},ee=(a,i)=>r=>{a.value=r.detail.results,S(a.value,i)},B=(a,i,r)=>async t=>{var e,o,l,n;const s=t.detail;s&&(i?((e=a.selectedCompareStac)==null?void 0:e.id)===s.collection?a.selectedCompareItem=s:await a.loadSelectedCompareSTAC(s.collection,!1,s):((o=a.selectedStac)==null?void 0:o.id)===s.collection?a.selectedItem=s:await a.loadSelectedSTAC(s.collection,!1,s),N.showButton=!0,(n=(l=r.value)==null?void 0:l.selectInteractions["stac-items"])==null||n.highlightById([s.id],{padding:[100,100,100,100],duration:1200,easing:D}))},te=a=>i=>{var r,t;(t=(r=a.value)==null?void 0:r.selectInteractions["stac-items"])==null||t.highlightById([i.detail.id])},re=a=>()=>{var i,r;(r=(i=a.value)==null?void 0:i.selectInteractions["stac-items"])==null||r.highlightById([])};function S(a,i){var o;const r=i.value;let t=(o=r==null?void 0:r.layers)==null?void 0:o.find(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="AnalysisGroup"});if(!r||!a)return;t||(t={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},r.layers=[...r.layers,t]);const s={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:a})),format:"GeoJSON",projection:"EPSG:3857"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-item-hover",condition:"pointermove",tooltip:!0,style:{"stroke-color":"white","stroke-width":3}}},{type:"select",options:{id:"stac-items",condition:"click",tooltip:!1,style:{"stroke-color":"white","stroke-width":3}}}]};if(t.layers.some(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="stac-items"})){r.addOrUpdateLayer(s);return}else t.layers.unshift(s),r.layers=[...r.layers]}const oe=(a,i,r)=>{if(!i)return;let t;const s=()=>{clearTimeout(t),t=setTimeout(()=>{var e,o;((e=r.value)==null?void 0:e.projection)!="globe"&&((o=a.value)==null||o.search())},500)};h(()=>{var e;(e=r.value)==null||e.map.on("moveend",s)}),x(()=>{var e;(e=r.value)==null||e.map.un("moveend",s)})},ae=(a,i)=>{h(()=>{S(a.value,i)}),G(()=>{S(a.value,i)})};function se(a,i,r){const t=s=>{var l,n,m;if(s.detail.originalEvent.type!=="pointermove")return;const e=(n=(l=s.detail)==null?void 0:l.feature)==null?void 0:n.getId();if(!e)return;const o=(m=a.value.results)==null?void 0:m.find(f=>f.id===e);o&&(a.value.selectedResult=o)};h(()=>{var s;(s=i.value)==null||s.addEventListener("select",t),_.value=({key:e,value:o})=>{if(r&&r.includes(e))return{key:e,value:o}}}),x(()=>{var s;(s=i.value)==null||s.removeEventListener("select",t),_.value=null})}function ie(a,i,r,t){const s=B(i,t,r),e=o=>{var m,f,g;if(o.detail.originalEvent.type!=="click")return;const l=(f=(m=o.detail)==null?void 0:m.feature)==null?void 0:f.getId();if(!l)return;const n=(g=a.value.results)==null?void 0:g.find(v=>(v==null?void 0:v.id)===l);n&&s(new CustomEvent("select",{detail:n}))};h(()=>{var o;(o=r.value)==null||o.addEventListener("select",e)}),x(()=>{var o;(o=r.value)==null||o.removeEventListener("select",e)})}const le=".item-catalog-container[data-v-5b796994]{overflow:hidden}.itemfilter-scroll[data-v-5b796994]{flex:1;min-height:0;overflow:hidden;padding:.5rem;--eox-itemfilter-results-color: var(--v-theme-primary) !important}.title[data-v-5b796994]{padding:1em;margin:.2em;flex-shrink:0}",ne=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],ce={slot:"filterstitle",style:{margin:"14px 8px"}},ue={slot:"resultstitle",style:{margin:"14px 8px"}},pe={__name:"index",props:{title:{type:String,default:"Explore Catalog"},hoverProperties:{type:Array,default:()=>["datetime","eo:cloud_cover"]},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:J},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]},useMosaic:{type:Boolean,default:!1},enableCompare:{type:Boolean,default:!1}},async setup(a){let i,r;customElements.get("eox-itemfilter")||([i,r]=F(()=>H(()=>import("./main.BifKH8ao.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await i,r());const t=a,s=L("root"),e=L("itemfilter");h(async()=>{}),x(()=>{o.selectedItem=null});const o=w();t.useMosaic&&o.mosaicEndpoint&&z(o.mosaicEndpoint,{},o);const l=M([]);o.stacEndpoint&&([i,r]=F(()=>$.get(o.stacEndpoint+"/search?limit=100").then(E=>l.value=E.data.features)),await i,r());const n=l.value,m=Z(t.filters),f=Y(t.filters),g=X(t.filters,t.bboxFilter,l),v=ee(l,t.enableCompare?d:p),C=B(o,t.enableCompare,t.enableCompare?d:p);ae(l,t.enableCompare?d:p),oe(e,t.bboxFilter,t.enableCompare?d:p),ie(e,o,t.enableCompare?d:p,t.enableCompare),se(e,t.enableCompare?d:p,t.hoverProperties);const I=te(t.enableCompare?d:p),A=re(t.enableCompare?d:p);return(E,u)=>(R(),O("div",{ref_key:"root",ref:s,class:"d-flex flex-column item-catalog-container"},[P(j,{class:"title align-center justify-space-between flex-shrink-0"},{default:V(()=>[u[4]||(u[4]=b("h4",null,"Catalog Items",-1)),P(q,{target:a.layoutTarget,icon:a.layoutIcon},null,8,["target","icon"])]),_:1}),b("eox-itemfilter",{class:"itemfilter-scroll",ref:"itemfilter",titleProperty:"id",".imageProperty":a.imageProperty,".subTitleProperty":c(f),".filterProperties":c(m),".items":c(n),onSelect:u[0]||(u[0]=(...y)=>c(C)&&c(C)(...y)),onFilter:u[1]||(u[1]=(...y)=>c(v)&&c(v)(...y)),"onMouseenter:result":u[2]||(u[2]=(...y)=>c(I)&&c(I)(...y)),"onMouseleave:result":u[3]||(u[3]=(...y)=>c(A)&&c(A)(...y)),externalFilter:c(g)},[b("h4",ce,k(a.filtersTitle),1),b("h4",ue,k(a.resultsTitle),1)],40,ne)],512))}},Ce=K(pe,[["styles",[le]],["__scopeId","data-v-5b796994"]]);export{Ce as default};
