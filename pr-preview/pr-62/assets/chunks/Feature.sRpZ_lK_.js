import{w as b,u as j,l as H,E as $,s as B,x as W,S as F,t as u,y as J,z as Q,A as V,C as N,D,H as tt,I as T,J as et,K as st,L as it,M as O,N as nt,q as rt,e as v,Q as ot,R as at,U as ht,W as lt,o as L,X as dt,Y as q,i as gt,Z as ft,P as x,_ as ut,n as ct,$ as _t,a0 as K,c as yt,a1 as Ct,a2 as pt,a3 as mt,a4 as Pt}from"./Polygon.DHQbtAHt.js";import{R as k,h as Mt,S as z,c as G,u as Ft,T as Gt,U as Et,d as Rt,g as At,I as X}from"./proj.DZpM1HQc.js";function U(r,t,e,s){let i=r[t],n=r[t+1],o=0;for(let a=t+s;a<e;a+=s){const h=r[a],l=r[a+1];o+=Math.sqrt((h-i)*(h-i)+(l-n)*(l-n)),i=h,n=l}return o}class I extends b{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new I(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const s=this.getStyle();return s&&t.setStyle(s),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(j(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=H(t,$.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?vt(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function vt(r){if(typeof r=="function")return r;let t;return Array.isArray(r)?t=r:(B(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[r]),function(){return t}}function Z(r,t,e,s){const i=[];let n=Mt();for(let o=0,a=e.length;o<a;++o){const h=e[o];n=k(r,t,h[0],s),i.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=h[h.length-1]}return i}function m(r,t,e,s,i,n,o){let a,h;const l=(e-t)/s;if(l===1)a=t;else if(l===2)a=t,h=i;else if(l!==0){let d=r[t],f=r[t+1],g=0;const c=[0];for(let p=t+s;p<e;p+=s){const R=r[p],A=r[p+1];g+=Math.sqrt((R-d)*(R-d)+(A-f)*(A-f)),c.push(g),d=R,f=A}const S=i*g,_=W(c,S);_<0?(h=(S-c[-_-2])/(c[-_-1]-c[-_-2]),a=t+(-_-2)*s):a=t+_*s}o=o>1?o:2,n=n||new Array(o);for(let d=0;d<o;++d)n[d]=a===void 0?NaN:h===void 0?r[a+d]:z(r[a+d],r[a+s+d],h);return n}function w(r,t,e,s,i,n){if(e==t)return null;let o;if(i<r[t+s-1])return n?(o=r.slice(t,t+s),o[s-1]=i,o):null;if(r[e-1]<i)return n?(o=r.slice(e-s,e),o[s-1]=i,o):null;if(i==r[t+s-1])return r.slice(t,t+s);let a=t/s,h=e/s;for(;a<h;){const g=a+h>>1;i<r[(g+1)*s-1]?h=g:a=g+1}const l=r[a*s-1];if(i==l)return r.slice((a-1)*s,(a-1)*s+s);const d=r[(a+1)*s-1],f=(i-l)/(d-l);o=[];for(let g=0;g<s-1;++g)o.push(z(r[(a-1)*s+g],r[a*s+g],f));return o.push(i),o}function xt(r,t,e,s,i,n,o){if(o)return w(r,t,e[e.length-1],s,i,n);let a;if(i<r[s-1])return n?(a=r.slice(0,s),a[s-1]=i,a):null;if(r[r.length-1]<i)return n?(a=r.slice(r.length-s),a[s-1]=i,a):null;for(let h=0,l=e.length;h<l;++h){const d=e[h];if(t!=d){if(i<r[t+s-1])return null;if(i<=r[d-1])return w(r,t,d,s,i,!1);t=d}}return null}class y extends F{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){u(this.flatCoordinates,t),this.changed()}clone(){const t=new y(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<G(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(J(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Q(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,s,i))}forEachSegment(t){return V(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,w(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return N(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return m(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return U(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=D(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new y(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return tt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=T(this.flatCoordinates,0,t,this.stride),this.changed()}}class P extends F{constructor(t,e,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&s)this.setFlatCoordinates(e,t),this.ends_=s;else{const i=t,n=[],o=[];for(let h=0,l=i.length;h<l;++h){const d=i[h];u(n,d.getFlatCoordinates()),o.push(n.length)}const a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,n),this.ends_=o}}appendLineString(t){u(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new P(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<G(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(et(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),st(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,s,i))}getCoordinateAtM(t,e,s){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,s=s!==void 0?s:!1,xt(this.flatCoordinates,0,this.ends_,this.stride,t,e,s))}getCoordinates(){return it(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new y(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,s=this.layout,i=[];let n=0;for(let o=0,a=e.length;o<a;++o){const h=e[o],l=new y(t.slice(n,h),s);i.push(l),n=h}return i}getLength(){const t=this.ends_;let e=0,s=0;for(let i=0,n=t.length;i<n;++i)s+=U(this.flatCoordinates,e,t[i],this.stride),e=t[i];return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let s=0;const i=this.ends_,n=this.stride;for(let o=0,a=i.length;o<a;++o){const h=i[o],l=m(e,s,h,n,.5);u(t,l),s=h}return t}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=O(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,s),new P(e,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(t){return nt(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=rt(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}class E extends F{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){u(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new E(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){if(i<G(this.getExtent(),t,e))return i;const n=this.flatCoordinates,o=this.stride;for(let a=0,h=n.length;a<h;a+=o){const l=Ft(t,e,n[a],n[a+1]);if(l<i){i=l;for(let d=0;d<o;++d)s[d]=n[a+d];s.length=o}}return i}getCoordinates(){return N(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new v(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,s=this.stride,i=[];for(let n=0,o=t.length;n<o;n+=s){const a=new v(t.slice(n,n+s),e);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,s=this.stride;for(let i=0,n=e.length;i<n;i+=s){const o=e[i],a=e[i+1];if(Gt(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=T(this.flatCoordinates,0,t,this.stride),this.changed()}}class M extends F{constructor(t,e,s){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!s&&!Array.isArray(t[0])){const i=t,n=[],o=[];for(let a=0,h=i.length;a<h;++a){const l=i[a],d=n.length,f=l.getEnds();for(let g=0,c=f.length;g<c;++g)f[g]+=d;u(n,l.getFlatCoordinates()),o.push(f)}e=i.length===0?this.getLayout():i[0].getLayout(),t=n,s=o}e!==void 0&&s?(this.setFlatCoordinates(e,t),this.endss_=s):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const s=this.flatCoordinates.length;u(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let i=0,n=e.length;i<n;++i)e[i]+=s}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const s=new M(this.flatCoordinates.slice(),this.layout,e);return s.applyProperties(this),s}closestPointXY(t,e,s,i){return i<G(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ot(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),at(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,s,i))}containsXY(t,e){return ht(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return lt(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),L(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,dt(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Z(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=q(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new E(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;gt(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=L(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=ft(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,s),new M(e,"XY",s)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const s=this.endss_[t].slice(),i=s[s.length-1];if(e!==0)for(let n=0,o=s.length;n<o;++n)s[n]-=e;return new x(this.flatCoordinates.slice(e,i),this.layout,s)}getPolygons(){const t=this.layout,e=this.flatCoordinates,s=this.endss_,i=[];let n=0;for(let o=0,a=s.length;o<a;++o){const h=s[o].slice(),l=h[h.length-1];if(n!==0)for(let f=0,g=h.length;f<g;++f)h[f]-=n;const d=new x(e.slice(n,l),t,h);i.push(d),n=l}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return ut(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const s=ct(this.flatCoordinates,0,t,this.stride,this.endss_);if(s.length===0)this.flatCoordinates.length=0;else{const i=s[s.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}}const Y=mt();class C{constructor(t,e,s,i,n,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s||null,this.properties_=n,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Et(this.flatCoordinates_):k(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Rt(this.getExtent());this.flatInteriorPoints_=_t(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=K(this.flatCoordinates_,this.ends_),e=Z(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=q(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=m(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const s=this.ends_;for(let i=0,n=s.length;i<n;++i){const o=s[i],a=m(t,e,o,2,.5);u(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=At(t);const e=t.getExtent(),s=t.getWorldExtent();if(e&&s){const i=X(s)/X(e);yt(Y,s[0],s[3],i,-i,0,0,0),Ct(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Y,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new C(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=pt((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const s=this.simplifiedGeometry_.getFlatCoordinates();let i;switch(this.type_){case"LineString":s.length=D(s,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,s,0),i=[s.length];break;case"MultiLineString":i=[],s.length=O(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,s,0,i);break;case"Polygon":i=[],s.length=Pt(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),s,0,i);break}return i&&(this.simplifiedGeometry_=new C(this.type_,s,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}C.prototype.getFlatCoordinates=C.prototype.getOrientedFlatCoordinates;function wt(r){const t=r.getType();switch(t){case"Point":return new v(r.getFlatCoordinates());case"MultiPoint":return new E(r.getFlatCoordinates(),"XY");case"LineString":return new y(r.getFlatCoordinates(),"XY");case"MultiLineString":return new P(r.getFlatCoordinates(),"XY",r.getEnds());case"Polygon":const e=r.getFlatCoordinates(),s=r.getEnds(),i=K(e,s);return i.length>1?new M(e,"XY",i):new x(e,"XY",s);default:throw new Error("Invalid geometry type:"+t)}}function Lt(r,t){const e=r.getId(),s=wt(r),i=r.getProperties(),n=new I;return n.setGeometry(s),e!==void 0&&n.setId(e),n.setProperties(i,!0),n}export{I as F,y as L,M,C as R,P as a,E as b,U as l,Lt as t};
