const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/index.DwDclZL9.js","assets/chunks/openglobus.B3Q0nQd-.js","assets/chunks/og.es.BUTD8K8h.js","assets/chunks/XYZ.CeC_mTYy.js","assets/chunks/Polygon.DHQbtAHt.js","assets/chunks/proj.DZpM1HQc.js","assets/chunks/easing.vFiYzKl6.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/lit-element.CBn2YVps.js","assets/chunks/OSM.CvXshCtN.js","assets/chunks/TileWMS.ChapPYOL.js","assets/chunks/Vector.BaIzVGOT.js","assets/chunks/Feature.sRpZ_lK_.js","assets/chunks/commonjsHelpers.BosuxZz1.js"])))=>i.map(i=>d[i]);
import{aC as ye,a5 as xe,a2 as q,an as ne,p as V,v as te,o as X,c as K,j as I,k as t,N as H,e as E,E as ge,h as S,x as de,q as he}from"./framework.-yi2pkQ4.js";import"./main.CBYjgPV0.js";import"./index.CFf9w_f2.js";import{_ as Ce,ba as _,U as Pe,af as ae,u as re,aM as we,bd as Se,aL as _e,f as ie,al as Ne,ak as ee,be as Te,i as x,k as g,p as h,bf as Me,n as k,aP as Oe,aQ as W,o as Ie,bg as ke,bh as Le,bi as je,F as se,q as oe,aR as ze}from"./eo-dash.DckP5olI.js";import{c as le}from"./create-layers-config-CICQTPbF.eMXxmIrp.js";import{i as Be}from"./easing-CH0-9wR8.CTB3jml5.js";import Re from"./EodashMapBtns-B6OaAYKt.C0iGfBn_.js";import{t as Ve}from"./openglobus.B3Q0nQd-.js";import"./index.Du0sVlOV.js";import"./proj.DZpM1HQc.js";import"./lit-element.CBn2YVps.js";import"./Layer.Cn7yGaI1.js";import"./XYZ.CeC_mTYy.js";import"./Polygon.DHQbtAHt.js";import"./easing.vFiYzKl6.js";import"./VectorTile.BMwuRhtb.js";import"./Vector.BaIzVGOT.js";import"./Feature.sRpZ_lK_.js";import"./WMTS.Do6LXecI.js";import"./GeoJSON.Pzw-iBef.js";import"./GeometryCollection.Ds8WzSbl.js";import"./Vector.Bul4CDZb.js";import"./Tile.D7uEB462.js";import"./TileWMS.ChapPYOL.js";import"./OSM.CvXshCtN.js";import"./Draw.Bj0PRX6Z.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.BN-d4VcA.js";import"./WKT.L1yt0tyo.js";import"./GeoZarr.B2S-xcWu.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./mdi.CnJQHbhh.js";import"./ExportState-DP6ND6aX.BB8-tg_F.js";import"./PopUp-CF_NZM1C.CJtqxHzS.js";import"./forwardRefs-BycDBi0f.DclkY7QX.js";import"./transition-C72kFE6R.Cz1a1e7R.js";import"./dialog-transition-BTzMxAZo.DpJkXKwi.js";import"./main.9WrCP36n.js";import"./sequential.BT5PQCvq.js";import"./orient2d.DArCjZZA.js";import"./VImg-DZXcUuVK.1DIzjbVp.js";import"./VDivider-C0DmzOBm.B84-gHMc.js";import"./EodashItemFilter-1z9YtPcJ.CpoWdIGK.js";import"./handling-Dk0tF0Zb.DeJ2D9qa.js";import"./async-pSts-z0t.CIGJSn5p.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./mosaic-BjrHHSap.8oXPpSLm.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.C2DIGSw-.js";import"./index.BUIxO2d3.js";import"./og.es.BUTD8K8h.js";let Y=null;const Ge=(o,s)=>{const d=e=>{var m;const r=e.map,u=(m=o.value)==null?void 0:m.lonLatCenter,N=r==null?void 0:r.getView().getZoom();u&&!Number.isNaN(u[0])&&!Number.isNaN(u[1])&&!Number.isNaN(N)&&(s.value=[u[0],u[1],N])};te(()=>{var e,r;(r=(e=o.value)==null?void 0:e.map)==null||r.on("moveend",d)}),de(()=>{var e,r;(r=(e=o.value)==null?void 0:e.map)==null||r.un("moveend",d)})},ce=(o,s,d,e,r,u,N,m,p)=>{k.debug("InitMap",o.value,s.value,d.values,e.value);const G=he(m?[s,e,m]:[s,e],async(C,P)=>{var b,w,F,Z,J,U,j,D,z,B,a,n,v,l,O;const[i,T,f]=m?C:[C[0],C[1],null],[M,A,L]=m?P:[P[0],P[1],null];if(i){k.debug("Selected Indicator watch triggered",i,T),((b=o==null?void 0:o.value)==null?void 0:b.id)==="main"&&Y!==null&&((w=o==null?void 0:o.value)==null||w.map.setView(Y),Y=null);let c=[];const R=(i==null?void 0:i.id)===(M==null?void 0:M.id)&&(T!==A||f&&(f==null?void 0:f.id)!==(L==null?void 0:L.id)),{selectedCompareStac:fe}=ae(re());if(((F=o==null?void 0:o.value)==null?void 0:F.id)==="main"?await je(i):fe.value!==null&&(Y=((Z=o==null?void 0:o.value)==null?void 0:Z.map.getView())??null,o.value.sync=u.value),R){c=await le(i,d,f??T,p),k.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(c))),r.value=c,se(((J=o.value)==null?void 0:J.id)==="compare"?"compareTime:updated":"time:updated",o.value,c);return}let y=null;const $=(j=(U=i==null?void 0:i.extent)==null?void 0:U.temporal)==null?void 0:j.interval;if($&&$.length>0&&$[0].length>1&&(y=new Date($[0][1]),y.getTime()>Date.now()&&(y=new Date),k.debug("Indicator load: found stac extent, setting time to latest value",y)),(!f&&y!==null&&y.toISOString()!==e.value&&!oe.value||oe.value&&!e.value&&y)&&(e.value=y.toISOString()),c=await le(i,d,f??T,p),N&&!f&&((D=o==null?void 0:o.value)==null?void 0:D.id)==="main"&&(z=i.extent)!=null&&z.spatial.bbox&&!(oe.value&&((B=_.value)!=null&&B[0])&&((a=_.value)!=null&&a[1]))){const be=(n=i.extent)==null?void 0:n.spatial.bbox[0],me=ze([...be]),ve=Ve(me,"EPSG:4326",(l=(v=o.value)==null?void 0:v.map)==null?void 0:l.getView().getProjection());o.value.zoomExtent=ve}k.debug("Assigned layers",JSON.parse(JSON.stringify(c))),r.value=c,await se(((O=o.value)==null?void 0:O.id)==="compare"?"compareLayers:updated":"layers:updated",o.value,r.value)}},{immediate:!0});de(()=>{G()})},ue=(o,s)=>{Oe(async(d,e)=>{if(d.includes("compare"))return;const r=[];for(const u of o)r.push(...await u.getToolTipProperties());s.value=r,k.debug("Updated tooltip properties",s.value)})},Ae="#cursor-coordinates[data-v-e64373af]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:10px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-e64373af]{display:none}}#scale-line[data-v-e64373af]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-e64373af]{bottom:102px}}[data-v-e64373af] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-e64373af] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-e64373af]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-e64373af]>*{pointer-events:auto}",Fe=[".enabled"],Ze=[".center",".zoom",".layers",".controls"],Je=[".propertyTransform"],Ue=[".layers"],De=[".propertyTransform"],$e={key:0,id:"cursor-coordinates",ref:"cursor-coords"},qe={key:1,id:"scale-line",ref:"scale-line"};var pe;const He={__name:"index",props:{baseLayers:{type:Array,default:()=>[{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]},enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var o,s;return[((o=_.value)==null?void 0:o[0])??15,((s=_.value)==null?void 0:s[1])??48]}},zoom:{type:Number,default:((pe=_.value)==null?void 0:pe[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,enableGlobe:!0,enableMosaic:!0,searchParams:{}})}},async setup(o){var B;let s,d;const e=o,{width:r}=Pe(),u=a=>{if(typeof a=="number")return a;if(typeof a=="string"){const n=a.split("/"),v=r.value;return v<960?parseInt(n[0])||1:v<1920?parseInt(n[1]||n[0])||1:parseInt(n[2]||n[1]||n[0])||1}return 1},N=S(()=>u(e.btnsPosition.x)),m=S(()=>u(e.btnsPosition.y)),p=S(()=>({exportMap:e.btns.enableExportMap??!0,changeProjection:e.btns.enableChangeProjection??!0,compareIndicators:e.btns.enableCompareIndicators??!0,backToPOIs:e.btns.enableBackToPOIs??!0,enableSearch:e.btns.enableSearch??!0,enableZoom:e.btns.enableZoom??!0,enableGlobe:e.btns.enableGlobe??!0,enableMosaic:e.btns.enableMosaic??!0,searchParams:e.btns.searchParams}));p.value.enableGlobe&&([s,d]=ye(()=>xe(()=>import("./index.DwDclZL9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),await s,d());const Q=q("scale-line"),G=q("cursor-coords"),C=V([]),P=V([]),i=S(()=>{const a={Attribution:{collapsible:!0}};return e.enableScaleLine&&Q.value&&(a.ScaleLine={target:Q.value}),e.enableCursorCoordinates&&G.value&&(a.MousePosition={projection:"EPSG:4326",coordinateFormat:n=>`${n[1].toFixed(3)} °N, ${n[0].toFixed(3)} °E`,target:G.value}),a}),T=ne(e.center),f=ne(((B=_.value)==null?void 0:B[2])??e.zoom),M=V(e.baseLayers),A=V(e.baseLayers),L={duration:1200,easing:Be},b=q("eoxMap"),w=q("compareMap"),{selectedCompareStac:F}=ae(re()),Z=S(()=>e.enableCompare&&F.value?"":"first");Ge(b,_),te(()=>{const{selectedCompareStac:a,selectedStac:n,selectedItem:v,selectedCompareItem:l}=ae(re());if(!b.value){console.error("EOxMap reference is not available on mounted.");return}we.value=b.value,b.value.reducedGlobeLOD=!0,Se.value+=1,e.enableCompare&&(_e.value=w.value),e.enableCompare&&(ce(w,a,Ne,ie,A,b,!1,l,e.baseLayers),ue(ee,P)),ce(b,n,ee,ie,M,w,e.zoomToExtent,v,e.baseLayers)}),ue(ee,C);const J=S(()=>({visibility:C.value.length||W.value?"visible":"hidden"})),U=S(()=>({visibility:P.value.length||W.value?"visible":"hidden"})),j=a=>{const n=a==="main"?C:P,v=a=="main"?ke:Le;return l=>{if(W.value)return W.value(l,a);const O=JSON.parse(Ie.render(JSON.stringify(n.value),{...v.value??{}})),c=O==null?void 0:O.find(R=>R.id===l.key);if(c){if(typeof l.value=="object"&&(l.value=JSON.stringify(l.value)),!isNaN(Number(l.value))){const R=isNaN(Number(c.decimals))?4:Number(c.decimals);l.value=Number(l.value).toFixed(R).toString()}return{key:c.title||c.id,value:l.value+" "+(c.appendix||"")}}}},{mainRect:D}=Te(),z=V(0);return te(()=>{const a=document.querySelector("eo-dash");z.value=(D.value.top||(a==null?void 0:a.getBoundingClientRect().top))??0}),(a,n)=>(X(),K("span",null,[I("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":Z.value},[I("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:b,id:"main",".animationOptions":L,".center":t(T),".zoom":t(f),".layers":M.value,".controls":i.value},[I("eox-map-tooltip",{style:H(J.value),".propertyTransform":j("main")},null,44,Je)],40,Ze),I("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:w,".layers":A.value},[I("eox-map-tooltip",{style:H(U.value),".propertyTransform":j("compare")},null,44,De)],40,Ue)],40,Fe),o.enableCursorCoordinates?(X(),K("div",$e,null,512)):E("v-if",!0),o.enableScaleLine?(X(),K("span",qe,null,512)):E("v-if",!0),I("div",{class:"map-buttons-container",style:H(`margin: ${o.btnsPosition.gap}px 0 ${o.btnsPosition.gap}px 0; top: ${z.value}px;`)},[E(" prettier-ignore "),ge(Re,{style:H({gridColumn:(t(x)||t(g)||t(h))&&!t(Me)?N.value:"12",gridRow:m.value}),exportMap:t(x)||t(g)||t(h)?p.value.exportMap:!1,changeProjection:t(x)||t(g)||t(h)?p.value.changeProjection:!1,compareIndicators:t(x)||t(g)||t(h)?p.value.compareIndicators:!1,backToPOIs:t(x)||t(g)||t(h)?p.value.backToPOIs:!1,enableSearch:t(x)||t(g)||t(h)?p.value.enableSearch:!1,enableZoom:t(x)||t(g)||t(h)?p.value.enableZoom:!1,enableGlobe:t(x)||t(g)||t(h)?p.value.enableGlobe:!1,searchParams:p.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","enableGlobe","searchParams"])],4)]))}},Wo=Ce(He,[["styles",[Ae]],["__scopeId","data-v-e64373af"]]);export{Wo as default};
