import{Globe as Q,LonLat as R,Vec3 as $,OpenStreetMap as X,XYZ as K,WMS as J,Vector as W,Entity as Y,CanvasTiles as M}from"./og.es.BUTD8K8h.js";import{L as N,b as ee,c as te,d as re,r as T,M as A,e as x,f as ne,X as se,g as ie,n as oe,h as le}from"./XYZ.khqhGb_1.js";import"./index.Du0sVlOV.js";import{B as ae,t as ce,g as F,w as O}from"./proj.DNHHD1fb.js";import{a as ue,A as fe,b as k}from"./lit-element.CBn2YVps.js";import{O as ge,T as de}from"./TileWMS.BLW71f-1.js";import{V as he}from"./Vector.DOS_GgfB.js";import{g as ye}from"./commonjsHelpers.BosuxZz1.js";import{E as pe,u as me,l as be}from"./Polygon.FVLon8Z8.js";function P(e,t,r=void 0){return r||(r="EPSG:4326"),ae(e,t,r)}function We(e,t,r=void 0){return r||(r="EPSG:4326"),ce(e,t,r)}class _e extends ue{static get properties(){return{feature:{attribute:!1,property:!0,type:Object},propertyTransform:{attribute:!1,property:!0,type:Function}}}constructor(){super(),this.feature=null,this.propertyTransform=(t,r)=>t}render(){return this.feature?k` <style>
            ul {
              margin: 0;
              padding: 1rem 1rem 1rem 2rem;
              border-radius: 0.5rem;
              max-width: 250px;
              font-size: small;
              background-color: var(--inverse-surface);
              color: var(--inverse-on-surface);
              box-shadow: 0 0.25rem 0.5rem 0 rgb(0 0 0 / 0.4);
              line-height: normal;
              white-space: normal;
            }
            span {
              font-weight: bold;
            }
          </style>
          <ul>
            ${Object.entries(this.feature.getProperties()).map(([t,r])=>this.propertyTransform({key:t,value:r},this.feature)).filter(t=>t).map(({key:t,value:r})=>k`<li><span>${t}</span>: ${r}</li>`)}
          </ul>`:fe}}customElements.get("eox-map-tooltip")||customElements.define("eox-map-tooltip",_e);var z=16,S=Ae(),Se=new RegExp('(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-'+S+'-(\\d+)__@"',"g"),Ee=/\{\s*\[native code\]\s*\}/g,Ce=/function.*?\(/,ve=/.*?=>.*?/,we=/[<>\/\u2028\u2029]/g,Fe=/<\/script[^>]*>/gi,Le=["*","async"],Re={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function Ne(e){return Re[e]}function Te(e){return e=e.replace(Fe,function(t){return t.replace(/</g,"\\u003C").replace(/\//g,"\\u002F").replace(/>/g,"\\u003E")}),e=e.replace(/\u2028/g,"\\u2028"),e=e.replace(/\u2029/g,"\\u2029"),e}function Ae(){for(var e=crypto.getRandomValues(new Uint8Array(z)),t="",r=0;r<z;++r)t+=e[r].toString(16);return t}function xe(e){var t=[];for(var r in e)typeof e[r]=="function"&&t.push(r);for(var n=0;n<t.length;n++)delete e[t[n]]}var Oe=function e(t,r){r||(r={}),(typeof r=="number"||typeof r=="string")&&(r={space:r});var n=[],s=[],o=[],a=[],c=[],u=[],f=[],l=[],d=[],h=[];function p(m,y){if(r.ignoreFunction&&xe(y),!y&&y!==void 0&&y!==BigInt(0))return y;var i=this[m],g=typeof i;if(g==="object"){if(i instanceof RegExp)return"@__R-"+S+"-"+(s.push(i)-1)+"__@";if(i instanceof Date)return"@__D-"+S+"-"+(o.push(i)-1)+"__@";if(i instanceof Map)return"@__M-"+S+"-"+(a.push(i)-1)+"__@";if(i instanceof Set)return"@__S-"+S+"-"+(c.push(i)-1)+"__@";if(i instanceof Array){var _=i.filter(function(){return!0}).length!==i.length;if(_)return"@__A-"+S+"-"+(u.push(i)-1)+"__@"}if(i instanceof URL)return"@__L-"+S+"-"+(h.push(i)-1)+"__@"}return g==="function"?"@__F-"+S+"-"+(n.push(i)-1)+"__@":g==="undefined"?"@__U-"+S+"-"+(f.push(i)-1)+"__@":g==="number"&&!isNaN(i)&&!isFinite(i)?"@__I-"+S+"-"+(l.push(i)-1)+"__@":g==="bigint"?"@__B-"+S+"-"+(d.push(i)-1)+"__@":y}function E(m,y){var i=m.toString();if(Ee.test(i))throw new TypeError("Serializing native function: "+m.name);if(y&&y.unsafe!==!0&&(i=Te(i)),Ce.test(i)||ve.test(i))return i;var g=i.indexOf("("),_=i.substr(0,g).trim().split(" ").filter(function(w){return w.length>0}),v=_.filter(function(w){return Le.indexOf(w)===-1});return v.length>0?(_.indexOf("async")>-1?"async ":"")+"function"+(_.join("").indexOf("*")>-1?"*":"")+i.substr(g):i}if(r.ignoreFunction&&typeof t=="function"&&(t=void 0),t===void 0)return String(t);var b;return r.isJSON&&!r.space?b=JSON.stringify(t):b=JSON.stringify(t,r.isJSON?null:p,r.space),typeof b!="string"?String(b):(r.unsafe!==!0&&(b=b.replace(we,Ne)),n.length===0&&s.length===0&&o.length===0&&a.length===0&&c.length===0&&u.length===0&&f.length===0&&l.length===0&&d.length===0&&h.length===0?b:b.replace(Se,function(m,y,i,g){if(y)return m;if(i==="D")return'new Date("'+o[g].toISOString()+'")';if(i==="R")return"new RegExp("+e(s[g].source)+', "'+s[g].flags+'")';if(i==="M")return"new Map("+e(Array.from(a[g].entries()),r)+")";if(i==="S")return"new Set("+e(Array.from(c[g].values()),r)+")";if(i==="A")return"Array.prototype.slice.call("+e(Object.assign({length:u[g].length},u[g]),r)+")";if(i==="U")return"undefined";if(i==="I")return l[g];if(i==="B")return'BigInt("'+d[g]+'")';if(i==="L")return"new URL("+e(h[g].toString(),r)+")";var _=n[g];return E(_,r)}))};const Ye=ye(Oe);function ke(e,t){return U(e.map.getLayers().getArray()).find(n=>n.get("id")===t)}function U(e){const t=[];t.push(...e);let r=t.filter(n=>n instanceof N);for(;r.length;){const n=[];for(let s=0;s<r.length;s++){const o=r[s].getLayers().getArray();t.push(...o),n.push(...o.filter(a=>a instanceof N))}r=n}return t}const G=["fullscreenchange","webkitfullscreenchange"],q={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class B extends ee{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const r=t.label!==void 0?t.label:"⤢";this.labelNode_=typeof r=="string"?document.createTextNode(r):r;const n=t.labelActive!==void 0?t.labelActive:"×";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const s=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(pe.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${te} ${re}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const r=t.getOwnerDocument();if(V(r))if(I(r))Ge(r);else{let n;this.source_?n=typeof this.source_=="string"?r.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?ze(n):D(n)}}handleFullScreenChange_(){const t=this.getMap();if(!t)return;const r=this.isInFullscreen_;this.isInFullscreen_=I(t.getOwnerDocument()),r!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(T(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(q.ENTERFULLSCREEN)):(T(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(q.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,r){r?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){const r=this.getMap();r&&r.removeChangeListener(A.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(A.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const t=this.documentListeners_;for(let n=0,s=t.length;n<s;++n)me(t[n]);t.length=0;const r=this.getMap();if(r){const n=r.getOwnerDocument();V(n)?this.element.classList.remove(x):this.element.classList.add(x);for(let s=0,o=G.length;s<o;++s)t.push(be(n,G[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function V(e){const t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function I(e){return!!(e.webkitIsFullScreen||e.fullscreenElement)}function D(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function ze(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():D(e)}function Ge(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}const et=(e,t,r)=>{const s=U(t.map.getLayers().getArray()).filter(o=>o.get("type")!=="Group").map(o=>o.get("_jsonDefinition")).filter(Boolean);return Array.from({length:e},()=>{const o=document.createElement("eox-map");return Object.assign(o.style,{width:"256px",height:"256px",position:"absolute",top:"-9999px",left:"-9999px"}),Object.assign(o,{projection:"EPSG:3857",layers:s}),r.appendChild(o),{tileMap:o,tileQueue:[],loadNextTile(){const a=this.tileQueue[0];H(o,a.layerId,a,this)}}})};async function H(e,t,r,n){const s=e.map;if(!s){e.addEventListener("mapmounted",()=>H(e,t,r,n),{once:!0});return}s.getLayers().forEach(c=>{c.setVisible(c.get("id")===t)});const a=ne().getTileCoordExtent([r.tile.z,r.tile.x,r.tile.y]);s.getView().fit(a,{callback:()=>{s.once("rendercomplete",function(){const c=document.createElement("canvas"),u=s.getSize();c.width=u[0],c.height=u[1];const f=c.getContext("2d");Array.prototype.forEach.call(s.getViewport().querySelectorAll(".ol-layer canvas, canvas.ol-layer"),function(l){if(l.width>0){const d=l.parentNode.style.opacity||l.style.opacity;f.globalAlpha=d===""?1:Number(d);let h;const p=l.style.transform;p?h=p.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number):h=[parseFloat(l.style.width)/l.width,0,0,parseFloat(l.style.height)/l.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(f,h);const E=l.parentNode.style.backgroundColor;E&&(f.fillStyle=E,f.fillRect(0,0,l.width,l.height)),f.drawImage(l,0,0)}}),f.globalAlpha=1,f.setTransform(1,0,0,1,0,0),r.callback(c),n.tileQueue.shift(),n.tileQueue.length&&n.loadNextTile()}),s.renderSync()}})}function qe(e,t,r,n){const{x:s,y:o,z:a}=r,c={layerId:t,tile:r,callback:n};let u=0,f=null;for(let l=0;l<e.length;l++){const d=e[l];if(!d.tileQueue.length){f=d;break}const h=d.tileQueue[d.tileQueue.length-1],p=Math.abs(h.tile.x-s)+Math.abs(h.tile.y-o)+Math.abs(h.tile.z-a);(u===0||p<u)&&(u=p,f=d)}return f.tileQueue.push(c),f}let C;function Ve(e,t){const r={},n=oe(),s=le();s.properties=t||{};const o={fillColor:"fill-color",lineColor:"stroke-color",strokeColor:"stroke-color",lineWidth:"stroke-width",strokeWidth:"stroke-width"};for(const[a,c]of Object.entries(o)){const u=e[c];if(u!==void 0)if(Array.isArray(u))try{const f=ie(u,7,n);r[a]=f(s)}catch(f){console.error(`Error evaluating style expression for ${c}:`,f)}else r[a]=u}return r}const tt=({EOxMap:e,target:t,mapPool:r})=>{C=new Q({target:t,layers:e.getFlatLayersArray(e.map.getLayers().getArray()).filter(u=>u.get("type")!=="Group").map(u=>Me(u,r)).filter(u=>u!==void 0),sun:{active:!1},atmosphereEnabled:!1,transparentBackground:!0,resourcesSrc:"https://cdn.jsdelivr.net/npm/@openglobus/og@0.27.21/lib/res",fontsSrc:"https://cdn.jsdelivr.net/npm/@openglobus/og@0.27.21/lib/res/fonts"});let n=e.map.getView().getZoom()-1;e.reducedGlobeLOD&&(C.planet.quadTreeStrategy.setLodSize(512),n=n-1);const s=2105e4/Math.pow(2,n),o=e.map.getView().getCenter(),a=P(o,e.map.getView().getProjection().getCode(),"EPSG:4326");C.planet.camera.setLonLat(new R(a[0],a[1],s),new R(a[0],a[1],0),$.NORTH);const c=document.createElement("style");return c.textContent=`
    .og-inner {
      height: 100%;
    }
    .og-inner *:not(canvas) {
      display: none !important;
    }
  `,t.appendChild(c),C},Ie=()=>{C&&C.planet.layers.forEach(e=>{e instanceof M&&(e.abortLoading(),e.animated=!0,setTimeout(()=>e.animated=!1,200))})},Me=(e,t)=>{const r=e.getSource&&e.getSource(),n=e.get("id");if(r instanceof ge)return new X(n,{isBaseLayer:e.get("base"),visibility:e.getVisible(),opacity:e.getOpacity()});if(r instanceof se)return new K(n,{isBaseLayer:e.get("base"),url:r.getUrls()[0],visibility:e.getVisible(),opacity:e.getOpacity()});if(r instanceof de){const s=r.getParams(),a=r.getUrls()[0],c=s.LAYERS||s.layers||"default";return new J(n,{isBaseLayer:e.get("base"),layers:c,url:a,visibility:e.getVisible(),opacity:e.getOpacity(),version:s.VERSION||s.Version||"1.1.1",extra:{...s}})}if(r instanceof he&&r.getUrl()){let s;if(fetch(r.getUrl().toString()).then(o=>o.json()).then(o=>{const a=o.crs;if(a&&(a.type=="name"?s=F(a.properties.name):a.type==="EPSG"&&(s=F("EPSG:"+a.properties.code))),s&&O(s,F("EPSG:4326"))||!a){const f=C.planet.getLayerByName(n);f&&C.planet.removeLayer(f);const l=new W(n,{visibility:e.getVisible(),opacity:e.getOpacity(),isBaseLayer:e.get("base")});l.addTo(C.planet);const d=e.getStyle();var c=o.features;for(let h=0;h<c.length;h++){var u=c[h];const p=Ve(d,u.properties);l.add(new Y({geometry:{type:u.geometry.type,coordinates:u.geometry.coordinates,style:p}}))}return l}else return}),s&&O(s,F("EPSG:4326")))return}return new M(n,{opacity:e.getOpacity(),visibility:e.getVisible(),async drawTile(s,o){if(!s.segment)return;const a={x:s.segment.tileX,y:s.segment.tileY,z:s.segment.tileZoom},c=qe(t,e.get("id"),a,u=>{var f;(f=s.segment)!=null&&f.initialized&&o(u)});c.tileQueue.length===1&&c.loadNextTile()}})},rt=e=>{var r,n,s,o,a,c,u,f;if(e.shadowRoot){let l=e.shadowRoot.querySelector("#globe");l||(l=document.createElement("div"),l.id="globe",l.style.width="100%",l.style.height="100%",l.style.display="block",(r=e.renderRoot)==null||r.appendChild(l)),e.registerProjectionFromCode("EPSG:3857"),e.globe=window.eoxMapGlobe.create({EOxMap:e,target:l}),e.shadowRoot.querySelector("#map").style.display="none",e.globeEnabled=!0}const t=(n=e.shadowRoot)==null?void 0:n.querySelectorAll(".ol-control");if(t&&t.forEach(l=>{e.shadowRoot.querySelector("#globe").appendChild(l)}),(s=e.controls)!=null&&s.Zoom){const l=(o=e.shadowRoot)==null?void 0:o.querySelector(".ol-zoom");l&&(l.style.display="block");const d=(a=e.shadowRoot)==null?void 0:a.querySelector(".ol-zoom-in"),h=(c=e.shadowRoot)==null?void 0:c.querySelector(".ol-zoom-out"),p=m=>{const y=e.globe.planet.camera;y.stopFlying();const i=250;let g=null;const _=v=>{if(g||(g=v),(v-g)/i<1){const L=y.getHeight();if(L>0){const Z=(L>2e6?.5:.3)/(i/16.67),j=L*Z*m;y.slide(0,0,-j),y.update()}requestAnimationFrame(_)}};requestAnimationFrame(_)},E=m=>{m.stopImmediatePropagation(),e.globe.renderer.controls.navigation.stop(),p(1)},b=m=>{m.stopImmediatePropagation(),e.globe.renderer.controls.navigation.stop(),p(-1)};d.addEventListener("click",E),h.addEventListener("click",b),e.globe.zoomInHandler=E,e.globe.zoomOutHandler=b}if((u=e.controls)!=null&&u.Rotate){const l=()=>{const h=e.globe.planet.getCartesianFromPixelTerrain(e.globe.renderer.handler.getCenter());h&&e.globe.planet.flyCartesian(h.normal().scaleTo(e.globe.planet.camera.eye.length()),{completeCallback:()=>e.globe.planet.camera.look(h)})},d=e.shadowRoot.querySelector(".ol-rotate");d.addEventListener("click",l),d.classList.remove("ol-hidden"),e.globe.rotateHandler=l}if((f=e.controls)!=null&&f.FullScreen){const l=e.map.getControls().getArray().find(d=>d instanceof B);l&&(l.source_=e.shadowRoot.querySelector("#globe"))}},nt=e=>{if(e.globe){const t=e.globe,r=t.planet;let n=r.getCartesianFromPixelTerrain(t.renderer.handler.getCenter());const s=n?n.normal().scaleTo(n.length()+n.distance(r.camera.eye)):r.camera.eye;r.flyCartesian(s,{amplitude:0,completeCallback:()=>{var p,E,b,m,y;n&&r.camera.look(n);const o=t.planet.camera.getLonLat();let a=e.reducedGlobeLOD?2:1;const c=Math.log2(2105e4/o.height)+a,u=[o.lon,o.lat],f=P(u,"EPSG:4326",e.OLprojection);e.map.getView().setCenter(f),e.map.getView().setZoom(c);const l=(p=e.shadowRoot)==null?void 0:p.querySelectorAll(".ol-control");if(l&&l.forEach(i=>{e.shadowRoot.querySelector(".ol-viewport").appendChild(i)}),(E=e.controls)!=null&&E.Zoom){if(e.globe.zoomInHandler){const g=e.shadowRoot.querySelector(".ol-zoom-in"),_=e.shadowRoot.querySelector(".ol-zoom-out");g.removeEventListener("click",e.globe.zoomInHandler),_.removeEventListener("click",e.globe.zoomOutHandler)}const i=(b=e.shadowRoot)==null?void 0:b.querySelector(".ol-zoom");i&&(i.style.display="block")}if((m=e.controls)!=null&&m.Rotate&&e.globe.rotateHandler){const i=e.shadowRoot.querySelector(".ol-rotate");i.removeEventListener("click",e.globe.rotateHandler),i.classList.add("ol-hidden")}if((y=e.controls)!=null&&y.FullScreen){const i=e.map.getControls().getArray().find(g=>g instanceof B);i&&(i.source_=e.shadowRoot.querySelector("#map"))}e.globe=null;const d=e.shadowRoot.querySelector("#globe");d&&(d.style.display="none",d.remove());const h=e.shadowRoot.querySelector("#map");h&&(h.style.display=""),e.globeEnabled=!1}})}};function Pe(e,t){let r;return function(...s){const o=()=>{clearTimeout(r),e(...s)};clearTimeout(r),r=setTimeout(o,t)}}const Ue=(e,t,r)=>{const n=Pe(()=>{Ie()},200);e.on("change",()=>{if(e.styleVariables_){const s=e.get("id"),o=e.styleVariables_;if(!s||!o)return;r.forEach(a=>{a.tileQueue.length=0;const c=ke(a.tileMap,s);c&&c.updateStyleVariables&&c.updateStyleVariables(o)}),n()}}),e.on("propertychange",({key:s})=>{const o=t.planet.getLayerByName(e.get("id"));if(o)switch(s){case"visible":o.setVisibility(e.getVisible());break;case"opacity":o.opacity=e.getOpacity();break}})},Be=(e,t,r)=>{e.forEach(n=>{n.get("id")&&Ue(n,t,r),n.getLayers&&Be(n.getLayers().getArray(),t,r)})};export{B as F,tt as a,P as b,et as c,nt as d,rt as e,U as f,ke as g,Be as p,Ie as r,Ye as s,We as t};
