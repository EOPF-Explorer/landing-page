const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.BkQWY9sY.js","assets/chunks/lit-element.CBn2YVps.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/addCommonStyleSheet.BN-d4VcA.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.DLFxBHrh.js","assets/chunks/repeat.Duc9p3Ra.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.Bj3rQkfn.js","assets/chunks/unsafe-html.C2DIGSw-.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.CxojoGlr.js"])))=>i.map(i=>d[i]);
import{aA as E,a5 as M,a2 as L,v as h,x as b,o as O,c as R,E as T,w as V,j as x,t as _,k as p,p as K}from"./framework.CHiWMs82.js";import{_ as N,u as C,l as $,am as f,an as m,ao as H,i as k,ap as U,aq as j,ar as P,as as D}from"./eo-dash.Cd4PBJX-.js";import{i as G}from"./easing-CH0-9wR8.CTB3jml5.js";import{e as J}from"./mdi.CnJQHbhh.js";import q from"./EodashLayoutSwitcher-W8M5_PW7.DAU1mWau.js";import{u as z}from"./mosaic-Cbksi-4M.C9RiDFlw.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./VTooltip-ZmTu_IEq.DhuBoVVR.js";import"./forwardRefs-XchW0dBb.B63_FlLD.js";import"./transition-VGU9P_OU.DbcSGej2.js";const Y=a=>i=>{let s="";return a.forEach(e=>{const o=e.property;if(!e.icon&&!e.unitLabel||!i.properties[o])return;e.icon&&(s+=e.icon);let t=i.properties[o];typeof t=="number"&&!Number.isInteger(t)&&(t=t.toFixed(1)),s+=t,e.unitLabel&&(s+=e.unitLabel)}),s},Z=a=>{var o;const s=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((o=C().stac)==null?void 0:o.map(t=>t.id))||[],...k.value&&{state:{[k.value]:!0}}}],e=a.map(t=>{const r=`properties.${t.property}`;return t.type==="range"?{key:r,title:t.title||t.property,type:"range",expanded:!0,filterKeys:[t.min||0,t.max||100],state:t.state??{min:t.min??0,max:t.max??100}}:t.type==="multiselect"?{key:r,title:t.title||t.property,type:"multiselect",placeholder:t.placeholder||`Select ${t.property}`,inline:!1,filterKeys:t.filterKeys||[],state:t.state}:t.type==="select"?{key:r,title:t.title||t.property,type:"select",placeholder:t.placeholder||`Select ${t.title||t.property}`,filterKeys:t.filterKeys||[],state:t.state}:null}).filter(Boolean);return[...s,...e]},Q=(a,i)=>{const s=[];return i.forEach(e=>{const o=`properties.${e.property}`,t=a[o];if(t){if(e.type==="range"&&t.state){const{min:r,max:n}=t.state;r!==void 0&&r>(e.min||0)&&s.push(`${e.property}>=${r}`),n!==void 0&&n<(e.max||100)&&s.push(`${e.property}<=${n}`)}else if(e.type==="multiselect"&&t.stringifiedState){const r=t.stringifiedState;r.length>0&&s.push(`${e.property} IN (${r})`)}else if(e.type==="select"&&t.stringifiedState){const r=t.stringifiedState;r&&s.push(`${e.property}='${r}'`)}}}),s.join(" AND ")},W=(a,i,s)=>{var r,n;const e=C(),o=new URLSearchParams;(r=a.collection)!=null&&r.stringifiedState&&o.append("collections",a.collection.stringifiedState.replaceAll(" ","")),(n=m.value)!=null&&n.lonLatExtent&&s&&o.append("bbox",D([...m.value.lonLatExtent]).join(","));const t=Q(a,i);return t&&o.append("filter",t),o.append("limit","100"),`${e.stacEndpoint}/search?${o.toString()}`},X=(a,i,s)=>{let e=new AbortController;return(o,t)=>({url:W(t,a,i),fetchFn:async r=>{e.abort(),e=new AbortController;const n=e.signal;return await $.get(r,{signal:n}).then(l=>l.data.features).catch(l=>l.name==="AbortError"||l.name==="CanceledError"?s.value:(console.error(l),[]))}})},ee=(a,i,s)=>e=>{a.value=e.detail.results,S(a.value,i,s)},B=(a,i,s)=>async e=>{var t,r,n,l,c,u;const o=e.detail;if(o){if(i){if(o.id===((t=a.selectedCompareItem)==null?void 0:t.id)){a.selectedCompareItem=null;return}((r=a.selectedCompareStac)==null?void 0:r.id)===o.collection?a.selectedCompareItem=o:await a.loadSelectedCompareSTAC(o.collection,!1,o)}else{if(o.id===((n=a.selectedItem)==null?void 0:n.id)){a.selectedItem=null;return}((l=a.selectedStac)==null?void 0:l.id)===o.collection?a.selectedItem=o:await a.loadSelectedSTAC(o.collection,!1,o)}U.showButton=!0,(u=(c=s.value)==null?void 0:c.selectInteractions["stac-items"])==null||u.highlightById([o.id],{padding:[100,100,100,100],duration:1200,easing:G})}},te=a=>i=>{var s,e;(e=(s=a.value)==null?void 0:s.selectInteractions["stac-items"])==null||e.highlightById([i.detail.id])},re=a=>()=>{var i,s;(s=(i=a.value)==null?void 0:i.selectInteractions["stac-items"])==null||s.highlightById([])};function S(a,i,s){var n;const e=i.value;let o=(n=e==null?void 0:e.layers)==null?void 0:n.find(l=>{var c;return((c=l.properties)==null?void 0:c.id)==="AnalysisGroup"});if(!e||!a)return;o||(o={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},e.layers=[...e.layers,o]);const t={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:a})),format:"GeoJSON",projection:"EPSG:3857"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-item-hover",condition:"pointermove",tooltip:s==null?void 0:s.length,style:{"stroke-color":"white","stroke-width":3}}},{type:"select",options:{id:"stac-items",condition:"click",tooltip:!1,style:{"stroke-color":"white","stroke-width":3}}}]};if(o.layers.some(l=>{var c,u;return((c=l.properties)==null?void 0:c.id)===((u=t.properties)==null?void 0:u.id)})){e.addOrUpdateLayer(t);return}else o.layers.unshift(t),e.layers=[...e.layers]}const ae=(a,i,s)=>{if(!i)return;let e;const o=()=>{clearTimeout(e),e=setTimeout(()=>{var t,r;((t=s.value)==null?void 0:t.projection)!="globe"&&((r=a.value)==null||r.search())},500)};h(()=>{var t;(t=s.value)==null||t.map.on("moveend",o)}),b(()=>{var t;(t=s.value)==null||t.map.un("moveend",o)})},se=(a,i,s)=>{h(()=>{S(a.value,i,s)}),j(()=>{S(a.value,i,s)})};function oe(a,i,s){const e=r=>{var c,u,g;if(r.detail.originalEvent.type!=="pointermove")return;const n=(u=(c=r.detail)==null?void 0:c.feature)==null?void 0:u.getId();if(!n)return;const l=(g=a.value.results)==null?void 0:g.find(y=>y.id===n);l&&(a.value.selectedResult=l)},o=r=>{if(typeof r=="number")return r.toFixed(0);if(typeof r=="string"&&r.length>9&&/\d{4}-\d{2}-\d{2}/.test(r)){const n=Date.parse(r);if(!isNaN(n))return new Date(n).toUTCString()}return r},t=r=>{let n=r;return r.includes(":")&&(n=r.split(":")[1]),n.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())};h(()=>{var r;(r=i.value)==null||r.addEventListener("select",e),P.value=({key:n,value:l})=>{if(s&&s.includes(n))return{key:t(n),value:o(l)}}}),b(()=>{var r;(r=i.value)==null||r.removeEventListener("select",e),P.value=null})}function ie(a,i,s,e){const o=B(i,e,s),t=r=>{var c,u,g;if(r.detail.originalEvent.type!=="click")return;const n=(u=(c=r.detail)==null?void 0:c.feature)==null?void 0:u.getId();if(!n)return;const l=(g=a.value.results)==null?void 0:g.find(y=>(y==null?void 0:y.id)===n);l&&o(new CustomEvent("select",{detail:l}))};h(()=>{var r;(r=s.value)==null||r.addEventListener("select",t)}),b(()=>{var r;(r=s.value)==null||r.removeEventListener("select",t)})}const ne=".item-catalog-container[data-v-6155e2ed]{overflow:hidden}.itemfilter-scroll[data-v-6155e2ed]{flex:1;min-height:0;overflow:hidden;padding:.5rem;--eox-itemfilter-results-color: var(--v-theme-primary) !important}.title[data-v-6155e2ed]{padding:1em;margin:.2em;flex-shrink:0}",le=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],ce={slot:"filterstitle",style:{margin:"14px 8px"}},ue={slot:"resultstitle",style:{margin:"14px 8px"}},pe={__name:"index",props:{title:{type:String,default:"Explore Catalog"},hoverProperties:{type:Array,default:()=>["datetime","eo:cloud_cover"]},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:J},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,state:{min:0,max:30},icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]},useMosaic:{type:Boolean,default:!1},enableCompare:{type:Boolean,default:!1}},async setup(a){let i,s;customElements.get("eox-itemfilter")||([i,s]=E(()=>M(()=>import("./main.BkQWY9sY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),await i,s());const e=a,o=L("root"),t=L("itemfilter");h(async()=>{}),b(()=>{r.selectedItem=null});const r=C();e.useMosaic&&r.mosaicEndpoint&&z(r.mosaicEndpoint,{},r);const n=K([]);r.stacEndpoint&&([i,s]=E(()=>$.get(r.stacEndpoint+"/search?limit=100").then(F=>n.value=F.data.features)),await i,s());const l=n.value,c=Z(e.filters),u=Y(e.filters),g=X(e.filters,e.bboxFilter,n),y=ee(n,e.enableCompare?f:m,e.hoverProperties),I=B(r,e.enableCompare,e.enableCompare?f:m);se(n,e.enableCompare?f:m,e.hoverProperties),ae(t,e.bboxFilter,e.enableCompare?f:m),ie(t,r,e.enableCompare?f:m,e.enableCompare),oe(t,e.enableCompare?f:m,e.hoverProperties);const w=te(e.enableCompare?f:m),A=re(e.enableCompare?f:m);return(F,d)=>(O(),R("div",{ref_key:"root",ref:o,class:"d-flex flex-column item-catalog-container"},[T(H,{class:"title align-center justify-space-between flex-shrink-0"},{default:V(()=>[d[4]||(d[4]=x("h4",null,"Catalog Items",-1)),T(q,{target:a.layoutTarget,icon:a.layoutIcon},null,8,["target","icon"])]),_:1}),x("eox-itemfilter",{class:"itemfilter-scroll",ref:"itemfilter",titleProperty:"id",".imageProperty":a.imageProperty,".subTitleProperty":p(u),".filterProperties":p(c),".items":p(l),onSelect:d[0]||(d[0]=(...v)=>p(I)&&p(I)(...v)),onFilter:d[1]||(d[1]=(...v)=>p(y)&&p(y)(...v)),"onMouseenter:result":d[2]||(d[2]=(...v)=>p(w)&&p(w)(...v)),"onMouseleave:result":d[3]||(d[3]=(...v)=>p(A)&&p(A)(...v)),externalFilter:p(g)},[x("h4",ce,_(a.filtersTitle),1),x("h4",ue,_(a.resultsTitle),1)],40,le)],512))}},Ie=N(pe,[["styles",[ne]],["__scopeId","data-v-6155e2ed"]]);export{Ie as default};
