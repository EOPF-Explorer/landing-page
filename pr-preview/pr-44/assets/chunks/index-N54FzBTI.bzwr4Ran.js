const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.hdUpz5XX.js","assets/chunks/addCommonStyleSheet.Be-rnLMW.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.D3dWPvB-.js","assets/chunks/repeat.Bq2Q4zSV.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.MmG03ohT.js","assets/chunks/unsafe-html.DBTIrAnm.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.CxojoGlr.js"])))=>i.map(i=>d[i]);
import{ao as E,a2 as I,v as f,x as g,p as C,c as M,o as O,G as F,j as h,w as V,t as A,k as u,a5 as R}from"./framework.CtCpW42i.js";import{_ as H,a as S,h as K,i as k,j as T,k as D,m as n,n as N,o as j}from"./eo-dash.S3SNQFH7.js";import{i as U}from"./easing-CH0-9wR8.CTB3jml5.js";import{c as G}from"./mdi.CilvuGMU.js";import J from"./EodashLayoutSwitcher-C51sF1EK.BQT--CLP.js";import{u as z}from"./mosaic-CKPeN3Vy.CjXpcbtw.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./VTooltip-DSpN8xED.D-L-RIWM.js";import"./forwardRefs-DEQUrLOm.4z7PDXjK.js";import"./transition-SOSjTaDQ.8zFofiGc.js";const Y=l=>o=>{let t="";return l.forEach(r=>{const s=r.property;if(!r.icon&&!r.unitLabel||!o.properties[s])return;r.icon&&(t+=r.icon);let e=o.properties[s];typeof e=="number"&&!Number.isInteger(e)&&(e=e.toFixed(1)),t+=e,r.unitLabel&&(t+=r.unitLabel)}),t},Z=l=>{var s;const t=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((s=S().stac)==null?void 0:s.map(e=>e.id))||[],...k.value&&{state:{[k.value]:!0}}}],r=l.map(e=>{const i=`properties.${e.property}`;return e.type==="range"?{key:i,title:e.title||e.property,type:"range",expanded:!0,filterKeys:[e.min||0,e.max||100],state:{min:e.min??0,max:e.max??100}}:e.type==="multiselect"?{key:i,title:e.title||e.property,type:"multiselect",placeholder:e.placeholder||`Select ${e.property}`,inline:!1,filterKeys:e.filterKeys||[],state:e.state}:e.type==="select"?{key:i,title:e.title||e.property,type:"select",placeholder:e.placeholder||`Select ${e.title||e.property}`,filterKeys:e.filterKeys||[],state:e.state}:null}).filter(Boolean);return[...t,...r]},q=(l,o)=>{const t=[];return o.forEach(r=>{const s=`properties.${r.property}`,e=l[s];if(e){if(r.type==="range"&&e.state){const{min:i,max:a}=e.state;i!==void 0&&i>(r.min||0)&&t.push(`${r.property}>=${i}`),a!==void 0&&a<(r.max||100)&&t.push(`${r.property}<=${a}`)}else if(r.type==="multiselect"&&e.stringifiedState){const i=e.stringifiedState;i.length>0&&t.push(`${r.property} IN (${i})`)}else if(r.type==="select"&&e.stringifiedState){const i=e.stringifiedState;i&&t.push(`${r.property}='${i}'`)}}}),t.join(" AND ")},Q=(l,o,t)=>{var i,a;const r=S(),s=new URLSearchParams;(i=l.collection)!=null&&i.stringifiedState&&s.append("collections",l.collection.stringifiedState.replaceAll(" ","")),(a=n.value)!=null&&a.lonLatExtent&&t&&s.append("bbox",j([...n.value.lonLatExtent]).join(","));const e=q(l,o);return e&&s.append("filter",e),s.append("limit","100"),`${r.stacEndpoint}/search?${s.toString()}`},W=(l,o,t)=>{let r=new AbortController;return(s,e)=>({url:Q(e,l,o),fetchFn:async i=>{r.abort(),r=new AbortController;const a=r.signal;return await T.get(i,{signal:a}).then(c=>c.data.features).catch(c=>c.name==="AbortError"||c.name==="CanceledError"?t.value:(console.error(c),[]))}})},X=l=>o=>{l.value=o.detail.results,x(l.value)},_=l=>async o=>{var r,s,e;const t=o.detail;t&&(((r=l.selectedStac)==null?void 0:r.id)===t.collection?l.selectedItem=t:await l.loadSelectedSTAC(t.collection,!1,t),N.showButton=!0,(e=(s=n.value)==null?void 0:s.selectInteractions["stac-items"])==null||e.highlightById([t.id],{padding:[100,100,100,100],duration:1200,easing:U}))},L=l=>{var o,t;(t=(o=n.value)==null?void 0:o.selectInteractions["stac-items"])==null||t.highlightById([l.detail.id])},P=()=>{var l,o;(o=(l=n.value)==null?void 0:l.selectInteractions["stac-items"])==null||o.highlightById([])};function x(l){var s,e;let o=(e=(s=n.value)==null?void 0:s.layers)==null?void 0:e.find(i=>{var a;return((a=i.properties)==null?void 0:a.id)==="AnalysisGroup"});if(!n.value||!l)return;o||(o={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},n.value.layers=[...n.value.layers,o]);const t={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:l})),format:"GeoJSON"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-items",condition:"pointermove",style:{"stroke-color":"white","stroke-width":3}}},{type:"select",options:{id:"stac-items",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]};if(o.layers.some(i=>{var a;return((a=i.properties)==null?void 0:a.id)==="stac-items"})){n.value.addOrUpdateLayer(t);return}else o.layers.push(t),n.value.layers=[...n.value.layers]}const ee=(l,o)=>{if(!o)return;let t;const r=()=>{clearTimeout(t),t=setTimeout(()=>{var s;(s=l.value)==null||s.search()},800)};f(()=>{var s;(s=n.value)==null||s.map.on("moveend",r)}),g(()=>{var s;(s=n.value)==null||s.map.un("moveend",r)})},te=l=>{f(()=>{x(l.value)}),D(()=>{x(l.value)})};function re(l){const o=t=>{var e,i,a;if(t.detail.originalEvent.type!=="pointermove")return;const r=(i=(e=t.detail)==null?void 0:e.feature)==null?void 0:i.getId();if(!r)return;const s=(a=l.value.results)==null?void 0:a.find(c=>c.id===r);s&&(l.value.selectedResult=s)};f(()=>{var t;(t=n.value)==null||t.addEventListener("select",o)}),g(()=>{var t;(t=n.value)==null||t.removeEventListener("select",o)})}function se(l,o){const t=_(o),r=s=>{var a,c,v;if(s.detail.originalEvent.type!=="click")return;const e=(c=(a=s.detail)==null?void 0:a.feature)==null?void 0:c.getId();if(!e)return;const i=(v=l.value.results)==null?void 0:v.find(m=>(m==null?void 0:m.id)===e);i&&t(new CustomEvent("select",{detail:i}))};f(()=>{var s;(s=n.value)==null||s.addEventListener("select",r)}),g(()=>{var s;(s=n.value)==null||s.removeEventListener("select",r)})}const le=".item-catalog-container[data-v-008b97c7]{overflow:hidden}.itemfilter-scroll[data-v-008b97c7]{flex:1;min-height:0;overflow:hidden;padding:.5rem;--eox-itemfilter-results-color: var(--v-theme-primary) !important}.title[data-v-008b97c7]{padding:1em;margin:.2em;flex-shrink:0}",ie=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],oe={slot:"filterstitle",style:{margin:"14px 8px"}},ae={slot:"resultstitle",style:{margin:"14px 8px"}},ne={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:G},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]},useMosaic:{type:Boolean,default:!1}},async setup(l){let o,t;customElements.get("eox-itemfilter")||([o,t]=E(()=>R(()=>import("./main.hdUpz5XX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await o,t());const r=l,s=I("root"),e=I("itemfilter");let i=null;f(async()=>{var y;i=((y=s.value)==null?void 0:y.parentElement)??null,i&&(i.style.overflow="hidden",i.style.display="flex",i.style.flexDirection="column")}),g(()=>{i&&(i.style.overflow="",i.style.display="",i.style.flexDirection=""),a.selectedItem=null});const a=S();r.useMosaic&&a.mosaicEndpoint&&z(a.mosaicEndpoint,{},a);const c=C([]);a.stacEndpoint&&([o,t]=E(()=>T.get(a.stacEndpoint+"/search?limit=100").then(y=>c.value=y.data.features)),await o,t());const v=c.value,m=Z(r.filters),$=Y(r.filters),B=W(r.filters,r.bboxFilter,c),b=X(c),w=_(a);return te(c),ee(e,r.bboxFilter),se(e,a),re(e),(y,p)=>(O(),M("div",{ref_key:"root",ref:s,class:"d-flex flex-column item-catalog-container"},[F(K,{class:"title align-center justify-space-between flex-shrink-0"},{default:V(()=>[p[4]||(p[4]=h("h4",null,"Catalog Items",-1)),F(J,{target:l.layoutTarget,icon:l.layoutIcon},null,8,["target","icon"])]),_:1}),h("eox-itemfilter",{class:"itemfilter-scroll",ref:"itemfilter",titleProperty:"id",".imageProperty":l.imageProperty,".subTitleProperty":u($),".filterProperties":u(m),".items":u(v),onSelect:p[0]||(p[0]=(...d)=>u(w)&&u(w)(...d)),onFilter:p[1]||(p[1]=(...d)=>u(b)&&u(b)(...d)),"onMouseenter:result":p[2]||(p[2]=(...d)=>u(L)&&u(L)(...d)),"onMouseleave:result":p[3]||(p[3]=(...d)=>u(P)&&u(P)(...d)),externalFilter:u(B)},[h("h4",oe,A(l.filtersTitle),1),h("h4",ae,A(l.resultsTitle),1)],40,ie)],512))}},Se=H(ne,[["styles",[le]],["__scopeId","data-v-008b97c7"]]);export{Se as default};
