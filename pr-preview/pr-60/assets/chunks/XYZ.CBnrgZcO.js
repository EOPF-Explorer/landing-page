var ln=Object.defineProperty;var hn=(n,t,e)=>t in n?ln(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Me=(n,t,e)=>hn(n,typeof t!="symbol"?t+"":t,e);import{ae as Ut,D as de,u as tt,W as cn,l as H,X as V,q as z,h as Ot,bv as un,Y as fn,E as et,U as nt,a1 as Bt,p as gn,aY as dn,bs as Ie,bw as ze,bx as mn,a0 as Be,bn as Ae,aN as je,e as pn,a4 as gt,a3 as P,A as me,by as _n,d as yn,m as En,ab as Ue,bz as xn,I as wn,z as Tn,y as Mn,x as In,bm as fe,v as Re,k as An,ad as Xt,b9 as Ht,aM as Rn,_ as Ln,bA as Sn,j as $e,a5 as Cn,bB as vn,a6 as Ft,a9 as Yt,g as $t,bo as bn,bC as On,H as Vt}from"./Polygon.DGYqraVP.js";const mt={ADD:"add",REMOVE:"remove"},Le={LENGTH:"length"};class Dt extends de{constructor(t,e,i){super(t),this.element=e,this.index=i}}class Se extends Ut{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t??[],this.unique_)for(let i=1,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Le.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Dt(mt.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Dt(mt.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Dt(mt.REMOVE,r,t)),this.dispatchEvent(new Dt(mt.ADD,e,t))}updateLength_(){this.set(Le.LENGTH,this.array_.length)}assertUnique_(t,e){const i=this.array_;for(let r=0,s=i.length;r<s;++r)if(i[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}}const it=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Xn=it.includes("safari")&&!it.includes("chrom"),or=Xn&&(it.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(it)),ar=it.includes("webkit")&&!it.includes("edge"),lr=it.includes("macintosh"),hr=typeof devicePixelRatio<"u"?devicePixelRatio:1,jt=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pe=typeof Image<"u"&&Image.prototype.decode,We=typeof createImageBitmap=="function",cr=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}(),Pn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ur={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},x={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ke(n){return Math.pow(n,3)}function fr(n){return 1-ke(1-n)}function gr(n){return 3*n*n-2*n*n*n}function dr(n){return n}const Fn=42,qe=256,mr="ol-hidden",pr="ol-selectable",_r="ol-unselectable",yr="ol-unsupported",Er="ol-control",xr="ol-collapsed",Yn=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Ce=["style","variant","weight","size","lineHeight","family"],ve={normal:400,bold:700},wr=function(n){const t=n.match(Yn);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,r=Ce.length;i<r;++i){const s=t[i+1];s!==void 0&&(e[Ce[i]]=typeof s=="string"?s.trim():s)}return isNaN(Number(e.weight))&&e.weight in ve&&(e.weight=ve[e.weight]),e.families=e.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),e};function _t(n,t,e,i){let r;return e&&e.length?r=e.shift():jt?r=new class extends OffscreenCanvas{constructor(){super(...arguments);Me(this,"style",{})}}(n??300,t??150):r=document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("2d",i)}let Qt;function Tr(){return Qt||(Qt=_t(1,1)),Qt}function _e(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function Mr(n){let t=n.offsetWidth;const e=getComputedStyle(n);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Ir(n){let t=n.offsetHeight;const e=getComputedStyle(n);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Ar(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function Rr(n){for(;n.lastChild;)n.lastChild.remove()}function Lr(n,t){const e=n.childNodes;for(let i=0;;++i){const r=e[i],s=t[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}function Sr(){return new Proxy({childNodes:[],appendChild:function(t){return this.childNodes.push(t),t},remove:function(){},removeChild:function(t){const e=this.childNodes.indexOf(t);if(e===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(e,1),t},insertBefore:function(t,e){const i=this.childNodes.indexOf(e);if(i===-1)throw new Error("Reference node not found");return this.childNodes.splice(i,0,t),t},style:{}},{get(t,e,i){return e==="firstElementChild"?t.childNodes.length>0?t.childNodes[0]:null:Reflect.get(t,e,i)}})}function Cr(n){return typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}class vr extends Ut{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let i=0,r=this.listenerKeys.length;i<r;++i)tt(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==cn&&this.listenerKeys.push(H(t,Pn.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const L={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Dn extends Ut{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[L.OPACITY]=t.opacity!==void 0?t.opacity:1,V(typeof e[L.OPACITY]=="number","Layer opacity must be a number"),e[L.VISIBLE]=t.visible!==void 0?t.visible:!0,e[L.Z_INDEX]=t.zIndex,e[L.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[L.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[L.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[L.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=z(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Ot()}getLayerStatesArray(t){return Ot()}getExtent(){return this.get(L.EXTENT)}getMaxResolution(){return this.get(L.MAX_RESOLUTION)}getMinResolution(){return this.get(L.MIN_RESOLUTION)}getMinZoom(){return this.get(L.MIN_ZOOM)}getMaxZoom(){return this.get(L.MAX_ZOOM)}getOpacity(){return this.get(L.OPACITY)}getSourceState(){return Ot()}getVisible(){return this.get(L.VISIBLE)}getZIndex(){return this.get(L.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(L.EXTENT,t)}setMaxResolution(t){this.set(L.MAX_RESOLUTION,t)}setMinResolution(t){this.set(L.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(L.MAX_ZOOM,t)}setMinZoom(t){this.set(L.MIN_ZOOM,t)}setOpacity(t){V(typeof t=="number","Layer opacity must be a number"),this.set(L.OPACITY,t)}setVisible(t){this.set(L.VISIBLE,t)}setZIndex(t){this.set(L.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const k={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class lt extends de{constructor(t,e){super(t),this.layer=e}}const Jt={LAYERS:"layers"};class Ke extends Dn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Jt.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Se(i.slice(),{unique:!0}):V(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Se(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(tt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(H(t,mt.ADD,this.handleLayersAdd_,this),H(t,mt.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(tt);un(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const s=e[i];this.registerLayerListeners_(s),this.dispatchEvent(new lt(k.ADDLAYER,s))}this.changed()}registerLayerListeners_(t){const e=[H(t,fn.PROPERTYCHANGE,this.handleLayerChange_,this),H(t,et.CHANGE,this.handleLayerChange_,this)];t instanceof Ke&&e.push(H(t,k.ADDLAYER,this.handleLayerGroupAdd_,this),H(t,k.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[nt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new lt(k.ADDLAYER,t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new lt(k.REMOVELAYER,t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new lt(k.ADDLAYER,e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=nt(e);this.listenerKeys_[i].forEach(tt),delete this.listenerKeys_[i],this.dispatchEvent(new lt(k.REMOVELAYER,e)),this.changed()}getLayers(){return this.get(Jt.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new lt(k.REMOVELAYER,i[r]))}this.set(Jt.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Bt(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}function He(n,t,e=0,i=n.length-1,r=Nn){for(;i>e;){if(i-e>600){const l=i-e+1,c=t-e+1,u=Math.log(l),f=.5*Math.exp(2*u/3),R=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),v=Math.max(e,Math.floor(t-c*f/l+R)),g=Math.min(i,Math.floor(t+(l-c)*f/l+R));He(n,t,v,g,r)}const s=n[t];let o=e,a=i;for(Mt(n,e,t),r(n[i],s)>0&&Mt(n,e,i);o<a;){for(Mt(n,o,a),o++,a--;r(n[o],s)<0;)o++;for(;r(n[a],s)>0;)a--}r(n[e],s)===0?Mt(n,e,a):(a++,Mt(n,a,i)),a<=t&&(e=a+1),t<=a&&(i=a-1)}}function Mt(n,t,e){const i=n[t];n[t]=n[e],n[e]=i}function Nn(n,t){return n<t?-1:n>t?1:0}let br=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Gt(t,e))return i;const r=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?r(a):a;Gt(t,l)&&(e.leaf?i.push(a):ee(t,l)?this._all(a,i):s.push(a))}e=s.pop()}return i}collides(t){let e=this.data;if(!Gt(t,e))return!1;const i=[];for(;e;){for(let r=0;r<e.children.length;r++){const s=e.children[r],o=e.leaf?this.toBBox(s):s;if(Gt(t,o)){if(e.leaf||ee(t,o))return!0;i.push(s)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=dt([]),this}remove(t,e){if(!t)return this;let i=this.data;const r=this.toBBox(t),s=[],o=[];let a,l,c;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),i.leaf){const u=Gn(t,i.children,e);if(u!==-1)return i.children.splice(u,1),s.push(i),this._condense(s),this}!c&&!i.leaf&&ee(i,r)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],c=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,r){const s=i-e+1;let o=this._maxEntries,a;if(s<=o)return a=dt(t.slice(e,i+1)),ht(a,this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),a=dt([]),a.leaf=!1,a.height=r;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));be(t,e,i,c,this.compareMinX);for(let u=e;u<=i;u+=c){const f=Math.min(u+c-1,i);be(t,u,f,l,this.compareMinY);for(let R=u;R<=f;R+=l){const v=Math.min(R+l-1,f);a.children.push(this._build(t,R,v,r-1))}}return ht(a,this.toBBox),a}_chooseSubtree(t,e,i,r){for(;r.push(e),!(e.leaf||r.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const c=e.children[l],u=te(c),f=Bn(t,c)-u;f<o?(o=f,s=u<s?u:s,a=c):f===o&&u<s&&(s=u,a=c)}e=a||e.children[0]}return e}_insert(t,e,i){const r=i?t:this.toBBox(t),s=[],o=this._chooseSubtree(r,this.data,e,s);for(o.children.push(t),Lt(o,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)}_split(t,e){const i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);const o=this._chooseSplitIndex(i,s,r),a=dt(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,ht(i,this.toBBox),ht(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=dt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ht(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let r,s=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=Rt(t,0,a,this.toBBox),c=Rt(t,a,i,this.toBBox),u=jn(l,c),f=te(l)+te(c);u<s?(s=u,r=a,o=f<o?f:o):u===s&&f<o&&(o=f,r=a)}return r||i-e}_chooseSplitAxis(t,e,i){const r=t.leaf?this.compareMinX:Zn,s=t.leaf?this.compareMinY:zn,o=this._allDistMargin(t,e,i,r),a=this._allDistMargin(t,e,i,s);o<a&&t.children.sort(r)}_allDistMargin(t,e,i,r){t.children.sort(r);const s=this.toBBox,o=Rt(t,0,e,s),a=Rt(t,i-e,i,s);let l=Nt(o)+Nt(a);for(let c=e;c<i-e;c++){const u=t.children[c];Lt(o,t.leaf?s(u):u),l+=Nt(o)}for(let c=i-e-1;c>=e;c--){const u=t.children[c];Lt(a,t.leaf?s(u):u),l+=Nt(a)}return l}_adjustParentBBoxes(t,e,i){for(let r=i;r>=0;r--)Lt(e[r],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():ht(t[e],this.toBBox)}};function Gn(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function ht(n,t){Rt(n,0,n.children.length,t,n)}function Rt(n,t,e,i,r){r||(r=dt(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<e;s++){const o=n.children[s];Lt(r,n.leaf?i(o):o)}return r}function Lt(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function Zn(n,t){return n.minX-t.minX}function zn(n,t){return n.minY-t.minY}function te(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Nt(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Bn(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function jn(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),r=Math.min(n.maxX,t.maxX),s=Math.min(n.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,s-i)}function ee(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function Gt(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function dt(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function be(n,t,e,i,r){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;He(n,o,t,e,r),s.push(t,o,o,e)}}const Un=[NaN,NaN,NaN,0];let ne;function $n(){return ne||(ne=_t(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),ne}const Wn=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,kn=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,qn=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Kn=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Zt(n,t){return n.endsWith("%")?Number(n.substring(0,n.length-1))/t:Number(n)}function Pt(n){throw new Error('failed to parse "'+n+'" as color')}function Ve(n){if(n.toLowerCase().startsWith("rgb")){const s=n.match(kn)||n.match(Wn)||n.match(qn);if(s){const o=s[4],a=100/255;return[z(Zt(s[1],a)+.5|0,0,255),z(Zt(s[2],a)+.5|0,0,255),z(Zt(s[3],a)+.5|0,0,255),o!==void 0?z(Zt(o,100),0,1):1]}Pt(n)}if(n.startsWith("#")){if(Kn.test(n)){const s=n.substring(1),o=s.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=s.length;l<c;l+=o){let u=parseInt(s.substring(l,l+o),16);o===1&&(u+=u<<4),a[l/o]=u}return a[3]=a[3]/255,a}Pt(n)}const t=$n();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=n,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=n,t.fillStyle===e&&Pt(n));const i=t.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return Ve(i);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const r=Array.from(t.getImageData(0,0,1,1).data);return r[3]=gn(r[3]/255,3),r}function Xr(n){return typeof n=="string"?n:Qe(n)}const Hn=1024,It={};let ie=0;function Vn(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function re(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function se(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function oe(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function ae(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function Oe(n){const t=oe(n[0]),e=oe(n[1]),i=oe(n[2]),r=ae(t*.222488403+e*.716873169+i*.06060791),s=500*(ae(t*.452247074+e*.399439023+i*.148375274)-r),o=200*(r-ae(t*.016863605+e*.117638439+i*.865350722)),a=Math.atan2(o,s)*(180/Math.PI);return[116*r-16,Math.sqrt(s*s+o*o),a<0?a+360:a,n[3]]}function Qn(n){const t=(n[0]+16)/116,e=n[1],i=n[2]*Math.PI/180,r=se(t),s=se(t+e/500*Math.cos(i)),o=se(t-e/200*Math.sin(i)),a=re(s*3.021973625-r*1.617392459-o*.404875592),l=re(s*-.943766287+r*1.916279586+o*.027607165),c=re(s*.069407491-r*.22898585+o*1.159737864);return[z(a+.5|0,0,255),z(l+.5|0,0,255),z(c+.5|0,0,255),n[3]]}function ye(n){if(n==="none")return Un;if(It.hasOwnProperty(n))return It[n];if(ie>=Hn){let e=0;for(const i in It)e++&3||(delete It[i],--ie)}const t=Ve(n);t.length!==4&&Pt(n);for(const e of t)isNaN(e)&&Pt(n);return It[n]=t,++ie,t}function Pr(n){return Array.isArray(n)?n:ye(n)}function Qe(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}function Fr(n){return n[0]>0&&n[1]>0}function Jn(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function Q(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}let rt=0;const F=1<<rt++,T=1<<rt++,Y=1<<rt++,U=1<<rt++,ge=1<<rt++,St=1<<rt++,zt=Math.pow(2,rt)-1,Ee={[F]:"boolean",[T]:"number",[Y]:"string",[U]:"color",[ge]:"number[]",[St]:"size"},ti=Object.keys(Ee).map(Number).sort(dn);function ei(n){return n in Ee}function Ct(n){const t=[];for(const e of ti)vt(n,e)&&t.push(Ee[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function vt(n,t){return(n&t)===t}function q(n,t){return n===t}class C{constructor(t,e){if(!ei(t))throw new Error(`literal expressions must have a specific type, got ${Ct(t)}`);this.type=t,this.value=e}}class ni{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function Yr(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function b(n,t,e){switch(typeof n){case"boolean":{if(q(t,Y))return new C(Y,n?"true":"false");if(!vt(t,F))throw new Error(`got a boolean, but expected ${Ct(t)}`);return new C(F,n)}case"number":{if(q(t,St))return new C(St,Q(n));if(q(t,F))return new C(F,!!n);if(q(t,Y))return new C(Y,n.toString());if(!vt(t,T))throw new Error(`got a number, but expected ${Ct(t)}`);return new C(T,n)}case"string":{if(q(t,U))return new C(U,ye(n));if(q(t,F))return new C(F,!!n);if(!vt(t,Y))throw new Error(`got a string, but expected ${Ct(t)}`);return new C(Y,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return gi(n,t,e);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(q(t,St)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new C(St,n)}if(q(t,U)){if(n.length===3)return new C(U,[...n,1]);if(n.length===4)return new C(U,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!vt(t,ge))throw new Error(`got an array of numbers, but expected ${Ct(t)}`);return new C(ge,n)}const h={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},ii={[h.Get]:m(p(1,1/0),Xe),[h.Var]:m(p(1,1),ri),[h.Has]:m(p(1,1/0),Xe),[h.Id]:m(si,ct),[h.Concat]:m(p(2,1/0),I(Y)),[h.GeometryType]:m(oi,ct),[h.LineMetric]:m(ct),[h.Resolution]:m(le,ct),[h.Zoom]:m(le,ct),[h.Time]:m(le,ct),[h.Any]:m(p(2,1/0),I(F)),[h.All]:m(p(2,1/0),I(F)),[h.Not]:m(p(1,1),I(F)),[h.Equal]:m(p(2,2),I(zt)),[h.NotEqual]:m(p(2,2),I(zt)),[h.GreaterThan]:m(p(2,2),I(T)),[h.GreaterThanOrEqualTo]:m(p(2,2),I(T)),[h.LessThan]:m(p(2,2),I(T)),[h.LessThanOrEqualTo]:m(p(2,2),I(T)),[h.Multiply]:m(p(2,1/0),Pe),[h.Coalesce]:m(p(2,1/0),Pe),[h.Divide]:m(p(2,2),I(T)),[h.Add]:m(p(2,1/0),I(T)),[h.Subtract]:m(p(2,2),I(T)),[h.Clamp]:m(p(3,3),I(T)),[h.Mod]:m(p(2,2),I(T)),[h.Pow]:m(p(2,2),I(T)),[h.Abs]:m(p(1,1),I(T)),[h.Floor]:m(p(1,1),I(T)),[h.Ceil]:m(p(1,1),I(T)),[h.Round]:m(p(1,1),I(T)),[h.Sin]:m(p(1,1),I(T)),[h.Cos]:m(p(1,1),I(T)),[h.Atan]:m(p(1,2),I(T)),[h.Sqrt]:m(p(1,1),I(T)),[h.Match]:m(p(4,1/0),Fe,li),[h.Between]:m(p(3,3),I(T)),[h.Interpolate]:m(p(6,1/0),Fe,hi),[h.Case]:m(p(3,1/0),ai,ci),[h.In]:m(p(2,2),ui),[h.Number]:m(p(1,1/0),I(zt)),[h.String]:m(p(1,1/0),I(zt)),[h.Array]:m(p(1,1/0),I(T)),[h.Color]:m(p(1,4),I(T)),[h.Band]:m(p(1,3),I(T)),[h.Palette]:m(p(2,2),fi),[h.ToString]:m(p(1,1),I(F|T|Y|U))};function Xe(n,t,e){const i=n.length-1,r=new Array(i);for(let s=0;s<i;++s){const o=n[s+1];switch(typeof o){case"number":{r[s]=new C(T,o);break}case"string":{r[s]=new C(Y,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}s===0&&e.properties.add(String(o))}return r}function ri(n,t,e){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return e.variables.add(i),[new C(Y,i)]}function si(n,t,e){e.featureId=!0}function oi(n,t,e){e.geometryType=!0}function le(n,t,e){e.mapState=!0}function ct(n,t,e){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function p(n,t){return function(e,i,r){const s=e[0],o=e.length-1;if(n===t){if(o!==n){const a=n===1?"":"s";throw new Error(`expected ${n} argument${a} for ${s}, got ${o}`)}}else if(o<n||o>t){const a=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`expected ${a} arguments for ${s}, got ${o}`)}}}function Pe(n,t,e){const i=n.length-1,r=new Array(i);for(let s=0;s<i;++s){const o=b(n[s+1],t,e);r[s]=o}return r}function I(n){return function(t,e,i){const r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=b(t[o+1],n,i);s[o]=a}return s}}function ai(n,t,e){const i=n[0],r=n.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${r} instead`)}function Fe(n,t,e){const i=n[0],r=n.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${r} instead`)}function li(n,t,e){const i=n.length-1,r=Y|T|F,s=b(n[1],r,e),o=b(n[n.length-1],t,e),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const c=b(n[l+2],s.type,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{const c=b(n[l+3],o.type,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[s,...a,o]}function hi(n,t,e){const i=n[1];let r;switch(i[0]){case"linear":r=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);r=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const s=new C(T,r);let o;try{o=b(n[2],T,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(n.length-3);for(let l=0;l<a.length;l+=2){try{const c=b(n[l+3],T,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{const c=b(n[l+4],t,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[s,o,...a]}function ci(n,t,e){const i=b(n[n.length-1],t,e),r=new Array(n.length-1);for(let s=0;s<r.length-1;s+=2){try{const o=b(n[s+1],F,e);r[s]=o}catch(o){throw new Error(`failed to parse argument ${s} of case expression: ${o.message}`)}try{const o=b(n[s+2],i.type,e);r[s+1]=o}catch(o){throw new Error(`failed to parse argument ${s+1} of case expression: ${o.message}`)}}return r[r.length-1]=i,r}function ui(n,t,e){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],r=Y}else r=T;const s=new Array(i.length);for(let a=0;a<s.length;a++)try{const l=b(i[a],r,e);s[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[b(n[1],r,e),...s]}function fi(n,t,e){let i;try{i=b(n[1],T,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const r=n[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const s=new Array(r.length);for(let o=0;o<s.length;o++){let a;try{a=b(r[o],U,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof C))throw new Error(`the palette color at index ${o} must be a literal value`);s[o]=a}return[i,...s]}function m(...n){return function(t,e,i){const r=t[0];let s;for(let o=0;o<n.length;o++){const a=n[o](t,e,i);if(o==n.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");s=a}}return new ni(e,r,...s)}}function gi(n,t,e){const i=n[0],r=ii[i];if(!r)throw new Error(`unknown operator: ${i}`);return r(n,t,e)}function di(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return di(n.getGeometries()[0]);default:return""}}function Dr(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Nr(n,t,e){const i=b(n,t,e);return B(i)}function B(n,t){if(n instanceof C){if(n.type===U&&typeof n.value=="string"){const i=ye(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case h.Number:case h.String:case h.Coalesce:return mi(n);case h.Get:case h.Var:case h.Has:return pi(n);case h.Id:return i=>i.featureId;case h.GeometryType:return i=>i.geometryType;case h.Concat:{const i=n.args.map(r=>B(r));return r=>"".concat(...i.map(s=>s(r).toString()))}case h.Resolution:return i=>i.resolution;case h.Any:case h.All:case h.Between:case h.In:case h.Not:return yi(n);case h.Equal:case h.NotEqual:case h.LessThan:case h.LessThanOrEqualTo:case h.GreaterThan:case h.GreaterThanOrEqualTo:return _i(n);case h.Multiply:case h.Divide:case h.Add:case h.Subtract:case h.Clamp:case h.Mod:case h.Pow:case h.Abs:case h.Floor:case h.Ceil:case h.Round:case h.Sin:case h.Cos:case h.Atan:case h.Sqrt:return Ei(n);case h.Case:return xi(n);case h.Match:return wi(n);case h.Interpolate:return Ti(n);case h.ToString:return Mi(n);default:throw new Error(`Unsupported operator ${e}`)}}function mi(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=B(n.args[s]);switch(e){case h.Coalesce:return s=>{for(let o=0;o<i;++o){const a=r[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case h.Number:case h.String:return s=>{for(let o=0;o<i;++o){const a=r[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function pi(n,t){const i=n.args[0].value;switch(n.operator){case h.Get:return r=>{const s=n.args;let o=r.properties[i];for(let a=1,l=s.length;a<l;++a){const u=s[a].value;o=o[u]}return o};case h.Var:return r=>r.variables[i];case h.Has:return r=>{const s=n.args;if(!(i in r.properties))return!1;let o=r.properties[i];for(let a=1,l=s.length;a<l;++a){const u=s[a].value;if(!o||!Object.hasOwn(o,u))return!1;o=o[u]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function _i(n,t){const e=n.operator,i=B(n.args[0]),r=B(n.args[1]);switch(e){case h.Equal:return s=>i(s)===r(s);case h.NotEqual:return s=>i(s)!==r(s);case h.LessThan:return s=>i(s)<r(s);case h.LessThanOrEqualTo:return s=>i(s)<=r(s);case h.GreaterThan:return s=>i(s)>r(s);case h.GreaterThanOrEqualTo:return s=>i(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function yi(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=B(n.args[s]);switch(e){case h.Any:return s=>{for(let o=0;o<i;++o)if(r[o](s))return!0;return!1};case h.All:return s=>{for(let o=0;o<i;++o)if(!r[o](s))return!1;return!0};case h.Between:return s=>{const o=r[0](s),a=r[1](s),l=r[2](s);return o>=a&&o<=l};case h.In:return s=>{const o=r[0](s);for(let a=1;a<i;++a)if(o===r[a](s))return!0;return!1};case h.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function Ei(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=B(n.args[s]);switch(e){case h.Multiply:return s=>{let o=1;for(let a=0;a<i;++a)o*=r[a](s);return o};case h.Divide:return s=>r[0](s)/r[1](s);case h.Add:return s=>{let o=0;for(let a=0;a<i;++a)o+=r[a](s);return o};case h.Subtract:return s=>r[0](s)-r[1](s);case h.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case h.Mod:return s=>r[0](s)%r[1](s);case h.Pow:return s=>Math.pow(r[0](s),r[1](s));case h.Abs:return s=>Math.abs(r[0](s));case h.Floor:return s=>Math.floor(r[0](s));case h.Ceil:return s=>Math.ceil(r[0](s));case h.Round:return s=>Math.round(r[0](s));case h.Sin:return s=>Math.sin(r[0](s));case h.Cos:return s=>Math.cos(r[0](s));case h.Atan:return i===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case h.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function xi(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=B(n.args[r]);return r=>{for(let s=0;s<e-1;s+=2)if(i[s](r))return i[s+1](r);return i[e-1](r)}}function wi(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=B(n.args[r]);return r=>{const s=i[0](r);for(let o=1;o<e-1;o+=2)if(s===i[o](r))return i[o+1](r);return i[e-1](r)}}function Ti(n,t){const e=n.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=B(n.args[r]);return r=>{const s=i[0](r),o=i[1](r);let a,l;for(let c=2;c<e;c+=2){const u=i[c](r);let f=i[c+1](r);const R=Array.isArray(f);if(R&&(f=Vn(f)),u>=o)return c===2?f:R?Ii(s,o,a,l,u,f):bt(s,o,a,l,u,f);a=u,l=f}return l}}function Mi(n,t){const e=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=B(n.args[s]);switch(e){case h.ToString:return s=>{const o=r[0](s);return n.args[0].type===U?Qe(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function bt(n,t,e,i,r,s){const o=r-e;if(o===0)return i;const a=t-e,l=n===1?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1);return i+l*(s-i)}function Ii(n,t,e,i,r,s){if(r-e===0)return i;const a=Oe(i),l=Oe(s);let c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);const u=[bt(n,t,e,a[0],r,l[0]),bt(n,t,e,a[1],r,l[1]),a[2]+bt(n,t,e,0,r,c),bt(n,t,e,i[3],r,s[3])];return Qn(u)}const At={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Gr extends ze{constructor(t,e,i,r){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=typeof r=="function"?At.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(et.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==At.IDLE&&this.loader){this.state=At.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;mn(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||We&&i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=At.LOADED}).catch(i=>{this.state=At.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Ai(n,t,e){const i=n;let r=!0,s=!1,o=!1;const a=[Ie(i,et.LOAD,function(){o=!0,s||t()})];return i.src&&pe?(s=!0,i.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(Ie(i,et.ERROR,e)),function(){r=!1,a.forEach(tt)}}function Ri(n,t){return new Promise((e,i)=>{function r(){o(),e(n)}function s(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s)})}function Li(n,t){return t&&(n.src=t),n.src&&pe?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(r=>n.complete&&n.width?e(n):i(r))):Ri(n)}function Zr(n,t){return t&&(n.src=t),n.src&&pe&&We?n.decode().then(()=>createImageBitmap(n)).catch(e=>{if(n.complete&&n.width)return n;throw e}):Li(n)}class Je extends ze{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(et.CHANGE)}release(){this.setState(x.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==x.EMPTY){if(this.state!==x.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Ot()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const r=e-i+1e3/60;return r>=this.transition_?1:ke(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class Si extends Je{constructor(t,e,i,r,s,o){super(t,e,o),this.crossOrigin_=r==null?void 0:r.crossOrigin,this.referrerPolicy_=r==null?void 0:r.referrerPolicy,this.src_=i,this.key=i,this.image_,jt?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==void 0&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=x.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}getReferrerPolicy(){return this.referrerPolicy_}handleImageError_(){this.state=x.ERROR,this.unlistenImage_(),this.image_=Ci(),this.changed()}handleImageLoad_(){if(jt)this.state=x.LOADED;else{const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=x.LOADED:this.state=x.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==x.ERROR&&(this.state=x.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==void 0&&(this.image_.referrerPolicy=this.referrerPolicy_)),this.state==x.IDLE&&(this.state=x.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ai(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function Ci(){const n=_t(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}let he;const pt=[];function Ye(n,t,e,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),n.restore()}function ce(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function vi(){if(he===void 0){const n=_t(6,6,pt);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Ye(n,4,5,4,0),Ye(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;he=ce(t,0)||ce(t,4)||ce(t,8),_e(n),pt.push(n.canvas)}return he}function De(n,t,e,i){const r=Be(e,t,n);let s=Ae(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=n.getMetersPerUnit();a!==void 0&&(s/=a);const l=n.getExtent();if(!l||je(l,r)){const c=Ae(n,s,r)/s;isFinite(c)&&c>0&&(s/=c)}return s}function bi(n,t,e,i){const r=yn(e);let s=De(n,t,r,i);return(!isFinite(s)||s<=0)&&En(e,function(o){return s=De(n,t,o,i),isFinite(s)&&s>0}),s}function Oi(n,t,e,i,r,s,o,a,l,c,u,f,R,v){const g=_t(Math.round(e*n),Math.round(e*t),pt);if(f||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function _(d){return Math.round(d*e)/e}g.globalCompositeOperation="lighter";const M=Ue();l.forEach(function(d,D,j){pn(M,d.extent)});let y;const w=e/i,A=(f?1:1+Math.pow(2,-24))/w;if(!R||l.length!==1||c!==0){if(y=_t(Math.round(P(M)*w),Math.round(gt(M)*w),pt),f||(y.imageSmoothingEnabled=!1),r&&v){const d=(r[0]-M[0])*w,D=-(r[3]-M[3])*w,j=P(r)*w,S=gt(r)*w;y.rect(d,D,j,S),y.clip()}l.forEach(function(d,D,j){if(d.image.width>0&&d.image.height>0){if(d.clipExtent){y.save();const X=(d.clipExtent[0]-M[0])*w,G=-(d.clipExtent[3]-M[3])*w,W=P(d.clipExtent)*w,st=gt(d.clipExtent)*w;y.rect(f?X:Math.round(X),f?G:Math.round(G),f?W:Math.round(X+W)-Math.round(X),f?st:Math.round(G+st)-Math.round(G)),y.clip()}const S=(d.extent[0]-M[0])*w,O=-(d.extent[3]-M[3])*w,N=P(d.extent)*w,Z=gt(d.extent)*w;y.drawImage(d.image,c,c,d.image.width-2*c,d.image.height-2*c,f?S:Math.round(S),f?O:Math.round(O),f?N:Math.round(S+N)-Math.round(S),f?Z:Math.round(O+Z)-Math.round(O)),d.clipExtent&&y.restore()}})}const E=me(o);return a.getTriangles().forEach(function(d,D,j){const S=d.source,O=d.target;let N=S[0][0],Z=S[0][1],X=S[1][0],G=S[1][1],W=S[2][0],st=S[2][1];const yt=_((O[0][0]-E[0])/s),Et=_(-(O[0][1]-E[1])/s),ot=_((O[1][0]-E[0])/s),at=_(-(O[1][1]-E[1])/s),Wt=_((O[2][0]-E[0])/s),kt=_(-(O[2][1]-E[1])/s),qt=N,Kt=Z;N=0,Z=0,X-=qt,G-=Kt,W-=qt,st-=Kt;const an=[[X,G,0,0,ot-yt],[W,st,0,0,Wt-yt],[0,0,X,G,at-Et],[0,0,W,st,kt-Et]],xt=_n(an);if(!xt)return;if(g.save(),g.beginPath(),vi()||!f){g.moveTo(ot,at);const $=4,Tt=yt-ot,Te=Et-at;for(let J=0;J<$;J++)g.lineTo(ot+_((J+1)*Tt/$),at+_(J*Te/($-1))),J!=$-1&&g.lineTo(ot+_((J+1)*Tt/$),at+_((J+1)*Te/($-1)));g.lineTo(Wt,kt)}else g.moveTo(ot,at),g.lineTo(yt,Et),g.lineTo(Wt,kt);g.clip(),g.transform(xt[0],xt[2],xt[1],xt[3],yt,Et),g.translate(M[0]-qt,M[3]-Kt);let wt;if(y)wt=y.canvas,g.scale(A,-A);else{const $=l[0],Tt=$.extent;wt=$.image,g.scale(P(Tt)/wt.width,-gt(Tt)/wt.height)}g.drawImage(wt,0,0),g.restore()}),y&&(_e(y),pt.push(y.canvas)),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(d,D,j){const S=d.target,O=(S[0][0]-E[0])/s,N=-(S[0][1]-E[1])/s,Z=(S[1][0]-E[0])/s,X=-(S[1][1]-E[1])/s,G=(S[2][0]-E[0])/s,W=-(S[2][1]-E[1])/s;g.beginPath(),g.moveTo(Z,X),g.lineTo(O,N),g.lineTo(G,W),g.closePath(),g.stroke()}),g.restore()),g.canvas}const Xi=10,Ne=.25;class Pi{constructor(t,e,i,r,s,o,a){this.sourceProj_=t,this.targetProj_=e;let l={};const c=a?xn(A=>Rn(a,Be(A,this.targetProj_,this.sourceProj_))):wn(this.targetProj_,this.sourceProj_);this.transformInv_=function(A){const E=A[0]+"/"+A[1];return l[E]||(l[E]=c(A)),l[E]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&P(r)>=P(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?P(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?P(this.targetProj_.getExtent()):null;const u=me(i),f=Tn(i),R=Mn(i),v=In(i),g=this.transformInv_(u),_=this.transformInv_(f),M=this.transformInv_(R),y=this.transformInv_(v),w=Xi+(o?Math.max(0,Math.ceil(Math.log2(fe(i)/(o*o*256*256)))):0);if(this.addQuad_(u,f,R,v,g,_,M,y,w),this.wrapsXInSource_){let A=1/0;this.triangles_.forEach(function(E,d,D){A=Math.min(A,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-A>this.sourceWorldWidth_/2){const d=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];d[0][0]-A>this.sourceWorldWidth_/2&&(d[0][0]-=this.sourceWorldWidth_),d[1][0]-A>this.sourceWorldWidth_/2&&(d[1][0]-=this.sourceWorldWidth_),d[2][0]-A>this.sourceWorldWidth_/2&&(d[2][0]-=this.sourceWorldWidth_);const D=Math.min(d[0][0],d[1][0],d[2][0]);Math.max(d[0][0],d[1][0],d[2][0])-D<this.sourceWorldWidth_/2&&(E.source=d)}})}l={}}addTriangle_(t,e,i,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,i]})}addQuad_(t,e,i,r,s,o,a,l,c){const u=Re([s,o,a,l]),f=this.sourceWorldWidth_?P(u)/this.sourceWorldWidth_:null,R=this.sourceWorldWidth_,v=this.sourceProj_.canWrapX()&&f>.5&&f<1;let g=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const M=Re([t,e,i,r]);g=P(M)/this.targetWorldWidth_>Ne||g}!v&&this.sourceProj_.isGlobal()&&f&&(g=f>Ne||g)}if(!g&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!An(u,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)g=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(c>0){if(!g){const M=[(t[0]+i[0])/2,(t[1]+i[1])/2],y=this.transformInv_(M);let w;v?w=(Xt(s[0],R)+Xt(a[0],R))/2-Xt(y[0],R):w=(s[0]+a[0])/2-y[0];const A=(s[1]+a[1])/2-y[1];g=w*w+A*A>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const M=[(e[0]+i[0])/2,(e[1]+i[1])/2],y=this.transformInv_(M),w=[(r[0]+t[0])/2,(r[1]+t[1])/2],A=this.transformInv_(w);this.addQuad_(t,e,M,w,s,o,y,A,c-1),this.addQuad_(w,M,i,r,A,y,a,l,c-1)}else{const M=[(t[0]+e[0])/2,(t[1]+e[1])/2],y=this.transformInv_(M),w=[(i[0]+r[0])/2,(i[1]+r[1])/2],A=this.transformInv_(w);this.addQuad_(t,M,w,r,s,y,A,l,c-1),this.addQuad_(M,e,i,w,y,o,a,A,c-1)}return}}if(v){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,i,r,s,a,l),_&14||this.addTriangle_(t,i,e,s,a,o),_&&(_&13||this.addTriangle_(e,r,t,o,l,s),_&7||this.addTriangle_(e,r,i,o,l,a))}calculateSourceExtent(){const t=Ue();return this.triangles_.forEach(function(e,i,r){const s=e.source;Ht(t,s[0]),Ht(t,s[1]),Ht(t,s[2])}),t}getTriangles(){return this.triangles_}}const Fi=.5;class Yi extends Je{constructor(t,e,i,r,s,o,a,l,c,u,f,R){super(s,x.IDLE,R),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const v=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const M=g?Bt(v,g):v;if(fe(M)===0){this.state=x.EMPTY;return}const y=t.getExtent();y&&(_?_=Bt(_,y):_=y);const w=r.getResolution(this.wrappedTileCoord_[0]),A=bi(t,i,M,w);if(!isFinite(A)||A<=0){this.state=x.EMPTY;return}const E=u!==void 0?u:Fi;if(this.triangulation_=new Pi(t,i,M,_,A*E,w),this.triangulation_.getTriangles().length===0){this.state=x.EMPTY;return}this.sourceZ_=e.getZForResolution(A);let d=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(d[1]=z(d[1],_[1],_[3]),d[3]=z(d[3],_[1],_[3])):d=Bt(d,_)),!fe(d))this.state=x.EMPTY;else{let D=0,j=0;t.canWrapX()&&(D=P(y),j=Math.floor((d[0]-y[0])/D)),Ln(d.slice(),t,!0).forEach(O=>{const N=e.getTileRangeForExtentAndZ(O,this.sourceZ_);for(let Z=N.minX;Z<=N.maxX;Z++)for(let X=N.minY;X<=N.maxY;X++){const G=j*D;this.sourceTiles_.push({getTile:()=>c(this.sourceZ_,Z,X,a),offset:G})}++j}),this.sourceTiles_.length===0&&(this.state=x.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var r;const i=e.tile;if(i&&i.getState()==x.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const o=(r=this.clipExtent_)==null?void 0:r.slice();o&&(o[0]+=e.offset,o[2]+=e.offset),t.push({extent:s,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=x.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Oi(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=x.LOADED}this.changed()}load(){for(const t of this.sourceTiles_)t.tile=t.getTile();if(this.state==x.IDLE){this.state=x.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==x.IDLE||i==x.LOADING){t++;const r=H(e,et.CHANGE,s=>{const o=e.getState();(o==x.LOADED||o==x.ERROR||o==x.EMPTY)&&(tt(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,r){e.getState()==x.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(tt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(_e(this.canvas_.getContext("2d")),pt.push(this.canvas_),this.canvas_=null),this.sourceTiles_.length=0,super.release()}}class tn{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ut(n,t,e,i,r){return r!==void 0?(r.minX=n,r.maxX=t,r.minY=e,r.maxY=i,r):new tn(n,t,e,i)}function Ge(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function en(n,t,e){return n+"/"+t+"/"+e}function zr(n){return en(n[0],n[1],n[2])}function Di(n,t,e,i,r){return`${nt(n)},${t},${en(e,i,r)}`}function Ni(n){return nn(n[0],n[1],n[2])}function nn(n,t,e){return(t<<n)+e}function Gi(n,t){const e=n[0],i=n[1],r=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(i,r):!0}const ft=[0,0,0],K=5;class rn{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,V(Sn(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,V(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=me(i)),V(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,V(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:qe,V(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new tn(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)i([e,s,a])}forEachTileCoordParentTileRange(t,e,i,r){let s,o,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=ut(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,c,i),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getOrigins(){return this.origins_}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return ut(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return ut(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),c=Math.floor(s*l),u=Math.floor(o*l);if(e<r)return ut(c,c,u,u,i);const f=Math.floor(l*(s+1))-1,R=Math.floor(l*(o+1))-1;return ut(c,f,u,R,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ft);const r=ft[1],s=ft[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ft);const o=ft[1],a=ft[2];return ut(r,o,s,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=Q(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=Q(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*s[0]*r,a=i[1]-(t[2]+1)*s[1]*r,l=o+s[0]*r,c=a+s[1]*r;return $e(o,a,l,c,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),c=Q(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/i/c[0],f=a*(l[1]-e)/i/c[1];return r?(u=Ft(u,K)-1,f=Ft(f,K)-1):(u=Yt(u,K),f=Yt(f,K)),Ge(o,u,f,s)}getTileCoordForXYAndZ_(t,e,i,r,s){const o=this.getOrigin(i),a=this.getResolution(i),l=Q(this.getTileSize(i),this.tmpSize_);let c=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return r?(c=Ft(c,K)-1,u=Ft(u,K)-1):(c=Yt(c,K),u=Yt(u,K)),Ge(i,c,u,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=Cn(this.resolutions_,t,e||0);return z(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return vn(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}function sn(n){let t=n.getDefaultTileGrid();return t||(t=ji(n),n.setDefaultTileGrid(t)),t}function Zi(n,t,e){const i=t[0],r=n.getTileCoordCenter(t),s=xe(e);if(!je(s,r)){const o=P(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,n.getTileCoordForCoordAndZ(r,i)}return t}function zi(n,t,e,i){i=i!==void 0?i:"top-left";const r=on(n,t,e);return new rn({extent:n,origin:On(n,i),resolutions:r,tileSize:e})}function Bi(n){const t=n||{},e=t.extent||$t("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:on(e,t.maxZoom,t.tileSize,t.maxResolution)};return new rn(i)}function on(n,t,e,i){t=t!==void 0?t:Fn,e=Q(e!==void 0?e:qe);const r=gt(n),s=P(n);i=i>0?i:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function ji(n,t,e,i){const r=xe(n);return zi(r,t,e,i)}function xe(n){n=$t(n);let t=n.getExtent();if(!t){const e=180*bn.degrees/n.getMetersPerUnit();t=$e(-e,-e,e,e)}return t}class Ui extends Ut{constructor(t){super(),this.projection=$t(t.projection),this.attributions_=Ze(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ze(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ze(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}class $i extends Ui{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Q(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||nt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,s,o){return Ot()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:sn(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),o=Q(r.getTileSize(t),this.tmpSize);return s==1?o:Jn(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),r=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=Zi(r,t,i)),Gi(t,r)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Wi extends de{constructor(t,e){super(t),this.tile=e}}const ue={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function Br(n,t){const e=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&e.push(r+"="+encodeURIComponent(t[r]))});const i=e.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const ki=/\{z\}/g,qi=/\{x\}/g,Ki=/\{y\}/g,Hi=/\{-y\}/g;function Vi(n,t,e,i,r){return n.replace(ki,t.toString()).replace(qi,e.toString()).replace(Ki,i.toString()).replace(Hi,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function jr(n,t,e,i){const r=nn(t,e,i),s=Xt(r,n.length);return n[s]}function Qi(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=i;s<=r;++s)t.push(n.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(n.replace(e[0],r.toString()));return t}return t.push(n),t}function Ji(n,t){return function(e,i,r){if(!e)return;let s;const o=e[0];if(t){const a=t.getFullTileRange(o);a&&(s=a.getHeight()-1)}return Vi(n,o,e[1],e[2],s)}}function tr(n,t){const e=n.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=Ji(n[r],t);return er(i)}function er(n){return n.length===1?n[0]:function(t,e,i){if(!t)return;const r=Ni(t),s=Xt(r,n.length);return n[s](t,e,i)}}function Ur(n,t,e){}class we extends $i{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===we.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=nt(e),r=e.getState();let s;r==x.LOADING?(this.tileLoadingKeys_[i]=!0,s=ue.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==x.ERROR?ue.TILELOADERROR:r==x.LOADED?ue.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Wi(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Qi(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(tr(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}class nr extends we{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ir,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.referrerPolicy=t.referrerPolicy,this.tileClass=t.tileClass!==void 0?t.tileClass:Si,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Vt(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Vt(e,t)))return this.tileGrid;const i=nt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=sn(t)),this.tileGridForProjection[i]}createTile_(t,e,i,r,s,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,s),c=l?this.tileUrlFunction(l,r,s):void 0,u=new this.tileClass(a,c!==void 0?x.IDLE:x.EMPTY,c!==void 0?c:"",{crossOrigin:this.crossOrigin,referrerPolicy:this.referrerPolicy},this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(et.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,r,s,o){const a=this.getProjection();if(!a||!s||Vt(a,s))return this.getTileInternal(t,e,i,r,a||s);const l=[t,e,i],c=this.getKey(),u=this.getTileGridForProjection(a),f=this.getTileGridForProjection(s),R=this.getTileCoordForTileUrlFunction(l,s),v=new Yi(a,u,s,f,l,R,this.getTilePixelRatio(r),this.getGutter(),(g,_,M,y)=>this.getTileInternal(g,_,M,y,a,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return v.key=c,v}getTileInternal(t,e,i,r,s,o){const a=this.getKey(),l=Di(this,a,t,e,i);if(o&&o.containsKey(l))return o.get(l);const c=this.createTile_(t,e,i,r,s,a);return o==null||o.set(l,c),c}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=$t(t);if(i){const r=nt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}}function ir(n,t){if(jt){const e=n.getCrossOrigin();let i="same-origin",r="same-origin";e==="anonymous"||e===""?(i="cors",r="omit"):e==="use-credentials"&&(i="cors",r="include");const s={mode:i,credentials:r,referrerPolicy:n.getReferrerPolicy()};fetch(t,s).then(o=>{if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.blob()}).then(o=>createImageBitmap(o)).then(o=>{var c;const a=n.getImage();a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0),(c=o.close)==null||c.call(o),a.dispatchEvent(new Event("load"))}).catch(()=>{n.getImage().dispatchEvent(new Event("error"))});return}n.getImage().src=t}class $r extends nr{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Bi({extent:xe(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,referrerPolicy:t.referrerPolicy,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}export{zr as $,er as A,Pr as B,Se as C,Fn as D,Fi as E,pr as F,Rr as G,Pn as H,Gr as I,Mr as J,Ir as K,Ke as L,ur as M,$i as N,fr as O,xr as P,or as Q,br as R,Ui as S,rn as T,we as U,Si as V,Yi as W,$r as X,L as Y,tn as Z,Ge as _,mt as a,b as a0,ni as a1,T as a2,F as a3,Y as a4,U as a5,ge as a6,St as a7,Ct as a8,h as a9,lt as aA,Fr as aB,jr as aC,Vi as aD,Jn as aE,tr as aF,Ur as aG,en as aH,q as aa,jt as ab,bi as ac,Di as ad,Wi as ae,ue as af,cr as ag,gr as ah,qe as ai,mr as aj,dr as ak,ar as al,lr as am,Dn as an,Tr as ao,Li as ap,Xr as aq,Qe as ar,wr as as,ve as at,Un as au,di as av,Sr as aw,Lr as ax,Cr as ay,hr as az,vr as b,_r as c,Er as d,yr as e,Bi as f,Nr as g,Dr as h,De as i,Pi as j,At as k,Oi as l,Br as m,Yr as n,Zr as o,nr as p,Ni as q,Ar as r,Je as s,_t as t,_e as u,x as v,xe as w,sn as x,Q as y,Qi as z};
