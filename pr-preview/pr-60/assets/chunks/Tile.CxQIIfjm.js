var _n=Object.defineProperty;var mn=(n,e,t)=>e in n?_n(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var hi=(n,e,t)=>mn(n,typeof e!="symbol"?e+"":e,t);import{af as Ni,v as P,ag as yn,b as Kt,c as st,d as Vt,O as ci,G as pn,r as ui,ah as qe,C as ie,ai as En,aj as Wt,ak as Cn,W as be,k as v,al as Qe,B as _e,t as Y,am as vn,an as Rn,ao as wn,ap as Tt,aa as le,aq as In,y as xe,h as zi,g as q,ar as Fi,as as Tn,a2 as Ki,a1 as Zt,a3 as xn,a4 as An,a5 as rt,n as Vi,R as Ln,at as Wi,au as bn,av as he,aw as Pn,M as k,a as Ee,H as ue,ax as di,ay as fi,L as at,s as Dn,Y as On,Z as gi,ac as pt,Q as Sn,V as Mn}from"./XYZ.khqhGb_1.js";import{B as Gt,E as w,ak as Zi,l as D,u as Z,aj as Gi,n as S,q as Ui,s as ot,ag as _i,V as kn,al as Nn,aa as Ut,T as et,F as ze,ao as jt,P as zn,a as N,m as Q,i as Fn,_ as tt,aq as ji,O as xt,ar as Kn,a1 as Se,a3 as V,as as Vn,at as Wn,au as Zn,a4 as Gn}from"./Polygon.FVLon8Z8.js";import{m as $,E as Fe,F as lt,V as Un,aw as Ht,o as J,S as fe,N as mi,ax as Bt,ay as jn,ak as At,a9 as Hn,H as Lt,D as Hi,d as bt,ai as Pt,az as Bn,ao as Xn,aA as Yn,i as Bi,a1 as qn,y as Dt,b as $n,a4 as Jn,aB as Qn,u as Xi,r as es,q as ts,p as is,L as ns,w as ss,T as rs,au as as,C as Ot}from"./proj.DNHHD1fb.js";import{i as os,e as Ae,l as ls}from"./easing.vFiYzKl6.js";class Re extends Gt{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class oe extends Re{constructor(e,t,i,s,r,a){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const L={SINGLECLICK:"singleclick",CLICK:w.CLICK,DBLCLICK:w.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},St={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROUT:"pointerout"};class hs extends Zi{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=D(i,St.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=D(i,St.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(w.TOUCHMOVE,this.boundHandleTouchMove_,Ni?{passive:!1}:!1)}emulateClick_(e){let t=new oe(L.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new oe(L.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new oe(L.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==L.POINTERUP||t.type==L.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==L.POINTERDOWN||t.type==L.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new oe(L.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Z),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new oe(L.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(D(i,L.POINTERMOVE,this.handlePointerMove_,this),D(i,L.POINTERUP,this.handlePointerUp_,this),D(this.element_,L.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(D(this.element_.getRootNode(),L.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new oe(L.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new oe(L.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Z(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(w.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Z(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Z),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const it=1/0;class cs{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Gi(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(e){S(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=it?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,s=t.length,r=t[e],a=i[e],o=e;for(;e<s>>1;){const l=this.getLeftChildIndex_(e),c=this.getRightChildIndex_(e),h=c<s&&i[c]<i[l]?c:l;t[e]=t[h],i[e]=i[h],e=h}t[e]=r,i[e]=a,this.siftDown_(o,e)}siftDown_(e,t){const i=this.elements_,s=this.priorities_,r=i[t],a=s[t];for(;t>e;){const o=this.getParentIndex_(t);if(s[o]>a)i[t]=i[o],s[t]=s[o],t=o;else break}i[t]=r,s[t]=a}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let s=0;const r=t.length;let a,o,l;for(o=0;o<r;++o)a=t[o],l=e(a),l==it?delete this.queuedElements_[this.keyFunction_(a)]:(i[s]=l,t[s++]=a);t.length=s,i.length=s,this.heapify_()}}class us extends cs{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(w.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===P.LOADED||i===P.ERROR||i===P.EMPTY){i!==P.ERROR&&t.removeEventListener(w.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===P.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,s.load())}}}function ds(n,e,t,i,s){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return it;const r=n.viewState.center,a=i[0]-r[0],o=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(a*a+o*o)/s}const W={ANIMATING:0,INTERACTING:1},U={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function yi(n,e,t){return function(i,s,r,a,o){if(!i)return;if(!s&&!e)return i;const l=e?0:r[0]*s,c=e?0:r[1]*s,h=o?o[0]:0,u=o?o[1]:0;let d=n[0]+l/2+h,f=n[2]-l/2+h,g=n[1]+c/2+u,m=n[3]-c/2+u;d>f&&(d=(f+d)/2,f=d),g>m&&(g=(m+g)/2,m=g);let _=$(i[0],d,f),y=$(i[1],g,m);if(a&&t&&s){const I=30*s;_+=-I*Math.log(1+Math.max(0,d-i[0])/I)+I*Math.log(1+Math.max(0,i[0]-f)/I),y+=-I*Math.log(1+Math.max(0,g-i[1])/I)+I*Math.log(1+Math.max(0,i[1]-m)/I)}return[_,y]}}function fs(n){return n}function Xt(n,e,t,i){const s=Fe(e)/t[0],r=lt(e)/t[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function Yt(n,e,t){let i=Math.min(n,e);const s=50;return i*=Math.log(1+s*Math.max(0,n/e-1))/s+1,t&&(i=Math.max(i,t),i/=Math.log(1+s*Math.max(0,t/n-1))/s+1),$(i,t/2,e*2)}function gs(n,e,t,i){return e=e!==void 0?e:!0,function(s,r,a,o){if(s!==void 0){const l=n[0],c=n[n.length-1],h=t?Xt(l,t,a,i):l;if(o)return e?Yt(s,h,c):$(s,c,h);const u=Math.min(h,s),d=Math.floor(Ui(n,u,r));return n[d]>h&&d<n.length-1?n[d+1]:n[d]}}}function _s(n,e,t,i,s,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(a,o,l,c){if(a!==void 0){const h=s?Xt(e,s,l,r):e;if(c)return i?Yt(a,h,t):$(a,t,h);const u=1e-9,d=Math.ceil(Math.log(e/h)/Math.log(n)-u),f=-o*(.5-u)+.5,g=Math.min(h,a),m=Math.floor(Math.log(e/g)/Math.log(n)+f),_=Math.max(d,m),y=e/Math.pow(n,_);return $(y,t,h)}}}function pi(n,e,t,i,s){return t=t!==void 0?t:!0,function(r,a,o,l){if(r!==void 0){const c=i?Xt(n,i,o,s):n;return!t||!l?$(r,e,c):Yt(r,c,e)}}}function qt(n){if(n!==void 0)return 0}function Ei(n){if(n!==void 0)return n}function ms(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function ys(n){const e=Un(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}const Et=0;class te extends ot{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ht(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Bn(),e.center&&(e.center=J(e.center,this.projection_)),e.extent&&(e.extent=fe(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const o in U)delete t[o];this.setProperties(t,!0);const i=Es(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const s=ps(e),r=i.constraint,a=Cs(e);this.constraints_={center:s,resolution:r,rotation:a},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),a=r/2*(s[3]-t[3]+t[1]-s[1]),o=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([i[0]+a,i[1]-o])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=J(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=J(s.anchor,this.getProjection())),t[i]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const h=arguments[s];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(s===t){i&&$e(i,!0);return}let r=Date.now(),a=this.targetCenter_.slice(),o=this.targetResolution_,l=this.targetRotation_;const c=[];for(;s<t;++s){const h=arguments[s],u={start:r,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||os,callback:i};if(h.center&&(u.sourceCenter=a,u.targetCenter=h.center.slice(),a=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=o,u.targetResolution=this.getResolutionForZoom(h.zoom),o=u.targetResolution):h.resolution&&(u.sourceResolution=o,u.targetResolution=h.resolution,o=u.targetResolution),h.rotation!==void 0){u.sourceRotation=l;const d=mi(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}vs(u)?u.complete=!0:r+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(W.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[W.ANIMATING]>0}getInteracting(){return this.hints_[W.INTERACTING]>0}cancelAnimations(){this.setHint(W.ANIMATING,-this.hints_[W.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const s=this.animations_[t];if(s[0].callback&&$e(s[0].callback,!1),!e)for(let r=0,a=s.length;r<a;++r){const o=s[r];if(!o.complete){e=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let a=0,o=s.length;a<o;++a){const l=s[a];if(l.complete)continue;const c=e-l.start;let h=l.duration>0?c/l.duration:1;h>=1?(l.complete=!0,h=1):r=!1;const u=l.easing(h);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const _=d+u*(g-d),y=f+u*(m-f);this.targetCenter_=[_,y]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?mi(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(W.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&$e(a,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-t[0],s[1]-t[1]],Bt(i,e-this.getRotation()),jn(i,t)),i}calculateCenterZoom(e,t){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const a=t[0]-e*(t[0]-s[0])/r,o=t[1]-e*(t[1]-s[1])/r;i=[a,o]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],s=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&At(e,this.getProjection())}getCenterInternal(){return this.get(U.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Hn(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();S(t,"The view center is not defined");const i=this.getResolution();S(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return S(s!==void 0,"The view rotation is not defined"),Lt(t,i,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(U.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(fe(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Fe(e)/t[0],s=lt(e)/t[1];return Math.max(i,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*s)}}getRotation(){return this.get(U.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/t;return function(a){return Math.log(i/a)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const a=this.getViewportSizeMinusPadding_();s=Ct(s,this.getViewportSize_(),[a[0]/2+r[3],a[1]/2+r[0]],t,i)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,s;if(this.resolutions_){const r=Ui(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(i/e)/Math.log(s)}getResolutionForZoom(e){var t;if((t=this.resolutions_)!=null&&t.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=$(Math.floor(e),0,this.resolutions_.length-2),s=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(s,$(e-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(S(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){S(!Hi(e),"Cannot fit empty extent provided as `geometry`");const s=fe(e,this.getProjection());i=_i(s)}else if(e.getType()==="Circle"){const s=fe(e.getExtent(),this.getProjection());i=_i(s),i.rotate(this.getRotation(),bt(s))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),a=e.getStride();let o=1/0,l=1/0,c=-1/0,h=-1/0;for(let u=0,d=r.length;u<d;u+=a){const f=r[u]*i-r[u+1]*s,g=r[u]*s+r[u+1]*i;o=Math.min(o,f),l=Math.min(l,g),c=Math.max(c,f),h=Math.max(h,g)}return[o,l,c,h]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let a;t.minResolution!==void 0?a=t.minResolution:t.maxZoom!==void 0?a=this.getResolutionForZoom(t.maxZoom):a=0;const o=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(o,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);l=isNaN(l)?a:Math.max(l,a),l=this.getConstrainedResolution(l,r?0:1);const c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),d=bt(o);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*h,g=d[1]*u+d[0]*h,m=this.getConstrainedCenter([f,g],l),_=t.callback?t.callback:kn;t.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:t.duration,easing:t.easing},_):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),$e(_,!0))}centerOn(e,t,i){this.centerOnInternal(J(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Ct(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,s){let r;const a=this.padding_;if(a&&e){const o=this.getViewportSizeMinusPadding_(-i),l=Ct(e,s,[o[0]/2+a[3],o[1]/2+a[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=At(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&J(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=J(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&J(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,r,i),o=this.constraints_.center(this.targetCenter_,a,r,i,this.calculateCenterShift(this.targetCenter_,a,s,r));this.get(U.ROTATION)!==s&&this.set(U.ROTATION,s),this.get(U.RESOLUTION)!==a&&(this.set(U.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(U.CENTER)||!Pt(this.get(U.CENTER),o))&&this.set(U.CENTER,o),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,s,a),l=this.constraints_.center(this.targetCenter_,o,a,!1,this.calculateCenterShift(this.targetCenter_,o,r,a));if(e===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==r||!this.getCenterInternal()||!Pt(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:o,duration:e,easing:Ae,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(W.INTERACTING,1)}endInteraction(e,t,i){i=i&&J(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(W.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function $e(n,e){setTimeout(function(){n(e)},0)}function ps(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return yi(n.extent,n.constrainOnlyCenter,t)}const e=Ht(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,yi(t,!1,!1)}return fs}function Es(n){let e,t,i,a=n.minZoom!==void 0?n.minZoom:Et,o=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,c=n.multiWorld!==void 0?n.multiWorld:!1,h=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,u=n.showFullExtent!==void 0?n.showFullExtent:!1,d=Ht(n.projection,"EPSG:3857"),f=d.getExtent();let g=n.constrainOnlyCenter,m=n.extent;if(!c&&!m&&d.isGlobal()&&(g=!1,m=f),n.resolutions!==void 0){const _=n.resolutions;t=_[a],i=_[o]!==void 0?_[o]:_[_.length-1],n.constrainResolution?e=gs(_,h,!g&&m,u):e=pi(t,i,h,!g&&m,u)}else{const y=(f?Math.max(Fe(f),lt(f)):360*Xn.degrees/d.getMetersPerUnit())/yn/Math.pow(2,Et),I=y/Math.pow(2,28-Et);t=n.maxResolution,t!==void 0?a=0:t=y/Math.pow(l,a),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(l,o):i=y/Math.pow(l,o):i=I),o=a+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,o-a),n.constrainResolution?e=_s(l,t,i,h,!g&&m,u):e=pi(t,i,h,!g&&m,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:a,zoomFactor:l}}function Cs(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?ys():t===!1?Ei:typeof t=="number"?ms(t):Ei}return qt}function vs(n){return!(n.sourceCenter&&n.targetCenter&&!Pt(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function Ct(n,e,t,i,s){const r=Math.cos(-s);let a=Math.sin(-s),o=n[0]*r-n[1]*a,l=n[1]*r+n[0]*a;o+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,a=-a;const c=o*r-l*a,h=l*r+o*a;return[c,h]}function Kr(n){return function(e){if(!e.resolutions)return e;const t=[...e.resolutions],i=t[t.length-1];for(let s=0;s<n;++s)t.push(i/Math.pow(2,s+1));return{...e,resolutions:t}}}function Vr(n){return function(e){if(!e.resolutions)return e;const t=[...e.resolutions],i=t[0];for(let s=0;s<n;++s)t.unshift(i*Math.pow(2,s+1));return{...e,resolutions:t}}}function Wr(){return function(n){if(!n.extent)return n;const e=bt(n.extent),t={...n,center:e};return delete t.extent,t}}function Zr(n){return function(e){return{...e,zoom:n}}}async function Gr(n,...e){let t=await n.getView();for(const i of e)t=i(t);return t}class Rs extends Kt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"›",a=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=a):this.collapseLabel_=r;const o=e.label!==void 0?e.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=s):this.label_=o;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(w.CLICK,this.handleClick_.bind(this),!1);const c=t+" "+st+" "+Vt+(this.collapsed_&&this.collapsible_?" "+ci:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=c,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(s=>s.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>i.add(s)):i.add(this.attributions_)),!this.overrideCollapsible_){const s=!t.some(r=>{var a;return((a=r.getSource())==null?void 0:a.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(s=>Nn(()=>s))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Ut(t,this.renderedAttributions_)){pn(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const a=document.createElement("li");a.innerHTML=t[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(ci),this.collapsed_?ui(this.collapseLabel_,this.label_):ui(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class ws extends Kt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",a=document.createElement("button");a.className=t+"-reset",a.setAttribute("type","button"),a.title=r,a.appendChild(this.label_),a.addEventListener(w.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+st+" "+Vt,l=this.element;l.className=o,l.appendChild(a),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(qe)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Ae}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(qe);!r&&i===0?this.element.classList.add(qe):r&&i!==0&&this.element.classList.remove(qe)}this.label_.style.transform=s}this.rotation_=i}}class Is extends Kt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",a=e.zoomInLabel!==void 0?e.zoomInLabel:"+",o=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",c=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=s,h.setAttribute("type","button"),h.title=l,h.appendChild(typeof a=="string"?document.createTextNode(a):a),h.addEventListener(w.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=c,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(w.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+st+" "+Vt,f=this.element;f.className=d,f.appendChild(h),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:Ae})):i.setZoom(r)}}}function Ts(n){n=n||{};const e=new ie;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new Is(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new ws(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new Rs(n.attributionOptions)),e}class xs{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const s=this.points_[t+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[i],a=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(a,r),this.initialVelocity_=Math.sqrt(r*r+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Ci={ACTIVE:"active"};class Ke extends ot{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ci.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ci.ACTIVE,e)}setMap(e){this.map_=e}}function As(n,e,t){const i=n.getCenterInternal();if(i){const s=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:ls,center:n.getConstrainedCenter(s)})}}function $t(n,e,t,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+e),a=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:t,duration:i!==void 0?i:250,easing:Ae})}class Ls extends Ke{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==L.DBLCLICK){const i=e.originalEvent,s=e.map,r=e.coordinate,a=i.shiftKey?-this.delta_:this.delta_,o=s.getView();$t(o,a,r,this.duration_),i.preventDefault(),t=!0}return!t}}function Mt(n){const e=arguments;return function(t){let i=!0;for(let s=0,r=e.length;s<r&&(i=i&&e[s](t),!!i);++s);return i}}const Ur=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},bs=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ps=function(n){const e=n.map.getTargetElement(),t=e.getRootNode(),i=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},Yi=function(n){const e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?Ps(n):!0},Ds=et,qi=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(En&&Wt&&e.ctrlKey)},jr=ze,Hr=function(n){return n.type==L.SINGLECLICK},$i=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Br=function(n){const e=n.originalEvent;return!e.altKey&&(Wt?e.metaKey:e.ctrlKey)&&!e.shiftKey},Os=function(n){const e=n.originalEvent;return Wt?e.metaKey:e.ctrlKey},Ss=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ji=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},vt=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},Ms=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class Ve extends Ke{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==L.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==L.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==L.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==L.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Jt(n){const e=n.length;let t=0,i=0;for(let s=0;s<e;s++)t+=n[s].clientX,i+=n[s].clientY;return{clientX:t/e,clientY:i/e}}class ks extends Ve{constructor(e){super({stopDown:ze}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Mt($i,Ms);this.condition_=e.onFocusOnly?Mt(Yi,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,s=t.getEventPixel(Jt(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],o=e.map.getView();Yn(r,o.getResolution()),Bt(r,o.getRotation()),o.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),a=i.getCenterInternal(),o=t.getPixelFromCoordinateInternal(a),l=t.getCoordinateFromPixelInternal([o[0]-s*Math.cos(r),o[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Ae})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Ns extends Ve{constructor(e){e=e||{},super({stopDown:ze}),this.condition_=e.condition?e.condition:bs,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!vt(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===qt)return;const s=t.getSize(),r=e.pixel,a=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const o=a-this.lastAngle_;i.adjustRotationInternal(-o)}this.lastAngle_=a}handleUpEvent(e){return vt(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return vt(e)&&qi(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class zs extends jt{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+i,s.top=Math.min(e[1],t[1])+i,s.width=Math.abs(t[0]-e[0])+i,s.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new zn([s])}getGeometry(){return this.geometry_}}const Ce={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Pe extends Gt{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class Fs extends Ve{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new zs(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??qi,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const s=i[0]-t[0],r=i[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Pe(Ce.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Pe(t?Ce.BOXEND:Ce.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Pe(Ce.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Pe(Ce.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Pe(Ce.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class Ks extends Fs{constructor(e){e=e||{};const t=e.condition?e.condition:Ss;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),a=i.getResolutionForExtentInternal(r),o=i.getResolution()/a;s=s.clone(),s.scale(o*o)}i.fitInternal(s,{duration:this.duration_,easing:Ae})}}const de={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Vs extends Ke{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return $i(t)&&Ji(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==w.KEYDOWN){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==de.DOWN||s==de.LEFT||s==de.RIGHT||s==de.UP)){const a=e.map.getView(),o=a.getResolution()*this.pixelDelta_;let l=0,c=0;s==de.DOWN?c=-o:s==de.LEFT?l=-o:s==de.RIGHT?l=o:c=o;const h=[l,c];Bt(h,a.getRotation()),As(a,h,this.duration_),i.preventDefault(),t=!0}}return!t}}class Ws extends Ke{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!Os(t)&&Ji(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==w.KEYDOWN||e.type==w.KEYPRESS){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,a=s==="+"?this.delta_:-this.delta_,o=r.getView();$t(o,a,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const Zs=40,Gs=300;class Us extends Ke{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Ds;this.condition_=e.onFocusOnly?Mt(Yi,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==w.WHEEL)return!0;const i=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=Zs;break;case WheelEvent.DOM_DELTA_PAGE:r*=Gs;break}if(r===0)return!1;this.lastDelta_=r;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=i.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=a,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-$(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),$t(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class js extends Ve{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=ze),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const a=e.map,o=a.getView();o.getConstraints().rotation!==qt&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(Jt(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class Hs extends Ve{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=ze),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,a=i.clientY-s.clientY,o=Math.sqrt(r*r+a*a);this.lastDistance_!==void 0&&(t=this.lastDistance_/o),this.lastDistance_=o;const l=e.map,c=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Jt(this.targetPointers))),l.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function Bs(n){n=n||{};const e=new ie,t=new xs(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new Ns),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new Ls({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new ks({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new js),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new Hs({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new Vs),e.push(new Ws({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new Us({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new Ks({duration:n.zoomDuration})),e}const X={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class ht extends Cn{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(be.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(be.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Z(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=D(e,w.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof te?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;if(t.layerStatesArray){if(s=t.layerStatesArray.find(a=>a.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return Qt(s,t.viewState)&&(!r||Bi(r,t.extent))}getAttributions(e){var r;if(!this.isVisible(e))return[];const t=(r=this.getSource())==null?void 0:r.getAttributions();if(!t)return[];const i=e instanceof te?e.getViewStateAndExtent():e;let s=t(i);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(be.MAP,e)}getMapInternal(){return this.get(be.MAP)}setMap(e){this.mapPrecomposeKey_&&(Z(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Z(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=D(e,X.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=D(this,w.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);S(!t.some(s=>s.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(be.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Qt(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}class Xs{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t){const i=Rt(e,t);return i in this.cache_?this.cache_[i]:null}getPattern(e,t){const i=Rt(e,t);return i in this.patternCache_?this.patternCache_[i]:null}set(e,t,i,s){const r=Rt(e,t),a=r in this.cache_;this.cache_[r]=i,s&&(i.getImageState()===v.IDLE&&i.load(),i.getImageState()===v.LOADING?i.ready().then(()=>{this.patternCache_[r]=Qe().createPattern(i.getImage(1),"repeat")}):this.patternCache_[r]=Qe().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Rt(n,e){const t=e?_e(e):"null";return n+":"+t}const G=new Xs;let De=null;class Qi extends Zi{constructor(e,t,i,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i==null?void 0:i.crossOrigin,this.referrerPolicy_=i==null?void 0:i.referrerPolicy,this.canvas_={},this.color_=r,this.imageState_=s===void 0?v.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_),this.referrerPolicy_!==void 0&&(this.image_.referrerPolicy=this.referrerPolicy_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===v.LOADED){De||(De=Y(1,1,void 0,{willReadFrequently:!0})),De.drawImage(this.image_,0,0);try{De.getImageData(0,0,1,1),this.tainted_=!1}catch{De=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(w.CHANGE)}handleImageError_(){this.imageState_=v.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=v.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}setImage(e){this.image_=e}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=Y(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===v.IDLE){this.image_||this.initializeImage_(),this.imageState_=v.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&vn(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==v.LOADED)return;const t=this.image_,i=Y(Math.ceil(t.width*e),Math.ceil(t.height*e)),s=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=Rn(this.color_),i.fillRect(0,0,s.width/e,s.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=s}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===v.LOADED||this.imageState_===v.ERROR)e();else{const t=()=>{(this.imageState_===v.LOADED||this.imageState_===v.ERROR)&&(this.removeEventListener(w.CHANGE,t),e())};this.addEventListener(w.CHANGE,t)}})),this.ready_}}function Me(n,e,t,i,s,r){let a=e===void 0?void 0:G.get(e,s);return a||(a=new Qi(n,n&&"src"in n?n.src||void 0:e,t,i,s),G.set(e,s,a,r)),r&&a&&!G.getPattern(e,s)&&G.set(e,s,a,r),a}function vi(n){return n?Array.isArray(n)?wn(n):typeof n=="object"&&"src"in n?Ys(n):n:null}function Ys(n){if(!n.offset||!n.size)return G.getPattern(n.src,n.color);const e=n.src+":"+n.offset,t=G.getPattern(e,n.color);if(t)return t;const i=G.get(n.src,null);if(i.getImageState()!==v.LOADED)return null;const s=Y(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),Me(s.canvas,e,void 0,v.LOADED,n.color,!0),G.getPattern(e,n.color)}const Xr="10px sans-serif",Ri="#000",wi="round",Yr=[],qr=0,Ii="round",qs=10,$r=0,$s="#000",Jr="center",Qr="middle",ea=[0,0,0,0],Js=1,we=new ot;let Oe=null,Ti;const kt={},Qs=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function er(n,e,t){return`${n} ${e} 16px "${t}"`}const ta=function(){let e,t;async function i(r){await t.ready;const a=await t.load(r);if(a.length===0)return!1;const o=Tt(r),l=o.families[0].toLowerCase(),c=o.weight;return a.some(h=>{const u=h.family.replace(/^['"]|['"]$/g,"").toLowerCase(),d=In[h.weight]||h.weight;return u===l&&h.style===o.style&&d==c})}async function s(){await t.ready;let r=!0;const a=we.getProperties(),o=Object.keys(a).filter(l=>a[l]<100);for(let l=o.length-1;l>=0;--l){const c=o[l];let h=a[c];h<100&&(await i(c)?(Gi(kt),we.set(c,100)):(h+=10,we.set(c,h,!0),h<100&&(r=!1)))}e=void 0,r||(e=setTimeout(s,100))}return async function(r){t||(t=le?self.fonts:document.fonts);const a=Tt(r);if(!a)return;const o=a.families;let l=!1;for(const c of o){if(Qs.has(c))continue;const h=er(a.style,a.weight,c);we.get(h)===void 0&&(we.set(h,0,!0),l=!0)}l&&(clearTimeout(e),e=setTimeout(s,100))}}(),tr=function(){let n;return function(e){let t=kt[e];if(t==null){if(le){const i=Tt(e),s=en(e,"Žg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);kt[e]=t}return t}}();function en(n,e){return Oe||(Oe=Y(1,1)),n!=Ti&&(Oe.font=n,Ti=Oe.font),Oe.measureText(e)}function tn(n,e){return en(n,e).width}function ia(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((s,r)=>Math.max(s,tn(n,r)),0);return t[e]=i,i}function na(n,e){const t=[],i=[],s=[];let r=0,a=0,o=0,l=0;for(let c=0,h=e.length;c<=h;c+=2){const u=e[c];if(u===`
`||c===h){r=Math.max(r,a),s.push(a),a=0,o+=l,l=0;continue}const d=e[c+1]||n.font,f=tn(d,u);t.push(f),a+=f;const g=tr(d);i.push(g),l=Math.max(l,g)}return{width:r,height:o,widths:t,heights:i,lineWidths:s}}function sa(n,e,t,i,s,r,a,o,l,c,h){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=u=>u.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(l,c),n.scale(h[0],h[1]),ir(i,n)):h[0]<0||h[1]<0?(n.translate(l,c),n.scale(h[0],h[1]),n.drawImage(i,s,r,a,o,0,0,a,o)):n.drawImage(i,s,r,a,o,l,c,a*h[0],o*h[1]),n.restore()}function ir(n,e){const t=n.contextInstructions;for(let i=0,s=t.length;i<s;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class ct{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=xe(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ct({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return N()}getImage(e){return N()}getHitDetectionImage(){return N()}getPixelRatio(e){return 1}getImageState(){return N()}getImageSize(){return N()}getOrigin(){return N()}getSize(){return N()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=xe(e)}listenImageChange(e){N()}load(){N()}unlistenImageChange(e){N()}ready(){return Promise.resolve()}}class ut extends ct{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?v.LOADING:v.LOADED,this.imageState_===v.LOADING&&this.ready().then(()=>this.imageState_=v.LOADED),this.render()}clone(){const e=this.getScale(),t=new ut({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var r,a;const t=(r=this.fill_)==null?void 0:r.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let s=(a=G.get(i,null))==null?void 0:a.getImage(1);if(!s){const o=this.renderOptions_,l=Math.ceil(o.size*e),c=Y(l,l);this.draw_(o,c,e),s=c.canvas;const h=new Qi(s,void 0,null,v.LOADED,null);G.set(i,null,h),createImageBitmap(s).then(u=>{h.setImage(u)})}return s}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}setRadius(e){this.radius!==e&&(this.radius=e,this.render())}getRadius2(){return this.radius2_}setRadius2(e){this.radius2_!==e&&(this.radius2_=e,this.render())}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const b=s;s=r,r=b}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,l=r*Math.sin(o),c=Math.sqrt(r*r-l*l),h=s-c,u=Math.sqrt(l*l+h*h),d=u/l;if(e==="miter"&&d<=i)return d*t;const f=t/2/d,g=t/2*(h/u),_=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return _*2;const y=s*Math.sin(o),I=Math.sqrt(s*s-y*y),T=r-I,x=Math.sqrt(y*y+T*T)/y;if(x<=i){const b=x*t/2-r-s;return 2*Math.max(_,b)}return _*2}createRenderOptions(){let e=wi,t=Ii,i=0,s=null,r=0,a,o=0;this.stroke_&&(a=vi(this.stroke_.getColor()??$s),o=this.stroke_.getWidth()??Js,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Ii,e=this.stroke_.getLineCap()??wi,i=this.stroke_.getMiterLimit()??qs);const l=this.calculateLineJoinSize_(t,o,i),c=Math.max(this.radius,this.radius2_||0),h=Math.ceil(2*c+l);return{strokeStyle:a,strokeWidth:o,size:h,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=Ri),t.fillStyle=vi(s),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=_e(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(t=Y(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,a=2*Math.PI/t;for(let o=0;o<t;o++){const l=r+o*a,c=o%2===0?i:s;e.lineTo(c*Math.cos(l),c*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Ri,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class We extends ut{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new We({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}}class ce{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new ce({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Me(null,e.src,{crossOrigin:"anonymous"},void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===v.IDLE&&t.load(),t.getImageState()===v.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?Q(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:_e(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function xi(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class ei extends ct{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.referrerPolicy_=e.referrerPolicy;const a=e.img!==void 0?e.img:null;let o=e.src;S(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Q(a)),S(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),S(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=v.IDLE:a!==void 0&&("complete"in a?a.complete?l=a.src?v.LOADED:v.IDLE:l=v.LOADING:l=v.LOADED),this.color_=e.color!==void 0?_e(e.color):null,this.iconImage_=Me(a,o,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let c,h;if(e.size)[c,h]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)c=u.width,h=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(xi(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}c!==void 0&&this.setScale(xi(c,h,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new ei({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}setColor(e){const t=e?_e(e):null;if(this.color_===t||this.color_&&t&&this.color_.length===t.length&&this.color_.every((a,o)=>a===t[o]))return;this.color_=t;const i=this.getSrc(),s=i!==void 0?null:this.getHitDetectionImage(),r=i!==void 0?v.IDLE:this.iconImage_.getImageState();this.iconImage_=Me(s,i,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},r,this.color_)}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=Me(null,e,{crossOrigin:this.crossOrigin_,referrerPolicy:this.referrerPolicy_},v.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==v.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==v.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(w.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(w.CHANGE,e)}ready(){return this.iconImage_.ready()}}class ge{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.offset_=e.offset,this.width_=e.width}clone(){const e=this.getColor();return new ge({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),offset:this.getOffset(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getOffset(){return this.offset_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setOffset(e){this.offset_=e}setWidth(e){this.width_=e}}class j{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Ai,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new j({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Ai,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function nr(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(S(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let wt=null;function nn(n,e){if(!wt){const t=new ce({color:"rgba(255,255,255,0.4)"}),i=new ge({color:"#3399CC",width:1.25});wt=[new j({image:new We({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return wt}function ra(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new j({fill:new ce({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new j({stroke:new ge({color:e,width:i+2})}),new j({stroke:new ge({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new j({image:new We({radius:i*2,fill:new ce({color:t}),stroke:new ge({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function Ai(n){return n.getGeometry()}const sr="#333";class ti{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=xe(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new ce({color:sr}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ti({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof ce?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=xe(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function rr(n){return!0}function ar(n){const e=Vi(),t=or(n,e),i=zi();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,e.featureId){const a=s.getId();a!==void 0?i.featureId=a:i.featureId=null}return e.geometryType&&(i.geometryType=Tn(s.getGeometry())),t(i)}}function Li(n){const e=Vi(),t=n.length,i=new Array(t);for(let a=0;a<t;++a)i[a]=Nt(n[a],e);const s=zi(),r=new Array(t);return function(a,o){if(s.properties=a.getPropertiesInternal(),s.resolution=o,e.featureId){const c=a.getId();c!==void 0?s.featureId=c:s.featureId=null}let l=0;for(let c=0;c<t;++c){const h=i[c](s);h&&(r[l]=h,l+=1)}return r.length=l,r}}function or(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s){const r=n[s],a="filter"in r?q(r.filter,Ki,e):rr;let o;if(Array.isArray(r.style)){const l=r.style.length;o=new Array(l);for(let c=0;c<l;++c)o[c]=Nt(r.style[c],e)}else o=[Nt(r.style,e)];i[s]={filter:a,styles:o}}return function(s){const r=[];let a=!1;for(let o=0;o<t;++o){const l=i[o].filter;if(l(s)&&!(n[o].else&&a)){a=!0;for(const c of i[o].styles){const h=c(s);h&&r.push(h)}}}return r}}function Nt(n,e){const t=ke(n,"",e),i=Ne(n,"",e),s=lr(n,e),r=hr(n,e),a=M(n,"z-index",e);if(!t&&!i&&!s&&!r&&!Fn(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const o=new j;return function(l){let c=!0;if(t){const h=t(l);h&&(c=!1),o.setFill(h)}if(i){const h=i(l);h&&(c=!1),o.setStroke(h)}if(s){const h=s(l);h&&(c=!1),o.setText(h)}if(r){const h=r(l);h&&(c=!1),o.setImage(h)}return a&&o.setZIndex(a(l)),c?null:o}}function ke(n,e,t){let i;if(e+"fill-pattern-src"in n)i=fr(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return r=>null;i=dt(n,e+"fill-color",t)}if(!i)return null;const s=new ce;return function(r){const a=i(r);return a===Fi?null:(s.setColor(a),s)}}function Ne(n,e,t){const i=M(n,e+"stroke-width",t),s=dt(n,e+"stroke-color",t);if(!i&&!s)return null;const r=ee(n,e+"stroke-line-cap",t),a=ee(n,e+"stroke-line-join",t),o=sn(n,e+"stroke-line-dash",t),l=M(n,e+"stroke-line-dash-offset",t),c=M(n,e+"stroke-miter-limit",t),h=M(n,e+"stroke-offset",t),u=new ge;return function(d){if(s){const f=s(d);if(f===Fi)return null;u.setColor(f)}if(i&&u.setWidth(i(d)),r){const f=r(d);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(f)}if(a){const f=a(d);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(f)}return o&&u.setLineDash(o(d)),l&&u.setLineDashOffset(l(d)),c&&u.setMiterLimit(c(d)),h&&u.setOffset(h(d)),u}}function lr(n,e){const t="text-",i=ee(n,t+"value",e);if(!i)return null;const s=ke(n,t,e),r=ke(n,t+"background-",e),a=Ne(n,t,e),o=Ne(n,t+"background-",e),l=ee(n,t+"font",e),c=M(n,t+"max-angle",e),h=M(n,t+"offset-x",e),u=M(n,t+"offset-y",e),d=Te(n,t+"overflow",e),f=ee(n,t+"placement",e),g=M(n,t+"repeat",e),m=ft(n,t+"scale",e),_=Te(n,t+"rotate-with-view",e),y=M(n,t+"rotation",e),I=ee(n,t+"align",e),T=ee(n,t+"justify",e),p=ee(n,t+"baseline",e),x=Te(n,t+"keep-upright",e),b=sn(n,t+"padding",e),A=gt(n,t+"declutter-mode"),R=new ti({declutterMode:A});return function(C){if(R.setText(i(C)),s&&R.setFill(s(C)),r&&R.setBackgroundFill(r(C)),a&&R.setStroke(a(C)),o&&R.setBackgroundStroke(o(C)),l&&R.setFont(l(C)),c&&R.setMaxAngle(c(C)),h&&R.setOffsetX(h(C)),u&&R.setOffsetY(u(C)),d&&R.setOverflow(d(C)),f){const E=f(C);if(E!=="point"&&E!=="line")throw new Error("Expected point or line for text-placement");R.setPlacement(E)}if(g&&R.setRepeat(g(C)),m&&R.setScale(m(C)),_&&R.setRotateWithView(_(C)),y&&R.setRotation(y(C)),I){const E=I(C);if(E!=="left"&&E!=="center"&&E!=="right"&&E!=="end"&&E!=="start")throw new Error("Expected left, right, center, start, or end for text-align");R.setTextAlign(E)}if(T){const E=T(C);if(E!=="left"&&E!=="right"&&E!=="center")throw new Error("Expected left, right, or center for text-justify");R.setJustify(E)}if(p){const E=p(C);if(E!=="bottom"&&E!=="top"&&E!=="middle"&&E!=="alphabetic"&&E!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");R.setTextBaseline(E)}return b&&R.setPadding(b(C)),x&&R.setKeepUpright(x(C)),R}}function hr(n,e){return"icon-src"in n?cr(n,e):"shape-points"in n?ur(n,e):"circle-radius"in n?dr(n,e):null}function cr(n,e){const t="icon-",i=t+"src",s=rn(n[i],i),r=nt(n,t+"anchor",e),a=ft(n,t+"scale",e),o=M(n,t+"opacity",e),l=nt(n,t+"displacement",e),c=M(n,t+"rotation",e),h=Te(n,t+"rotate-with-view",e),u=Pi(n,t+"anchor-origin"),d=Di(n,t+"anchor-x-units"),f=Di(n,t+"anchor-y-units"),g=ne(n,t+"color");let m,_=null;g!==void 0&&(Array.isArray(g)&&g.length>0&&typeof g[0]=="string"?_=dt(n,t+"color",e):m=an(g,t+"color"));const y=_r(n,t+"cross-origin"),I=mr(n,t+"offset"),T=Pi(n,t+"offset-origin"),p=zt(n,t+"width"),x=zt(n,t+"height"),b=gr(n,t+"size"),A=gt(n,t+"declutter-mode"),R={src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,crossOrigin:y,offset:I,offsetOrigin:T,height:x,width:p,size:b,declutterMode:A};let C=null;return function(E){if(C)_&&C.setColor(_(E));else{const me=_?_(E):m;C=new ei(me!==void 0?Object.assign({},R,{color:me}):Object.assign({},R))}return o&&C.setOpacity(o(E)),l&&C.setDisplacement(l(E)),c&&C.setRotation(c(E)),h&&C.setRotateWithView(h(E)),a&&C.setScale(a(E)),r&&C.setAnchor(r(E)),C}}function ur(n,e){const t="shape-",i=t+"points",s=t+"radius",r=ii(n[i],i);if(!(s in n))throw new Error(`Expected a number for ${s}`);const a=M(n,s,e),o=typeof n[s]=="number"?n[s]:5,l=t+"radius2",c=M(n,l,e),h=typeof n[l]=="number"?n[l]:void 0,u=ke(n,t,e),d=Ne(n,t,e),f=ft(n,t+"scale",e),g=nt(n,t+"displacement",e),m=M(n,t+"rotation",e),_=Te(n,t+"rotate-with-view",e),y=zt(n,t+"angle"),I=gt(n,t+"declutter-mode"),T=new ut({points:r,radius:o,radius2:h,angle:y,declutterMode:I});return function(p){return a&&T.setRadius(a(p)),c&&T.setRadius2(c(p)),u&&T.setFill(u(p)),d&&T.setStroke(d(p)),g&&T.setDisplacement(g(p)),m&&T.setRotation(m(p)),_&&T.setRotateWithView(_(p)),f&&T.setScale(f(p)),T}}function dr(n,e){const t="circle-",i=ke(n,t,e),s=Ne(n,t,e),r=M(n,t+"radius",e),a=ft(n,t+"scale",e),o=nt(n,t+"displacement",e),l=M(n,t+"rotation",e),c=Te(n,t+"rotate-with-view",e),h=gt(n,t+"declutter-mode"),u=new We({radius:5,declutterMode:h});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),s&&u.setStroke(s(d)),o&&u.setDisplacement(o(d)),l&&u.setRotation(l(d)),c&&u.setRotateWithView(c(d)),a&&u.setScale(a(d)),u}}function ne(n,e){if(!(e in n))return;const t=n[e];return t===void 0?void 0:t}function M(n,e,t){const i=ne(n,e);if(i===void 0)return;const s=q(i,Zt,t);return function(r){return ii(s(r),e)}}function ee(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,xn,t);return function(r){return rn(s(r),e)}}function fr(n,e,t){const i=ee(n,e+"pattern-src",t),s=bi(n,e+"pattern-offset",t),r=bi(n,e+"pattern-size",t),a=dt(n,e+"color",t);return function(o){return{src:i(o),offset:s&&s(o),size:r&&r(o),color:a&&a(o)}}}function Te(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,Ki,t);return function(r){const a=s(r);if(typeof a!="boolean")throw new Error(`Expected a boolean for ${e}`);return a}}function dt(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,An,t);return function(r){return an(s(r),e)}}function sn(n,e,t){const i=ne(n,e);if(i===void 0)return null;if(Array.isArray(i)&&(i.length===0||typeof i[0]!="string")){const r=i.map((a,o)=>{if(typeof a=="number")return()=>a;const l=q(a,Zt,t);return function(c){return ii(l(c),`${e}[${o}]`)}});return function(a){const o=new Array(r.length);for(let l=0;l<r.length;++l)o[l]=r[l](a);return o}}const s=q(i,rt,t);return function(r){return Ze(s(r),e)}}function nt(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,rt,t);return function(r){const a=Ze(s(r),e);if(a.length!==2)throw new Error(`Expected two numbers for ${e}`);return a}}function bi(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,rt,t);return function(r){return on(s(r),e)}}function ft(n,e,t){const i=ne(n,e);if(i===void 0)return null;const s=q(i,rt|Zt,t);return function(r){return yr(s(r),e)}}function zt(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function gr(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return xe(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function _r(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Pi(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function Di(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function mr(n,e){const t=n[e];if(t!==void 0)return Ze(t,e)}function gt(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Ze(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function rn(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function ii(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function an(n,e){if(typeof n=="string")return n;const t=Ze(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function on(n,e){const t=Ze(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function yr(n,e){return typeof n=="number"?n:on(n,e)}const Oi={RENDER_ORDER:"renderOrder"};class pr extends ht{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Oi.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new Ln(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Oi.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?nn:e;const t=Er(e);this.styleFunction_=e===null?void 0:nr(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function Er(n){if(n===void 0)return nn;if(!n)return null;if(typeof n=="function"||n instanceof j)return n;if(!Array.isArray(n))return Li([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof j){const s=new Array(e);for(let r=0;r<e;++r){const a=n[r];if(!(a instanceof j))throw new Error("Expected a list of style instances");s[r]=a}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const a=n[r];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[r]=a}return ar(s)}return Li(n)}class ln extends Gt{constructor(e,t,i,s){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=s}}class Cr extends jt{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){N()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;tt(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),ji(s,i)}forEachFeatureAtCoordinate(e,t,i,s,r,a,o,l){let c;const h=t.viewState;function u(p,x,b,A){return r.call(a,x,p?b:null,A)}const d=h.projection,f=qn(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const p=d.getExtent(),x=Fe(p);g.push([-x,0],[x,0])}const m=t.layerStatesArray,_=m.length,y=[],I=[];for(let p=0;p<g.length;p++)for(let x=_-1;x>=0;--x){const b=m[x],A=b.layer;if(A.hasRenderer()&&Qt(b,h)&&o.call(l,A)){const R=A.getRenderer(),C=A.getSource();if(R&&C){const E=C.getWrapX()?f:e,me=u.bind(null,b.managed);I[0]=E[0]+g[p][0],I[1]=E[1]+g[p][1],c=R.forEachFeatureAtCoordinate(I,t,i,me,y)}if(c)return c}}if(y.length===0)return;const T=1/y.length;return y.forEach((p,x)=>p.distanceSq+=x*T),y.sort((p,x)=>p.distanceSq-x.distanceSq),y.some(p=>c=p.callback(p.feature,p.layer,p.geometry)),c}hasFeatureAtCoordinate(e,t,i,s,r,a){return this.forEachFeatureAtCoordinate(e,t,i,s,et,this,r,a)!==void 0}getMap(){return this.map_}renderFrame(e){N()}scheduleExpireIconCache(e){G.canExpireCache()&&e.postRenderFunctions.push(vr)}}function vr(n,e){G.expire()}class Rr extends Cr{constructor(e){super(e),this.fontChangeListenerKey_=D(we,xt.PROPERTYCHANGE,e.redrawText,e),this.element_=le?Wi():document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=st+" ol-layers";const i=e.getViewport();i&&i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const s=new ln(e,void 0,t);i.dispatchEvent(s)}}disposeInternal(){Z(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(X.PRECOMPOSE,e);const t=e.layerStatesArray.sort((c,h)=>c.zIndex-h.zIndex);t.some(c=>c.layer instanceof pr&&c.layer.getDeclutter())&&(e.declutter={});const s=e.viewState;this.children_.length=0;const r=[];let a=null;for(let c=0,h=t.length;c<h;++c){const u=t[c];e.layerIndex=c;const d=u.layer,f=d.getSourceState();if(!Qt(u,s)||f!="ready"&&f!="undefined"){d.unrender();continue}const g=d.render(e,a);g&&(g!==a&&(this.children_.push(g),a=g),r.push(u))}this.declutter(e,r),bn(this.element_,this.children_);const l=this.getMap().getTargetElement();if(he(l)){const c=l.getContext("2d");for(const h of this.children_){const u=h.firstElementChild||h,d=h.style.backgroundColor;if(d&&(!he(u)||u.width>0)&&(c.fillStyle=d,c.fillRect(0,0,l.width,l.height)),he(u)&&u.width>0){c.save();const f=h.style.opacity||u.style.opacity;c.globalAlpha=f===""?1:Number(f);const g=u.style.transform;if(g)c.transform(...Kn(g));else{const m=parseFloat(u.style.width)/u.width,_=parseFloat(u.style.height)/u.height;c.transform(m,0,0,_,0,0)}c.drawImage(u,0,0),c.restore()}}}this.dispatchRenderEvent(X.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const s=t[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(e,s)}t.forEach(i=>i.layer.renderDeferred(e))}}}function hn(n){if(n instanceof ht){n.setMapInternal(null);return}n instanceof at&&n.getLayers().forEach(hn)}function cn(n,e){if(n instanceof ht){n.setMapInternal(e);return}if(n instanceof at){const t=n.getLayers().getArray();for(let i=0,s=t.length;i<s;++i)cn(t[i],e)}}class aa extends ot{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=wr(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Pn,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Se(),this.pixelToCoordinateTransform_=Se(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,le||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,le||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(le?new ie:Ts()),this.interactions=t.interactions||(le?new ie:Bs({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new us(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(k.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(k.VIEW,this.handleViewChanged_),this.addChangeListener(k.SIZE,this.handleSizeChanged_),this.addChangeListener(k.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof te)&&e.view.then(function(s){i.setView(new te(s))}),this.controls.addEventListener(Ee.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Ee.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Ee.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Ee.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Ee.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Ee.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){cn(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){var e;this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),(e=this.resizeObserver_)==null||e.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,a=i.layerFilter!==void 0?i.layerFilter:et,o=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,o,t,null,a,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(s){i.push(s)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(s){s instanceof at?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:et,r=t.hitTolerance!==void 0?t.hitTolerance:0,a=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,a,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],a=i.height/s[1],o="changedTouches"in e?e.changedTouches[0]:e;return[(o.clientX-i.left)/r,(o.clientY-i.top)/a]}getTarget(){return this.get(k.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return At(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?V(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(k.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof ie){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(e){const t=J(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?V(t.coordinateToPixelTransform,e.slice(0,2)):null}getPixelRatio(){return this.pixelRatio_}setPixelRatio(e){this.pixelRatio_!==e&&(this.pixelRatio_=e,this.render())}getRenderer(){return this.renderer_}getSize(){return this.get(k.SIZE)}getView(){return this.get(k.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,s){return ds(this.frameState_,e,t,i,s)}handleBrowserEvent(e,t){t=t||e.type;const i=new oe(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===St.POINTERDOWN||i===w.WHEEL||i===w.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=t.target,o=r instanceof ShadowRoot?r.host===a?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(a)||!o.contains(a))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const a=s[r];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const a=e.viewHints;if(a[W.ANIMATING]||a[W.INTERACTING]){const o=Date.now()-e.time>8;s=o?0:8,r=o?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(X.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(X.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Re(ue.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Re(ue.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let s=0,r=i.length;s<r;++s)i[s](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){var i,s;if(this.mapBrowserEventHandler_){for(let r=0,a=this.targetChangeHandlerKeys_.length;r<a;++r)Z(this.targetChangeHandlerKeys_[r]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(w.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(w.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!he(this.targetElement_)){(i=this.resizeObserver_)==null||i.unobserve(this.targetElement_);const r=this.targetElement_.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.unobserve(r.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if(he(t)||t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Rr(this)),!he(t)){this.mapBrowserEventHandler_=new hs(this,this.moveTolerance_);for(const a in L)this.mapBrowserEventHandler_.addEventListener(L[a],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(w.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(w.WHEEL,this.boundHandleBrowserEvent_,Ni?{passive:!1}:!1);let r;if(this.keyboardEventTarget_)r=this.keyboardEventTarget_;else{const a=t.getRootNode();r=a instanceof ShadowRoot?a.host:t}if(this.targetChangeHandlerKeys_=[D(r,w.KEYDOWN,this.handleBrowserEvent,this),D(r,w.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){const a=t.getRootNode();a instanceof ShadowRoot&&this.resizeObserver_.observe(a.host),(s=this.resizeObserver_)==null||s.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Z(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Z(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=D(e,xt.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=D(e,w.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Z),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new di("addlayer",e)),this.layerGroupPropertyListenerKeys_=[D(e,xt.PROPERTYCHANGE,this.render,this),D(e,w.CHANGE,this.render,this),D(e,"addlayer",this.handleLayerAdd_,this),D(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,i=e.length;t<i;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){hn(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&fi(t)&&i&&i.isDef()){const a=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Lt(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:a,wantedTiles:{},mapId:Q(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const l=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=Lt(o.nextCenter,o.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Hi(this.previousExtent_)&&!Dt(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Re(ue.MOVESTART,this,s)),this.previousExtent_=$n(this.previousExtent_)),this.previousExtent_&&!r.viewHints[W.ANIMATING]&&!r.viewHints[W.INTERACTING]&&!Dt(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Re(ue.MOVEEND,this,r)),Jn(r.extent,this.previousExtent_))),this.dispatchEvent(new Re(ue.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(ue.LOADSTART)||this.hasListener(ue.LOADEND)||this.hasListener(X.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new di("removelayer",t)),this.set(k.LAYERGROUP,e)}setSize(e){this.set(k.SIZE,e)}setTarget(e){this.set(k.TARGET,e)}setView(e){if(!e||e instanceof te){this.set(k.VIEW,e);return}this.set(k.VIEW,new te);const t=this;e.then(function(i){t.setView(new te(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){let s,r;if(he(e)){const a=e.getContext("2d").getTransform();s=e.width/a.a,r=e.height/a.d}else{const a=getComputedStyle(e);s=e.offsetWidth-parseFloat(a.borderLeftWidth)-parseFloat(a.paddingLeft)-parseFloat(a.paddingRight)-parseFloat(a.borderRightWidth),r=e.offsetHeight-parseFloat(a.borderTopWidth)-parseFloat(a.paddingTop)-parseFloat(a.paddingBottom)-parseFloat(a.borderBottomWidth)}!isNaN(s)&&!isNaN(r)&&(t=[Math.max(0,s),Math.max(0,r)],!fi(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Qn("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!Ut(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}function wr(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new at({layers:n.layers});t[k.LAYERGROUP]=i,t[k.TARGET]=n.target,t[k.VIEW]=n.view instanceof te?n.view:new te;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new ie(n.controls.slice()):(S(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new ie(n.interactions.slice()):(S(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let a;return n.overlays!==void 0?Array.isArray(n.overlays)?a=new ie(n.overlays.slice()):(S(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=n.overlays):a=new ie,{controls:s,interactions:r,keyboardEventTarget:e,overlays:a,values:t}}function Ft(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}function oa(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Float32Array||n instanceof DataView?n:null}const Ir=new Error("disposed");let ve=null;function la(n){ve||(ve=Y(n.width,n.height,void 0,{willReadFrequently:!0}));const e=ve.canvas,t=n.width;e.width!==t&&(e.width=t);const i=n.height;return e.height!==i&&(e.height=i),ve.clearRect(0,0,t,i),ve.drawImage(n,0,0),ve.getImageData(0,0,t,i).data}const Tr=[256,256];class Si extends Dn{constructor(e){const t=P.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Ft(this.data_);return e?[e.width,e.height]:Tr}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=P.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=P.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Ir),this.controller_=null),super.disposeInternal()}}class Mi{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof jt&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return S(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return S(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){S(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const xr=5;class Ar extends Vn{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=xr}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return N()}getData(e){return null}prepareFrame(e){return N()}renderFrame(e,t){return N()}forEachFeatureAtCoordinate(e,t,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===v.LOADED||t.getState()===v.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=v.LOADED&&t!=v.ERROR&&e.addEventListener(w.CHANGE,this.boundHandleImageChange_),t==v.IDLE&&(e.load(),t=e.getState()),t==v.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Je={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Lr extends ht{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Je.PRELOAD)}setPreload(e){this.set(Je.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Je.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Je.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class br{constructor(){hi(this,"pushMethodArgs_",(...e)=>(this.push_(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Qe(),{get:(e,t)=>{if(typeof Qe()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,s=t.length;i<s;++i){const r=t[i];if(typeof r=="function"){r(e);continue}const a=t[++i];if(typeof e[r]=="function")e[r](...a);else{if(typeof a=="function"){e[r]=a(e);continue}e[r]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const ha=[];let Ie=null;function Pr(){Ie=Y(1,1,void 0,{willReadFrequently:!0})}class Dr extends Ar{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Se(),this.pixelTransform=Se(),this.inversePixelTransform=Se(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){Ie||Pr(),Ie.clearRect(0,0,1,1);let s;try{Ie.drawImage(e,t,i,1,1,0,0,1,1),s=Ie.getImageData(0,0,1,1).data}catch{return Ie=null,null}return s}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const s=this.getLayer().getClassName();let r,a;if(e&&e.className===s&&(!i||e&&e.style.backgroundColor&&Ut(_e(e.style.backgroundColor),_e(i)))){const o=e.firstElementChild;he(o)&&(a=o.getContext("2d"))}if(a&&Wn(a.canvas.style.transform,t)?(this.container=e,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=le?Wi():document.createElement("div"),r.className=s;let o=r.style;o.position="absolute",o.width="100%",o.height="100%",a=Y();const l=a.canvas;r.appendChild(l),o=l.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=r,this.context=a}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const s=Xi(i),r=es(i),a=ts(i),o=is(i);V(t.coordinateToPixelTransform,s),V(t.coordinateToPixelTransform,r),V(t.coordinateToPixelTransform,a),V(t.coordinateToPixelTransform,o);const l=this.inversePixelTransform;V(l,s),V(l,r),V(l,a),V(l,o),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.clip()}prepareContainer(e,t){const i=e.extent,s=e.viewState.resolution,r=e.viewState.rotation,a=e.pixelRatio,o=Math.round(Fe(i)/s*a),l=Math.round(lt(i)/s*a);tt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,r,-o/2,-l/2),ji(this.inversePixelTransform,this.pixelTransform);const c=Zn(this.pixelTransform);if(this.useContainer(t,c,this.getBackground(e)),!this.containerReused){const h=this.context.canvas;h.width!=o||h.height!=l?(h.width=o,h.height=l):this.context.clearRect(0,0,o,l),c!==h.style.transform&&(h.style.transform=c)}}dispatchRenderEvent_(e,t,i){const s=this.getLayer();if(s.hasListener(e)){const r=new ln(e,this.inversePixelTransform,i,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(X.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(X.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new br),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(X.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(X.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,s,r,a,o){const l=r/2,c=a/2,h=s/t,u=-h,d=-e[0]+o,f=-e[1];return tt(this.tempTransform,l,c,h,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function It(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const i=n[t],s=i.has(e);return s||i.add(e),!s}function Or(n,e,t){const i=n[t];return i?i.delete(e):!1}function ki(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Ot(e,fe(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(e=Ot(e,s))}return e}class Sr extends Dr{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=ns(),this.tempTileRange_=new On(0,0,0,0),this.tempTileCoord_=gi(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Mi(i),this.sourceTileCache_=null,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new Mi(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,s){const r=this.tileCache_,o=this.getLayer().getSource(),l=pt(o,o.getKey(),e,t,i);let c;if(r.containsKey(l))c=r.get(l);else{const h=s.viewState.projection,u=o.getProjection();if(c=o.getTile(e,t,i,s.pixelRatio,h,!u||ss(u,h)?void 0:this.getSourceTileCache()),!c)return null;r.set(l,c)}return c}getTile(e,t,i,s){const r=this.getOrCreateTile(e,t,i,s);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=V(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!rs(r,s))return null;const a=t.viewState,o=i.getRenderSource(),l=o.getTileGridForProjection(a.projection),c=o.getTilePixelRatio(t.pixelRatio);for(let h=l.getZForResolution(a.resolution);h>=l.getMinZoom();--h){const u=l.getTileCoordForCoordAndZ(s,h),d=this.getTile(h,u[1],u[2],t);if(!d||d.getState()!==P.LOADED)continue;const f=l.getOrigin(h),g=xe(l.getTileSize(h)),m=l.getResolution(h);let _;if(d instanceof Sn||d instanceof Mn)_=d.getImage();else if(d instanceof Si){if(_=Ft(d.getData()),!_)continue}else continue;const y=Math.floor(c*((s[0]-f[0])/m-u[1]*g[0])),I=Math.floor(c*((f[1]-s[1])/m-u[2]*g[1])),T=Math.round(c*o.getGutterForProjection(a.projection));return this.getImageData(_,y+T,I+T)}return null}prepareFrame(e){var s;this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),(s=this.sourceTileCache_)==null||s.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,s,r){const a=e.viewState,o=this.getLayer(),l=o.getRenderSource(),c=l.getTileGridForProjection(a.projection),h=Q(l);h in e.wantedTiles||(e.wantedTiles[h]={});const u=e.wantedTiles[h],d=o.getMapInternal(),f=Math.max(i-r,c.getMinZoom(),c.getZForResolution(Math.min(o.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),g=a.rotation,m=g?as(a.center,a.resolution,g,e.size):void 0;for(let _=i;_>=f;--_){const y=c.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),I=c.getResolution(_);for(let T=y.minX;T<=y.maxX;++T)for(let p=y.minY;p<=y.maxY;++p){if(g&&!c.tileCoordIntersectsViewport([_,T,p],m))continue;const x=this.getTile(_,T,p,e);if(!x||!It(s,x,_))continue;const A=x.getKey();if(u[A]=!0,x.getState()===P.IDLE&&!e.tileQueue.isKeyQueued(A)){const R=gi(_,T,p,this.tempTileCoord_);e.tileQueue.enqueue([x,h,c.getTileCoordCenter(R),I])}}}}findStaleTile_(e,t){const i=this.tileCache_,s=e[0],r=e[1],a=e[2],o=this.getStaleKeys();for(let l=0;l<o.length;++l){const c=pt(this.getLayer().getSource(),o[l],s,r,a);if(i.containsKey(c)){const h=i.peek(c);if(h.getState()===P.LOADED)return h.endTransition(Q(this)),It(t,h,s),!0}}return!1}findAltTiles_(e,t,i,s){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let a=!0;const o=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let h=r.minX;h<=r.maxX;++h)for(let u=r.minY;u<=r.maxY;++u){const d=pt(l,c,i,h,u);let f=!1;if(o.containsKey(d)){const g=o.peek(d);g.getState()===P.LOADED&&(It(s,g,i),f=!0)}f||(a=!1)}return a}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,a=s.resolution,o=s.center,l=e.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getTileGridForProjection(r),d=u.getZForResolution(a,h.zDirection),f=u.getResolution(d),g=h.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let m=e.extent;const _=h.getTilePixelRatio(l);this.prepareContainer(e,t);const y=this.context.canvas.width,I=this.context.canvas.height,T=i.extent&&fe(i.extent);T&&(m=Ot(m,fe(i.extent)));const p=f*y/2/_,x=f*I/2/_,b=[o[0]-p,o[1]-x,o[0]+p,o[1]+x],A={};this.renderedTiles.length=0;const R=c.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const z=u.getZForResolution(s.nextResolution,h.zDirection),F=ki(e,e.nextExtent);this.enqueueTiles(e,F,z,A,R)}const C=ki(e,m);if(this.enqueueTiles(e,C,d,A,0),R>0&&setTimeout(()=>{this.enqueueTiles(e,C,d-1,A,R-1)},0),!(d in A))return this.container;const E=Q(this),me=e.time;for(const z of A[d]){const F=z.getState();if(F===P.EMPTY)continue;const se=z.tileCoord;if(F===P.LOADED&&z.getAlpha(E,me)===1){z.endTransition(E);continue}if(F!==P.ERROR&&(this.renderComplete=!1),this.findStaleTile_(se,A)){Or(A,z,d),e.animate=!0;continue}if(this.findAltTiles_(u,se,d+1,A))continue;const pe=u.getMinZoom();for(let B=d-1;B>=pe&&!this.findAltTiles_(u,se,B,A);--B);}const Ge=f/a*l/_,O=this.getRenderContext(e);tt(this.tempTransform,y/2,I/2,Ge,Ge,0,-y/2,-I/2),i.extent&&this.clipUnrotated(O,e,T),h.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,e);const Ue=Object.keys(A).map(Number);Ue.sort(Gn);let H;const _t=[],ni=[];for(let z=Ue.length-1;z>=0;--z){const F=Ue[z],se=h.getTilePixelSize(F,l,r),ye=u.getResolution(F)/f,pe=se[0]*ye*Ge,B=se[1]*ye*Ge,je=u.getTileCoordForCoordAndZ(Xi(b),F),si=u.getTileCoordExtent(je),He=V(this.tempTransform,[_*(si[0]-b[0])/f,_*(b[3]-si[3])/f]),un=_*h.getGutterForProjection(r);for(const Le of A[F]){if(Le.getState()!==P.LOADED)continue;const ri=Le.tileCoord,ai=je[1]-ri[1],dn=Math.round(He[0]-(ai-1)*pe),oi=je[2]-ri[2],fn=Math.round(He[1]-(oi-1)*B),re=Math.round(He[0]-ai*pe),ae=Math.round(He[1]-oi*B),Be=dn-re,Xe=fn-ae,li=Ue.length===1;let yt=!1;H=[re,ae,re+Be,ae,re+Be,ae+Xe,re,ae+Xe];for(let Ye=0,gn=_t.length;Ye<gn;++Ye)if(!li&&F<ni[Ye]){const K=_t[Ye];Bi([re,ae,re+Be,ae+Xe],[K[0],K[3],K[4],K[7]])&&(yt||(O.save(),yt=!0),O.beginPath(),O.moveTo(H[0],H[1]),O.lineTo(H[2],H[3]),O.lineTo(H[4],H[5]),O.lineTo(H[6],H[7]),O.moveTo(K[6],K[7]),O.lineTo(K[4],K[5]),O.lineTo(K[2],K[3]),O.lineTo(K[0],K[1]),O.clip())}_t.push(H),ni.push(F),this.drawTile(Le,e,re,ae,Be,Xe,un,li),yt&&O.restore(),this.renderedTiles.unshift(Le),this.updateUsedTiles(e.usedTiles,h,Le)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Dt(this.renderedExtent_,b),this.renderedExtent_=b,this.renderedPixelRatio=l,this.postRender(this.context,e),i.extent&&O.restore(),O.imageSmoothingEnabled=!0,this.renderComplete){const z=(F,se)=>{var B;const mt=Q(h),ye=se.wantedTiles[mt],pe=ye?Object.keys(ye).length:0;this.updateCacheSize(pe),this.tileCache_.expireCache(),(B=this.sourceTileCache_)==null||B.expireCache()};e.postRenderFunctions.push(z)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,s,r,a,o,l){let c;if(e instanceof Si){if(c=Ft(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const h=this.getRenderContext(t),u=Q(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(u,t.time):1),g=f!==h.globalAlpha;g&&(h.save(),h.globalAlpha=f),h.drawImage(c,o,o,c.width-2*o,c.height-2*o,i,s,r,a),g&&h.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const s=Q(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}}class ca extends Lr{constructor(e){super(e)}createRenderer(){return new Sr(this,{cacheSize:this.getCacheSize()})}}export{ks as $,Ri as A,pr as B,Dr as C,$s as D,ea as E,ce as F,Qr as G,Jr as H,Ci as I,Xr as J,ta as K,ht as L,aa as M,na as N,sa as O,Ve as P,ia as Q,ha as R,j as S,ca as T,X as U,te as V,Ms as W,Ur as X,Hr as Y,br as Z,Us as _,Kr as a,Br as a0,Ke as a1,St as a2,U as a3,Rs as a4,ws as a5,Is as a6,Bs as a7,Si as a8,Ft as a9,oa as aa,Ar as ab,ln as ac,Mi as ad,Lr as ae,la as af,us as ag,We as ah,we as ai,Wr as b,Zr as c,ge as d,Ds as e,L as f,Gr as g,oe as h,jr as i,ra as j,W as k,ei as l,ti as m,$i as n,Sr as o,Je as p,vi as q,wi as r,Ss as s,Yr as t,qr as u,Ii as v,Vr as w,Js as x,qs as y,$r as z};
