import{R as h,M as S,a as b,b as M,L as C,F}from"./Feature.DClIwY0Z.js";import{P as N,b as L,a as s,c as k,o as x,e as J,f as A,i as R,h as E,j as d,k as j}from"./Polygon.FVLon8Z8.js";import{g as u,w as G,x as T,t as _}from"./proj.DNHHD1fb.js";import{G as U}from"./GeometryCollection.DptEXo7b.js";class I{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=F,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?u(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()==="tile-pixels"&&(n=u(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return s()}readFeature(e,t){return s()}readFeatures(e,t){return s()}readGeometry(e,t){return s()}readProjection(e){return s()}writeFeature(e,t){return s()}writeFeatures(e,t){return s()}writeGeometry(e,t){return s()}}function g(r,e,t){const n=t?u(t.featureProjection):null,i=t?u(t.dataProjection):null;let o=r;if(n&&i&&!G(n,i)){e&&(o=r.clone());const a=e?n:i,c=e?i:n;a.getUnits()==="tile-pixels"?o.transform(a,c):o.applyTransform(T(a,c))}if(e&&t&&t.decimals!==void 0){const a=Math.pow(10,t.decimals),c=function(y){for(let l=0,w=y.length;l<w;++l)y[l]=Math.round(y[l]*a)/a;return y};o===r&&(o=r.clone()),o.applyTransform(c)}return o}function ue(r,e){const t=e?u(e.featureProjection):null,n=e?u(e.dataProjection):null;return t&&n&&!G(t,n)?_(r,n,t):r}const W={Point:L,LineString:C,Polygon:N,MultiPoint:M,MultiLineString:b,MultiPolygon:S};function v(r,e,t){return Array.isArray(e[0])?(k(r,0,e,t)||(r=r.slice(),x(r,0,e,t)),r):(J(r,0,e,t)||(r=r.slice(),A(r,0,e,t)),r)}function O(r,e){var o;const t=r.geometry;if(!t)return[];if(Array.isArray(t))return t.map(a=>O({...r,geometry:a})).flat();const n=t.type==="MultiPolygon"?"Polygon":t.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const i=t.layout.length;return g(new h(n,n==="Polygon"?v(t.flatCoordinates,t.ends,i):t.flatCoordinates,(o=t.ends)==null?void 0:o.flat(),i,r.properties||{},r.id).enableSimplifyTransformed(),!1,e)}function p(r,e){if(!r)return null;if(Array.isArray(r)){const n=r.map(i=>p(i,e));return new U(n)}const t=W[r.type];return g(new t(r.flatCoordinates,r.layout||"XY",r.ends),!1,e)}class H extends I{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(f(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(f(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return s()}readFeaturesFromObject(e,t){return s()}readGeometry(e,t){return this.readGeometryFromObject(f(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return s()}readProjection(e){return this.readProjectionFromObject(f(e))}readProjectionFromObject(e){return s()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return s()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return s()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return s()}}function f(r){if(typeof r=="string"){const e=JSON.parse(r);return e||null}return r!==null?r:null}class ce extends H{constructor(e){e=e||{},super(),this.dataProjection=u(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=u(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const i=P(n.geometry);if(this.featureClass===h)return O({geometry:i,id:n.id,properties:n.properties},t);const o=new F;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&o.setGeometryName(n.geometry_name),o.setGeometry(p(i,t)),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o}readFeaturesFromObject(e,t){const n=e;let i=null;if(n.type==="FeatureCollection"){const o=e;i=[];const a=o.features;for(let c=0,y=a.length;c<y;++c){const l=this.readFeatureFromObject(a[c],t);l&&i.push(l)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return q(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if(t.type=="name")n=u(t.properties.name);else if(t.type==="EPSG")n=u("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(n.id=i),!e.hasProperties())return n;const o=e.getProperties(),a=e.getGeometry();return a&&(n.geometry=m(a,t),delete o[e.getGeometryName()]),R(o)||(n.properties=o),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,o=e.length;i<o;++i)n.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return m(e,this.adaptOptions(t))}}function P(r,e){if(!r)return null;let t;switch(r.type){case"Point":{t=Y(r);break}case"LineString":{t=z(r);break}case"Polygon":{t=Q(r);break}case"MultiPoint":{t=D(r);break}case"MultiLineString":{t=B(r);break}case"MultiPolygon":{t=K(r);break}case"GeometryCollection":{t=X(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return t}function q(r,e){const t=P(r);return p(t,e)}function X(r,e){return r.geometries.map(function(n){return P(n)})}function Y(r){const e=r.coordinates;return{type:"Point",flatCoordinates:e,layout:d(e.length)}}function z(r){var n;const e=r.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:d(((n=e[0])==null?void 0:n.length)||2)}}function B(r){var o,a;const e=r.coordinates,t=((a=(o=e[0])==null?void 0:o[0])==null?void 0:a.length)||2,n=[],i=j(n,0,e,t);return{type:"MultiLineString",flatCoordinates:n,ends:i,layout:d(t)}}function D(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:d(((t=e[0])==null?void 0:t.length)||2)}}function K(r){var o,a;const e=r.coordinates,t=[],n=((a=(o=e[0])==null?void 0:o[0])==null?void 0:a[0].length)||2,i=E(t,0,e,n);return{type:"MultiPolygon",flatCoordinates:t,ends:i,layout:d(n)}}function Q(r){var o,a;const e=r.coordinates,t=[],n=(a=(o=e[0])==null?void 0:o[0])==null?void 0:a.length,i=j(t,0,e,n);return{type:"Polygon",flatCoordinates:t,ends:i,layout:d(n)}}function m(r,e){r=g(r,!0,e);const t=r.getType();let n;switch(t){case"Point":{n=re(r);break}case"LineString":{n=Z(r);break}case"Polygon":{n=ne(r,e);break}case"MultiPoint":{n=ee(r);break}case"MultiLineString":{n=$(r);break}case"MultiPolygon":{n=te(r,e);break}case"GeometryCollection":{n=V(r,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function V(r,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return m(n,e)})}}function Z(r,e){return{type:"LineString",coordinates:r.getCoordinates()}}function $(r,e){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function ee(r,e){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function te(r,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}function re(r,e){return{type:"Point",coordinates:r.getCoordinates()}}function ne(r,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}export{I as F,ce as G,H as J,ue as a,g as t};
