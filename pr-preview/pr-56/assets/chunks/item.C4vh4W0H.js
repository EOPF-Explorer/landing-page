import{U as R,c as ce,g as pe}from"./cesium.DzXtLnwn.js";const ee=["http","https"];function de(e,t,r=!0){return ge(e,t,!1,r)}function ge(e,t=null,r=!1,s=!0){let i=R(e);if(t&&i.is("relative")){let a=R(t),l=a.path();!l.endsWith("/")&&!l.endsWith(".json")&&a.path(l+"/"),i=i.absoluteTo(a)}return i.normalize(),r&&(i.query(""),i.fragment("")),s?i.toString():i}var re={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(ce,function(){var r=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function s(c,x){return c.indexOf(x)===-1?c.length:c.indexOf(x)}function i(c){var x=c.replace(/^v/,"").replace(/\+.*$/,""),A=s(x,"-"),w=x.substring(0,A).split(".");return w.push(x.substring(A+1)),w}function a(c){return isNaN(Number(c))?c:Number(c)}function l(c){if(typeof c!="string")throw new TypeError("Invalid argument expected string");if(!r.test(c))throw new Error("Invalid argument not valid semver ('"+c+"' received)")}function h(c,x){[c,x].forEach(l);for(var A=i(c),w=i(x),d=0;d<Math.max(A.length-1,w.length-1);d++){var Y=parseInt(A[d]||0,10),j=parseInt(w[d]||0,10);if(Y>j)return 1;if(j>Y)return-1}var W=A[A.length-1],N=w[w.length-1];if(W&&N){var C=W.split(".").map(a),M=N.split(".").map(a);for(d=0;d<Math.max(C.length,M.length);d++){if(C[d]===void 0||typeof M[d]=="string"&&typeof C[d]=="number")return-1;if(M[d]===void 0||typeof C[d]=="string"&&typeof M[d]=="number"||C[d]>M[d])return 1;if(M[d]>C[d])return-1}}else if(W||N)return W?-1:1;return 0}var f=[">",">=","=","<","<="],p={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function O(c){if(typeof c!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof c);if(f.indexOf(c)===-1)throw new TypeError("Invalid operator, expected one of "+f.join("|"))}return h.validate=function(c){return typeof c=="string"&&r.test(c)},h.compare=function(c,x,A){O(A);var w=h(c,x);return p[A].indexOf(w)>-1},h})})(re);var ye=re.exports,V=ye;const H="1.1.0",u=!0,o={classification:"https://stac-extensions.github.io/classification/v2.0.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.2.0/schema.json",eo:"https://stac-extensions.github.io/eo/v2.0.0/schema.json",file:"https://stac-extensions.github.io/file/v2.1.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.2.0/schema.json",projection:"https://stac-extensions.github.io/projection/v2.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v2.0.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.1.0/schema.json",version:"https://stac-extensions.github.io/version/v1.2.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},T={itemAndCollection:{"classification:":o.classification,"cube:":o.datacube,"eo:":o.eo,"file:":o.file,"label:":o.label,"pc:":o.pointcloud,"processing:":o.processing,"proj:":o.projection,"raster:":o.raster,"sar:":o.sar,"sat:":o.sat,"sci:":o.scientific,"view:":o.view,version:o.version,deprecated:o.version,published:o.timestamps,expires:o.timestamps,unpublished:o.timestamps},catalog:{},collection:{},item:{}};T.collection=Object.assign(T.collection,T.itemAndCollection);T.item=Object.assign(T.item,T.itemAndCollection);var I={parseExtension(e){let t=e.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(t)return{id:t[1],version:t[2]};let r=e.match(/(\d+\.\d+(\.\d+)([a-z_.-][\w.-]+)?)/i);if(r)return{id:e,version:r[1]};if(e in o)return{id:e,version:"0.0.0"}}},m={version:H,extensions:{},set(e){if(typeof e.stac_version!="string"?m.version="0.6.0":m.version=e.stac_version,Array.isArray(e.stac_extensions))for(let t of e.stac_extensions){let r=I.parseExtension(t);r&&(m.extensions[r.id]=r.version)}},before(e,t=null){return m.compare("<",e,t)},compare(e,t,r=null){let s=r?m.extensions[r]:m.version;return typeof s>"u"?!1:V.compare(s,t,e)}},n={type(e){let t=typeof e;if(t==="object"){if(e===null)return"null";if(Array.isArray(e))return"array"}return t},is(e,t){return Array.isArray(t)?t.includes(n.type(e)):n.type(e)===t},isDefined(e){return typeof e<"u"},isObject(e){return typeof e=="object"&&e===Object(e)&&!Array.isArray(e)},rename(e,t,r){return typeof e[t]<"u"&&typeof e[r]>"u"?(e[r]=e[t],delete e[t],!0):!1},copy(e,t,r){return typeof e[t]<"u"&&typeof e[r]>"u"?(e[r]=e[t],!0):!1},forAll(e,t,r){if(e[t]&&typeof e[t]=="object")for(let s in e[t])r(e[t][s])},toArray(e,t){return typeof e[t]<"u"&&!Array.isArray(e[t])?(e[t]=[e[t]],!0):!1},flattenArray(e,t,r,s=!1){if(Array.isArray(e[t])){for(let i in e[t])if(typeof r[i]=="string"){let a=e[t][i];e[r[i]]=s?[a]:a}return delete e[t],!0}return!1},flattenOneElementArray(e,t,r=!1){return!r&&Array.isArray(e[t])?e[t].length===1?(e[t]=e[t][0],!0):!1:!0},removeFromArray(e,t,r){if(Array.isArray(e[t])){let s=e[t].indexOf(r);return s>-1&&e[t].splice(s,1),!0}return!1},pickFirst(e,t){return Array.isArray(e[t])&&e[t].length>0?(e[t]=e[t][0],!0):(delete e[t],!1)},ensure(e,t,r){return n.type(r)!==n.type(e[t])&&(e[t]=r),!0},upgradeExtension(e,t){let{id:r,version:s}=I.parseExtension(t),i=e.stac_extensions.findIndex(a=>{let l=I.parseExtension(a);return l&&l.id===r&&V.compare(l.version,s,"<")});return i!==-1?(e.stac_extensions[i]=t,!0):!1},addExtension(e,t){let{id:r,version:s}=I.parseExtension(t),i=e.stac_extensions.findIndex(a=>{if(a===t)return!0;let l=I.parseExtension(a);return!!(l&&l.id===r&&V.compare(l.version,s,"<"))});return i===-1?e.stac_extensions.push(t):e.stac_extensions[i]=t,e.stac_extensions.sort(),!0},removeExtension(e,t){return n.removeFromArray(e,"stac_extensions",t)},migrateExtensionShortnames(e){let t=Object.keys(o),r=Object.values(o);return n.mapValues(e,"stac_extensions",t,r)},populateExtensions(e,t){let r=[];(t=="catalog"||t=="collection")&&r.push(e),(t=="item"||t=="collection")&&n.isObject(e.assets)&&(r=r.concat(Object.values(e.assets))),t=="collection"&&n.isObject(e.item_assets)&&(r=r.concat(Object.values(e.item_assets))),t=="collection"&&n.isObject(e.summaries)&&r.push(e.summaries),t=="item"&&n.isObject(e.properties)&&r.push(e.properties),r.push(e.links);let s;for(;s=r.pop();)Object.keys(s).forEach(i=>{Array.isArray(s.bands)&&(r=r.concat(s.bands));let a=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(a)){let l=T[t][a[0]];n.is(l,"string")&&n.addExtension(e,l)}})},mapValues(e,t,r,s){let i=a=>{let l=r.indexOf(a);return l>=0?s[l]:a};return Array.isArray(e[t])?e[t]=e[t].map(i):typeof e[t]<"u"&&(e[t]=i(e[t])),!0},mapObject(e,t){for(let r in e)e[r]=t(e[r],r)},moveTo(e,t,r,s=!1,i=!1){let a;return s?i?a=l=>Array.isArray(l):a=l=>Array.isArray(l)&&l.length===1:a=n.isDefined,a(e[t])?(r[t]=s&&!i?e[t][0]:e[t],delete e[t],!0):!1},runAll(e,t,r,s){for(let i in e)i.startsWith("migrate")||e[i](t,r,s)},toUTC(e,t){if(n.is(e[t],"string"))try{return e[t]=this.toISOString(e[t]),!0}catch{}return delete e[t],!1},toISOString(e){return e instanceof Date||(e=new Date(e)),e.toISOString().replace(/\.0+(?=[-\+Z])/,"")},formatString(e,t,r){const s=i=>n.is(i,["string","number"])?r.replaceAll("{}",i):i;Array.isArray(e[t])?e[t]=e[t].map(s):e[t]=s(e[t])}},v={multihash:null,hexToUint8(e){if(e.length===0||e.length%2!==0)throw new Error(`The string "${e}" is not valid hex.`);return new Uint8Array(e.match(/.{1,2}/g).map(t=>parseInt(t,16)))},uint8ToHex(e){return e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),"")},toMultihash(e,t,r){if(!v.multihash||!n.is(e[t],"string"))return!1;try{const s=v.multihash.encode(v.hexToUint8(e[t]),r);return e[t]=v.uint8ToHex(s),!0}catch(s){return console.warn(s),!1}}},Z={migrate(e,t=!0){return m.set(e),t&&(e.stac_version=H),e.type="Catalog",n.ensure(e,"stac_extensions",[]),m.before("1.0.0-rc.1")&&n.migrateExtensionShortnames(e),n.ensure(e,"id",""),n.ensure(e,"description",""),n.ensure(e,"links",[]),n.runAll(Z,e,e),m.before("0.8.0")&&n.populateExtensions(e,"catalog"),e}},q={migrate(e,t=!0){return Z.migrate(e,t),e.type="Collection",m.before("1.0.0-rc.1")&&n.migrateExtensionShortnames(e),n.ensure(e,"license","other"),n.ensure(e,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),n.runAll(q,e,e),n.isObject(e.properties)&&(n.removeFromArray(e,"stac_extensions","commons"),delete e.properties),m.before("0.8.0")&&n.populateExtensions(e,"collection"),m.before("1.0.0-beta.1")&&n.mapValues(e,"stac_extensions",["assets"],["item-assets"]),e},extent(e){if(n.ensure(e,"extent",{}),m.before("0.8.0")&&(Array.isArray(e.extent.spatial)&&(e.extent.spatial={bbox:[e.extent.spatial]}),Array.isArray(e.extent.temporal)&&(e.extent.temporal={interval:[e.extent.temporal]})),n.ensure(e.extent,"spatial",{}),n.ensure(e.extent.spatial,"bbox",[]),n.ensure(e.extent,"temporal",{}),n.ensure(e.extent.temporal,"interval",[]),m.before("1.0.0-rc.3")){if(e.extent.temporal.interval.length>1){let t,r;for(let s of e.extent.temporal.interval){if(s[0]===null)t=null;else if(typeof s[0]=="string"&&t!==null)try{let i=new Date(s[0]);(typeof t>"u"||i<t)&&(t=i)}catch{}if(s[1]===null)r=null;else if(typeof s[1]=="string"&&r!==null)try{let i=new Date(s[1]);(typeof r>"u"||i>r)&&(r=i)}catch{}}e.extent.temporal.interval.unshift([t?n.toISOString(t):null,r?n.toISOString(r):null])}if(e.extent.spatial.bbox.length>1){let t=e.extent.spatial.bbox.reduce((r,s)=>Array.isArray(s)?Math.max(s.length,r):r,4);if(t>=4){let r=new Array(t).fill(null),s=t/2;for(let i of e.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let a in i){let l=i[a];r[a]===null?r[a]=l:a<s?r[a]=Math.min(l,r[a]):r[a]=Math.max(l,r[a])}}r.findIndex(i=>i===null)===-1&&e.extent.spatial.bbox.unshift(r)}}}},collectionAssets(e){m.before("1.0.0-rc.1")&&n.removeExtension(e,"collection-assets"),D.migrateAll(e)},itemAsset(e){m.before("1.0.0-beta.2")&&n.rename(e,"item_assets","assets"),n.removeExtension(e,o["item-assets"]),D.migrateAll(e,"item_assets")},summaries(e){if(n.ensure(e,"summaries",{}),m.before("0.8.0")&&n.isObject(e.other_properties)){for(let t in e.other_properties){let r=e.other_properties[t];Array.isArray(r.extent)&&r.extent.length===2?e.summaries[t]={minimum:r.extent[0],maximum:r.extent[1]}:Array.isArray(r.values)&&(r.values.filter(s=>Array.isArray(s)).length===r.values.length?e.summaries[t]=r.values.reduce((s,i)=>s.concat(i),[]):e.summaries[t]=r.values)}delete e.other_properties}if(m.before("1.0.0-beta.1")&&n.isObject(e.properties)&&!e.links.find(t=>["child","item"].includes(t.rel)))for(let t in e.properties){let r=e.properties[t];Array.isArray(r)||(r=[r]),e.summaries[t]=r}m.before("1.0.0-rc.1")&&n.mapObject(e.summaries,t=>(n.rename(t,"min","minimum"),n.rename(t,"max","maximum"),t)),F.migrate(e.summaries,e,!0),n.moveTo(e.summaries,"sci:doi",e,!0)&&n.addExtension(e,o.scientific),n.moveTo(e.summaries,"sci:publications",e,!0,!0)&&n.addExtension(e,o.scientific),n.moveTo(e.summaries,"sci:citation",e,!0)&&n.addExtension(e,o.scientific),n.moveTo(e.summaries,"cube:dimensions",e,!0)&&n.addExtension(e,o.datacube),Object.keys(e.summaries).length===0&&delete e.summaries}},K={migrate(e,t=null,r=!0){m.set(e),r&&(e.stac_version=H),n.ensure(e,"stac_extensions",[]),m.before("1.0.0-rc.1")&&n.migrateExtensionShortnames(e),n.ensure(e,"id",""),n.ensure(e,"type","Feature"),n.isObject(e.geometry)||(e.geometry=null),e.geometry!==null&&n.ensure(e,"bbox",[]),n.ensure(e,"properties",{}),n.ensure(e,"links",[]),n.ensure(e,"assets",{});let s=!1;return n.isObject(t)&&n.isObject(t.properties)&&(n.removeFromArray(e,"stac_extensions","commons"),e.properties=Object.assign({},t.properties,e.properties),s=!0),n.runAll(K,e,e),F.migrate(e.properties,e),D.migrateAll(e),(m.before("0.8.0")||s)&&n.populateExtensions(e,"item"),e}},se={migrate(e,t=!0){return n.ensure(e,"collections",[]),n.ensure(e,"links",[]),n.runAll(se,e,e),e.collections=e.collections.map(r=>q.migrate(r,t)),e}},ne={migrate(e,t=!0){return n.ensure(e,"type","FeatureCollection"),n.ensure(e,"features",[]),n.ensure(e,"links",[]),n.runAll(ne,e,e),e.features=e.features.map(r=>K.migrate(r,null,t)),e}},D={migrateAll(e,t="assets"){for(let r in e[t])D.migrate(e[t][r],e)},migrate(e,t){return n.runAll(D,e,t),F.migrate(e,t),e},mediaTypes(e){n.is(e.type,"string")&&n.mapValues(e,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])}},$={migrateAll(e,t){if(m.before("1.0.0")){const r=n.isObject(t.properties)&&Array.isArray(t.properties.bands)?t.properties.bands:[];if(Array.isArray(e["eo:bands"]))for(let s in e["eo:bands"]){let i=e["eo:bands"][s];n.is(i,"number")&&n.isObject(r[i])&&(i=r[i]),n.isObject(i)||(i={}),e["eo:bands"][s]=i}}if(m.before("1.1.0-beta.1")&&(Array.isArray(e["raster:bands"])||Array.isArray(e["eo:bands"]))){n.ensure(e,"bands",[]);const r=e["raster:bands"]||[],s=e["eo:bands"]||[],i=Math.max(r.length,s.length);for(let a=0;a<i;a++)n.ensure(e.bands,a,{}),Object.assign(e.bands[a],r[a],s[a]),e.bands[a]=$.migrate(e.bands[a],t);delete e["raster:bands"],delete e["eo:bands"]}},migrate(e,t){return n.runAll($,e,t),F.migrate(e,t),e},eo(e){m.before("2.0.0-beta.1","eo")&&(n.rename(e,"common_name","eo:common_name"),n.rename(e,"center_wavelength","eo:center_wavelength"),n.rename(e,"full_width_half_max","eo:full_width_half_max"),n.rename(e,"solar_illumination","eo:solar_illumination"))},raster(e){m.before("2.0.0-beta.1","raster")&&(n.rename(e,"sampling","raster:sampling"),n.rename(e,"bits_per_sample","raster:bits_per_sample"),n.rename(e,"spatial_resolution","raster:spatial_resolution"),n.rename(e,"scale","raster:scale"),n.rename(e,"offset","raster:offset"),n.rename(e,"histogram","raster:histogram"))}},F={migrate(e,t,r=!1){return n.runAll(F,e,t,r),e},_commonMetadata(e,t){m.before("1.0.0-rc.3")&&(n.toUTC(e,"created"),n.toUTC(e,"updated")),$.migrateAll(e,t)},_timestamps(e,t){n.toUTC(e,"published"),n.toUTC(e,"expires"),n.toUTC(e,"unpublished"),n.upgradeExtension(t,o.timestamps)},_versioningIndicator(e,t){n.upgradeExtension(t,o.version)},checksum(e,t){m.before("0.9.0")&&v.multihash&&(n.rename(e,"checksum:md5","checksum:multihash")&&v.toMultihash(e,"checksum:multihash","md5"),n.rename(e,"checksum:sha1","checksum:multihash")&&v.toMultihash(e,"checksum:multihash","sha1"),n.rename(e,"checksum:sha2","checksum:multihash")&&v.toMultihash(e,"checksum:multihash","sha2-256"),n.rename(e,"checksum:sha3","checksum:multihash")&&v.toMultihash(e,"checksum:multihash","sha3-256")),m.before("1.0.0-rc.1")&&n.rename(e,"checksum:multihash","file:checksum")&&n.addExtension(t,o.file),n.removeExtension(t,"checksum")},classification(e,t){m.before("1.1.0","classification")&&n.forAll(e,"classification:classes",r=>n.rename(r,"color-hint","color_hint")),m.before("2.0.0","classification")&&n.forAll(e,"classification:classes",r=>n.ensure(r,"name",r.description)),n.upgradeExtension(t,o.classification)},cube(e,t){n.upgradeExtension(t,o.datacube)},dtr(e,t){m.before("0.9.0")&&(n.rename(e,"dtr:start_datetime","start_datetime"),n.rename(e,"dtr:end_datetime","end_datetime"),n.removeExtension(t,"datetime-range"))},eo(e,t){m.before("0.9.0")&&(n.rename(e,"eo:epsg","proj:epsg")&&n.addExtension(t,o.projection),n.rename(e,"eo:platform","platform"),n.rename(e,"eo:instrument","instruments")&&n.toArray(e,"instruments"),n.rename(e,"eo:constellation","constellation"),n.rename(e,"eo:off_nadir","view:off_nadir")&&n.addExtension(t,o.view),n.rename(e,"eo:azimuth","view:azimuth")&&n.addExtension(t,o.view),n.rename(e,"eo:incidence_angle","view:incidence_angle")&&n.addExtension(t,o.view),n.rename(e,"eo:sun_azimuth","view:sun_azimuth")&&n.addExtension(t,o.view),n.rename(e,"eo:sun_elevation","view:sun_elevation")&&n.addExtension(t,o.view)),m.before("1.0.0-beta.1")&&n.rename(e,"eo:gsd","gsd"),n.upgradeExtension(t,o.eo)},file(e,t,r){n.rename(e,"file:bits_per_sample","raster:bits_per_sample")&&n.addExtension(t,o.raster),n.rename(e,"file:data_type","data_type"),n.rename(e,"file:unit","unit"),Array.isArray(e["file:nodata"])&&e["file:nodata"].length>1&&n.copy(e,"file:nodata","nodata:values"),n.rename(e,"file:nodata","nodata")&&!r&&n.pickFirst(e,"nodata"),n.upgradeExtension(t,o.file)},label(e,t){m.before("0.8.0")&&(n.rename(e,"label:property","label:properties"),n.rename(e,"label:task","label:tasks"),n.rename(e,"label:overview","label:overviews")&&n.toArray(e,"label:overviews"),n.rename(e,"label:method","label:methods"),n.toArray(e,"label:classes")),n.upgradeExtension(t,o.label)},pc(e,t){m.before("0.8.0")&&n.rename(e,"pc:schema","pc:schemas"),n.upgradeExtension(t,o.pointcloud)},processing(e,t){n.upgradeExtension(t,o.processing)},proj(e,t){n.rename(e,"proj:epsg","proj:code")&&n.formatString(e,"proj:code","EPSG:{}"),n.upgradeExtension(t,o.projection)},raster(e,t){n.upgradeExtension(t,o.raster)},sar(e,t,r){n.rename(e,"sar:incidence_angle","view:incidence_angle")&&n.addExtension(t,o.view),n.rename(e,"sar:pass_direction","sat:orbit_state")&&n.mapValues(e,"sat:orbit_state",[null],["geostationary"])&&n.addExtension(t,o.sat),m.before("0.7.0")&&(n.flattenArray(e,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],r),n.flattenArray(e,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],r),n.flattenArray(e,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],r),n.rename(e,"sar:off_nadir","view:off_nadir")&&n.addExtension(t,o.view)),m.before("0.9.0")&&(n.rename(e,"sar:platform","platform"),n.rename(e,"sar:instrument","instruments")&&n.toArray(e,"instruments"),n.rename(e,"sar:constellation","constellation"),n.rename(e,"sar:type","sar:product_type"),n.rename(e,"sar:polarization","sar:polarizations"),n.flattenOneElementArray(e,"sar:absolute_orbit",r)&&n.rename(e,"sar:absolute_orbit","sat:absolute_orbit")&&n.addExtension(t,o.sat),n.flattenOneElementArray(e,"sar:relative_orbit",r)&&n.rename(e,"sar:relative_orbit","sat:relative_orbit")&&n.addExtension(t,o.sat)),n.upgradeExtension(t,o.sar)},sat(e,t){m.before("0.9.0")&&(n.rename(e,"sat:off_nadir_angle","sat:off_nadir"),n.rename(e,"sat:azimuth_angle","sat:azimuth"),n.rename(e,"sat:sun_azimuth_angle","sat:sun_azimuth"),n.rename(e,"sat:sun_elevation_angle","sat:sun_elevation")),n.upgradeExtension(t,o.sat)},sci(e,t){n.upgradeExtension(t,o.scientific)},item(e){m.before("0.8.0")&&(n.rename(e,"item:license","license"),n.rename(e,"item:providers","providers"))},table(e,t){n.upgradeExtension(t,o.table)},view(e,t){n.upgradeExtension(t,o.view)}},k={item(e,t=null,r=!0){return K.migrate(e,t,r)},catalog(e,t=!0){return Z.migrate(e,t)},collection(e,t=!0){return q.migrate(e,t)},collectionCollection(e,t=!0){return se.migrate(e,t)},itemCollection(e,t=!0){return ne.migrate(e,t)},stac(e,t=!0){return e.type==="Feature"?k.item(e,null,t):e.type==="FeatureCollection"?k.itemCollection(e,t):e.type==="Collection"||!e.type&&n.isDefined(e.extent)&&n.isDefined(e.license)?k.collection(e,t):!e.type&&Array.isArray(e.collections)?k.collectionCollection(e,t):k.catalog(e,t)},enableMultihash(e){v.multihash=e}},xe=k;const Ie=pe(xe);function g(e){return typeof e=="string"&&e.length>0}function B(e,t,r,s=1e-8){if(typeof e!="number")return null;const i=t-s,a=r+s;return e<i||e>a?null:Math.min(Math.max(e,t),r)}function y(e){return typeof e=="object"&&e===Object(e)&&!Array.isArray(e)}function Ae(e){switch(e){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return e.startsWith("u")?0:null}function ve(e){switch(e){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function ie(e){const t={minimum:null,maximum:null},r=f=>f.minimum!==null&&f.maximum!==null,s=e.getMetadata("statistics");if(y(s)&&(typeof s.minimum=="number"&&(t.minimum=s.minimum),typeof s.maximum=="number"&&(t.maximum=s.maximum),r(t)))return t;const i=e.getMetadata("raster:histogram");if(y(i)&&(typeof i.min=="number"&&(t.minimum=i.min),typeof i.max=="number"&&(t.maximum=i.max),r(t)))return t;const a=e.getMetadata("classification:classes");if(Array.isArray(a)&&(a.reduce((f,p)=>(f.minimum=Math.min(f.minimum,p.value),f.maximum=Math.max(f.maximum,p.value),f),t),r(t)))return t;const l=e.getMetadata("file:values");if(Array.isArray(l)&&(l.reduce((f,p)=>(f.minimum=Math.min(f.minimum,...p.values),f.maximum=Math.max(f.maximum,...p.values),f),t),r(t)))return t;const h=e.getMetadata("data_type");return h&&(t.minimum=Ae(h),t.maximum=ve(h)),t}function ae(e){let t=[];const r=e.getMetadata("nodata");if(typeof r<"u")t.push(r);else{const s=e.getMetadata("file:nodata");if(typeof s<"u")t=s;else{const i=e.getMetadata("classification:classes");Array.isArray(i)&&(t=i.filter(a=>!!a.nodata).map(a=>a.value))}}return t.map(s=>s==="nan"?NaN:s==="+inf"?1/0:s==="-inf"?-1/0:s)}function S(e){let t=e.length>=6,r=e[0],s=e[t?3:2],i=e[1],a=e[t?4:3],l={west:r,east:s,south:i,north:a};return t&&(l.base=e[2],l.height=e[5]),l}function P(e){let{west:t,east:r,south:s,north:i}=S(e);return[[[t,i],[t,s],[r,s],[r,i],[t,i]]]}function _e(e){if(e=_(e,!0),!e)return null;let t=S(e),r=[];if(le(e)){let s=(t.west+360+t.east)/2;s>180&&(s-=360),r.push(s)}else r.push((t.west+t.east)/2);return r.push((t.south+t.north)/2),typeof t.base<"u"&&r.push((t.base+t.height)/2),r}function ue(e){if(Array.isArray(e[0]))return e.map(ue);const[t,r]=e;return[B(t,-180,180),B(r,-90,90)]}function G(e){return y(e)&&(e.bbox&&(e.bbox=_(e.bbox)),e.type==="FeatureCollection"?e.features.forEach(t=>G(t)):e.type==="Feature"?e.geometry=G(e.geometry):e.type==="GeometryCollection"?e.geometries.forEach(t=>G(t)):e.coordinates&&(e.coordinates=ue(e.coordinates))),e}function we(e){if(e.every(s=>typeof s=="number")&&(e=[e]),e=e.map(s=>_(s)).filter(s=>s!==null),!Array.isArray(e)||e.length===0)return null;let t=e.reduce((s,i)=>{if(le(i)){let{west:a,east:l,south:h,north:f}=S(i);s.push(P([-180,h,l,f])),s.push(P([a,h,180,f]))}else s.push(P(i));return s},[]),r=null;if(t.length===1?r={type:"Polygon",coordinates:t[0]}:t.length>1&&(r={type:"MultiPolygon",coordinates:t}),r)return{type:"Feature",geometry:r,properties:{}}}function _(e,t=!1){if(!Array.isArray(e)||![4,6].includes(e.length))return null;let{west:r,east:s,south:i,north:a,base:l,height:h}=S(e);return r=B(r,-180,180),i=B(i,-90,90),s=B(s,-180,180),a=B(a,-90,90),t&&e.length===6?e=[r,i,l,s,a,h]:e=[r,i,s,a],e.some(f=>f===null)?null:e}function le(e){if(e=_(e),!e)return!1;let{west:t,east:r}=S(e);return t>r}function Le(e){if(!Array.isArray(e)||e.length===0)return null;const t={west:null,south:null,east:null,north:null},r=["west","south"];for(let i of e){if(i=_(i),!i)continue;const a=S(i);for(const l in a)if(t[l]===null)t[l]=a[l];else{const h=r.includes(l)?Math.min:Math.max;t[l]=h(t[l],a[l])}}let s=[t.west,t.south,t.east,t.north];return _(s)}class U{constructor(t,r={},s=[]){if(!y(t))throw new Error("Given data is not an object");if(t instanceof U){for(let i of s)this[i]=t[i];t=t.toJSON()}this._keyMap=r,this._privateKeys=["_keyMap","_privateKeys"].concat(s);for(let i in t)typeof this[i]>"u"&&(i in r?this[i]=r[i](t[i],this):this[i]=t[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(t=!0){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return _e(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(r=>{if(typeof this[r]=="function"||this._privateKeys.includes(r))return;let s=this[r];if(r in this._keyMap){let i=Array.isArray(s)?[]:{};for(let a in s)typeof s[a].toJSON=="function"?i[a]=s[a].toJSON():i[a]=s[a];s=i}t[r]=s}),t}}const Ee="application/geo+json",Oe=["application/json",Ee,"text/json"],te=["image/gif","image/jpeg","image/apng","image/png","image/webp"],oe=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],fe=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(oe);function X(e,t,r=!1){return Array.isArray(t)||(t=[t]),r&&typeof e>"u"?!0:typeof e!="string"?!1:(t=t.map(s=>s.toLowerCase()),t.includes(e.toLowerCase()))}function Te(e,t=!1){return X(e,Oe,t)}class me extends U{constructor(t,r=null,s={},i=[]){super(t,s,["_context"].concat(i)),this._context||(this._context=r)}getAbsoluteUrl(t=!0){return this._context?de(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?t?this.href:R(this.href):null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string")return!1;if(!t&&typeof this.type>"u")return!1;let r=this.getAbsoluteUrl(!1);r||(r=R(this.href));const s=r.protocol().toLowerCase(),i=r.suffix().toLowerCase();return g(s)&&!ee.includes(s)?!1:g(this.type)&&te.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&g(i)&&(i==="jpg"||te.includes("image/"+i)))}isType(t){return g(this.type)&&X(this.type,t)}isGeoTIFF(){return this.isType(fe)}isCOG(){return this.isType(oe)}isHTTP(){let t=this.getAbsoluteUrl(!1);if(!t)return null;const r=t.protocol().toLowerCase();return g(r)&&ee.includes(r)}isPreview(){return!1}}class Q extends me{constructor(t,r=null){super(t,r)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(t,r=null){return Array.isArray(t)?t.map(s=>y(s)?new Q(s,r):s):[]}}class Ce extends U{constructor(t,r=null,s={},i=[]){if(super(t,Object.assign({links:Q.fromLinks},s),["_url"].concat(i)),!this._url&&(this._url=r,!this._url)){let a=this.getSelfLink();a&&(this._url=a.href)}}getAbsoluteUrl(t=!0){return t?this._url:R(this._url)}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,r=!0){return this.getLinksWithRels([t]).filter(s=>Te(s.type,r))}getStacLinkWithRel(t,r=!0){const s=this.getStacLinksWithRel(t,r);return s.length>0?s[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>y(t)&&g(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(r=>r.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(r=>t.includes(r.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(r=>!t.includes(r.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class b extends U{constructor(t,r=null,s=null){super(t,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof r=="string"?parseInt(r,10):r),this._context||(this._context=s)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getMinMaxValues(){return ie(this)}getNoDataValues(){return ae(this)}static fromBands(t,r=null){let s=[];if(Array.isArray(t))for(let i in t){const a=t[i],l=a instanceof b?a:new b(a,i,r);s.push(l)}return s}}const Me=["created","updated","published","expires","unpublished","bands"];class E extends me{constructor(t,r=null,s=null){const i={bands:b.fromBands,alternate:E.fromAssets};super(t,s,i,["_key"]),this._key||(this._key=r)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context instanceof E)return this._context.getMetadata(t);if(this._context&&!Me.includes(t))return this._context.getMetadata(t)}getBands(){return this.bands||[]}findVisualBands(){const t={red:null,green:null,blue:null},r=this.getBands();for(const i in r){const a=parseInt(i,10),l=r[a];y(l)&&g(l["eo:common_name"])&&l["eo:common_name"]in t&&(t[l["eo:common_name"]]=l)}return Object.values(t).every(i=>i!==null)?t:null}findBand(t,r="name"){Array.isArray(t)||(t=[t]);const s=this.getBands(),i=s.findIndex(a=>y(a)&&t.includes(a[r]));return i>=0?s[i]:null}getBand(t){return y(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(){return ie(this)}getNoDataValues(){return ae(this)}isDefinition(){return!g(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const t=["thumbnail","overview"];return t.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(r=>t.includes(r))}hasRole(t,r=!1){return Array.isArray(t)||(t=[t]),r&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(s=>t.includes(s))}static fromAssets(t,r=null){let s={};if(y(t))for(let i in t){const a=t[i],l=a instanceof E?a:new E(a,i,r);s[i]=l}return s}}function he(e){if(!e)return;const t=String(e),r=t.indexOf("@"),s=r!==-1?t.substr(r+1):void 0,i=r!==-1?t.substr(0,r):t,a=String(i).replace(/-/g,"_").split("_");if(!a.length||a.length>4)return;const l=a.shift();if(!l)return;const h={keyword:s,language:l.toLowerCase()};if(!a.length)return h;if(a.length===3){const O=a.pop();O&&(h.variant=O.toUpperCase())}let f=a.pop();if(f.length>3&&(h.keyword=f,f=a.pop()),f&&(h.country=f.toUpperCase()),!a.length)return h;const p=a.pop();return typeof p=="string"&&p.length>=1&&(h.script=p[0].toUpperCase()+p.substring(1).toLowerCase()),h}function ke(e){const t={};return e.forEach(r=>{const{language:s,country:i}=he(r);if(!s)throw new Error(`Locale ${r} is not parsable`);t[s]||(t[s]={countries:{},firstCountry:void 0,main:void 0});const a=t[s];i?(a.countries[i]=r,a.firstCountry||(a.firstCountry=r)):a.main=r}),t}function J(e,t,r,s){const i=Array.isArray(e)?ke(e):e;if(!t&&r)return J(e,r,void 0);if(!t)return;const{language:a,country:l}=he(t);if(!a)return r;if(!i[a])return t===r?void 0:J(e,r,null);const{countries:h,main:f=r,firstCountry:p}=i[a];return!h||!l?f:h[l]?h[l]:f}class z extends Ce{constructor(t,r=null,s={},i=[]){super(t,r,s,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getLocaleLink(t,r=null){let s=this.getStacLinksWithRel("alternate").filter(l=>g(l.hreflang)),i;Array.isArray(this.languages)?i=this.languages.map(l=>l.code):i=s.map(l=>l.hreflang);let a=J(i,t,r);return s.find(l=>l.hreflang===a)||null}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(r=>r.canBrowserDisplayImage(t))}getThumbnails(t=!0,r=null){let s=this.getAssets().filter(i=>i.isPreview());if(s.length===0&&(s=this.getLinks().filter(i=>i.isPreview())),s.length===0){const i=this.getAsset("thumbnail");i&&s.push(i)}if(t&&(s=s.filter(i=>i.canBrowserDisplayImage())),r&&s.length>1){let i=a=>Array.isArray(a.roles)&&a.roles.includes(r)||a.getKey()===r;s=s.filter(i).concat(s.filter(a=>!i(a)))}return s}getDefaultGeoTIFF(t=!0,r=!1){var i;return(i=this.rankGeoTIFFs(t,r)[0])==null?void 0:i.asset}rankGeoTIFFs(t=!0,r=!1,s=null,i=null){y(s)||(s={data:1,visual:2,thumbnail:2,overview:3});let a=[],l=this.getAssetsByTypes(fe);t&&(l=l.filter(f=>f.isHTTP()&&(!r||f.isCOG())));let h=Object.entries(s);for(let f of l){let p=0;if(h.length>0){let O=h.filter(([c])=>f.hasRole(c,!0)).map(([,c])=>c);O.length>0&&(p+=Math.max(...O))}!r&&f.isCOG()&&(p+=2),f.findVisualBands()&&(p+=1),typeof i=="function"&&(p+=i(f)),a.push({asset:f,score:p})}return a.sort((f,p)=>p.score-f.score),a}findVisualAssets(){let t={red:null,green:null,blue:null},r=Object.keys(t),s=this.getAssets();for(let a of s){let l=a.findBand(r,"eo:common_name");l&&(t[l["eo:common_name"]]=a)}return Object.values(t).every(a=>a!==null)?t:null}getAsset(t){return y(this.assets)&&this.assets[t]||null}getAssets(){return y(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,r=!1){return this.getAssets().filter(s=>s.hasRole(t,r))}getAssetWithRole(t,r=!1){return this.getAssetsWithRoles([t],r)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(r=>X(r.type,t))}equals(t){return this===t?!0:!(t instanceof z)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}supportsExtension(t){if(!Array.isArray(this.stac_extensions))return!1;let r=new RegExp("^"+t.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(s=>r.test(s))}}class Be extends z{constructor(t,r=null,s={},i=[]){super(t,r,s,i)}getObjectType(){return this.type}getSearchLink(t=null){let r=this.getStacLinksWithRel("search");return t?r[0]||null:r.find(s=>s.method===t||!t&&!s.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}function L(e){if(g(e)&&e.length>=10)try{let r=e.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(s=>parseInt(s,10));return new Date(Date.UTC(r[0],r[1]-1,r[2],r[3],r[4],r[5],r[6]||0))}catch{return null}return null}function be(e,t){return new Date(e.valueOf()+(t-e)/2)}function Re(e){if(!Array.isArray(e)||e.length===0)return null;let t,r;const s=(i,a,l)=>typeof i>"u"?a:i===null||a===null?null:l(i,a);return e.forEach(([i,a])=>{t=s(t,i,Math.min),r=s(r,a,Math.max)}),[t===null?null:new Date(t),r===null?null:new Date(r)]}class De extends Be{constructor(t,r=null){const s={assets:E.fromAssets,item_assets:E.fromAssets};super(t,r,s)}toGeoJSON(){let t=we(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0?_(t[0]):null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1?[_(t[0])]:t.length>1?t.slice(1).map(_):null}getRawBoundingBoxes(){var r,s;let t=(s=(r=this.extent)==null?void 0:r.spatial)==null?void 0:s.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var r,s;let t=(s=(r=this.extent)==null?void 0:r.temporal)==null?void 0:s.interval;return Array.isArray(t)&&t.length>0?t.filter(i=>Array.isArray(i)&&(g(i[0])||g(i[1]))).map(i=>i.map(a=>L(a))):[]}getSummary(t){if(y(this.summaries))return this.summaries[t]}getBands(){let t=this.getMetadata("bands");return Array.isArray(t)||(t=this.getSummary("bands")),Array.isArray(t)?b.fromBands(t,this):[]}}class Fe extends z{constructor(t,r=null){super(t,r,{assets:E.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return _(this.bbox)}getBoundingBoxes(){const t=this.getBoundingBox();return t?[t]:[]}getDateTime(){let t=L(this.properties.datetime);if(!t){let r=L(this.properties.start_datetime),s=L(this.properties.end_datetime);return r&&s?be(r,s):r||s}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return g(this.properties.start_datetime)||g(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:g(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(r=>r.map(s=>L(s)))}getMetadata(t){return this.properties[t]}getBands(){const t=this.getMetadata("bands");return Array.isArray(t)?b.fromBands(t,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}export{E as A,De as C,Fe as I,Ie as M,Ce as S,Be as a,Re as b,z as c,we as d,G as f,Ee as g,y as i,de as t,Le as u};
