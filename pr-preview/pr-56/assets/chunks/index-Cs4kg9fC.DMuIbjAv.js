var Bi=Object.defineProperty;var Ge=i=>{throw TypeError(i)};var Ui=(i,t,e)=>t in i?Bi(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var x=(i,t,e)=>Ui(i,typeof t!="symbol"?t+"":t,e),Se=(i,t,e)=>t.has(i)||Ge("Cannot "+e);var I=(i,t,e)=>(Se(i,t,"read from private field"),e?e.call(i):t.get(i)),b=(i,t,e)=>t.has(i)?Ge("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),E=(i,t,e,n)=>(Se(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);import"./main.8saUv_hF.js";import{A as lt,i as ne,b as M,a as Ji,e as Ki}from"./addCommonStyleSheet.SqMauTqt.js";import{e as Zi,i as qi}from"./directive.CvdRHFdJ.js";import{p as Wi}from"./directive-helpers.D5ycj-Q3.js";import{n as $t}from"./when.BR7zwNJC.js";import{g as zi}from"./getElement.CdRlZPdn.js";import"./main.DPeZ2vN-.js";import{_ as Qi,af as Di,u as tn,am as en,an as nn,j as rn,i as sn,a as on,ah as Ie,be as an,aq as ln,bf as hn,d as cn,e as un}from"./eo-dash.C1XGZ0Eg.js";import{c as dn,j as fn,P as gn}from"./ProcessList-hcxfa8f7.C3qwOT4o.js";import pn from"./EodashChart-CagtkRvP.CNF8P4Oe.js";import{i as Xt,u as yn,h as mn}from"./handling-Df_d9h0M.CP2A6qYa.js";import{g as _n,f as Cn,n as wn}from"./async-D_q14ueQ.D9OdMPdm.js";import{O as vn,P as Mn}from"./mdi.C8D1Z8V3.js";import{L as Fn,c as Ee,o as at,y as Pn,f as Ct,b as Yt,i as Ln,u as wt,j as K,g as Bt,e as Re,a as Ne,l as De,w as be,D as Gn}from"./runtime-core.esm-bundler.MgDDUQih.js";import"./cesium.DzXtLnwn.js";import"./sequential.BcvVcPN9.js";import"./orient2d.DArCjZZA.js";import"./browser.DFZfevSN.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.CdF70kIP.js";import"./index.2GfG_t-c.js";import"./index.D6yXn0Ww.js";import"./olcs.Cqh799zv.js";import"./runtime-dom.esm-bundler.CVWPxwnJ.js";import"./item.C4vh4W0H.js";import"./index-C5npyZY6.yfo0dUXv.js";import"./VTooltip-CifBbpCx.Bw4WmwDN.js";import"./forwardRefs-64mgSLjK.BpVEf6-p.js";import"./transition-BwFOaDL9.CcFMTQO6.js";/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Sn=Zi(class extends qi{constructor(){super(...arguments),this.key=lt}render(i,t){return this.key=i,t}update(i,[t,e]){return t!==this.key&&(Wi(i),this.key=t),e}}),In=i=>{i.hoverInteraction=i.eoxMap.selectInteractions.SelectLayerHoverInteraction,i.clickInteraction=i.eoxMap.selectInteractions.SelectLayerClickInteraction;const t=()=>{i.requestUpdate()};i.hoverInteraction.selectStyleLayer.on("change",t),i.clickInteraction.selectStyleLayer.on("change",t)},En=(i,t,e)=>{if(i.clickId===t)return;const n=e?[]:[t];i.hoverInteraction.highlightById(n)},Rn=(i,t,e)=>{i.stopPropagation();const n=Number(i.target.getAttribute("index")),r=t.drawLayer.getSource().getFeatures()[n];t.drawLayer.getSource().removeFeature(r),t.drawnFeatures.splice(n,1),e.emitDrawnFeatures(),t.requestUpdate()},Te={duration:750,padding:[20,20,20,20]},Ae={type:"FeatureCollection",features:[]},Nn=(i,t)=>{const{clickId:e,drawLayer:n,olMap:r,clickInteraction:s}=t,o=s.getId(i);if(e===o){const l=n.getSource().getExtent();r.getView().fit(l,Te),s.highlightById([])}else{const l=t.eoxMap.projection||"EPSG:3857",h=t.eoxDrawTools.projection,c=i.clone().getGeometry().transform(h,l).getExtent();s.highlightById([o]),r.getView().fit(c,Te)}t.requestUpdate()};class ti extends ne{constructor(){super();x(this,"hoverInteraction");x(this,"clickInteraction");x(this,"hoverId");x(this,"clickId");this.eoxDrawTools=null,this.eoxMap=null,this.olMap=null,this.draw=null,this.drawLayer=null,this.drawnFeatures=[],this.featureName="Feature",this.featureNameKey=null,this.modify=null,this.unstyled=!1}_handleDelete(e){Rn(e,this,this.eoxDrawTools),this.dispatchEvent(new CustomEvent("changed",{bubbles:!0}))}_handleFeatureSelectAndDeselect(e){Nn(e,this)}_handleHoverFeature(e,n=!1){En(this,e,n)}firstUpdated(){In(this)}createRenderRoot(){return this}render(){var n,r;this.hoverId=(n=this.hoverInteraction)==null?void 0:n.selectedFids[0],this.clickId=(r=this.clickInteraction)==null?void 0:r.selectedFids[0];const e=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>trash-can-outline</title>
      <path
        d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
      />
    </svg>`;return M`
      <ul class="list no-space">
        ${this.drawnFeatures.map((s,o)=>{var p;const a=o+1,l=Object.values(this.eoxMap.selectInteractions)[0].getId(s),h=this.hoverId===l,c=this.clickId===l,u=h?"surface-container-low":c?"fill":lt,d=(p=this.featureNameKey)==null?void 0:p.split("."),f=s.get(this.featureNameKey)||(d==null?void 0:d.reduce((y,F)=>y==null?void 0:y[F],{...s.getProperties()})),g=f||`${this.featureName} ${a}`;return Sn(a,M`
              <li
                class="${u} no-round"
                @mouseover=${()=>this._handleHoverFeature(l)}
                @mouseout=${()=>this._handleHoverFeature(l,!0)}
                @click="${()=>this._handleFeatureSelectAndDeselect(s)}"
              >
                <div class="max">
                  <span class="title">${g}</span>
                </div>
                <button
                  index=${o}
                  data-cy="deleteFeatureBtn"
                  class="transparent square small error-text front"
                  @click="${this._handleDelete}"
                >
                  ${this.unstyled?"x":M`<i class="small">${e}</i>`}
                </button>
              </li>
            `)})}
      </ul>
    `}}x(ti,"properties",{eoxDrawTools:{attribute:!1,state:!0},eoxMap:{attribute:!1,state:!0},olMap:{attribute:!1,state:!0},draw:{attribute:!1,state:!0},drawLayer:{attribute:!1,state:!0},drawnFeatures:{attribute:!1,state:!0,type:Array},featureName:{attribute:!1,state:!0,type:String},featureNameKey:{attribute:!1,state:!0,type:String},modify:{attribute:!1,state:!0},unstyled:{type:Boolean}});customElements.define("eox-drawtools-list",ti);const bn=i=>{const{multipleFeatures:t,drawnFeatures:e,currentlyDrawing:n}=i,r=!t&&(e==null?void 0:e.length)>0||n,s=!(e!=null&&e.length)&&!n;return{drawDisabled:r,discardDisabled:s}};function Tn(i){navigator.clipboard.writeText(i).then(function(){},function(t){console.error("Could not copy text: ",t)})}const An={PROPERTYCHANGE:"propertychange"},re={CHANGE:"change"};class On{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function xn(i,t,e){let n,r;e=e||ei;let s=0,o=i.length,a=!1;for(;s<o;)n=s+(o-s>>1),r=+e(i[n],t),r<0?s=n+1:(o=n,a=!r);return a?s:~s}function ei(i,t){return i>t?1:i<t?-1:0}function R(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function Hn(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function Oe(){}function ii(i){let t,e,n;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==n||!Hn(r,e))&&(n=this,e=r,t=i.apply(this,arguments)),t}}function ni(i){for(const t in i)delete i[t]}function ri(i){let t;for(t in i)return!1;return!t}class si{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class kn extends On{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new si(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,Oe);delete o[n]}return l}disposeInternal(){this.listeners_&&ni(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Oe,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}function ht(i,t,e,n,r){if(r){const o=e;e=function(a){return i.removeEventListener(t,e),o.call(n??this,a)}}else n&&n!==i&&(e=e.bind(n));const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function xe(i,t,e,n){return ht(i,t,e,n,!0)}function Lt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ni(i))}class Nt extends kn{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(re.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=ht(this,t[s],e);return r}return ht(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=xe(this,t[s],e)}else n=xe(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Vn(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}Nt.prototype.on;Nt.prototype.once;Nt.prototype.un;function Vn(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Lt(i[t]);else Lt(i)}function m(){throw new Error("Unimplemented abstract method.")}let jn=0;function $n(i){return i.ol_uid||(i.ol_uid=String(++jn))}class He extends si{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class oi extends Nt{constructor(t){super(),this.on,this.once,this.un,$n(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new He(n,t,e)),n=An.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new He(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],ri(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function Xn(i,t){if(!i)throw new Error(t)}class $ extends oi{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new $(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Lt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ht(t,re.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Yn(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Yn(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Xn(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}const P={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function B(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function ai(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function ke(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1];let l=P.UNKNOWN;return o<e?l=l|P.LEFT:o>r&&(l=l|P.RIGHT),a<n?l=l|P.BELOW:a>s&&(l=l|P.ABOVE),l===P.UNKNOWN&&(l=P.INTERSECTING),l}function se(){return[1/0,1/0,-1/0,-1/0]}function li(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function oe(i){return li(1/0,1/0,-1/0,-1/0,i)}function hi(i,t){const e=i[0],n=i[1];return li(e,n,e,n,t)}function ae(i,t,e,n,r){const s=oe(r);return ci(s,i,t,e,n)}function Bn(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function ci(i,t,e,n,r){for(;e<n;e+=r)Un(i,t[e],t[e+1]);return i}function Un(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Jn(i,t){let e;return e=t(Kn(i)),e||(e=t(Zn(i)),e)||(e=t(Wn(i)),e)||(e=t(qn(i)),e)?e:!1}function Kn(i){return[i[0],i[1]]}function Zn(i){return[i[2],i[1]]}function bt(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Gt(i){return i[3]-i[1]}function qn(i){return[i[0],i[3]]}function Wn(i){return[i[2],i[3]]}function zn(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Qn(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Dn(i,t,e){let n=!1;const r=ke(i,t),s=ke(i,e);if(r===P.INTERSECTING||s===P.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],d=e[0],f=e[1],g=(f-u)/(d-c);let p,y;s&P.ABOVE&&!(r&P.ABOVE)&&(p=d-(f-h)/g,n=p>=o&&p<=l),!n&&s&P.RIGHT&&!(r&P.RIGHT)&&(y=f-(d-l)*g,n=y>=a&&y<=h),!n&&s&P.BELOW&&!(r&P.BELOW)&&(p=d-(f-a)/g,n=p>=o&&p<=l),!n&&s&P.LEFT&&!(r&P.LEFT)&&(y=f-(d-o)*g,n=y>=a&&y<=h)}return n}function tr(i,t,e,n,r,s){const o=r-e,a=s-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=r,n=s):l>0&&(e+=o*l,n+=a*l)}return j(i,t,e,n)}function j(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function Ve(i){return i*180/Math.PI}function Pt(i){return i*Math.PI/180}function le(i,t,e){return i+e*(t-i)}function qt(i,t,e){if(i>=t&&i<e)return i;const n=e-t;return((i-t)%n+n)%n+t}const er={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class he{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||er[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const mt=6378137,W=Math.PI*mt,ir=[-W,-W,W,W],nr=[-180,-85,180,85],vt=mt*Math.log(Math.tan(Math.PI/2));class Z extends he{constructor(t){super({code:t,units:"m",extent:ir,global:!0,worldExtent:nr,getPointResolution:function(e,n){return e/Math.cosh(n[1]/mt)}})}}const je=[new Z("EPSG:3857"),new Z("EPSG:102100"),new Z("EPSG:102113"),new Z("EPSG:900913"),new Z("http://www.opengis.net/def/crs/EPSG/0/3857"),new Z("http://www.opengis.net/gml/srs/epsg.xml#3857")];function rr(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n){t[s]=W*i[s]/180;let o=mt*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));o>vt?o=vt:o<-vt&&(o=-vt),t[s+1]=o}return t}function sr(i,t,e,n){const r=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=n)t[s]=180*i[s]/W,t[s+1]=360*Math.atan(Math.exp(i[s+1]/mt))/Math.PI-90;return t}const or=6378137,$e=[-180,-90,180,90],ar=Math.PI*or/180;class H extends he{constructor(t,e){super({code:t,units:"degrees",extent:$e,axisOrientation:e,global:!0,metersPerUnit:ar,worldExtent:$e})}}const Xe=[new H("CRS:84"),new H("EPSG:4326","neu"),new H("urn:ogc:def:crs:OGC:1.3:CRS84"),new H("urn:ogc:def:crs:OGC:2:84"),new H("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new H("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new H("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Wt={};function lr(i){return Wt[i]||Wt[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function hr(i,t){Wt[i]=t}let z={};function ct(i,t,e){const n=i.getCode(),r=t.getCode();n in z||(z[n]={}),z[n][r]=e}function Ut(i,t){return i in z&&t in z[i]?z[i][t]:null}const St=.9996,S=.00669438,Tt=S*S,At=Tt*S,k=S/(1-S),Ye=Math.sqrt(1-S),et=(1-Ye)/(1+Ye),ui=et*et,ce=ui*et,ue=ce*et,di=ue*et,fi=1-S/4-3*Tt/64-5*At/256,cr=3*S/8+3*Tt/32+45*At/1024,ur=15*Tt/256+45*At/1024,dr=35*At/3072,fr=3/2*et-27/32*ce+269/512*di,gr=21/16*ui-55/32*ue,pr=151/96*ce-417/128*di,yr=1097/512*ue,It=6378137;function mr(i,t,e){const n=i-5e5,o=(e.north?t:t-1e7)/St/(It*fi),a=o+fr*Math.sin(2*o)+gr*Math.sin(4*o)+pr*Math.sin(6*o)+yr*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,d=u*u,f=d*d,g=1-S*h,p=Math.sqrt(1-S*h),y=It/p,F=(1-S)/g,w=k*c**2,v=w*w,_=n/(y*St),L=_*_,N=L*_,st=N*_,ot=st*_,Vt=ot*_,Yi=a-u/F*(L/2-st/24*(5+3*d+10*w-4*v-9*k))+Vt/720*(61+90*d+298*w+45*f-252*k-3*v);let jt=(_-N/6*(1+2*d+w)+ot/120*(5-2*w+28*d-3*v+8*k+24*f))/c;return jt=qt(jt+Pt(gi(e.number)),-Math.PI,Math.PI),[Ve(jt),Ve(Yi)]}const Be=-80,Ue=84,_r=-180,Cr=180;function wr(i,t,e){i=qt(i,_r,Cr),t<Be?t=Be:t>Ue&&(t=Ue);const n=Pt(t),r=Math.sin(n),s=Math.cos(n),o=r/s,a=o*o,l=a*a,h=Pt(i),c=gi(e.number),u=Pt(c),d=It/Math.sqrt(1-S*r**2),f=k*s**2,g=s*qt(h-u,-Math.PI,Math.PI),p=g*g,y=p*g,F=y*g,w=F*g,v=w*g,_=It*(fi*n-cr*Math.sin(2*n)+ur*Math.sin(4*n)-dr*Math.sin(6*n)),L=St*d*(g+y/6*(1-a+f)+w/120*(5-18*a+l+72*f-58*k))+5e5;let N=St*(_+d*o*(p/2+F/24*(5-a+9*f+4*f**2)+v/720*(61-58*a+l+600*f-330*k)));return e.north||(N+=1e7),[L,N]}function gi(i){return(i-1)*6-180+3}const vr=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function pi(i){let t=0;for(const r of vr){const s=i.match(r);if(s){t=parseInt(s[1]);break}}if(!t)return null;let e=0,n=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(n=!0,e=t-32600),e?{number:e,north:n}:null}function Je(i,t){return function(e,n,r,s){const o=e.length;r=r>1?r:2,s=s??r,n||(r>2?n=e.slice():n=new Array(o));for(let a=0;a<o;a+=s){const l=e[a],h=e[a+1],c=i(l,h,t);n[a]=c[0],n[a+1]=c[1]}return n}}function Mr(i){return pi(i)?new he({code:i,units:"m"}):null}function Fr(i){const t=pi(i.getCode());return t?{forward:Je(wr,t),inverse:Je(mr,t)}:null}const Pr=[Fr],Lr=[Mr];function de(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function zt(i){hr(i.getCode(),i),ct(i,i,de)}function Gr(i){i.forEach(zt)}function G(i){if(typeof i!="string")return i;const t=lr(i);if(t)return t;for(const e of Lr){const n=e(i);if(n)return n}return null}function Ke(i){Gr(i),i.forEach(function(t){i.forEach(function(e){t!==e&&ct(t,e,de)})})}function Sr(i,t,e,n){i.forEach(function(r){t.forEach(function(s){ct(r,s,e),ct(s,r,n)})})}function Ir(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||yi(i,t)===de)&&e}function yi(i,t){const e=i.getCode(),n=t.getCode();let r=Ut(e,n);if(r)return r;let s=null,o=null;for(const l of Pr)s||(s=l(i)),o||(o=l(t));if(!s&&!o)return null;const a="EPSG:4326";if(o)if(s)r=Jt(s.inverse,o.forward);else{const l=Ut(e,a);l&&(r=Jt(l,o.forward))}else{const l=Ut(a,n);l&&(r=Jt(s.inverse,l))}return r&&(zt(i),zt(t),ct(i,t,r)),r}function Jt(i,t){return function(e,n,r,s){return n=i(e,n,r,s),t(n,n,r,s)}}function Qt(i,t){const e=G(i),n=G(t);return yi(e,n)}function Er(){Ke(je),Ke(Xe),Sr(Xe,je,rr,sr)}Er();new Array(6);function mi(){return[1,0,0,1,0,0]}function _i(i,t,e,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+t,i[5]=o*r*l+a*r*h+e,i}function Ci(i,t,e,n,r,s,o){s=s||[],o=o||2;let a=0;for(let l=t;l<e;l+=n){const h=i[l],c=i[l+1];s[a++]=r[0]*h+r[2]*c+r[4],s[a++]=r[1]*h+r[3]*c+r[5];for(let u=2;u<o;u++)s[a++]=i[l+u]}return s&&s.length!=a&&(s.length=a),s}function Rr(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=t;d<e;d+=n){const f=i[d]-h,g=i[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let p=d+2;p<d+n;++p)o[u++]=i[p]}return o&&o.length!=u&&(o.length=u),o}function Nr(i,t,e,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const d=i[u]-l,f=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*f;for(let g=u+2;g<u+n;++g)a[c++]=i[g]}return a&&a.length!=c&&(a.length=c),a}function br(i,t,e,n,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Ze=mi(),Tr=[NaN,NaN];class wi extends oi{constructor(){super(),this.extent_=se(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ii((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return m()}closestPointXY(t,e,n,r){return m()}containsXY(t,e){return this.closestPointXY(t,e,Tr,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return m()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&oe(e),this.extentRevision_=this.getRevision()}return Qn(this.extent_,t)}rotate(t,e){m()}scale(t,e,n){m()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return m()}getType(){return m()}applyTransform(t){m()}intersectsExtent(t){return m()}translate(t,e){m()}transform(t,e){const n=G(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Gt(h)/Gt(l);_i(Ze,h[0],h[3],c,-c,0,0,0);const u=Ci(s,0,s.length,a,Ze,o),d=Qt(n,e);return d?d(u,u,a):u}:Qt(n,e);return this.applyTransform(r),this}}class U extends wi{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return ae(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return m()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=qe(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){m()}setLayout(t,e,n){let r;if(t)r=qe(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=J(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Rr(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=bt(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Nr(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();br(n,0,n.length,r,t,e,n),this.changed()}}}function J(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function qe(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Ar(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function Ot(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function _t(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=Ot(i,t,e[o],n);r[s++]=l,t=l}return r.length=s,r}function vi(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=_t(i,t,e[o],n,r[s]);l.length===0&&(l[0]=t),r[s++]=l,t=l[l.length-1]}return r.length=s,r}function Mi(i,t,e,n){const r=[];let s=se();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=ae(i,t,l[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return r}function Or(i,t,e,n,r){return!Jn(r,function(o){return!V(i,t,e,n,o[0],o[1])})}function V(i,t,e,n,r,s){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function fe(i,t,e,n,r,s){if(e.length===0||!V(i,t,e[0],n,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(V(i,e[o-1],e[o],n,r,s))return!1;return!0}function xr(i,t,e,n,r,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(fe(i,t,l,n,r,s))return!0;t=l[l.length-1]}return!1}function ge(i,t,e,n,r,s,o){let a,l,h,c,u,d,f;const g=r[s+1],p=[];for(let w=0,v=e.length;w<v;++w){const _=e[w];for(c=i[_-n],d=i[_-n+1],a=t;a<_;a+=n)u=i[a],f=i[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,p.push(h)),c=u,d=f}let y=NaN,F=-1/0;for(p.sort(ei),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const w=Math.abs(u-c);w>F&&(h=(c+u)/2,fe(i,t,e,n,h,g)&&(y=h,F=w)),c=u}return isNaN(y)&&(y=r[s]),o?(o.push(y,g,F),o):[y,g,F]}function Fi(i,t,e,n,r){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=ge(i,t,l,n,r,2*o,s),t=l[l.length-1]}return s}function Et(i,t,e,n,r,s,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=r;else if(h!==0){let c=i[t],u=i[t+1],d=0;const f=[0];for(let y=t+n;y<e;y+=n){const F=i[y],w=i[y+1];d+=Math.sqrt((F-c)*(F-c)+(w-u)*(w-u)),f.push(d),c=F,u=w}const g=r*d,p=xn(f,g);p<0?(l=(g-f[-p-2])/(f[-p-1]-f[-p-2]),a=t+(-p-2)*n):a=t+p*n}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?i[a+c]:le(i[a+c],i[a+n+c],l);return s}function Dt(i,t,e,n,r,s){if(e==t)return null;let o;if(r<i[t+n-1])return s?(o=i.slice(t,t+n),o[n-1]=r,o):null;if(i[e-1]<r)return s?(o=i.slice(e-n,e),o[n-1]=r,o):null;if(r==i[t+n-1])return i.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const d=a+l>>1;r<i[(d+1)*n-1]?l=d:a=d+1}const h=i[a*n-1];if(r==h)return i.slice((a-1)*n,(a-1)*n+n);const c=i[(a+1)*n-1],u=(r-h)/(c-h);o=[];for(let d=0;d<n-1;++d)o.push(le(i[(a-1)*n+d],i[a*n+d],u));return o.push(r),o}function Hr(i,t,e,n,r,s,o){if(o)return Dt(i,t,e[e.length-1],n,r,s);let a;if(r<i[n-1])return s?(a=i.slice(0,n),a[n-1]=r,a):null;if(i[i.length-1]<r)return s?(a=i.slice(i.length-n),a[n-1]=r,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(r<i[t+n-1])return null;if(r<=i[c-1])return Dt(i,t,c,n,r,!1);t=c}}return null}function kr(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function pe(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function ye(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=pe(i,t,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function Pi(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!ye(i,t,a,n,r))return!1;a.length&&(t=a[a.length-1])}return!0}function Rt(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=pe(i,t,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&kr(i,t,a,n),t=a}return t}function te(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s)t=Rt(i,t,e[s],n,r);return t}function Li(i,t){const e=[];let n=0,r=0,s;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=pe(i,n,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(r,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=o+1,n=l}return e}function xt(i,t,e,n,r,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=i[t],s[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=i[d],p=i[d+1],y=i[u],F=i[u+1];for(let w=d+n;w<u;w+=n){const v=i[w],_=i[w+1],L=tr(v,_,g,p,y,F);L>f&&(c=w,f=L)}f>r&&(l[(c-t)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[t+u*n],s[o++]=i[t+u*n+1]);return o}function Gi(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=xt(i,t,c,n,r,s,o),a.push(o),t=c}return o}function q(i,t){return t*Math.round(i/t)}function Vr(i,t,e,n,r,s,o){if(t==e)return o;let a=q(i[t],r),l=q(i[t+1],r);t+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=q(i[t],r),c=q(i[t+1],r),t+=n,t==e)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=q(i[t],r),d=q(i[t+1],r);if(t+=n,u==h&&d==c)continue;const f=h-a,g=c-l,p=u-a,y=d-l;if(f*y==g*p&&(f<0&&p<f||f==p||f>0&&p>f)&&(g<0&&y<g||g==y||g>0&&y>g)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function me(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Vr(i,t,c,n,r,s,o),a.push(o),t=c}return o}function jr(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=me(i,t,c,n,r,s,o,u),a.push(u),t=c[c.length-1]}return o}class X extends wi{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Lt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(ht(t[e],re.CHANGE,this.changed,this))}clone(){const t=new X(Kt(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<B(this.getExtent(),t,e))return r;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)r=s[o].closestPointXY(t,e,n,r);return r}containsXY(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)if(n[r].containsXY(t,e))return!0;return!1}computeExtent(t){oe(t);const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)Bn(t,e[n].getExtent());return t}getGeometries(){return Kt(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let r=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(r=!0)}return r?new X(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].rotate(t,e);this.changed()}scale(t,e,n){n||(n=bt(this.getExtent()));const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)r[s].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Kt(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Kt(i){return i.map(t=>t.clone())}function Si(i,t,e,n){let r=0;const s=i[e-n],o=i[e-n+1];let a=0,l=0;for(;t<e;t+=n){const h=i[t]-s,c=i[t+1]-o;r+=l*h-a*c,a=h,l=c}return r/2}function Ii(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Si(i,t,a,n),t=a}return r}function $r(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Ii(i,t,a,n),t=a[a.length-1]}return r}function We(i,t,e,n,r,s,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let f=0;f<n;++f)o[f]=le(i[t+f],i[e+f],d);o.length=n;return}else u=t}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function _e(i,t,e,n,r){let s=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=j(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function Ce(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=_e(i,t,a,n,r),t=a}return r}function Xr(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=Ce(i,t,a,n,r),t=a[a.length-1]}return r}function we(i,t,e,n,r,s,o,a,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=j(o,a,i[t],i[t+1]),d<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,d}return h}c=c||[NaN,NaN];let f=t+n;for(;f<e;)if(We(i,f-n,f,n,o,a,c),d=j(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(We(i,e-n,t,n,o,a,c),d=j(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function ve(i,t,e,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=we(i,t,f,n,r,s,o,a,l,h,c),t=f}return h}function Yr(i,t,e,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=ve(i,t,f,n,r,s,o,a,l,h,c),t=f[f.length-1]}return h}function Ht(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<e;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function Me(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=Ht(i,t,l,n,r[s]),t=l}return r.length=s,r}function Br(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=l.length===1&&l[0]===t?[]:Me(i,t,l,n,r[s]),t=l[l.length-1]}return r.length=s,r}class ut extends U{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new ut(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<B(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_e(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),we(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=xt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ut(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ot(this.flatCoordinates,0,t,this.stride),this.changed()}}function Ei(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function kt(i,t,e,n,r,s){return s=s??ci(se(),i,t,e,n),zn(r,s)?s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:Ei(i,t,e,n,function(o,a){return Dn(r,o,a)}):!1}function Ur(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){if(kt(i,t,e[s],n,r))return!0;t=e[s]}return!1}function Jr(i,t,e,n,r){return!!(kt(i,t,e,n,r)||V(i,t,e,n,r[0],r[1])||V(i,t,e,n,r[0],r[3])||V(i,t,e,n,r[2],r[1])||V(i,t,e,n,r[2],r[3]))}function Ri(i,t,e,n,r){if(!Jr(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Or(i,e[s-1],e[s],n,r)&&!kt(i,e[s-1],e[s],n,r))return!1;return!0}function Kr(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(Ri(i,t,a,n,r))return!0;t=a[a.length-1]}return!1}function Ni(i,t,e,n){let r=i[t],s=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return o}class T extends U{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){R(this.flatCoordinates,t),this.changed()}clone(){const t=new T(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<B(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_e(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),we(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))}forEachSegment(t){return Ei(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Dt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Et(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Ni(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=xt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new T(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return kt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ot(this.flatCoordinates,0,t,this.stride),this.changed()}}class it extends U{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const r=t,s=[],o=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];R(s,c.getFlatCoordinates()),o.push(s.length)}const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){R(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new it(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<B(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ce(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ve(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,r))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Hr(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Me(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new T(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,r=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new T(t.slice(s,l),n);r.push(h),s=l}return r}getLength(){const t=this.ends_;let e=0,n=0;for(let r=0,s=t.length;r<s;++r)n+=Ni(this.flatCoordinates,e,t[r],this.stride),e=t[r];return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const r=this.ends_,s=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],h=Et(e,n,l,s,.5);R(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Gi(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new it(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Ur(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=_t(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class A extends U{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new A(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=j(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return hi(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ai(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ar(this.flatCoordinates,0,t,this.stride),this.changed()}}class rt extends U{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){R(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new rt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<B(this.getExtent(),t,e))return r;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=j(t,e,s[a],s[a+1]);if(h<r){r=h;for(let c=0;c<o;++c)n[c]=s[a+c];n.length=o}}return r}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new A(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,r=[];for(let s=0,o=t.length;s<o;s+=n){const a=new A(t.slice(s,s+n),e);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let r=0,s=e.length;r<s;r+=n){const o=e[r],a=e[r+1];if(ai(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ot(this.flatCoordinates,0,t,this.stride),this.changed()}}class O extends U{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?R(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new O(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<B(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ce(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ve(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return fe(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Ii(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Rt(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Me(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=bt(this.getExtent());this.flatInteriorPoint_=ge(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new A(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ut(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ut(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;ye(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Rt(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=me(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new O(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Ri(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=_t(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class nt extends U{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const r=t,s=[],o=[];for(let a=0,l=r.length;a<l;++a){const h=r[a],c=s.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;R(s,h.getFlatCoordinates()),o.push(u)}e=r.length===0?this.getLayout():r[0].getLayout(),t=s,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;R(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,s=e.length;r<s;++r)e[r]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const n=new nt(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,r){return r<B(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xr(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return xr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return $r(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),te(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Br(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Mi(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Fi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new rt(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Pi(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=te(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=jr(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new nt(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const n=this.endss_[t].slice(),r=n[n.length-1];if(e!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=e;return new O(this.flatCoordinates.slice(e,r),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(s!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=s;const c=new O(e.slice(s,h),t,l);r.push(c),s=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return Kr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=vi(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const r=n[n.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const ze=mi();class Y{constructor(t,e,n,r,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?hi(this.flatCoordinates_):ae(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=bt(this.getExtent());this.flatInteriorPoints_=ge(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Li(this.flatCoordinates_,this.ends_),e=Mi(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Fi(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Et(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let r=0,s=n.length;r<s;++r){const o=n[r],a=Et(t,e,o,2,.5);R(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=G(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const r=Gt(n)/Gt(e);_i(ze,n[0],n[3],r,-r,0,0,0),Ci(this.flatCoordinates_,0,this.flatCoordinates_.length,2,ze,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Y(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ii((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":n.length=xt(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),r=[n.length];break;case"MultiLineString":r=[],n.length=Gi(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,r);break;case"Polygon":r=[],n.length=me(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,r);break}return r&&(this.simplifiedGeometry_=new Y(this.type_,n,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Y.prototype.getFlatCoordinates=Y.prototype.getOrientedFlatCoordinates;function Zr(i){const t=i.getType();switch(t){case"Point":return new A(i.getFlatCoordinates());case"MultiPoint":return new rt(i.getFlatCoordinates(),"XY");case"LineString":return new T(i.getFlatCoordinates(),"XY");case"MultiLineString":return new it(i.getFlatCoordinates(),"XY",i.getEnds());case"Polygon":const e=i.getFlatCoordinates(),n=i.getEnds(),r=Li(e,n);return r.length>1?new nt(e,"XY",r):new O(e,"XY",n);default:throw new Error("Invalid geometry type:"+t)}}function qr(i,t){const e=i.getId(),n=Zr(i),r=i.getProperties(),s=new $;return s.setGeometry(n),e!==void 0&&s.setId(e),s.setProperties(r,!0),s}class bi{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=$,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?G(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=G(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return m()}readFeature(t,e){return m()}readFeatures(t,e){return m()}readGeometry(t,e){return m()}readProjection(t){return m()}writeFeature(t,e){return m()}writeFeatures(t,e){return m()}writeGeometry(t,e){return m()}}function dt(i,t,e){const n=e?G(e.featureProjection):null,r=e?G(e.dataProjection):null;let s=i;if(n&&r&&!Ir(n,r)){t&&(s=i.clone());const o=t?n:r,a=t?r:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(Qt(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};s===i&&(s=i.clone()),s.applyTransform(a)}return s}const Wr={Point:A,LineString:T,Polygon:O,MultiPoint:rt,MultiLineString:it,MultiPolygon:nt};function zr(i,t,e){return Array.isArray(t[0])?(Pi(i,0,t,e)||(i=i.slice(),te(i,0,t,e)),i):(ye(i,0,t,e)||(i=i.slice(),Rt(i,0,t,e)),i)}function Ti(i,t){var s;const e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(o=>Ti({...i,geometry:o})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const r=e.layout.length;return dt(new Y(n,n==="Polygon"?zr(e.flatCoordinates,e.ends,r):e.flatCoordinates,(s=e.ends)==null?void 0:s.flat(),r,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function Fe(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(r=>Fe(r,t));return new X(n)}const e=Wr[i.type];return dt(new e(i.flatCoordinates,i.layout||"XY",i.ends),!1,t)}class Qr extends bi{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Mt(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Mt(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return m()}readFeaturesFromObject(t,e){return m()}readGeometry(t,e){return this.readGeometryFromObject(Mt(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return m()}readProjection(t){return this.readProjectionFromObject(Mt(t))}readProjectionFromObject(t){return m()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return m()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return m()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return m()}}function Mt(i){if(typeof i=="string"){const t=JSON.parse(i);return t||null}return i!==null?i:null}class Dr extends Qr{constructor(t){t=t||{},super(),this.dataProjection=G(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=G(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const r=Pe(n.geometry);if(this.featureClass===Y)return Ti({geometry:r,id:n.id,properties:n.properties},e);const s=new $;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(Fe(r,e)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(t,e){const n=t;let r=null;if(n.type==="FeatureCollection"){const s=t;r=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&r.push(h)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return ts(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=G(e.properties.name);else if(e.type==="EPSG")n=G("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(n.id=r),!t.hasProperties())return n;const s=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=ee(o,e),delete s[t.getGeometryName()]),ri(s)||(n.properties=s),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let r=0,s=t.length;r<s;++r)n.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return ee(t,this.adaptOptions(e))}}function Pe(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=is(i);break}case"LineString":{e=ns(i);break}case"Polygon":{e=as(i);break}case"MultiPoint":{e=ss(i);break}case"MultiLineString":{e=rs(i);break}case"MultiPolygon":{e=os(i);break}case"GeometryCollection":{e=es(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function ts(i,t){const e=Pe(i);return Fe(e,t)}function es(i,t){return i.geometries.map(function(n){return Pe(n)})}function is(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:J(t.length)}}function ns(i){var n;const t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:J(((n=t[0])==null?void 0:n.length)||2)}}function rs(i){var s,o;const t=i.coordinates,e=((o=(s=t[0])==null?void 0:s[0])==null?void 0:o.length)||2,n=[],r=_t(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:r,layout:J(e)}}function ss(i){var e;const t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:J(((e=t[0])==null?void 0:e.length)||2)}}function os(i){var s,o;const t=i.coordinates,e=[],n=((o=(s=t[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,r=vi(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:r,layout:J(n)}}function as(i){var s,o;const t=i.coordinates,e=[],n=(o=(s=t[0])==null?void 0:s[0])==null?void 0:o.length,r=_t(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:r,layout:J(n)}}function ee(i,t){i=dt(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=fs(i);break}case"LineString":{n=hs(i);break}case"Polygon":{n=gs(i,t);break}case"MultiPoint":{n=us(i);break}case"MultiLineString":{n=cs(i);break}case"MultiPolygon":{n=ds(i,t);break}case"GeometryCollection":{n=ls(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function ls(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return ee(n,t)})}}function hs(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function cs(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function us(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function ds(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function fs(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function gs(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}const ps=(i,t)=>new Dr().writeFeaturesObject(i,t);class ys extends bi{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Ft(t),this.adaptOptions(e))}readFeatureFromText(t,e){return m()}readFeatures(t,e){return this.readFeaturesFromText(Ft(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return m()}readGeometry(t,e){return this.readGeometryFromText(Ft(t),this.adaptOptions(e))}readGeometryFromText(t,e){return m()}readProjection(t){return this.readProjectionFromText(Ft(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return m()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return m()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return m()}}function Ft(i){return typeof i=="string"?i:""}const ms={POINT:A,LINESTRING:T,POLYGON:O,MULTIPOINT:rt,MULTILINESTRING:it,MULTIPOLYGON:nt},Ai="EMPTY",Oi="Z",xi="M",_s="ZM",C={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},Cs={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class ws{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let n=t,r;if(t=="(")r=C.LEFT_PAREN;else if(t==",")r=C.COMMA;else if(t==")")r=C.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")r=C.NUMBER,n=this.readNumber_();else if(this.isAlpha_(t))r=C.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")r=C.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:n,type:r}}readNumber_(){let t;const e=this.index_;let n=!1,r=!1;do t=="."?n=!0:(t=="e"||t=="E")&&(r=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!r&&(t=="e"||t=="E")||r&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}class vs{constructor(t){this.lexer_=t,this.token_={position:0,type:C.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const e=this.isTokenType(t);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t="XY";const e=this.token_;if(this.isTokenType(C.TEXT)){const n=e.value;n===Oi?t="XYZ":n===xi?t="XYM":n===_s&&(t="XYZM"),t!=="XY"&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(C.LEFT_PAREN)){const t=[];do t.push(this.parseGeometry_());while(this.match(C.COMMA));if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePoint_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePointList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(C.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(C.LEFT_PAREN)){let t;if(this.token_.type==C.LEFT_PAREN?t=this.parsePointTextList_():t=this.parsePointList_(),this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(C.LEFT_PAREN)){const t=this.parseLineStringTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(C.LEFT_PAREN)){const t=this.parsePolygonTextList_();if(this.match(C.RIGHT_PAREN))return t}throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],e=this.layout_.length;for(let n=0;n<e;++n){const r=this.token_;if(this.match(C.NUMBER))t.push(r.value);else break}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(C.COMMA);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(C.COMMA);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(C.COMMA);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(C.COMMA);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(C.TEXT)&&this.token_.value==Ai;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.token_;if(this.match(C.TEXT)){const e=t.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(e=="GEOMETRYCOLLECTION"){if(n)return new X([]);const o=this.parseGeometryCollectionText_();return new X(o)}const r=ms[e];if(!r)throw new Error("Invalid geometry type: "+e);let s;if(n)e=="POINT"?s=[NaN,NaN]:s=[];else switch(e){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new r(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class Ms extends ys{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new ws(t);return new vs(e).parse()}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e),r=new $;return r.setGeometry(n),r}readFeaturesFromText(t,e){let n=[];const r=this.readGeometryFromText(t,e);this.splitCollection_&&r.getType()=="GeometryCollection"?n=r.getGeometriesArray():n=[r];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new $;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(t,e){const n=this.parse_(t);return dt(n,!1,e)}writeFeatureText(t,e){const n=t.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const n=[];for(let s=0,o=t.length;s<o;++s)n.push(t[s].getGeometry());const r=new X(n);return this.writeGeometryText(r,e)}writeGeometryText(t,e){return Vi(dt(t,!0,e))}}function Hi(i){const t=i.getCoordinates();return t.length===0?"":t.join(" ")}function Fs(i){const t=[],e=i.getPoints();for(let n=0,r=e.length;n<r;++n)t.push("("+Hi(e[n])+")");return t.join(",")}function Ps(i){const t=[],e=i.getGeometries();for(let n=0,r=e.length;n<r;++n)t.push(Vi(e[n]));return t.join(",")}function Le(i){const t=i.getCoordinates(),e=[];for(let n=0,r=t.length;n<r;++n)e.push(t[n].join(" "));return e.join(",")}function Ls(i){const t=[],e=i.getLineStrings();for(let n=0,r=e.length;n<r;++n)t.push("("+Le(e[n])+")");return t.join(",")}function ki(i){const t=[],e=i.getLinearRings();for(let n=0,r=e.length;n<r;++n)t.push("("+Le(e[n])+")");return t.join(",")}function Gs(i){const t=[],e=i.getPolygons();for(let n=0,r=e.length;n<r;++n)t.push("("+ki(e[n])+")");return t.join(",")}function Ss(i){const t=i.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=Oi),(t==="XYM"||t==="XYZM")&&(e+=xi),e}const Is={Point:Hi,LineString:Le,Polygon:ki,MultiPoint:Fs,MultiLineString:Ls,MultiPolygon:Gs,GeometryCollection:Ps};function Vi(i){const t=i.getType(),e=Is[t],n=e(i);let r=Cs[t];if(typeof i.getFlatCoordinates=="function"){const s=Ss(i);s.length>0&&(r+=" "+s)}return n.length===0?r+" "+Ai:r+"("+n+")"}const Es=(i,t)=>new Ms().writeFeatures(i,t);var ft,gt;class ji extends ne{constructor(){super();b(this,ft,!0);b(this,gt,!0);this.multipleFeatures=!1,this.drawnFeatures=[],this.importFeatures=!1,this.showEditor=!1,this.currentlyDrawing=!1,this.drawFunc=null,this.geoJSON="",this.type="Polygon",this.unstyled=!1,this.select=!1}updateButtonStates(){const{drawDisabled:e,discardDisabled:n}=bn(this);E(this,ft,e),E(this,gt,n)}createRenderRoot(){return this}render(){this.updateButtonStates();const e=this.currentlyDrawing?"drawing":"draw",n={Polygon:M`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <title>shape-polygon-plus</title>
        <path
          d="M17,15.7V13H19V17L10,21L3,14L7,5H11V7H8.3L5.4,13.6L10.4,18.6L17,15.7M22,5V7H19V10H17V7H14V5H17V2H19V5H22Z"
        />
      </svg>`,Point:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>vector-point-plus</title>
          <path
            d="M9 9V15H15V9H9M11 11H13V13H11V11M18 15V18H15V20H18V23H20V20H23V18H20V15H18Z"
          />
        </svg>
      `,Circle:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>shape-circle-plus</title>
          <path
            d="M11,19A6,6 0 0,0 17,13H19A8,8 0 0,1 11,21A8,8 0 0,1 3,13A8,8 0 0,1 11,5V7A6,6 0 0,0 5,13A6,6 0 0,0 11,19M19,5H22V7H19V10H17V7H14V5H17V2H19V5Z"
          />
        </svg>
      `,LineString:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>vector-polyline-plus</title>
          <path
            d="M2 3V9H4.95L6.95 15H6V21H12V16.41L17.41 11H22V5H16V9.57L10.59 15H9.06L7.06 9H8V3H2M4 5H6V7H4V5M18 7H20V9H18V7M18 15V18H15V20H18V23H20V20H23V18H20V15H18M8 17H10V19H8V17Z"
          />
        </svg>
      `,Box:M`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <title>shape-rectangle-plus</title>
          <path
            d="M19,6H22V8H19V11H17V8H14V6H17V3H19V6M17,17V14H19V19H3V6H11V8H5V17H17Z"
          />
        </svg>
      `},r=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>cursor-default-click</title>
      <path
        d="M10.76,8.69A0.76,0.76 0 0,0 10,9.45V20.9C10,21.32 10.34,21.66 10.76,21.66C10.95,21.66 11.11,21.6 11.24,21.5L13.15,19.95L14.81,23.57C14.94,23.84 15.21,24 15.5,24C15.61,24 15.72,24 15.83,23.92L18.59,22.64C18.97,22.46 19.15,22 18.95,21.63L17.28,18L19.69,17.55C19.85,17.5 20,17.43 20.12,17.29C20.39,16.97 20.35,16.5 20,16.21L11.26,8.86L11.25,8.87C11.12,8.76 10.95,8.69 10.76,8.69M15,10V8H20V10H15M13.83,4.76L16.66,1.93L18.07,3.34L15.24,6.17L13.83,4.76M10,0H12V5H10V0M3.93,14.66L6.76,11.83L8.17,13.24L5.34,16.07L3.93,14.66M3.93,3.34L5.34,1.93L8.17,4.76L6.76,6.17L3.93,3.34M7,10H2V8H7V10"
      />
    </svg>`,s=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>trash-can-outline</title>
      <path
        d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
      />
    </svg>`,o=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>pencil-outline</title>
      <path
        d="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"
      />
    </svg>`,a=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>import</title>
      <path
        d="M14,12L10,8V11H2V13H10V16M20,18V6C20,4.89 19.1,4 18,4H6A2,2 0 0,0 4,6V9H6V6H18V18H6V15H4V18A2,2 0 0,0 6,20H18A2,2 0 0,0 20,18Z"
      />
    </svg>`,l=M`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <title>content-copy</title>
      <path
        d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
      />
    </svg>`;return M`
      <nav>
        <slot></slot>
        <div class="max">
          <!-- Draw Button -->
          <button
            data-cy="drawBtn"
            class="transparent square primary-text no-margin small"
            title="${this.unstyled?this.select?"Select":"Draw":""}"
            ?disabled="${I(this,ft)||lt}"
            @click="${()=>this.drawFunc.start()}"
          >
            ${this.unstyled?e:M`
                  <i class="small"
                    >${this.select?r:n[this.type]}</i
                  >
                  <div class="tooltip bottom">
                    ${this.select?"Select":"Draw"}
                  </div>
                `}
          </button>

          <!-- Discard Button -->
          <button
            data-cy="discardBtn"
            class="transparent square error-text no-margin small"
            title="${this.unstyled?"Discard":""}"
            ?disabled="${I(this,gt)||lt}"
            @click="${()=>this.drawFunc.discard()}"
          >
            ${this.unstyled?"discard":M`
                  <i class="small">${s}</i>
                  <div class="tooltip bottom">Discard</div>
                `}
          </button>
        </div>

        <!-- Editor Button -->
        ${$t(this.showEditor,()=>M`
            <button
              data-cy="editorBtn"
              class="transparent circle primary-text no-margin small"
              title="${this.unstyled?"Edit features":""}"
              @click=${()=>this.renderRoot.querySelector("#editor").classList.toggle("hidden")}
            >
              ${this.unstyled?"import":M`
                    <i class="small">${o}</i>
                    <div class="tooltip bottom">Edit features</div>
                  `}
            </button>
          `)}

        <!-- Import Button -->
        ${$t(this.importFeatures,()=>M`
            <!-- Import Input Field : Hidden -->
            <input
              type="file"
              id="import-file"
              style="display: none;"
              @change=${this.drawFunc.import}
            />

            <!-- Main Import Button -->
            <button
              data-cy="importBtn"
              class="transparent circle primary-text no-margin small"
              title="${this.unstyled?"Import features":""}"
              @click=${()=>this.querySelector("#import-file").click()}
            >
              ${this.unstyled?"import":M`
                    <i class="small">${a}</i>
                    <div class="tooltip bottom">Import features</div>
                  `}
            </button>
          `)}
      </nav>

      <!-- Geo JSON Wrapper -->
      ${$t(this.showEditor,()=>M`
          <div id="editor" class="field textarea border extra hidden">
            <!-- Geo JSON Editor -->
            <textarea
              style="font-family: monospace; font-size: small; line-height: 1.4; padding: 0.4rem;"
              @drop=${this.drawFunc.import}
              @input=${this.drawFunc.editor}
              .value=${this.geoJSON}
            ></textarea>

            <!-- Geo JSON Copy Button -->
            <button
              data-cy="copyBtn"
              class="circle absolute bottom right medium-margin aloha"
              style="z-index: 1"
              @click=${()=>Tn(this.geoJSON)}
            >
              ${this.unstyled?"copy":M`
                    <i class="tiny">${l}</i>
                    <div class="tooltip top">Copy</div>
                  `}
            </button>
          </div>
        `)}
    `}}ft=new WeakMap,gt=new WeakMap,x(ji,"properties",{multipleFeatures:{attribute:!1,type:Boolean},drawnFeatures:{attribute:!1,state:!0,type:Array},currentlyDrawing:{attribute:!1,state:!0,type:Boolean},drawFunc:{attribute:!1,type:Object},select:{type:Boolean},importFeatures:{attribute:"import-features",type:Boolean},showEditor:{attribute:"show-editor",type:Boolean},geoJSON:{attribute:"geo-json",type:String},type:{attribute:"type",type:String},unstyled:{type:Boolean}});customElements.define("eox-drawtools-controller",ji);Ji();const Rs=`
  ${Ki}
  :host {
    --padding: 0.5rem;
  }
  .drawtitle {
    padding-left: var(--padding);
    padding-right: var(--padding);
  }
  .hidden {
    display: none;
  }
`,Ns=i=>{(()=>{var e;if(i.emitDrawnFeatures(),!i.multipleFeatures)(e=i.draw)==null||e.setActive(!1),i.selectionEvents.removeSelectionEvent(),i.currentlyDrawing=!1;else if(i.continuous)if(!i.layerId)i.drawLayer.getSource().clear(),i.drawnFeatures=[];else{const r=i.drawLayer.getSource().getFeatures().at(-1);if(i.drawLayer.getSource().clear(),!r)return;i.drawLayer.getSource().addFeature(r),i.drawnFeatures=[r]}})(),i.requestUpdate()},bs=i=>{const t=()=>{var n;i.drawLayer.set("isDrawingEnabled",!0),(n=i.draw)==null||n.setActive(!0),i.selectionEvents.addSelectionEvent()},e=()=>{i.currentlyDrawing=!0,i.requestUpdate()};t(),e(),document.addEventListener("keydown",({key:n})=>{var r;n==="Escape"&&i.currentlyDrawing&&((r=i.draw)==null||r.setActive(!1),i.currentlyDrawing=!1,i.requestUpdate())})},Zt=(i,t)=>{var h,c,u,d,f;const n=zi(i.for),r=n.map,s="0, 65, 112";i.drawLayer=n.addOrUpdateLayer({zIndex:100,type:"Vector",properties:{id:"drawLayer",layerControlHide:!0,isDrawingEnabled:!1,multipleFeatures:t},source:{type:"Vector"},style:((h=i.featureStyles)==null?void 0:h.layer)||{"fill-color":`rgba(${s}, 0.1)`,"stroke-color":`rgba(${s}, 1)`,"stroke-width":2,"circle-radius":5,"circle-fill-color":`rgba(${s}, 1)`},interactions:[{type:"draw",options:{active:!1,id:"drawInteraction",type:i.type,modify:i.allowModify,stopClick:!0,style:((c=i.featureStyles)==null?void 0:c.layer)||{"fill-color":`rgba(${s}, 0.1)`,"stroke-color":`rgba(${s}, 1)`,"stroke-width":1,"stroke-line-dash":[7,3],"circle-radius":5,"circle-fill-color":`rgba(${s}, 1)`}}},{type:"select",options:{id:"SelectLayerHoverInteraction",condition:"pointermove",style:((u=i.featureStyles)==null?void 0:u.hover)||{"fill-color":`rgba(${s}, 0.2)`,"stroke-color":`rgba(${s}, 1)`,"stroke-width":2},tooltip:!1}},{type:"select",options:{id:"SelectLayerClickInteraction",condition:"click",panIn:!0,style:((d=i.featureStyles)==null?void 0:d.click)||{"fill-color":`rgba(${s}, 0.2)`,"stroke-color":`rgba(${s}, 1)`,"stroke-width":2}}}]}),i.draw=n.interactions.drawInteraction,i.modify=n.interactions.drawInteractionmodify,ie(i,n,i.layerId);const o=()=>i.onModifyEnd(),a=()=>Ns(i);return(f=i.modify)==null||f.on("modifyend",o),n.addEventListener("addfeatures",a),i.drawnFeatures&&i.drawLayer.getSource().addFeatures(i.drawnFeatures),{EoxMap:n,OlMap:r,reset:g=>{var p;!g.eoxMap||!g.drawLayer||(g.drawLayer.getSource().clear(),g.eoxMap.map.removeLayer(g.drawLayer),(p=g.modify)==null||p.un("modifyend",o),g.eoxMap.removeEventListener("addfeatures",a),g.layerId||(g.draw=null),g.modify=null)}}},Ts=i=>{const t=()=>{var r;i.drawnFeatures=[],(r=i.draw)==null||r.setActive(!1),!!i.layerId&&i.selectionEvents.removeSelectionEvent(),i.drawLayer.getSource().clear(),i.geoJSON=null},e=()=>{i.emitDrawnFeatures(),i.currentlyDrawing=!1,i.requestUpdate()};t(),e()},As=(i,t)=>{setTimeout(()=>{const n=i.drawLayer.getSource().getFeatures(),r=i.eoxMap.projection||"EPSG:3857",s=i.projection;i.drawnFeatures=s?n.map(a=>{a=a.clone();const l=a.getGeometry().transform(r,s);return a.setGeometry(l),a}):n;let o;switch(i.format){case"geojson":o=ps(i.drawnFeatures);break;case"wkt":o=Es(i.drawnFeatures);break;case"feature":o=i.drawnFeatures;break;default:o=i.drawnFeatures;break}i.updateGeoJSON(),i.requestUpdate(),t(o)},0)},Os=i=>{const t=r=>{(r==null?void 0:r.detail.id)!=="SelectLayerClickInteraction"||!r.detail.feature||(typeof r.detail.feature.getGeometry().getCoordinates!="function"&&(r.detail.feature=qr(r.detail.feature)),i.drawLayer.getSource().addFeature(r.detail.feature),i.eoxMap.dispatchEvent(new CustomEvent("addfeatures",{detail:r.detail})))};return{addSelectionEvent:()=>{if(i.layerId){const r=i.eoxMap.selectInteractions.SelectLayerHoverInteraction;r==null||r.setActive(!0),i.eoxMap.addEventListener("select",t)}},removeSelectionEvent:()=>{var s;const r=(s=i.eoxMap.selectInteractions)==null?void 0:s.SelectLayerHoverInteraction;r&&(r.selectedFids=[],r==null||r.setActive(!1)),i.eoxMap.removeEventListener("select",t)}}},ie=(i,t,e)=>{var l,h,c,u;if(!e||!t)return;const n=t.getLayerById(e),r=n?JSON.parse(JSON.stringify(n.get("_jsonDefinition"))):null;if(!r){console.error(`Layer with id ${e} not found`);return}const s={type:"select",active:!1,options:{id:"SelectLayerHoverInteraction",condition:"pointermove",active:!1,style:((l=i.featureStyles)==null?void 0:l.hover)||{"fill-color":"rgba(0, 0, 0,0.0)","stroke-color":"#3399CC","stroke-width":2.5}}},o={type:"select",options:{id:"SelectLayerClickInteraction",condition:"click",multi:i.multipleFeatures,modify:i.allowModify,active:!1,style:((h=i.featureStyles)==null?void 0:h.click)||{"fill-color":"rgba(0, 0, 0,0.0)","stroke-color":"rgba(0, 0, 0,0.0)"}}};r.interactions=[s,o],t.addOrUpdateLayer(r),$i(t.layers,e,[r]);const a=i.draw;i.draw=t.selectInteractions.SelectLayerClickInteraction,a==null||a.setActive(!1),(c=t.selectInteractions.SelectLayerClickInteraction)==null||c.setActive(!1),(u=t.selectInteractions.SelectLayerHoverInteraction)==null||u.setActive(!1)};function $i(i,t,e){const n=i.findIndex(r=>r.properties.id===t);if(n!==-1)return i.splice(n,1,...e),i;for(const r of i)if(r.type==="Group"){const s=$i(r.layers,t,e);s!=null&&s.length&&(r.layers=s)}return i}const xs=(i,t,e,n)=>{if(t){if(e){n&&e!==n&&Qe(i,t),ie(i,t,e);return}if(!e&&n){Qe(i,t);return}}};function Qe(i,t){t&&(i.discardDrawing(),i.selectionEvents.removeSelectionEvent(),i.draw=t.interactions.drawInteraction,t.selectInteractions.SelectLayerClickInteraction.remove(),t.selectInteractions.SelectLayerHoverInteraction.remove())}function Hs(i,t){function e(s){s.preventDefault(),s.stopPropagation()}function n(s){s.srcElement.style.opacity="0.4"}function r(s){s.srcElement.style.opacity="1"}["dragenter","dragover","dragleave","drop"].forEach(s=>{t.addEventListener(s,e,!1),["dragenter","dragover"].includes(s)?t.addEventListener(s,n,!1):t.addEventListener(s,r,!1)}),t.addEventListener("drop",s=>Xi(s,i),!1)}function ks(i){i.preventDefault(),i.stopPropagation()}function Xi(i,t){ks(i);let e;"dataTransfer"in i&&i.dataTransfer?e=i.dataTransfer.files:i.target&&"files"in i.target?e=i.target.files:e=[],Array.from(e).forEach(n=>Vs(n,t)),i.target&&"value"in i.target&&(i.target.value="")}function Vs(i,t){const e=new FileReader;e.readAsText(i),e.onloadend=function(){typeof e.result=="string"&&t.handleFeatureChange(e.result)}}var Q,D,pt,tt,yt;class js extends ne{constructor(){super();b(this,Q);b(this,D);b(this,pt);b(this,tt);b(this,yt);this.allowModify=!1,this.for="eox-map",this.currentlyDrawing=!1,this.draw=null,this.drawLayer=null,this.layerId="",this.drawnFeatures=[],this.featureName="Feature",this.featureNameKey=null,this.featureStyles=null,this.modify=null,this.multipleFeatures=!1,this.importFeatures=!1,this.showEditor=!1,this.showList=!1,this.projection="EPSG:4326",this.type="Polygon",this.selectionEvents=null,this.format="feature",this.unstyled=!1,this.noShadow=!1}static get properties(){return{allowModify:{attribute:"allow-modify",type:Boolean},for:{type:String},currentlyDrawing:{attribute:!1,state:!0,type:Boolean},continuous:{type:Boolean},draw:{attribute:!1,state:!0},drawLayer:{attribute:!1,state:!0},drawnFeatures:{attribute:!1,state:!0,type:Array},featureName:{attribute:"feature-name",type:String},featureNameKey:{attribute:"feature-name-key",type:String},layerId:{attribute:"layer-id",type:String},featureStyles:{attribute:!1},modify:{attribute:!1,state:!0},multipleFeatures:{attribute:"multiple-features",type:Boolean},importFeatures:{attribute:"import-features",type:Boolean},showEditor:{attribute:"show-editor",type:Boolean},showList:{attribute:"show-list",type:Boolean},projection:{type:String},noShadow:{attribute:"no-shadow",type:Boolean},format:{type:String},type:{type:String},unstyled:{type:Boolean}}}set continuous(e){E(this,yt,e),e&&(this.multipleFeatures=!0)}get continuous(){return I(this,yt)}set layerId(e){xs(this,this.eoxMap,e,I(this,tt)),E(this,tt,e)}get layerId(){return I(this,tt)}startDrawing(){bs(this)}discardDrawing(){Ts(this)}handleFeatureChange(e,n=!1,r=!0){this.eoxMap.parseTextToFeature(e||JSON.stringify(Ae),this.drawLayer,this.eoxMap,n,r)}handleFilesChange(e){Xi(e,this)}onModifyEnd(){this.emitDrawnFeatures()}updateGeoJSON(){E(this,pt,JSON.stringify(this.eoxMap.parseFeature(this.drawnFeatures)||Ae,void 0,2))}emitDrawnFeatures(){As(this,n=>{this.dispatchEvent(new CustomEvent("drawupdate",{detail:n}))})}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}firstUpdated(){const{EoxMap:e,OlMap:n,reset:r}=Zt(this,this.multipleFeatures);this.resetLayer=r,this.eoxMap=e,E(this,D,n),this.selectionEvents=Os(this),this.importFeatures&&Hs(this,this.eoxMap),this.updateGeoJSON(),this.requestUpdate()}updated(e){if(e.has("for")){const{EoxMap:n,OlMap:r}=Zt(this,this.multipleFeatures);this.eoxMap=n,E(this,D,r)}e.get("type")&&e.get("type")!==this.type&&(this.resetLayer(this),this.firstUpdated(),this.currentlyDrawing=!1)}get eoxMap(){return I(this,Q)}set eoxMap(e){const n=I(this,Q);E(this,Q,e),this.requestUpdate("eoxMap",n)}connectedCallback(){if(super.connectedCallback(),this.drawLayer&&this.eoxMap){const{reset:e}=Zt(this,this.multipleFeatures);this.resetLayer=e}}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.resetLayer)==null||e.call(this,this)}render(){var e;return M`
      <style>
        :host { display: block; }
        ${!this.unstyled&&Rs}
      </style>

      <div class="drawtitle">
        <slot name="drawtitle"
          ><p><strong>Draw</strong></p></slot
        >
      </div>

      <!-- Controller Component -->
      <eox-drawtools-controller
        .drawFunc=${{start:()=>this.startDrawing(),discard:()=>this.discardDrawing(),editor:n=>this.handleFeatureChange(n.target.value,!0),import:n=>this.handleFilesChange(n)}}
        ?select=${!!this.layerId}
        .unstyled=${this.unstyled}
        .drawnFeatures=${this.drawnFeatures}
        .currentlyDrawing=${this.currentlyDrawing}
        .multipleFeatures=${this.multipleFeatures}
        .importFeatures=${this.importFeatures}
        .showEditor=${this.showEditor}
        .geoJSON=${I(this,pt)}
        .type=${this.type}
      ></eox-drawtools-controller>

      <!-- List Component -->
      ${this.showList&&((e=this.drawnFeatures)!=null&&e.length)?M`<eox-drawtools-list
            .eoxDrawTools=${this}
            .eoxMap=${this.eoxMap}
            .olMap=${I(this,D)}
            .draw=${this.draw}
            .drawLayer=${this.drawLayer}
            .drawnFeatures=${this.drawnFeatures}
            .featureName=${this.featureName}
            .featureNameKey=${this.featureNameKey}
            .modify=${this.modify}
            .unstyled=${this.unstyled}
            @changed=${()=>{this.updateGeoJSON(),this.requestUpdate()}}
          ></eox-drawtools-list>`:lt}
    `}}Q=new WeakMap,D=new WeakMap,pt=new WeakMap,tt=new WeakMap,yt=new WeakMap;customElements.define("eox-drawtools",js);const $s=({selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:r,loading:s,isPolling:o,mapElement:a})=>{const l=an(hn);De(async()=>{((a==null?void 0:a.layers.length)??0)>1?await Xt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:r,loading:s,isPolling:o}):l.once(async()=>{await Xt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,loading:s,processResults:r,isPolling:o})})});const h=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";ln(async(c,u)=>{(c=="layertime:updated"||c=="compareLayertime:updated"||c=="time:updated"||c=="compareTime:updated")&&await yn({jsonformSchema:e,newLayers:u}),c===h&&await Xt({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:t,jsonformSchema:e,isProcessed:n,processResults:r,loading:s,isPolling:o})})};function Xs(i,t,e,n){const r=async a=>{await n()},s=async()=>{await Gn(()=>{var a;(a=t.value)==null||a.addEventListener("change",r)})},o=()=>{var a;(a=t.value)==null||a.removeEventListener("change",r)};be(e,a=>{var l;i.value=((l=a==null?void 0:a.options)==null?void 0:l.execute)||!1}),De(()=>{be(i,async a=>{a?await s():o()},{immediate:!0})})}const Ys="eox-jsonform{padding:.7em;min-height:0px}",Bs={ref:"container",class:"py-1"},Us=[".schema"],Js={class:"mt-2 text-right"},Ks={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(i){const t=K(!1),e=K(null),n=Fn("jsonformEl"),r=Bt(()=>{var v;return(v=c.value)==null?void 0:v.links.filter(_=>_.endpoint==="eoxhub_workspaces").length}),s=K(!1),o=K(!1),a=K(!1),l=K([]),h=Bt(()=>!o.value&&!!e.value&&!!n.value),{selectedStac:c,selectedCompareStac:u}=Di(tn()),d=i.enableCompare?u:c,f=i.enableCompare?en:nn,g=i.enableCompare?rn:sn,p=i.enableCompare?dn:fn,y=Bt(()=>{var v;return g.value+((v=f.value)==null?void 0:v.id)});$s({selectedStac:d,mapElement:f.value,jsonformEl:n,jsonformSchema:e,isProcessed:t,processResults:l,loading:s,isPolling:a});const F=()=>{l.value.forEach(v=>{var L;if(!v)return;let _="";typeof v=="string"?(_=v.includes("/")?v.split("/").pop()??"":v,_=_.includes("?")?_.split("?")[0]:_):_=((L=d.value)==null?void 0:L.id)+"_process_results.json",wn(_,v)})},w=async()=>{var N,st,ot;const v=_n(e.value);if(v&&Array.isArray((N=n.value)==null?void 0:N.value[v])&&!((st=n.value)!=null&&st.value[v].length)){t.value=!1;const Vt=i.enableCompare?cn:un;Vt.value=null;return}const L=(ot=n.value)==null?void 0:ot.editor.validate();if(L!=null&&L.length){console.warn("[eodash] Form validation failed",L);return}l.value=[],await mn({jobs:p,selectedStac:d,jsonformEl:n,jsonformSchema:e,loading:s,isPolling:a,processResults:l,mapElement:f.value}),t.value=!0,r.value&&Cn(p,g.value)};return Xs(o,n,e,w),(v,_)=>(at(),Ee("div",Bs,[Pn(gn,{"map-element":wt(f),"enable-compare":i.enableCompare},null,8,["map-element","enable-compare"]),e.value?(at(),Ee("eox-jsonform",{key:y.value,ref_key:"jsonformEl",ref:n,".schema":e.value},null,40,Us)):Ct("v-if",!0),wt(on)?Ct("v-if",!0):(at(),Yt(pn,{key:1,"vega-embed-options":i.vegaEmbedOptions,"enable-compare":i.enableCompare},null,8,["vega-embed-options","enable-compare"])),Ln("div",Js,[h.value?(at(),Yt(Ie,{key:0,loading:s.value,style:{"margin-right":"20px"},"append-icon":[wt(vn)],onClick:w,color:"primary"},{default:Re(()=>[..._[0]||(_[0]=[Ne(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):Ct("v-if",!0),l.value.length&&t.value&&!r.value?(at(),Yt(Ie,{key:1,color:"primary","append-icon":[wt(Mn)],onClick:F},{default:Re(()=>[..._[1]||(_[1]=[Ne(" Download ",-1)])]),_:1},8,["append-icon"])):Ct("v-if",!0)])],512))}},Lo=Qi(Ks,[["styles",[Ys]]]);export{Lo as default};
