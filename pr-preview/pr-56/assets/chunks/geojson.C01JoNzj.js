const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/proj4.D6rA-yPt.js","assets/chunks/olcs.Cqh799zv.js","assets/chunks/cesium.DzXtLnwn.js"])))=>i.map(i=>d[i]);
var ul=Object.defineProperty;var cl=(r,e,t)=>e in r?ul(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var q=(r,e,t)=>cl(r,typeof e!="symbol"?e+"":e,t);import{bD as fl,ar as xt,m as lt,bE as Rs,bF as dl,h as pl,bG as Ls,bH as hl,bI as yl,bJ as ml,bK as nr,bL as Ns,B as js,D as Us,bM as Ni,bN as $s,bO as kr,bP as ji,b3 as zt,X as gl,E as bl,F as Ht,f as yr,S as kt,bQ as Ds,_ as vl,bR as Co,bS as ko,bT as Bs,at as wl,aJ as xl,bU as _l,i as Tl,j as Sl,k as Ui,bm as Il,v as Pl,Z as Al,$ as El,a0 as Ml,a1 as Cl,a2 as kl,bV as Fl,bW as zl,bX as Ol,aM as Rl,aY as qs,aT as Ll,t as Fo,bY as $i,bZ as Nl,Y as zo,b_ as jl,b$ as Ul,c0 as $l,c1 as Di,c2 as Xt,T as fi,d as br,e as bn,ad as Kr,aR as Dl,c3 as Bl,az as ql,aB as vn,q as Gl,c4 as Oo,c5 as Vl,V as Wl,c6 as di,n as pi,c7 as Zl,a_ as Hl,c8 as Jl,c9 as Gs,ca as Xl,R as Kl,cb as Yl,cc as Ql}from"./olcs.Cqh799zv.js";import{W as Ro}from"./WebGLTile.D_NuozSC.js";import{S as eu,a as tu,u as Bi,b as Vs,C as hi,I as Yr,M as ru,A as Ur,c as fr,i as Vn,d as nu,f as iu,g as Lo}from"./item.C4vh4W0H.js";import"./cesium.DzXtLnwn.js";import{M as Qr}from"./Map.hMK3qLcu.js";class qi extends eu{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class ou extends tu{constructor(e,t=null){super(e,t)}}class Ws extends qi{constructor(e,t=null){const n={collections:i=>i.map(o=>o instanceof hi?o:new hi(o))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Bi(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Vs(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Zs extends qi{constructor(e,t=null){const n={features:i=>i.map(o=>o instanceof Yr?o:new Yr(o))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Bi(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Vs(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function $r(r,e=!0,t=!1){return e&&(r=ru.stac(r,t)),r.type==="Feature"?new Yr(r):r.type==="FeatureCollection"?new Zs(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new hi(r):!r.type&&Array.isArray(r.collections)?new Ws(r):new ou(r)}class su extends fl{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Dr(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Dr(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return xt()}readFeaturesFromObject(e,t){return xt()}readGeometry(e,t){return this.readGeometryFromObject(Dr(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return xt()}readProjection(e){return this.readProjectionFromObject(Dr(e))}readProjectionFromObject(e){return xt()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return xt()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return xt()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return xt()}}function Dr(r){if(typeof r=="string"){const e=JSON.parse(r);return e||null}return r!==null?r:null}class yi extends su{constructor(e){e=e||{},super(),this.dataProjection=lt(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=lt(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const i=Gi(n.geometry);if(this.featureClass===Rs)return dl({geometry:i,id:n.id,properties:n.properties},t);const o=new pl;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&o.setGeometryName(n.geometry_name),o.setGeometry(Ls(i,t)),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o}readFeaturesFromObject(e,t){const n=e;let i=null;if(n.type==="FeatureCollection"){const o=e;i=[];const s=o.features;for(let a=0,l=s.length;a<l;++a){const u=this.readFeatureFromObject(s[a],t);u&&i.push(u)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return au(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if(t.type=="name")n=lt(t.properties.name);else if(t.type==="EPSG")n=lt("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(n.id=i),!e.hasProperties())return n;const o=e.getProperties(),s=e.getGeometry();return s&&(n.geometry=mi(s,t),delete o[e.getGeometryName()]),hl(o)||(n.properties=o),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,o=e.length;i<o;++i)n.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return mi(e,this.adaptOptions(t))}}function Gi(r,e){if(!r)return null;let t;switch(r.type){case"Point":{t=uu(r);break}case"LineString":{t=cu(r);break}case"Polygon":{t=hu(r);break}case"MultiPoint":{t=du(r);break}case"MultiLineString":{t=fu(r);break}case"MultiPolygon":{t=pu(r);break}case"GeometryCollection":{t=lu(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return t}function au(r,e){const t=Gi(r);return Ls(t,e)}function lu(r,e){return r.geometries.map(function(n){return Gi(n)})}function uu(r){const e=r.coordinates;return{type:"Point",flatCoordinates:e,layout:nr(e.length)}}function cu(r){var n;const e=r.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:nr(((n=e[0])==null?void 0:n.length)||2)}}function fu(r){var o,s;const e=r.coordinates,t=((s=(o=e[0])==null?void 0:o[0])==null?void 0:s.length)||2,n=[],i=Ns(n,0,e,t);return{type:"MultiLineString",flatCoordinates:n,ends:i,layout:nr(t)}}function du(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:nr(((t=e[0])==null?void 0:t.length)||2)}}function pu(r){var o,s;const e=r.coordinates,t=[],n=((s=(o=e[0])==null?void 0:o[0])==null?void 0:s[0].length)||2,i=ml(t,0,e,n);return{type:"MultiPolygon",flatCoordinates:t,ends:i,layout:nr(n)}}function hu(r){var o,s;const e=r.coordinates,t=[],n=(s=(o=e[0])==null?void 0:o[0])==null?void 0:s.length,i=Ns(t,0,e,n);return{type:"Polygon",flatCoordinates:t,ends:i,layout:nr(n)}}function mi(r,e){r=yl(r,!0,e);const t=r.getType();let n;switch(t){case"Point":{n=wu(r);break}case"LineString":{n=mu(r);break}case"Polygon":{n=xu(r,e);break}case"MultiPoint":{n=bu(r);break}case"MultiLineString":{n=gu(r);break}case"MultiPolygon":{n=vu(r,e);break}case"GeometryCollection":{n=yu(r,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function yu(r,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return mi(n,e)})}}function mu(r,e){return{type:"LineString",coordinates:r.getCoordinates()}}function gu(r,e){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function bu(r,e){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function vu(r,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}function wu(r,e){return{type:"Point",coordinates:r.getCoordinates()}}function xu(r,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}function Vi(r,e){return Hs(r,e,[]).join("")}function Hs(r,e,t){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)t.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)Hs(n,e,t)}return t}function _u(r){return"documentElement"in r}function Tu(r){return new DOMParser().parseFromString(r,"application/xml")}function gi(r,e){return function(t,n){const i=r.call(this,t,n);i!==void 0&&n[n.length-1].push(i)}}function ke(r,e,t){return function(n,i){const o=r.call(this,n,i);if(o!==void 0){const s=i[i.length-1],a=n.localName;let l;a in s?l=s[a]:(l=[],s[a]=l),l.push(o)}}}function F(r,e,t){return function(n,i){const o=r.call(this,n,i);if(o!==void 0){const s=i[i.length-1],a=n.localName;s[a]=o}}}function X(r,e,t){t=t!==void 0?t:{};let n,i;for(n=0,i=r.length;n<i;++n)t[r[n]]=e;return t}function Su(r,e,t,n){let i;for(i=e.firstElementChild;i;i=i.nextElementSibling){const o=r[i.namespaceURI];if(o!==void 0){const s=o[i.localName];s!==void 0&&s.call(n,i,t)}}}function ee(r,e,t,n,i){return n.push(r),Su(e,t,n,i),n.pop()}class Js{read(e){if(!e)return null;if(typeof e=="string"){const t=Tu(e);return this.readFromDocument(t)}return _u(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){xt()}}const Iu="http://www.w3.org/1999/xlink";function Wi(r){return r.getAttributeNS(Iu,"href")}function Pu(r){const e=Vi(r,!1);return Au(e)}function Au(r){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(e)return parseFloat(e[1])}function St(r){const e=Vi(r,!1);return Eu(e)}function Eu(r){const e=/^\s*(\d+)\s*$/.exec(r);if(e)return parseInt(e[1],10)}function G(r){return Vi(r,!1).trim()}const Fe=[null,"http://www.opengis.net/ows/1.1"],Mu=X(Fe,{ServiceIdentification:F(ec),ServiceProvider:F(rc),OperationsMetadata:F(Yu)});class Cu extends Js{constructor(){super()}readFromNode(e){const t=ee({},Mu,e,[]);return t||null}}const ku=X(Fe,{DeliveryPoint:F(G),City:F(G),AdministrativeArea:F(G),PostalCode:F(G),Country:F(G),ElectronicMailAddress:F(G)}),Fu=X(Fe,{Value:ke(nc)}),zu=X(Fe,{AllowedValues:F(Vu)}),Ou=X(Fe,{Phone:F(Qu),Address:F(Gu)}),Ru=X(Fe,{HTTP:F(Xu)}),Lu=X(Fe,{Get:ke(Ju),Post:void 0}),Nu=X(Fe,{DCP:F(Hu)}),ju=X(Fe,{Operation:Ku}),Uu=X(Fe,{Voice:F(G),Facsimile:F(G)}),$u=X(Fe,{Constraint:ke(Wu)}),Du=X(Fe,{IndividualName:F(G),PositionName:F(G),ContactInfo:F(Zu)}),Bu=X(Fe,{Abstract:F(G),AccessConstraints:F(G),Fees:F(G),Title:F(G),ServiceTypeVersion:F(G),ServiceType:F(G)}),qu=X(Fe,{ProviderName:F(G),ProviderSite:F(Wi),ServiceContact:F(tc)});function Gu(r,e){return ee({},ku,r,e)}function Vu(r,e){return ee({},Fu,r,e)}function Wu(r,e){const t=r.getAttribute("name");if(t)return ee({name:t},zu,r,e)}function Zu(r,e){return ee({},Ou,r,e)}function Hu(r,e){return ee({},Ru,r,e)}function Ju(r,e){const t=Wi(r);if(t)return ee({href:t},$u,r,e)}function Xu(r,e){return ee({},Lu,r,e)}function Ku(r,e){const t=r.getAttribute("name"),n=ee({},Nu,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function Yu(r,e){return ee({},ju,r,e)}function Qu(r,e){return ee({},Uu,r,e)}function ec(r,e){return ee({},Bu,r,e)}function tc(r,e){return ee({},Du,r,e)}function rc(r,e){return ee({},qu,r,e)}function nc(r,e){return G(r)}const ht=[null,"http://www.opengis.net/wmts/1.0"],ir=[null,"http://www.opengis.net/ows/1.1"],ic=X(ht,{Contents:F(yc)});class oc extends Js{constructor(){super(),this.owsParser_=new Cu}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=ee(n,ic,e,[]),n||null):null}}const sc=X(ht,{Layer:ke(mc),TileMatrixSet:ke(gc)}),ac=X(ht,{Style:ke(bc),Format:ke(G),TileMatrixSetLink:ke(vc),Dimension:ke(wc),ResourceURL:ke(xc)},X(ir,{Title:F(G),Abstract:F(G),WGS84BoundingBox:F(Ks),BoundingBox:ke(_c),Identifier:F(G)})),lc=X(ht,{LegendURL:ke(Tc)},X(ir,{Title:F(G),Identifier:F(G)})),uc=X(ht,{TileMatrixSet:F(G),TileMatrixSetLimits:F(Ic)}),cc=X(ht,{TileMatrixLimits:gi(Pc)}),fc=X(ht,{TileMatrix:F(G),MinTileRow:F(St),MaxTileRow:F(St),MinTileCol:F(St),MaxTileCol:F(St)}),dc=X(ht,{Default:F(G),Value:ke(G)},X(ir,{Identifier:F(G)})),Xs=X(ir,{LowerCorner:gi(bi),UpperCorner:gi(bi)}),pc=X(ht,{WellKnownScaleSet:F(G),TileMatrix:ke(Sc)},X(ir,{SupportedCRS:F(G),Identifier:F(G),BoundingBox:F(Ks)})),hc=X(ht,{TopLeftCorner:F(bi),ScaleDenominator:F(Pu),TileWidth:F(St),TileHeight:F(St),MatrixWidth:F(St),MatrixHeight:F(St)},X(ir,{Identifier:F(G)}));function yc(r,e){return ee({},sc,r,e)}function mc(r,e){return ee({},ac,r,e)}function gc(r,e){return ee({},pc,r,e)}function bc(r,e){const t=ee({},lc,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function vc(r,e){return ee({},uc,r,e)}function wc(r,e){return ee({},dc,r,e)}function xc(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),o={};return t&&(o.format=t),n&&(o.template=n),i&&(o.resourceType=i),o}function Ks(r,e){const t=ee([],Xs,r,e);if(t.length==2)return js(t)}function _c(r,e){const t=r.getAttribute("crs"),n=ee([],Xs,r,e);if(n.length==2)return{extent:js(n),crs:t}}function Tc(r,e){const t={};return t.format=r.getAttribute("format"),t.href=Wi(r),t}function bi(r,e){const t=G(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function Sc(r,e){return ee({},hc,r,e)}function Ic(r,e){return ee([],cc,r,e)}function Pc(r,e){return ee({},fc,r,e)}var Ne=Uint8Array,Jt=Uint16Array,Ac=Int32Array,Ys=new Ne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qs=new Ne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ec=new Ne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ea=function(r,e){for(var t=new Jt(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Ac(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},ta=ea(Ys,2),ra=ta.b,Mc=ta.r;ra[28]=258,Mc[258]=28;var Cc=ea(Qs,0),kc=Cc.b,vi=new Jt(32768);for(var ne=0;ne<32768;++ne){var vt=(ne&43690)>>1|(ne&21845)<<1;vt=(vt&52428)>>2|(vt&13107)<<2,vt=(vt&61680)>>4|(vt&3855)<<4,vi[ne]=((vt&65280)>>8|(vt&255)<<8)>>1}var vr=function(r,e,t){for(var n=r.length,i=0,o=new Jt(e);i<n;++i)r[i]&&++o[r[i]-1];var s=new Jt(e);for(i=1;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var a;if(t){a=new Jt(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],f=e-r[i],c=s[r[i]-1]++<<f,d=c|(1<<f)-1;c<=d;++c)a[vi[c]>>l]=u}else for(a=new Jt(n),i=0;i<n;++i)r[i]&&(a[i]=vi[s[r[i]-1]++]>>15-r[i]);return a},Fr=new Ne(288);for(var ne=0;ne<144;++ne)Fr[ne]=8;for(var ne=144;ne<256;++ne)Fr[ne]=9;for(var ne=256;ne<280;++ne)Fr[ne]=7;for(var ne=280;ne<288;++ne)Fr[ne]=8;var na=new Ne(32);for(var ne=0;ne<32;++ne)na[ne]=5;var Fc=vr(Fr,9,1),zc=vr(na,5,1),Wn=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},Qe=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Zn=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Oc=function(r){return(r+7)/8|0},Rc=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Ne(r.subarray(e,t))},Lc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Le=function(r,e,t){var n=new Error(e||Lc[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Le),!t)throw n;return n},Zi=function(r,e,t,n){var i=r.length,o=0;if(!i||e.f&&!e.l)return t||new Ne(0);var s=!t,a=s||e.i!=2,l=e.i;s&&(t=new Ne(i*3));var u=function(Et){var Oe=t.length;if(Et>Oe){var Ge=new Ne(Math.max(Oe*2,Et));Ge.set(t),t=Ge}},f=e.f||0,c=e.p||0,d=e.b||0,h=e.l,p=e.d,y=e.m,m=e.n,v=i*8;do{if(!h){f=Qe(r,c,1);var x=Qe(r,c+1,3);if(c+=3,x)if(x==1)h=Fc,p=zc,y=9,m=5;else if(x==2){var z=Qe(r,c,31)+257,w=Qe(r,c+10,15)+4,P=z+Qe(r,c+5,31)+1;c+=14;for(var S=new Ne(P),k=new Ne(19),_=0;_<w;++_)k[Ec[_]]=Qe(r,c+_*3,7);c+=w*3;for(var D=Wn(k),V=(1<<D)-1,te=vr(k,D,1),_=0;_<P;){var I=te[Qe(r,c,V)];c+=I&15;var g=I>>4;if(g<16)S[_++]=g;else{var E=0,U=0;for(g==16?(U=3+Qe(r,c,3),c+=2,E=S[_-1]):g==17?(U=3+Qe(r,c,7),c+=3):g==18&&(U=11+Qe(r,c,127),c+=7);U--;)S[_++]=E}}var Ce=S.subarray(0,z),le=S.subarray(z);y=Wn(Ce),m=Wn(le),h=vr(Ce,y,1),p=vr(le,m,1)}else Le(1);else{var g=Oc(c)+4,O=r[g-4]|r[g-3]<<8,A=g+O;if(A>i){l&&Le(0);break}a&&u(d+O),t.set(r.subarray(g,A),d),e.b=d+=O,e.p=c=A*8,e.f=f;continue}if(c>v){l&&Le(0);break}}a&&u(d+131072);for(var be=(1<<y)-1,ze=(1<<m)-1,Be=c;;Be=c){var E=h[Zn(r,c)&be],pe=E>>4;if(c+=E&15,c>v){l&&Le(0);break}if(E||Le(2),pe<256)t[d++]=pe;else if(pe==256){Be=c,h=null;break}else{var T=pe-254;if(pe>264){var _=pe-257,Je=Ys[_];T=Qe(r,c,(1<<Je)-1)+ra[_],c+=Je}var Xe=p[Zn(r,c)&ze],Ie=Xe>>4;Xe||Le(3),c+=Xe&15;var le=kc[Ie];if(Ie>3){var Je=Qs[Ie];le+=Zn(r,c)&(1<<Je)-1,c+=Je}if(c>v){l&&Le(0);break}a&&u(d+131072);var qe=d+T;if(d<le){var he=o-le,Ke=Math.min(le,qe);for(he+d<0&&Le(3);d<Ke;++d)t[d]=n[he+d]}for(;d<qe;++d)t[d]=t[d-le]}}e.l=h,e.p=Be,e.b=d,e.f=f,h&&(f=1,e.m=y,e.d=p,e.n=m)}while(!f);return d!=t.length&&s?Rc(t,0,d):t.subarray(0,d)},Nc=new Ne(0),jc=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Le(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Uc=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},$c=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Le(6,"invalid zlib data"),(r[1]>>5&1)==1&&Le(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Dc(r,e){return Zi(r,{i:2},e,e)}function Bc(r,e){var t=jc(r);return t+8>r.length&&Le(6,"invalid gzip data"),Zi(r.subarray(t,-8),{i:2},new Ne(Uc(r)),e)}function qc(r,e){return Zi(r.subarray($c(r),-4),{i:2},e,e)}function Gc(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Bc(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Dc(r,e):qc(r,e)}var Vc=typeof TextDecoder<"u"&&new TextDecoder,Wc=0;try{Vc.decode(Nc,{stream:!0}),Wc=1}catch{}var Zc=Object.defineProperty,Hc=Math.pow,Y=(r,e)=>Zc(r,"name",{value:e,configurable:!0}),ge=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(u){i(u)}},s=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});Y((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:Y((o,s)=>{let a=document.createElement("img"),l=new AbortController,u=l.signal;return a.cancel=()=>{l.abort()},t||(r.getHeader().then(f=>{f.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):f.tileType===2?n="image/png":f.tileType===3?n="image/jpeg":f.tileType===4?n="image/webp":f.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(o.z,o.x,o.y,u).then(f=>{if(f){let c=new Blob([f.data],{type:n}),d=window.URL.createObjectURL(c);a.src=d}else a.style.display="none";a.cancel=void 0,s(void 0,a)}).catch(f=>{if(f.name!=="AbortError")throw f}),a},"createTile"),_removeTile:Y(function(o){let s=this._tiles[o];s&&(s.el.cancel&&s.el.cancel(),s.el.width=0,s.el.height=0,s.el.deleted=!0,L.DomUtil.remove(s.el),delete this._tiles[o],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(o)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var Jc=Y(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:Y(()=>n.abort(),"cancel")}},"v3compat"),Xc=class{constructor(e){this.tilev4=Y((t,n)=>ge(this,null,function*(){if(t.type==="json"){let h=t.url.substr(10),p=this.tiles.get(h);if(p||(p=new _r(h),this.tiles.set(h,p)),this.metadata){let m=yield p.getTileJson(t.url);return n.signal.throwIfAborted(),{data:m}}let y=yield p.getHeader();return n.signal.throwIfAborted(),(y.minLon>=y.maxLon||y.minLat>=y.maxLat)&&console.error(`Bounds of PMTiles archive ${y.minLon},${y.minLat},${y.maxLon},${y.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:y.minZoom,maxzoom:y.maxZoom,bounds:[y.minLon,y.minLat,y.maxLon,y.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=t.url.match(i);if(!o)throw new Error("Invalid PMTiles protocol URL");let s=o[1],a=this.tiles.get(s);a||(a=new _r(s),this.tiles.set(s,a));let l=o[2],u=o[3],f=o[4],c=yield a.getHeader(),d=yield a==null?void 0:a.getZxy(+l,+u,+f,n.signal);if(n.signal.throwIfAborted(),d)return{data:new Uint8Array(d.data),cacheControl:d.cacheControl,expires:d.expires};if(c.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Jc(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};Y(Xc,"Protocol");function ia(r,e){return(e>>>0)*4294967296+(r>>>0)}Y(ia,"toNum");function oa(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return ia(r,i);throw new Error("Expected varint not more than 10 bytes")}Y(oa,"readVarintRemainder");function Gt(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,oa(n,r))}Y(Gt,"readVarint");function Hi(r,e,t,n,i){return i===0?n!==0?[r-1-t,r-1-e]:[t,e]:[e,t]}Y(Hi,"rotate");function sa(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<r||t>=1<<r)throw new Error("tile x/y outside zoom level bounds");let n=((1<<r)*(1<<r)-1)/3,i=r-1,[o,s]=[e,t];for(let a=1<<i;a>0;a>>=1){let l=o&a,u=s&a;n+=(3*l^u)*(1<<i),[o,s]=Hi(a,o,s,l,u),i--}return n}Y(sa,"zxyToTileId");function aa(r){let e=3*r+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}Y(aa,"tileIdToZ");function Kc(r){let e=aa(r)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,n=r-t,i=0,o=0,s=1<<e;for(let a=1;a<s;a<<=1){let l=a&n/2,u=a&(n^l);[i,o]=Hi(a,i,o,l,u),n=n/2,i+=l,o+=u}return[e,i,o]}Y(Kc,"tileIdToZxy");var Yc=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(Yc||{});function wn(r,e){return ge(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Gc(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}Y(wn,"defaultDecompress");var Vt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Vt||{});function la(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}Y(la,"tileTypeExt");var Qc=127;function ua(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}Y(ua,"findTile");var ef=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return ge(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};Y(ef,"FileSource");var ca=class{constructor(e,t=new Headers){var n,i;this.url=e,this.customHeaders=t,this.mustReload=!1;let o="";"navigator"in globalThis&&(o=(i=(n=globalThis.navigator)==null?void 0:n.userAgent)!=null?i:"");let s=o.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(o);this.chromeWindowsNoCache=!1,s&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return ge(this,null,function*(){let o,s;n?s=n:(o=new AbortController,s=o.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:s,cache:l,headers:a});if(e===0&&u.status===416){let d=u.headers.get("Content-Range");if(!d||!d.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let h=+d.substr(8);u=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${h-1}`}})}let f=u.headers.get("Etag");if(f!=null&&f.startsWith("W/")&&(f=null),u.status===416||i&&f&&f!==i)throw this.mustReload=!0,new wi(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let c=u.headers.get("Content-Length");if(u.status===200&&(!c||+c>t))throw o&&o.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:f||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};Y(ca,"FetchSource");var tf=ca;function We(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Hc(2,32)+n}Y(We,"getUint64");function fa(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:We(t,8),rootDirectoryLength:We(t,16),jsonMetadataOffset:We(t,24),jsonMetadataLength:We(t,32),leafDirectoryOffset:We(t,40),leafDirectoryLength:We(t,48),tileDataOffset:We(t,56),tileDataLength:We(t,64),numAddressedTiles:We(t,72),numTileEntries:We(t,80),numTileContents:We(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}Y(fa,"bytesToHeader");function Ji(r){let e={buf:new Uint8Array(r),pos:0},t=Gt(e),n=[],i=0;for(let o=0;o<t;o++){let s=Gt(e);n.push({tileId:i+s,offset:0,length:0,runLength:1}),i+=s}for(let o=0;o<t;o++)n[o].runLength=Gt(e);for(let o=0;o<t;o++)n[o].length=Gt(e);for(let o=0;o<t;o++){let s=Gt(e);s===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=s-1}return n}Y(Ji,"deserializeIndex");var da=class extends Error{};Y(da,"EtagMismatch");var wi=da;function Xi(r,e){return ge(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,Qc),i=fa(n,t.etag),o=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),s=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=Ji(yield e(o,i.internalCompression));return[i,[s,a.length,a]]})}Y(Xi,"getHeaderAndRoot");function Ki(r,e,t,n,i){return ge(this,null,function*(){let o=yield r.getBytes(t,n,void 0,i.etag),s=yield e(o.data,i.internalCompression),a=Ji(s);if(a.length===0)throw new Error("Empty directory is invalid");return a})}Y(Ki,"getDirectory");var rf=class{constructor(e=100,t=!0,n=wn){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return ge(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield Xi(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return ge(this,null,function*(){let o=`${e.getKey()}|${i.etag||""}|${t}|${n}`,s=this.cache.get(o);if(s)return s.lastUsed=this.counter++,s.data;let a=yield Ki(e,this.decompress,t,n,i);return this.cache.set(o,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return ge(this,null,function*(){this.cache.delete(e.getKey())})}};Y(rf,"ResolvedValueCache");var pa=class{constructor(e=100,t=!0,n=wn){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return ge(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((o,s)=>{Xi(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),o(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return ge(this,null,function*(){let o=`${e.getKey()}|${i.etag||""}|${t}|${n}`,s=this.cache.get(o);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((l,u)=>{Ki(e,this.decompress,t,n,i).then(f=>{l(f),this.prune()}).catch(f=>{u(f)})});return this.cache.set(o,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return ge(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,o)=>{this.getHeader(e).then(s=>{i(),this.invalidations.delete(t)}).catch(s=>{o(s)})});this.invalidations.set(t,n)})}};Y(pa,"SharedPromiseCache");var nf=pa,ha=class{constructor(e,t,n){typeof e=="string"?this.source=new tf(e):this.source=e,n?this.decompress=n:this.decompress=wn,t?this.cache=t:this.cache=new nf}getHeader(){return ge(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return ge(this,null,function*(){let o=sa(e,t,n),s=yield this.cache.getHeader(this.source);if(e<s.minZoom||e>s.maxZoom)return;let a=s.rootDirectoryOffset,l=s.rootDirectoryLength;for(let u=0;u<=3;u++){let f=yield this.cache.getDirectory(this.source,a,l,s),c=ua(f,o);if(c){if(c.runLength>0){let d=yield this.source.getBytes(s.tileDataOffset+c.offset,c.length,i,s.etag);return{data:yield this.decompress(d.data,s.tileCompression),cacheControl:d.cacheControl,expires:d.expires}}a=s.leafDirectoryOffset+c.offset,l=c.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return ge(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(o){if(o instanceof wi)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw o}})}getMetadataAttempt(){return ge(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return ge(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof wi)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return ge(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=la(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};Y(ha,"PMTiles");var _r=ha,ya=Object.defineProperty,No=Object.getOwnPropertySymbols,of=Object.prototype.hasOwnProperty,sf=Object.prototype.propertyIsEnumerable,jo=(r,e,t)=>e in r?ya(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,en=(r,e)=>{for(var t in e||(e={}))of.call(e,t)&&jo(r,t,e[t]);if(No)for(var t of No(e))sf.call(e,t)&&jo(r,t,e[t]);return r},xn=(r,e)=>ya(r,"name",{value:e,configurable:!0}),af=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(u){i(u)}},s=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),ma=class extends Us{constructor(e){super(en(en({},e),{state:"loading"})),this.loadImage=xn(n=>new Promise((i,o)=>{const s=new Image;s.addEventListener("load",()=>i(s)),s.addEventListener("error",()=>o(new Error("load failed"))),s.src=n}),"loadImage");const t=new _r(e.url);t.getHeader().then(n=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||Ni({extent:$s(i),maxResolution:e.maxResolution,minZoom:n.minZoom,maxZoom:n.maxZoom,tileSize:e.tileSize}),this.setLoader((o,s,a)=>af(this,null,function*(){const l=yield t.getZxy(o,s,a);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),f=yield this.loadImage(u);return URL.revokeObjectURL(u),f})),this.setState("ready")})}};xn(ma,"PMTilesRasterSource");var Uo=ma,ga=class extends kr{constructor(e){super(en(en({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new ji})),this.tileLoadFunction=xn((t,n)=>{const i=t,o=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),s=n.match(o);if(!(s&&s.length>=4))throw Error("Could not parse tile URL");const a=+s[1],l=+s[2],u=+s[3];i.setLoader((f,c,d)=>{this.pmtiles_.getZxy(a,l,u).then(h=>{if(h){const p=i.getFormat();i.setFeatures(p.readFeatures(h.data,{extent:f,featureProjection:d})),i.setState(zt.LOADED)}else i.setFeatures([]),i.setState(zt.EMPTY)}).catch(h=>{i.setFeatures([]),i.setState(zt.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new _r(e.url),this.pmtiles_.getHeader().then(t=>{const n=e.projection||"EPSG:3857",i=e.extent||$s(n);this.tileGrid=e.tileGrid||Ni({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};xn(ga,"PMTilesVectorSource");var lf=ga;class uf extends gl{constructor(e){super(bl.ERROR),this.error=e}}const cf="https://stac-extensions.github.io/label/v1.*/schema.json",ba=new Ht({color:"rgba(0,0,0,0)"});function va(r,e,t="rgba(255,255,255,0.4)",n=5){let i=ba;t&&(i=new Ht({color:t}));const o=new yr({color:r,width:e});return new kt({image:new Ds({fill:i,stroke:o,radius:n}),fill:i,stroke:o})}const ff=va("#3399CC",3),$o=va("#ff9933",2,null);function df(r,e){const t={url:r.getAbsoluteUrl()};let n=r,i=r.getBands();i.length===1&&(n=i[0],i=[]);const{minimum:o,maximum:s}=n.getMinMaxValues();if(typeof o=="number"&&(t.min=o),typeof s=="number"&&(t.max=s),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:u,maximum:f}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof f=="number"&&(typeof t.max>"u"||f>t.max)&&(t.max=f)}const a=n.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const u of i){const f=u.getNoDataValues();if(f.length>0){if(typeof l>"u")l=f[0];else if(l!==f[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=r.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function pf(r){try{const{fromProjectionCode:e,fromEPSGCode:t}=await vl(async()=>{const{fromProjectionCode:n,fromEPSGCode:i}=await import("./proj4.D6rA-yPt.js");return{fromProjectionCode:n,fromEPSGCode:i}},__vite__mapDeps([0,1,2]));return typeof e=="function"?await e(r):await t(r)}catch{return null}}async function Do(r,e=void 0){return void 0||e}function Bo(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(ba),t}function hf(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}function qo(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"}function yf(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function mf(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=kl;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const Go="STATISTICS_MAXIMUM",Vo="STATISTICS_MINIMUM",Hn=256;let Jn;function gf(){return Jn||(Jn=new Cl),Jn}function bf(r){try{return r.getBoundingBox(!0)}catch{return[0,0,r.getWidth(),r.getHeight()]}}function vf(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function wf(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}async function Wo(r,e,t,n){const i=r[e];if(i&&i!==32767){const o="EPSG:"+i;let s=lt(o);if(!s&&n&&(s=await pf(o)),!s){const a=Fl(r[t]);a&&(s=new zl({code:o,units:a}))}return s||null}}async function xf(r,e){const t=r.geoKeys;if(!t)return null;const n=await Wo(t,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",e);return n||await Wo(t,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",e)}function _f(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function Tf(r,e){let t;return r.blob?t=Al(r.blob):r.overviews?t=El(r.url,r.overviews,e):t=Ml(r.url,e),t.then(_f)}function mr(r,e,t,n,i){if(Array.isArray(r)){const o=r.length;if(!Array.isArray(e)||o!=e.length){const s=new Error(n);throw i(s),s}for(let s=0;s<o;++s)mr(r[s],e[s],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function Sf(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function If(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class wa extends Us{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(o=>o.url).join(","));const n=this,i=new Array(t);for(let o=0;o<t;++o)i[o]=Tf(this.sourceInfo_[o],this.sourceOptions_);Promise.all(i).then(function(o){return n.configure_(o)}).catch(function(o){Co(o),n.error_=o,n.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],o=await xf(i,this.loadMissingProjection_);if(o){this.projection=o;break}}}determineTransformMatrix(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const o=t[n].fileDirectory.ModelTransformation;if(o){const[s,a,l,u,f,c,d,h]=o,p=ko(ko([1/Math.sqrt(s*s+f*f),0,0,-1/Math.sqrt(a*a+c*c),u,h],[s,f,a,c,0,0]),[1,0,0,1,-u,-h]);this.transformMatrix=p,this.addAlpha_=!0;break}}}async configure_(e){let t,n,i,o,s;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let f=0;const c=e.length;for(let m=0;m<c;++m){const v=[],x=[];e[m].forEach(S=>{yf(S)?x.push(S):v.push(S)});const g=v.length;if(x.length>0&&x.length!==g)throw new Error(`Expected one mask per image found ${x.length} masks and ${g} images`);let O,A;const z=new Array(g),w=new Array(g),P=new Array(g);l[m]=new Array(g),u[m]=new Array(g);for(let S=0;S<g;++S){const k=v[S],_=k.getGDALNoData();u[m][S]=k.getGDALMetadata(0),l[m][S]=_;const D=this.sourceInfo_[m].bands;a[m]=D?D.length:k.getSamplesPerPixel();const V=g-(S+1);O||(O=bf(k)),A||(A=vf(k));const te=wf(k,v[0]);P[V]=te[0];const I=[k.getTileWidth(),k.getTileHeight()];I[0]!==I[1]&&I[1]<Hn&&(I[0]=Hn,I[1]=Hn),z[V]=I;const E=te[0]/Math.abs(te[1]);w[V]=[I[0],I[1]/E]}if(t?Il(t,O,t):t=O,!n)n=A;else{const S=`Origin mismatch for source ${m}, got [${A}] but expected [${n}]`;mr(n,A,0,S,this.viewRejector)}if(!s)s=P,this.resolutionFactors_[m]=1;else{s.length-f>P.length&&(f=s.length-P.length);const S=s[s.length-1]/P[P.length-1];this.resolutionFactors_[m]=S;const k=P.map(D=>D*=S),_=`Resolution mismatch for source ${m}, got [${k}] but expected [${s}]`;mr(s.slice(f,s.length),k,.02,_,this.viewRejector)}i?mr(i.slice(f,i.length),w,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=w,o?mr(o.slice(f,o.length),z,0,`Tile size mismatch for source ${m}`,this.viewRejector):o=z,this.sourceImagery_[m]=v.reverse(),this.sourceMasks_[m]=x.reverse()}for(let m=0,v=this.sourceImagery_.length;m<v;++m){const x=this.sourceImagery_[m];for(;x.length<s.length;)x.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let m=0;m<c;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const v=l[m],x=this.sourceInfo_[m].bands;if(x){for(let g=0;g<x.length;++g)if(v[x[g]-1]!==null){this.addAlpha_=!0;break e}continue}for(let g=0;g<v.length;++g)if(v[g]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let m=0;m<c;++m)d+=a[m];this.bandCount=d;const h=new Bs({extent:t,minZoom:f,origin:n,resolutions:s,tileSizes:i});this.tileGrid=h,this.setTileSizes(o),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;s.length===2?s=[s[0],s[1],s[1]/2]:s.length===1&&(s=[s[0]*2,s[0],s[0]/2]);let y=t;if(this.transformMatrix){const m=wl(xl(),this.transformMatrix.slice()),v=Ol(x=>Rl(m,x));y=_l(t,v)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:s,center:Sl(Ui(y),this.projection),extent:Tl(y,this.projection),zoom:p})}loadTile_(e,t,n,i){const o=this.getTileSize(e),s=this.sourceImagery_.length,a=new Array(s*2),l=this.nodataValues_,u=this.sourceInfo_,f=gf();for(let c=0;c<s;++c){const d=u[c],h=this.resolutionFactors_[c],p=[Math.round(t*(o[0]*h)),Math.round(n*(o[1]*h)),Math.round((t+1)*(o[0]*h)),Math.round((n+1)*(o[1]*h))],y=this.sourceImagery_[c][e];let m;d.bands&&(m=d.bands.map(function(A){return A-1}));let v;"nodata"in d&&d.nodata!==null?v=d.nodata:m?v=m.map(function(A){return l[c][A]}):v=l[c];const x={window:p,width:o[0],height:o[1],samples:m,fillValue:v,pool:f,interleave:!1,signal:i.signal};mf(this.convertToRGB_,y)?a[c]=y.readRGB(x):a[c]=y.readRasters(x);const g=s+c,O=this.sourceMasks_[c][e];if(!O){a[g]=Promise.resolve(null);continue}a[g]=O.readRasters({window:p,width:o[0],height:o[1],samples:[0],pool:f,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,o)).catch(function(c){throw Co(c),c})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,o=this.sourceImagery_.length,s=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,f=this.addAlpha_,c=e[0]*e[1],d=c*s;let h;u?h=new Uint8Array(d):h=new Float32Array(d);let p=0;for(let y=0;y<c;++y){let m=f;for(let v=0;v<o;++v){const x=i[v];let g=x.min,O=x.max,A,z;if(u){const w=n[v][0];g===void 0&&(w&&Vo in w?g=parseFloat(w[Vo]):g=Sf(t[v][0])),O===void 0&&(w&&Go in w?O=parseFloat(w[Go]):O=If(t[v][0])),A=255/(O-g),z=-g*A}for(let w=0;w<a[v];++w){const P=t[v][w][y];let S;if(u?S=Pl(A*P+z,0,255):S=P,!f)h[p]=S;else{let k=x.nodata;if(k===void 0){let D;x.bands?D=x.bands[w]-1:D=w,k=l[v][D]}const _=isNaN(k);(!_&&P!==k||_&&!isNaN(P))&&(m=!1,h[p]=S)}p++}if(!m){const w=o+v,P=t[w];P&&!P[0][y]&&(m=!0)}}f&&(m||(h[p]=255),p++)}return h}}wa.prototype.getView;class re{constructor(e){this.name=e}toString(){return this.name}}re.GeoTIFF=new re("GeoTIFF");re.ImageStatic=new re("ImageStatic");re.PMTilesRaster=new re("PMTilesRaster");re.PMTilesVector=new re("PMTilesVector");re.TileJSON=new re("TileJSON");re.TileWMS=new re("TileWMS");re.WMTS=new re("WMTS");re.XYZ=new re("XYZ");class xa extends qs{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||ff,this.collectionStyle_=e.collectionStyle||$o,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(n=>this.configure_(n,e.url,e.children,e.assets,e.bands)).catch(n=>this.handleError_(n))}async fetch_(e,t="json"){const n=await fetch(e);if(!n.ok)throw new Error(`Unexpected response from ${e}: ${n.status}`);return t==="json"?await n.json():t==="text"?await n.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const n=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!n||Ll(n)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new uf(e))}configure_(e,t=null,n=null,i=null,o=[]){let s;e instanceof Ur||e instanceof fr?s=e:(s=$r(e,!this.disableMigration_),t&&t.includes("://")&&s.setAbsoluteUrl(t)),this.set("stac",s),this.bands_=o,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Bo(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=f=>this.handleError_(f),u=[];n&&u.push(this.setChildren(n,null,!1).catch(l)),i&&u.push(this.setAssets(i,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const n=e.map(i=>{const o={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},s=new xa(Object.assign(o,t));return s.on("sourceready",()=>{s.map_&&this.setMap_(s.map_)}),this.addLayer_(s,null),s});return await Promise.all(n)}async addPreviewImage_(e){const t=await Do(e,"EPSG:4326"),n=e.getContext().getBoundingBoxes();if(n.length!==1)return;const i=n[0];let o={url:e.getAbsoluteUrl(),projection:t,imageExtent:Fo(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(o=await this.getSourceOptions_(re.ImageStatic,o,e));const s=new $i({source:new Nl(o)});return this.addLayer_(s,e),s}async addLayerForLink(e){const t=hf(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(s,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(s,a,e)),a),o=[];switch(e.rel){case"pmtiles":const a=await new _r(n.url).getHeader();let l;switch(a.tileType){case Vt.Mvt:l=new lf(await i(re.PMTilesVector,n));break;case Vt.Avif:case Vt.Jpeg:case Vt.Png:case Vt.Webp:l=new Uo(await i(re.PMTilesRaster,n));break;default:return}o.push(l);break;case"tilejson":o.push(new Di(await i(re.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const c in e["wms:layers"]){const d=e["wms:layers"][c]||"";let h="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][c]=="string"&&(h=e["wms:styles"][c]);const p=Object.assign({LAYERS:d,STYLES:h},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(p.FORMAT=e.type);const y=await i(re.TileWMS,Object.assign({},n,{params:p}));o.push(new $l(y))}break;case"wmts":const u=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!u)return;let f=[];Array.isArray(e["wmts:layer"])?f=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(f=[e["wmts:layer"]]);for(const c of f){let d=Object.assign({},n,{layer:c,requestEncoding:e["wmts:encoding"]==="rest"?"REST":"KVP"});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await i(re.WMTS,d);const h=jl(u,d);if(h!==null){if(typeof e.uriTemplate=="string"){let p=e.uriTemplate;const y=Vn(e.variables)?e.variables:{};for(const m in y){const v=y[m];let x;if(qo(v.const)?x=v.const:qo(v.default)?x=v.default:Array.isArray(v.enum)&&v.enum.length>0&&(x=v.enum[0]),typeof x<"u")p=p.replaceAll(`{${m}}`,String(x));else continue}delete h.urls,h.url=p}o.push(new Ul(h))}}break;case"xyz":o.push(new zo(await i(re.XYZ,n)));break;default:return}return o.map(s=>{let a;return s instanceof kr?a=new Xt({source:s,declutter:!0}):s instanceof Uo?a=new Ro({source:s}):a=new fi({source:s}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[df(e,this.bands_)],convertToRGB:"auto",loadMissingProjection:!0};const i=await Do();i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(re.GeoTIFF,n,e));const o=new wa(n),s=new Promise((a,l)=>{o.on("error",l),o.on("change",()=>{o.getState()==="error"?l(o.getError()):a()})});try{await s;const a=new Ro({source:o});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let n={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(n=await this.getSourceOptions_(re.XYZ,n,e));const i=new fi({source:new zo(n)});return this.addLayer_(i,e),i}addLayer_(e,t=null,n=0){t&&e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=nu(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=this.createGeoJsonLayer_(e,Bo(this.boundsStyle_,this),this.displayFootprint_);return n.set("bounds",!0),n.on("change",()=>this.setMap_(n.getMapInternal())),this.addLayer_(n,t,1),n}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),n=this.createGeoJsonLayer_(t);return this.addLayer_(n,e),n}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,n=!0){const i=new yi,o=new br({format:i,loader:(s,a,l)=>{e=iu(e);const u=i.readFeatures(e,{featureProjection:l});o.addFeatures(u)}});return t||(t=$o),new bn({source:o,style:t,visible:n})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Yr))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),n;t.length>1&&(n=t.find(o=>o.roles.includes("labels-vector"))),n||(n=e.getAsset("vector_labels")),n||(t=e.getAssets().filter(o=>o.type===Lo&&!o.roles),t.length===1&&(n=t[0]));const i=e.getLinksWithRels(["source"]);if(n&&i.length>0){const o=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return $r(l)}catch(l){return this.handleError_(l),null}}),s=(await Promise.all(o)).filter(a=>a instanceof fr);await this.addChildren_(s,{displayFootprint:!1})}try{await this.addGeoJson_(n)}catch(o){this.handleError_(o)}}async updateLayers(e=!0){const t=this.getLayers();for(let o=t.getLength()-1;o>=0;o--){const s=t.item(o);s.get("stac")&&!s.get("bounds")&&t.removeAt(o)}const n=this.getData();if(Array.isArray(this.displayWebMapLink_)){const o=this.getWebMapLinks().map(async s=>await this.addLayerForLink(s));await Promise.all(o)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const o=i.map(async s=>{if(s){if(s.type===Lo)return await this.addGeoJson_(s);if(s.isGeoTIFF())return await this.addGeoTiff_(s);if(s.canBrowserDisplayImage())return await this.addPreviewImage_(s)}});await Promise.all(o)}if(this.hasOnlyBounds()){if(n instanceof qi)await this.addChildren_(n.getAll(),this.childrenOptions_);else if(n instanceof fr){if(n.isItem()&&n.supportsExtension(cf)&&n.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const o=this.getWebMapLinks();if(o.length>0)await this.addLayerForLink(o[0]);else{const s=n.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(s&&this.displayOverview_&&(a=await this.addGeoTiff_(s)),this.displayPreview_&&(!s||!a)){const l=n.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof Ur)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let n=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?n=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const o=n.find(s=>s.id===i);return o||null}return i}).filter(i=>!!i):n.sort((i,o)=>{const s=t.indexOf(i.rel),a=t.indexOf(o.rel);return s-a}),n}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const n=this.getData();this.assets_=e.map(i=>n instanceof fr&&typeof i=="string"?n.getAsset(i):i instanceof Ur?i:new Ur(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,n=!0){e instanceof Zs?this.children_=e.getAll():e instanceof Ws?this.children_=e.getAll():Vn(e)&&e.type==="FeatureCollection"?this.children_=$r(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof fr?i:$r(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&Vn(t)&&(this.childrenOptions_=t),n&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const n=this.getData();n&&(t=n.getBoundingBox());const i=this.getChildren();if(i){const o=i.map(s=>s.getBoundingBox());t=Bi(o)}if(t)return Fo(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const n=t.getMetadata("attribution");n&&n.push(n)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const n=new URL(e);t!=="rest"&&(n.searchParams.set("service","wmts"),n.searchParams.set("request","GetCapabilities"));const i=await this.fetch_(n.toString(),"text");return new oc().read(i)}catch{return null}}}var Pf=8,Af={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},Ef={"*":{type:"source"}},Mf=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],Cf={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},kf={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Ff={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},zf={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},Of={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Rf={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Lf={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Nf=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],jf={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Uf={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$f={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Df={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Bf={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},qf={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Gf={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Vf={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Wf={type:"array",value:"*"},Zf={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Hf={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},Jf={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},Xf={type:"array",value:"*",minimum:1},Kf={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Yf={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Qf={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},ed={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},td=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],rd={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},nd={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},id={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},od={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},sd={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},ad={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},ld={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},ud={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},cd={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},fd={"*":{type:"string"}},dd={$version:Pf,$root:Af,sources:Ef,source:Mf,source_vector:Cf,source_raster:kf,source_raster_dem:Ff,source_geojson:zf,source_video:Of,source_image:Rf,layer:Lf,layout:Nf,layout_background:jf,layout_fill:Uf,layout_circle:$f,layout_heatmap:Df,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Bf,layout_symbol:qf,layout_raster:Gf,layout_hillshade:Vf,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:Wf,filter_operator:Zf,geometry_type:Hf,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:Jf,expression:Xf,light:Kf,sky:Yf,terrain:Qf,projection:ed,paint:td,paint_fill:rd,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:nd,paint_circle:id,paint_heatmap:od,paint_symbol:sd,paint_raster:ad,paint_hillshade:ld,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:ud,transition:cd,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:fd};const pd=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hd(r,e){const t={};for(const n in r)n!=="ref"&&(t[n]=r[n]);return pd.forEach(n=>{n in e&&(t[n]=e[n])}),t}function _a(r){r=r.slice();const e=Object.create(null);for(let t=0;t<r.length;t++)e[r[t].id]=r[t];for(let t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=hd(r[t],e[r[t].ref]));return r}class at extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Yi{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Yi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const _n={kind:"null"},b={kind:"number"},j={kind:"string"},N={kind:"boolean"},ct={kind:"color"},Tn={kind:"projectionDefinition"},Rt={kind:"object"},R={kind:"value"},yd={kind:"error"},Sn={kind:"collator"},In={kind:"formatted"},Pn={kind:"padding"},Tr={kind:"colorArray"},An={kind:"numberArray"},zr={kind:"resolvedImage"},En={kind:"variableAnchorOffsetCollection"};function je(r,e){return{kind:"array",itemType:r,N:e}}function oe(r){if(r.kind==="array"){const e=oe(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}else return r.kind}const md=[_n,b,j,N,ct,Tn,In,Rt,je(R),Pn,An,Tr,zr,En];function Sr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Sr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of md)if(!Sr(t,e))return null}}return`Expected ${oe(r)} but found ${oe(e)} instead.`}function Qi(r,e){return e.some(t=>t.kind===r.kind)}function Lt(r,e){return e.some(t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r)}function wt(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Ta=.96422,Sa=1,Ia=.82521,Pa=4/29,Kt=6/29,Aa=3*Kt*Kt,gd=Kt*Kt*Kt,bd=Math.PI/180,vd=180/Math.PI;function Ea(r){return r=r%360,r<0&&(r+=360),r}function Ma([r,e,t,n]){r=Xn(r),e=Xn(e),t=Xn(t);let i,o;const s=Kn((.2225045*r+.7168786*e+.0606169*t)/Sa);r===e&&e===t?i=o=s:(i=Kn((.4360747*r+.3850649*e+.1430804*t)/Ta),o=Kn((.0139322*r+.0971045*e+.7141733*t)/Ia));const a=116*s-16;return[a<0?0:a,500*(i-s),200*(s-o),n]}function Xn(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Kn(r){return r>gd?Math.pow(r,1/3):r/Aa+Pa}function Ca([r,e,t,n]){let i=(r+16)/116,o=isNaN(e)?i:i+e/500,s=isNaN(t)?i:i-t/200;return i=Sa*Qn(i),o=Ta*Qn(o),s=Ia*Qn(s),[Yn(3.1338561*o-1.6168667*i-.4906146*s),Yn(-.9787684*o+1.9161415*i+.033454*s),Yn(.0719453*o-.2289914*i+1.4052427*s),n]}function Yn(r){return r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055,r<0?0:r>1?1:r}function Qn(r){return r>Kt?r*r*r:Aa*(r-Pa)}function wd(r){const[e,t,n,i]=Ma(r),o=Math.sqrt(t*t+n*n);return[Math.round(o*1e4)?Ea(Math.atan2(n,t)*vd):NaN,o,e,i]}function xd([r,e,t,n]){return r=isNaN(r)?0:r*bd,Ca([t,Math.cos(r)*e,Math.sin(r)*e,n])}function _d([r,e,t,n]){r=Ea(r),e/=100,t/=100;function i(o){const s=(o+r/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(s-3,9-s,1))}return[i(0),i(8),i(4),n]}const Td=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function ka(r,e){return Td(r,e)?r[e]:void 0}function Sd(r){if(r=r.toLowerCase().trim(),r==="transparent")return[0,0,0,0];const e=ka(Id,r);if(e){const[i,o,s]=e;return[i/255,o/255,s/255,1]}if(r.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(r)){const o=r.length<6?1:2;let s=1;return[Br(r.slice(s,s+=o)),Br(r.slice(s,s+=o)),Br(r.slice(s,s+=o)),Br(r.slice(s,s+o)||"ff")]}if(r.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,o=r.match(i);if(o){const[s,a,l,u,f,c,d,h,p,y,m,v]=o,x=[u||" ",d||" ",y].join("");if(x==="  "||x==="  /"||x===",,"||x===",,,"){const g=[l,c,p].join(""),O=g==="%%%"?100:g===""?255:0;if(O){const A=[Wt(+a/O,0,1),Wt(+f/O,0,1),Wt(+h/O,0,1),m?Zo(+m,v):1];if(Ho(A))return A}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=r.match(t);if(n){const[i,o,s,a,l,u,f,c,d]=n,h=[s||" ",l||" ",f].join("");if(h==="  "||h==="  /"||h===",,"||h===",,,"){const p=[+o,Wt(+a,0,100),Wt(+u,0,100),c?Zo(+c,d):1];if(Ho(p))return _d(p)}}}function Br(r){return parseInt(r.padEnd(2,r),16)/255}function Zo(r,e){return Wt(e?r/100:r,0,1)}function Wt(r,e,t){return Math.min(Math.max(e,r),t)}function Ho(r){return!r.some(Number.isNaN)}const Id={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Nt(r,e,t){return r+t*(e-r)}function Ir(r,e,t){return r.map((n,i)=>Nt(n,e[i],t))}class J{constructor(e,t,n,i=1,o=!0){this.r=e,this.g=t,this.b=n,this.a=i,o||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof J)return e;if(typeof e!="string")return;const t=Sd(e);if(t)return new J(...t,!1)}get rgb(){const{r:e,g:t,b:n,a:i}=this,o=i||1/0;return this.overwriteGetter("rgb",[e/o,t/o,n/o,i])}get hcl(){return this.overwriteGetter("hcl",wd(this.rgb))}get lab(){return this.overwriteGetter("lab",Ma(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map(o=>Math.round(o*255)).join(",")},${i})`}static interpolate(e,t,n,i="rgb"){switch(i){case"rgb":{const[o,s,a,l]=Ir(e.rgb,t.rgb,n);return new J(o,s,a,l,!1)}case"hcl":{const[o,s,a,l]=e.hcl,[u,f,c,d]=t.hcl;let h,p;if(!isNaN(o)&&!isNaN(u)){let g=u-o;u>o&&g>180?g-=360:u<o&&o-u>180&&(g+=360),h=o+n*g}else isNaN(o)?isNaN(u)?h=NaN:(h=u,(a===1||a===0)&&(p=f)):(h=o,(c===1||c===0)&&(p=s));const[y,m,v,x]=xd([h,p??Nt(s,f,n),Nt(a,c,n),Nt(l,d,n)]);return new J(y,m,v,x,!1)}case"lab":{const[o,s,a,l]=Ca(Ir(e.lab,t.lab,n));return new J(o,s,a,l,!1)}}}}J.black=new J(0,0,0,1);J.white=new J(1,1,1,1);J.transparent=new J(0,0,0,0);J.red=new J(1,0,0,1);class eo{constructor(e,t,n){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Pd=["bottom","center","top"];class xi{constructor(e,t,n,i,o,s){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=o,this.verticalAlign=s}}class yt{constructor(e){this.sections=e}static fromString(e){return new yt([new xi(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof yt?e:yt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class rt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rt)return e;if(typeof e=="number")return new rt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new rt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new rt(Ir(e.values,t.values,n))}}class nt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof nt)return e;if(typeof e=="number")return new nt([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new nt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new nt(Ir(e.values,t.values,n))}}class $e{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $e)return e;if(typeof e=="string"){const n=J.parse(e);return n?new $e([n]):void 0}if(!Array.isArray(e))return;const t=[];for(const n of e){if(typeof n!="string")return;const i=J.parse(n);if(!i)return;t.push(i)}return new $e(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n,i="rgb"){const o=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let s=0;s<e.values.length;s++)o.push(J.interpolate(e.values[s],t.values[s],n,i));return new $e(o)}}class ae extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ad=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ft{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ft)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if(typeof n!="string"||!Ad.has(n)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new ft(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const i=e.values,o=t.values;if(i.length!==o.length)throw new ae(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const s=[];for(let a=0;a<i.length;a+=2){if(i[a]!==o[a])throw new ae(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${o[a]}`);s.push(i[a]);const[l,u]=i[a+1],[f,c]=o[a+1];s.push([Nt(l,f,n),Nt(u,c,n)])}return new ft(s)}}class At{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new At({name:e,available:!1}):null}}class et{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new et(e,t,n)}static parse(e){if(e instanceof et)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new et(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new et(e.from,e.to,e.transition);if(typeof e=="string")return new et(e,e,1)}}function Fa(r,e,t,n){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pr(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof et||r instanceof J||r instanceof eo||r instanceof yt||r instanceof rt||r instanceof nt||r instanceof $e||r instanceof ft||r instanceof At)return!0;if(Array.isArray(r)){for(const e of r)if(!Pr(e))return!1;return!0}else if(typeof r=="object"){for(const e in r)if(!Pr(r[e]))return!1;return!0}else return!1}function fe(r){if(r===null)return _n;if(typeof r=="string")return j;if(typeof r=="boolean")return N;if(typeof r=="number")return b;if(r instanceof J)return ct;if(r instanceof et)return Tn;if(r instanceof eo)return Sn;if(r instanceof yt)return In;if(r instanceof rt)return Pn;if(r instanceof nt)return An;if(r instanceof $e)return Tr;if(r instanceof ft)return En;if(r instanceof At)return zr;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=fe(n);if(!t)t=i;else{if(t===i)continue;t=R;break}}return je(t||R,e)}else return Rt}function wr(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof J||r instanceof et||r instanceof yt||r instanceof rt||r instanceof nt||r instanceof $e||r instanceof ft||r instanceof At?r.toString():JSON.stringify(r)}class er{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Pr(e[1]))return t.error("invalid value");const n=e[1];let i=fe(n);const o=t.expectedType;return i.kind==="array"&&i.N===0&&o&&o.kind==="array"&&(typeof o.N!="number"||o.N===0)&&(i=o),new er(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const qr={string:j,number:b,boolean:N,object:Rt};class tt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=1,i;const o=e[0];if(o==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in qr)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=qr[u],n++}else a=R;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],n++}i=je(a,l)}else{if(!qr[o])throw new Error(`Types doesn't contain name = ${o}`);i=qr[o]}const s=[];for(;n<e.length;n++){const a=t.parse(e[n],n,R);if(!a)return null;s.push(a)}return new tt(i,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(Sr(this.type,fe(n))){if(t===this.args.length-1)throw new ae(`Expected value to be of type ${oe(this.type)}, but found ${oe(fe(n))} instead.`)}else return n}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Jo={"to-boolean":N,"to-color":ct,"to-number":b,"to-string":j};class It{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Jo[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Jo[n],o=[];for(let s=1;s<e.length;s++){const a=t.parse(e[s],s,R);if(!a)return null;o.push(a)}return new It(i,o)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof J)return t;if(typeof t=="string"){const o=e.parseColor(t);if(o)return o}else if(Array.isArray(t)&&(t.length<3||t.length>4?n=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:n=Fa(t[0],t[1],t[2],t[3]),!n))return new J(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ae(n||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=rt.parse(t);if(i)return i}throw new ae(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=nt.parse(t);if(i)return i}throw new ae(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=$e.parse(t);if(i)return i}throw new ae(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=ft.parse(t);if(i)return i}throw new ae(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new ae(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return yt.fromString(wr(this.args[0].evaluate(e)));case"resolvedImage":return At.fromString(wr(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return wr(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ed=["Unknown","Point","LineString","Polygon"];class za{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ed[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=J.parse(e),this._parseColorCache.set(e,t)),t}}class Mn{constructor(e,t,n=[],i,o=new Yi,s=[]){this.registry=e,this.path=n,this.key=n.map(a=>`[${a}]`).join(""),this.scope=o,this.errors=s,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,o={}){return t?this.concat(t,n,i)._parse(e,o):this._parse(e,o)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function n(i,o,s){return s==="assert"?new tt(o,[i]):s==="coerce"?new It(o,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const o=this.registry[i];if(o){let s=o.parse(e,this);if(!s)return null;if(this.expectedType){const a=this.expectedType,l=s.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")s=n(s,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))s=n(s,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(s instanceof er)&&s.type.kind!=="resolvedImage"&&this._isConstant(s)){const a=new za;try{s=new er(s.type,s.evaluate(a))}catch(l){return this.error(l.message),null}}return s}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i=typeof e=="number"?this.path.concat(e):this.path,o=n?this.scope.concat(n):this.scope;return new Mn(this.registry,this._isConstant,i,t||null,o,this.errors)}error(e,...t){const n=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new at(n,e))}checkSubtype(e,t){const n=Sr(e,t);return n&&this.error(n),n}}class Cn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let o=1;o<e.length-1;o+=2){const s=e[o];if(typeof s!="string")return t.error(`Expected string, but found ${typeof s} instead.`,o);if(/[^a-zA-Z0-9_]/.test(s))return t.error("Variable names must contain only alphanumeric characters or '_'.",o);const a=t.parse(e[o+1],o+1);if(!a)return null;n.push([s,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Cn(n,i):null}outputDefined(){return this.result.outputDefined()}}class kn{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new kn(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class to{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,b),i=t.parse(e[2],2,je(t.expectedType||R));if(!n||!i)return null;const o=i.type;return new to(o.itemType,n,i)}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new ae(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new ae(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new ae(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ro{constructor(e,t){this.type=N,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,R),i=t.parse(e[2],2,R);return!n||!i?null:Qi(n.type,[N,j,b,_n,R])?new ro(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(n.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Lt(t,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${oe(fe(t))} instead.`);if(!Lt(n,["string","array"]))throw new ae(`Expected second argument to be of type array or string, but found ${oe(fe(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class tn{constructor(e,t,n){this.type=b,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,R),i=t.parse(e[2],2,R);if(!n||!i)return null;if(!Qi(n.type,[N,j,b,_n,R]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(n.type)} instead`);if(e.length===4){const o=t.parse(e[3],3,b);return o?new tn(n,i,o):null}else return new tn(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Lt(t,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${oe(fe(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),Lt(n,["string"])){const o=n.indexOf(t,i);return o===-1?-1:[...n.slice(0,o)].length}else{if(Lt(n,["array"]))return n.indexOf(t,i);throw new ae(`Expected second argument to be of type array or string, but found ${oe(fe(n))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class no{constructor(e,t,n,i,o,s){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=o,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const o={},s=[];for(let u=2;u<e.length-1;u+=2){let f=e[u];const c=e[u+1];Array.isArray(f)||(f=[f]);const d=t.concat(u);if(f.length===0)return d.error("Expected at least one branch label.");for(const p of f){if(typeof p!="number"&&typeof p!="string")return d.error("Branch labels must be numbers or strings.");if(typeof p=="number"&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof p=="number"&&Math.floor(p)!==p)return d.error("Numeric branch labels must be integer values.");if(!n)n=fe(p);else if(d.checkSubtype(n,fe(p)))return null;if(typeof o[String(p)]<"u")return d.error("Branch labels must be unique.");o[String(p)]=s.length}const h=t.parse(c,u,i);if(!h)return null;i=i||h.type,s.push(h)}const a=t.parse(e[1],1,R);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(n,a.type)?null:new no(n,i,a,o,s,l)}evaluate(e){const t=this.input.evaluate(e);return(fe(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class io{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const i=[];for(let s=1;s<e.length-1;s+=2){const a=t.parse(e[s],s,N);if(!a)return null;const l=t.parse(e[s+1],s+1,n);if(!l)return null;i.push([a,l]),n=n||l.type}const o=t.parse(e[e.length-1],e.length-1,n);if(!o)return null;if(!n)throw new Error("Can't infer output type");return new io(n,i,o)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class rn{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,R),i=t.parse(e[2],2,b);if(!n||!i)return null;if(!Qi(n.type,[je(R),j,R]))return t.error(`Expected first argument to be of type array or string, but found ${oe(n.type)} instead`);if(e.length===4){const o=t.parse(e[3],3,b);return o?new rn(n.type,n,i,o):null}else return new rn(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),Lt(t,["string"]))return[...t].slice(n,i).join("");if(Lt(t,["array"]))return t.slice(n,i);throw new ae(`Expected first argument to be of type array or string, but found ${oe(fe(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Oa(r,e){const t=r.length-1;let n=0,i=t,o=0,s,a;for(;n<=i;)if(o=Math.floor((n+i)/2),s=r[o],a=r[o+1],s<=e){if(o===t||e<a)return o;n=o+1}else if(s>e)i=o-1;else throw new ae("Input is not a number.");return 0}class Fn{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,o]of n)this.labels.push(i),this.outputs.push(o)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,b);if(!n)return null;const i=[];let o=null;t.expectedType&&t.expectedType.kind!=="value"&&(o=t.expectedType);for(let s=1;s<e.length;s+=2){const a=s===1?-1/0:e[s],l=e[s+1],u=s,f=s+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const c=t.parse(l,f,o);if(!c)return null;o=o||c.type,i.push([a,c])}return new Fn(o,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const o=t.length;if(i>=t[o-1])return n[o-1].evaluate(e);const s=Oa(t,i);return n[s].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Md(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ei,Xo;function Cd(){if(Xo)return ei;Xo=1,ei=r;function r(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var o=this.sampleCurveX(n)-e;if(Math.abs(o)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n=n-o/s}var a=0,l=1;for(n=e,i=0;i<20&&(o=this.sampleCurveX(n),!(Math.abs(o-e)<t));i++)e>o?a=n:l=n,n=(l-a)*.5+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ei}var kd=Cd(),Fd=Md(kd);class dt{constructor(e,t,n,i,o){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[s,a]of o)this.labels.push(s),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let o=0;if(e.name==="exponential")o=ti(t,e.base,n,i);else if(e.name==="linear")o=ti(t,1,n,i);else if(e.name==="cubic-bezier"){const s=e.controlPoints;o=new Fd(s[0],s[1],s[2],s[3]).solve(ti(t,1,n,i))}return o}static parse(e,t){let[n,i,o,...s]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(f=>typeof f!="number"||f<0||f>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(o=t.parse(o,2,b),!o)return null;const a=[];let l=null;(n==="interpolate-hcl"||n==="interpolate-lab")&&t.expectedType!=Tr?l=ct:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<s.length;u+=2){const f=s[u],c=s[u+1],d=u+3,h=u+4;if(typeof f!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(a.length&&a[a.length-1][0]>=f)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const p=t.parse(c,h,l);if(!p)return null;l=l||p.type,a.push([f,p])}return!wt(l,b)&&!wt(l,Tn)&&!wt(l,ct)&&!wt(l,Pn)&&!wt(l,An)&&!wt(l,Tr)&&!wt(l,En)&&!wt(l,je(b))?t.error(`Type ${oe(l)} is not interpolatable.`):new dt(l,n,i,o,a)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const o=t.length;if(i>=t[o-1])return n[o-1].evaluate(e);const s=Oa(t,i),a=t[s],l=t[s+1],u=dt.interpolationFactor(this.interpolation,i,a,l),f=n[s].evaluate(e),c=n[s+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Nt(f,c,u);case"color":return J.interpolate(f,c,u);case"padding":return rt.interpolate(f,c,u);case"colorArray":return $e.interpolate(f,c,u);case"numberArray":return nt.interpolate(f,c,u);case"variableAnchorOffsetCollection":return ft.interpolate(f,c,u);case"array":return Ir(f,c,u);case"projectionDefinition":return et.interpolate(f,c,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return J.interpolate(f,c,u,"hcl");case"colorArray":return $e.interpolate(f,c,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return J.interpolate(f,c,u,"lab");case"colorArray":return $e.interpolate(f,c,u,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ti(r,e,t,n){const i=n-t,o=r-t;return i===0?0:e===1?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}class Ar{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const i=t.expectedType;i&&i.kind!=="value"&&(n=i);const o=[];for(const a of e.slice(1)){const l=t.parse(a,1+o.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,o.push(l)}if(!n)throw new Error("No output type");return i&&o.some(a=>Sr(i,a.type))?new Ar(R,o):new Ar(n,o)}evaluate(e){let t=null,n=0,i;for(const o of this.args)if(n++,t=o.evaluate(e),t&&t instanceof At&&!t.available&&(i||(i=t.name),t=null,n===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Ko(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function zd(r,e,t){return e===t}function Od(r,e,t){return e!==t}function Rd(r,e,t){return e<t}function Ld(r,e,t){return e>t}function Nd(r,e,t){return e<=t}function jd(r,e,t){return e>=t}function Ra(r,e,t,n){return n.compare(e,t)===0}function Ud(r,e,t,n){return!Ra(r,e,t,n)}function $d(r,e,t,n){return n.compare(e,t)<0}function Dd(r,e,t,n){return n.compare(e,t)>0}function Bd(r,e,t,n){return n.compare(e,t)<=0}function qd(r,e,t,n){return n.compare(e,t)>=0}function or(r,e,t){const n=r!=="=="&&r!=="!=";return class La{constructor(o,s,a){this.type=N,this.lhs=o,this.rhs=s,this.collator=a,this.hasUntypedArgument=o.type.kind==="value"||s.type.kind==="value"}static parse(o,s){if(o.length!==3&&o.length!==4)return s.error("Expected two or three arguments.");const a=o[0];let l=s.parse(o[1],1,R);if(!l)return null;if(!Ko(a,l.type))return s.concat(1).error(`"${a}" comparisons are not supported for type '${oe(l.type)}'.`);let u=s.parse(o[2],2,R);if(!u)return null;if(!Ko(a,u.type))return s.concat(2).error(`"${a}" comparisons are not supported for type '${oe(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return s.error(`Cannot compare types '${oe(l.type)}' and '${oe(u.type)}'.`);n&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new tt(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new tt(l.type,[u])));let f=null;if(o.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return s.error("Cannot use collator to compare non-string types.");if(f=s.parse(o[3],3,Sn),!f)return null}return new La(l,u,f)}evaluate(o){const s=this.lhs.evaluate(o),a=this.rhs.evaluate(o);if(n&&this.hasUntypedArgument){const l=fe(s),u=fe(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new ae(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=fe(s),u=fe(a);if(l.kind!=="string"||u.kind!=="string")return e(o,s,a)}return this.collator?t(o,s,a,this.collator.evaluate(o)):e(o,s,a)}eachChild(o){o(this.lhs),o(this.rhs),this.collator&&o(this.collator)}outputDefined(){return!0}}}const Gd=or("==",zd,Ra),Vd=or("!=",Od,Ud),Wd=or("<",Rd,$d),Zd=or(">",Ld,Dd),Hd=or("<=",Nd,Bd),Jd=or(">=",jd,qd);class zn{constructor(e,t,n){this.type=Sn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,N);if(!i)return null;const o=t.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,N);if(!o)return null;let s=null;return n.locale&&(s=t.parse(n.locale,1,j),!s)?null:new zn(i,o,s)}evaluate(e){return new eo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class oo{constructor(e,t,n,i,o){this.type=j,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,b);if(!n)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let o=null;if(i.locale&&(o=t.parse(i.locale,1,j),!o))return null;let s=null;if(i.currency&&(s=t.parse(i.currency,1,j),!s))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,b),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,b),!l)?null:new oo(n,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class so{constructor(e){this.type=In,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const i=[];let o=!1;for(let s=1;s<=e.length-1;++s){const a=e[s];if(o&&typeof a=="object"&&!Array.isArray(a)){o=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,b),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,je(j)),!u))return null;let f=null;if(a["text-color"]&&(f=t.parse(a["text-color"],1,ct),!f))return null;let c=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!Pd.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(c=t.parse(a["vertical-align"],1,j),!c)return null}const d=i[i.length-1];d.scale=l,d.font=u,d.textColor=f,d.verticalAlign=c}else{const l=t.parse(e[s],1,R);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new so(i)}evaluate(e){const t=n=>{const i=n.content.evaluate(e);return fe(i)===zr?new xi("",i,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new xi(wr(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)};return new yt(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class ao{constructor(e){this.type=zr,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,j);return n?new ao(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=At.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class lo{constructor(e){this.type=b,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${oe(n.type)} instead.`):new lo(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new ae(`Expected value to be of type string or array, but found ${oe(fe(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const pt=8192;function Xd(r,e){const t=Kd(r[0]),n=Qd(r[1]),i=Math.pow(2,e.z);return[Math.round(t*i*pt),Math.round(n*i*pt)]}function uo(r,e){const t=Math.pow(2,e.z),n=(r[0]/pt+e.x)/t,i=(r[1]/pt+e.y)/t;return[Yd(n),ep(i)]}function Kd(r){return(180+r)/360}function Yd(r){return r*360-180}function Qd(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ep(r){return 360/Math.PI*Math.atan(Math.exp((180-r*360)*Math.PI/180))-90}function Or(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Er(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function tp(r,e,t){return e[1]>r[1]!=t[1]>r[1]&&r[0]<(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1])+e[0]}function rp(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],o=r[0]-t[0],s=r[1]-t[1];return n*s-o*i===0&&n*o<=0&&i*s<=0}function On(r,e,t,n){const i=[e[0]-r[0],e[1]-r[1]],o=[n[0]-t[0],n[1]-t[1]];return sp(o,i)===0?!1:!!(Yo(r,e,t,n)&&Yo(t,n,r,e))}function np(r,e,t){for(const n of t)for(let i=0;i<n.length-1;++i)if(On(r,e,n[i],n[i+1]))return!0;return!1}function sr(r,e,t=!1){let n=!1;for(const i of e)for(let o=0;o<i.length-1;o++){if(rp(r,i[o],i[o+1]))return t;tp(r,i[o],i[o+1])&&(n=!n)}return n}function ip(r,e){for(const t of e)if(sr(r,t))return!0;return!1}function Na(r,e){for(const t of r)if(!sr(t,e))return!1;for(let t=0;t<r.length-1;++t)if(np(r[t],r[t+1],e))return!1;return!0}function op(r,e){for(const t of e)if(Na(r,t))return!0;return!1}function sp(r,e){return r[0]*e[1]-r[1]*e[0]}function Yo(r,e,t,n){const i=r[0]-t[0],o=r[1]-t[1],s=e[0]-t[0],a=e[1]-t[1],l=n[0]-t[0],u=n[1]-t[1],f=i*u-l*o,c=s*u-l*a;return f>0&&c<0||f<0&&c>0}function co(r,e,t){const n=[];for(let i=0;i<r.length;i++){const o=[];for(let s=0;s<r[i].length;s++){const a=Xd(r[i][s],t);Or(e,a),o.push(a)}n.push(o)}return n}function ja(r,e,t){const n=[];for(let i=0;i<r.length;i++){const o=co(r[i],e,t);n.push(o)}return n}function Ua(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=n*.5;let o=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;o===0&&(o=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=o}Or(e,r)}function ap(r){r[0]=r[1]=1/0,r[2]=r[3]=-1/0}function Qo(r,e,t,n){const i=Math.pow(2,n.z)*pt,o=[n.x*pt,n.y*pt],s=[];for(const a of r)for(const l of a){const u=[l.x+o[0],l.y+o[1]];Ua(u,e,t,i),s.push(u)}return s}function es(r,e,t,n){const i=Math.pow(2,n.z)*pt,o=[n.x*pt,n.y*pt],s=[];for(const a of r){const l=[];for(const u of a){const f=[u.x+o[0],u.y+o[1]];Or(e,f),l.push(f)}s.push(l)}if(e[2]-e[0]<=i/2){ap(e);for(const a of s)for(const l of a)Ua(l,e,t,i)}return s}function lp(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const o=co(e.coordinates,n,i),s=Qo(r.geometry(),t,n,i);if(!Er(t,n))return!1;for(const a of s)if(!sr(a,o))return!1}if(e.type==="MultiPolygon"){const o=ja(e.coordinates,n,i),s=Qo(r.geometry(),t,n,i);if(!Er(t,n))return!1;for(const a of s)if(!ip(a,o))return!1}return!0}function up(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const o=co(e.coordinates,n,i),s=es(r.geometry(),t,n,i);if(!Er(t,n))return!1;for(const a of s)if(!Na(a,o))return!1}if(e.type==="MultiPolygon"){const o=ja(e.coordinates,n,i),s=es(r.geometry(),t,n,i);if(!Er(t,n))return!1;for(const a of s)if(!op(a,o))return!1}return!0}class jt{constructor(e,t){this.type=N,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pr(e[1])){const n=e[1];if(n.type==="FeatureCollection"){const i=[];for(const o of n.features){const{type:s,coordinates:a}=o.geometry;s==="Polygon"&&i.push(a),s==="MultiPolygon"&&i.push(...a)}if(i.length){const o={type:"MultiPolygon",coordinates:i};return new jt(n,o)}}else if(n.type==="Feature"){const i=n.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new jt(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new jt(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return lp(e,this.geometries);if(e.geometryType()==="LineString")return up(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $a{constructor(e=[],t=(n,i)=>n<i?-1:n>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const o=e-1>>1,s=t[o];if(n(i,s)>=0)break;t[e]=s,e=o}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,o=t[e];for(;e<i;){let s=(e<<1)+1;const a=s+1;if(a<this.length&&n(t[a],t[s])<0&&(s=a),n(t[s],o)>=0)break;t[e]=t[s],e=s}t[e]=o}}function cp(r,e){if(r.length<=1)return[r];const n=[];let i,o;for(const s of r){const a=fp(s);a!==0&&(s.area=Math.abs(a),o===void 0&&(o=a<0),o===a<0?(i&&n.push(i),i=[s]):i.push(s))}return i&&n.push(i),n}function fp(r){let e=0;for(let t=0,n=r.length,i=n-1,o,s;t<n;i=t++)o=r[t],s=r[i],e+=(s.x-o.x)*(o.y+s.y);return e}const dp=6378.137,ts=1/298.257223563,rs=ts*(2-ts),ns=Math.PI/180;class fo{constructor(e){const t=ns*dp*1e3,n=Math.cos(e*ns),i=1/(1-rs*(1-n*n)),o=Math.sqrt(i);this.kx=t*o*n,this.ky=t*o*i*(1-rs)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n=1/0,i,o,s,a;for(let l=0;l<e.length-1;l++){let u=e[l][0],f=e[l][1],c=this.wrap(e[l+1][0]-u)*this.kx,d=(e[l+1][1]-f)*this.ky,h=0;(c!==0||d!==0)&&(h=(this.wrap(t[0]-u)*this.kx*c+(t[1]-f)*this.ky*d)/(c*c+d*d),h>1?(u=e[l+1][0],f=e[l+1][1]):h>0&&(u+=c/this.kx*h,f+=d/this.ky*h)),c=this.wrap(t[0]-u)*this.kx,d=(t[1]-f)*this.ky;const p=c*c+d*d;p<n&&(n=p,i=u,o=f,s=l,a=h)}return{point:[i,o],index:s,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const _i=100,Ti=50;function Da(r,e){return e[0]-r[0]}function nn(r){return r[1]-r[0]+1}function mt(r,e){return r[1]>=r[0]&&r[1]<e}function Si(r,e){if(r[0]>r[1])return[null,null];const t=nn(r);if(e){if(t===2)return[r,null];const i=Math.floor(t/2);return[[r[0],r[0]+i],[r[0]+i,r[1]]]}if(t===1)return[r,null];const n=Math.floor(t/2)-1;return[[r[0],r[0]+n],[r[0]+n+1,r[1]]]}function Ii(r,e){if(!mt(e,r.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)Or(t,r[n]);return t}function Pi(r){const e=[1/0,1/0,-1/0,-1/0];for(const t of r)for(const n of t)Or(e,n);return e}function is(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function po(r,e,t){if(!is(r)||!is(e))return NaN;let n=0,i=0;return r[2]<e[0]&&(n=e[0]-r[2]),r[0]>e[2]&&(n=r[0]-e[2]),r[1]>e[3]&&(i=r[1]-e[3]),r[3]<e[1]&&(i=e[1]-r[3]),t.distance([0,0],[n,i])}function Ot(r,e,t){const n=t.pointOnLine(e,r);return t.distance(r,n.point)}function ho(r,e,t,n,i){const o=Math.min(Ot(r,[t,n],i),Ot(e,[t,n],i)),s=Math.min(Ot(t,[r,e],i),Ot(n,[r,e],i));return Math.min(o,s)}function pp(r,e,t,n,i){if(!(mt(e,r.length)&&mt(n,t.length)))return 1/0;let s=1/0;for(let a=e[0];a<e[1];++a){const l=r[a],u=r[a+1];for(let f=n[0];f<n[1];++f){const c=t[f],d=t[f+1];if(On(l,u,c,d))return 0;s=Math.min(s,ho(l,u,c,d,i))}}return s}function hp(r,e,t,n,i){if(!(mt(e,r.length)&&mt(n,t.length)))return NaN;let s=1/0;for(let a=e[0];a<=e[1];++a)for(let l=n[0];l<=n[1];++l)if(s=Math.min(s,i.distance(r[a],t[l])),s===0)return s;return s}function yp(r,e,t){if(sr(r,e,!0))return 0;let n=1/0;for(const i of e){const o=i[0],s=i[i.length-1];if(o!==s&&(n=Math.min(n,Ot(r,[s,o],t)),n===0))return n;const a=t.pointOnLine(i,r);if(n=Math.min(n,t.distance(r,a.point)),n===0)return n}return n}function mp(r,e,t,n){if(!mt(e,r.length))return NaN;for(let o=e[0];o<=e[1];++o)if(sr(r[o],t,!0))return 0;let i=1/0;for(let o=e[0];o<e[1];++o){const s=r[o],a=r[o+1];for(const l of t)for(let u=0,f=l.length,c=f-1;u<f;c=u++){const d=l[c],h=l[u];if(On(s,a,d,h))return 0;i=Math.min(i,ho(s,a,d,h,n))}}return i}function os(r,e){for(const t of r)for(const n of t)if(sr(n,e,!0))return!0;return!1}function gp(r,e,t,n=1/0){const i=Pi(r),o=Pi(e);if(n!==1/0&&po(i,o,t)>=n)return n;if(Er(i,o)){if(os(r,e))return 0}else if(os(e,r))return 0;let s=1/0;for(const a of r)for(let l=0,u=a.length,f=u-1;l<u;f=l++){const c=a[f],d=a[l];for(const h of e)for(let p=0,y=h.length,m=y-1;p<y;m=p++){const v=h[m],x=h[p];if(On(c,d,v,x))return 0;s=Math.min(s,ho(c,d,v,x,t))}}return s}function ss(r,e,t,n,i,o){if(!o)return;const s=po(Ii(n,o),i,t);s<e&&r.push([s,o,[0,0]])}function Gr(r,e,t,n,i,o,s){if(!o||!s)return;const a=po(Ii(n,o),Ii(i,s),t);a<e&&r.push([a,o,s])}function on(r,e,t,n,i=1/0){let o=Math.min(n.distance(r[0],t[0][0]),i);if(o===0)return o;const s=new $a([[0,[0,r.length-1],[0,0]]],Da),a=Pi(t);for(;s.length>0;){const l=s.pop();if(l[0]>=o)continue;const u=l[1],f=e?Ti:_i;if(nn(u)<=f){if(!mt(u,r.length))return NaN;if(e){const c=mp(r,u,t,n);if(isNaN(c)||c===0)return c;o=Math.min(o,c)}else for(let c=u[0];c<=u[1];++c){const d=yp(r[c],t,n);if(o=Math.min(o,d),o===0)return 0}}else{const c=Si(u,e);ss(s,o,n,r,a,c[0]),ss(s,o,n,r,a,c[1])}}return o}function sn(r,e,t,n,i,o=1/0){let s=Math.min(o,i.distance(r[0],t[0]));if(s===0)return s;const a=new $a([[0,[0,r.length-1],[0,t.length-1]]],Da);for(;a.length>0;){const l=a.pop();if(l[0]>=s)continue;const u=l[1],f=l[2],c=e?Ti:_i,d=n?Ti:_i;if(nn(u)<=c&&nn(f)<=d){if(!mt(u,r.length)&&mt(f,t.length))return NaN;let h;if(e&&n)h=pp(r,u,t,f,i),s=Math.min(s,h);else if(e&&!n){const p=r.slice(u[0],u[1]+1);for(let y=f[0];y<=f[1];++y)if(h=Ot(t[y],p,i),s=Math.min(s,h),s===0)return s}else if(!e&&n){const p=t.slice(f[0],f[1]+1);for(let y=u[0];y<=u[1];++y)if(h=Ot(r[y],p,i),s=Math.min(s,h),s===0)return s}else h=hp(r,u,t,f,i),s=Math.min(s,h)}else{const h=Si(u,e),p=Si(f,n);Gr(a,s,i,r,t,h[0],p[0]),Gr(a,s,i,r,t,h[0],p[1]),Gr(a,s,i,r,t,h[1],p[0]),Gr(a,s,i,r,t,h[1],p[1])}}return s}function bp(r,e){const t=r.geometry(),n=t.flat().map(s=>uo([s.x,s.y],r.canonical));if(t.length===0)return NaN;const i=new fo(n[0][1]);let o=1/0;for(const s of e){switch(s.type){case"Point":o=Math.min(o,sn(n,!1,[s.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,sn(n,!1,s.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,on(n,!1,s.coordinates,i,o));break}if(o===0)return o}return o}function vp(r,e){const t=r.geometry(),n=t.flat().map(s=>uo([s.x,s.y],r.canonical));if(t.length===0)return NaN;const i=new fo(n[0][1]);let o=1/0;for(const s of e){switch(s.type){case"Point":o=Math.min(o,sn(n,!0,[s.coordinates],!1,i,o));break;case"LineString":o=Math.min(o,sn(n,!0,s.coordinates,!0,i,o));break;case"Polygon":o=Math.min(o,on(n,!0,s.coordinates,i,o));break}if(o===0)return o}return o}function wp(r,e){const t=r.geometry();if(t.length===0||t[0].length===0)return NaN;const n=cp(t).map(s=>s.map(a=>a.map(l=>uo([l.x,l.y],r.canonical)))),i=new fo(n[0][0][0][1]);let o=1/0;for(const s of e)for(const a of n){switch(s.type){case"Point":o=Math.min(o,on([s.coordinates],!1,a,i,o));break;case"LineString":o=Math.min(o,on(s.coordinates,!0,a,i,o));break;case"Polygon":o=Math.min(o,gp(a,s.coordinates,i,o));break}if(o===0)return o}return o}function ri(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class Ut{constructor(e,t){this.type=b,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pr(e[1])){const n=e[1];if(n.type==="FeatureCollection")return new Ut(n,n.features.map(i=>ri(i.geometry)).flat());if(n.type==="Feature")return new Ut(n,ri(n.geometry));if("type"in n&&"coordinates"in n)return new Ut(n,ri(n))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return bp(e,this.geometries);if(e.geometryType()==="LineString")return vp(e,this.geometries);if(e.geometryType()==="Polygon")return wp(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Rr{constructor(e){this.type=R,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return n==null?t.error("Global state property must be defined."):typeof n!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Rr(n)}evaluate(e){var t;const n=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!n||Object.keys(n).length===0?null:ka(n,this.key)}eachChild(){}outputDefined(){return!1}}const Rn={"==":Gd,"!=":Vd,">":Zd,"<":Wd,">=":Jd,"<=":Hd,array:tt,at:to,boolean:tt,case:io,coalesce:Ar,collator:zn,format:so,image:ao,in:ro,"index-of":tn,interpolate:dt,"interpolate-hcl":dt,"interpolate-lab":dt,length:lo,let:Cn,literal:er,match:no,number:tt,"number-format":oo,object:tt,slice:rn,step:Fn,string:tt,"to-boolean":It,"to-color":It,"to-number":It,"to-string":It,var:kn,within:jt,distance:Ut,"global-state":Rr};class De{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=De.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const o=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=s.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,f]of a){l=new Mn(t.registry,an,t.path,null,t.scope);const c=[];let d=!1;for(let h=1;h<e.length;h++){const p=e[h],y=Array.isArray(u)?u[h-1]:u.type,m=l.parse(p,1+c.length,y);if(!m){d=!0;break}c.push(m)}if(!d){if(Array.isArray(u)&&u.length!==c.length){l.error(`Expected ${u.length} arguments, but found ${c.length} instead.`);continue}for(let h=0;h<c.length;h++){const p=Array.isArray(u)?u[h]:u.type,y=c[h];l.concat(h+1).checkSubtype(p,y.type)}if(l.errors.length===0)return new De(n,o,f,c)}}if(a.length===1)t.errors.push(...l.errors);else{const f=(a.length?a:s).map(([d])=>_p(d)).join(" | "),c=[];for(let d=1;d<e.length;d++){const h=t.parse(e[d],1+c.length);if(!h)return null;c.push(oe(h.type))}t.error(`Expected arguments of type ${f}, but found (${c.join(", ")}) instead.`)}return null}static register(e,t){De.definitions=t;for(const n in t)e[n]=De}}function as(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const o=i?i.evaluate(r):1,s=Fa(e,t,n,o);if(s)throw new ae(s);return new J(e/255,t/255,n/255,o,!1)}function ls(r,e){return r in e}function ni(r,e){const t=e[r];return typeof t>"u"?null:t}function xp(r,e,t,n){for(;t<=n;){const i=t+n>>1;if(e[i]===r)return!0;e[i]>r?n=i-1:t=i+1}return!1}function Mt(r){return{type:r}}De.register(Rn,{error:[yd,[j],(r,[e])=>{throw new ae(e.evaluate(r))}],typeof:[j,[R],(r,[e])=>oe(fe(e.evaluate(r)))],"to-rgba":[je(b,4),[ct],(r,[e])=>{const[t,n,i,o]=e.evaluate(r).rgb;return[t*255,n*255,i*255,o]}],rgb:[ct,[b,b,b],as],rgba:[ct,[b,b,b,b],as],has:{type:N,overloads:[[[j],(r,[e])=>ls(e.evaluate(r),r.properties())],[[j,Rt],(r,[e,t])=>ls(e.evaluate(r),t.evaluate(r))]]},get:{type:R,overloads:[[[j],(r,[e])=>ni(e.evaluate(r),r.properties())],[[j,Rt],(r,[e,t])=>ni(e.evaluate(r),t.evaluate(r))]]},"feature-state":[R,[j],(r,[e])=>ni(e.evaluate(r),r.featureState||{})],properties:[Rt,[],r=>r.properties()],"geometry-type":[j,[],r=>r.geometryType()],id:[R,[],r=>r.id()],zoom:[b,[],r=>r.globals.zoom],"heatmap-density":[b,[],r=>r.globals.heatmapDensity||0],elevation:[b,[],r=>r.globals.elevation||0],"line-progress":[b,[],r=>r.globals.lineProgress||0],accumulated:[R,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[b,Mt(b),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[b,Mt(b),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:b,overloads:[[[b,b],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[b],(r,[e])=>-e.evaluate(r)]]},"/":[b,[b,b],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[b,[b,b],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[b,[],()=>Math.LN2],pi:[b,[],()=>Math.PI],e:[b,[],()=>Math.E],"^":[b,[b,b],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[b,[b],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[b,[b],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[b,[b],(r,[e])=>Math.log(e.evaluate(r))],log2:[b,[b],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[b,[b],(r,[e])=>Math.sin(e.evaluate(r))],cos:[b,[b],(r,[e])=>Math.cos(e.evaluate(r))],tan:[b,[b],(r,[e])=>Math.tan(e.evaluate(r))],asin:[b,[b],(r,[e])=>Math.asin(e.evaluate(r))],acos:[b,[b],(r,[e])=>Math.acos(e.evaluate(r))],atan:[b,[b],(r,[e])=>Math.atan(e.evaluate(r))],min:[b,Mt(b),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[b,Mt(b),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[b,[b],(r,[e])=>Math.abs(e.evaluate(r))],round:[b,[b],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[b,[b],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[b,[b],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[N,[j,R],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[N,[R],(r,[e])=>r.id()===e.value],"filter-type-==":[N,[j],(r,[e])=>r.geometryType()===e.value],"filter-<":[N,[j,R],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[N,[R],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[N,[j,R],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[N,[R],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[N,[j,R],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[N,[R],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[N,[j,R],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[N,[R],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[N,[R],(r,[e])=>e.value in r.properties()],"filter-has-id":[N,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[N,[je(j)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[N,[je(R)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[N,[j,je(R)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[N,[j,je(R)],(r,[e,t])=>xp(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:N,overloads:[[[N,N],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[Mt(N),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:N,overloads:[[[N,N],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[Mt(N),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[N,[N],(r,[e])=>!e.evaluate(r)],"is-supported-script":[N,[j],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return t?t(e.evaluate(r)):!0}],upcase:[j,[j],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[j,[j],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[j,Mt(R),(r,e)=>e.map(t=>wr(t.evaluate(r))).join("")],"resolved-locale":[j,[Sn],(r,[e])=>e.evaluate(r).resolvedLocale()]});function _p(r){return Array.isArray(r)?`(${r.map(oe).join(", ")})`:`(${oe(r.type)}...)`}function an(r){if(r instanceof kn)return an(r.boundExpression);if(r instanceof De&&r.name==="error")return!1;if(r instanceof zn)return!1;if(r instanceof jt)return!1;if(r instanceof Ut)return!1;if(r instanceof Rr)return!1;const e=r instanceof It||r instanceof tt;let t=!0;return r.eachChild(n=>{e?t=t&&an(n):t=t&&n instanceof er}),t?yo(r)&&go(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function yo(r){if(r instanceof De){if(r.name==="get"&&r.args.length===1)return!1;if(r.name==="feature-state")return!1;if(r.name==="has"&&r.args.length===1)return!1;if(r.name==="properties"||r.name==="geometry-type"||r.name==="id")return!1;if(/^filter-/.test(r.name))return!1}if(r instanceof jt||r instanceof Ut)return!1;let e=!0;return r.eachChild(t=>{e&&!yo(t)&&(e=!1)}),e}function mo(r){if(r instanceof De&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(t=>{e&&!mo(t)&&(e=!1)}),e}function go(r,e){if(r instanceof De&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(n=>{t&&!go(n,e)&&(t=!1)}),t}function Ai(r){return{result:"success",value:r}}function Zt(r){return{result:"error",value:r}}function Tp(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Sp(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Ip(r){return!!r.expression&&r.expression.interpolated}function Ba(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&fe(r)===Rt}class Pp{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new za,this._defaultValue=t?Cp(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=s||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ae(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function Ap(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Rn}function qa(r,e){const t=new Mn(Rn,an,[],e?Mp(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Ai(new Pp(n,e)):Zt(t.errors)}class us{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!mo(t.expression),this.globalStateRefs=Ln(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,o,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,o,s)}evaluate(e,t,n,i,o,s){return this._styleExpression.evaluate(e,t,n,i,o,s)}}class cs{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!mo(t.expression),this.globalStateRefs=Ln(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,o,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,o,s)}evaluate(e,t,n,i,o,s){return this._styleExpression.evaluate(e,t,n,i,o,s)}interpolationFactor(e,t,n){return this.interpolationType?dt.interpolationFactor(this.interpolationType,e,t,n):0}}function Ep(r,e){const t=qa(r,e);if(t.result==="error")return t;const n=t.value.expression,i=yo(n);if(!i&&!Tp(e))return Zt([new at("","data expressions not supported")]);const o=go(n,["zoom"]);if(!o&&!Sp(e))return Zt([new at("","zoom expressions not supported")]);const s=Jr(n);if(!s&&!o)return Zt([new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof at)return Zt([s]);if(s instanceof dt&&!Ip(e))return Zt([new at("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Ai(i?new us("constant",t.value):new us("source",t.value));const a=s instanceof dt?s.interpolation:void 0;return Ai(i?new cs("camera",t.value,s.labels,a):new cs("composite",t.value,s.labels,a))}function Jr(r){let e=null;if(r instanceof Cn)e=Jr(r.result);else if(r instanceof Ar){for(const t of r.args)if(e=Jr(t),e)break}else(r instanceof Fn||r instanceof dt)&&r.input instanceof De&&r.input.name==="zoom"&&(e=r);return e instanceof at||r.eachChild(t=>{const n=Jr(t);n instanceof at?e=n:!e&&n?e=new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new at("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ln(r,e=new Set){return r instanceof Rr&&e.add(r.key),r.eachChild(t=>{Ln(t,e)}),e}function Mp(r){const e={color:ct,string:j,number:b,enum:j,boolean:N,formatted:In,padding:Pn,numberArray:An,colorArray:Tr,projectionDefinition:Tn,resolvedImage:zr,variableAnchorOffsetCollection:En};return r.type==="array"?je(e[r.value]||R,r.length):e[r.type]}function Cp(r){if(r.type==="color"&&Ba(r.default))return new J(0,0,0,0);switch(r.type){case"color":return J.parse(r.default)||null;case"padding":return rt.parse(r.default)||null;case"numberArray":return nt.parse(r.default)||null;case"colorArray":return $e.parse(r.default)||null;case"variableAnchorOffsetCollection":return ft.parse(r.default)||null;case"projectionDefinition":return et.parse(r.default)||null;default:return r.default===void 0?null:r.default}}function Ga(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Ga(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const kp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fp(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ga(r)||(r=ln(r));const e=qa(r,kp);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=Va(r);return{filter:(n,i,o)=>e.value.evaluate(n,i,{},o),needGeometry:t,getGlobalStateRefs:()=>Ln(e.value.expression)}}}function zp(r,e){return r<e?-1:r>e?1:0}function Va(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Va(r[e]))return!0;return!1}function ln(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?ii(r[1],r[2],"=="):e==="!="?Vr(ii(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ii(r[1],r[2],e):e==="any"?Op(r.slice(1)):e==="all"?["all"].concat(r.slice(1).map(ln)):e==="none"?["all"].concat(r.slice(1).map(ln).map(Vr)):e==="in"?fs(r[1],r.slice(2)):e==="!in"?Vr(fs(r[1],r.slice(2))):e==="has"?ds(r[1]):e==="!has"?Vr(ds(r[1])):!0}function ii(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function Op(r){return["any"].concat(r.map(ln))}function fs(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(zp)]]:["filter-in-small",r,["literal",e]]}}function ds(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Vr(r){return["!",r]}function Mr(r){return typeof r=="object"?["literal",r]:r}function Rp(r,e){let t=r.stops;if(!t)return Lp(r,e);const n=t&&typeof t[0][0]=="object",i=n||r.property!==void 0,o=n||!i;return t=t.map(s=>!i&&e.tokens&&typeof s[1]=="string"?[s[0],$p(s[1])]:[s[0],Mr(s[1])]),n?Np(r,e,t):o?Up(r,e,t):Ei(r,e,t)}function Lp(r,e){const t=["get",r.property];if(r.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,r.default];{const n=[e.type==="color"?"to-color":e.type,t,Mr(r.default)];return e.type==="array"&&n.splice(1,0,e.value,e.length||null),n}}function bo(r){switch(r.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function Np(r,e,t){const n={},i={},o=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;n[u]===void 0&&(n[u]={zoom:u,type:r.type,property:r.property,default:r.default},i[u]=[],o.push(u)),i[u].push([l[0].value,l[1]])}if(wo({},e)==="exponential"){const a=[bo(r),["linear"],["zoom"]];for(const l of o){const u=Ei(n[l],e,i[l]);Yt(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of o){const u=Ei(n[l],e,i[l]);Yt(a,l,u,!0)}return vo(a),a}}function jp(r,e){if(r!==void 0)return r;if(e!==void 0)return e}function ps(r,e){const t=Mr(jp(r.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function Ei(r,e,t){const n=wo(r,e),i=["get",r.property];if(n==="categorical"&&typeof t[0][0]=="boolean"){const o=["case"];for(const s of t)o.push(["==",i,s[0]],s[1]);return o.push(ps(r,e)),o}else if(n==="categorical"){const o=["match",i];for(const s of t)Yt(o,s[0],s[1],!1);return o.push(ps(r,e)),o}else if(n==="interval"){const o=["step",["number",i]];for(const s of t)Yt(o,s[0],s[1],!0);return vo(o),r.default===void 0?o:["case",["==",["typeof",i],"number"],o,Mr(r.default)]}else if(n==="exponential"){const o=r.base!==void 0?r.base:1,s=[bo(r),o===1?["linear"]:["exponential",o],["number",i]];for(const a of t)Yt(s,a[0],a[1],!1);return r.default===void 0?s:["case",["==",["typeof",i],"number"],s,Mr(r.default)]}else throw new Error(`Unknown property function type ${n}`)}function Up(r,e,t,n=["zoom"]){const i=wo(r,e);let o,s=!1;if(i==="interval")o=["step",n],s=!0;else if(i==="exponential"){const a=r.base!==void 0?r.base:1;o=[bo(r),a===1?["linear"]:["exponential",a],n]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)Yt(o,a[0],a[1],s);return vo(o),o}function vo(r){r[0]==="step"&&r.length===3&&(r.push(0),r.push(r[3]))}function Yt(r,e,t,n){r.length>3&&e===r[r.length-2]||(n&&r.length===2||r.push(e),r.push(t))}function wo(r,e){return r.type?r.type:e.expression.interpolated?"exponential":"interval"}function $p(r){const e=["concat"],t=/{([^{}]+)}/g;let n=0;for(let i=t.exec(r);i!==null;i=t.exec(r)){const o=r.slice(n,t.lastIndex-i[0].length);n=t.lastIndex,o.length>0&&e.push(o),e.push(["get",i[1]])}if(e.length===1)return r;if(n<r.length)e.push(r.slice(n));else if(e.length===2)return["to-string",e[1]];return e}const Dp=dd;var hs={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},dr=" ",ys=/(italic|oblique)$/i,ms={};function Mi(r,e,t){var n=ms[r];if(!n){Array.isArray(r)||(r=[r]);for(var i=400,o="normal",s=[],a,l,u=0,f=r.length;u<f;++u){var c=r[u],d=c.split(" "),h=d[d.length-1].toLowerCase();h=="normal"||h=="italic"||h=="oblique"?(o=l?o:h,l=!0,d.pop(),h=d[d.length-1].toLowerCase()):ys.test(h)&&(h=h.replace(ys,""),o=l?o:d[d.length-1].replace(h,""),l=!0);for(var p in hs){var y=d.length>1?d[d.length-2].toLowerCase():"";if(h==p||h==p.replace("-","")||y+"-"+h==p){i=a?i:hs[p],d.pop(),y&&p.startsWith(y)&&d.pop();break}}!a&&typeof h=="number"&&(i=h,a=!0);var m=d.join(dr).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");m.indexOf(dr)!==-1&&(m='"'+m+'"'),s.push(m)}n=ms[r]=[o,i,s]}return n[0]+dr+n[1]+dr+e+"px"+(t?"/"+t:"")+dr+n[2]}const Wa="https://api.mapbox.com";function xo(r){const e="mapbox://";return r.indexOf(e)!==0?"":r.slice(e.length)}function Bp(r,e,t){if(typeof r=="string")return[{id:"default",url:gs(r,e,t)}];for(const n of r)n.url=gs(n.url,e,t);return r}function gs(r,e,t){const n=xo(r);if(!n)return decodeURI(new URL(r,t).href);const i="sprites/";if(n.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${r}`);const o=n.slice(i.length);return`${Wa}/styles/v1/${o}/sprite?access_token=${e}`}function un(r,e){const t=xo(r);if(!t)return decodeURI(new URL(r,location.href).href);const n="styles/";if(t.indexOf(n)!==0)throw new Error(`unexpected style url: ${r}`);const i=t.slice(n.length);return`${Wa}/styles/v1/${i}?&access_token=${e}`}const qp=["a","b","c","d"];function Xr(r,e,t,n){const i=new URL(r,n||location.href),o=xo(r);if(!o)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(o==="mapbox.satellite"){const s=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${o}/{z}/{x}/{y}${s}.webp?access_token=${e}`]}return qp.map(s=>`https://${s}.tiles.mapbox.com/v4/${o}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const Se=Object.freeze({}),bs={},vs={};let Gp=0;function _o(r){return r.id||(r.id=Gp++),r.id}function Vp(r,e){return _o(r)+"."+Dl(e)}function Za(r){let e=bs[r.id];return e||(e={},bs[_o(r)]=e),e}function Wp(r){let e=vs[r.id];return e||(e={},vs[_o(r)]=e),e}function oi(r){return r*Math.PI/180}const it=function(){const r=[];for(let e=78271.51696402048;r.length<=24;e/=2)r.push(e);return r}();function Nn(r,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(r,e);const t=document.createElement("canvas");return t.width=r,t.height=e,t}function cn(r,e){let t=0;const n=e.length;for(;t<n;++t)if(e[t]<r&&t+1<n){const o=e[t]/e[t+1];return t+Math.log(e[t]/r)/Math.log(o)}return n-1}function gr(r,e){const t=Math.floor(r),n=Math.pow(2,r-t);return e[t]/n}const qt={};function tr(r,e,t={},n){if(e in qt)return n&&(n.url=qt[e][0].url),qt[e][1];const i=t.transformRequest&&t.transformRequest(e,r)||e,o=function(l){return delete qt[e],Promise.reject(new Error("Error fetching source "+e))},s=function(l){return delete qt[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=Kr(()=>i).then(l=>l instanceof Response?(n&&(n.url=l.url),s(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),n&&(n.url=l.url),fetch(l).then(s).catch(o))).catch(o);return qt[e]=[i,a],a}function Ha(r,e){if(typeof r=="string")if(r.trim().startsWith("{"))try{const t=JSON.parse(r);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return r=un(r,e.accessToken),tr("Style",r,e);else return Promise.resolve(r)}const ws={};function Ja(r,e,t={}){const n=[e,JSON.stringify(r)].toString();let i=ws[n];if(!i||t.transformRequest){let o;t.transformRequest&&(o=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof Bl)a.setLoader((f,c,d)=>{const h=function(p){p.arrayBuffer().then(y=>{const v=a.getFormat().readFeatures(y,{extent:f,featureProjection:d});a.setFeatures(v)})};Kr(()=>u).then(p=>{if(p instanceof Response)return h(p);fetch(p).then(h).catch(y=>a.setState(zt.ERROR))}).catch(p=>a.setState(zt.ERROR))});else{const f=a.getImage();Kr(()=>u).then(c=>{if(typeof c=="string"){f.src=c;return}const d=h=>h.blob().then(p=>{const y=URL.createObjectURL(p);f.addEventListener("load",()=>URL.revokeObjectURL(y)),f.addEventListener("error",()=>URL.revokeObjectURL(y)),f.src=y});if(c instanceof Response)return d(c);fetch(c).then(d).catch(h=>a.setState(zt.ERROR))}).catch(c=>a.setState(zt.ERROR))}});const s=r.url;if(s&&!r.tiles){const a=Xr(s,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(s.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},r,{url:void 0,tiles:a}),tileLoadFunction:o});else{const l={};i=tr("Source",a[0],t,l).then(function(u){return u.tiles=u.tiles.map(function(f){return u.scheme==="tms"&&(f=f.replace("{y}","{-y}")),Xr(f,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:o})})}}else r.tiles?(r=Object.assign({},r,{tiles:r.tiles.map(function(a){return r.scheme==="tms"&&(a=a.replace("{y}","{-y}")),Xr(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},r),tileLoadFunction:o})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));ws[n]=i}return i}function xs(r,e,t,n){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],o=Nn(i[0],i[1]),s=o.getContext("2d");s.drawImage(r,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=s.getImageData(0,0,i[0],i[1]);s.globalCompositeOperation="destination-over",s.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;const l=a.data;for(let u=0,f=a.width;u<f;++u)for(let c=0,d=a.height;c<d;++c){const h=(c*f+u)*4;l[h+3]>0&&s.arc(u,c,t*e.pixelRatio,0,2*Math.PI)}return s.fill(),o}function Zp(r,e,t){const n=Math.max(0,Math.min(1,(t-r)/(e-r)));return n*n*(3-2*n)}function _s(r,e,t){const n=Nn(e.width,e.height),i=n.getContext("2d");i.drawImage(r,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),s=o.data;for(let a=0,l=o.width;a<l;++a)for(let u=0,f=o.height;u<f;++u){const c=(u*l+a)*4,d=s[c+3]/255,h=.75,p=.1,y=Zp(h-p,h+p,d);y>0?(s[c+0]=Math.round(255*t.r*y),s[c+1]=Math.round(255*t.g*y),s[c+2]=Math.round(255*t.b*y),s[c+3]=Math.round(255*y)):s[c+3]=0}return i.putImageData(o,0,0),n}const Hp=Array(256).join("");function Ci(r,e){if(e>=.05){let t="";const n=r.split(`
`),i=Hp.slice(0,Math.round(e/.1));for(let o=0,s=n.length;o<s;++o)o>0&&(t+=`
`),t+=n[o].split("").join(i);return t}return r}let si;function Xa(){return si||(si=Nn(1,1).getContext("2d")),si}function Ct(r,e){return Xa().measureText(r).width+(r.length-1)*e}const fn={};ql.on("propertychange",()=>{for(const r in fn)delete fn[r]});function ki(r,e,t,n){if(r.indexOf(`
`)!==-1){const s=r.split(`
`),a=[];for(let l=0,u=s.length;l<u;++l)a.push(ki(s[l],e,t,n));return a.join(`
`)}const i=t+","+e+","+r+","+n;let o=fn[i];if(!o){const s=r.split(" ");if(s.length>1){const a=Xa();a.font=e;const u=a.measureText("M").width*t;let f="";const c=[];for(let d=0,h=s.length;d<h;++d){const p=s[d],y=f+(f?" ":"")+p;Ct(y,n)<=u?f=y:(f&&c.push(f),f=p)}f&&c.push(f);for(let d=0,h=c.length;d<h&&h>1;++d){const p=c[d];if(Ct(p,n)<u*.35){const y=d>0?Ct(c[d-1],n):1/0,m=d<h-1?Ct(c[d+1],n):1/0;c.splice(d,1),h-=1,y<m?(c[d-1]+=" "+p,d-=1):c[d]=p+" "+c[d]}}for(let d=0,h=c.length-1;d<h;++d){const p=c[d],y=c[d+1];if(Ct(p,n)>u*.7&&Ct(y,n)<u*.6){const m=p.split(" "),v=m.pop();Ct(v,n)<u*.2&&(c[d]=m.join(" "),c[d+1]=v+" "+y),h-=1}}o=c.join(`
`)}else o=r;o=Ci(o,n),fn[i]=o}return o}const Jp=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],Ts={};function Xp(r,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(vn)return r;let t;for(let n=0,i=r.length;n<i;++n){const o=r[n];if(o in Ts)continue;Ts[o]=!0;const a=Mi(o,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let n=0,i=t.length;n<i;++n){const o=t[n],s=o[0];if(Jp.includes(s))continue;const a=o[1],l=o[2];if(!(await document.fonts.load(`${l} ${a} 16px "${s}"`)).some(f=>f.family.replace(/^['"]|['"]$/g,"").toLowerCase()===s.toLowerCase()&&f.weight==a&&f.style===l)){const f=e.replace("{font-family}",s.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",s.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+f+'"]')){const c=document.createElement("link");c.href=f,c.rel="stylesheet",document.head.appendChild(c)}}}})(),r}const Kp={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},Yp={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},Qp=function(r,e){const t=Ep(r,e);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return t.value},Me={zoom:0,distanceFromCenter:0};De.register(Rn,{...De.definitions,pitch:[{kind:"number"},[],r=>Me.pitch||90],"distance-from-center":[{kind:"number"},[],r=>Me.distanceFromCenter||0]});let Wr,ai;function C(r,e,t,n,i,o){const s=r.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[s]||(i[s]={});const a=i[s];if(!a[t]){let l=(r[e]||Se)[t];const u=Dp[`${e}_${r.type}`][t];l===void 0&&(l=u.default);let f=Ap(l);if(!f&&Ba(l)&&(l=Rp(l,u),f=!0),f){const c=Qp(l,u);a[t]=c.evaluate.bind(c)}else{const c=u.type;(c==="color"||c==="colorArray")&&(l=J.parse(l)),a[t]=function(){return l}}}return a[t](Me,n,o)}function Ss(r,e,t,n){return C(r,"layout",`${t}-allow-overlap`,e,n)?C(r,"layout",`${t}-ignore-placement`,e,n)?"none":"obstacle":"declutter"}function eh(r,e,t,n){if(n||console.warn("No filterCache provided to evaluateFilter()"),!(r in n))try{n[r]=Fp(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),n[r]=function(){return!1}}return n[r](Me,t)}function _t(r,e){if(r){if(r.a===0||e===0)return;const t=r.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(r.r*255/t)+","+Math.round(r.g*255/t)+","+Math.round(r.b*255/t)+","+t*e+")"}return r}const th=/\{[^{}}]*\}/g;function li(r,e){return r.replace(th,function(t){return e[t.slice(1,-1)]||""})}function Is(r,e){let t=r.split(":")[0];return t===r&&(t="default"),e[t]}const rh={};function nh(r,e,t,n=it,i=void 0,o=void 0,s=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");rh[Vp(e,r)]=Array.from(arguments);const l={};(typeof o=="string"||o instanceof Request||o instanceof Response||o instanceof Promise)&&(o={default:o});for(const A in o){const z=o[A];Kr(()=>z).then(async w=>{let P;if(typeof Image<"u"){const S=new Image;if(typeof w=="string")S.crossOrigin="anonymous",S.src=w;else{let k;w instanceof Request?k=await fetch(w):w instanceof Response&&(k=w);const _=await k.blob();P=URL.createObjectURL(_),S.src=P}S.addEventListener("load",function k(){S.removeEventListener("load",k),l[A]={image:S,size:[S.width,S.height]},r.changed(),P&&URL.revokeObjectURL(P)}),S.addEventListener("error",function k(){URL.revokeObjectURL(P),S.removeEventListener("error",k)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const S=self;S.postMessage({action:"loadImage",src:w}),S.addEventListener("message",function(_){_.data.action==="imageLoaded"&&_.data.src===w&&(l[A]={image:_.data.image,size:[_.data.image.width,_.data.image.height]})})}})}const u=_a(e.layers),f={},c=[],d={},h={},p=Za(e),y=Wp(e);let m;for(let A=0,z=u.length;A<z;++A){const w=u[A],P=w.id;if(typeof t=="string"&&w.source==t||Array.isArray(t)&&t.indexOf(P)!==-1){const S=w["source-layer"];if(m){if(w.source!==m)throw new Error(`Layer "${P}" does not use source "${m}`)}else{m=w.source;const _=e.sources[m];if(!_)throw new Error(`Source "${m}" is not defined`);const D=_.type;if(D!=="vector"&&D!=="geojson")throw new Error(`Source "${m}" is not of type "vector" or "geojson", but "${D}"`)}let k=f[S];k||(k=[],f[S]=k),k.push({layer:w,index:A}),c.push(P)}}const v=new yr,x=new Ht,g=[],O=function(A,z,w){var Ce,le,be;const P=((be=(le=(Ce=r.getSource)==null?void 0:Ce.call(r))==null?void 0:le.format_)==null?void 0:be.layerName_)??"mvt:layer",S=A.getProperties(),k=f[S[P]];if(!k)return;let _=n.indexOf(z);_==-1&&(_=cn(z,n)),Me.zoom=_,Me.distanceFromCenter=0;const D=A.getGeometry(),V=Kp[D.getType()],te=r.get("map");if(te&&te instanceof Qr&&V===1){const ze=te.getSize();if(ze){const Be=te.getView().getCenter(),pe=Ui(D.getExtent());Me.distanceFromCenter=Gl(Be,pe)/z/ze[1]}}const I={id:A.getId(),properties:S,type:V},E=r.get("mapbox-featurestate")[A.getId()];let U=-1;for(let ze=0,Be=k.length;ze<Be;++ze){const pe=k[ze],T=pe.layer,Je=T.id;if(w!==void 0&&w!==Je)continue;const Xe=T.layout||Se,Ie=T.paint||Se;if(Xe.visibility==="none"||"minzoom"in T&&_<T.minzoom||"maxzoom"in T&&_>=T.maxzoom)continue;const qe=T.filter;if(!qe||eh(Je,qe,I,y)){let he,Ke,Et,Oe,Ge,M;const Dt=pe.index;if(V==3&&(T.type=="fill"||T.type=="fill-extrusion"))if(Ke=C(T,"paint",T.type+"-opacity",I,p,E),T.type+"-pattern"in Ie){const se=C(T,"paint",T.type+"-pattern",I,p,E);if(se){const ie=typeof se=="string"?li(se,S):se.toString(),Q=Is(ie,l);if(i&&i[ie]&&Q){++U,M=g[U],(!M||!M.getFill()||M.getStroke()||M.getText())&&(M=new kt({fill:new Ht}),g[U]=M),Et=M.getFill(),M.setZIndex(Dt);const K=ie+"."+Ke;let de=h[K];if(!de){const B=i[ie],Z=Nn(B.width,B.height),ye=Z.getContext("2d");ye.globalAlpha=Ke,ye.drawImage(Q.image,B.x,B.y,B.width,B.height,0,0,B.width,B.height),de=ye.createPattern(Z,"repeat"),h[K]=de}Et.setColor(de)}}}else he=_t(C(T,"paint",T.type+"-color",I,p,E),Ke),T.type+"-outline-color"in Ie&&(Ge=_t(C(T,"paint",T.type+"-outline-color",I,p,E),Ke)),Ge||(Ge=he),(he||Ge)&&(++U,M=g[U],(!M||he&&!M.getFill()||!he&&M.getFill()||Ge&&!M.getStroke()||!Ge&&M.getStroke()||M.getText())&&(M=new kt({fill:he?new Ht:void 0,stroke:Ge?new yr:void 0}),g[U]=M),he&&(Et=M.getFill(),Et.setColor(he)),Ge&&(Oe=M.getStroke(),Oe.setColor(Ge),Oe.setWidth(.5)),M.setZIndex(Dt));if(V!=1&&T.type=="line"){"line-pattern"in Ie?he=void 0:he=_t(C(T,"paint","line-color",I,p,E),C(T,"paint","line-opacity",I,p,E));const se=C(T,"paint","line-width",I,p,E);he&&se>0&&(++U,M=g[U],(!M||!M.getStroke()||M.getFill()||M.getText())&&(M=new kt({stroke:new yr}),g[U]=M),Oe=M.getStroke(),Oe.setLineCap(C(T,"layout","line-cap",I,p,E)),Oe.setLineJoin(C(T,"layout","line-join",I,p,E)),Oe.setMiterLimit(C(T,"layout","line-miter-limit",I,p,E)),Oe.setColor(he),Oe.setWidth(se),Oe.setLineDash(Ie["line-dasharray"]?C(T,"paint","line-dasharray",I,p,E).map(function(ie){return ie*se}):null),M.setZIndex(Dt))}let jr=!1,W=null,Mo=0,Bt,Pe,Bn;if((V==1||V==2)&&"icon-image"in Xe){const se=C(T,"layout","icon-image",I,p,E);if(se){Bt=typeof se=="string"?li(se,S):se.toString();let ie;const Q=a?a(r,Bt):void 0,K=Is(Bt,l);if(i&&i[Bt]&&K||Q){const de=C(T,"layout","icon-rotation-alignment",I,p,E);if(V==2){const B=A.getGeometry();if(B.getFlatMidpoint||B.getFlatMidpoints){const Z=B.getExtent();if(Math.sqrt(Math.max(Math.pow((Z[2]-Z[0])/z,2),Math.pow((Z[3]-Z[1])/z,2)))>150){const we=B.getType()==="MultiLineString"?B.getFlatMidpoints():B.getFlatMidpoint();if(ai||(Wr=[NaN,NaN],ai=new Rs("Point",Wr,[],2,{},void 0)),ie=ai,Wr[0]=we[0],Wr[1]=we[1],C(T,"layout","symbol-placement",I,p,E)==="line"&&de==="map"){const Ye=B.getStride(),Ae=B.getFlatCoordinates();for(let Re=0,ue=Ae.length-Ye;Re<ue;Re+=Ye){const _e=Ae[Re],Ve=Ae[Re+1],ce=Ae[Re+Ye],bt=Ae[Re+Ye+1],ol=Math.min(_e,ce),sl=Math.max(_e,ce),Gn=we[0],al=we[1],ll=(bt-Ve)*(Gn-_e)-(ce-_e)*(al-Ve);if(Math.abs(ll)<.001&&Gn<=sl&&Gn>=ol){Mo=Math.atan2(Ve-bt,ce-_e);break}}}}}}if(V!==2||ie){const B=C(T,"layout","icon-size",I,p,E),Z=Ie["icon-color"]!==void 0?C(T,"paint","icon-color",I,p,E):null;if(!Z||Z.a!==0){const ye=C(T,"paint","icon-halo-color",I,p,E),we=C(T,"paint","icon-halo-width",I,p,E);let st=`${Bt}.${B}.${we}.${ye}`;if(Z!==null&&(st+=`.${Z}`),Pe=d[st],!Pe){const Ye=Ss(T,I,"icon",p);let Ae;"icon-offset"in Xe&&(Ae=C(T,"layout","icon-offset",I,p,E).slice(0),Ae[0]*=B,Ae[1]*=-B);let Re=Z?[Z.r*255,Z.g*255,Z.b*255,Z.a]:void 0;if(Q){const ue={color:Re,rotateWithView:de==="map",displacement:Ae,declutterMode:Ye,scale:B};typeof Q=="string"?ue.src=Q:(ue.img=Q,ue.imgSize=[Q.width,Q.height]),Pe=new Oo(ue)}else{const ue=i[Bt];let _e,Ve,ce;if(we)ue.sdf?(_e=xs(_s(K.image,ue,Z||[0,0,0,1]),{x:0,y:0,width:ue.width,height:ue.height,pixelRatio:ue.pixelRatio},we,ye),Re=void 0):_e=xs(K.image,ue,we,ye);else{if(ue.sdf&&!K.unSDFed){const bt=_s(K.image,{x:0,y:0,width:K.size[0],height:K.size[1]},{r:1,g:1,b:1});K.image=bt,K.unSDFed=!0}_e=K.image,Ve=[ue.width,ue.height],ce=[ue.x,ue.y]}Pe=new Oo({color:Re,img:_e,imgSize:K.size,size:Ve,offset:ce,rotateWithView:de==="map",scale:B/ue.pixelRatio,displacement:Ae,declutterMode:Ye})}d[st]=Pe}}Pe&&(++U,M=g[U],(!M||!M.getImage()||M.getFill()||M.getStroke())&&(M=new kt,g[U]=M),M.setGeometry(ie),Pe.setRotation(Mo+oi(C(T,"layout","icon-rotate",I,p,E))),Pe.setOpacity(C(T,"paint","icon-opacity",I,p,E)),Pe.setAnchor(Yp[C(T,"layout","icon-anchor",I,p,E)]),M.setImage(Pe),W=M.getText(),M.setText(void 0),M.setZIndex(Dt),jr=!0,Bn=!1)}else Bn=!0}}}if(V==1&&T.type==="circle"){++U,M=g[U],(!M||!M.getImage()||M.getFill()||M.getStroke())&&(M=new kt,g[U]=M);const se="circle-radius"in Ie?C(T,"paint","circle-radius",I,p,E):5,ie=_t(C(T,"paint","circle-stroke-color",I,p,E),C(T,"paint","circle-stroke-opacity",I,p,E)),Q=C(T,"paint","circle-translate",I,p,E),K=_t(C(T,"paint","circle-color",I,p,E),C(T,"paint","circle-opacity",I,p,E)),de=C(T,"paint","circle-stroke-width",I,p,E),B=se+"."+ie+"."+K+"."+de+"."+Q[0]+"."+Q[1];Pe=d[B],Pe||(Pe=new Ds({radius:se,displacement:[Q[0],-Q[1]],stroke:ie&&de>0?new yr({width:de,color:ie}):void 0,fill:K?new Ht({color:K}):void 0,declutterMode:"none"}),d[B]=Pe),M.setImage(Pe),W=M.getText(),M.setText(void 0),M.setGeometry(void 0),M.setZIndex(Dt),jr=!0}let ve,lr,ur,gt,cr,qn;if("text-field"in Xe){gt=Math.round(C(T,"layout","text-size",I,p,E));const se=C(T,"layout","text-font",I,p,E);ur=C(T,"layout","text-line-height",I,p,E),lr=Mi(s?s(se,e.metadata?e.metadata["ol:webfonts"]:void 0):se,gt,ur),lr.includes("sans-serif")||(lr+=",sans-serif"),cr=C(T,"layout","text-letter-spacing",I,p,E),qn=C(T,"layout","text-max-width",I,p,E);const ie=C(T,"layout","text-field",I,p,E);typeof ie=="object"&&ie.sections?ie.sections.length===1?ve=ie.toString():ve=ie.sections.reduce((Q,K,de)=>{const B=K.fontStack?K.fontStack.split(","):se,Z=Mi(s?s(B):B,gt*(K.scale||1),ur);let ye=K.text;if(ye===`
`)return Q.push(`
`,""),Q;if(V==2)return Q.push(Ci(ye,cr),Z),Q;ye=ki(ye,Z,qn,cr).split(`
`);for(let we=0,st=ye.length;we<st;++we)we>0&&Q.push(`
`,""),Q.push(ye[we],Z);return Q},[]):ve=li(ie,S).trim(),Ke=C(T,"paint","text-opacity",I,p,E)}if(ve&&Ke&&!Bn){jr||(++U,M=g[U],(!M||!M.getText()||M.getFill()||M.getStroke())&&(M=new kt,g[U]=M),M.setImage(void 0),M.setGeometry(void 0));const se=Ss(T,I,"text",p);M.getText()||M.setText(W),W=M.getText(),(!W||"getDeclutterMode"in W&&W.getDeclutterMode()!==se)&&(W=new Vl({padding:[2,2,2,2],declutterMode:se}),M.setText(W));const ie=C(T,"layout","text-transform",I,p,E);ie=="uppercase"?ve=Array.isArray(ve)?ve.map((ce,bt)=>bt%2?ce:ce.toUpperCase()):ve.toUpperCase():ie=="lowercase"&&(ve=Array.isArray(ve)?ve.map((ce,bt)=>bt%2?ce:ce.toLowerCase()):ve.toLowerCase());const Q=Array.isArray(ve)?ve:V==2?Ci(ve,cr):ki(ve,lr,qn,cr);if(W.setText(Q),W.setFont(lr),W.setRotation(oi(C(T,"layout","text-rotate",I,p,E))),typeof W.setKeepUpright=="function"){const ce=C(T,"layout","text-keep-upright",I,p,E);W.setKeepUpright(ce)}const K=C(T,"layout","text-anchor",I,p,E),de=jr||V==1?"point":C(T,"layout","symbol-placement",I,p,E);let B;if(de==="line-center"?(W.setPlacement("line"),B="center"):W.setPlacement(de),de==="line"&&typeof W.setRepeat=="function"){const ce=C(T,"layout","symbol-spacing",I,p,E);W.setRepeat(ce*2)}W.setOverflow(de==="point");let Z=C(T,"paint","text-halo-width",I,p,E);const ye=C(T,"layout","text-offset",I,p,E),we=C(T,"paint","text-translate",I,p,E);let st=0,Ye=0;if(de=="point"){B="center",K.indexOf("left")!==-1?(B="left",Ye=Z):K.indexOf("right")!==-1&&(B="right",Ye=-Z);const ce=C(T,"layout","text-rotation-alignment",I,p,E);W.setRotateWithView(ce=="map")}else W.setMaxAngle(oi(C(T,"layout","text-max-angle",I,p,E))*ve.length/Q.length),W.setRotateWithView(!1);W.setTextAlign(B);let Ae="middle";K.indexOf("bottom")==0?(Ae="bottom",st=-Z-.5*(ur-1)*gt):K.indexOf("top")==0&&(Ae="top",st=Z+.5*(ur-1)*gt),W.setTextBaseline(Ae);const Re=C(T,"layout","text-justify",I,p,E);W.setJustify(Re==="auto"?void 0:Re),W.setOffsetX(ye[0]*gt+Ye+we[0]),W.setOffsetY(ye[1]*gt+st+we[1]),x.setColor(_t(C(T,"paint","text-color",I,p,E),Ke)),W.setFill(x);const ue=_t(C(T,"paint","text-halo-color",I,p,E),Ke);if(ue&&Z>0){v.setColor(ue),Z*=2;const ce=.5*gt;v.setWidth(Z<=ce?Z:ce),W.setStroke(v)}else W.setStroke(void 0);const _e=C(T,"layout","text-padding",I,p,E),Ve=W.getPadding();_e!==Ve[0]&&(Ve[0]=_e,Ve[1]=_e,Ve[2]=_e,Ve[3]=_e),M.setZIndex(Dt)}}}if(U>-1)return g.length=U+1,g};return r.setStyle(O),r.set("mapbox-layers",c),r.set("mapbox-source",m),r.set("mapbox-featurestate",r.get("mapbox-featurestate")||{}),O}function ih(r,e){const t=r[0],n=t.width,i=t.height,o=t.data,s=new Uint8ClampedArray(o.length),a=e.resolution*2,l=n-1,u=i-1,f=[0,0,0,0],c=2*Math.PI,d=Math.PI/2,h=Math.PI*e.sunEl/180,p=Math.PI*e.sunAz/180,y=Math.cos(h),m=Math.sin(h),v=e.highlightColor,x=e.shadowColor,g=e.accentColor,O=e.encoding;let A,z,w,P,S,k,_,D,V,te,I,E,U,Ce,le,be,ze,Be,pe,T,Je,Xe;function Ie(qe,he="mapbox"){if(he==="mapbox")return(qe[0]*256*256+qe[1]*256+qe[2])*.1-1e4;if(he==="terrarium")return qe[0]*256+qe[1]+qe[2]/256-32768}for(z=0;z<=u;++z)for(S=z===0?0:z-1,k=z===u?u:z+1,A=0;A<=l;++A)w=A===0?0:A-1,P=A===l?l:A+1,_=(z*n+w)*4,f[0]=o[_],f[1]=o[_+1],f[2]=o[_+2],f[3]=o[_+3],D=e.vert*Ie(f,O),_=(z*n+P)*4,f[0]=o[_],f[1]=o[_+1],f[2]=o[_+2],f[3]=o[_+3],V=e.vert*Ie(f,O),te=(V-D)/a,_=(S*n+A)*4,f[0]=o[_],f[1]=o[_+1],f[2]=o[_+2],f[3]=o[_+3],D=e.vert*Ie(f,O),_=(k*n+A)*4,f[0]=o[_],f[1]=o[_+1],f[2]=o[_+2],f[3]=o[_+3],V=e.vert*Ie(f,O),I=(V-D)/a,U=Math.atan2(I,-te),U<0?U=d-U:U>d?U=c-U+d:U=d-U,E=Math.atan(Math.sqrt(te*te+I*I)),Xe=m*Math.cos(E)+y*Math.sin(E)*Math.cos(p-U),Ce=Math.cos(E),le=255*Xe,pe=Math.min(Math.max(2*e.sunEl,0),1),T=1.875-e.opacity*1.75,Je=e.opacity!==.5?d*((Math.pow(T,E)-1)/(Math.pow(T,d)-1)):E,ze={r:(1-Ce)*g.r*pe*255,g:(1-Ce)*g.g*pe*255,b:(1-Ce)*g.b*pe*255,a:(1-Ce)*g.a*pe*255},be=Math.abs(((U+p)/Math.PI+.5)%2-1),Be={r:(v.r*(1-be)+x.r*be)*le,g:(v.g*(1-be)+x.g*be)*le,b:(v.b*(1-be)+x.b*be)*le,a:(v.a*(1-be)+x.a*be)*le},_=(z*n+A)*4,s[_]=ze.r*(1-be)+Be.r,s[_+1]=ze.g*(1-be)+Be.g,s[_+2]=ze.b*(1-be)+Be.b,s[_+3]=o[_+3]*e.opacity*pe*Math.sin(Je);return new ImageData(s,n,i)}function oh(r,e){const t=r[0],n=t.width,i=t.height,o=t.data,s=new Uint8ClampedArray(o.length),a=n-1,l=i-1,u=[0,0,0,0];let f,c,d;function h(P){return P>0?1/(1-P):1+P}function p(P){return P>0?1-1/(1.001-P):-P}function y(P){P*=Math.PI/180;const S=Math.sin(P),k=Math.cos(P);return[(2*k+1)/3,(-Math.sqrt(3)*S-k+1)/3,(Math.sqrt(3)*S-k+1)/3]}const m=p(e.saturation),v=h(e.contrast),x=y(e.hueRotate),g=x,O=[x[2],x[0],x[1]],A=[x[1],x[2],x[0]],z=e.brightnessLow,w=e.brightnessHigh;for(c=0;c<=l;++c)for(f=0;f<=a;++f){d=(c*n+f)*4,u[0]=o[d],u[1]=o[d+1],u[2]=o[d+2],u[3]=o[d+3];const P=u[0],S=u[1],k=u[2],_=(E,U)=>{let Ce=0;for(let le=0;le<E.length;le++)Ce+=E[le]*U[le];return Ce};let D=_([P,S,k],g),V=_([P,S,k],O),te=_([P,S,k],A);const I=(D+V+te)/3;D+=(I-D)*m,V+=(I-V)*m,te+=(I-te)*m,D=(D-.5)*v+.5,V=(V-.5)*v+.5,te=(te-.5)*v+.5,D=z*(255-D)+w*D,V=z*(255-V)+w*V,te=z*(255-te)+w*te,s[d]=D,s[d+1]=V,s[d+2]=te,s[d+3]=u[3]}return new ImageData(s,n,i)}function sh(r,e=512){return r.getExtent()?Ni({extent:r.getExtent(),tileSize:e,maxZoom:22}).getResolutions():it}function Ka(r,e){return e.accessToken||(e=Object.assign({},e),new URL(r).searchParams.forEach((n,i)=>{e.accessToken=n,e.accessTokenParam=i})),e}function ah(r,e,t="",n={},i=void 0){let o,s,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,n=a):l=t,typeof n=="string"?(o=n,a={}):(o=n.styleUrl,a=n),a.updateSource===!1&&(u=!1),i||(i=a.resolutions),!o&&typeof e=="string"&&!e.trim().startsWith("{")&&(o=e),o&&(o=o.startsWith("data:")?location.href:un(o,a.accessToken),a=Ka(o,a)),new Promise(function(f,c){Ha(e,a).then(function(d){if(d.version!=8)return c(new Error("glStyle version 8 required."));if(!(r instanceof bn||r instanceof Xt))return c(new Error("Can only apply to VectorLayer or VectorTileLayer"));const h=r instanceof Xt?"vector":"geojson";if(l?Array.isArray(l)?s=d.layers.find(function(O){return O.id===l[0]}).source:s=l:(s=d.layers.find(function(O){return O.source&&d.sources[O.source].type===h}).source,l=s),!s)return c(new Error(`No ${h} source found in the glStyle.`));function p(){if(!u)return Promise.resolve();if(r instanceof Xt)return el(d.sources[s],o,a).then(function(w){const P=r.getSource();P?w!==P&&(P.setTileUrlFunction(w.getTileUrlFunction()),typeof P.setUrls=="function"&&typeof w.getUrls=="function"&&P.setUrls(w.getUrls()),P.format_||(P.format_=w.format_),P.getAttributions()||P.setAttributions(w.getAttributions()),P.getTileLoadFunction()===Yl&&P.setTileLoadFunction(w.getTileLoadFunction()),Ql(P.getProjection(),w.getProjection())&&(P.tileGrid=w.getTileGrid())):r.setSource(w);const S=r.getSource().getTileGrid();!isFinite(r.getMaxResolution())&&!isFinite(r.getMinZoom())&&S.getMinZoom()>0&&r.setMaxResolution(gr(Math.max(0,S.getMinZoom()-1e-12),S.getResolutions()))});const O=d.sources[s];let A=r.getSource();(!A||A.get("mapbox-source")!==O)&&(A=rl(O,o,a));const z=r.getSource();return z?A!==z&&(z.getAttributions()||z.setAttributions(A.getAttributions()),z.format_||(z.format_=A.getFormat()),z.url_=A.getUrl()):r.setSource(A),Promise.resolve()}let y,m;const v={},x={};function g(){if(!m&&(!d.sprite||v)){if(a.projection&&!i){const w=lt(a.projection).getUnits();w!=="m"&&(i=it.map(P=>P/di[w]))}let O;const A=r.getSource();A instanceof kr&&A.format_ instanceof ji&&(O=A.format_.layerName_),m=nh(r,d,l,i,v,x,(z,w=a.webfonts)=>Xp(z,w),a.getImage,O),r.getStyle()?p().then(f).catch(c):c(new Error(`Nothing to show for source [${s}]`))}else m?(r.setStyle(m),p().then(f).catch(c)):c(new Error("Something went wrong trying to apply style."))}if(d.sprite){const O=Bp(d.sprite,a.accessToken,o||location.href);y=vn?1:window.devicePixelRatio>=1.5?.5:1;const A=y==.5?"@2x":"";Promise.all(O.map(function(z){const w=new URL(z.url);let P=w.origin+w.pathname+A+".json"+w.search;return new Promise(function(S,k){tr("Sprite",P,a).then(S).catch(function(_){P=w.origin+w.pathname+".json"+w.search,tr("Sprite",P,a).then(S).catch(k)})}).then(function(S){S===void 0&&c(new Error("No sprites found."));let k;if(k=w.origin+w.pathname+A+".png"+w.search,a.transformRequest){const _=a.transformRequest(k,"SpriteImage")||k;(_ instanceof Request||_ instanceof Promise)&&(k=_)}x[z.id]=k;for(const _ in S){const D=z.id=="default"?_:`${z.id}:${_}`;v[D]=S[_]}}).catch(function(S){c(new Error(`Sprites cannot be loaded: ${P}: ${S.message}`))})})).then(g).catch(c)}else g()}).catch(c)})}function Ya(r,e){let t;return r.some(function(n){if(n.id==e)return t=n.source,!0}),t}function lh(r,e){const t=r.bounds;if(t){const n=pi([t[0],t[1]],e),i=pi([t[2],t[3]],e);return[n[0],n[1],i[0],i[1]]}return lt(e).getExtent()}function Qa(r,e,t){const n=new Di({tileJSON:e,tileSize:r.tileSize||e.tileSize||512}),i=n.getTileJSON(),o=n.getTileGrid(),s=lt(t.projection||"EPSG:3857"),a=lh(i,s),l=s.getExtent(),u=i.minzoom||0,f=i.maxzoom||22,c={attributions:n.getAttributions(),projection:s,tileGrid:new Bs({origin:l?Kl(l):o.getOrigin(0),extent:a||o.getExtent(),minZoom:u,resolutions:sh(s,e.tileSize).slice(0,f+1),tileSize:o.getTileSize(0)})};return Array.isArray(i.tiles)?c.urls=i.tiles:c.url=i.tiles,c}function uh(r,e,t,n){const i={id:r.id,type:r.type},o=r.layout||{},s=r.paint||{};i.paint=s,Me.zoom=cn(e,t.resolutions||it),Me.distanceFromCenter=0;let a;const l=C(i,"paint","background-color",Se,n);return s["background-opacity"]!==void 0&&(a=C(i,"paint","background-opacity",Se,n)),o.visibility=="none"?void 0:_t(l,a)}function ch(r,e,t){const n=vn?{style:{}}:document.createElement("div");return n.className="ol-mapbox-style-background",n.style.position="absolute",n.style.width="100%",n.style.height="100%",new Hl({source:new Jl({}),render(i){const o=uh(r,i.viewState.resolution,e,t);return n.style.backgroundColor=o,n}})}function el(r,e,t){return new Promise(function(n,i){Ja(r,e,t).then(function({tileJson:o,tileLoadFunction:s}){const a=Qa(r,o,t);a.tileLoadFunction=s,a.format=new ji({layerName:"mvt:layer"});const l=new kr(a);l.set("mapbox-source",r),n(l)}).catch(i)})}function fh(r,e,t){const n=new Xt({declutter:!0,visible:!1});return el(r,e,t).then(function(i){n.setSource(i)}).catch(function(i){n.setSource(void 0)}),n}function tl(r){return`{bbox-${(r?r.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function dh(r,e,t){return new Promise(function(n,i){Ja(r,e,t).then(function({tileJson:o,tileLoadFunction:s}){const a=new Di({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:o});a.tileGrid=Qa(r,o,t).tileGrid,t.projection&&(a.projection=lt(t.projection));const l=a.getTileUrlFunction();s&&a.setTileLoadFunction(s),a.setTileUrlFunction(function(u,f,c){const d=tl(c);let h=l(u,f,c);if(h.indexOf(d)!=-1){const p=a.getTileGrid().getTileCoordExtent(u);h=h.replace(d,p.toString())}return h}),a.set("mapbox-source",r),n(a)}).catch(function(o){i(o)})})}function To(r,e,t){const n=new fi;return dh(r,e,t).then(function(i){n.setSource(i)}).catch(function(){n.setSource(void 0)}),n}function ph(r,e,t){const n=To(r,e,t);return new $i({source:new Gs({operationType:"image",operation:oh,sources:[n]})})}function hh(r,e,t){const n=To(r,e,t);return new $i({source:new Gs({operationType:"image",operation:ih,sources:[n]})})}function rl(r,e,t){const n=t.projection?new yi({dataProjection:t.projection}):new yi,i=r.data,o={};if(typeof i=="string"){const[a]=Xr(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(c,d,h)=>{const p=tl(h);return a.replace(p,`${c.join(",")}`)},f=new br({attributions:r.attribution,format:n,loader:(c,d,h,p,y)=>{const m=typeof u=="function"?u(c,d,h):u;tr("GeoJSON",m,t).then(v=>{const x=f.getFormat().readFeatures(v,{featureProjection:h});f.addFeatures(x),p(x)}).catch(v=>{f.removeLoadedExtent(c),y()})},strategy:Xl});return f.set("mapbox-source",r),f}const l=new br({attributions:r.attribution,format:n,url:a,loader:(u,f,c,d,h)=>{tr("GeoJSON",a,t).then(p=>{const y=l.getFormat().readFeatures(p,{featureProjection:c});l.addFeatures(y),d(y)}).catch(p=>{l.removeLoadedExtent(u),h()})}});return l}o.features=n.readFeatures(i,{featureProjection:"EPSG:3857"});const s=new br(Object.assign({attributions:r.attribution,format:n},o));return s.set("mapbox-source",r),s}function yh(r,e,t){return new bn({declutter:!0,source:rl(r,e,t),visible:!1})}function mh(r,e,t){let n=null;return function(i){r.paint&&"raster-opacity"in r.paint&&i.frameState.viewState.zoom!==n&&(n=i.frameState.viewState.zoom,delete t[r.id],gh(r,e,n,t))}}function gh(r,e,t,n){Me.zoom=t,Me.distanceFromCenter=0;const i=C(r,"paint","raster-opacity",Se,n);e.setOpacity(i)}function bh(r,e){function t(){const n=e.get("mapbox-style");if(!n)return;const i=_a(n.layers),o=r.get("mapbox-layers"),s=i.filter(function(a){return o.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});r.get("visible")!==s&&r.setVisible(s)}r.on("change",t),t()}function vh(r,e,t,n){const i=Za(r),o=r.layers,s=t.type,a=t.source||Ya(o,t.ref),l=r.sources[a];let u;if(s=="background")u=ch(t,n,i);else if(l.type=="vector")u=fh(l,e,n);else if(l.type=="raster"){const c=["raster-saturation","raster-contrast","raster-brightness-max","raster-brightness-min","raster-hue-rotate"];!!Object.keys(t.paint||{}).find(h=>c.includes(h))?(u=ph(l,e,n),u.getSource().on("beforeoperations",function(h){Me.zoom=cn(h.resolution,n.resolutions||it),Me.distanceFromCenter=0;const p=h.data;p.saturation=C(t,"paint","raster-saturation",Se,i),p.contrast=C(t,"paint","raster-contrast",Se,i),p.brightnessHigh=C(t,"paint","raster-brightness-max",Se,i),p.brightnessLow=C(t,"paint","raster-brightness-min",Se,i),p.hueRotate=C(t,"paint","raster-hue-rotate",Se,i)})):u=To(l,e,n),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",mh(t,u,i))}else if(l.type=="geojson")u=yh(l,e,n);else if(l.type=="raster-dem"&&t.type=="hillshade"){const c=hh(l,e,n);u=c,c.getSource().on("beforeoperations",function(d){const h=d.data;h.resolution=Zl(n.projection||"EPSG:3857",d.resolution,Ui(d.extent),"m"),Me.zoom=cn(d.resolution,n.resolutions||it),Me.distanceFromCenter=0,h.encoding=l.encoding,h.vert=5*C(t,"paint","hillshade-exaggeration",Se,i),h.sunAz=C(t,"paint","hillshade-illumination-direction",Se,i),h.sunEl=35,h.opacity=.3,h.highlightColor=C(t,"paint","hillshade-highlight-color",Se,i),h.shadowColor=C(t,"paint","hillshade-shadow-color",Se,i),h.accentColor=C(t,"paint","hillshade-accent-color",Se,i)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const f=a;return u&&u.set("mapbox-source",f),u}function Ps(r,e,t,n){const i=[];let o=null;if(e instanceof Qr){if(o=e.getView(),!o.isDef()&&!o.getRotation()&&!o.getResolutions()){const c=n.projection?lt(n.projection):o.getProjection();o=new Wl(Object.assign(o.getProperties(),{maxResolution:it[0]/di[c.getUnits()],projection:n.projection||o.getProjection()})),e.setView(o)}"center"in r&&!o.getCenter()&&o.setCenter(pi(r.center,o.getProjection())),"zoom"in r&&o.getZoom()===void 0&&o.setResolution(it[0]/di[o.getProjection().getUnits()]/Math.pow(2,r.zoom)),(!o.getCenter()||o.getZoom()===void 0)&&o.fit(o.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",r),e.set("mapbox-metadata",{styleUrl:t,options:n});const s=r.layers;let a=[],l,u,f;for(let c=0,d=s.length;c<d;++c){const h=s[c],p=h.type;if(p=="heatmap"){console.debug(`layers[${c}].type "${p}" not supported`);continue}else f=h.source||Ya(s,h.ref),(!f||f!=u)&&(a.length&&(i.push(As(l,a,r,t,e,n)),a=[]),l=vh(r,t,h,n),l instanceof bn||l instanceof Xt||(a=[]),u=l.get("mapbox-source")),a.push(h.id)}return i.push(As(l,a,r,t,e,n)),Promise.all(i)}function sy(r,e,t={}){let n,i;if(vn){if(!(r instanceof Qr)&&!(r instanceof qs))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=r}else typeof r=="string"||r instanceof HTMLElement?i=new Qr({target:r}):i=r;if(typeof e=="string"){const o=e.startsWith("data:")?location.href:un(e,t.accessToken);t=Ka(o,t),n=new Promise(function(s,a){Ha(e,t).then(function(l){Ps(l,i,o,t).then(function(){s(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else n=new Promise(function(o,s){Ps(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:un(t.styleUrl,t.accessToken),t).then(function(){o(i)}).catch(s)});return n}function As(r,e,t,n,i,o={}){let s=24,a=0;const l=t.layers;for(let u=0,f=l.length;u<f;++u){const c=l[u];e.indexOf(c.id)!==-1&&(s=Math.min("minzoom"in c?c.minzoom:0,s),a=Math.max("maxzoom"in c?c.maxzoom:24,a))}return new Promise(function(u,f){const c=function(){const h=r.getSource();if(!h||h.getState()==="error"){f(new Error("Error accessing data for source "+r.get("mapbox-source")));return}if("getTileGrid"in h){const p=h.getTileGrid();if(p){const y=p.getMinZoom();(s>0||y>0)&&r.setMaxResolution(Math.min(gr(Math.max(0,s-1e-12),it),gr(Math.max(0,y-1e-12),p.getResolutions()))),a<24&&r.setMinResolution(gr(a,it))}}else s>0&&r.setMaxResolution(gr(Math.max(0,s-1e-12),it));h instanceof br||h instanceof kr?ah(r,t,e,Object.assign({styleUrl:n},o)).then(function(){bh(r,i),u()}).catch(f):u()};r.set("mapbox-layers",e);const d=i.getLayers();d.getArray().indexOf(r)===-1&&d.push(r),r.getSource()?c():r.once("change:source",c)})}const Ue=new Uint8Array([102,103,98,3,102,103,98,0]),ut=4,pr=4,hr=4,Lr=4,Tt=new Int32Array(2),Es=new Float32Array(Tt.buffer),Ms=new Float64Array(Tt.buffer),Zr=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Fi;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(Fi||(Fi={}));class ot{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new ot(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Tt[0]=this.readInt32(e),Es[0]}readFloat64(e){return Tt[Zr?0:1]=this.readInt32(e),Tt[Zr?1:0]=this.readInt32(e+4),Ms[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Es[0]=t,this.writeInt32(e,Tt[0])}writeFloat64(e,t){Ms[0]=t,this.writeInt32(e,Tt[Zr?0:1]),this.writeInt32(e+4,Tt[Zr?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+pr+hr)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<hr;t++)e+=String.fromCharCode(this.readInt8(this.position_+pr+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=pr;const i=this.bytes_.subarray(e,e+n);return t===Fi.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+pr}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=hr)throw new Error("FlatBuffers: file identifier must be length "+hr);for(let t=0;t<hr;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+pr+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const o=e(i);o!==null&&n.push(o)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const o=e(i);o!==null&&n.push(o.unpack())}return n}}var H,xe=((H={})[H.Byte=0]="Byte",H[H.UByte=1]="UByte",H[H.Bool=2]="Bool",H[H.Short=3]="Short",H[H.UShort=4]="UShort",H[H.Int=5]="Int",H[H.UInt=6]="UInt",H[H.Long=7]="Long",H[H.ULong=8]="ULong",H[H.Float=9]="Float",H[H.Double=10]="Double",H[H.String=11]="String",H[H.Json=12]="Json",H[H.DateTime=13]="DateTime",H[H.Binary=14]="Binary",H);class me{constructor(){q(this,"bb",null);q(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new me).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Lr),(t||new me).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):xe.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,xe.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,o,s,a,l,u,f,c,d){return me.startColumn(e),me.addName(e,t),me.addType(e,n),me.addTitle(e,i),me.addDescription(e,o),me.addWidth(e,s),me.addPrecision(e,a),me.addScale(e,l),me.addNullable(e,u),me.addUnique(e,f),me.addPrimaryKey(e,c),me.addMetadata(e,d),me.endColumn(e)}}var $,Te=(($={})[$.Unknown=0]="Unknown",$[$.Point=1]="Point",$[$.LineString=2]="LineString",$[$.Polygon=3]="Polygon",$[$.MultiPoint=4]="MultiPoint",$[$.MultiLineString=5]="MultiLineString",$[$.MultiPolygon=6]="MultiPolygon",$[$.GeometryCollection=7]="GeometryCollection",$[$.CircularString=8]="CircularString",$[$.CompoundCurve=9]="CompoundCurve",$[$.CurvePolygon=10]="CurvePolygon",$[$.MultiCurve=11]="MultiCurve",$[$.MultiSurface=12]="MultiSurface",$[$.Curve=13]="Curve",$[$.Surface=14]="Surface",$[$.PolyhedralSurface=15]="PolyhedralSurface",$[$.TIN=16]="TIN",$[$.Triangle=17]="Triangle",$);class Ee{constructor(){q(this,"bb",null);q(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Ee).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Lr),(t||new Ee).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Te.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Ee).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Te.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,o,s,a,l,u){return Ee.startGeometry(e),Ee.addEnds(e,t),Ee.addXy(e,n),Ee.addZ(e,i),Ee.addM(e,o),Ee.addT(e,s),Ee.addTm(e,a),Ee.addType(e,l),Ee.addParts(e,u),Ee.endGeometry(e)}}class He{constructor(){q(this,"bb",null);q(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new He).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Lr),(t||new He).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new Ee).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new me).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return He.startFeature(e),He.addGeometry(e,t),He.addProperties(e,n),He.addColumns(e,i),He.endFeature(e)}}function ui(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let Cs=new TextDecoder;function wh(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),o=r.propertiesLength(),s=0;for(;s<o;){let a=i.getUint16(s,!0);s+=2;let l=e[a],u=l.name;switch(l.type){case xe.Bool:t[u]=!!i.getUint8(s),s+=1;break;case xe.Byte:t[u]=i.getInt8(s),s+=1;break;case xe.UByte:t[u]=i.getUint8(s),s+=1;break;case xe.Short:t[u]=i.getInt16(s,!0),s+=2;break;case xe.UShort:t[u]=i.getUint16(s,!0),s+=2;break;case xe.Int:t[u]=i.getInt32(s,!0),s+=4;break;case xe.UInt:t[u]=i.getUint32(s,!0),s+=4;break;case xe.Long:t[u]=Number(i.getBigInt64(s,!0)),s+=8;break;case xe.ULong:t[u]=Number(i.getBigUint64(s,!0)),s+=8;break;case xe.Float:t[u]=i.getFloat32(s,!0),s+=4;break;case xe.Double:t[u]=i.getFloat64(s,!0),s+=8;break;case xe.DateTime:case xe.String:{let f=i.getUint32(s,!0);s+=4,t[u]=Cs.decode(n.subarray(s,s+f)),s+=f;break}case xe.Json:{let f=i.getUint32(s,!0);s+=4;let c=Cs.decode(n.subarray(s,s+f));t[u]=JSON.parse(c),s+=f;break}case xe.Binary:{let f=i.getUint32(s,!0);s+=4,t[u]=n.subarray(s,s+f),s+=f;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const So=new Uint8Array(0);function xh(){return this._source.cancel()}function _h(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Th(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=So,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:_h(e,t.value)}})}function Sh(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(o){return o.done?(e._array=So,e._index=0,t>0?n.subarray(0,t):null):t+o.value.length>=r?(e._array=o.value,e._index=r-t,n.set(o.value.subarray(0,r-t),t),n):(n.set(o.value,t),t+=o.value.length,i())})}()}function Ih(r){return typeof r.slice=="function"?r:new jn(typeof r.read=="function"?r:r.getReader())}function jn(r){this._source=r,this._array=So,this._index=0}jn.prototype.read=Th;jn.prototype.slice=Sh;jn.prototype.cancel=xh;class Ze{constructor(){q(this,"bb",null);q(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Ze).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Lr),(t||new Ze).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,o,s,a){return Ze.startCrs(e),Ze.addOrg(e,t),Ze.addCode(e,n),Ze.addName(e,i),Ze.addDescription(e,o),Ze.addWkt(e,s),Ze.addCodeString(e,a),Ze.endCrs(e)}}class dn{constructor(){q(this,"bb",null);q(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new dn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Lr),(t||new dn).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Te.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new me).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Ze).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Te.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function Un(r){let e=dn.getSizePrefixedRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let o=e.crs(),s=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:e.envelopeLength()>0?e.envelopeArray():null,featuresCount:Number(t),indexNodeSize:n,crs:s,title:e.title(),description:e.description(),metadata:e.metadata()}}const gn=class gn{constructor(){q(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};q(gn,"global",new gn);let pn=gn;const Ph=40,Ah=16;function $n(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function Eh(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let o=[];for(let a of(t=n,i))o.push(t-a),t-=a;let s=[];for(let a=0;a<i.length;a++)s.push([o[a],o[a]+i[a]]);return s}async function*nl(r,e,t,n){class i{constructor(h,p){q(this,"_level");q(this,"nodes");this._level=p,this.nodes=h}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(h){this.nodes[1]=h}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:o,minY:s,maxX:a,maxY:l}=t,u=Eh(r,e),f=u[0][0],c=[new i([0,1],u.length-1)];for(;c.length!==0;){let d=c.shift(),h=d.startNodeIdx(),p=h>=f,y=(()=>{let[,x]=u[d.level()],g=Math.min(d.endNodeIdx()+e,x);return p&&g<x?g+1:g})(),m=y-h,v=new DataView(await n(40*h,40*m));for(let x=h;x<y;x++){let g=x-h,O=40*g;if(a<v.getFloat64(O+0,!0)||l<v.getFloat64(O+8,!0)||o>v.getFloat64(O+16,!0)||s>v.getFloat64(O+24,!0))continue;let A=v.getBigUint64(O+32,!0);if(p){let S=(()=>{if(x<r-1){let _=(g+1)*40;return v.getBigUint64(_+32,!0)-A}return null})(),k=x-f;yield[Number(A),k,Number(S)];continue}let z=pn.global.extraRequestThreshold()/40,w=c[c.length-1];if(w!==void 0&&w.level()===d.level()-1&&A<w.endNodeIdx()+z){w.extendEndNodeIdx(Number(A));continue}let P=(()=>{let S=d.level()-1;return new i([Number(A),Number(A)+1],S)})();w!==void 0&&(w.level(),P.level()),c.push(P)}}}class Io{constructor(e,t,n,i){q(this,"bytes");q(this,"header");q(this,"headerLength");q(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=n,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((s,a)=>Ue[a]===s))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(Ue.length,!0);if(t>10485760||t<8)throw Error("Invalid header size");let n=e.subarray(Ue.length,Ue.length+ut+t),i=Un(new ot(n)),o=$n(i.featuresCount,i.indexNodeSize);return new Io(e,i,t,o)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=async(i,o)=>{let s=t+i;return this.bytes.slice(s,s+o).buffer};for await(let i of nl(this.header.featuresCount,this.header.indexNodeSize,e,n)){let[o,s]=i,a=this.readFeature(o);yield{id:s,feature:a}}}lengthBeforeTree(){return Ue.length+ut+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),n=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+n),o=new Uint8Array(n+ut);o.set(i,ut);let s=new ot(o);return He.getSizePrefixedRootAsFeature(s)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var zi=function(r,e){return zi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},zi(r,e)};function Mh(r,e){zi(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function rr(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(f){try{u(n.next(f))}catch(c){s(c)}}function l(f){try{u(n.throw(f))}catch(c){s(c)}}function u(f){f.done?o(f.value):i(f.value).then(a,l)}u((n=n.apply(r,[])).next())})}function Pt(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function ar(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cr(r){return this instanceof Cr?(this.v=r,this):new Cr(r)}function Ch(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(d){n[d]&&(i[d]=function(h){return new Promise(function(p,y){o.push([d,h,p,y])>1||a(d,h)})})}function a(d,h){try{l(n[d](h))}catch(p){c(o[0][3],p)}}function l(d){d.value instanceof Cr?Promise.resolve(d.value.v).then(u,f):c(o[0][2],d)}function u(d){a("next",d)}function f(d){a("throw",d)}function c(d,h){d(h),o.shift(),o.length&&a(o[0][0],o[0][1])}}var il=function(r){Mh(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();function Oi(r){r!=null&&typeof r.then=="function"&&r.then(mn,mn)}var ci=0,ks=1,$t=2,hn=3,Ri=4,yn=1024,mn=function(){};function Qt(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function Ft(r,e){var t=r.state>=hn;return Promise.resolve(e).then(function(n){return!t&&r.state>=Ri?Qt(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function Po(r,e){var t,n;if(!(r.state>=$t))if(r.state=$t,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))xr(r);else try{for(var i=ar(r.pushes),o=i.next();!o.done;o=i.next()){var s=o.value;s.resolve()}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function xr(r){var e,t;if(!(r.state>=hn)){r.state<$t&&Po(r),r.state=hn,r.buffer=void 0;try{for(var n=ar(r.nexts),i=n.next();!i.done;i=n.next()){var o=i.value,s=r.pending===void 0?Qt(r):r.pending.then(function(){return Qt(r)});o.resolve(Ft(r,s))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function Fs(r){r.state>=Ri||(r.state<hn&&xr(r),r.state=Ri)}function kh(r,e){if(Oi(e),r.pushes.length>=yn)throw new il("No more than "+yn+" pending calls to push are allowed on a single repeater.");if(r.state>=$t)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(l){r.state<$t&&(r.err=l),Fs(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Ft(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(l){return r.onnext=l})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(l){return r.pushes.push({resolve:l,value:t})});var o=!0,s={},a=n.catch(function(l){if(o)throw l});return s.then=function(l,u){return o=!1,Promise.prototype.then.call(n,l,u)},s.catch=function(l){return o=!1,Promise.prototype.catch.call(n,l)},s.finally=n.finally.bind(n),r.pending=t.then(function(){return a}).catch(function(l){r.err=l,Fs(r)}),s}function Fh(r){var e=Po.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function zh(r){if(!(r.state>=ks)){r.state=ks;var e=kh.bind(null,r),t=Fh(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return Po(r)})}}var Hr=new WeakMap,Nr=function(){function r(e,t){Hr.set(this,{executor:e,buffer:t,err:void 0,state:ci,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:mn,onstop:mn})}return r.prototype.next=function(e){Oi(e);var t=Hr.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=yn)throw new il("No more than "+yn+" pending calls to next are allowed on a single repeater.");if(t.state<=ci&&zh(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=Ft(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var o=t.pushes.shift();return t.onnext=o.resolve,Ft(t,o.value)}else if(t.state>=$t)return xr(t),Ft(t,Qt(t));return new Promise(function(s){return t.nexts.push({resolve:s,value:e})})},r.prototype.return=function(e){Oi(e);var t=Hr.get(this);if(t===void 0)throw new Error("WeakMap error");return xr(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),Ft(t,Qt(t))},r.prototype.throw=function(e){var t=Hr.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=ci||t.state>=$t||typeof t.buffer<"u"&&!t.buffer.empty?(xr(t),t.err==null&&(t.err=e),Ft(t,Qt(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=Oh,r.merge=Rh,r.zip=Lh,r.latest=Nh,r}();function Dn(r,e){var t,n,i=[],o=function(u){u!=null&&typeof u[Symbol.asyncIterator]=="function"?i.push(u[Symbol.asyncIterator]()):u!=null&&typeof u[Symbol.iterator]=="function"?i.push(u[Symbol.iterator]()):i.push(function(){return Ch(this,arguments,function(){return Pt(this,function(d){switch(d.label){case 0:return e.yieldValues?[4,Cr(u)]:[3,3];case 1:return[4,d.sent()];case 2:d.sent(),d.label=3;case 3:return e.returnValues?[4,Cr(u)]:[3,5];case 4:return[2,d.sent()];case 5:return[2]}})})}())};try{for(var s=ar(r),a=s.next();!a.done;a=s.next()){var l=a.value;o(l)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}function Oh(r){var e=this,t=Dn(r,{returnValues:!0});return new Nr(function(n,i){return rr(e,void 0,void 0,function(){var o,s,a,l,u,f;return Pt(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2];s=!1,i.then(function(){o(),s=!0}),c.label=1;case 1:c.trys.push([1,,5,7]),l=void 0,u=0,f=function(){var d,h,p,y,m,v;return Pt(this,function(x){switch(x.label){case 0:d=u;try{for(h=(m=void 0,ar(t)),p=h.next();!p.done;p=h.next())y=p.value,Promise.resolve(y.next()).then(function(g){g.done?(i(),a===void 0&&(a=g)):u===d&&(u++,o(g))},function(g){return i(g)})}catch(g){m={error:g}}finally{try{p&&!p.done&&(v=h.return)&&v.call(h)}finally{if(m)throw m.error}}return[4,new Promise(function(g){return o=g})];case 1:return l=x.sent(),l===void 0?[3,3]:[4,n(l.value)];case 2:x.sent(),x.label=3;case 3:return[2]}})},c.label=2;case 2:return s?[3,4]:[5,f()];case 3:return c.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(d){return d.return&&d.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}function Rh(r){var e=this,t=Dn(r,{yieldValues:!0});return new Nr(function(n,i){return rr(e,void 0,void 0,function(){var o,s,a,l=this;return Pt(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2];o=[],s=!1,i.then(function(){var f,c;s=!0;try{for(var d=ar(o),h=d.next();!h.done;h=d.next()){var p=h.value;p()}}catch(y){f={error:y}}finally{try{h&&!h.done&&(c=d.return)&&c.call(d)}finally{if(f)throw f.error}}}),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,Promise.all(t.map(function(f,c){return rr(l,void 0,void 0,function(){var d,h;return Pt(this,function(p){switch(p.label){case 0:p.trys.push([0,,6,9]),p.label=1;case 1:return s?[3,5]:(Promise.resolve(f.next()).then(function(y){return o[c](y)},function(y){return i(y)}),[4,new Promise(function(y){o[c]=y})]);case 2:return d=p.sent(),d===void 0?[3,4]:d.done?(a=d,[2]):[4,n(d.value)];case 3:p.sent(),p.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return h=f.return,h?[4,f.return()]:[3,8];case 7:h=p.sent(),p.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return u.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function Lh(r){var e=this,t=Dn(r,{returnValues:!0});return new Nr(function(n,i){return rr(e,void 0,void 0,function(){var o,s,a,l;return Pt(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2,[]];s=!1,i.then(function(){o(),s=!0}),u.label=1;case 1:u.trys.push([1,,6,8]),u.label=2;case 2:return s?[3,5]:(Promise.all(t.map(function(f){return f.next()})).then(function(f){return o(f)},function(f){return i(f)}),[4,new Promise(function(f){return o=f})]);case 3:return a=u.sent(),a===void 0?[2]:(l=a.map(function(f){return f.value}),a.some(function(f){return f.done})?[2,l]:[4,n(l)]);case 4:return u.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 7:return u.sent(),[7];case 8:return[2]}})})})}function Nh(r){var e=this,t=Dn(r,{yieldValues:!0,returnValues:!0});return new Nr(function(n,i){return rr(e,void 0,void 0,function(){var o,s,a,l,u,f=this;return Pt(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2,[]];s=[],a=!1,i.then(function(){var d,h;o();try{for(var p=ar(s),y=p.next();!y.done;y=p.next()){var m=y.value;m()}}catch(v){d={error:v}}finally{try{y&&!y.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}a=!0}),c.label=1;case 1:return c.trys.push([1,,5,7]),Promise.all(t.map(function(d){return d.next()})).then(function(d){return o(d)},function(d){return i(d)}),[4,new Promise(function(d){return o=d})];case 2:return l=c.sent(),l===void 0?[2]:(u=l.map(function(d){return d.value}),l.every(function(d){return d.done})?[2,u]:[4,n(u.slice())]);case 3:return c.sent(),[4,Promise.all(t.map(function(d,h){return rr(f,void 0,void 0,function(){var p;return Pt(this,function(y){switch(y.label){case 0:if(l[h].done)return[2,l[h].value];y.label=1;case 1:return a?[3,4]:(Promise.resolve(d.next()).then(function(m){return s[h](m)},function(m){return i(m)}),[4,new Promise(function(m){return s[h]=m})]);case 2:return p=y.sent(),p===void 0?[2,l[h].value]:p.done?[2,p.value]:(u[h]=p.value,[4,n(u.slice())]);case 3:return y.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,c.sent()];case 5:return i(),[4,Promise.all(t.map(function(d){return d.return&&d.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}class Ao{constructor(e,t,n,i,o,s={}){q(this,"headerClient");q(this,"header");q(this,"headerLength");q(this,"indexLength");q(this,"nocache");q(this,"headers");this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=o,this.headers=s}static async open(e,t,n={}){let i,o=new zs(e,t,n),s=2024+(()=>{let f,c=0;for(f=0;f<3;f++)c+=Ah**f*Ph;return c})();if(!new Uint8Array(await o.getRange(0,8,s,"header")).subarray(0,3).every((f,c)=>Ue[c]===f))throw Error("Not a FlatGeobuf file");if((i=new DataView(await o.getRange(8,4,s,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await o.getRange(Ue.length,ut+i,s,"header"),l=Un(new ot(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let u=$n(l.featuresCount,l.indexNodeSize);return new Ao(o,l,i,u,t,n)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(l,u)=>n.getRange(t+l,u,0,"index"),o=[],s=[];for await(let l of nl(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[u,f]=l,[,,c]=l;if(c||(c=4),s.length===0){s.push([u,c,f]);continue}let d=s[s.length-1];u-(d[0]+d[1])>pn.global.extraRequestThreshold()&&(o.push(s),s=[]),s.push([u,c,f])}this.headerClient.logUsage("header+index"),s.length>0&&o.push(s);let a=o.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*Nr.merge(a)}lengthBeforeTree(){return Ue.length+ut+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new zs(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[n]=e[0],[i,o]=e[e.length-1],s=this.buildFeatureClient(t),a=i+o-n;for(let[l,,u]of e){let f=await this.readFeature(s,l,a);yield{id:u,feature:f},a=0}s.logUsage("feature")}async readFeature(e,t,n){let i,o=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(o,4,n,"feature length")).getUint32(0,!0);let s=new Uint8Array(await e.getRange(o+4,i,n,"feature data")),a=new Uint8Array(i+ut);a.set(s,ut);let l=new ot(a);return He.getSizePrefixedRootAsFeature(l)}}class zs{constructor(e,t,n={}){q(this,"httpClient");q(this,"bytesEverUsed",0);q(this,"bytesEverFetched",0);q(this,"buffer",new ArrayBuffer(0));q(this,"head",0);if(typeof e=="string")this.httpClient=new Os(e,t,n);else if(e instanceof Os)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let o=e-this.head,s=o+t;if(o>=0&&s<=this.buffer.byteLength)return this.buffer.slice(o,s);let a=Math.max(t,n);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Os{constructor(e,t,n={}){q(this,"url");q(this,"nocache");q(this,"headers");q(this,"requestsEverMade",0);q(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=n}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,o=new Headers(this.headers);return o.set("Range",i),this.nocache&&o.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:o})).arrayBuffer()}}async function*jh(r,e,t,n){if(!r.subarray(0,3).every((c,d)=>Ue[d]===c))throw Error("Not a FlatGeobuf file");if(t){let c=Io.open(r);for await(let d of c.selectBbox(t))yield e(d.id,d.feature,c.header);return}let i=new ot(r),o=i.readUint32(Ue.length);i.setPosition(Ue.length);let s=Un(i),a=Ue.length+ut+o,{indexNodeSize:l,featuresCount:u}=s;l>0&&(a+=$n(u,l));let f=0;for(;a<i.capacity();){let c=i.readUint32(a);i.setPosition(a);let d=He.getSizePrefixedRootAsFeature(i);yield e(f++,d,s),a+=ut+c}}async function*Uh(r,e,t){let n,i=Ih(r),o=async y=>await i.slice(y),s=new Uint8Array(await o(8));if(!s.subarray(0,3).every((y,m)=>Ue[m]===y))throw Error("Not a FlatGeobuf file");let a=new Uint8Array(await o(4)),l=new ot(a),u=l.readUint32(0),f=new Uint8Array(await o(u));(s=new Uint8Array(a.length+f.length)).set(a),s.set(f,a.length);let c=Un(l=new ot(s)),{indexNodeSize:d,featuresCount:h}=c;if(d>0){let y=$n(h,d);await o(y)}let p=0;for(;n=await Dh(o,c,e,p++);)yield n}async function*$h(r,e,t,n,i=!1,o={}){let s=await Ao.open(r,i,o);for await(let a of s.selectBbox(e))yield t(a.id,a.feature,s.header)}async function Dh(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let o=new ot(i),s=o.readUint32(0);i=new Uint8Array(await r(s,"feature data"));let a=new Uint8Array(s+4);return a.set(i,4),o=new ot(a),t(n,He.getSizePrefixedRootAsFeature(o),e)}function Li(r,e){let t=e;if(t===Te.Unknown&&(t=r.type()),t===Te.GeometryCollection){let i=[];for(let o=0;o<r.partsLength();o++){let s=r.parts(o),a=s.type();i.push(Li(s,a))}return{type:Te[t],geometries:i}}if(t===Te.MultiPolygon){let i=[];for(let o=0;o<r.partsLength();o++)i.push(Li(r.parts(o),Te.Polygon));return{type:Te[t],coordinates:i.map(o=>o.coordinates)}}let n=function(i,o){let s=i.xyArray(),a=i.zArray();switch(o){case Te.Point:{let l=Array.from(s);return a&&l.push(a[0]),l}case Te.MultiPoint:case Te.LineString:return ui(s,a);case Te.MultiLineString:case Te.Polygon:return function(l,u,f){let c;if(!f||f.length===0)return[ui(l,u)];let d=0,h=Array.from(f).map(p=>l.slice(d,d=p<<1));return u&&(d=0,c=Array.from(f).map(p=>u.slice(d,d=p))),h.map((p,y)=>ui(p,c?c[y]:void 0))}(s,a,i.endsArray())}}(r,t);return{type:Te[t],coordinates:n}}function Eo(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:Li(e.geometry(),t.geometryType),properties:wh(e,n)}}async function*Bh(r,e,t){yield*jh(r,Eo,e)}function qh(r,e){return Uh(r,Eo)}function Gh(r,e,t,n=!1,i={}){return $h(r,e,Eo,t,n,i)}function ay(r,e,t,n=!1,i={}){return r instanceof Uint8Array?Bh(r,e):r instanceof ReadableStream?qh(r):Gh(r,e,t,n,i)}export{xa as S,sy as a,ay as d};
