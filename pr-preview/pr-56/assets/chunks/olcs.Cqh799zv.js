const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DyYbxgyd.js","assets/chunks/cesium.DzXtLnwn.js","assets/chunks/lzw.9lk_P5pn.js","assets/chunks/jpeg.ChvvgP7W.js","assets/chunks/deflate.kDd4rSQl.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.C0Dum_0_.js","assets/chunks/lerc.B6J91Bdt.js","assets/chunks/webimage.DJeFoGB9.js"])))=>i.map(i=>d[i]);
var Wu=Object.defineProperty;var Ku=(s,e,t)=>e in s?Wu(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var I=(s,e,t)=>Ku(s,typeof e!="symbol"?e+"":e,t);import{q as Hu,g as Sc}from"./cesium.DzXtLnwn.js";const Zu="modulepreload",qu=function(s){return"/pr-preview/pr-56/"+s},dl={},qt=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=qu(l),l in dl)return;dl[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Zu,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((d,g)=>{u.addEventListener("load",d),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},Ut={ADD:"add",REMOVE:"remove"},zo={PROPERTYCHANGE:"propertychange"},ie={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class jo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function $u(s,e,t){let i,n;t=t||ht;let r=0,o=s.length,a=!1;for(;r<o;)i=r+(o-r>>1),n=+t(s[i],e),n<0?r=i+1:(o=i,a=!n);return a?r:~r}function ht(s,e){return s>e?1:s<e?-1:0}function Ju(s,e){return s<e?1:s>e?-1:0}function Qs(s,e,t){if(s[0]<=e)return 0;const i=s.length;if(e<=s[i-1])return i-1;if(typeof t=="function"){for(let n=1;n<i;++n){const r=s[n];if(r===e)return n;if(r<e)return t(e,s[n-1],r)>0?n-1:n}return i-1}if(t>0){for(let n=1;n<i;++n)if(s[n]<e)return n-1;return i-1}if(t<0){for(let n=1;n<i;++n)if(s[n]<=e)return n;return i-1}for(let n=1;n<i;++n){if(s[n]==e)return n;if(s[n]<e)return s[n-1]-e<e-s[n]?n-1:n}return i-1}function Qu(s,e,t){for(;e<t;){const i=s[e];s[e]=s[t],s[t]=i,++e,--t}}function et(s,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let n=0;n<i;n++)s[s.length]=t[n]}function tn(s,e){const t=s.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(s[i]!==e[i])return!1;return!0}function ed(s,e,t){const i=e||ht;return s.every(function(n,r){if(r===0)return!0;const o=i(s[r-1],n);return!(o>0||o===0)})}function td(){return!0}function py(){return!1}function As(){}function Ic(s){let e,t,i;return function(){const n=Array.prototype.slice.call(arguments);return(!t||this!==i||!tn(n,t))&&(i=this,t=n,e=s.apply(this,arguments)),e}}function vc(s){function e(){let t;try{t=s()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function Hn(s){for(const e in s)delete s[e]}function di(s){let e;for(e in s)return!1;return!e}class bt{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class er extends jo{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=t?new bt(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let c=0,h=n.length;c<h;++c)if("handleEvent"in n[c]?l=n[c].handleEvent(r):l=n[c].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let c=a[i];for(delete a[i];c--;)this.removeEventListener(i,As);delete o[i]}return l}disposeInternal(){this.listeners_&&Hn(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=As,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}}function me(s,e,t,i,n){if(n){const o=t;t=function(a){return s.removeEventListener(e,t),o.call(i??this,a)}}else i&&i!==s&&(t=t.bind(i));const r={target:s,type:e,listener:t};return s.addEventListener(e,t),r}function bs(s,e,t,i){return me(s,e,t,i,!0)}function xe(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),Hn(s))}class nn extends er{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ie.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=me(this,e[r],t);return n}return me(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const n=e.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=bs(this,e[r],t)}else i=bs(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)$e(i);else if(Array.isArray(e))for(let n=0,r=e.length;n<r;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}nn.prototype.on;nn.prototype.once;nn.prototype.un;function $e(s){if(Array.isArray(s))for(let e=0,t=s.length;e<t;++e)xe(s[e]);else xe(s)}function $(){throw new Error("Unimplemented abstract method.")}let id=0;function Y(s){return s.ol_uid||(s.ol_uid=String(++id))}class fl extends bt{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class $t extends nn{constructor(e){super(),this.on,this.once,this.un,Y(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new fl(i,e,t)),i=zo.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new fl(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],di(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const gl={LENGTH:"length"};class us extends bt{constructor(e,t,i){super(e),this.element=t,this.index=i}}class fo extends $t{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let i=1,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(gl.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new us(Ut.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new us(Ut.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new us(Ut.REMOVE,n,e)),this.dispatchEvent(new us(Ut.ADD,t,e))}updateLength_(){this.set(gl.LENGTH,this.array_.length)}assertUnique_(e,t){const i=this.array_;for(let n=0,r=i.length;n<r;++n)if(i[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const fi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",nd=fi.includes("safari")&&!fi.includes("chrom"),yy=nd&&(fi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(fi)),xy=fi.includes("webkit")&&!fi.includes("edge"),Ey=fi.includes("macintosh"),sd=typeof devicePixelRatio<"u"?devicePixelRatio:1,It=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Xo=typeof Image<"u"&&Image.prototype.decode,Ac=typeof createImageBitmap=="function",Cy=function(){let s=!1;try{const e=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return s}(),rd={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},D={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function se(s,e){if(!s)throw new Error(e)}const Ls=1/0;class od{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Hn(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){se(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Ls?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,r=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),c=this.getRightChildIndex_(e),h=c<n&&i[c]<i[l]?c:l;t[e]=t[h],i[e]=i[h],e=h}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,r=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=r,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==Ls?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}class ad extends od{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(ie.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===D.LOADED||i===D.ERROR||i===D.EMPTY){i!==D.ERROR&&t.removeEventListener(ie.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const n=this.dequeue()[0],r=n.getKey();n.getState()===D.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,n.load())}}}function wy(s,e,t,i,n){if(!s||!(t in s.wantedTiles)||!s.wantedTiles[t][e.getKey()])return Ls;const r=s.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const ge={ANIMATING:0,INTERACTING:1},qe={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function he(s,e,t){return Math.min(Math.max(s,e),t)}function ld(s,e,t,i,n,r){const o=n-t,a=r-i;if(o!==0||a!==0){const l=((s-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=n,i=r):l>0&&(t+=o*l,i+=a*l)}return ui(s,e,t,i)}function ui(s,e,t,i){const n=t-s,r=i-e;return n*n+r*r}function cd(s){const e=s.length;for(let i=0;i<e;i++){let n=i,r=Math.abs(s[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(s[a][i]);l>r&&(r=l,n=a)}if(r===0)return null;const o=s[n];s[n]=s[i],s[i]=o;for(let a=i+1;a<e;a++){const l=-s[a][i]/s[i][i];for(let c=i;c<e+1;c++)i==c?s[a][c]=0:s[a][c]+=l*s[i][c]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=s[i][e]/s[i][i];for(let n=i-1;n>=0;n--)s[n][e]-=s[n][i]*t[i]}return t}function Ps(s){return s*180/Math.PI}function ut(s){return s*Math.PI/180}function Wt(s,e){const t=s%e;return t*e<0?t+e:t}function Be(s,e,t){return s+t*(e-s)}function Zn(s,e){const t=Math.pow(10,e);return Math.round(s*t)/t}function ml(s,e){return Math.round(Zn(s,e))}function zi(s,e){return Math.floor(Zn(s,e))}function Bt(s,e){return Math.ceil(Zn(s,e))}function go(s,e,t){if(s>=e&&s<t)return s;const i=t-e;return((s-e)%i+i)%i+e}function _l(s,e,t){return function(i,n,r,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:r[0]*n,c=e?0:r[1]*n,h=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+h,g=s[2]-l/2+h,f=s[1]+c/2+u,m=s[3]-c/2+u;d>g&&(d=(g+d)/2,g=d),f>m&&(f=(m+f)/2,m=f);let _=he(i[0],d,g),p=he(i[1],f,m);if(o&&t&&n){const y=30*n;_+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-g)/y),p+=-y*Math.log(1+Math.max(0,f-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-m)/y)}return[_,p]}}function hd(s){return s}const Ce={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Fs(s){const e=Fe();for(let t=0,i=s.length;t<i;++t)Sn(e,s[t]);return e}function ud(s,e,t){const i=Math.min.apply(null,s),n=Math.min.apply(null,e),r=Math.max.apply(null,s),o=Math.max.apply(null,e);return dt(i,n,r,o,t)}function tt(s,e,t){return t?(t[0]=s[0]-e,t[1]=s[1]-e,t[2]=s[2]+e,t[3]=s[3]+e,t):[s[0]-e,s[1]-e,s[2]+e,s[3]+e]}function dd(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s.slice()}function xi(s,e,t){let i,n;return e<s[0]?i=s[0]-e:s[2]<e?i=e-s[2]:i=0,t<s[1]?n=s[1]-t:s[3]<t?n=t-s[3]:n=0,i*i+n*n}function gi(s,e){return Vo(s,e[0],e[1])}function Qe(s,e){return s[0]<=e[0]&&e[2]<=s[2]&&s[1]<=e[1]&&e[3]<=s[3]}function Vo(s,e,t){return s[0]<=e&&e<=s[2]&&s[1]<=t&&t<=s[3]}function mo(s,e){const t=s[0],i=s[1],n=s[2],r=s[3],o=e[0],a=e[1];let l=Ce.UNKNOWN;return o<t?l=l|Ce.LEFT:o>n&&(l=l|Ce.RIGHT),a<i?l=l|Ce.BELOW:a>r&&(l=l|Ce.ABOVE),l===Ce.UNKNOWN&&(l=Ce.INTERSECTING),l}function Fe(){return[1/0,1/0,-1/0,-1/0]}function dt(s,e,t,i,n){return n?(n[0]=s,n[1]=e,n[2]=t,n[3]=i,n):[s,e,t,i]}function qn(s){return dt(1/0,1/0,-1/0,-1/0,s)}function Yo(s,e){const t=s[0],i=s[1];return dt(t,i,t,i,e)}function Wo(s,e,t,i,n){const r=qn(n);return bc(r,s,e,t,i)}function mi(s,e){return s[0]==e[0]&&s[2]==e[2]&&s[1]==e[1]&&s[3]==e[3]}function Ko(s,e){return e[0]<s[0]&&(s[0]=e[0]),e[2]>s[2]&&(s[2]=e[2]),e[1]<s[1]&&(s[1]=e[1]),e[3]>s[3]&&(s[3]=e[3]),s}function Sn(s,e){e[0]<s[0]&&(s[0]=e[0]),e[0]>s[2]&&(s[2]=e[0]),e[1]<s[1]&&(s[1]=e[1]),e[1]>s[3]&&(s[3]=e[1])}function bc(s,e,t,i,n){for(;t<i;t+=n)fd(s,e[t],e[t+1]);return s}function fd(s,e,t){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}function Ho(s,e){let t;return t=e(tr(s)),t||(t=e(ir(s)),t)||(t=e(nr(s)),t)||(t=e(ft(s)),t)?t:!1}function Ln(s){let e=0;return Ei(s)||(e=Z(s)*le(s)),e}function tr(s){return[s[0],s[1]]}function ir(s){return[s[2],s[1]]}function Me(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function gd(s,e){let t;if(e==="bottom-left")t=tr(s);else if(e==="bottom-right")t=ir(s);else if(e==="top-left")t=ft(s);else if(e==="top-right")t=nr(s);else throw new Error("Invalid corner");return t}function Zo(s,e,t,i,n){const[r,o,a,l,c,h,u,d]=Lc(s,e,t,i);return dt(Math.min(r,a,c,u),Math.min(o,l,h,d),Math.max(r,a,c,u),Math.max(o,l,h,d),n)}function Lc(s,e,t,i){const n=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=n*o,c=n*a,h=r*o,u=r*a,d=s[0],g=s[1];return[d-l+u,g-c-h,d-l-u,g-c+h,d+l-u,g+c+h,d+l+u,g+c-h,d-l+u,g-c-h]}function le(s){return s[3]-s[1]}function Ae(s,e,t){const i=t||Fe();return ce(s,e)?(s[0]>e[0]?i[0]=s[0]:i[0]=e[0],s[1]>e[1]?i[1]=s[1]:i[1]=e[1],s[2]<e[2]?i[2]=s[2]:i[2]=e[2],s[3]<e[3]?i[3]=s[3]:i[3]=e[3]):qn(i),i}function ft(s){return[s[0],s[3]]}function nr(s){return[s[2],s[3]]}function Z(s){return s[2]-s[0]}function ce(s,e){return s[0]<=e[2]&&s[2]>=e[0]&&s[1]<=e[3]&&s[3]>=e[1]}function Ei(s){return s[2]<s[0]||s[3]<s[1]}function md(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s}function _d(s,e,t){let i=!1;const n=mo(s,e),r=mo(s,t);if(n===Ce.INTERSECTING||r===Ce.INTERSECTING)i=!0;else{const o=s[0],a=s[1],l=s[2],c=s[3],h=e[0],u=e[1],d=t[0],g=t[1],f=(g-u)/(d-h);let m,_;r&Ce.ABOVE&&!(n&Ce.ABOVE)&&(m=d-(g-c)/f,i=m>=o&&m<=l),!i&&r&Ce.RIGHT&&!(n&Ce.RIGHT)&&(_=g-(d-l)*f,i=_>=a&&_<=c),!i&&r&Ce.BELOW&&!(n&Ce.BELOW)&&(m=d-(g-a)/f,i=m>=o&&m<=l),!i&&r&Ce.LEFT&&!(n&Ce.LEFT)&&(_=g-(d-o)*f,i=_>=a&&_<=c)}return i}function Pc(s,e,t,i){if(Ei(s))return qn(t);let n=[];if(i>1){const a=s[2]-s[0],l=s[3]-s[1];for(let c=0;c<i;++c)n.push(s[0]+a*c/i,s[1],s[2],s[1]+l*c/i,s[2]-a*c/i,s[3],s[0],s[3]-l*c/i)}else n=[s[0],s[1],s[2],s[1],s[2],s[3],s[0],s[3]];e(n,n,2);const r=[],o=[];for(let a=0,l=n.length;a<l;a+=2)r.push(n[a]),o.push(n[a+1]);return ud(r,o,t)}function Fc(s,e){const t=e.getExtent(),i=Me(s);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const n=Z(t),o=Math.floor((i[0]-t[0])/n)*n;s[0]-=o,s[2]-=o}return s}function qo(s,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[i[0],s[1],i[2],s[3]]];Fc(s,e);const n=Z(i);if(Z(s)>n&&!t)return[[i[0],s[1],i[2],s[3]]];if(s[0]<i[0])return[[s[0]+n,s[1],i[2],s[3]],[i[0],s[1],s[2],s[3]]];if(s[2]>i[2])return[[s[0],s[1],i[2],s[3]],[i[0],s[1],s[2]-n,s[3]]]}return[s]}function $o(s,e){const t=(""+s).split("."),i=(""+e).split(".");for(let n=0;n<Math.max(t.length,i.length);n++){const r=parseInt(t[n]||"0",10),o=parseInt(i[n]||"0",10);if(r>o)return 1;if(o>r)return-1}return 0}function Mc(s,e){return s[0]+=+e[0],s[1]+=+e[1],s}function Ms(s,e){let t=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=e[i]){t=!1;break}return t}function pd(s,e){const t=Math.cos(e),i=Math.sin(e),n=s[0]*t-s[1]*i,r=s[1]*t+s[0]*i;return s[0]=n,s[1]=r,s}function yd(s,e){return s[0]*=e,s[1]*=e,s}function xd(s,e){const t=s[0]-e[0],i=s[1]-e[1];return t*t+i*i}function Ty(s,e){return Math.sqrt(xd(s,e))}function Oc(s,e){if(e.canWrapX()){const t=Z(e.getExtent()),i=Ed(s,e,t);i&&(s[0]-=i*t)}return s}function Ed(s,e,t){const i=e.getExtent();let n=0;return e.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(t=t||Z(i),n=Math.floor((s[0]-i[0])/t)),n}function Dc(s){return Math.pow(s,3)}function Cd(s){return 1-Dc(1-s)}function wd(s){return 3*s*s-2*s*s*s}function Td(s){return s}const Gc=63710088e-1;function pl(s,e,t){t=t||Gc;const i=ut(s[1]),n=ut(e[1]),r=(n-i)/2,o=ut(e[0]-s[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Rd(s,e,t,i){i=i||Gc;const n=ut(s[1]),r=ut(s[0]),o=e/i,a=Math.asin(Math.sin(n)*Math.cos(o)+Math.cos(n)*Math.sin(o)*Math.cos(t)),l=r+Math.atan2(Math.sin(t)*Math.sin(o)*Math.cos(n),Math.cos(o)-Math.sin(n)*Math.sin(a));return[Ps(l),Ps(a)]}function Sd(...s){console.warn(...s)}function Ry(...s){console.error(...s)}const Id={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Sy(s){return Id[s]}const Pn={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class sr{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Pn[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const $n=6378137,ji=Math.PI*$n,vd=[-ji,-ji,ji,ji],Ad=[-180,-85,180,85],ds=$n*Math.log(Math.tan(Math.PI/2));class Ai extends sr{constructor(e){super({code:e,units:"m",extent:vd,global:!0,worldExtent:Ad,getPointResolution:function(t,i){return t/Math.cosh(i[1]/$n)}})}}const yl=[new Ai("EPSG:3857"),new Ai("EPSG:102100"),new Ai("EPSG:102113"),new Ai("EPSG:900913"),new Ai("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ai("http://www.opengis.net/gml/srs/epsg.xml#3857")];function bd(s,e,t,i){const n=s.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=s.slice():e=new Array(n));for(let r=0;r<n;r+=i){e[r]=ji*s[r]/180;let o=$n*Math.log(Math.tan(Math.PI*(+s[r+1]+90)/360));o>ds?o=ds:o<-ds&&(o=-ds),e[r+1]=o}return e}function Ld(s,e,t,i){const n=s.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=s.slice():e=new Array(n));for(let r=0;r<n;r+=i)e[r]=180*s[r]/ji,e[r+1]=360*Math.atan(Math.exp(s[r+1]/$n))/Math.PI-90;return e}const Pd=6378137,xl=[-180,-90,180,90],Fd=Math.PI*Pd/180;class ii extends sr{constructor(e,t){super({code:e,units:"degrees",extent:xl,axisOrientation:t,global:!0,metersPerUnit:Fd,worldExtent:xl})}}const El=[new ii("CRS:84"),new ii("EPSG:4326","neu"),new ii("urn:ogc:def:crs:OGC:1.3:CRS84"),new ii("urn:ogc:def:crs:OGC:2:84"),new ii("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ii("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ii("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let _o={};function Md(s){return _o[s]||_o[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Od(s,e){_o[s]=e}let Xi={};function Fn(s,e,t){const i=s.getCode(),n=e.getCode();i in Xi||(Xi[i]={}),Xi[i][n]=t}function Dr(s,e){return s in Xi&&e in Xi[s]?Xi[s][e]:null}const Os=.9996,Ze=.00669438,rr=Ze*Ze,or=rr*Ze,oi=Ze/(1-Ze),Cl=Math.sqrt(1-Ze),Zi=(1-Cl)/(1+Cl),kc=Zi*Zi,Jo=kc*Zi,Qo=Jo*Zi,Nc=Qo*Zi,Uc=1-Ze/4-3*rr/64-5*or/256,Dd=3*Ze/8+3*rr/32+45*or/1024,Gd=15*rr/256+45*or/1024,kd=35*or/3072,Nd=3/2*Zi-27/32*Jo+269/512*Nc,Ud=21/16*kc-55/32*Qo,Bd=151/96*Jo-417/128*Nc,zd=1097/512*Qo,Ds=6378137;function jd(s,e,t){const i=s-5e5,o=(t.north?e:e-1e7)/Os/(Ds*Uc),a=o+Nd*Math.sin(2*o)+Ud*Math.sin(4*o)+Bd*Math.sin(6*o)+zd*Math.sin(8*o),l=Math.sin(a),c=l*l,h=Math.cos(a),u=l/h,d=u*u,g=d*d,f=1-Ze*c,m=Math.sqrt(1-Ze*c),_=Ds/m,p=(1-Ze)/f,y=oi*h**2,x=y*y,E=i/(_*Os),C=E*E,w=C*E,R=w*E,T=R*E,S=T*E,v=a-u/p*(C/2-R/24*(5+3*d+10*y-4*x-9*oi))+S/720*(61+90*d+298*y+45*g-252*oi-3*x);let G=(E-w/6*(1+2*d+y)+T/120*(5-2*y+28*d-3*x+8*oi+24*g))/h;return G=go(G+ut(Bc(t.number)),-Math.PI,Math.PI),[Ps(G),Ps(v)]}const wl=-80,Tl=84,Xd=-180,Vd=180;function Yd(s,e,t){s=go(s,Xd,Vd),e<wl?e=wl:e>Tl&&(e=Tl);const i=ut(e),n=Math.sin(i),r=Math.cos(i),o=n/r,a=o*o,l=a*a,c=ut(s),h=Bc(t.number),u=ut(h),d=Ds/Math.sqrt(1-Ze*n**2),g=oi*r**2,f=r*go(c-u,-Math.PI,Math.PI),m=f*f,_=m*f,p=_*f,y=p*f,x=y*f,E=Ds*(Uc*i-Dd*Math.sin(2*i)+Gd*Math.sin(4*i)-kd*Math.sin(6*i)),C=Os*d*(f+_/6*(1-a+g)+y/120*(5-18*a+l+72*g-58*oi))+5e5;let w=Os*(E+d*o*(m/2+p/24*(5-a+9*g+4*g**2)+x/720*(61-58*a+l+600*g-330*oi)));return t.north||(w+=1e7),[C,w]}function Bc(s){return(s-1)*6-180+3}const Wd=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function zc(s){let e=0;for(const n of Wd){const r=s.match(n);if(r){e=parseInt(r[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function Rl(s,e){return function(t,i,n,r){const o=t.length;n=n>1?n:2,r=r??n,i||(n>2?i=t.slice():i=new Array(o));for(let a=0;a<o;a+=r){const l=t[a],c=t[a+1],h=s(l,c,e);i[a]=h[0],i[a+1]=h[1]}return i}}function Kd(s){return zc(s)?new sr({code:s,units:"m"}):null}function Hd(s){const e=zc(s.getCode());return e?{forward:Rl(Yd,e),inverse:Rl(jd,e)}:null}const Zd=[Hd],qd=[Kd];let po=!0;function jc(s){po=!1}function ea(s,e){if(e!==void 0){for(let t=0,i=s.length;t<i;++t)e[t]=s[t];e=e}else e=s.slice();return e}function yo(s){Od(s.getCode(),s),Fn(s,s,ea)}function $d(s){s.forEach(yo)}function H(s){if(typeof s!="string")return s;const e=Md(s);if(e)return e;for(const t of qd){const i=t(s);if(i)return i}return null}function Sl(s,e,t,i){s=H(s);let n;const r=s.getPointResolutionFunc();if(r){if(n=r(e,t),i&&i!==s.getUnits()){const o=s.getMetersPerUnit();o&&(n=n*o/Pn[i])}}else{const o=s.getUnits();if(o=="degrees"&&!i||i=="degrees")n=e;else{const a=Jn(s,H("EPSG:4326"));if(!a&&o!=="degrees")n=e*s.getMetersPerUnit();else{let c=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];c=a(c,c,2);const h=pl(c.slice(0,2),c.slice(2,4)),u=pl(c.slice(4,6),c.slice(6,8));n=(h+u)/2}const l=i?Pn[i]:s.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Il(s){$d(s),s.forEach(function(e){s.forEach(function(t){e!==t&&Fn(e,t,ea)})})}function Jd(s,e,t,i){s.forEach(function(n){e.forEach(function(r){Fn(n,r,t),Fn(r,n,i)})})}function ta(s,e){return s?typeof s=="string"?H(s):s:H(e)}function Qd(s){return function(e,t,i,n){const r=e.length;i=i!==void 0?i:2,n=n??i,t=t!==void 0?t:new Array(r);for(let o=0;o<r;o+=n){const a=s(e.slice(o,o+i)),l=a.length;for(let c=0,h=n;c<h;++c)t[o+c]=c>=l?e[o+c]:a[c]}return t}}function Iy(s,e){return jc(),Ci(s,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function vy(s,e){const t=Ci(s,"EPSG:3857","EPSG:4326"),i=t[0];return(i<-180||i>180)&&(t[0]=Wt(i+180,360)-180),t}function de(s,e){if(s===e)return!0;const t=s.getUnits()===e.getUnits();return(s.getCode()===e.getCode()||Jn(s,e)===ea)&&t}function Jn(s,e){const t=s.getCode(),i=e.getCode();let n=Dr(t,i);if(n)return n;let r=null,o=null;for(const l of Zd)r||(r=l(s)),o||(o=l(e));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)n=Gr(r.inverse,o.forward);else{const l=Dr(t,a);l&&(n=Gr(l,o.forward))}else{const l=Dr(a,i);l&&(n=Gr(r.inverse,l))}return n&&(yo(s),yo(e),Fn(s,e,n)),n}function Gr(s,e){return function(t,i,n,r){return i=s(t,i,n,r),e(i,i,n,r)}}function gt(s,e){const t=H(s),i=H(e);return Jn(t,i)}function Ci(s,e,t){const i=gt(e,t);if(!i){const n=H(e).getCode(),r=H(t).getCode();throw new Error(`No transform available between ${n} and ${r}`)}return i(s,void 0,s.length)}function Vi(s,e,t,i){const n=gt(e,t);return Pc(s,n,void 0,i)}let ef=null;function tf(){return ef}function vl(s,e){return s}function Ft(s,e){return po&&!Ms(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(po=!1,Sd("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function ia(s,e){return s}function at(s,e){return s}function nf(){Il(yl),Il(El),Jd(El,yl,bd,Ld)}nf();const na=new Array(6);function je(){return[1,0,0,1,0,0]}function Al(s){return lr(s,1,0,0,1,0,0)}function ar(s,e){const t=s[0],i=s[1],n=s[2],r=s[3],o=s[4],a=s[5],l=e[0],c=e[1],h=e[2],u=e[3],d=e[4],g=e[5];return s[0]=t*l+n*c,s[1]=i*l+r*c,s[2]=t*h+n*u,s[3]=i*h+r*u,s[4]=t*d+n*g+o,s[5]=i*d+r*g+a,s}function lr(s,e,t,i,n,r,o){return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s}function sf(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s}function we(s,e){const t=e[0],i=e[1];return e[0]=s[0]*t+s[2]*i+s[4],e[1]=s[1]*t+s[3]*i+s[5],e}function Ay(s,e){const t=Math.cos(e),i=Math.sin(e);return ar(s,lr(na,t,i,-i,t,0,0))}function Ss(s,e,t){return ar(s,lr(na,e,0,0,t,0,0))}function rf(s,e,t){return ar(s,lr(na,1,0,0,1,e,t))}function vt(s,e,t,i,n,r,o,a){const l=Math.sin(r),c=Math.cos(r);return s[0]=i*c,s[1]=n*l,s[2]=-i*l,s[3]=n*c,s[4]=o*i*c-a*i*l+e,s[5]=o*n*l+a*n*c+t,s}function of(s,e){const t=af(e);se(t!==0,"Transformation matrix cannot be inverted");const i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return s[0]=o/t,s[1]=-n/t,s[2]=-r/t,s[3]=i/t,s[4]=(r*l-o*a)/t,s[5]=-(i*l-n*a)/t,s}function af(s){return s[0]*s[3]-s[1]*s[2]}const lf=[1e5,1e5,1e5,1e5,2,2];function cf(s){return"matrix("+s.join(", ")+")"}function bl(s){return s.substring(7,s.length-1).split(",").map(parseFloat)}function hf(s,e){const t=bl(s),i=bl(e);for(let n=0;n<6;++n)if(Math.round((t[n]-i[n])*lf[n])!==0)return!1;return!0}function Kt(s,e,t,i,n,r,o){r=r||[],o=o||2;let a=0;for(let l=e;l<t;l+=i){const c=s[l],h=s[l+1];r[a++]=n[0]*c+n[2]*h+n[4],r[a++]=n[1]*c+n[3]*h+n[5];for(let u=2;u<o;u++)r[a++]=s[l+u]}return r&&r.length!=a&&(r.length=a),r}function sa(s,e,t,i,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),c=r[0],h=r[1];let u=0;for(let d=e;d<t;d+=i){const g=s[d]-c,f=s[d+1]-h;o[u++]=c+g*a-f*l,o[u++]=h+g*l+f*a;for(let m=d+2;m<d+i;++m)o[u++]=s[m]}return o&&o.length!=u&&(o.length=u),o}function uf(s,e,t,i,n,r,o,a){a=a||[];const l=o[0],c=o[1];let h=0;for(let u=e;u<t;u+=i){const d=s[u]-l,g=s[u+1]-c;a[h++]=l+n*d,a[h++]=c+r*g;for(let f=u+2;f<u+i;++f)a[h++]=s[f]}return a&&a.length!=h&&(a.length=h),a}function df(s,e,t,i,n,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=s[l]+n,o[a++]=s[l+1]+r;for(let c=l+2;c<l+i;++c)o[a++]=s[c]}return o&&o.length!=a&&(o.length=a),o}const Ll=je(),ff=[NaN,NaN];class Gs extends $t{constructor(){super(),this.extent_=Fe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ic((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return $()}closestPointXY(e,t,i,n){return $()}containsXY(e,t){return this.closestPointXY(e,t,ff,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return $()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&qn(t),this.extentRevision_=this.getRevision()}return md(this.extent_,e)}rotate(e,t){$()}scale(e,t,i){$()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return $()}getType(){return $()}applyTransform(e){$()}intersectsExtent(e){return $()}translate(e,t){$()}transform(e,t){const i=H(e),n=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),c=i.getWorldExtent(),h=le(c)/le(l);vt(Ll,c[0],c[3],h,-h,0,0,0);const u=Kt(r,0,r.length,a,Ll,o),d=gt(i,t);return d?d(u,u,a):u}:gt(i,t);return this.applyTransform(n),this}}class Lt extends Gs{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return $()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Pl(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){$()}setLayout(e,t,i){let n;if(e)n=Pl(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}n=t.length,e=gf(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();sa(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Me(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();uf(n,0,n.length,r,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();df(i,0,i.length,n,e,t,i),this.changed()}}}function gf(s){let e;return s==2?e="XY":s==3?e="XYZ":s==4&&(e="XYZM"),e}function Pl(s){let e;return s=="XY"?e=2:s=="XYZ"||s=="XYM"?e=3:s=="XYZM"&&(e=4),e}function mf(s,e,t){const i=s.getFlatCoordinates();if(!i)return null;const n=s.getStride();return Kt(i,0,i.length,n,e,t)}function Xc(s,e,t,i){let n=0;const r=s[t-i],o=s[t-i+1];let a=0,l=0;for(;e<t;e+=i){const c=s[e]-r,h=s[e+1]-o;n+=l*c-a*h,a=c,l=h}return n/2}function Vc(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=Xc(s,e,a,i),e=a}return n}function _f(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=Vc(s,e,a,i),e=a[a.length-1]}return n}function Fl(s,e,t,i,n,r,o){const a=s[e],l=s[e+1],c=s[t]-a,h=s[t+1]-l;let u;if(c===0&&h===0)u=e;else{const d=((n-a)*c+(r-l)*h)/(c*c+h*h);if(d>1)u=t;else if(d>0){for(let g=0;g<i;++g)o[g]=Be(s[e+g],s[t+g],d);o.length=i;return}else u=e}for(let d=0;d<i;++d)o[d]=s[u+d];o.length=i}function ra(s,e,t,i,n){let r=s[e],o=s[e+1];for(e+=i;e<t;e+=i){const a=s[e],l=s[e+1],c=ui(r,o,a,l);c>n&&(n=c),r=a,o=l}return n}function oa(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=ra(s,e,a,i,n),e=a}return n}function pf(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=oa(s,e,a,i,n),e=a[a.length-1]}return n}function aa(s,e,t,i,n,r,o,a,l,c,h){if(e==t)return c;let u,d;if(n===0){if(d=ui(o,a,s[e],s[e+1]),d<c){for(u=0;u<i;++u)l[u]=s[e+u];return l.length=i,d}return c}h=h||[NaN,NaN];let g=e+i;for(;g<t;)if(Fl(s,g-i,g,i,o,a,h),d=ui(o,a,h[0],h[1]),d<c){for(c=d,u=0;u<i;++u)l[u]=h[u];l.length=i,g+=i}else g+=i*Math.max((Math.sqrt(d)-Math.sqrt(c))/n|0,1);if(r&&(Fl(s,t-i,e,i,o,a,h),d=ui(o,a,h[0],h[1]),d<c)){for(c=d,u=0;u<i;++u)l[u]=h[u];l.length=i}return c}function la(s,e,t,i,n,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];c=aa(s,e,g,i,n,r,o,a,l,c,h),e=g}return c}function yf(s,e,t,i,n,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];c=la(s,e,g,i,n,r,o,a,l,c,h),e=g[g.length-1]}return c}function Yc(s,e,t,i){for(let n=0,r=t.length;n<r;++n)s[e++]=t[n];return e}function cr(s,e,t,i){for(let n=0,r=t.length;n<r;++n){const o=t[n];for(let a=0;a<i;++a)s[e++]=o[a]}return e}function ca(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=cr(s,e,t[o],i);n[r++]=l,e=l}return n.length=r,n}function xf(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=ca(s,e,t[o],i,n[r]);l.length===0&&(l[0]=e),n[r++]=l,e=l[l.length-1]}return n.length=r,n}function zt(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=e;o<t;o+=i)n[r++]=s.slice(o,o+i);return n.length=r,n}function Mn(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=zt(s,e,l,i,n[r]),e=l}return n.length=r,n}function xo(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=l.length===1&&l[0]===e?[]:Mn(s,e,l,i,n[r]),e=l[l.length-1]}return n.length=r,n}function hr(s,e,t,i,n,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=s[e],r[o++]=s[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[e,t-i];let h=0;for(;c.length>0;){const u=c.pop(),d=c.pop();let g=0;const f=s[d],m=s[d+1],_=s[u],p=s[u+1];for(let y=d+i;y<u;y+=i){const x=s[y],E=s[y+1],C=ld(x,E,f,m,_,p);C>g&&(h=y,g=C)}g>n&&(l[(h-e)/i]=1,d+i<h&&c.push(d,h),h+i<u&&c.push(h,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=s[e+u*i],r[o++]=s[e+u*i+1]);return o}function Wc(s,e,t,i,n,r,o,a){for(let l=0,c=t.length;l<c;++l){const h=t[l];o=hr(s,e,h,i,n,r,o),a.push(o),e=h}return o}function si(s,e){return e*Math.round(s/e)}function Ef(s,e,t,i,n,r,o){if(e==t)return o;let a=si(s[e],n),l=si(s[e+1],n);e+=i,r[o++]=a,r[o++]=l;let c,h;do if(c=si(s[e],n),h=si(s[e+1],n),e+=i,e==t)return r[o++]=c,r[o++]=h,o;while(c==a&&h==l);for(;e<t;){const u=si(s[e],n),d=si(s[e+1],n);if(e+=i,u==c&&d==h)continue;const g=c-a,f=h-l,m=u-a,_=d-l;if(g*_==f*m&&(g<0&&m<g||g==m||g>0&&m>g)&&(f<0&&_<f||f==_||f>0&&_>f)){c=u,h=d;continue}r[o++]=c,r[o++]=h,a=c,l=h,c=u,h=d}return r[o++]=c,r[o++]=h,o}function ha(s,e,t,i,n,r,o,a){for(let l=0,c=t.length;l<c;++l){const h=t[l];o=Ef(s,e,h,i,n,r,o),a.push(o),e=h}return o}function Cf(s,e,t,i,n,r,o,a){for(let l=0,c=t.length;l<c;++l){const h=t[l],u=[];o=ha(s,e,h,i,n,r,o,u),a.push(u),e=h[h.length-1]}return o}class On extends Lt{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new On(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,n){return n<xi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,n))}getArea(){return Xc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return zt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=hr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new On(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}class mt extends Lt{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new mt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=ui(e,t,r[0],r[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return Yo(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Vo(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Yc(this.flatCoordinates,0,e,this.stride),this.changed()}}function wf(s,e,t,i,n){return!Ho(n,function(o){return!ai(s,e,t,i,o[0],o[1])})}function ai(s,e,t,i,n,r){let o=0,a=s[t-i],l=s[t-i+1];for(;e<t;e+=i){const c=s[e],h=s[e+1];l<=r?h>r&&(c-a)*(r-l)-(n-a)*(h-l)>0&&o++:h<=r&&(c-a)*(r-l)-(n-a)*(h-l)<0&&o--,a=c,l=h}return o!==0}function ua(s,e,t,i,n,r){if(t.length===0||!ai(s,e,t[0],i,n,r))return!1;for(let o=1,a=t.length;o<a;++o)if(ai(s,t[o-1],t[o],i,n,r))return!1;return!0}function Tf(s,e,t,i,n,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(ua(s,e,l,i,n,r))return!0;e=l[l.length-1]}return!1}function da(s,e,t,i,n,r,o){let a,l,c,h,u,d,g;const f=n[r+1],m=[];for(let y=0,x=t.length;y<x;++y){const E=t[y];for(h=s[E-i],d=s[E-i+1],a=e;a<E;a+=i)u=s[a],g=s[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(c=(f-d)/(g-d)*(u-h)+h,m.push(c)),h=u,d=g}let _=NaN,p=-1/0;for(m.sort(ht),h=m[0],a=1,l=m.length;a<l;++a){u=m[a];const y=Math.abs(u-h);y>p&&(c=(h+u)/2,ua(s,e,t,i,c,f)&&(_=c,p=y)),h=u}return isNaN(_)&&(_=n[r]),o?(o.push(_,f,p),o):[_,f,p]}function Kc(s,e,t,i,n){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=da(s,e,l,i,n,2*o,r),e=l[l.length-1]}return r}function Hc(s,e,t,i,n){let r;for(e+=i;e<t;e+=i)if(r=n(s.slice(e-i,e),s.slice(e,e+i)),r)return r;return!1}function ur(s,e,t,i,n,r){return r=r??bc(Fe(),s,e,t,i),ce(n,r)?r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]?!0:Hc(s,e,t,i,function(o,a){return _d(n,o,a)}):!1}function Rf(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){if(ur(s,e,t[r],i,n))return!0;e=t[r]}return!1}function Zc(s,e,t,i,n){return!!(ur(s,e,t,i,n)||ai(s,e,t,i,n[0],n[1])||ai(s,e,t,i,n[0],n[3])||ai(s,e,t,i,n[2],n[1])||ai(s,e,t,i,n[2],n[3]))}function qc(s,e,t,i,n){if(!Zc(s,e,t[0],i,n))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(wf(s,t[r-1],t[r],i,n)&&!ur(s,t[r-1],t[r],i,n))return!1;return!0}function Sf(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(qc(s,e,a,i,n))return!0;e=a[a.length-1]}return!1}function If(s,e,t,i){for(;e<t-i;){for(let n=0;n<i;++n){const r=s[e+n];s[e+n]=s[t-i+n],s[t-i+n]=r}e+=i,t-=i}}function fa(s,e,t,i){let n=0,r=s[t-i],o=s[t-i+1];for(;e<t;e+=i){const a=s[e],l=s[e+1];n+=(a-r)*(l+o),r=a,o=l}return n===0?void 0:n>0}function ga(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=fa(s,e,a,i);if(r===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;e=a}return!0}function $c(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!ga(s,e,a,i,n))return!1;a.length&&(e=a[a.length-1])}return!0}function ks(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=fa(s,e,a,i);(r===0?n&&l||!n&&!l:n&&!l||!n&&l)&&If(s,e,a,i),e=a}return e}function Eo(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r)e=ks(s,e,t[r],i,n);return e}function Jc(s,e){const t=[];let i=0,n=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],c=fa(s,i,l,2);if(r===void 0&&(r=c),c===r)t.push(e.slice(n,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[n])}n=o+1,i=l}return t}class At extends Lt{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?et(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new At(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<xi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(oa(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),la(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return ua(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Vc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ks(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Mn(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Me(this.getExtent());this.flatInteriorPoint_=da(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new mt(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new On(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],c=new On(t.slice(r,l),e);n.push(c),r=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;ga(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ks(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=ha(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new At(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return qc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ca(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function vf(s,e,t,i){t=t||32;const n=[];for(let r=0;r<t;++r)et(n,Rd(s,e,2*Math.PI*r/t,i));return n.push(n[0],n[1]),new At(n,"XY",[n.length])}function Ml(s){if(Ei(s))throw new Error("Cannot create polygon from empty extent");const e=s[0],t=s[1],i=s[2],n=s[3],r=[e,t,e,n,i,n,i,t,e,t];return new At(r,"XY",[r.length])}function ma(s,e,t,i){const n=Z(e)/t[0],r=le(e)/t[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function _a(s,e,t){let i=Math.min(s,e);const n=50;return i*=Math.log(1+n*Math.max(0,s/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/s-1))/n+1),he(i,t/2,e*2)}function Af(s,e,t,i){return e=e!==void 0?e:!0,function(n,r,o,a){if(n!==void 0){const l=s[0],c=s[s.length-1],h=t?ma(l,t,o,i):l;if(a)return e?_a(n,h,c):he(n,c,h);const u=Math.min(h,n),d=Math.floor(Qs(s,u,r));return s[d]>h&&d<s.length-1?s[d+1]:s[d]}}}function bf(s,e,t,i,n,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,c){if(o!==void 0){const h=n?ma(e,n,l,r):e;if(c)return i?_a(o,h,t):he(o,t,h);const u=1e-9,d=Math.ceil(Math.log(e/h)/Math.log(s)-u),g=-a*(.5-u)+.5,f=Math.min(h,o),m=Math.floor(Math.log(e/f)/Math.log(s)+g),_=Math.max(d,m),p=e/Math.pow(s,_);return he(p,t,h)}}}function Ol(s,e,t,i,n){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const c=i?ma(s,i,a,n):s;return!t||!l?he(r,e,c):_a(r,c,e)}}}function Lf(s){if(s!==void 0)return 0}function Dl(s){if(s!==void 0)return s}function Pf(s){const e=2*Math.PI/s;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function Ff(s){const e=ut(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}const Qc=42,pa=256,kr=0;class Gl extends $t{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=ta(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&jc(),e.center&&(e.center=Ft(e.center,this.projection_)),e.extent&&(e.extent=at(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in qe)delete t[a];this.setProperties(t,!0);const i=Of(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=Mf(e),r=i.constraint,o=Df(e);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-t[3]+t[1]-n[1]),a=r/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=Ft(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ft(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const h=arguments[n];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(n===t){i&&fs(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const c=[];for(;n<t;++n){const h=arguments[n],u={start:r,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||wd,callback:i};if(h.center&&(u.sourceCenter=o,u.targetCenter=h.center.slice(),o=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(h.zoom),a=u.targetResolution):h.resolution&&(u.sourceResolution=a,u.targetResolution=h.resolution,a=u.targetResolution),h.rotation!==void 0){u.sourceRotation=l;const d=Wt(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}Gf(u)?u.complete=!0:r+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(ge.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ge.ANIMATING]>0}getInteracting(){return this.hints_[ge.INTERACTING]>0}cancelAnimations(){this.setHint(ge.ANIMATING,-this.hints_[ge.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&fs(n[0].callback,!1),!e)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const c=e-l.start;let h=l.duration>0?c/l.duration:1;h>=1?(l.complete=!0,h=1):r=!1;const u=l.easing(h);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const _=d+u*(f-d),p=g+u*(m-g);this.targetCenter_=[_,p]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Wt(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(ge.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&fs(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],pd(i,e-this.getRotation()),Mc(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-n[0])/r,a=t[1]-e*(t[1]-n[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&vl(e,this.getProjection())}getCenterInternal(){return this.get(qe.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return ia(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();se(t,"The view center is not defined");const i=this.getResolution();se(i!==void 0,"The view resolution is not defined");const n=this.getRotation();return se(n!==void 0,"The view rotation is not defined"),Zo(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(qe.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(at(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Z(e)/t[0],n=le(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(qe.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=Nr(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const r=Qs(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){var t;if((t=this.resolutions_)!=null&&t.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=he(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,he(e-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(se(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){se(!Ei(e),"Cannot fit empty extent provided as `geometry`");const n=at(e,this.getProjection());i=Ml(n)}else if(e.getType()==="Circle"){const n=at(e.getExtent(),this.getProjection());i=Ml(n),i.rotate(this.getRotation(),Me(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,c=-1/0,h=-1/0;for(let u=0,d=r.length;u<d;u+=o){const g=r[u]*i-r[u+1]*n,f=r[u]*n+r[u+1]*i;a=Math.min(a,g),l=Math.min(l,f),c=Math.max(c,g),h=Math.max(h,f)}return[a,l,c,h]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),d=Me(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const g=d[0]*u-d[1]*h,f=d[1]*u+d[0]*h,m=this.getConstrainedCenter([g,f],l),_=t.callback?t.callback:As;t.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:t.duration,easing:t.easing},_):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),fs(_,!0))}centerOn(e,t,i){this.centerOnInternal(Ft(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Nr(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=Nr(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=vl(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Ft(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Ft(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Ft(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(qe.ROTATION)!==n&&this.set(qe.ROTATION,n),this.get(qe.RESOLUTION)!==o&&(this.set(qe.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(qe.CENTER)||!Ms(this.get(qe.CENTER),a))&&this.set(qe.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Ms(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:Cd,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ge.INTERACTING,1)}endInteraction(e,t,i){i=i&&Ft(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(ge.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function fs(s,e){setTimeout(function(){s(e)},0)}function Mf(s){if(s.extent!==void 0){const t=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return _l(s.extent,s.constrainOnlyCenter,t)}const e=ta(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,_l(t,!1,!1)}return hd}function Of(s){let e,t,i,o=s.minZoom!==void 0?s.minZoom:kr,a=s.maxZoom!==void 0?s.maxZoom:28;const l=s.zoomFactor!==void 0?s.zoomFactor:2,c=s.multiWorld!==void 0?s.multiWorld:!1,h=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,u=s.showFullExtent!==void 0?s.showFullExtent:!1,d=ta(s.projection,"EPSG:3857"),g=d.getExtent();let f=s.constrainOnlyCenter,m=s.extent;if(!c&&!m&&d.isGlobal()&&(f=!1,m=g),s.resolutions!==void 0){const _=s.resolutions;t=_[o],i=_[a]!==void 0?_[a]:_[_.length-1],s.constrainResolution?e=Af(_,h,!f&&m,u):e=Ol(t,i,h,!f&&m,u)}else{const p=(g?Math.max(Z(g),le(g)):360*Pn.degrees/d.getMetersPerUnit())/pa/Math.pow(2,kr),y=p/Math.pow(2,28-kr);t=s.maxResolution,t!==void 0?o=0:t=p/Math.pow(l,o),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=t/Math.pow(l,a):i=p/Math.pow(l,a):i=y),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),s.constrainResolution?e=bf(l,t,i,h,!f&&m,u):e=Ol(t,i,h,!f&&m,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function Df(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const t=s.constrainRotation;return t===void 0||t===!0?Ff():t===!1?Dl:typeof t=="number"?Pf(t):Dl}return Lf}function Gf(s){return!(s.sourceCenter&&s.targetCenter&&!Ms(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function Nr(s,e,t,i,n){const r=Math.cos(-n);let o=Math.sin(-n),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const c=a*r-l*o,h=l*r+a*o;return[c,h]}function by(s){return function(e){if(!e.resolutions)return e;const t=[...e.resolutions],i=t[t.length-1];for(let n=0;n<s;++n)t.push(i/Math.pow(2,n+1));return{...e,resolutions:t}}}function Ly(s){return function(e){if(!e.resolutions)return e;const t=[...e.resolutions],i=t[0];for(let n=0;n<s;++n)t.unshift(i*Math.pow(2,n+1));return{...e,resolutions:t}}}function Py(){return function(s){if(!s.extent)return s;const e=Me(s.extent),t={...s,center:e};return delete t.extent,t}}function Fy(s){return function(e){return{...e,zoom:s}}}async function My(s,...e){let t=await s.getView();for(const i of e)t=i(t);return t}const Oy="ol-hidden",kf="ol-selectable",Dy="ol-unselectable",Gy="ol-control",ky="ol-collapsed",Nf=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),kl=["style","variant","weight","size","lineHeight","family"],Co={normal:400,bold:700},wo=function(s){const e=s.match(Nf);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,n=kl.length;i<n;++i){const r=e[i+1];r!==void 0&&(t[kl[i]]=typeof r=="string"?r.trim():r)}return isNaN(Number(t.weight))&&t.weight in Co&&(t.weight=Co[t.weight]),t.families=t.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),t};function ae(s,e,t,i){let n;return t&&t.length?n=t.shift():It?n=new class extends OffscreenCanvas{constructor(){super(...arguments);I(this,"style",{})}}(s??300,e??150):n=document.createElement("canvas"),s&&(n.width=s),e&&(n.height=e),n.getContext("2d",i)}let Ur;function Ns(){return Ur||(Ur=ae(1,1)),Ur}function Qn(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function Uf(s){let e=s.offsetWidth;const t=getComputedStyle(s);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function Bf(s){let e=s.offsetHeight;const t=getComputedStyle(s);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function Ny(s,e){const t=e.parentNode;t&&t.replaceChild(s,e)}function zf(s){for(;s.lastChild;)s.lastChild.remove()}function Uy(s,e){const t=s.childNodes;for(let i=0;;++i){const n=t[i],r=e[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}}function jf(){return new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){const t=this.childNodes.indexOf(e);if(t===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(t,1),e},insertBefore:function(e,t){const i=this.childNodes.indexOf(t);if(i===-1)throw new Error("Reference node not found");return this.childNodes.splice(i,0,e),e},style:{}},{get(e,t,i){return t==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,t,i)}})}function Xf(s){return typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas}const ne={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class eh extends $t{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[ne.OPACITY]=e.opacity!==void 0?e.opacity:1,se(typeof t[ne.OPACITY]=="number","Layer opacity must be a number"),t[ne.VISIBLE]=e.visible!==void 0?e.visible:!0,t[ne.Z_INDEX]=e.zIndex,t[ne.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[ne.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[ne.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[ne.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=he(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return $()}getLayerStatesArray(e){return $()}getExtent(){return this.get(ne.EXTENT)}getMaxResolution(){return this.get(ne.MAX_RESOLUTION)}getMinResolution(){return this.get(ne.MIN_RESOLUTION)}getMinZoom(){return this.get(ne.MIN_ZOOM)}getMaxZoom(){return this.get(ne.MAX_ZOOM)}getOpacity(){return this.get(ne.OPACITY)}getSourceState(){return $()}getVisible(){return this.get(ne.VISIBLE)}getZIndex(){return this.get(ne.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(ne.EXTENT,e)}setMaxResolution(e){this.set(ne.MAX_RESOLUTION,e)}setMinResolution(e){this.set(ne.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(ne.MAX_ZOOM,e)}setMinZoom(e){this.set(ne.MIN_ZOOM,e)}setOpacity(e){se(typeof e=="number","Layer opacity must be a number"),this.set(ne.OPACITY,e)}setVisible(e){this.set(ne.VISIBLE,e)}setZIndex(e){this.set(ne.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Mt={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class bi extends bt{constructor(e,t){super(e),this.layer=t}}const Br={LAYERS:"layers"};class Dn extends eh{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Br.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new fo(i.slice(),{unique:!0}):se(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new fo(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(xe),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(me(e,Ut.ADD,this.handleLayersAdd_,this),me(e,Ut.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(xe);Hn(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new bi(Mt.ADDLAYER,r))}this.changed()}registerLayerListeners_(e){const t=[me(e,zo.PROPERTYCHANGE,this.handleLayerChange_,this),me(e,ie.CHANGE,this.handleLayerChange_,this)];e instanceof Dn&&t.push(me(e,Mt.ADDLAYER,this.handleLayerGroupAdd_,this),me(e,Mt.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[Y(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new bi(Mt.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new bi(Mt.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new bi(Mt.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=Y(t);this.listenerKeys_[i].forEach(xe),delete this.listenerKeys_[i],this.dispatchEvent(new bi(Mt.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(Br.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new bi(Mt.REMOVELAYER,i[n]))}this.set(Br.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let r=n.zIndex;!e&&n.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=Ae(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const li={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class dr extends eh{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(ne.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(ne.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(xe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=me(e,ie.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof Gl?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let n;if(t.layerStatesArray){if(n=t.layerStatesArray.find(o=>o.layer===this),!n)return!1}else n=this.getLayerState();const r=this.getExtent();return Vf(n,t.viewState)&&(!r||ce(r,t.extent))}getAttributions(e){var r;if(!this.isVisible(e))return[];const t=(r=this.getSource())==null?void 0:r.getAttributions();if(!t)return[];const i=e instanceof Gl?e.getViewStateAndExtent():e;let n=t(i);return Array.isArray(n)||(n=[n]),n}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(ne.MAP,e)}getMapInternal(){return this.get(ne.MAP)}setMap(e){this.mapPrecomposeKey_&&(xe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(xe(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=me(e,li.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=me(this,ie.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);se(!t.some(n=>n.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(ne.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Vf(s,e){if(!s.visible)return!1;const t=e.resolution;if(t<s.minResolution||t>=s.maxResolution)return!1;const i=e.zoom;return i>s.minZoom&&i<=s.maxZoom}let th=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!ms(e,t))return i;const n=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?n(a):a;ms(e,l)&&(t.leaf?i.push(a):jr(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!ms(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],o=t.leaf?this.toBBox(r):r;if(ms(e,o)){if(t.leaf||jr(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Ni([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],o=[];let a,l,c;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),c=!0),i.leaf){const h=Yf(e,i.children,t);if(h!==-1)return i.children.splice(h,1),r.push(i),this._condense(r),this}!c&&!i.leaf&&jr(i,n)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],c=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=Ni(e.slice(t,i+1)),Li(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=Ni([]),a.leaf=!1,a.height=n;const l=Math.ceil(r/o),c=l*Math.ceil(Math.sqrt(o));Nl(e,t,i,c,this.compareMinX);for(let h=t;h<=i;h+=c){const u=Math.min(h+c-1,i);Nl(e,h,u,l,this.compareMinY);for(let d=h;d<=u;d+=l){const g=Math.min(d+l-1,u);a.children.push(this._build(e,d,g,n-1))}}return Li(a,this.toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const c=t.children[l],h=zr(c),u=Hf(e,c)-h;u<o?(o=u,r=h<r?h:r,a=c):u===o&&h<r&&(r=h,a=c)}t=a||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,t,r);for(o.children.push(e),xn(o,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=Ni(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Li(i,this.toBBox),Li(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Ni([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Li(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=yn(e,0,a,this.toBBox),c=yn(e,a,i,this.toBBox),h=Zf(l,c),u=zr(l)+zr(c);h<r?(r=h,n=a,o=u<o?u:o):h===r&&u<o&&(o=u,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Wf,r=e.leaf?this.compareMinY:Kf,o=this._allDistMargin(e,t,i,n),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this.toBBox,o=yn(e,0,t,r),a=yn(e,i-t,i,r);let l=gs(o)+gs(a);for(let c=t;c<i-t;c++){const h=e.children[c];xn(o,e.leaf?r(h):h),l+=gs(o)}for(let c=i-t-1;c>=t;c--){const h=e.children[c];xn(a,e.leaf?r(h):h),l+=gs(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)xn(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Li(e[t],this.toBBox)}};function Yf(s,e,t){if(!t)return e.indexOf(s);for(let i=0;i<e.length;i++)if(t(s,e[i]))return i;return-1}function Li(s,e){yn(s,0,s.children.length,e,s)}function yn(s,e,t,i,n){n||(n=Ni(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const o=s.children[r];xn(n,s.leaf?i(o):o)}return n}function xn(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function Wf(s,e){return s.minX-e.minX}function Kf(s,e){return s.minY-e.minY}function zr(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function gs(s){return s.maxX-s.minX+(s.maxY-s.minY)}function Hf(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function Zf(s,e){const t=Math.max(s.minX,e.minX),i=Math.max(s.minY,e.minY),n=Math.min(s.maxX,e.maxX),r=Math.min(s.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-i)}function jr(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function ms(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function Ni(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Nl(s,e,t,i,n){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;Hu(s,o,e,t,n),r.push(e,o,o,t)}}const ya=[NaN,NaN,NaN,0];let Xr;function qf(){return Xr||(Xr=ae(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Xr}const $f=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Jf=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Qf=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,eg=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function _s(s,e){return s.endsWith("%")?Number(s.substring(0,s.length-1))/e:Number(s)}function In(s){throw new Error('failed to parse "'+s+'" as color')}function ih(s){if(s.toLowerCase().startsWith("rgb")){const r=s.match(Jf)||s.match($f)||s.match(Qf);if(r){const o=r[4],a=100/255;return[he(_s(r[1],a)+.5|0,0,255),he(_s(r[2],a)+.5|0,0,255),he(_s(r[3],a)+.5|0,0,255),o!==void 0?he(_s(o,100),0,1):1]}In(s)}if(s.startsWith("#")){if(eg.test(s)){const r=s.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=r.length;l<c;l+=o){let h=parseInt(r.substring(l,l+o),16);o===1&&(h+=h<<4),a[l/o]=h}return a[3]=a[3]/255,a}In(s)}const e=qf();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=s,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=s,e.fillStyle===t&&In(s));const i=e.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return ih(i);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const n=Array.from(e.getImageData(0,0,1,1).data);return n[3]=Zn(n[3]/255,3),n}function tg(s){return typeof s=="string"?s:Ea(s)}const ig=1024,dn={};let Vr=0;function ng(s){if(s.length===4)return s;const e=s.slice();return e[3]=1,e}function Yr(s){return s>.0031308?Math.pow(s,1/2.4)*269.025-14.025:s*3294.6}function Wr(s){return s>.2068965?Math.pow(s,3):(s-4/29)*(108/841)}function Kr(s){return s>10.314724?Math.pow((s+14.025)/269.025,2.4):s/3294.6}function Hr(s){return s>.0088564?Math.pow(s,1/3):s/(108/841)+4/29}function Ul(s){const e=Kr(s[0]),t=Kr(s[1]),i=Kr(s[2]),n=Hr(e*.222488403+t*.716873169+i*.06060791),r=500*(Hr(e*.452247074+t*.399439023+i*.148375274)-n),o=200*(n-Hr(e*.016863605+t*.117638439+i*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*n-16,Math.sqrt(r*r+o*o),a<0?a+360:a,s[3]]}function sg(s){const e=(s[0]+16)/116,t=s[1],i=s[2]*Math.PI/180,n=Wr(e),r=Wr(e+t/500*Math.cos(i)),o=Wr(e-t/200*Math.sin(i)),a=Yr(r*3.021973625-n*1.617392459-o*.404875592),l=Yr(r*-.943766287+n*1.916279586+o*.027607165),c=Yr(r*.069407491-n*.22898585+o*1.159737864);return[he(a+.5|0,0,255),he(l+.5|0,0,255),he(c+.5|0,0,255),s[3]]}function xa(s){if(s==="none")return ya;if(dn.hasOwnProperty(s))return dn[s];if(Vr>=ig){let t=0;for(const i in dn)t++&3||(delete dn[i],--Vr)}const e=ih(s);e.length!==4&&In(s);for(const t of e)isNaN(t)&&In(s);return dn[s]=e,++Vr,e}function _i(s){return Array.isArray(s)?s:xa(s)}function Ea(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let t=s[1];t!=(t|0)&&(t=t+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+n+")"}function zy(s){return s[0]>0&&s[1]>0}function rg(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]*e+.5|0,t[1]=s[1]*e+.5|0,t}function ye(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}let wi=0;const Le=1<<wi++,J=1<<wi++,ke=1<<wi++,Je=1<<wi++,pi=1<<wi++,En=1<<wi++,ps=Math.pow(2,wi)-1,Ca={[Le]:"boolean",[J]:"number",[ke]:"string",[Je]:"color",[pi]:"number[]",[En]:"size"},og=Object.keys(Ca).map(Number).sort(ht);function ag(s){return s in Ca}function Cn(s){const e=[];for(const t of og)wn(s,t)&&e.push(Ca[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function wn(s,e){return(s&e)===e}function Ot(s,e){return s===e}class _e{constructor(e,t){if(!ag(e))throw new Error(`literal expressions must have a specific type, got ${Cn(e)}`);this.type=e,this.value=t}}class lg{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function nh(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Te(s,e,t){switch(typeof s){case"boolean":{if(Ot(e,ke))return new _e(ke,s?"true":"false");if(!wn(e,Le))throw new Error(`got a boolean, but expected ${Cn(e)}`);return new _e(Le,s)}case"number":{if(Ot(e,En))return new _e(En,ye(s));if(Ot(e,Le))return new _e(Le,!!s);if(Ot(e,ke))return new _e(ke,s.toString());if(!wn(e,J))throw new Error(`got a number, but expected ${Cn(e)}`);return new _e(J,s)}case"string":{if(Ot(e,Je))return new _e(Je,xa(s));if(Ot(e,Le))return new _e(Le,!!s);if(!wn(e,ke))throw new Error(`got a string, but expected ${Cn(e)}`);return new _e(ke,s)}}if(!Array.isArray(s))throw new Error("expression must be an array or a primitive value");if(s.length===0)throw new Error("empty expression");if(typeof s[0]=="string")return xg(s,e,t);for(const i of s)if(typeof i!="number")throw new Error("expected an array of numbers");if(Ot(e,En)){if(s.length!==2)throw new Error(`expected an array of two values for a size, got ${s.length}`);return new _e(En,s)}if(Ot(e,Je)){if(s.length===3)return new _e(Je,[...s,1]);if(s.length===4)return new _e(Je,s);throw new Error(`expected an array of 3 or 4 values for a color, got ${s.length}`)}if(!wn(e,pi))throw new Error(`got an array of numbers, but expected ${Cn(e)}`);return new _e(pi,s)}const b={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},cg={[b.Get]:V(W(1,1/0),Bl),[b.Var]:V(W(1,1),hg),[b.Has]:V(W(1,1/0),Bl),[b.Id]:V(ug,Pi),[b.Concat]:V(W(2,1/0),te(ke)),[b.GeometryType]:V(dg,Pi),[b.LineMetric]:V(Pi),[b.Resolution]:V(Zr,Pi),[b.Zoom]:V(Zr,Pi),[b.Time]:V(Zr,Pi),[b.Any]:V(W(2,1/0),te(Le)),[b.All]:V(W(2,1/0),te(Le)),[b.Not]:V(W(1,1),te(Le)),[b.Equal]:V(W(2,2),te(ps)),[b.NotEqual]:V(W(2,2),te(ps)),[b.GreaterThan]:V(W(2,2),te(J)),[b.GreaterThanOrEqualTo]:V(W(2,2),te(J)),[b.LessThan]:V(W(2,2),te(J)),[b.LessThanOrEqualTo]:V(W(2,2),te(J)),[b.Multiply]:V(W(2,1/0),zl),[b.Coalesce]:V(W(2,1/0),zl),[b.Divide]:V(W(2,2),te(J)),[b.Add]:V(W(2,1/0),te(J)),[b.Subtract]:V(W(2,2),te(J)),[b.Clamp]:V(W(3,3),te(J)),[b.Mod]:V(W(2,2),te(J)),[b.Pow]:V(W(2,2),te(J)),[b.Abs]:V(W(1,1),te(J)),[b.Floor]:V(W(1,1),te(J)),[b.Ceil]:V(W(1,1),te(J)),[b.Round]:V(W(1,1),te(J)),[b.Sin]:V(W(1,1),te(J)),[b.Cos]:V(W(1,1),te(J)),[b.Atan]:V(W(1,2),te(J)),[b.Sqrt]:V(W(1,1),te(J)),[b.Match]:V(W(4,1/0),jl,gg),[b.Between]:V(W(3,3),te(J)),[b.Interpolate]:V(W(6,1/0),jl,mg),[b.Case]:V(W(3,1/0),fg,_g),[b.In]:V(W(2,2),pg),[b.Number]:V(W(1,1/0),te(ps)),[b.String]:V(W(1,1/0),te(ps)),[b.Array]:V(W(1,1/0),te(J)),[b.Color]:V(W(1,4),te(J)),[b.Band]:V(W(1,3),te(J)),[b.Palette]:V(W(2,2),yg),[b.ToString]:V(W(1,1),te(Le|J|ke|Je))};function Bl(s,e,t){const i=s.length-1,n=new Array(i);for(let r=0;r<i;++r){const o=s[r+1];switch(typeof o){case"number":{n[r]=new _e(J,o);break}case"string":{n[r]=new _e(ke,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&t.properties.add(String(o))}return n}function hg(s,e,t){const i=s[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new _e(ke,i)]}function ug(s,e,t){t.featureId=!0}function dg(s,e,t){t.geometryType=!0}function Zr(s,e,t){t.mapState=!0}function Pi(s,e,t){const i=s[0];if(s.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function W(s,e){return function(t,i,n){const r=t[0],o=t.length-1;if(s===e){if(o!==s){const a=s===1?"":"s";throw new Error(`expected ${s} argument${a} for ${r}, got ${o}`)}}else if(o<s||o>e){const a=e===1/0?`${s} or more`:`${s} to ${e}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function zl(s,e,t){const i=s.length-1,n=new Array(i);for(let r=0;r<i;++r){const o=Te(s[r+1],e,t);n[r]=o}return n}function te(s){return function(e,t,i){const n=e.length-1,r=new Array(n);for(let o=0;o<n;++o){const a=Te(e[o+1],s,i);r[o]=a}return r}}function fg(s,e,t){const i=s[0],n=s.length-1;if(n%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${n} instead`)}function jl(s,e,t){const i=s[0],n=s.length-1;if(n%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${n} instead`)}function gg(s,e,t){const i=s.length-1,n=ke|J|Le,r=Te(s[1],n,t),o=Te(s[s.length-1],e,t),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const c=Te(s[l+2],r.type,t);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{const c=Te(s[l+3],o.type,t);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[r,...a,o]}function mg(s,e,t){const i=s[1];let n;switch(i[0]){case"linear":n=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);n=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new _e(J,n);let o;try{o=Te(s[2],J,t)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(s.length-3);for(let l=0;l<a.length;l+=2){try{const c=Te(s[l+3],J,t);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{const c=Te(s[l+4],e,t);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[r,o,...a]}function _g(s,e,t){const i=Te(s[s.length-1],e,t),n=new Array(s.length-1);for(let r=0;r<n.length-1;r+=2){try{const o=Te(s[r+1],Le,t);n[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Te(s[r+2],i.type,t);n[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return n[n.length-1]=i,n}function pg(s,e,t){let i=s[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let n;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],n=ke}else n=J;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const l=Te(i[a],n,t);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Te(s[1],n,t),...r]}function yg(s,e,t){let i;try{i=Te(s[1],J,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const n=s[2];if(!Array.isArray(n))throw new Error("the second argument of palette must be an array");const r=new Array(n.length);for(let o=0;o<r.length;o++){let a;try{a=Te(n[o],Je,t)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof _e))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function V(...s){return function(e,t,i){const n=e[0];let r;for(let o=0;o<s.length;o++){const a=s[o](e,t,i);if(o==s.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new lg(t,n,...r)}}function xg(s,e,t){const i=s[0],n=cg[i];if(!n)throw new Error(`unknown operator: ${i}`);return n(s,e,t)}function sh(s){if(!s)return"";const e=s.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return sh(s.getGeometries()[0]);default:return""}}function rh(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function _t(s,e,t){const i=Te(s,e,t);return it(i)}function it(s,e){if(s instanceof _e){if(s.type===Je&&typeof s.value=="string"){const i=xa(s.value);return function(){return i}}return function(){return s.value}}const t=s.operator;switch(t){case b.Number:case b.String:case b.Coalesce:return Eg(s);case b.Get:case b.Var:case b.Has:return Cg(s);case b.Id:return i=>i.featureId;case b.GeometryType:return i=>i.geometryType;case b.Concat:{const i=s.args.map(n=>it(n));return n=>"".concat(...i.map(r=>r(n).toString()))}case b.Resolution:return i=>i.resolution;case b.Any:case b.All:case b.Between:case b.In:case b.Not:return Tg(s);case b.Equal:case b.NotEqual:case b.LessThan:case b.LessThanOrEqualTo:case b.GreaterThan:case b.GreaterThanOrEqualTo:return wg(s);case b.Multiply:case b.Divide:case b.Add:case b.Subtract:case b.Clamp:case b.Mod:case b.Pow:case b.Abs:case b.Floor:case b.Ceil:case b.Round:case b.Sin:case b.Cos:case b.Atan:case b.Sqrt:return Rg(s);case b.Case:return Sg(s);case b.Match:return Ig(s);case b.Interpolate:return vg(s);case b.ToString:return Ag(s);default:throw new Error(`Unsupported operator ${t}`)}}function Eg(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=it(s.args[r]);switch(t){case b.Coalesce:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case b.Number:case b.String:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function Cg(s,e){const i=s.args[0].value;switch(s.operator){case b.Get:return n=>{const r=s.args;let o=n.properties[i];for(let a=1,l=r.length;a<l;++a){const h=r[a].value;o=o[h]}return o};case b.Var:return n=>n.variables[i];case b.Has:return n=>{const r=s.args;if(!(i in n.properties))return!1;let o=n.properties[i];for(let a=1,l=r.length;a<l;++a){const h=r[a].value;if(!o||!Object.hasOwn(o,h))return!1;o=o[h]}return!0};default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function wg(s,e){const t=s.operator,i=it(s.args[0]),n=it(s.args[1]);switch(t){case b.Equal:return r=>i(r)===n(r);case b.NotEqual:return r=>i(r)!==n(r);case b.LessThan:return r=>i(r)<n(r);case b.LessThanOrEqualTo:return r=>i(r)<=n(r);case b.GreaterThan:return r=>i(r)>n(r);case b.GreaterThanOrEqualTo:return r=>i(r)>=n(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function Tg(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=it(s.args[r]);switch(t){case b.Any:return r=>{for(let o=0;o<i;++o)if(n[o](r))return!0;return!1};case b.All:return r=>{for(let o=0;o<i;++o)if(!n[o](r))return!1;return!0};case b.Between:return r=>{const o=n[0](r),a=n[1](r),l=n[2](r);return o>=a&&o<=l};case b.In:return r=>{const o=n[0](r);for(let a=1;a<i;++a)if(o===n[a](r))return!0;return!1};case b.Not:return r=>!n[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function Rg(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=it(s.args[r]);switch(t){case b.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=n[a](r);return o};case b.Divide:return r=>n[0](r)/n[1](r);case b.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=n[a](r);return o};case b.Subtract:return r=>n[0](r)-n[1](r);case b.Clamp:return r=>{const o=n[0](r),a=n[1](r);if(o<a)return a;const l=n[2](r);return o>l?l:o};case b.Mod:return r=>n[0](r)%n[1](r);case b.Pow:return r=>Math.pow(n[0](r),n[1](r));case b.Abs:return r=>Math.abs(n[0](r));case b.Floor:return r=>Math.floor(n[0](r));case b.Ceil:return r=>Math.ceil(n[0](r));case b.Round:return r=>Math.round(n[0](r));case b.Sin:return r=>Math.sin(n[0](r));case b.Cos:return r=>Math.cos(n[0](r));case b.Atan:return i===2?r=>Math.atan2(n[0](r),n[1](r)):r=>Math.atan(n[0](r));case b.Sqrt:return r=>Math.sqrt(n[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function Sg(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=it(s.args[n]);return n=>{for(let r=0;r<t-1;r+=2)if(i[r](n))return i[r+1](n);return i[t-1](n)}}function Ig(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=it(s.args[n]);return n=>{const r=i[0](n);for(let o=1;o<t-1;o+=2)if(r===i[o](n))return i[o+1](n);return i[t-1](n)}}function vg(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=it(s.args[n]);return n=>{const r=i[0](n),o=i[1](n);let a,l;for(let c=2;c<t;c+=2){const h=i[c](n);let u=i[c+1](n);const d=Array.isArray(u);if(d&&(u=ng(u)),h>=o)return c===2?u:d?bg(r,o,a,l,h,u):Tn(r,o,a,l,h,u);a=h,l=u}return l}}function Ag(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=it(s.args[r]);switch(t){case b.ToString:return r=>{const o=n[0](r);return s.args[0].type===Je?Ea(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function Tn(s,e,t,i,n,r){const o=n-t;if(o===0)return i;const a=e-t,l=s===1?a/o:(Math.pow(s,a)-1)/(Math.pow(s,o)-1);return i+l*(r-i)}function bg(s,e,t,i,n,r){if(n-t===0)return i;const a=Ul(i),l=Ul(r);let c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);const h=[Tn(s,e,t,a[0],n,l[0]),Tn(s,e,t,a[1],n,l[1]),a[2]+Tn(s,e,t,0,n,c),Tn(s,e,t,i[3],n,r[3])];return sg(h)}const B={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class fr extends er{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof n=="function"?B.IDLE:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent(ie.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==B.IDLE&&this.loader){this.state=B.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;vc(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||Ac&&i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=B.LOADED}).catch(i=>{this.state=B.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function Lg(s,e,t){const i=s;let n=!0,r=!1,o=!1;const a=[bs(i,ie.LOAD,function(){o=!0,r||e()})];return i.src&&Xo?(r=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(bs(i,ie.ERROR,t)),function(){n=!1,a.forEach(xe)}}function Pg(s,e){return new Promise((t,i)=>{function n(){o(),t(s)}function r(){o(),i(new Error("Image load error"))}function o(){s.removeEventListener("load",n),s.removeEventListener("error",r)}s.addEventListener("load",n),s.addEventListener("error",r)})}function oh(s,e){return e&&(s.src=e),s.src&&Xo?new Promise((t,i)=>s.decode().then(()=>t(s)).catch(n=>s.complete&&s.width?t(s):i(n))):Pg(s)}function gr(s,e){return e&&(s.src=e),s.src&&Xo&&Ac?s.decode().then(()=>createImageBitmap(s)).catch(t=>{if(s.complete&&s.width)return s;throw t}):oh(s)}class Fg{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const n=qr(e,t,i);return n in this.cache_?this.cache_[n]:null}getPattern(e,t,i){const n=qr(e,t,i);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,i,n,r){const o=qr(e,t,i),a=o in this.cache_;this.cache_[o]=n,r&&(n.getImageState()===B.IDLE&&n.load(),n.getImageState()===B.LOADING?n.ready().then(()=>{this.patternCache_[o]=Ns().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=Ns().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function qr(s,e,t){const i=t?_i(t):"null";return e+":"+s+":"+i}const lt=new Fg;let fn=null;class ah extends er{constructor(e,t,i,n,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=n===void 0?B.IDLE:n,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===B.LOADED){fn||(fn=ae(1,1,void 0,{willReadFrequently:!0})),fn.drawImage(this.image_,0,0);try{fn.getImageData(0,0,1,1),this.tainted_=!1}catch{fn=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ie.CHANGE)}handleImageError_(){this.imageState_=B.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=B.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}setImage(e){this.image_=e}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=ae(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===B.IDLE){this.image_||this.initializeImage_(),this.imageState_=B.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&oh(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==B.LOADED)return;const t=this.image_,i=ae(Math.ceil(t.width*e),Math.ceil(t.height*e)),n=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=tg(this.color_),i.fillRect(0,0,n.width/e,n.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=n}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===B.LOADED||this.imageState_===B.ERROR)e();else{const t=()=>{(this.imageState_===B.LOADED||this.imageState_===B.ERROR)&&(this.removeEventListener(ie.CHANGE,t),e())};this.addEventListener(ie.CHANGE,t)}})),this.ready_}}function vn(s,e,t,i,n,r){let o=e===void 0?void 0:lt.get(e,t,n);return o||(o=new ah(s,s&&"src"in s?s.src||void 0:e,t,i,n),lt.set(e,t,n,o,r)),r&&o&&!lt.getPattern(e,t,n)&&lt.set(e,t,n,o,r),o}function ct(s){return s?Array.isArray(s)?Ea(s):typeof s=="object"&&"src"in s?Mg(s):s:null}function Mg(s){if(!s.offset||!s.size)return lt.getPattern(s.src,"anonymous",s.color);const e=s.src+":"+s.offset,t=lt.getPattern(e,void 0,s.color);if(t)return t;const i=lt.get(s.src,"anonymous",null);if(i.getImageState()!==B.LOADED)return null;const n=ae(s.size[0],s.size[1]);return n.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),vn(n.canvas,e,void 0,B.LOADED,s.color,!0),lt.getPattern(e,void 0,s.color)}const lh="10px sans-serif",Ne="#000",qi="round",Rt=[],St=0,$i="round",Gn=10,kn="#000",Nn="center",Us="middle",ci=[0,0,0,0],Un=1,gn=new $t;let mn=null,Xl;const To={},Og=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function Dg(s,e,t){return`${s} ${e} 16px "${t}"`}const Gg=function(){let e,t;async function i(r){await t.ready;const o=await t.load(r);if(o.length===0)return!1;const a=wo(r),l=a.families[0].toLowerCase(),c=a.weight;return o.some(h=>{const u=h.family.replace(/^['"]|['"]$/g,"").toLowerCase(),d=Co[h.weight]||h.weight;return u===l&&h.style===a.style&&d==c})}async function n(){await t.ready;let r=!0;const o=gn.getProperties(),a=Object.keys(o).filter(l=>o[l]<100);for(let l=a.length-1;l>=0;--l){const c=a[l];let h=o[c];h<100&&(await i(c)?(Hn(To),gn.set(c,100)):(h+=10,gn.set(c,h,!0),h<100&&(r=!1)))}e=void 0,r||(e=setTimeout(n,100))}return async function(r){t||(t=It?self.fonts:document.fonts);const o=wo(r);if(!o)return;const a=o.families;let l=!1;for(const c of a){if(Og.has(c))continue;const h=Dg(o.style,o.weight,c);gn.get(h)===void 0&&(gn.set(h,0,!0),l=!0)}l&&(clearTimeout(e),e=setTimeout(n,100))}}(),kg=function(){let s;return function(e){let t=To[e];if(t==null){if(It){const i=wo(e),n=ch(e,"g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),t=s.offsetHeight,document.body.removeChild(s);To[e]=t}return t}}();function ch(s,e){return mn||(mn=ae(1,1)),s!=Xl&&(mn.font=s,Xl=mn.font),mn.measureText(e)}function hh(s,e){return ch(s,e).width}function Vl(s,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,r)=>Math.max(n,hh(s,r)),0);return t[e]=i,i}function Ng(s,e){const t=[],i=[],n=[];let r=0,o=0,a=0,l=0;for(let c=0,h=e.length;c<=h;c+=2){const u=e[c];if(u===`
`||c===h){r=Math.max(r,o),n.push(o),o=0,a+=l,l=0;continue}const d=e[c+1]||s.font,g=hh(d,u);t.push(g),o+=g;const f=kg(d);i.push(f),l=Math.max(l,f)}return{width:r,height:a,widths:t,heights:i,lineWidths:n}}function Ug(s,e,t,i,n,r,o,a,l,c,h){s.save(),t!==1&&(s.globalAlpha===void 0?s.globalAlpha=u=>u.globalAlpha*=t:s.globalAlpha*=t),e&&s.transform.apply(s,e),i.contextInstructions?(s.translate(l,c),s.scale(h[0],h[1]),Bg(i,s)):h[0]<0||h[1]<0?(s.translate(l,c),s.scale(h[0],h[1]),s.drawImage(i,n,r,o,a,0,0,o,a)):s.drawImage(i,n,r,o,a,l,c,o*h[0],a*h[1]),s.restore()}function Bg(s,e){const t=s.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class mr{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=ye(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new mr({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return $()}getImage(e){return $()}getHitDetectionImage(){return $()}getPixelRatio(e){return 1}getImageState(){return $()}getImageSize(){return $()}getOrigin(){return $()}getSize(){return $()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ye(e)}listenImageChange(e){$()}load(){$()}unlistenImageChange(e){$()}ready(){return Promise.resolve()}}class _r extends mr{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?B.LOADING:B.LOADED,this.imageState_===B.LOADING&&this.ready().then(()=>this.imageState_=B.LOADED),this.render()}clone(){const e=this.getScale(),t=new _r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var r,o;const t=(r=this.fill_)==null?void 0:r.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let n=(o=lt.get(i,null,null))==null?void 0:o.getImage(1);if(!n){const a=this.renderOptions_,l=Math.ceil(a.size*e),c=ae(l,l);this.draw_(a,c,e),n=c.canvas;const h=new ah(n,void 0,null,B.LOADED,null);lt.set(i,null,null,h),createImageBitmap(n).then(u=>{h.setImage(u)})}return n}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}setRadius(e){this.radius!==e&&(this.radius=e,this.render())}getRadius2(){return this.radius2_}setRadius2(e){this.radius2_!==e&&(this.radius2_=e,this.render())}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let n=this.radius,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const w=n;n=r,r=w}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),c=Math.sqrt(r*r-l*l),h=n-c,u=Math.sqrt(l*l+h*h),d=u/l;if(e==="miter"&&d<=i)return d*t;const g=t/2/d,f=t/2*(h/u),_=Math.sqrt((n+g)*(n+g)+f*f)-n;if(this.radius2_===void 0||e==="bevel")return _*2;const p=n*Math.sin(a),y=Math.sqrt(n*n-p*p),x=r-y,C=Math.sqrt(p*p+x*x)/p;if(C<=i){const w=C*t/2-r-n;return 2*Math.max(_,w)}return _*2}createRenderOptions(){let e=qi,t=$i,i=0,n=null,r=0,o,a=0;this.stroke_&&(o=ct(this.stroke_.getColor()??kn),a=this.stroke_.getWidth()??Un,n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??$i,e=this.stroke_.getLineCap()??qi,i=this.stroke_.getMiterLimit()??Gn);const l=this.calculateLineJoinSize_(t,a,i),c=Math.max(this.radius,this.radius2_||0),h=Math.ceil(2*c+l);return{strokeStyle:o,strokeWidth:a,size:h,lineCap:e,lineDash:n,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let n=this.fill_.getColor();n===null&&(n=Ne),t.fillStyle=ct(n),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),n=0;typeof i=="string"&&(i=_i(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0&&(t=ae(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,c=a%2===0?i:n;e.lineTo(c*Math.cos(l),c*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Ne,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class es extends _r{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new es({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}}class Zt{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Zt({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=vn(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===B.IDLE&&t.load(),t.getImageState()===B.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?Y(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:_i(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Yl(s,e,t,i){return t!==void 0&&i!==void 0?[t/s,i/e]:t!==void 0?t/s:i!==void 0?i/e:1}class Ji extends mr{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,n=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:n,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;se(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Y(o)),se(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),se(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=B.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?B.LOADED:B.IDLE:l=B.LOADING:l=B.LOADED),this.color_=e.color!==void 0?_i(e.color):null,this.iconImage_=vn(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let c,h;if(e.size)[c,h]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)c=u.width,h=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(Yl(g[0],g[1],e.width,e.height))};this.listenImageChange(d);return}}c!==void 0&&this.setScale(Yl(c,h,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Ji({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=n[0]),this.anchorYUnits_=="fraction"&&(e[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+n[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}setColor(e){const t=e?_i(e):null;if(this.color_===t||this.color_&&t&&this.color_.length===t.length&&this.color_.every((o,a)=>o===t[a]))return;this.color_=t;const i=this.getSrc(),n=i!==void 0?null:this.getHitDetectionImage(),r=i!==void 0?B.IDLE:this.iconImage_.getImageState();this.iconImage_=vn(n,i,this.crossOrigin_,r,this.color_)}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=vn(null,e,this.crossOrigin_,B.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==B.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==B.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(ie.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(ie.CHANGE,e)}ready(){return this.iconImage_.ready()}}class Ht{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ht({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class He{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Wl,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new He({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Wl,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function zg(s){let e;if(typeof s=="function")e=s;else{let t;Array.isArray(s)?t=s:(se(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[s]),e=function(){return t}}return e}let $r=null;function uh(s,e){if(!$r){const t=new Zt({color:"rgba(255,255,255,0.4)"}),i=new Ht({color:"#3399CC",width:1.25});$r=[new He({image:new es({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return $r}function jy(){const s={},e=[255,255,255,1],t=[0,153,255,1],i=3;return s.Polygon=[new He({fill:new Zt({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new He({stroke:new Ht({color:e,width:i+2})}),new He({stroke:new Ht({color:t,width:i})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new He({image:new es({radius:i*2,fill:new Zt({color:t}),stroke:new Ht({color:e,width:i/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function Wl(s){return s.getGeometry()}const jg="#333";class wa{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=ye(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Zt({color:jg}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new wa({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Zt?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ye(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function Xg(s){return!0}function Vg(s){const e=nh(),t=Yg(s,e),i=rh();return function(n,r){if(i.properties=n.getPropertiesInternal(),i.resolution=r,e.featureId){const o=n.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=sh(n.getGeometry())),t(i)}}function Kl(s){const e=nh(),t=s.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=Ro(s[o],e);const n=rh(),r=new Array(t);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,e.featureId){const c=o.getId();c!==void 0?n.featureId=c:n.featureId=null}let l=0;for(let c=0;c<t;++c){const h=i[c](n);h&&(r[l]=h,l+=1)}return r.length=l,r}}function Yg(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n){const r=s[n],o="filter"in r?_t(r.filter,Le,e):Xg;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=Ro(r.style[c],e)}else a=[Ro(r.style,e)];i[n]={filter:o,styles:a}}return function(n){const r=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(n)&&!(s[a].else&&o)){o=!0;for(const c of i[a].styles){const h=c(n);h&&r.push(h)}}}return r}}function Ro(s,e){const t=Bn(s,"",e),i=zn(s,"",e),n=Wg(s,e),r=Kg(s,e),o=ve(s,"z-index",e);if(!t&&!i&&!n&&!r&&!di(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const a=new He;return function(l){let c=!0;if(t){const h=t(l);h&&(c=!1),a.setFill(h)}if(i){const h=i(l);h&&(c=!1),a.setStroke(h)}if(n){const h=n(l);h&&(c=!1),a.setText(h)}if(r){const h=r(l);h&&(c=!1),a.setImage(h)}return o&&a.setZIndex(o(l)),c?null:a}}function Bn(s,e,t){let i;if(e+"fill-pattern-src"in s)i=$g(s,e+"fill-",t);else{if(s[e+"fill-color"]==="none")return r=>null;i=pr(s,e+"fill-color",t)}if(!i)return null;const n=new Zt;return function(r){const o=i(r);return o===ya?null:(n.setColor(o),n)}}function zn(s,e,t){const i=ve(s,e+"stroke-width",t),n=pr(s,e+"stroke-color",t);if(!i&&!n)return null;const r=Tt(s,e+"stroke-line-cap",t),o=Tt(s,e+"stroke-line-join",t),a=dh(s,e+"stroke-line-dash",t),l=ve(s,e+"stroke-line-dash-offset",t),c=ve(s,e+"stroke-miter-limit",t),h=new Ht;return function(u){if(n){const d=n(u);if(d===ya)return null;h.setColor(d)}if(i&&h.setWidth(i(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");h.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");h.setLineJoin(d)}return a&&h.setLineDash(a(u)),l&&h.setLineDashOffset(l(u)),c&&h.setMiterLimit(c(u)),h}}function Wg(s,e){const t="text-",i=Tt(s,t+"value",e);if(!i)return null;const n=Bn(s,t,e),r=Bn(s,t+"background-",e),o=zn(s,t,e),a=zn(s,t+"background-",e),l=Tt(s,t+"font",e),c=ve(s,t+"max-angle",e),h=ve(s,t+"offset-x",e),u=ve(s,t+"offset-y",e),d=Yi(s,t+"overflow",e),g=Tt(s,t+"placement",e),f=ve(s,t+"repeat",e),m=yr(s,t+"scale",e),_=Yi(s,t+"rotate-with-view",e),p=ve(s,t+"rotation",e),y=Tt(s,t+"align",e),x=Tt(s,t+"justify",e),E=Tt(s,t+"baseline",e),C=Yi(s,t+"keep-upright",e),w=dh(s,t+"padding",e),R=xr(s,t+"declutter-mode"),T=new wa({declutterMode:R});return function(S){if(T.setText(i(S)),n&&T.setFill(n(S)),r&&T.setBackgroundFill(r(S)),o&&T.setStroke(o(S)),a&&T.setBackgroundStroke(a(S)),l&&T.setFont(l(S)),c&&T.setMaxAngle(c(S)),h&&T.setOffsetX(h(S)),u&&T.setOffsetY(u(S)),d&&T.setOverflow(d(S)),g){const v=g(S);if(v!=="point"&&v!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(v)}if(f&&T.setRepeat(f(S)),m&&T.setScale(m(S)),_&&T.setRotateWithView(_(S)),p&&T.setRotation(p(S)),y){const v=y(S);if(v!=="left"&&v!=="center"&&v!=="right"&&v!=="end"&&v!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(v)}if(x){const v=x(S);if(v!=="left"&&v!=="right"&&v!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(v)}if(E){const v=E(S);if(v!=="bottom"&&v!=="top"&&v!=="middle"&&v!=="alphabetic"&&v!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(v)}return w&&T.setPadding(w(S)),C&&T.setKeepUpright(C(S)),T}}function Kg(s,e){return"icon-src"in s?Hg(s,e):"shape-points"in s?Zg(s,e):"circle-radius"in s?qg(s,e):null}function Hg(s,e){const t="icon-",i=t+"src",n=fh(s[i],i),r=Bs(s,t+"anchor",e),o=yr(s,t+"scale",e),a=ve(s,t+"opacity",e),l=Bs(s,t+"displacement",e),c=ve(s,t+"rotation",e),h=Yi(s,t+"rotate-with-view",e),u=Zl(s,t+"anchor-origin"),d=ql(s,t+"anchor-x-units"),g=ql(s,t+"anchor-y-units"),f=Pt(s,t+"color");let m,_=null;f!==void 0&&(Array.isArray(f)&&f.length>0&&typeof f[0]=="string"?_=pr(s,t+"color",e):m=gh(f,t+"color"));const p=Qg(s,t+"cross-origin"),y=em(s,t+"offset"),x=Zl(s,t+"offset-origin"),E=So(s,t+"width"),C=So(s,t+"height"),w=Jg(s,t+"size"),R=xr(s,t+"declutter-mode"),T={src:n,anchorOrigin:u,anchorXUnits:d,anchorYUnits:g,crossOrigin:p,offset:y,offsetOrigin:x,height:C,width:E,size:w,declutterMode:R};let S=null;return function(v){if(S)_&&S.setColor(_(v));else{const G=_?_(v):m;S=new Ji(G!==void 0?Object.assign({},T,{color:G}):Object.assign({},T))}return a&&S.setOpacity(a(v)),l&&S.setDisplacement(l(v)),c&&S.setRotation(c(v)),h&&S.setRotateWithView(h(v)),o&&S.setScale(o(v)),r&&S.setAnchor(r(v)),S}}function Zg(s,e){const t="shape-",i=t+"points",n=t+"radius",r=Ta(s[i],i);if(!(n in s))throw new Error(`Expected a number for ${n}`);const o=ve(s,n,e),a=typeof s[n]=="number"?s[n]:5,l=t+"radius2",c=ve(s,l,e),h=typeof s[l]=="number"?s[l]:void 0,u=Bn(s,t,e),d=zn(s,t,e),g=yr(s,t+"scale",e),f=Bs(s,t+"displacement",e),m=ve(s,t+"rotation",e),_=Yi(s,t+"rotate-with-view",e),p=So(s,t+"angle"),y=xr(s,t+"declutter-mode"),x=new _r({points:r,radius:a,radius2:h,angle:p,declutterMode:y});return function(E){return o&&x.setRadius(o(E)),c&&x.setRadius2(c(E)),u&&x.setFill(u(E)),d&&x.setStroke(d(E)),f&&x.setDisplacement(f(E)),m&&x.setRotation(m(E)),_&&x.setRotateWithView(_(E)),g&&x.setScale(g(E)),x}}function qg(s,e){const t="circle-",i=Bn(s,t,e),n=zn(s,t,e),r=ve(s,t+"radius",e),o=yr(s,t+"scale",e),a=Bs(s,t+"displacement",e),l=ve(s,t+"rotation",e),c=Yi(s,t+"rotate-with-view",e),h=xr(s,t+"declutter-mode"),u=new es({radius:5,declutterMode:h});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),n&&u.setStroke(n(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),c&&u.setRotateWithView(c(d)),o&&u.setScale(o(d)),u}}function Pt(s,e){if(!(e in s))return;const t=s[e];return t===void 0?void 0:t}function ve(s,e,t){const i=Pt(s,e);if(i===void 0)return;const n=_t(i,J,t);return function(r){return Ta(n(r),e)}}function Tt(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,ke,t);return function(r){return fh(n(r),e)}}function $g(s,e,t){const i=Tt(s,e+"pattern-src",t),n=Hl(s,e+"pattern-offset",t),r=Hl(s,e+"pattern-size",t),o=pr(s,e+"color",t);return function(a){return{src:i(a),offset:n&&n(a),size:r&&r(a),color:o&&o(a)}}}function Yi(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,Le,t);return function(r){const o=n(r);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${e}`);return o}}function pr(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,Je,t);return function(r){return gh(n(r),e)}}function dh(s,e,t){const i=Pt(s,e);if(i===void 0)return null;if(Array.isArray(i)&&(i.length===0||typeof i[0]!="string")){const r=i.map((o,a)=>{if(typeof o=="number")return()=>o;const l=_t(o,J,t);return function(c){return Ta(l(c),`${e}[${a}]`)}});return function(o){const a=new Array(r.length);for(let l=0;l<r.length;++l)a[l]=r[l](o);return a}}const n=_t(i,pi,t);return function(r){return ts(n(r),e)}}function Bs(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,pi,t);return function(r){const o=ts(n(r),e);if(o.length!==2)throw new Error(`Expected two numbers for ${e}`);return o}}function Hl(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,pi,t);return function(r){return mh(n(r),e)}}function yr(s,e,t){const i=Pt(s,e);if(i===void 0)return null;const n=_t(i,pi|J,t);return function(r){return tm(n(r),e)}}function So(s,e){const t=s[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function Jg(s,e){const t=s[e];if(t!==void 0){if(typeof t=="number")return ye(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function Qg(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Zl(s,e){const t=s[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function ql(s,e){const t=s[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function em(s,e){const t=s[e];if(t!==void 0)return ts(t,e)}function xr(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function ts(s,e){if(!Array.isArray(s))throw new Error(`Expected an array for ${e}`);const t=s.length;for(let i=0;i<t;++i)if(typeof s[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return s}function fh(s,e){if(typeof s!="string")throw new Error(`Expected a string for ${e}`);return s}function Ta(s,e){if(typeof s!="number")throw new Error(`Expected a number for ${e}`);return s}function gh(s,e){if(typeof s=="string")return s;const t=ts(s,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function mh(s,e){const t=ts(s,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function tm(s,e){return typeof s=="number"?s:mh(s,e)}const $l={RENDER_ORDER:"renderOrder"};class Ra extends dr{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get($l.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new th(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set($l.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?uh:e;const t=im(e);this.styleFunction_=e===null?void 0:zg(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function im(s){if(s===void 0)return uh;if(!s)return null;if(typeof s=="function"||s instanceof He)return s;if(!Array.isArray(s))return Kl([s]);if(s.length===0)return[];const e=s.length,t=s[0];if(t instanceof He){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!(o instanceof He))throw new Error("Expected a list of style instances");n[r]=o}return n}if("style"in t){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[r]=o}return Vg(n)}return Kl(s)}class nm extends bt{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}function Er(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xy(s,e){return s[0]=e[0],s[1]=e[1],s[4]=e[2],s[5]=e[3],s[12]=e[4],s[13]=e[5],s}function Io(s,e,t,i,n,r,o){o=o??Er();const a=1/(s-e),l=1/(t-i),c=1/(n-r);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*c,o[11]=0,o[12]=(s+e)*a,o[13]=(i+t)*l,o[14]=(r+n)*c,o[15]=1,o}function Jl(s,e,t,i,n){return n=n??Er(),n[0]=s[0]*e,n[1]=s[1]*e,n[2]=s[2]*e,n[3]=s[3]*e,n[4]=s[4]*t,n[5]=s[5]*t,n[6]=s[6]*t,n[7]=s[7]*t,n[8]=s[8]*i,n[9]=s[9]*i,n[10]=s[10]*i,n[11]=s[11]*i,n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n}function sm(s,e,t,i,n){n=n??Er();let r,o,a,l,c,h,u,d,g,f,m,_;return s===n?(n[12]=s[0]*e+s[4]*t+s[8]*i+s[12],n[13]=s[1]*e+s[5]*t+s[9]*i+s[13],n[14]=s[2]*e+s[6]*t+s[10]*i+s[14],n[15]=s[3]*e+s[7]*t+s[11]*i+s[15]):(r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],g=s[8],f=s[9],m=s[10],_=s[11],n[0]=r,n[1]=o,n[2]=a,n[3]=l,n[4]=c,n[5]=h,n[6]=u,n[7]=d,n[8]=g,n[9]=f,n[10]=m,n[11]=_,n[12]=r*e+c*t+g*i+s[12],n[13]=o*e+h*t+f*i+s[13],n[14]=a*e+u*t+m*i+s[14],n[15]=l*e+d*t+_*i+s[15]),n}function rm(s,e,t,i){return i=i??Er(),i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s,i[13]=e,i[14]=t,i[15]=1,i}class is extends er{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(ie.CHANGE)}release(){this.setState(D.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==D.EMPTY){if(this.state!==D.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){$()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:Dc(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function zs(s){return s instanceof Image||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageBitmap?s:null}function om(s){return s instanceof Uint8Array||s instanceof Uint8ClampedArray||s instanceof Float32Array||s instanceof DataView?s:null}const am=new Error("disposed");let Fi=null;function lm(s){Fi||(Fi=ae(s.width,s.height,void 0,{willReadFrequently:!0}));const e=Fi.canvas,t=s.width;e.width!==t&&(e.width=t);const i=s.height;return e.height!==i&&(e.height=i),Fi.clearRect(0,0,t,i),Fi.drawImage(s,0,0),Fi.getImageData(0,0,t,i).data}const cm=[256,256];class js extends is{constructor(e){const t=D.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=zs(this.data_);return e?[e.width,e.height]:cm}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==D.IDLE&&this.state!==D.ERROR)return;this.state=D.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=D.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=D.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(am),this.controller_=null),super.disposeInternal()}}class _h extends is{constructor(e,t,i,n,r,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_,It?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,n!==null&&(this.image_.crossOrigin=n)),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=D.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=D.ERROR,this.unlistenImage_(),this.image_=hm(),this.changed()}handleImageLoad_(){if(It)this.state=D.LOADED;else{const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=D.LOADED:this.state=D.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==D.ERROR&&(this.state=D.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==D.IDLE&&(this.state=D.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Lg(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function hm(){const s=ae(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}let Jr;const Wi=[];function Ql(s,e,t,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),s.restore()}function Qr(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function um(){if(Jr===void 0){const s=ae(6,6,Wi);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",Ql(s,4,5,4,0),Ql(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;Jr=Qr(e,0)||Qr(e,4)||Qr(e,8),Qn(s),Wi.push(s.canvas)}return Jr}function jn(s,e,t,i){const n=Ci(t,e,s);let r=Sl(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=s.getMetersPerUnit();a!==void 0&&(r/=a);const l=s.getExtent();if(!l||gi(l,n)){const c=Sl(s,r,n)/r;isFinite(c)&&c>0&&(r/=c)}return r}function ph(s,e,t,i){const n=Me(t);let r=jn(s,e,n,i);return(!isFinite(r)||r<=0)&&Ho(t,function(o){return r=jn(s,e,o,i),isFinite(r)&&r>0}),r}function yh(s,e,t,i,n,r,o,a,l,c,h,u,d,g){const f=ae(Math.round(t*s),Math.round(t*e),Wi);if(u||(f.imageSmoothingEnabled=!1),l.length===0)return f.canvas;f.scale(t,t);function m(C){return Math.round(C*t)/t}f.globalCompositeOperation="lighter";const _=Fe();l.forEach(function(C,w,R){Ko(_,C.extent)});let p;const y=t/i,x=(u?1:1+Math.pow(2,-24))/y;(!d||l.length!==1||c!==0)&&(p=ae(Math.round(Z(_)*y),Math.round(le(_)*y),Wi),u||(p.imageSmoothingEnabled=!1),l.forEach(function(C,w,R){if(C.image.width>0&&C.image.height>0){if(C.clipExtent){p.save();const A=(C.clipExtent[0]-_[0])*y,P=-(C.clipExtent[3]-_[3])*y,F=Z(C.clipExtent)*y,L=le(C.clipExtent)*y;p.rect(u?A:Math.round(A),u?P:Math.round(P),u?F:Math.round(A+F)-Math.round(A),u?L:Math.round(P+L)-Math.round(P)),p.clip()}const T=(C.extent[0]-_[0])*y,S=-(C.extent[3]-_[3])*y,v=Z(C.extent)*y,G=le(C.extent)*y;p.drawImage(C.image,c,c,C.image.width-2*c,C.image.height-2*c,u?T:Math.round(T),u?S:Math.round(S),u?v:Math.round(T+v)-Math.round(T),u?G:Math.round(S+G)-Math.round(S)),C.clipExtent&&p.restore()}}));const E=ft(o);return a.getTriangles().forEach(function(C,w,R){const T=C.source,S=C.target;let v=T[0][0],G=T[0][1],A=T[1][0],P=T[1][1],F=T[2][0],L=T[2][1];const U=m((S[0][0]-E[0])/r),O=m(-(S[0][1]-E[1])/r),k=m((S[1][0]-E[0])/r),N=m(-(S[1][1]-E[1])/r),z=m((S[2][0]-E[0])/r),X=m(-(S[2][1]-E[1])/r),M=v,q=G;v=0,G=0,A-=M,P-=q,F-=M,L-=q;const ee=[[A,P,0,0,k-U],[F,L,0,0,z-U],[0,0,A,P,N-O],[0,0,F,L,X-O]],Q=cd(ee);if(!Q)return;if(f.save(),f.beginPath(),um()||!u){f.moveTo(k,N);const oe=4,De=U-k,Se=O-N;for(let fe=0;fe<oe;fe++)f.lineTo(k+m((fe+1)*De/oe),N+m(fe*Se/(oe-1))),fe!=oe-1&&f.lineTo(k+m((fe+1)*De/oe),N+m((fe+1)*Se/(oe-1)));f.lineTo(z,X)}else f.moveTo(k,N),f.lineTo(U,O),f.lineTo(z,X);f.clip(),f.transform(Q[0],Q[2],Q[1],Q[3],U,O),f.translate(_[0]-M,_[3]-q);let re;if(p)re=p.canvas,f.scale(x,-x);else{const oe=l[0],De=oe.extent;re=oe.image,f.scale(Z(De)/re.width,-le(De)/re.height)}f.drawImage(re,0,0),f.restore()}),p&&(Qn(p),Wi.push(p.canvas)),h&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,a.getTriangles().forEach(function(C,w,R){const T=C.target,S=(T[0][0]-E[0])/r,v=-(T[0][1]-E[1])/r,G=(T[1][0]-E[0])/r,A=-(T[1][1]-E[1])/r,P=(T[2][0]-E[0])/r,F=-(T[2][1]-E[1])/r;f.beginPath(),f.moveTo(G,A),f.lineTo(S,v),f.lineTo(P,F),f.closePath(),f.stroke()}),f.restore()),f.canvas}const dm=10,ec=.25;class Sa{constructor(e,t,i,n,r,o,a){this.sourceProj_=e,this.targetProj_=t;let l={};const c=a?Qd(x=>we(a,Ci(x,this.targetProj_,this.sourceProj_))):gt(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const E=x[0]+"/"+x[1];return l[E]||(l[E]=c(x)),l[E]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Z(n)>=Z(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Z(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Z(this.targetProj_.getExtent()):null;const h=ft(i),u=nr(i),d=ir(i),g=tr(i),f=this.transformInv_(h),m=this.transformInv_(u),_=this.transformInv_(d),p=this.transformInv_(g),y=dm+(o?Math.max(0,Math.ceil(Math.log2(Ln(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,d,g,f,m,_,p,y),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(E,C,w){x=Math.min(x,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-x>this.sourceWorldWidth_/2){const C=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];C[0][0]-x>this.sourceWorldWidth_/2&&(C[0][0]-=this.sourceWorldWidth_),C[1][0]-x>this.sourceWorldWidth_/2&&(C[1][0]-=this.sourceWorldWidth_),C[2][0]-x>this.sourceWorldWidth_/2&&(C[2][0]-=this.sourceWorldWidth_);const w=Math.min(C[0][0],C[1][0],C[2][0]);Math.max(C[0][0],C[1][0],C[2][0])-w<this.sourceWorldWidth_/2&&(E.source=C)}})}l={}}addTriangle_(e,t,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[e,t,i]})}addQuad_(e,t,i,n,r,o,a,l,c){const h=Fs([r,o,a,l]),u=this.sourceWorldWidth_?Z(h)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const _=Fs([e,t,i,n]);f=Z(_)/this.targetWorldWidth_>ec||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>ec||f)}if(!f&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!ce(h,this.maxSourceExtent_))return;let m=0;if(!f&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)f=!0;else if(m=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!f){const _=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(_);let y;g?y=(Wt(r[0],d)+Wt(a[0],d))/2-Wt(p[0],d):y=(r[0]+a[0])/2-p[0];const x=(r[1]+a[1])/2-p[1];f=y*y+x*x>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const _=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(_),y=[(n[0]+e[0])/2,(n[1]+e[1])/2],x=this.transformInv_(y);this.addQuad_(e,t,_,y,r,o,p,x,c-1),this.addQuad_(y,_,i,n,x,p,a,l,c-1)}else{const _=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(_),y=[(i[0]+n[0])/2,(i[1]+n[1])/2],x=this.transformInv_(y);this.addQuad_(e,_,y,n,r,p,x,l,c-1),this.addQuad_(_,t,i,y,p,o,a,x,c-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}m&11||this.addTriangle_(e,i,n,r,a,l),m&14||this.addTriangle_(e,i,t,r,a,o),m&&(m&13||this.addTriangle_(t,n,e,o,l,r),m&7||this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=Fe();return this.triangles_.forEach(function(t,i,n){const r=t.source;Sn(e,r[0]),Sn(e,r[1]),Sn(e,r[2])}),e}getTriangles(){return this.triangles_}}const Ia=.5;class xh extends is{constructor(e,t,i,n,r,o,a,l,c,h,u,d){super(r,D.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const g=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const _=f?Ae(g,f):g;if(Ln(_)===0){this.state=D.EMPTY;return}const p=e.getExtent();p&&(m?m=Ae(m,p):m=p);const y=n.getResolution(this.wrappedTileCoord_[0]),x=ph(e,i,_,y);if(!isFinite(x)||x<=0){this.state=D.EMPTY;return}const E=h!==void 0?h:Ia;if(this.triangulation_=new Sa(e,i,_,m,x*E,y),this.triangulation_.getTriangles().length===0){this.state=D.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let C=this.triangulation_.calculateSourceExtent();if(m&&(e.canWrapX()?(C[1]=he(C[1],m[1],m[3]),C[3]=he(C[3],m[1],m[3])):C=Ae(C,m)),!Ln(C))this.state=D.EMPTY;else{let w=0,R=0;e.canWrapX()&&(w=Z(p),R=Math.floor((C[0]-p[0])/w)),qo(C.slice(),e,!0).forEach(S=>{const v=t.getTileRangeForExtentAndZ(S,this.sourceZ_);for(let G=v.minX;G<=v.maxX;G++)for(let A=v.minY;A<=v.maxY;A++){const P=R*w;this.sourceTiles_.push({getTile:()=>c(this.sourceZ_,G,A,a),offset:P})}++R}),this.sourceTiles_.length===0&&(this.state=D.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{var n;const i=t.tile;if(i&&i.getState()==D.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const o=(n=this.clipExtent_)==null?void 0:n.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=D.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=yh(n,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=D.LOADED}this.changed()}load(){for(const e of this.sourceTiles_)e.tile=e.getTile();if(this.state==D.IDLE){this.state=D.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==D.IDLE||i==D.LOADING){e++;const n=me(t,ie.CHANGE,r=>{const o=t.getState();(o==D.LOADED||o==D.ERROR||o==D.EMPTY)&&(xe(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,n){t.getState()==D.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Qn(this.canvas_.getContext("2d")),Wi.push(this.canvas_),this.canvas_=null),this.sourceTiles_.length=0,super.release()}}class va{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Mi(s,e,t,i,n){return n!==void 0?(n.minX=s,n.maxX=e,n.minY=t,n.maxY=i,n):new va(s,e,t,i)}class Xs{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof jo&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return se(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return se(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){se(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Vs(s,e,t,i){return i!==void 0?(i[0]=s,i[1]=e,i[2]=t,i):[s,e,t]}function Eh(s,e,t){return s+"/"+e+"/"+t}function Vy(s){return Eh(s[0],s[1],s[2])}function An(s,e,t,i,n){return`${Y(s)},${e},${Eh(t,i,n)}`}function Ch(s){return fm(s[0],s[1],s[2])}function fm(s,e,t){return(e<<s)+t}function gm(s,e){const t=s[0],i=s[1],n=s[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,n):!0}const mm=5;class _m extends nn{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=mm}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return $()}getData(e){return null}prepareFrame(e){return $()}renderFrame(e,t){return $()}forEachFeatureAtCoordinate(e,t,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===B.LOADED||t.getState()===B.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=B.LOADED&&t!=B.ERROR&&e.addEventListener(ie.CHANGE,this.boundHandleImageChange_),t==B.IDLE&&(e.load(),t=e.getState()),t==B.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const jt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class pm extends dr{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(jt.PRELOAD)}setPreload(e){this.set(jt.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(jt.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(jt.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const Oi=[0,0,0],Dt=5;class Cr{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,se(ed(this.resolutions_,(n,r)=>r-n),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,se(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ft(i)),se(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,se(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:pa,se(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,r)=>{const o=new va(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,n){let r,o,a,l=null,c=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=Mi(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,c,i),t(c,r))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getOrigins(){return this.origins_}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return Mi(r,r+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],o=e[2];if(t===n)return Mi(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),c=Math.floor(r*l),h=Math.floor(o*l);if(t<n)return Mi(c,c,h,h,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return Mi(c,u,h,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Oi);const n=Oi[1],r=Oi[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Oi);const o=Oi[1],a=Oi[2];return Mi(n,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=ye(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=ye(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*n,a=i[1]-(e[2]+1)*r[1]*n,l=o+r[0]*n,c=a+r[1]*n;return dt(o,a,l,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),c=ye(this.getTileSize(o),this.tmpSize_);let h=a*(e-l[0])/i/c[0],u=a*(l[1]-t)/i/c[1];return n?(h=Bt(h,Dt)-1,u=Bt(u,Dt)-1):(h=zi(h,Dt),u=zi(u,Dt)),Vs(o,h,u,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const o=this.getOrigin(i),a=this.getResolution(i),l=ye(this.getTileSize(i),this.tmpSize_);let c=(e-o[0])/a/l[0],h=(o[1]-t)/a/l[1];return n?(c=Bt(c,Dt)-1,h=Bt(h,Dt)-1):(c=zi(c,Dt),h=zi(h,Dt)),Vs(i,c,h,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Qs(this.resolutions_,e,t||0);return he(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Zc(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}class wh extends Cr{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function ym(s,e,t){const i=[],n=[],r=[],o=[],a=[];t=t!==void 0?t:[];const l="SupportedCRS",c="TileMatrix",h="Identifier",u="ScaleDenominator",d="TopLeftCorner",g="TileWidth",f="TileHeight",m=s[l],_=H(m),p=_.getMetersPerUnit(),y=_.getAxisOrientation().startsWith("ne");return s[c].sort(function(x,E){return E[u]-x[u]}),s[c].forEach(function(x){let E;if(t.length>0?E=t.find(function(C){return x[h]==C[c]?!0:x[h].includes(":")?!1:s[h]+":"+x[h]===C[c]}):E=!0,E){n.push(x[h]);const C=x[u]*28e-5/p,w=x[g],R=x[f];y?r.push([x[d][1],x[d][0]]):r.push(x[d]),i.push(C),o.push(w==R?w:[w,R]),a.push([x.MatrixWidth,x.MatrixHeight])}}),new wh({extent:e,origins:r,resolutions:i,matrixIds:n,tileSizes:o,sizes:a})}const xm=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,Em=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Cm{constructor(e){this.gl_=e,this.program_=vo(e,Em,xm),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,i,n,r,o,a,l,c,h,u,d,g){const f=this.gl_;l===void 0&&(l=n),c===void 0&&(c=r),o===void 0&&(o=t),a===void 0&&(a=i),h===void 0&&(h=o),u===void 0&&(u=a),d===void 0&&(d=f.canvas.width),g===void 0&&(g=f.canvas.height),f.bindTexture(f.TEXTURE_2D,e),f.useProgram(this.program_),f.bindBuffer(f.ARRAY_BUFFER,this.positionBuffer),f.enableVertexAttribArray(this.positionLocation),f.vertexAttribPointer(this.positionLocation,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.texcoordBuffer),f.enableVertexAttribArray(this.texcoordLocation),f.vertexAttribPointer(this.texcoordLocation,2,f.FLOAT,!1,0,0);let m=Io(0,d,0,g,-1,1);m=sm(m,l,c,0),m=Jl(m,h,u,1),f.uniformMatrix4fv(this.matrixLocation,!1,m);let _=rm(n/t,r/i,0);_=Jl(_,o/t,a/i,1),f.uniformMatrix4fv(this.textureMatrixLocation,!1,_),f.uniform1i(this.textureLocation,0),f.drawArrays(f.TRIANGLES,0,this.positions.length/2)}}function tc(s,e,t){const i=s.createShader(e);if(i===null)throw new Error("Shader compilation failed");if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){const n=s.getShaderInfoLog(i);throw n===null?new Error("Shader info log creation failed"):new Error(n)}return i}function vo(s,e,t){const i=s.createProgram(),n=tc(s,s.VERTEX_SHADER,t),r=tc(s,s.FRAGMENT_SHADER,e);if(i===null)throw new Error("Program creation failed");if(s.attachShader(i,n),s.attachShader(i,r),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS))throw s.getProgramInfoLog(i)===null?new Error("Program info log creation failed"):new Error;return i}const wm=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,Tm=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,Rm=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,Sm=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Im(s,e,t,i){let n;return t&&t.length?n=t.shift():It?n=new OffscreenCanvas(s||300,e||300):n=document.createElement("canvas"),s&&(n.width=s),e&&(n.height=e),n.getContext("webgl",i)}function vm(s){const e=s.canvas;e.width=1,e.height=1,s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT)}const ic=[];function Am(s,e,t,i,n,r,o,a,l,c,h,u,d,g){const f=Math.round(i*e),m=Math.round(i*t);s.canvas.width=f,s.canvas.height=m;let _,p;if(p=s.createTexture(),s.bindTexture(s.TEXTURE_2D,p),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),d?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST)),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,f,m,0,s.RGBA,h,null),_=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,_),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,p,0),_===null)throw new Error("Could not create framebuffer");if(p===null)throw new Error("Could not create texture");if(l.length===0)return{width:f,height:m,framebuffer:_,texture:p};const y=Fe();l.forEach(function(v,G,A){Ko(y,v.extent)});let x,E,C;const w=1/n;{if(x=s.createTexture(),p===null)throw new Error("Could not create texture");E=Math.round(Z(y)*w),C=Math.round(le(y)*w);const v=s.getParameter(s.MAX_TEXTURE_SIZE),G=Math.max(E,C),A=G>v?v/G:1,P=Math.round(E*A),F=Math.round(C*A);s.bindTexture(s.TEXTURE_2D,x),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),d?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST)),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,P,F,0,s.RGBA,h,null);const L=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,L),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,x,0);const U=new Cm(s);l.forEach(function(O,k,N){const z=(O.extent[0]-y[0])*w*A,X=-(O.extent[3]-y[3])*w*A,M=Z(O.extent)*w*A,q=le(O.extent)*w*A;if(s.bindFramebuffer(s.FRAMEBUFFER,L),s.viewport(0,0,P,F),O.clipExtent){const ee=(O.clipExtent[0]-y[0])*w*A,Q=-(O.clipExtent[3]-y[3])*w*A,re=Z(O.clipExtent)*w*A,oe=le(O.clipExtent)*w*A;s.enable(s.SCISSOR_TEST),s.scissor(d?ee:Math.round(ee),d?Q:Math.round(Q),d?re:Math.round(ee+re)-Math.round(ee),d?oe:Math.round(Q+oe)-Math.round(Q))}U.drawImage(O.texture,O.width,O.height,c,c,O.width-2*c,O.height-2*c,d?z:Math.round(z),d?X:Math.round(X),d?M:Math.round(z+M)-Math.round(z),d?q:Math.round(X+q)-Math.round(X),P,F),s.disable(s.SCISSOR_TEST)}),s.deleteFramebuffer(L)}const R=ft(o),T=ft(y),S=v=>{const G=(v[0][0]-R[0])/r*i,A=-(v[0][1]-R[1])/r*i,P=(v[1][0]-R[0])/r*i,F=-(v[1][1]-R[1])/r*i,L=(v[2][0]-R[0])/r*i,U=-(v[2][1]-R[1])/r*i;return{u1:P,v1:F,u0:G,v0:A,u2:L,v2:U}};s.bindFramebuffer(s.FRAMEBUFFER,_),s.viewport(0,0,f,m);{const v=[],G=[],A=vo(s,Sm,Rm);s.useProgram(A);const P=s.getUniformLocation(A,"u_texture");s.bindTexture(s.TEXTURE_2D,x),s.uniform1i(P,0),a.getTriangles().forEach(function(z,X,M){const q=z.source,ee=z.target,{u1:Q,v1:re,u0:oe,v0:De,u2:Se,v2:fe}=S(ee),Ti=(q[0][0]-T[0])/n/E,an=-(q[0][1]-T[1])/n/C,Qt=(q[1][0]-T[0])/n/E,pt=-(q[1][1]-T[1])/n/C,Ge=(q[2][0]-T[0])/n/E,Xe=-(q[2][1]-T[1])/n/C;v.push(Q,re,oe,De,Se,fe),G.push(Qt,pt,Ti,an,Ge,Xe)});const F=Io(0,f,m,0,-1,1),L=s.getUniformLocation(A,"u_matrix");s.uniformMatrix4fv(L,!1,F);const U=s.getAttribLocation(A,"a_position"),O=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,O),s.bufferData(s.ARRAY_BUFFER,new Float32Array(v),s.STATIC_DRAW),s.vertexAttribPointer(U,2,s.FLOAT,!1,0,0),s.enableVertexAttribArray(U);const k=s.getAttribLocation(A,"a_texcoord"),N=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,N),s.bufferData(s.ARRAY_BUFFER,new Float32Array(G),s.STATIC_DRAW),s.vertexAttribPointer(k,2,s.FLOAT,!1,0,0),s.enableVertexAttribArray(k),s.drawArrays(s.TRIANGLES,0,v.length/2)}if(u){const v=vo(s,Tm,wm);s.useProgram(v);const G=Io(0,f,m,0,-1,1),A=s.getUniformLocation(v,"u_matrix");s.uniformMatrix4fv(A,!1,G);const P=Array.isArray(u)?u:[0,0,0,255],F=s.getUniformLocation(v,"u_val");s.uniform4fv(F,P);const L=s.getAttribLocation(v,"a_position"),U=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,U),s.vertexAttribPointer(L,2,s.FLOAT,!1,0,0),s.enableVertexAttribArray(L);const O=a.getTriangles().reduce(function(k,N){const z=N.target,{u1:X,v1:M,u0:q,v0:ee,u2:Q,v2:re}=S(z);return k.concat([X,M,q,ee,q,ee,Q,re,Q,re,X,M])},[]);s.bufferData(s.ARRAY_BUFFER,new Float32Array(O),s.STATIC_DRAW),s.drawArrays(s.LINES,0,O.length/2)}return{width:f,height:m,framebuffer:_,texture:p}}class bm extends js{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,i=t.getExtent(),n=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?n?Ae(i,n):i:n;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?Ae(r,o):r;if(Ln(l)===0){this.state=D.EMPTY;return}i&&(a?a=Ae(a,i):a=i);const c=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,u=ph(t,h,l,c);if(!isFinite(u)||u<=0){this.state=D.EMPTY;return}const d=e.errorThreshold!==void 0?e.errorThreshold:Ia;if(this.triangulation_=new Sa(t,h,l,a,u*d,c,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=D.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let g=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(g[1]=he(g[1],a[1],a[3]),g[3]=he(g[3],a[1],a[3])):g=Ae(g,a)),!Ln(g))this.state=D.EMPTY;else{let f=0,m=0;t.canWrapX()&&(f=Z(i),m=Math.floor((g[0]-i[0])/f)),qo(g.slice(),t,!0).forEach(p=>{const y=this.sourceTileGrid_.getTileRangeForExtentAndZ(p,this.sourceZ_),x=e.getTileFunction;for(let E=y.minX;E<=y.maxX;E++)for(let C=y.minY;C<=y.maxY;C++){const w=x(this.sourceZ_,E,C,this.pixelRatio_);if(w){const R=m*f;this.sourceTiles_.push({tile:w,offset:R})}}++m}),this.sourceTiles_.length===0&&(this.state=D.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(E=>{var X;const C=E.tile;if(!C||C.getState()!==D.LOADED)return;const w=C.getSize(),R=this.gutter_;let T;const S=om(C.getData());S?T=S:(t=!0,T=lm(zs(C.getData())));const v=[w[0]+2*R,w[1]+2*R],G=T instanceof Float32Array,A=v[0]*v[1],P=G?Float32Array:Uint8ClampedArray,F=new P(T.buffer),L=P.BYTES_PER_ELEMENT,U=L*F.length/A,O=F.byteLength/v[1],k=Math.floor(O/L/v[0]),N=this.sourceTileGrid_.getTileCoordExtent(C.tileCoord);N[0]+=E.offset,N[2]+=E.offset;const z=(X=this.clipExtent_)==null?void 0:X.slice();z&&(z[0]+=E.offset,z[2]+=E.offset),e.push({extent:N,clipExtent:z,data:F,dataType:P,bytesPerPixel:U,pixelSize:v,bandCount:k})}),this.sourceTiles_.length=0,e.length===0){this.state=D.ERROR,this.changed();return}const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),r=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],a=Math.round(r*this.pixelRatio_),l=Math.round(o*this.pixelRatio_),c=this.targetTileGrid_.getResolution(i),h=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),d=e[0].bandCount,g=new e[0].dataType(d*a*l),f=Im(a,l,ic,{premultipliedAlpha:!1,antialias:!1});let m;const _=f.RGBA;let p;e[0].dataType==Float32Array?(p=f.FLOAT,f.getExtension("WEBGL_color_buffer_float"),f.getExtension("OES_texture_float"),f.getExtension("EXT_float_blend"),m=f.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(p=f.UNSIGNED_BYTE,m=this.interpolate);const y=4,x=Math.ceil(d/y);for(let E=x-1;E>=0;--E){const C=[];for(let P=0,F=e.length;P<F;++P){const L=e[P],U=L.pixelSize,O=U[0],k=U[1],N=new L.dataType(y*O*k),z=L.data;let X=E*y;for(let q=0,ee=N.length;q<ee;q+=y)N[q]=z[X],N[q+1]=z[X+1],N[q+2]=z[X+2],N[q+3]=z[X+3],X+=d;const M=f.createTexture();f.bindTexture(f.TEXTURE_2D,M),m?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR)):(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST)),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,_,O,k,0,_,p,N),C.push({extent:L.extent,clipExtent:L.clipExtent,texture:M,width:O,height:k})}const{framebuffer:w,width:R,height:T}=Am(f,r,o,this.pixelRatio_,h,c,u,this.triangulation_,C,this.gutter_,p,this.renderEdges_,m),S=R,v=T*y,G=new e[0].dataType(S*v);f.bindFramebuffer(f.FRAMEBUFFER,w),f.readPixels(0,0,R,T,f.RGBA,p,G);let A=E*y;for(let P=0,F=G.length;P<F;P+=y){const L=(S-1-(P/v|0))*v+P%v;g[A]=G[L],g[A+1]=G[L+1],g[A+2]=G[L+2],g[A+3]=G[L+3],A+=d}}if(vm(f),ic.push(f.canvas),t){const E=ae(r,o),C=new ImageData(g,r);E.putImageData(C,0,0),this.reprojData_=E.canvas}else this.reprojData_=g;this.reprojSize_=[a,l],this.state=D.LOADED,this.changed()}load(){if(this.state!==D.IDLE&&this.state!==D.ERROR)return;this.state=D.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i!==D.IDLE&&i!==D.LOADING)return;e++;const n=me(t,ie.CHANGE,()=>{const r=t.getState();(r==D.LOADED||r==D.ERROR||r==D.EMPTY)&&(xe(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==D.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}}function ns(s){let e=s.getDefaultTileGrid();return e||(e=Fm(s),s.setDefaultTileGrid(e)),e}function Lm(s,e,t){const i=e[0],n=s.getTileCoordCenter(e),r=sn(t);if(!gi(r,n)){const o=Z(r),a=Math.ceil((r[0]-n[0])/o);return n[0]+=o*a,s.getTileCoordForCoordAndZ(n,i)}return e}function Pm(s,e,t,i){i=i!==void 0?i:"top-left";const n=Th(s,e,t);return new Cr({extent:s,origin:gd(s,i),resolutions:n,tileSize:t})}function wr(s){const e=s||{},t=e.extent||H("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Th(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Cr(i)}function Th(s,e,t,i){e=e!==void 0?e:Qc,t=ye(t!==void 0?t:pa);const n=le(s),r=Z(s);i=i>0?i:Math.max(r/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Fm(s,e,t,i){const n=sn(s);return Pm(n,e,t,i)}function sn(s){s=H(s);let e=s.getExtent();if(!e){const t=180*Pn.degrees/s.getMetersPerUnit();e=dt(-t,-t,t,t)}return e}class ss extends $t{constructor(e){super(),this.projection=H(e.projection),this.attributions_=nc(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=nc(e),this.changed()}setState(e){this.state_=e,this.changed()}}function nc(s){return s?typeof s=="function"?s:(Array.isArray(s)||(s=[s]),e=>s):null}class Aa extends ss{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&ye(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||Y(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r,o){return $()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:ns(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=ye(n.getTileSize(e),this.tmpSize);return r==1?o:rg(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),n=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=Lm(n,e,i)),gm(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class Rh extends bt{constructor(e,t){super(e),this.tile=t}}const Ki={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Yy extends Aa{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=wr({extent:sn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?ye(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?ye(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||de(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,n,r,o){const a=this.tileGrid||this.getTileGridForProjection(r||n),l=Math.max.apply(null,a.getResolutions().map((f,m)=>{const _=ye(a.getTileSize(m)),p=this.getTileSize(m);return Math.max(p[0]/_[0],p[1]/_[1])})),c=this.getTileGridForProjection(n),h=[e,t,i],u=this.getTileCoordForTileUrlFunction(h,n),d=Object.assign({sourceProj:r||n,sourceTileGrid:a,targetProj:n,targetTileGrid:c,tileCoord:h,wrappedTileCoord:u,pixelRatio:l,gutter:this.gutter_,getTileFunction:(f,m,_,p)=>this.getTile(f,m,_,p,void 0,o),transformMatrix:this.transformMatrix},this.tileOptions),g=new bm(d);return g.key=this.getKey(),g}getTile(e,t,i,n,r,o){var w;const a=this.getProjection();if(r&&(a&&!de(a,r)||this.transformMatrix))return this.getReprojTile_(e,t,i,r,a,o);const l=this.getTileSize(e),c=this.loader_,h=new AbortController,u={signal:h.signal,crossOrigin:this.crossOrigin_},d=this.getTileCoordForTileUrlFunction([e,t,i]);if(!d)return null;const g=this.getKey(),f=An(this,g,e,t,i);if(o&&o.containsKey(f))return o.get(f);const m=d[0],_=d[1],p=d[2],y=(w=this.getTileGrid())==null?void 0:w.getFullTileRange(m);y&&(u.maxY=y.getHeight()-1);function x(){return vc(function(){return c(m,_,p,u)})}const E=Object.assign({tileCoord:[e,t,i],loader:x,size:l,controller:h},this.tileOptions),C=new js(E);return C.key=this.getKey(),C.addEventListener(ie.CHANGE,this.handleTileChange_),o==null||o.set(f,C),C}handleTileChange_(e){const t=e.target,i=Y(t),n=t.getState();let r;n==D.LOADING?(this.tileLoadingKeys_[i]=!0,r=Ki.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==D.ERROR?Ki.TILELOADERROR:n==D.LOADED?Ki.TILELOADEND:void 0),r&&this.dispatchEvent(new Rh(r,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||de(t,e))&&!this.transformMatrix)return this.tileGrid;const i=Y(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=ns(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=H(e);if(i){const n=Y(i);n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=t)}}}function Mm(s,e,t,i){const n=document.createElement("script"),r="olc_"+Y(e);function o(){delete window[r],n.parentNode.removeChild(n)}n.async=!0,n.src=s+(s.includes("?")?"&":"?")+"callback="+r;const a=setTimeout(function(){o(),t&&t()},1e4);window[r]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(n)}function Wy(s,e,t,i){let n=s.projection;if(!n&&(typeof e.crs=="string"?n=H(e.crs):"uri"in e.crs&&(n=H(e.crs.uri)),!n))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const r=e.orderedAxes,a=!(r?r.slice(0,2).map(x=>x.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):n.getAxisOrientation()).startsWith("en"),l=e.tileMatrices.sort(function(x,E){return E.cellSize-x.cellSize}),c={};for(let x=0;x<l.length;++x){const E=l[x];c[E.id]=E}const h={},u=[];if(i)for(let x=0;x<i.length;++x){const E=i[x],C=E.tileMatrix,w=c[C],R=l.indexOf(w);u[R]=C,h[C]=E}else for(let x=0;x<l.length;++x){const E=l[x].id;u.push(E)}const d=u.length,g=new Array(d),f=new Array(d),m=new Array(d),_=new Array(d),p=[-1/0,-1/0,1/0,1/0];for(let x=0;x<d;++x){const E=u[x],C=c[E],w=C.pointOfOrigin;a?g[x]=[w[1],w[0]]:g[x]=w,f[x]=C.cellSize,m[x]=[C.matrixWidth,C.matrixHeight],_[x]=[C.tileWidth,C.tileHeight];const R=h[E];if(R){const T=C.cellSize*C.tileWidth,S=g[x][0]+R.minTileCol*T,v=g[x][0]+(R.maxTileCol+1)*T,G=C.cellSize*C.tileHeight,A=C.cornerOfOrigin==="bottomLeft";let P,F;A?(P=g[x][1]+R.minTileRow*G,F=g[x][1]+(R.maxTileRow+1)*G):(P=g[x][1]-(R.maxTileRow+1)*G,F=g[x][1]-R.minTileRow*G),Ae(p,[S,P,v,F],p)}}return{grid:new wh({origins:g,resolutions:f,sizes:m,tileSizes:_,extent:i?p:void 0,matrixIds:u}),projection:n}}function Xn(s,e){const t=[];Object.keys(e).forEach(function(n){e[n]!==null&&e[n]!==void 0&&t.push(n+"="+encodeURIComponent(e[n]))});const i=t.join("&");return s=s.replace(/[?&]$/,""),s+=s.includes("?")?"&":"?",s+i}const Om=/\{z\}/g,Dm=/\{x\}/g,Gm=/\{y\}/g,km=/\{-y\}/g;function Nm(s,e,t,i,n){return s.replace(Om,e.toString()).replace(Dm,t.toString()).replace(Gm,i.toString()).replace(km,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-i).toString()})}function Sh(s){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(s);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let r;for(r=i;r<=n;++r)e.push(s.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(s),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(s.replace(t[0],n.toString()));return e}return e.push(s),e}function Um(s,e){return function(t,i,n){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return Nm(s,o,t[1],t[2],r)}}function ba(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Um(s[n],e);return Ao(i)}function Ao(s){return s.length===1?s[0]:function(e,t,i){if(!e)return;const n=Ch(e),r=Wt(n,s.length);return s[r](e,t,i)}}class Tr extends Aa{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Tr.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=Y(t),n=t.getState();let r;n==D.LOADING?(this.tileLoadingKeys_[i]=!0,r=Ki.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==D.ERROR?Ki.TILELOADERROR:n==D.LOADED?Ki.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Rh(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Sh(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(ba(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class rs extends Tr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Ih,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:_h,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!de(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||de(t,e)))return this.tileGrid;const i=Y(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=ns(e)),this.tileGridForProjection[i]}createTile_(e,t,i,n,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),c=l?this.tileUrlFunction(l,n,r):void 0,h=new this.tileClass(a,c!==void 0?D.IDLE:D.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=o,h.addEventListener(ie.CHANGE,this.handleTileChange.bind(this)),h}getTile(e,t,i,n,r,o){const a=this.getProjection();if(!a||!r||de(a,r))return this.getTileInternal(e,t,i,n,a||r);const l=[e,t,i],c=this.getKey(),h=this.getTileGridForProjection(a),u=this.getTileGridForProjection(r),d=this.getTileCoordForTileUrlFunction(l,r),g=new xh(a,h,r,u,l,d,this.getTilePixelRatio(n),this.getGutter(),(f,m,_,p)=>this.getTileInternal(f,m,_,p,a,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return g.key=c,g}getTileInternal(e,t,i,n,r,o){const a=this.getKey(),l=An(this,a,e,t,i);if(o&&o.containsKey(l))return o.get(l);const c=this.createTile_(e,t,i,n,r,a);return o==null||o.set(l,c),c}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=H(e);if(i){const n=Y(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}}function Ih(s,e){if(It){const t=s.getCrossOrigin();let i="same-origin",n="same-origin";t==="anonymous"||t===""?(i="cors",n="omit"):t==="use-credentials"&&(i="cors",n="include"),fetch(e,{mode:i,credentials:n}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.blob()}).then(r=>createImageBitmap(r)).then(r=>{var l;const o=s.getImage();o.width=r.width,o.height=r.height,o.getContext("2d").drawImage(r,0,0),(l=r.close)==null||l.call(r),o.dispatchEvent(new Event("load"))}).catch(()=>{s.getImage().dispatchEvent(new Event("error"))});return}s.getImage().src=e}class Bm extends rs{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:wr({extent:sn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const zm='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Ky extends Bm{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[zm];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:(r,o)=>{const a=r.getImage();!It&&a instanceof HTMLImageElement&&(a.referrerPolicy="origin-when-cross-origin"),(e.tileLoadFunction||Ih)(r,o)},transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}class vh{drawCustom(e,t,i,n,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const j={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ys=[j.FILL],Xt=[j.STROKE],hi=[j.BEGIN_PATH],sc=[j.CLOSE_PATH];class os extends vh{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],gi(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,i,n,r,o){const a=this.coordinates;let l=a.length;const c=this.getBufferedMaxExtent();o&&(t+=n);let h=e[t],u=e[t+1];const d=this.tmpCoordinate_;let g=!0,f,m,_;for(f=t+n;f<i;f+=n)d[0]=e[f],d[1]=e[f+1],_=mo(c,d),_!==m?(g&&(a[l++]=h,a[l++]=u,g=!1),a[l++]=d[0],a[l++]=d[1]):_===Ce.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],g=!1):g=!0,h=d[0],u=d[1],m=_;return(r&&g||f===t+n)&&(a[l++]=h,a[l++]=u),l}drawCustomCoordinates_(e,t,i,n,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],c=this.appendFlatLineCoordinates(e,t,l,n,!1,!1);r.push(c),t=l}return t}drawCustom(e,t,i,n,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let c,h,u,d,g;switch(o){case"MultiPolygon":c=e.getOrientedFlatCoordinates(),d=[];const f=e.getEndss();g=0;for(let m=0,_=f.length;m<_;++m){const p=[];g=this.drawCustomCoordinates_(c,g,f[m],a,p),d.push(p)}this.instructions.push([j.CUSTOM,l,d,e,i,xo,r]),this.hitDetectionInstructions.push([j.CUSTOM,l,d,e,n||i,xo,r]);break;case"Polygon":case"MultiLineString":u=[],c=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),g=this.drawCustomCoordinates_(c,0,e.getEnds(),a,u),this.instructions.push([j.CUSTOM,l,u,e,i,Mn,r]),this.hitDetectionInstructions.push([j.CUSTOM,l,u,e,n||i,Mn,r]);break;case"LineString":case"Circle":c=e.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([j.CUSTOM,l,h,e,i,zt,r]),this.hitDetectionInstructions.push([j.CUSTOM,l,h,e,n||i,zt,r]);break;case"MultiPoint":c=e.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,a),h>l&&(this.instructions.push([j.CUSTOM,l,h,e,i,zt,r]),this.hitDetectionInstructions.push([j.CUSTOM,l,h,e,n||i,zt,r]));break;case"Point":c=e.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([j.CUSTOM,l,h,e,i,void 0,r]),this.hitDetectionInstructions.push([j.CUSTOM,l,h,e,n||i,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[j.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[j.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let n,r,o=-1;for(t=0;t<i;++t)n=e[t],r=n[0],r==j.END_GEOMETRY?o=t:r==j.BEGIN_GEOMETRY&&(n[2]=t,Qu(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=ct(i||Ne)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=ct(i||kn);const n=e.getLineCap();t.lineCap=n!==void 0?n:qi;const r=e.getLineDash();t.lineDash=r?r.slice():Rt;const o=e.getLineDashOffset();t.lineDashOffset=o||St;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:$i;const l=e.getWidth();t.lineWidth=l!==void 0?l:Un;const c=e.getMiterLimit();t.miterLimit=c!==void 0?c:Gn,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[j.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[j.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,c=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||r!=e.currentLineDash&&!tn(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=c)&&(t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=c)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[j.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=dd(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;tt(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class jm extends os{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!gi(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,r);this.instructions.push([j.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([j.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=[];for(let l=0,c=n.length;l<c;l+=e.getStride())(!this.maxExtent||gi(this.maxExtent,n.slice(l,l+2)))&&r.push(n[l],n[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([j.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([j.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Xm extends os{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),a=[j.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Rt,St],hi);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Xt),this.endGeometry(t)}drawMultiLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Rt,St],hi);const a=e.getEnds(),l=e.getFlatCoordinates(),c=e.getStride();let h=0;for(let u=0,d=a.length;u<d;++u)h=this.drawFlatCoordinates_(l,h,a[u],c);this.hitDetectionInstructions.push(Xt),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Xt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Xt),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(hi)}}class rc extends os{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(hi),this.hitDetectionInstructions.push(hi);for(let c=0;c<l;++c){const h=i[c],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,h,n,!0,!a),g=[j.MOVE_TO_LINE_TO,u,d];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(sc),this.hitDetectionInstructions.push(sc)),t=h}return o&&(this.instructions.push(ys),this.hitDetectionInstructions.push(ys)),a&&(this.instructions.push(Xt),this.hitDetectionInstructions.push(Xt)),t}drawCircle(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Rt,St]);const a=e.getFlatCoordinates(),l=e.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const h=[j.CIRCLE,c];this.instructions.push(hi,h),this.hitDetectionInstructions.push(hi,h),n.fillStyle!==void 0&&(this.instructions.push(ys),this.hitDetectionInstructions.push(ys)),n.strokeStyle!==void 0&&(this.instructions.push(Xt),this.hitDetectionInstructions.push(Xt)),this.endGeometry(t)}drawPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Rt,St]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),c=e.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(t)}drawMultiPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Rt,St]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),c=e.getStride();let h=0;for(let u=0,d=a.length;u<d;++u)h=this.drawFlatCoordinatess_(l,h,a[u],c);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=si(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function Vm(s,e,t,i,n){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<s&&o+n<i;){const[c,h]=l.slice(-2),u=e[o+n],d=e[o+n+1],g=Math.sqrt((u-c)*(u-c)+(d-h)*(d-h));if(a+=g,a>=s){const f=(s-a+g)/g,m=Be(c,u,f),_=Be(h,d,f);l.push(m,_),r.push(l),l=[m,_],a==s&&(o+=n),a=0}else if(a<s)l.push(e[o+n],e[o+n+1]),o+=n;else{const f=g-a,m=Be(c,u,f/g),_=Be(h,d,f/g);l.push(m,_),r.push(l),l=[m,_],a=0,o+=n}}return a>0&&r.push(l),r}function Ym(s,e,t,i,n){let r=t,o=t,a=0,l=0,c=t,h,u,d,g,f,m,_,p,y,x;for(u=t;u<i;u+=n){const E=e[u],C=e[u+1];f!==void 0&&(y=E-f,x=C-m,g=Math.sqrt(y*y+x*x),_!==void 0&&(l+=d,h=Math.acos((_*y+p*x)/(d*g)),h>s&&(l>a&&(a=l,r=c,o=u),l=0,c=u-n)),d=g,_=y,p=x),f=E,m=C}return l+=g,l>a?[c,u]:[r,o]}const Ys={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Wm extends os{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Ne]={fillStyle:Ne},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!r)return;const a=this.coordinates;let l=a.length;const c=e.getType();let h=null,u=e.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!ce(this.maxExtent,e.getExtent()))return;let d;if(h=e.getFlatCoordinates(),c=="LineString")d=[h.length];else if(c=="MultiLineString")d=e.getEnds();else if(c=="Polygon")d=e.getEnds().slice(0,1);else if(c=="MultiPolygon"){const _=e.getEndss();d=[];for(let p=0,y=_.length;p<y;++p)d.push(_[p][0])}this.beginGeometry(e,t,i);const g=o.repeat,f=g?void 0:o.textAlign;let m=0;for(let _=0,p=d.length;_<p;++_){let y;g?y=Vm(g*this.resolution,h,m,d[_],u):y=[h.slice(m,d[_])];for(let x=0,E=y.length;x<E;++x){const C=y[x];let w=0,R=C.length;if(f==null){const S=Ym(o.maxAngle,C,0,C.length,2);w=S[0],R=S[1]}for(let S=w;S<R;S+=u)a.push(C[S],C[S+1]);const T=a.length;m=d[_],this.drawChars_(l,T),l=T}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=e.getFlatCoordinates();break;case"LineString":h=e.getFlatMidpoint();break;case"Circle":h=e.getCenter();break;case"MultiLineString":h=e.getFlatMidpoints(),u=2;break;case"Polygon":h=e.getFlatInteriorPoint(),o.overflow||d.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const E=e.getFlatInteriorPoints();h=[];for(let C=0,w=E.length;C<w;C+=3)o.overflow||d.push(E[C+2]/this.resolution),h.push(E[C],E[C+1]);if(h.length===0)return;u=2;break}const g=this.appendFlatPointCoordinates(h,u);if(g===l)return;if(d&&(g-l)/2!==h.length/u){let E=l/2;d=d.filter((C,w)=>{const R=a[(E+w)*2]===h[w*u]&&a[(E+w)*2+1]===h[w*u+1];return R||--E,R})}this.saveTextStates_();const f=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,m=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,i);let _=o.padding;if(_!=ci&&(o.scale[0]<0||o.scale[1]<0)){let E=o.padding[0],C=o.padding[1],w=o.padding[2],R=o.padding[3];o.scale[0]<0&&(C=-C,R=-R),o.scale[1]<0&&(E=-E,w=-w),_=[E,C,w,R]}const p=this.pixelRatio;this.instructions.push([j.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==ci?ci:_.map(function(E){return E*p}),f,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/p,x=f?f.slice(0):null;x&&(x[1]=Ne),this.hitDetectionInstructions.push([j.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,_,x,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Ne:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Nn,justify:t.justify,textBaseline:t.textBaseline||Us,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,c=Ys[n.textBaseline],h=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([j.DRAW_CHARS,e,t,c,n.overflow,a,n.maxAngle,l,h,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([j.DRAW_CHARS,e,t,c,n.overflow,a&&Ne,n.maxAngle,l,h,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,n,r;if(!e)this.text_="";else{const o=e.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ct(o.getColor()||Ne)):(n=null,this.textFillState_=n);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const m=a.getLineDash(),_=a.getLineDashOffset(),p=a.getWidth(),y=a.getMiterLimit();r.lineCap=a.getLineCap()||qi,r.lineDash=m?m.slice():Rt,r.lineDashOffset=_===void 0?St:_,r.lineJoin=a.getLineJoin()||$i,r.lineWidth=p===void 0?Un:p,r.miterLimit=y===void 0?Gn:y,r.strokeStyle=ct(a.getColor()||kn)}i=this.textState_;const l=e.getFont()||lh;Gg(l);const c=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Us,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||ci,i.scale=c===void 0?[1,1]:c;const h=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),g=e.getKeepUpright(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=g===void 0?!0:g,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:Y(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+Y(n.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Km={Circle:rc,Default:os,Image:jm,LineString:Xm,Polygon:rc,Text:Wm};class Ah{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const r=i[n].finish();e[t][n]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let r=n[t];if(r===void 0){const o=Km[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=r}return r}}function La(s,e,t,i){let n=s[e],r=s[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=s[a],c=s[a+1];o+=Math.sqrt((l-n)*(l-n)+(c-r)*(c-r)),n=l,r=c}return o}function Hm(s,e,t,i,n,r,o,a,l,c,h,u,d=!0){let g=s[e],f=s[e+1],m=0,_=0,p=0,y=0;function x(){m=g,_=f,e+=i,g=s[e],f=s[e+1],y+=p,p=Math.sqrt((g-m)*(g-m)+(f-_)*(f-_))}do x();while(e<t-i&&y+p<r);let E=p===0?0:(r-y)/p;const C=Be(m,g,E),w=Be(_,f,E),R=e-i,T=y,S=r+a*l(c,n,h);for(;e<t-i&&y+p<S;)x();E=p===0?0:(S-y)/p;const v=Be(m,g,E),G=Be(_,f,E);let A=!1;if(d)if(u){const O=[C,w,v,G];sa(O,0,4,2,u,O,O),A=O[0]>O[2]}else A=C>v;const P=Math.PI,F=[],L=R+i===e;e=R,p=0,y=T,g=s[e],f=s[e+1];let U;if(L){x(),U=Math.atan2(f-_,g-m),A&&(U+=U>0?-P:P);const O=(v+C)/2,k=(G+w)/2;return F[0]=[O,k,(S-r)/2,U,n],F}n=n.replace(/\n/g," ");for(let O=0,k=n.length;O<k;){x();let N=Math.atan2(f-_,g-m);if(A&&(N+=N>0?-P:P),U!==void 0){let Q=N-U;if(Q+=Q>P?-2*P:Q<-P?2*P:0,Math.abs(Q)>o)return null}U=N;const z=O;let X=0;for(;O<k;++O){const Q=A?k-O-1:O,re=a*l(c,n[Q],h);if(e+i<t&&y+p<r+X+re/2)break;X+=re}if(O===z)continue;const M=A?n.substring(k-z,k-O):n.substring(z,O);E=p===0?0:(r+X/2-y)/p;const q=Be(m,g,E),ee=Be(_,f,E);F.push([q,ee,X/2,N,M]),r+=X}return F}class Pa{constructor(){I(this,"pushMethodArgs_",(...e)=>(this.push_(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ns(),{get:(e,t)=>{if(typeof Ns()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,n=t.length;i<n;++i){const r=t[i];if(typeof r=="function"){r(e);continue}const o=t[++i];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Di=Fe(),Gt=[],Ct=[],wt=[],kt=[];function oc(s){return s[3].declutterBox}const ac=new RegExp("[-----]");function eo(s,e){return e==="start"?e=ac.test(s)?"right":"left":e==="end"&&(e=ac.test(s)?"left":"right"),Ys[e]}function Zm(s,e,t){return t>0&&s.push(`
`,""),s.push(e,""),s}function qm(s,e,t){return t%2===0&&(s+=e),s}class $m{constructor(e,t,i,n,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=je(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new Pa:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,n){const r=e+t+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],u=l.justify?Ys[l.justify]:eo(Array.isArray(e)?e[0]:e,l.textAlign||Nn),d=n&&o.lineWidth?o.lineWidth:0,g=Array.isArray(e)?e:String(e).split(`
`).reduce(Zm,[]),{width:f,height:m,widths:_,heights:p,lineWidths:y}=Ng(l,g),x=f+d,E=[],C=(x+2)*h[0],w=(m+d)*h[1],R={width:C<0?Math.floor(C):Math.ceil(C),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:E};(h[0]!=1||h[1]!=1)&&E.push("scale",h),n&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",d),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),i&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const T=.5-u;let S=u*x+T*d;const v=[],G=[];let A=0,P=0,F=0,L=0,U;for(let O=0,k=g.length;O<k;O+=2){const N=g[O];if(N===`
`){P+=A,A=0,S=u*x+T*d,++L;continue}const z=g[O+1]||l.font;z!==U&&(n&&v.push("font",z),i&&G.push("font",z),U=z),A=Math.max(A,p[F]);const X=[N,S+T*_[F]+u*(_[F]-y[L]),.5*(d+A)+P];S+=_[F],n&&v.push("strokeText",X),i&&G.push("fillText",X),++F}return Array.prototype.push.apply(E,v),Array.prototype.push.apply(E,G),this.labels_[r]=R,R}replayTextBackground_(e,t,i,n,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,r,o,a,l,c,h,u,d,g,f,m,_){a*=d[0],l*=d[1];let p=i-a,y=n-l;const x=r+c>e?e-c:r,E=o+h>t?t-h:o,C=f[3]+x*d[0]+f[1],w=f[0]+E*d[1]+f[2],R=p-f[3],T=y-f[0];(m||u!==0)&&(Gt[0]=R,kt[0]=R,Gt[1]=T,Ct[1]=T,Ct[0]=R+C,wt[0]=Ct[0],wt[1]=T+w,kt[1]=wt[1]);let S;return u!==0?(S=vt(je(),i,n,1,1,u,-i,-n),we(S,Gt),we(S,Ct),we(S,wt),we(S,kt),dt(Math.min(Gt[0],Ct[0],wt[0],kt[0]),Math.min(Gt[1],Ct[1],wt[1],kt[1]),Math.max(Gt[0],Ct[0],wt[0],kt[0]),Math.max(Gt[1],Ct[1],wt[1],kt[1]),Di)):dt(Math.min(R,R+C),Math.min(T,T+w),Math.max(R,R+C),Math.max(T,T+w),Di),g&&(p=Math.round(p),y=Math.round(y)),{drawImageX:p,drawImageY:y,drawImageW:x,drawImageH:E,originX:c,originY:h,declutterBox:{minX:Di[0],minY:Di[1],maxX:Di[2],maxY:Di[3],value:_},canvasTransform:S,scale:d}}replayImageOrLabel_(e,t,i,n,r,o,a){const l=!!(o||a),c=n.declutterBox,h=a?a[2]*n.scale[0]/2:0;return c.minX-h<=t[0]&&c.maxX+h>=0&&c.minY-h<=t[1]&&c.maxY+h>=0&&(l&&this.replayTextBackground_(e,Gt,Ct,wt,kt,o,a),Ug(e,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=we(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(i[0]%n,i[1]%n),t!==1&&e.scale(t,t)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,i,n){const r=this.textStates[t],o=this.createLabel(e,t,n,i),a=this.strokeStates[i],l=this.pixelRatio,c=eo(Array.isArray(e)?e[0]:e,r.textAlign||Nn),h=Ys[r.textBaseline||Us],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],g=c*d+2*(.5-c)*u,f=h*o.height/l+2*(.5-h)*u;return{label:o,anchorX:g,anchorY:f}}execute_(e,t,i,n,r,o,a,l){const c=this.zIndexContext_;let h;this.pixelCoordinates_&&tn(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Kt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),sf(this.renderedTransform_,i));let u=0;const d=n.length;let g=0,f,m,_,p,y,x,E,C,w,R,T,S,v,G=0,A=0;const P=this.coordinateCache_,F=this.viewRotation_,L=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,U={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},O=this.instructions!=n||this.overlaps?0:200;let k,N,z,X;for(;u<d;){const M=n[u];switch(M[0]){case j.BEGIN_GEOMETRY:k=M[1],X=M[3],k.getGeometry()?a!==void 0&&!ce(a,X.getExtent())?u=M[2]+1:++u:u=M[2],c&&(c.zIndex=M[4]);break;case j.BEGIN_PATH:G>O&&(this.fill_(e),G=0),A>O&&(e.stroke(),A=0),!G&&!A&&(e.beginPath(),y=NaN,x=NaN),++u;break;case j.CIRCLE:g=M[1];const ee=h[g],Q=h[g+1],re=h[g+2],oe=h[g+3],De=re-ee,Se=oe-Q,fe=Math.sqrt(De*De+Se*Se);e.moveTo(ee+fe,Q),e.arc(ee,Q,fe,0,2*Math.PI,!0),++u;break;case j.CLOSE_PATH:e.closePath(),++u;break;case j.CUSTOM:g=M[1],f=M[2];const Ti=M[3],an=M[4],Qt=M[5];U.geometry=Ti,U.feature=k,u in P||(P[u]=[]);const pt=P[u];Qt?Qt(h,g,f,2,pt):(pt[0]=h[g],pt[1]=h[g+1],pt.length=2),c&&(c.zIndex=M[6]),an(pt,U),++u;break;case j.DRAW_IMAGE:g=M[1],f=M[2],w=M[3],m=M[4],_=M[5];let Ge=M[6];const Xe=M[7],Ri=M[8],Si=M[9],ln=M[10];let ei=M[11];const Ii=M[12];let vi=M[13];p=M[14]||"declutter";const Ee=M[15];if(!w&&M.length>=20){R=M[19],T=M[20],S=M[21],v=M[22];const Ve=this.drawLabelWithPointPlacement_(R,T,S,v);w=Ve.label,M[3]=w;const ti=M[23];m=(Ve.anchorX-ti)*this.pixelRatio,M[4]=m;const Ye=M[24];_=(Ve.anchorY-Ye)*this.pixelRatio,M[5]=_,Ge=w.height,M[6]=Ge,vi=w.width,M[13]=vi}let Lr;M.length>25&&(Lr=M[25]);let Pr,cs,hs;M.length>17?(Pr=M[16],cs=M[17],hs=M[18]):(Pr=ci,cs=null,hs=null),ln&&L?ei+=F:!ln&&!L&&(ei-=F);let zu=0;for(;g<f;g+=2){if(Lr&&Lr[zu++]<vi/this.pixelRatio)continue;const Ve=this.calculateImageOrLabelDimensions_(w.width,w.height,h[g],h[g+1],vi,Ge,m,_,Ri,Si,ei,Ii,r,Pr,!!cs||!!hs,k),ti=[e,t,w,Ve,Xe,cs,hs];if(l){let Ye,nt,We;if(Ee){const ue=f-g;if(!Ee[ue]){Ee[ue]={args:ti,declutterMode:p};continue}const be=Ee[ue];Ye=be.args,nt=be.declutterMode,delete Ee[ue],We=oc(Ye)}let yt,xt;if(Ye&&(nt!=="declutter"||!l.collides(We))&&(yt=!0),(p!=="declutter"||!l.collides(Ve.declutterBox))&&(xt=!0),nt==="declutter"&&p==="declutter"){const ue=yt&&xt;yt=ue,xt=ue}yt&&(nt!=="none"&&l.insert(We),this.replayImageOrLabel_.apply(this,Ye)),xt&&(p!=="none"&&l.insert(Ve.declutterBox),this.replayImageOrLabel_.apply(this,ti))}else this.replayImageOrLabel_.apply(this,ti)}++u;break;case j.DRAW_CHARS:const rl=M[1],ol=M[2],Fr=M[3],ju=M[4];v=M[5];const Xu=M[6],al=M[7],ll=M[8];S=M[9];const Mr=M[10];R=M[11],Array.isArray(R)&&(R=R.reduce(qm,"")),T=M[12];const cl=[M[13],M[13]];p=M[14]||"declutter";const Vu=M[15],Or=this.textStates[T],cn=Or.font,hn=[Or.scale[0]*al,Or.scale[1]*al];let un;cn in this.widths_?un=this.widths_[cn]:(un={},this.widths_[cn]=un);const hl=La(h,rl,ol,2),ul=Math.abs(hn[0])*Vl(cn,R,un);if(ju||ul<=hl){const Ve=this.textStates[T].textAlign,ti=(hl-ul)*eo(R,Ve),Ye=Hm(h,rl,ol,2,R,ti,Xu,Math.abs(hn[0]),Vl,cn,un,L?0:this.viewRotation_,Vu);e:if(Ye){const nt=[];let We,yt,xt,ue,be;if(S)for(We=0,yt=Ye.length;We<yt;++We){be=Ye[We],xt=be[4],ue=this.createLabel(xt,T,"",S),m=be[2]+(hn[0]<0?-Mr:Mr),_=Fr*ue.height+(.5-Fr)*2*Mr*hn[1]/hn[0]-ll;const Et=this.calculateImageOrLabelDimensions_(ue.width,ue.height,be[0],be[1],ue.width,ue.height,m,_,0,0,be[3],cl,!1,ci,!1,k);if(l&&p==="declutter"&&l.collides(Et.declutterBox))break e;nt.push([e,t,ue,Et,1,null,null])}if(v)for(We=0,yt=Ye.length;We<yt;++We){be=Ye[We],xt=be[4],ue=this.createLabel(xt,T,v,""),m=be[2],_=Fr*ue.height-ll;const Et=this.calculateImageOrLabelDimensions_(ue.width,ue.height,be[0],be[1],ue.width,ue.height,m,_,0,0,be[3],cl,!1,ci,!1,k);if(l&&p==="declutter"&&l.collides(Et.declutterBox))break e;nt.push([e,t,ue,Et,1,null,null])}l&&p!=="none"&&l.load(nt.map(oc));for(let Et=0,Yu=nt.length;Et<Yu;++Et)this.replayImageOrLabel_.apply(this,nt[Et])}}++u;break;case j.END_GEOMETRY:if(o!==void 0){k=M[1];const Ve=o(k,X,p);if(Ve)return Ve}++u;break;case j.FILL:O?G++:this.fill_(e),++u;break;case j.MOVE_TO_LINE_TO:for(g=M[1],f=M[2],N=h[g],z=h[g+1],e.moveTo(N,z),y=N+.5|0,x=z+.5|0,g+=2;g<f;g+=2)N=h[g],z=h[g+1],E=N+.5|0,C=z+.5|0,(g==f-2||E!==y||C!==x)&&(e.lineTo(N,z),y=E,x=C);++u;break;case j.SET_FILL_STYLE:this.alignAndScaleFill_=M[2],G&&(this.fill_(e),G=0,A&&(e.stroke(),A=0)),e.fillStyle=M[1],++u;break;case j.SET_STROKE_STYLE:A&&(e.stroke(),A=0),this.setStrokeStyle_(e,M),++u;break;case j.STROKE:O?A++:e.stroke(),++u;break;default:++u;break}}G&&this.fill_(e),A&&e.stroke()}execute(e,t,i,n,r,o){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,n,r){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,n,r)}}const ri=["Polygon","Circle","LineString","Image","Text","Default"],Ws=["Image","Text"],Jm=ri.filter(s=>!Ws.includes(s));let bh=!1,Lh=!1;function Qm(){let s=0;const e=i=>{const n=ae(1,1,null,{willReadFrequently:i});let r=0;const o=performance.now();for(;performance.now()-o<50;++r)n.fillStyle=`rgba(255,0,${r%256},1)`,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1);return s=r>s?r:s,r};bh={[e(!0)]:!0,[e(!1)]:!1,[e(void 0)]:void 0}[s],Lh=!0}class Ph{constructor(e,t,i,n,r,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=je(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const r=e[i];for(const o in r){const a=r[o];n[o]=new $m(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,r=e.length;n<r;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,r,o){Lh===!1&&Qm(),n=Math.round(n);const a=n*2+1,l=vt(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=ae(a,a,null,{willReadFrequently:bh}));const h=this.hitDetectionContext_;h.canvas.width!==a||h.canvas.height!==a?(h.canvas.width=a,h.canvas.height=a):c||h.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Fe(),Sn(u,e),tt(u,t*(this.renderBuffer_+n),u));const d=e_(n);let g;function f(C,w,R){const T=h.getImageData(0,0,a,a).data;for(let S=0,v=d.length;S<v;S++)if(T[d[S]]>0){if(!o||R==="none"||g!=="Image"&&g!=="Text"||o.includes(C)){const G=(d[S]-3)/4,A=n-G%a,P=n-(G/a|0),F=r(C,w,A*A+P*P);if(F)return F}h.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(ht);let _,p,y,x,E;for(_=m.length-1;_>=0;--_){const C=m[_].toString();for(y=this.executorsByZIndex_[C],p=ri.length-1;p>=0;--p)if(g=ri[p],x=y[g],x!==void 0&&(E=x.executeHitDetection(h,l,i,f,u),E))return E}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],r=t[2],o=t[3],a=[i,n,i,o,r,o,r,n];return Kt(a,0,8,2,e,a),a}isEmpty(){return di(this.executorsByZIndex_)}execute(e,t,i,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?Ju:ht),o=o||ri;const c=ri.length;for(let h=0,u=l.length;h<u;++h){const d=l[h].toString(),g=this.executorsByZIndex_[d];for(let f=0,m=o.length;f<m;++f){const _=o[f],p=g[_];if(p!==void 0){const y=a===null?void 0:p.getZIndexContext(),x=y?y.getContext():e,E=this.maxExtent_&&_!=="Image"&&_!=="Text";if(E&&(x.save(),this.clip(x,i)),!y||_==="Text"||_==="Image"?p.execute(x,t,i,n,r,a):y.pushFunction(C=>p.execute(C,t,i,n,r,a)),E&&x.restore(),y){y.offset();const C=l[h]*c+ri.indexOf(_);this.deferredZIndexContexts_[C]||(this.deferredZIndexContexts_[C]=[]),this.deferredZIndexContexts_[C].push(y)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(ht);for(let i=0,n=t.length;i<n;++i)e[t[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),e[t[i]].length=0}}const to={};function e_(s){if(to[s]!==void 0)return to[s];const e=s*2+1,t=s*s,i=new Array(t+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((s+r)*e+(s+o))*4+3),r>0&&l.push(((s-r)*e+(s+o))*4+3),o>0&&(l.push(((s+r)*e+(s-o))*4+3),r>0&&l.push(((s-r)*e+(s-o))*4+3))}const n=[];for(let r=0,o=i.length;r<o;++r)i[r]&&n.push(...i[r]);return to[s]=n,n}class Fh extends vh{constructor(e,t,i,n,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.transformRotation_=n?Zn(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=je()}drawImages_(e,t,i,n){if(!this.image_)return;const r=Kt(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=r.length;h<u;h+=2){const d=r[h]-this.imageAnchorX_,g=r[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const f=d+this.imageAnchorX_,m=g+this.imageAnchorY_;vt(a,f,m,1,1,c,-f,-m),o.save(),o.transform.apply(o,a),o.translate(f,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Kt(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=n){const l=r[t]+this.textOffsetX_,c=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(e,t,i,n,r){const o=this.context_,a=Kt(e,t,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return r&&o.closePath(),i}drawRings_(e,t,i,n){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ce(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=mf(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ce(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(ce(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,c=o.length;l<c;++l)r=this.moveToLineTo_(n,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ce(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ce(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const c=r[a];n=this.drawRings_(i,n,c,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),tn(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:Nn;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:ct(i||Ne)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),n=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),c=t.getMiterLimit(),h=r||Rt;this.strokeState_={lineCap:n!==void 0?n:qi,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(o||St)*this.pixelRatio_,lineJoin:a!==void 0?a:$i,lineWidth:(l!==void 0?l:Un)*this.pixelRatio_,miterLimit:c!==void 0?c:Gn,strokeStyle:ct(i||kn)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const g=t.getColor();this.textFillState_={fillStyle:ct(g||Ne)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const g=i.getColor(),f=i.getLineCap(),m=i.getLineDash(),_=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),x=i.getMiterLimit();this.textStrokeState_={lineCap:f!==void 0?f:qi,lineDash:m||Rt,lineDashOffset:_||St,lineJoin:p!==void 0?p:$i,lineWidth:y!==void 0?y:Un,miterLimit:x!==void 0?x:Gn,strokeStyle:ct(g||kn)}}const n=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),c=e.getScaleArray(),h=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:n!==void 0?n:lh,textAlign:u!==void 0?u:Nn,textBaseline:d!==void 0?d:Us},this.text_=h!==void 0?Array.isArray(h)?h.reduce((g,f,m)=>g+=m%2?" ":f,""):h:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const ze=.5;function Mh(s,e,t,i,n,r,o,a,l){const c=l?ia(n):n,h=s[0]*ze,u=s[1]*ze,d=ae(h,u);d.imageSmoothingEnabled=!1;const g=d.canvas,f=new Fh(d,ze,n,null,o,a,l?Jn(tf(),l):null),m=t.length,_=Math.floor((256*256*256-1)/m),p={};for(let x=1;x<=m;++x){const E=t[x-1],C=E.getStyleFunction()||i;if(!C)continue;let w=C(E,r);if(!w)continue;Array.isArray(w)||(w=[w]);const T=(x*_).toString(16).padStart(7,"#00000");for(let S=0,v=w.length;S<v;++S){const G=w[S],A=G.getGeometryFunction()(E);if(!A||!ce(c,A.getExtent()))continue;const P=G.clone(),F=P.getFill();F&&F.setColor(T);const L=P.getStroke();L&&(L.setColor(T),L.setLineDash(null)),P.setText(void 0);const U=G.getImage();if(U){const z=U.getImageSize();if(!z)continue;const X=ae(z[0],z[1],void 0,{alpha:!1}),M=X.canvas;X.fillStyle=T,X.fillRect(0,0,M.width,M.height),P.setImage(new Ji({img:M,anchor:U.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:U.getOrigin(),opacity:1,size:U.getSize(),scale:U.getScale(),rotation:U.getRotation(),rotateWithView:U.getRotateWithView()}))}const O=P.getZIndex()||0;let k=p[O];k||(k={},p[O]=k,k.Polygon=[],k.Circle=[],k.LineString=[],k.Point=[]);const N=A.getType();if(N==="GeometryCollection"){const z=A.getGeometriesArrayRecursive();for(let X=0,M=z.length;X<M;++X){const q=z[X];k[q.getType().replace("Multi","")].push(q,P)}}else k[N.replace("Multi","")].push(A,P)}}const y=Object.keys(p).map(Number).sort(ht);for(let x=0,E=y.length;x<E;++x){const C=p[y[x]];for(const w in C){const R=C[w];for(let T=0,S=R.length;T<S;T+=2){f.setStyle(R[T+1]);for(let v=0,G=e.length;v<G;++v)f.setTransform(e[v]),f.drawGeometry(R[T])}}}return d.getImageData(0,0,g.width,g.height)}function Oh(s,e,t){const i=[];if(t){const n=Math.floor(Math.round(s[0])*ze),r=Math.floor(Math.round(s[1])*ze),o=(he(n,0,t.width-1)+he(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],h=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);h&&h%u===0&&i.push(e[h/u-1])}return i}const t_=.5,Dh={Point:c_,LineString:o_,Polygon:u_,MultiPoint:h_,MultiLineString:a_,MultiPolygon:l_,GeometryCollection:r_,Circle:n_};function i_(s,e){return parseInt(Y(s),10)-parseInt(Y(e),10)}function bo(s,e){const t=Gh(s,e);return t*t}function Gh(s,e){return t_*s/e}function n_(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function Ks(s,e,t,i,n,r,o,a){const l=[],c=t.getImage();if(c){let d=!0;const g=c.getImageState();g==B.LOADED||g==B.ERROR?d=!1:g==B.IDLE&&c.load(),d&&l.push(c.ready())}const h=t.getFill();h&&h.loading()&&l.push(h.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),s_(s,e,t,i,r,o,a),u}function s_(s,e,t,i,n,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,n);if(t.getRenderer())kh(s,l,t,e,o);else{const h=Dh[l.getType()];h(s,l,t,e,o,r)}}function kh(s,e,t,i,n){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)kh(s,o[a],t,i,n);return}s.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),n)}function r_(s,e,t,i,n,r){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const c=Dh[o[a].getType()];c(s,o[a],t,i,n,r)}}function o_(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function a_(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function l_(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(o||r){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}function c_(s,e,t,i,n,r){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),c=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=B.LOADED)return;const h=s.getBuilder(t.getZIndex(),"Image");h.setImageStyle(o,c),h.drawPoint(e,i,n)}if(l){const h=s.getBuilder(t.getZIndex(),"Text");h.setTextStyle(a,c),h.drawText(e,i,n)}}function h_(s,e,t,i,n,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),c=l&&l.getText(),h=r&&a&&c?{}:void 0;if(a){if(o.getImageState()!=B.LOADED)return;const u=s.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,h),u.drawMultiPoint(e,i,n)}if(c){const u=s.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l,h),u.drawText(e,i,n)}}function u_(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}const lc=[];let Ui=null;function d_(){Ui=ae(1,1,void 0,{willReadFrequently:!0})}class Fa extends _m{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=je(),this.pixelTransform=je(),this.inversePixelTransform=je(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){Ui||d_(),Ui.clearRect(0,0,1,1);let n;try{Ui.drawImage(e,t,i,1,1,0,0,1,1),n=Ui.getImageData(0,0,1,1).data}catch{return Ui=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let r,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&tn(_i(e.style.backgroundColor),_i(i)))){const a=e.firstElementChild;Xf(a)&&(o=a.getContext("2d"))}if(o&&hf(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=It?jf():document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=ae();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=ft(i),r=nr(i),o=ir(i),a=tr(i);we(t.coordinateToPixelTransform,n),we(t.coordinateToPixelTransform,r),we(t.coordinateToPixelTransform,o),we(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;we(l,n),we(l,r),we(l,o),we(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const i=e.extent,n=e.viewState.resolution,r=e.viewState.rotation,o=e.pixelRatio,a=Math.round(Z(i)/n*o),l=Math.round(le(i)/n*o);vt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,r,-a/2,-l/2),of(this.inversePixelTransform,this.pixelTransform);const c=cf(this.pixelTransform);if(this.useContainer(t,c,this.getBackground(e)),!this.containerReused){const h=this.context.canvas;h.width!=a||h.height!=l?(h.width=a,h.height=l):this.context.clearRect(0,0,a,l),c!==h.style.transform&&(h.style.transform=c)}}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const r=new nm(e,this.inversePixelTransform,i,t);n.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(li.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(li.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new Pa),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(li.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(li.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,n,r,o,a){const l=r/2,c=o/2,h=n/t,u=-h,d=-e[0]+a,g=-e[1];return vt(this.tempTransform,l,c,h,u,-i,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class f_ extends Fa{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.extendX_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Fe(),this.wrappedRenderedExtent_=Fe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,c=r.rotation,h=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),g=t.pixelRatio,f=t.viewHints,m=!(f[ge.ANIMATING]||f[ge.INTERACTING]),_=this.context,p=Math.round(Z(n)/a*g),y=Math.round(le(n)/a*g),x=u.getWrapX()&&l.canWrapX(),E=x?Z(h):null,C=x?Math.ceil((n[2]-h[2])/E)+(this.extendX_?2:1):1;let w=x?Math.floor((n[0]-h[0])/E)-(this.extendX_?1:0):0;do{let R=this.getRenderTransform(o,a,0,g,p,y,w*E);t.declutter&&(R=R.slice(0)),e.execute(_,[_.canvas.width,_.canvas.height],R,c,m,i===void 0?ri:i?Ws:Jm,i?d&&t.declutter[d]:void 0)}while(++w<C)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=ae(this.context.canvas.width,this.context.canvas.height,lc))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,Qn(this.context),lc.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const n=e.viewState;this.prepareContainer(e,t);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(li.PRERENDER)||this.getLayer().hasListener(li.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,e),n.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const l=at(i.extent);a=ce(l,e.extent),this.clipped_=a&&!Qe(l,e.extent),this.clipped_&&this.clipUnrotated(r,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&r.restore(),this.postRender(r,e),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=i[0]*ze,d=i[1]*ze;h.push(this.getRenderTransform(n,r,o,ze,u,d,0).slice());const g=c.getSource(),f=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!Qe(f,l)){let m=l[0];const _=Z(f);let p=0,y;for(;m<f[0];)--p,y=_*p,h.push(this.getRenderTransform(n,r,o,ze,u,d,y).slice()),m+=_;for(p=0,m=l[2];m>f[2];)++p,y=_*p,h.push(this.getRenderTransform(n,r,o,ze,u,d,y).slice()),m-=_}this.hitDetectionImageData_=Mh(i,h,this.renderedFeatures_,c.getStyleFunction(),l,r,o,bo(r,this.renderedPixelRatio_),null)}t(Oh(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,n,r){var d,g;if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),c={},h=function(f,m,_){const p=Y(f),y=c[p];if(y){if(y!==!0&&_<y.distanceSq){if(_===0)return c[p]=!0,r.splice(r.lastIndexOf(y),1),n(f,l,m);y.geometry=m,y.distanceSq=_}}else{if(_===0)return c[p]=!0,n(f,l,m);r.push(c[p]={feature:f,layer:l,geometry:m,distanceSq:_,callback:n})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,i,h,u?(g=(d=t.declutter)==null?void 0:d[u])==null?void 0:g.all().map(f=>f.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[ge.ANIMATING],r=e.viewHints[ge.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,c=e.viewState,h=c.projection,u=c.resolution,d=e.pixelRatio,g=t.getRevision(),f=t.getRenderBuffer();let m=t.getRenderOrder();m===void 0&&(m=i_);const _=c.center.slice(),p=tt(l,f*u),y=p.slice(),x=[p.slice()],E=h.getExtent(),C=i.getWrapX()&&h.canWrapX();if(this.extendX_=!1,C){const L=i.getExtent();L&&!Ei(L)&&(this.extendX_=L[0]<E[0]||L[2]>E[2])}if(C&&(!Qe(E,e.extent)||this.extendX_)){const L=Z(E),U=Math.max(Z(p)/2,L);let O=E[0],k=E[2];this.extendX_&&(O-=L,k+=L),p[0]=O-U,p[2]=k+U,Oc(_,h);const N=Fc(x[0],h);N[0]<E[0]&&N[2]<E[2]?x.push([N[0]+L,N[1],N[2]+L,N[3]]):N[0]>E[0]&&N[2]>E[2]&&x.push([N[0]-L,N[1],N[2]-L,N[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedPixelRatio_===d&&this.renderedRevision_==g&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!e.declutter&&Qe(this.wrappedRenderedExtent_,p))return tn(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new Ah(Gh(u,d),p,u,d);let R;for(let L=0,U=x.length;L<U;++L)i.loadFeatures(x[L],u,h);const T=bo(u,d);let S=!0;const v=(L,U)=>{let O;const k=L.getStyleFunction()||t.getStyleFunction();if(k&&(O=k(L,u)),O){const N=this.renderFeature(L,T,O,w,R,this.getLayer().getDeclutter(),U);S=S&&!N}},G=ia(p),A=i.getFeaturesInExtent(G);m&&A.sort(m);for(let L=0,U=A.length;L<U;++L)v(A[L],L);this.renderedFeatures_=A,this.ready=S;const P=w.finish(),F=new Ph(p,u,d,i.getOverlaps(),P,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=p,this.renderedCenter_=_,this.renderedProjection_=h,this.renderedPixelRatio_=d,this.replayGroup_=F,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let c=0,h=i.length;c<h;++c)l=Ks(n,e,i[c],t,this.boundHandleStyleImageChange_,r,o,a)||l;else l=Ks(n,e,i,t,this.boundHandleStyleImageChange_,r,o,a);return l}}class g_ extends Ra{constructor(e){super(e)}createRenderer(){return new f_(this)}}let m_=!1;function Nh(s,e,t,i,n,r,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(t,i,n):s,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=m_,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();try{let h;c=="text"||c=="json"?h=a.responseText:c=="xml"?h=a.responseXML||a.responseText:c=="arraybuffer"&&(h=a.response),h?r(e.readFeatures(h,{extent:t,featureProjection:n}),e.readProjection(h)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function cc(s,e){return function(t,i,n,r,o){Nh(s,e,t,i,n,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function __(s,e){return[[-1/0,-1/0,1/0,1/0]]}function Hy(s,e){return[s]}class Rr extends $t{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Rr(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(xe(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=me(e,ie.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?p_(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function p_(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(se(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[s]),function(){return e}}function Uh(s,e,t,i){const n=[];let r=Fe();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Wo(s,e,l[0],i),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return n}function Hs(s,e,t,i,n,r,o){let a,l;const c=(t-e)/i;if(c===1)a=e;else if(c===2)a=e,l=n;else if(c!==0){let h=s[e],u=s[e+1],d=0;const g=[0];for(let _=e+i;_<t;_+=i){const p=s[_],y=s[_+1];d+=Math.sqrt((p-h)*(p-h)+(y-u)*(y-u)),g.push(d),h=p,u=y}const f=n*d,m=$u(g,f);m<0?(l=(f-g[-m-2])/(g[-m-1]-g[-m-2]),a=e+(-m-2)*i):a=e+m*i}o=o>1?o:2,r=r||new Array(o);for(let h=0;h<o;++h)r[h]=a===void 0?NaN:l===void 0?s[a+h]:Be(s[a+h],s[a+i+h],l);return r}function Lo(s,e,t,i,n,r){if(t==e)return null;let o;if(n<s[e+i-1])return r?(o=s.slice(e,e+i),o[i-1]=n,o):null;if(s[t-1]<n)return r?(o=s.slice(t-i,t),o[i-1]=n,o):null;if(n==s[e+i-1])return s.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;n<s[(d+1)*i-1]?l=d:a=d+1}const c=s[a*i-1];if(n==c)return s.slice((a-1)*i,(a-1)*i+i);const h=s[(a+1)*i-1],u=(n-c)/(h-c);o=[];for(let d=0;d<i-1;++d)o.push(Be(s[(a-1)*i+d],s[a*i+d],u));return o.push(n),o}function y_(s,e,t,i,n,r,o){if(o)return Lo(s,e,t[t.length-1],i,n,r);let a;if(n<s[i-1])return r?(a=s.slice(0,i),a[i-1]=n,a):null;if(s[s.length-1]<n)return r?(a=s.slice(s.length-i),a[i-1]=n,a):null;for(let l=0,c=t.length;l<c;++l){const h=t[l];if(e!=h){if(n<s[e+i-1])return null;if(n<=s[h-1])return Lo(s,e,h,i,n,!1);e=h}}return null}class Ma extends Lt{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Ma(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<n){if(l===0)for(let c=0;c<this.stride;++c)i[c]=r[c];else{const c=this.getRadius()/Math.sqrt(l);i[0]=r[0]+c*o,i[1]=r[1]+c*a;for(let h=2;h<this.stride;++h)i[h]=r[h]}return i.length=this.stride,l}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],r=t-i[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return dt(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ce(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Ho(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=Yc(n,0,e,this.stride);n[r++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[r++]=n[o];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(sa(i,0,i.length,n,e,t,i)),this.changed()}}Ma.prototype.transform;class Zs extends Gs{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(xe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(me(e[t],ie.CHANGE,this.changed,this))}clone(){const e=new Zs(io(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<xi(this.getExtent(),e,t))return n;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)n=r[o].closestPointXY(e,t,i,n);return n}containsXY(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(e,t))return!0;return!1}computeExtent(e){qn(e);const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)Ko(e,t[i].getExtent());return e}getGeometries(){return io(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let n=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(n=!0)}return n?new Zs(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Me(this.getExtent()));const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)n[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(io(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function io(s){return s.map(e=>e.clone())}class yi extends Lt{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){et(this.flatCoordinates,e),this.changed()}clone(){const e=new yi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<xi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,n))}forEachSegment(e){return Hc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return zt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Hs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return La(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=hr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new yi(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}class Vn extends Lt{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const n=e,r=[],o=[];for(let l=0,c=n.length;l<c;++l){const h=n[l];et(r,h.getFlatCoordinates()),o.push(r.length)}const a=n.length===0?this.getLayout():n[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){et(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Vn(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<xi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(oa(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),la(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,n))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,y_(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Mn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new yi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,n=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],c=new yi(e.slice(r,l),i);n.push(c),r=l}return n}getLength(){const e=this.ends_;let t=0,i=0;for(let n=0,r=e.length;n<r;++n)i+=La(this.flatCoordinates,t,e[n],this.stride),t=e[n];return i}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],c=Hs(t,i,l,r,.5);et(e,c),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Wc(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Vn(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return Rf(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ca(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class as extends Lt{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){et(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new as(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<xi(this.getExtent(),e,t))return n;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const c=ui(e,t,r[a],r[a+1]);if(c<n){n=c;for(let h=0;h<o;++h)i[h]=r[a+h];i.length=o}}return n}getCoordinates(){return zt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new mt(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,n=[];for(let r=0,o=e.length;r<o;r+=i){const a=new mt(e.slice(r,r+i),t);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let n=0,r=t.length;n<r;n+=i){const o=t[n],a=t[n+1];if(Vo(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cr(this.flatCoordinates,0,e,this.stride),this.changed()}}class Yn extends Lt{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const n=e,r=[],o=[];for(let a=0,l=n.length;a<l;++a){const c=n[a],h=r.length,u=c.getEnds();for(let d=0,g=u.length;d<g;++d)u[d]+=h;et(r,c.getFlatCoordinates()),o.push(u)}t=n.length===0?this.getLayout():n[0].getLayout(),e=r,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;et(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let n=0,r=t.length;n<r;++n)t[n]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const i=new Yn(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,n){return n<xi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pf(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return Tf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return _f(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Eo(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,xo(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Uh(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Kc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new as(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;$c(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Eo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Cf(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Yn(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),n=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new At(this.flatCoordinates.slice(t,n),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),c=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const h=new At(t.slice(r,c),e,l);n.push(h),r=c}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return Sf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=xf(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const hc=je();class Pe{constructor(e,t,i,n,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Yo(this.flatCoordinates_):Wo(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Me(this.getExtent());this.flatInteriorPoints_=da(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Jc(this.flatCoordinates_,this.ends_),t=Uh(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Kc(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Hs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let n=0,r=i.length;n<r;++n){const o=i[n],a=Hs(e,t,o,2,.5);et(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=H(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const n=le(i)/le(t);vt(hc,i[0],i[3],n,-n,0,0,0),Kt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,hc,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new Pe(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Ic((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=hr(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=Wc(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,n);break;case"Polygon":n=[],i.length=ha(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,n);break}return n&&(this.simplifiedGeometry_=new Pe(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Pe.prototype.getFlatCoordinates=Pe.prototype.getOrientedFlatCoordinates;class uc{constructor(e){this.rbush_=new th(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[Y(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,r=t.length;n<r;n++){const o=e[n],a=t[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[Y(a)]=l}this.rbush_.load(i)}remove(e){const t=Y(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[Y(t)],n=[i.minX,i.minY,i.maxX,i.maxY];mi(n,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(n){return n.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,r=e.length;n<r;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return di(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return dt(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Ke={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Nt extends bt{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class qs extends ss{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=As,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(se(this.format_,"`format` must be set when `url` is set"),this.loader_=cc(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:__;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new uc:null,this.loadedExtentsRtree_=new uc,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),!t&&i===void 0&&(i=new fo(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Y(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Nt(Ke.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Pe||(this.featureChangeKeys_[e]=[me(t,ie.CHANGE,this.handleFeatureChange_,this),me(t,zo.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const n=String(t.getId());if(!(n in this.idIndex_))this.idIndex_[n]=t;else if(t instanceof Pe){const r=this.idIndex_[n];r instanceof Pe?Array.isArray(r)?r.push(t):this.idIndex_[n]=[r,t]:i=!1}else i=!1}return i&&(se(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=Y(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=Y(a);this.setupChangeEvents_(l,a);const c=a.getGeometry();if(c){const h=c.getExtent();t.push(h),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(Ke.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new Nt(Ke.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ke.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Ke.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Ut.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Ut.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(xe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Nt(Ke.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){const r=n.getGeometry();if(r instanceof Pe||r.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const n=i.getGeometry();if(n instanceof Pe||n.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),di(this.nullGeometryFeatures_)||et(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=qo(e,t);return[].concat(...n.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||td,this.featuresRtree_.forEachInExtent(l,function(c){if(t(c)){const h=c.getGeometry(),u=a;if(a=h instanceof Pe?0:h.closestPointXY(i,n,o,a),a<u){r=c;const d=Math.sqrt(a);l[0]=i-d,l[1]=n-d,l[2]=i+d,l[3]=n+d}}}),r}getExtent(e){var t;return((t=this.featuresRtree_)==null?void 0:t.getExtent(e))??null}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=Y(t),n=t.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Nt(Ke.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Y(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&di(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];n.forEachInExtent(l,function(h){return Qe(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Nt(Ke.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Nt(Ke.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Nt(Ke.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(n){if(mi(n.extent,e))return n});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,n=e.length;i<n;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Y(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const i=this.featureChangeKeys_[t];i==null||i.forEach(xe),delete this.featureChangeKeys_[t];const n=e.getId();if(n!==void 0){const r=n.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(Ke.REMOVEFEATURE)&&this.dispatchEvent(new Nt(Ke.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){se(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(cc(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}function x_(s,e){const t=s.canvas;e=e||{};const i=e.pixelRatio||sd,n=e.size;n&&(t.width=n[0]*i,t.height=n[1]*i,t.style.width=n[0]+"px",t.style.height=n[1]+"px");const r=[0,0,t.width,t.height],o=Ss(je(),i,i);return new Fh(s,i,r,o,0)}class E_ extends fr{constructor(e,t,i,n,r){const o=r!==void 0?B.IDLE:B.LOADED;super(e,t,i,o),this.loader_=r!==void 0?r:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=B.ERROR):this.state=B.LOADED,this.changed()}load(){this.state==B.IDLE&&(this.state=B.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const Ie={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class C_ extends $t{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+kf,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Ie.ELEMENT,this.handleElementChanged),this.addChangeListener(Ie.MAP,this.handleMapChanged),this.addChangeListener(Ie.OFFSET,this.handleOffsetChanged),this.addChangeListener(Ie.POSITION,this.handlePositionChanged),this.addChangeListener(Ie.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Ie.ELEMENT)}getId(){return this.id}getMap(){return this.get(Ie.MAP)||null}getOffset(){return this.get(Ie.OFFSET)}getPosition(){return this.get(Ie.POSITION)}getPositioning(){return this.get(Ie.POSITIONING)}handleElementChanged(){zf(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),xe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=me(e,rd.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Ie.ELEMENT,e)}setMap(e){this.set(Ie.MAP,e)}setOffset(e){this.set(Ie.OFFSET,e)}setPosition(e){this.set(Ie.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Ie.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[Uf(n),Bf(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Qe(i,r)){const a=r[0]-i[0],l=i[2]-r[2],c=r[1]-i[1],h=i[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),c<0?u[1]=c-o:h<0&&(u[1]=Math.abs(h)+o),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(d);if(!g)return;const f=[g[0]+u[0],g[1]+u[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:m.duration,easing:m.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(Ie.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=`${e[0]+n[0]}px`,a=`${e[1]+n[1]}px`;let l="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const h=`translate(${l}, ${c}) translate(${o}, ${a})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,i.transform=h)}getOptions(){return this.options}}const dc=[];class w_ extends is{constructor(e,t,i,n,r){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.removeSourceTiles_=r,this.wrappedTileCoord=i}getContext(){return this.context_||(this.context_=ae(1,1,dc)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const t=Y(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedPixelRatio:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(Qn(this.context_),dc.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let T_=class extends is{constructor(e,t,i,n,r,o){super(e,t,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=i,this.key=i}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==D.IDLE&&(this.setState(D.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(D.ERROR)}setFeatures(e){this.features_=e,this.setState(D.LOADED)}setLoader(e){this.loader_=e}};function no(s,e,t){if(!(t in s))return s[t]=new Set([e]),!0;const i=s[t],n=i.has(e);return n||i.add(e),!n}function R_(s,e,t){const i=s[t];return i?i.delete(e):!1}function fc(s,e){const t=s.layerStatesArray[s.layerIndex];t.extent&&(e=Ae(e,at(t.extent,s.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(s.viewState.projection).getExtent();n&&(e=Ae(e,n))}return e}class Bh extends Fa{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Fe(),this.tempTileRange_=new va(0,0,0,0),this.tempTileCoord_=Vs(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Xs(i),this.sourceTileCache_=null,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new Xs(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,n){const r=this.tileCache_,a=this.getLayer().getSource(),l=An(a,a.getKey(),e,t,i);let c;if(r.containsKey(l))c=r.get(l);else{const h=n.viewState.projection,u=a.getProjection();if(c=a.getTile(e,t,i,n.pixelRatio,h,!u||de(u,h)?void 0:this.getSourceTileCache()),!c)return null;r.set(l,c)}return c}getTile(e,t,i,n){const r=this.getOrCreateTile(e,t,i,n);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=we(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!gi(r,n))return null;const o=t.viewState,a=i.getRenderSource(),l=a.getTileGridForProjection(o.projection),c=a.getTilePixelRatio(t.pixelRatio);for(let h=l.getZForResolution(o.resolution);h>=l.getMinZoom();--h){const u=l.getTileCoordForCoordAndZ(n,h),d=this.getTile(h,u[1],u[2],t);if(!d||d.getState()!==D.LOADED)continue;const g=l.getOrigin(h),f=ye(l.getTileSize(h)),m=l.getResolution(h);let _;if(d instanceof _h||d instanceof xh)_=d.getImage();else if(d instanceof js){if(_=zs(d.getData()),!_)continue}else continue;const p=Math.floor(c*((n[0]-g[0])/m-u[1]*f[0])),y=Math.floor(c*((g[1]-n[1])/m-u[2]*f[1])),x=Math.round(c*a.getGutterForProjection(o.projection));return this.getImageData(_,p+x,y+x)}return null}prepareFrame(e){var n;this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),(n=this.sourceTileCache_)==null||n.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,n,r){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),h=Y(l);h in e.wantedTiles||(e.wantedTiles[h]={});const u=e.wantedTiles[h],d=a.getMapInternal(),g=Math.max(i-r,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),f=o.rotation,m=f?Lc(o.center,o.resolution,f,e.size):void 0;for(let _=i;_>=g;--_){const p=c.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),y=c.getResolution(_);for(let x=p.minX;x<=p.maxX;++x)for(let E=p.minY;E<=p.maxY;++E){if(f&&!c.tileCoordIntersectsViewport([_,x,E],m))continue;const C=this.getTile(_,x,E,e);if(!C||!no(n,C,_))continue;const R=C.getKey();if(u[R]=!0,C.getState()===D.IDLE&&!e.tileQueue.isKeyQueued(R)){const T=Vs(_,x,E,this.tempTileCoord_);e.tileQueue.enqueue([C,h,c.getTileCoordCenter(T),y])}}}}findStaleTile_(e,t){const i=this.tileCache_,n=e[0],r=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const c=An(this.getLayer().getSource(),a[l],n,r,o);if(i.containsKey(c)){const h=i.peek(c);if(h.getState()===D.LOADED)return h.endTransition(Y(this)),no(t,h,n),!0}}return!1}findAltTiles_(e,t,i,n){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let h=r.minX;h<=r.maxX;++h)for(let u=r.minY;u<=r.maxY;++u){const d=An(l,c,i,h,u);let g=!1;if(a.containsKey(d)){const f=a.peek(d);f.getState()===D.LOADED&&(no(n,f,i),g=!0)}g||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],n=e.viewState,r=n.projection,o=n.resolution,a=n.center,l=e.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getTileGridForProjection(r),d=u.getZForResolution(o,h.zDirection),g=u.getResolution(d),f=h.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==f&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=f):this.renderedSourceKey_=f;let m=e.extent;const _=h.getTilePixelRatio(l);this.prepareContainer(e,t);const p=this.context.canvas.width,y=this.context.canvas.height,x=i.extent&&at(i.extent);x&&(m=Ae(m,at(i.extent)));const E=g*p/2/_,C=g*y/2/_,w=[a[0]-E,a[1]-C,a[0]+E,a[1]+C],R={};this.renderedTiles.length=0;const T=c.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const k=u.getZForResolution(n.nextResolution,h.zDirection),N=fc(e,e.nextExtent);this.enqueueTiles(e,N,k,R,T)}const S=fc(e,m);if(this.enqueueTiles(e,S,d,R,0),T>0&&setTimeout(()=>{this.enqueueTiles(e,S,d-1,R,T-1)},0),!(d in R))return this.container;const v=Y(this),G=e.time;for(const k of R[d]){const N=k.getState();if(N===D.EMPTY)continue;const z=k.tileCoord;if(N===D.LOADED&&k.getAlpha(v,G)===1){k.endTransition(v);continue}if(N!==D.ERROR&&(this.renderComplete=!1),this.findStaleTile_(z,R)){R_(R,k,d),e.animate=!0;continue}if(this.findAltTiles_(u,z,d+1,R))continue;const q=u.getMinZoom();for(let ee=d-1;ee>=q&&!this.findAltTiles_(u,z,ee,R);--ee);}const A=g/o*l/_,P=this.getRenderContext(e);vt(this.tempTransform,p/2,y/2,A,A,0,-p/2,-y/2),i.extent&&this.clipUnrotated(P,e,x),h.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,e);const F=Object.keys(R).map(Number);F.sort(ht);let L;const U=[],O=[];for(let k=F.length-1;k>=0;--k){const N=F[k],z=h.getTilePixelSize(N,l,r),M=u.getResolution(N)/g,q=z[0]*M*A,ee=z[1]*M*A,Q=u.getTileCoordForCoordAndZ(ft(w),N),re=u.getTileCoordExtent(Q),oe=we(this.tempTransform,[_*(re[0]-w[0])/g,_*(w[3]-re[3])/g]),De=_*h.getGutterForProjection(r);for(const Se of R[N]){if(Se.getState()!==D.LOADED)continue;const fe=Se.tileCoord,Ti=Q[1]-fe[1],an=Math.round(oe[0]-(Ti-1)*q),Qt=Q[2]-fe[2],pt=Math.round(oe[1]-(Qt-1)*ee),Ge=Math.round(oe[0]-Ti*q),Xe=Math.round(oe[1]-Qt*ee),Ri=an-Ge,Si=pt-Xe,ln=F.length===1;let ei=!1;L=[Ge,Xe,Ge+Ri,Xe,Ge+Ri,Xe+Si,Ge,Xe+Si];for(let Ii=0,vi=U.length;Ii<vi;++Ii)if(!ln&&N<O[Ii]){const Ee=U[Ii];ce([Ge,Xe,Ge+Ri,Xe+Si],[Ee[0],Ee[3],Ee[4],Ee[7]])&&(ei||(P.save(),ei=!0),P.beginPath(),P.moveTo(L[0],L[1]),P.lineTo(L[2],L[3]),P.lineTo(L[4],L[5]),P.lineTo(L[6],L[7]),P.moveTo(Ee[6],Ee[7]),P.lineTo(Ee[4],Ee[5]),P.lineTo(Ee[2],Ee[3]),P.lineTo(Ee[0],Ee[1]),P.clip())}U.push(L),O.push(N),this.drawTile(Se,e,Ge,Xe,Ri,Si,De,ln),ei&&P.restore(),this.renderedTiles.unshift(Se),this.updateUsedTiles(e.usedTiles,h,Se)}}if(this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!mi(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=l,this.postRender(this.context,e),i.extent&&P.restore(),P.imageSmoothingEnabled=!0,this.renderComplete){const k=(N,z)=>{var ee;const X=Y(h),M=z.wantedTiles[X],q=M?Object.keys(M).length:0;this.updateCacheSize(q),this.tileCache_.expireCache(),(ee=this.sourceTileCache_)==null||ee.expireCache()};e.postRenderFunctions.push(k)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,n,r,o,a,l){let c;if(e instanceof js){if(c=zs(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const h=this.getRenderContext(t),u=Y(this),d=t.layerStatesArray[t.layerIndex],g=d.opacity*(l?e.getAlpha(u,t.time):1),f=g!==h.globalAlpha;f&&(h.save(),h.globalAlpha=g),h.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,n,r,o),f&&h.restore(),g!==d.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const n=Y(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}}class zh extends pm{constructor(e){super(e)}createRenderer(){return new Bh(this,{cacheSize:this.getCacheSize()})}}class jh extends qs{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return se(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){var n;(n=this.source)==null||n.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(ie.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(ie.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Fe(),t=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let r=0,o=i.length;r<o;r++){const a=i[r];if(!(Y(a)in n)){const l=this.geometryFunction(a);if(l){const c=l.getCoordinates();Yo(c,e),tt(e,t,e);const h=this.source.getFeaturesInExtent(e).filter(function(u){const d=Y(u);return d in n?!1:(n[d]=!0,!0)});this.features.push(this.createCluster(h,e))}}}}createCluster(e,t){const i=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Mc(i,l.getCoordinates()):e.splice(a,1)}yd(i,1/e.length);const n=Me(t),r=this.interpolationRatio,o=new mt([i[0]*(1-r)+n[0]*r,i[1]*(1-r)+n[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Rr({geometry:o,features:e})}}function Re(s){return(e,...t)=>S_(s,e,t)}function rn(s,e){return Re(Xh(s,e).get)}const{apply:S_,getOwnPropertyDescriptor:Xh,getPrototypeOf:Oa,ownKeys:I_}=Reflect,{iterator:ls,toStringTag:v_}=Symbol,A_=Object,{create:Da,defineProperty:b_}=A_,L_=Array,P_=L_.prototype,Vh=P_[ls],F_=Re(Vh),Yh=ArrayBuffer,M_=Yh.prototype;rn(M_,"byteLength");const gc=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;gc&&rn(gc.prototype,"byteLength");const Wh=Oa(Uint8Array);Wh.from;const Oe=Wh.prototype;Oe[ls];Re(Oe.keys);Re(Oe.values);Re(Oe.entries);Re(Oe.set);Re(Oe.reverse);Re(Oe.fill);Re(Oe.copyWithin);Re(Oe.sort);Re(Oe.slice);Re(Oe.subarray);rn(Oe,"buffer");rn(Oe,"byteOffset");rn(Oe,"length");rn(Oe,v_);const O_=Uint8Array,Kh=Uint16Array,Ga=Uint32Array,D_=Float32Array,Wn=Oa([][ls]()),Hh=Re(Wn.next),G_=Re(function*(){}().next),k_=Oa(Wn),N_=DataView.prototype,U_=Re(N_.getUint16),ka=WeakMap,Zh=ka.prototype,qh=Re(Zh.get),B_=Re(Zh.set),$h=new ka,z_=Da(null,{next:{value:function(){const e=qh($h,this);return Hh(e)}},[ls]:{value:function(){return this}}});function j_(s){if(s[ls]===Vh&&Wn.next===Hh)return s;const e=Da(z_);return B_($h,e,F_(s)),e}const X_=new ka,V_=Da(k_,{next:{value:function(){const e=qh(X_,this);return G_(e)},writable:!0,configurable:!0}});for(const s of I_(Wn))s!=="next"&&b_(V_,s,Xh(Wn,s));const Jh=new Yh(4),Y_=new D_(Jh),W_=new Ga(Jh),st=new Kh(512),rt=new O_(512);for(let s=0;s<256;++s){const e=s-127;e<-24?(st[s]=0,st[s|256]=32768,rt[s]=24,rt[s|256]=24):e<-14?(st[s]=1024>>-e-14,st[s|256]=1024>>-e-14|32768,rt[s]=-e-1,rt[s|256]=-e-1):e<=15?(st[s]=e+15<<10,st[s|256]=e+15<<10|32768,rt[s]=13,rt[s|256]=13):e<128?(st[s]=31744,st[s|256]=64512,rt[s]=24,rt[s|256]=24):(st[s]=31744,st[s|256]=64512,rt[s]=13,rt[s|256]=13)}const Na=new Ga(2048);for(let s=1;s<1024;++s){let e=s<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Na[s]=e|t}for(let s=1024;s<2048;++s)Na[s]=939524096+(s-1024<<13);const on=new Ga(64);for(let s=1;s<31;++s)on[s]=s<<23;on[31]=1199570944;on[32]=2147483648;for(let s=33;s<63;++s)on[s]=2147483648+(s-32<<23);on[63]=3347054592;const Qh=new Kh(64);for(let s=1;s<64;++s)s!==32&&(Qh[s]=1024);function K_(s){const e=s>>10;return W_[0]=Na[Qh[e]+(s&1023)]+on[e],Y_[0]}function eu(s,e,...t){return K_(U_(s,e,...j_(t)))}var Ua={exports:{}};function tu(s,e,t){const i=t&&t.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+s);const n=typeof s=="object"?s.outer:s,r=n.slice(0,n.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],c=e+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",c);const u=new RegExp(c).exec(r);if(i&&console.log("[xml-utils] match:",u),u)return u[1]}}Ua.exports=tu;Ua.exports.default=tu;var H_=Ua.exports;const so=Sc(H_);var Ba={exports:{}},za={exports:{}},ja={exports:{}};function iu(s,e,t){const n=new RegExp(e).exec(s.slice(t));return n?t+n.index:-1}ja.exports=iu;ja.exports.default=iu;var Z_=ja.exports,Xa={exports:{}};function nu(s,e,t){const n=new RegExp(e).exec(s.slice(t));return n?t+n.index+n[0].length-1:-1}Xa.exports=nu;Xa.exports.default=nu;var q_=Xa.exports,Va={exports:{}};function su(s,e){const t=new RegExp(e,"g"),i=s.match(t);return i?i.length:0}Va.exports=su;Va.exports.default=su;var $_=Va.exports;const J_=Z_,ro=q_,mc=$_;function ru(s,e,t){const i=t&&t.debug||!1,n=!(t&&typeof t.nested===!1),r=t&&t.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=J_(s,`<${e}[ 
>/]`,r);if(i&&console.log("[xml-utils] start:",o),o===-1)return;const a=s.slice(o+e.length);let l=ro(a,"^[^<]*[ /]>",0);const c=l!==-1&&a[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",c),c===!1)if(n){let g=0,f=1,m=0;for(;(l=ro(a,"[ /]"+e+">",g))!==-1;){const _=a.substring(g,l+1);if(f+=mc(_,"<"+e+`[ 
	>]`),m+=mc(_,"</"+e+">"),m>=f)break;g=l}}else l=ro(a,"[ /]"+e+">",0);const h=o+e.length+l+1;if(i&&console.log("[xml-utils] end:",h),h===-1)return;const u=s.slice(o,h);let d;return c?d=null:d=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:d,outer:u,start:o,end:h}}za.exports=ru;za.exports.default=ru;var Q_=za.exports;const e0=Q_;function ou(s,e,t){const i=[],n=t&&t.debug||!1,r=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=e0(s,e,{debug:n,startIndex:o});)r?o=a.start+1+e.length:o=a.end,i.push(a);return n&&console.log("findTagsByName found",i.length,"tags"),i}Ba.exports=ou;Ba.exports.default=ou;var t0=Ba.exports;const i0=Sc(t0),bn={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ot={};for(const s in bn)bn.hasOwnProperty(s)&&(ot[bn[s]]=parseInt(s,10));const n0=[ot.BitsPerSample,ot.ExtraSamples,ot.SampleFormat,ot.StripByteCounts,ot.StripOffsets,ot.StripRowCounts,ot.TileByteCounts,ot.TileOffsets,ot.SubIFDs],oo={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},K={};for(const s in oo)oo.hasOwnProperty(s)&&(K[oo[s]]=parseInt(s,10));const Ue={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},s0={Unspecified:0},qy={AddCompression:1},$y={None:0,Deflate:1,Zstandard:2},r0={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function o0(s,e){const{width:t,height:i}=s,n=new Uint8Array(t*i*3);let r;for(let o=0,a=0;o<s.length;++o,a+=3)r=256-s[o]/e*256,n[a]=r,n[a+1]=r,n[a+2]=r;return n}function a0(s,e){const{width:t,height:i}=s,n=new Uint8Array(t*i*3);let r;for(let o=0,a=0;o<s.length;++o,a+=3)r=s[o]/e*256,n[a]=r,n[a+1]=r,n[a+2]=r;return n}function l0(s,e){const{width:t,height:i}=s,n=new Uint8Array(t*i*3),r=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<s.length;++a,l+=3){const c=s[a];n[l]=e[c]/65536*256,n[l+1]=e[c+r]/65536*256,n[l+2]=e[c+o]/65536*256}return n}function c0(s){const{width:e,height:t}=s,i=new Uint8Array(e*t*3);for(let n=0,r=0;n<s.length;n+=4,r+=3){const o=s[n],a=s[n+1],l=s[n+2],c=s[n+3];i[r]=255*((255-o)/256)*((255-c)/256),i[r+1]=255*((255-a)/256)*((255-c)/256),i[r+2]=255*((255-l)/256)*((255-c)/256)}return i}function h0(s){const{width:e,height:t}=s,i=new Uint8ClampedArray(e*t*3);for(let n=0,r=0;n<s.length;n+=3,r+=3){const o=s[n],a=s[n+1],l=s[n+2];i[r]=o+1.402*(l-128),i[r+1]=o-.34414*(a-128)-.71414*(l-128),i[r+2]=o+1.772*(a-128)}return i}const u0=.95047,d0=1,f0=1.08883;function g0(s){const{width:e,height:t}=s,i=new Uint8Array(e*t*3);for(let n=0,r=0;n<s.length;n+=3,r+=3){const o=s[n+0],a=s[n+1]<<24>>24,l=s[n+2]<<24>>24;let c=(o+16)/116,h=a/500+c,u=c-l/200,d,g,f;h=u0*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),c=d0*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),u=f0*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=h*3.2406+c*-1.5372+u*-.4986,g=h*-.9689+c*1.8758+u*.0415,f=h*.0557+c*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,i[r]=Math.max(0,Math.min(1,d))*255,i[r+1]=Math.max(0,Math.min(1,g))*255,i[r+2]=Math.max(0,Math.min(1,f))*255}return i}const au=new Map;function Jt(s,e){Array.isArray(s)||(s=[s]),s.forEach(t=>au.set(t,e))}async function lu(s){const e=au.get(s.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const t=await e();return new t(s)}Jt([void 0,1],()=>qt(()=>import("./raw.DyYbxgyd.js"),__vite__mapDeps([0,1])).then(s=>s.default));Jt(5,()=>qt(()=>import("./lzw.9lk_P5pn.js"),__vite__mapDeps([2,1])).then(s=>s.default));Jt(6,()=>{throw new Error("old style JPEG compression is not supported.")});Jt(7,()=>qt(()=>import("./jpeg.ChvvgP7W.js"),__vite__mapDeps([3,1])).then(s=>s.default));Jt([8,32946],()=>qt(()=>import("./deflate.kDd4rSQl.js"),__vite__mapDeps([4,5,1])).then(s=>s.default));Jt(32773,()=>qt(()=>import("./packbits.C0Dum_0_.js"),__vite__mapDeps([6,1])).then(s=>s.default));Jt(34887,()=>qt(()=>import("./lerc.B6J91Bdt.js"),__vite__mapDeps([7,5,1])).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));Jt(50001,()=>qt(()=>import("./webimage.DJeFoGB9.js"),__vite__mapDeps([8,1])).then(s=>s.default));function Sr(s,e,t,i=1){return new(Object.getPrototypeOf(s)).constructor(e*t*i)}function m0(s,e,t,i,n){const r=e/i,o=t/n;return s.map(a=>{const l=Sr(a,i,n);for(let c=0;c<n;++c){const h=Math.min(Math.round(o*c),t-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(r*u),e-1),g=a[h*e+d];l[c*i+u]=g}}return l})}function Hi(s,e,t){return(1-t)*s+t*e}function _0(s,e,t,i,n){const r=e/i,o=t/n;return s.map(a=>{const l=Sr(a,i,n);for(let c=0;c<n;++c){const h=o*c,u=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<i;++g){const f=r*g,m=f%1,_=Math.floor(f),p=Math.min(Math.ceil(f),e-1),y=a[u*e+_],x=a[u*e+p],E=a[d*e+_],C=a[d*e+p],w=Hi(Hi(y,x,m),Hi(E,C,m),h%1);l[c*i+g]=w}}return l})}function p0(s,e,t,i,n,r="nearest"){switch(r.toLowerCase()){case"nearest":return m0(s,e,t,i,n);case"bilinear":case"linear":return _0(s,e,t,i,n);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function y0(s,e,t,i,n,r){const o=e/i,a=t/n,l=Sr(s,i,n,r);for(let c=0;c<n;++c){const h=Math.min(Math.round(a*c),t-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(o*u),e-1);for(let g=0;g<r;++g){const f=s[h*e*r+d*r+g];l[c*i*r+u*r+g]=f}}}return l}function x0(s,e,t,i,n,r){const o=e/i,a=t/n,l=Sr(s,i,n,r);for(let c=0;c<n;++c){const h=a*c,u=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<i;++g){const f=o*g,m=f%1,_=Math.floor(f),p=Math.min(Math.ceil(f),e-1);for(let y=0;y<r;++y){const x=s[u*e*r+_*r+y],E=s[u*e*r+p*r+y],C=s[d*e*r+_*r+y],w=s[d*e*r+p*r+y],R=Hi(Hi(x,E,m),Hi(C,w,m),h%1);l[c*i*r+g*r+y]=R}}}return l}function E0(s,e,t,i,n,r,o="nearest"){switch(o.toLowerCase()){case"nearest":return y0(s,e,t,i,n,r);case"bilinear":case"linear":return x0(s,e,t,i,n,r);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function C0(s,e,t){let i=0;for(let n=e;n<t;++n)i+=s[n];return i}function Po(s,e,t){switch(s){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function w0(s,e){return(s===1||s===2)&&e<=32&&e%8===0?!1:!(s===3&&(e===16||e===32||e===64))}function T0(s,e,t,i,n,r,o){const a=new DataView(s),l=t===2?o*r:o*r*i,c=t===2?1:i,h=Po(e,n,l),u=parseInt("1".repeat(n),2);if(e===1){let d;t===1?d=i*n:d=n;let g=r*d;g&7&&(g=g+7&-8);for(let f=0;f<o;++f){const m=f*g;for(let _=0;_<r;++_){const p=m+_*c*n;for(let y=0;y<c;++y){const x=p+y*n,E=(f*r+_)*c+y,C=Math.floor(x/8),w=x%8;if(w+n<=8)h[E]=a.getUint8(C)>>8-n-w&u;else if(w+n<=16)h[E]=a.getUint16(C)>>16-n-w&u;else if(w+n<=24){const R=a.getUint16(C)<<8|a.getUint8(C+2);h[E]=R>>24-n-w&u}else h[E]=a.getUint32(C)>>32-n-w&u}}}}return h.buffer}class cu{constructor(e,t,i,n,r,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=n,this.tiles=r?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,r){return eu(this,n,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return Po(i,n,t)}async getTileOrStrip(e,t,i,n,r){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=i*o*a+t*o+e);let h,u;this.isTiled?(h=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(h=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:h,length:u}],r))[0];let g;return c===null||!c[l]?(g=(async()=>{let f=await n.decode(this.fileDirectory,d);const m=this.getSampleFormat(),_=this.getBitsPerSample();return w0(m,_)&&(f=T0(f,m,this.planarConfiguration,this.getSamplesPerPixel(),_,this.getTileWidth(),this.getBlockHeight(t))),f})(),c!==null&&(c[l]=g)):g=c[l],{x:e,y:t,sample:i,data:await g}}async _readRaster(e,t,i,n,r,o,a,l,c){const h=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),g=this.getHeight(),f=Math.max(Math.floor(e[0]/h),0),m=Math.min(Math.ceil(e[2]/h),Math.ceil(d/h)),_=Math.max(Math.floor(e[1]/u),0),p=Math.min(Math.ceil(e[3]/u),Math.ceil(g/u)),y=e[2]-e[0];let x=this.getBytesPerPixel();const E=[],C=[];for(let T=0;T<t.length;++T)this.planarConfiguration===1?E.push(C0(this.fileDirectory.BitsPerSample,0,t[T])/8):E.push(0),C.push(this.getReaderForSample(t[T]));const w=[],{littleEndian:R}=this;for(let T=_;T<p;++T)for(let S=f;S<m;++S){let v;this.planarConfiguration===1&&(v=this.getTileOrStrip(S,T,0,r,c));for(let G=0;G<t.length;++G){const A=G,P=t[G];this.planarConfiguration===2&&(x=this.getSampleByteSize(P),v=this.getTileOrStrip(S,T,P,r,c));const F=v.then(L=>{const U=L.data,O=new DataView(U),k=this.getBlockHeight(L.y),N=L.y*u,z=L.x*h,X=N+k,M=(L.x+1)*h,q=C[A],ee=Math.min(k,k-(X-e[3]),g-N),Q=Math.min(h,h-(M-e[2]),d-z);for(let re=Math.max(0,e[1]-N);re<ee;++re)for(let oe=Math.max(0,e[0]-z);oe<Q;++oe){const De=(re*h+oe)*x,Se=q.call(O,De+E[A],R);let fe;n?(fe=(re+N-e[1])*y*t.length+(oe+z-e[0])*t.length+A,i[fe]=Se):(fe=(re+N-e[1])*y+oe+z-e[0],i[A][fe]=Se)}});w.push(F)}}if(await Promise.all(w),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let T;return n?T=E0(i,e[2]-e[0],e[3]-e[1],o,a,t.length,l):T=p0(i,e[2]-e[0],e[3]-e[1],o,a,l),T.width=o,T.height=a,T}return i.width=o||e[2]-e[0],i.height=a||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:n=null,width:r,height:o,resampleMethod:a,fillValue:l,signal:c}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const u=h[2]-h[0],d=h[3]-h[1],g=u*d,f=this.getSamplesPerPixel();if(!t||!t.length)for(let y=0;y<f;++y)t.push(y);else for(let y=0;y<t.length;++y)if(t[y]>=f)return Promise.reject(new RangeError(`Invalid sample index '${t[y]}'.`));let m;if(i){const y=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,x=Math.max.apply(null,this.fileDirectory.BitsPerSample);m=Po(y,x,g*t.length),l&&m.fill(l)}else{m=[];for(let y=0;y<t.length;++y){const x=this.getArrayForSample(t[y],g);Array.isArray(l)&&y<l.length?x.fill(l[y]):l&&!Array.isArray(l)&&x.fill(l),m.push(x)}}const _=n||await lu(this.fileDirectory);return await this._readRaster(h,t,m,i,_,r,o,a,c)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:n,height:r,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===Ue.RGB){let p=[0,1,2];if(this.fileDirectory.ExtraSamples!==s0.Unspecified&&a){p=[];for(let y=0;y<this.fileDirectory.BitsPerSample.length;y+=1)p.push(y)}return this.readRasters({window:e,interleave:t,samples:p,pool:i,width:n,height:r,resampleMethod:o,signal:l})}let u;switch(h){case Ue.WhiteIsZero:case Ue.BlackIsZero:case Ue.Palette:u=[0];break;case Ue.CMYK:u=[0,1,2,3];break;case Ue.YCbCr:case Ue.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:c,interleave:!0,samples:u,pool:i,width:n,height:r,resampleMethod:o,signal:l},{fileDirectory:g}=this,f=await this.readRasters(d),m=2**this.fileDirectory.BitsPerSample[0];let _;switch(h){case Ue.WhiteIsZero:_=o0(f,m);break;case Ue.BlackIsZero:_=a0(f,m);break;case Ue.Palette:_=l0(f,g.ColorMap);break;case Ue.CMYK:_=c0(f);break;case Ue.YCbCr:_=h0(f);break;case Ue.CIELab:_=g0(f);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const p=new Uint8Array(_.length/3),y=new Uint8Array(_.length/3),x=new Uint8Array(_.length/3);for(let E=0,C=0;E<_.length;E+=3,++C)p[C]=_[E],y[C]=_[E+1],x[C]=_[E+2];_=[p,y,x]}return _.width=f.width,_.height=f.height,_}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=i0(i,"Item");e===null?n=n.filter(r=>so(r,"sample")===void 0):n=n.filter(r=>Number(so(r,"sample"))===e);for(let r=0;r<n.length;++r){const o=n[r];t[so(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[n,r,o]=e.getResolution();return[n*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[n,r,o,a,l,c,h,u]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,t],[i,0],[i,t]].map(([_,p])=>[a+n*_+r*p,u+l*_+c*p]),f=g.map(_=>_[0]),m=g.map(_=>_[1]);return[Math.min(...f),Math.min(...m),Math.max(...f),Math.max(...m)]}else{const n=this.getOrigin(),r=this.getResolution(),o=n[0],a=n[1],l=o+r[0]*i,c=a+r[1]*t;return[Math.min(o,l),Math.min(a,c),Math.max(o,l),Math.max(a,c)]}}}class R0{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),n=this.getUint32(e+4,t);let r;if(t){if(r=i+2**32*n,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*i+n,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(e,t){let i=0;const n=(this._dataView.getUint8(e+(t?7:0))&128)>0;let r=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));n&&(r?a!==0&&(a=~(a-1)&255,r=!1):a=~a&255),i+=a*256**o}return n&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return eu(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class S0{constructor(e,t,i,n){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=t+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*t+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let r=0;r<8;r++){let o=this._dataView.getUint8(e+(this._littleEndian?r:7-r));i&&(n?o!==0&&(o=~(o-1)&255,n=!1):o=~o&255),t+=o*256**r}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const I0=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Jy{constructor(e=I0,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{qt(()=>import("./decoder.tqM1uIvc.js"),[]).then(n=>{i(n.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let n=0;n<e;n++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?lu(e).then(i=>i.decode(e,t)):new Promise(i=>{const n=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const r=this.messageId++,o=a=>{a.data.id===r&&(n.idle=!0,i(a.data.decoded),n.worker.removeEventListener("message",o))};n.worker.addEventListener("message",o),n.worker.postMessage({fileDirectory:e,buffer:t,id:r},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const _c=`\r
\r
`;function hu(s){if(typeof Object.fromEntries<"u")return Object.fromEntries(s);const e={};for(const[t,i]of s)e[t.toLowerCase()]=i;return e}function v0(s){const e=s.split(`\r
`).map(t=>{const i=t.split(":").map(n=>n.trim());return i[0]=i[0].toLowerCase(),i});return hu(e)}function A0(s){const[e,...t]=s.split(";").map(n=>n.trim()),i=t.map(n=>n.split("="));return{type:e,params:hu(i)}}function Fo(s){let e,t,i;return s&&([,e,t,i]=s.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function b0(s,e){let t=null;const i=new TextDecoder("ascii"),n=[],r=`--${e}`,o=`${r}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(s,a,r.length))===r&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<s.byteLength;){const a=i.decode(new Uint8Array(s,t,Math.min(r.length+1024,s.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(r))throw new Error("Part does not start with boundary");const l=a.substr(r.length+2);if(l.length===0)break;const c=l.indexOf(_c),h=v0(l.substr(0,c)),{start:u,end:d,total:g}=Fo(h["content-range"]),f=t+r.length+c+_c.length,m=parseInt(d,10)+1-parseInt(u,10);n.push({headers:h,data:s.slice(f,f+m),offset:u,length:m,fileSize:g}),t=f+m+4}return n}class Ya{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class L0 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const n=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:n}):this._set(e,{value:t,expiry:n}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[n,r]=i;this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[n,r]=i;this.cache.has(n)||this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,n]of this.entriesAscending())e.call(t,n,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function P0(s){return new Promise(e=>setTimeout(e,s))}function F0(s,e){const t=Array.isArray(s)?s:Array.from(s),i=Array.isArray(e)?e:Array.from(e);return t.map((n,r)=>[n,i[r]])}class Qi extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Qi),this.name="AbortError"}}class M0 extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const O0=M0;class D0{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class pc{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class G0 extends Ya{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new L0({maxSize:i,onEviction:(n,r)=>{this.evictedBlocks.set(n,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=[],n=[],r=[];this.evictedBlocks.clear();for(const{offset:d,length:g}of e){let f=d+g;const{fileSize:m}=this;m!==null&&(f=Math.min(f,m));const _=Math.floor(d/this.blockSize)*this.blockSize;for(let p=_;p<f;p+=this.blockSize){const y=Math.floor(p/this.blockSize);!this.blockCache.has(y)&&!this.blockRequests.has(y)&&(this.blockIdsToFetch.add(y),n.push(y)),this.blockRequests.has(y)&&i.push(this.blockRequests.get(y)),r.push(y)}}await P0(),this.fetchBlocks(t);const o=[];for(const d of n)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],l=r.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const g=this.blockRequests.get(d);if(!g)throw new Error(`Block ${d} is not in the block requests`);a.push(g)}await Promise.allSettled(a)}if(t&&t.aborted)throw new Qi("Request was aborted");const c=r.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),h=c.filter(d=>!d);if(h.length)throw new O0(h,"Request failed");const u=new Map(F0(r,c));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let n=0;n<t.length;++n){const r=t[n];for(const o of r.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[n],l=o*this.blockSize,c=l-a.offset,h=Math.min(c+this.blockSize,a.data.byteLength),u=a.data.slice(c,h),d=new D0(l,u.byteLength,u,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let i=[],n=null;const r=[];for(const o of t)n===null||n+1===o?(i.push(o),n=o):(r.push(new pc(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],n=o);return r.push(new pc(i[0]*this.blockSize,i.length*this.blockSize,i)),r}readSliceData(e,t){return e.map(i=>{let n=i.offset+i.length;this.fileSize!==null&&(n=Math.min(this.fileSize,n));const r=Math.floor(i.offset/this.blockSize),o=Math.floor(n/this.blockSize),a=new ArrayBuffer(i.length),l=new Uint8Array(a);for(let c=r;c<=o;++c){const h=t.get(c),u=h.offset-i.offset,d=h.top-n;let g=0,f=0,m;u<0?g=-u:u>0&&(f=u),d<0?m=h.length-g:m=n-h.offset-g;const _=new Uint8Array(h.data,g,m);l.set(_,f)}return a})}}class Wa{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Ka{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class k0 extends Wa{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class N0 extends Ka{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const i=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new k0(i)}}class U0 extends Wa{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class B0 extends Ka{constructRequest(e,t){return new Promise((i,n)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[o,a]of Object.entries(e))r.setRequestHeader(o,a);r.onload=()=>{const o=r.response;i(new U0(r,o))},r.onerror=n,r.onabort=()=>n(new Qi("Request aborted")),r.send(),t&&(t.aborted&&r.abort(),t.addEventListener("abort",()=>r.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const ao={};class z0 extends Wa{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class j0 extends Ka{constructor(e){super(e),this.parsedUrl=ao.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",ao)}constructRequest(e,t){return new Promise((i,n)=>{const r=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const c=[];o.on("data",h=>{c.push(h)}),o.on("end",()=>{const h=Buffer.concat(c).buffer;l(h)}),o.on("error",n)});i(new z0(o,a))});r.on("error",n),t&&(t.aborted&&r.destroy(new Qi("Request aborted")),t.addEventListener("abort",()=>r.destroy(new Qi("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Ha extends Ya{constructor(e,t,i,n){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=n,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:n,length:r})=>`${n}-${n+r}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:n,params:r}=A0(i.getHeader("content-type"));if(n==="multipart/byteranges"){const u=b0(await i.getData(),r.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await i.getData(),{start:a,end:l,total:c}=Fo(i.getHeader("content-range"));this._fileSize=c||null;const h=[{data:o,offset:a,length:l-a}];if(e.length>1){const u=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return h.concat(u)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const n=await i.getData();return this._fileSize=n.byteLength,[{data:n,offset:0,length:n.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:n}=e,r=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+n}`},signal:t});if(r.ok)if(r.status===206){const o=await r.getData(),{total:a}=Fo(r.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:n}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await r.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Za(s,{blockSize:e,cacheSize:t}){return e===null?s:new G0(s,{blockSize:e,cacheSize:t})}function X0(s,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:n=!1,...r}={}){const o=new N0(s,t),a=new Ha(o,e,i,n);return Za(a,r)}function V0(s,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const r=new B0(s),o=new Ha(r,e,t,i);return Za(o,n)}function Y0(s,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const r=new j0(s),o=new Ha(r,e,t,i);return Za(o,n)}function Mo(s,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?X0(s,t):typeof XMLHttpRequest<"u"?V0(s,t):Y0(s,t)}class W0 extends Ya{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,n)=>{const r=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=n,o.onabort=n,o.readAsArrayBuffer(r),t&&t.addEventListener("abort",()=>o.abort())})}}function K0(s){return new W0(s)}function H0(s,e){let t=s.length-e,i=0;do{for(let n=e;n>0;n--)s[i+e]+=s[i],i++;t-=e}while(t>0)}function Z0(s,e,t){let i=0,n=s.length;const r=n/t;for(;n>e;){for(let a=e;a>0;--a)s[i+e]+=s[i],++i;n-=e}const o=s.slice();for(let a=0;a<r;++a)for(let l=0;l<t;++l)s[t*a+l]=o[(t-l-1)*r+a]}function q0(s,e,t,i,n,r){if(e===1)return s;for(let l=0;l<n.length;++l){if(n[l]%8!==0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(n[l]!==n[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const o=n[0]/8,a=r===2?1:n.length;for(let l=0;l<i&&!(l*a*t*o>=s.byteLength);++l){let c;if(e===2){switch(n[0]){case 8:c=new Uint8Array(s,l*a*t*o,a*t*o);break;case 16:c=new Uint16Array(s,l*a*t*o,a*t*o/2);break;case 32:c=new Uint32Array(s,l*a*t*o,a*t*o/4);break;default:throw new Error(`Predictor 2 not allowed with ${n[0]} bits per sample.`)}H0(c,a)}else e===3&&(c=new Uint8Array(s,l*a*t*o,a*t*o),Z0(c,a,o))}return s}class Qy{async decode(e,t){const i=await this.decodeBlock(t),n=e.Predictor||1;if(n!==1){const r=!e.StripOffsets,o=r?e.TileWidth:e.ImageWidth,a=r?e.TileLength:e.RowsPerStrip||e.ImageLength;return q0(i,n,o,a,e.BitsPerSample,e.PlanarConfiguration)}return i}}function Oo(s){switch(s){case K.BYTE:case K.ASCII:case K.SBYTE:case K.UNDEFINED:return 1;case K.SHORT:case K.SSHORT:return 2;case K.LONG:case K.SLONG:case K.FLOAT:case K.IFD:return 4;case K.RATIONAL:case K.SRATIONAL:case K.DOUBLE:case K.LONG8:case K.SLONG8:case K.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function $0(s){const e=s.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const n=r0[e[i]],r=e[i+1]?bn[e[i+1]]:null,o=e[i+2],a=e[i+3];let l=null;if(!r)l=a;else{if(l=s[r],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[n]=l}return t}function Gi(s,e,t,i){let n=null,r=null;const o=Oo(e);switch(e){case K.BYTE:case K.ASCII:case K.UNDEFINED:n=new Uint8Array(t),r=s.readUint8;break;case K.SBYTE:n=new Int8Array(t),r=s.readInt8;break;case K.SHORT:n=new Uint16Array(t),r=s.readUint16;break;case K.SSHORT:n=new Int16Array(t),r=s.readInt16;break;case K.LONG:case K.IFD:n=new Uint32Array(t),r=s.readUint32;break;case K.SLONG:n=new Int32Array(t),r=s.readInt32;break;case K.LONG8:case K.IFD8:n=new Array(t),r=s.readUint64;break;case K.SLONG8:n=new Array(t),r=s.readInt64;break;case K.RATIONAL:n=new Uint32Array(t*2),r=s.readUint32;break;case K.SRATIONAL:n=new Int32Array(t*2),r=s.readInt32;break;case K.FLOAT:n=new Float32Array(t),r=s.readFloat32;break;case K.DOUBLE:n=new Float64Array(t),r=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===K.RATIONAL||e===K.SRATIONAL)for(let a=0;a<t;a+=2)n[a]=r.call(s,i+a*o),n[a+1]=r.call(s,i+(a*o+4));else for(let a=0;a<t;++a)n[a]=r.call(s,i+a*o);return e===K.ASCII?new TextDecoder("utf-8").decode(n):n}class J0{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class xs extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class uu{async readRasters(e={}){const{window:t,width:i,height:n}=e;let{resX:r,resY:o,bbox:a}=e;const l=await this.getImage();let c=l;const h=await this.getImageCount(),u=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(t){const[f,m]=l.getOrigin(),[_,p]=l.getResolution();a=[f+t[0]*_,m+t[1]*p,f+t[2]*_,m+t[3]*p]}const g=a||u;if(i){if(r)throw new Error("Both width and resX passed");r=(g[2]-g[0])/i}if(n){if(o)throw new Error("Both width and resY passed");o=(g[3]-g[1])/n}}if(r||o){const g=[];for(let f=0;f<h;++f){const m=await this.getImage(f),{SubfileType:_,NewSubfileType:p}=m.fileDirectory;(f===0||_===2||p&1)&&g.push(m)}g.sort((f,m)=>f.getWidth()-m.getWidth());for(let f=0;f<g.length;++f){const m=g[f],_=(u[2]-u[0])/m.getWidth(),p=(u[3]-u[1])/m.getHeight();if(c=m,r&&r>_||o&&o>p)break}}let d=t;if(a){const[g,f]=l.getOrigin(),[m,_]=c.getResolution(l);d=[Math.round((a[0]-g)/m),Math.round((a[1]-f)/_),Math.round((a[2]-g)/m),Math.round((a[3]-f)/_)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return c.readRasters({...e,window:d})}}class en extends uu{constructor(e,t,i,n,r={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=n,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new S0((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const r=this.bigTiff?n.readUint64(e):n.readUint16(e),o=r*t+(this.bigTiff?16:6);n.covers(e,o)||(n=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let u=0;u<r;l+=t,++u){const d=n.readUint16(l),g=n.readUint16(l+2),f=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let m,_;const p=Oo(g),y=l+(this.bigTiff?12:8);if(p*f<=(this.bigTiff?8:4))m=Gi(n,g,f,y);else{const x=n.readOffset(y),E=Oo(g)*f;if(n.covers(x,E))m=Gi(n,g,f,x);else{const C=await this.getSlice(x,E);m=Gi(C,g,f,x)}}f===1&&n0.indexOf(d)===-1&&!(g===K.RATIONAL||g===K.SRATIONAL)?_=m[0]:_=m,a[bn[d]]=_}const c=$0(a),h=n.readOffset(e+i+t*r);return new J0(a,c,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof xs?new xs(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new xs(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new cu(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof xs)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let n=await this.getSlice(e,i);if(t===Gi(n,K.ASCII,t.length,e)){const o=Gi(n,K.ASCII,i,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>i&&(n=await this.getSlice(e,a));const l=Gi(n,K.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,h])=>{this.ghostValues[c]=h})}return this.ghostValues}static async fromSource(e,t,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],r=new R0(n),o=r.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=r.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,r.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=c?r.getUint64(8,a):r.getUint32(4,a);return new en(e,a,c,h,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class Q0 extends uu{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let n=0;n<this.imageFiles.length;n++){const r=this.imageFiles[n];for(let o=0;o<this.imageCounts[n];o++){if(e===t){const a=await r.requestIFD(i);return new cu(a.fileDirectory,a.geoKeyDirectory,r.dataView,r.littleEndian,r.cache,r.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function ex(s,e={},t){return en.fromSource(Mo(s,e),t)}async function tx(s,e){return en.fromSource(K0(s),e)}async function ix(s,e=[],t={},i){const n=await en.fromSource(Mo(s,t),i),r=await Promise.all(e.map(o=>en.fromSource(Mo(o,t))));return new Q0(n,r)}function Do(s){return Array.isArray(s)?Math.min(...s):s}class ep extends fr{constructor(e,t,i,n,r,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let c=t.getExtent();c&&t.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);const h=c?Ae(i,c):i,u=Me(h),d=jn(e,t,u,n),g=Ia,f=new Sa(e,t,h,l,d*g,n),m=f.calculateSourceExtent(),_=Ei(m)?null:o(m,d,r),p=_?B.IDLE:B.EMPTY,y=_?_.getPixelRatio():1;super(i,n,y,p),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=_,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==B.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==B.LOADED){const t=Z(this.targetExtent_)/this.targetResolution_,i=le(this.targetExtent_)/this.targetResolution_;this.canvas_=yh(t,i,this.sourcePixelRatio_,Do(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==B.IDLE){this.state=B.LOADING,this.changed();const e=this.sourceImage_.getState();e==B.LOADED||e==B.ERROR?this.reproject_():(this.sourceListenerKey_=me(this.sourceImage_,ie.CHANGE,t=>{const i=this.sourceImage_.getState();(i==B.LOADED||i==B.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){xe(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Vt=4,lo={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class tp extends bt{constructor(e,t){super(e),this.image=t}}class Ir extends ss{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=Qs(t,e,0);e=t[i]}return e}getImage(e,t,i,n){const r=this.getProjection();if(!r||!n||de(r,n))return r&&(n=r),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&de(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&mi(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ep(r,n,e,t,i,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const r=fu(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&Qe(this.wantedExtent_,r)||Qe(this.image.getExtent(),r))&&(this.wantedResolution_&&Do(this.wantedResolution_)===o||Do(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new fr(r,o,i,this.loader),this.image.addEventListener(ie.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case B.LOADING:this.loading=!0,i=lo.IMAGELOADSTART;break;case B.LOADED:this.loading=!1,i=lo.IMAGELOADEND;break;case B.ERROR:this.loading=!1,i=lo.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new tp(i,t))}}function du(s,e){s.getImage().src=e}function fu(s,e,t,i){const n=e/t,r=Me(s),o=Bt(Z(s)/n,Vt),a=Bt(le(s)/n,Vt),l=Bt((i-1)*o/2,Vt),c=o+2*l,h=Bt((i-1)*a/2,Vt),u=a+2*h;return Zo(r,n,0,[c,u])}function ip(s){const e=s.load||gr,t=s.imageExtent,i=s.crossOrigin??null;return()=>{const n=new Image;return n.crossOrigin=i,e(n,s.url).then(r=>{const o=Z(t)/r.width,a=le(t)/r.height;return{image:r,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class np extends Ir{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:du;super({attributions:e.attributions,interpolate:e.interpolate,projection:H(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new fr(this.imageExtent_,void 0,1,ip({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(n,r)=>(this.image.setImage(n),i(this.image,r),gr(n))})),this.image.addEventListener(ie.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return ce(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const $s="1.3.0",yc=[101,101];function gu(s,e,t,i,n){n.WIDTH=t[0],n.HEIGHT=t[1];const r=i.getAxisOrientation(),o=$o(n.VERSION,"1.3")>=0;n[o?"CRS":"SRS"]=i.getCode();const a=o&&r.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return n.BBOX=a.join(","),Xn(s,n)}function mu(s,e,t,i,n,r,o){r=Object.assign({REQUEST:"GetMap"},r);const a=e/t,l=[ml(Z(s)/a,Vt),ml(le(s)/a,Vt)];if(t!=1)switch(o){case"geoserver":const h=90*t+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+h:r.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":r.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":r.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return gu(n,s,l,i,r)}function Js(s,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:$s,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},s)}function sp(s){const e=s.hidpi===void 0?!0:s.hidpi,t=H(s.projection||"EPSG:3857"),i=s.ratio||1.5,n=s.load||gr,r=s.crossOrigin??null;return(o,a,l)=>{o=fu(o,a,l,i),l!=1&&(!e||s.serverType===void 0)&&(l=1);const c=mu(o,a,l,t,s.url,Js(s.params,"GetMap"),s.serverType),h=new Image;return h.crossOrigin=r,n(h,c).then(u=>({image:u,extent:o,pixelRatio:l}))}}function rp(s,e,t){if(s.url===void 0)return;const i=H(s.projection||"EPSG:3857"),n=Zo(e,t,0,yc),r={QUERY_LAYERS:s.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(r,Js(s.params,"GetFeatureInfo"),s.params);const o=zi((e[0]-n[0])/t,Vt),a=zi((n[3]-e[1])/t,Vt),l=$o(r.VERSION,"1.3")>=0;return r[l?"I":"X"]=o,r[l?"J":"Y"]=a,gu(s.url,n,yc,i,r)}function op(s,e){if(s.url===void 0)return;const t={SERVICE:"WMS",VERSION:$s,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e!==void 0){const i=H(s.projection||"EPSG:3857").getMetersPerUnit()||1,n=28e-5;t.SCALE=e*i/n}if(Object.assign(t,s.params),s.params!==void 0&&t.LAYER===void 0){const i=t.LAYERS;if(!(!Array.isArray(i)||i.length!==1))return;t.LAYER=i}return Xn(s.url,t)}class ap extends Ir{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:du,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,n){const r=H(i),o=this.getProjection();o&&o!==r&&(t=jn(o,r,e,t),e=Ci(e,r,o));const a={url:this.url_,params:{...this.params_,...n},projection:o||r};return rp(a,e,t)}getLegendUrl(e,t){return op({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=sp({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),gr(r))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.loader=null,this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class lp extends Tr{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||sn(t),n=e.tileGrid||wr({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:cp,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:T_,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,i){if(i.getState()===D.IDLE){i.setState(D.LOADING);const n=i.wrappedTileCoord,r=this.getTileGridForProjection(t);let o=r.getTileCoordExtent(n);const a=n[0],l=r.getResolution(a);tt(o,-l,o);const c=this.projection;t&&this.projection&&!de(t,c)&&(o=Vi(o,t,c));const h=this.tileGrid,u=h.getExtent();u&&Ae(o,u,o);let d=l;t&&c&&!de(t,c)&&(d=l/c.getMetersPerUnit()/t.getMetersPerUnit());const g=h.getZForResolution(d,this.zDirection);h.forEachTileCoord(o,g,f=>{const m=this.tileUrlFunction(f,e,t);this.sourceTiles_[m]||(this.sourceTiles_[m]=new this.tileClass(f,m?D.IDLE:D.EMPTY,m,this.format_,this.tileLoadFunction));const _=this.sourceTiles_[m];i.sourceTiles.push(_),this.tileKeysBySourceTileUrl_[m]||(this.tileKeysBySourceTileUrl_[m]=[]),this.tileKeysBySourceTileUrl_[m].push(i.getKey());const p=_.getState();if(p<D.LOADED){const y=x=>{this.handleTileChange(x);const E=_.getState();if(E===D.LOADED||E===D.ERROR){const C=_.getKey();C in i.errorTileKeys?_.getState()===D.LOADED&&delete i.errorTileKeys[C]:i.loadingSourceTiles--,E===D.ERROR?i.errorTileKeys[C]=!0:_.removeEventListener(ie.CHANGE,y),i.loadingSourceTiles===0&&i.setState(di(i.errorTileKeys)?D.LOADED:D.ERROR)}};_.addEventListener(ie.CHANGE,y),i.loadingSourceTiles++}p===D.IDLE&&(_.extent=h.getTileCoordExtent(f),_.projection=this.projection,_.resolution=h.getResolution(f[0]),_.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(f=>f.getState()===D.ERROR)?D.ERROR:D.LOADED)}return i.sourceTiles}removeSourceTiles(e){const t=e.getKey(),i=e.sourceTiles;for(let n=0,r=i.length;n<r;++n){const o=i[n].getTileUrl();if(!this.tileKeysBySourceTileUrl_[o])return;const a=this.tileKeysBySourceTileUrl_[o].indexOf(t);a!==-1&&(this.tileKeysBySourceTileUrl_[o].splice(a,1),this.tileKeysBySourceTileUrl_[o].length===0&&(delete this.tileKeysBySourceTileUrl_[o],delete this.sourceTiles_[o]))}}getTile(e,t,i,n,r){const o=[e,t,i];let a=this.getTileCoordForTileUrlFunction(o,r);const l=this.getTileGrid().getExtent(),c=this.projection,h=this.getTileGridForProjection(r);if(a&&l){const g=h.getTileCoordExtent(a);tt(g,-h.getResolution(e),g),ce(l,!r||!c||de(r,c)?g:Vi(g,r,c))||(a=null)}let u=!0;if(a!==null){const g=this.tileGrid,f=h.getResolution(e);let m=f;r&&c&&!de(r,c)&&(m=f/c.getMetersPerUnit()/r.getMetersPerUnit());const _=g.getZForResolution(m,1),p=h.getTileCoordExtent(a);tt(p,-f,p),g.forEachTileCoord(!r||!c||de(r,c)?p:Vi(p,r,c),_,y=>{u=u&&!this.tileUrlFunction(y,n,c)})}const d=new w_(o,u?D.EMPTY:D.IDLE,a,this.getSourceTiles.bind(this,n,r),this.removeSourceTiles.bind(this));return d.key=this.getKey(),d}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const n=this.projection;if(n!==null&&!de(n,e))return ns(e);const r=this.tileGrid,o=r.getResolutions().slice(),a=o.map(function(h,u){return r.getOrigin(u)}),l=o.map(function(h,u){return r.getTileSize(u)}),c=Qc+1;for(let h=o.length;h<c;++h)o.push(o[h-1]/2),a.push(a[h-1]),l.push(l[h-1]);i=new Cr({extent:r.getExtent(),origins:a,resolutions:o,tileSizes:l}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=ye(n.getTileSize(e),this.tmpSize);return[Math.round(r[0]*t),Math.round(r[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function cp(s,e){s.setLoader(function(t,i,n){Nh(e,s.getFormat(),t,i,n,s.onLoad.bind(s),s.onError.bind(s))})}class hp extends Fa{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,r=n.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Ae(l,at(t.extent,n.projection))),!a[ge.ANIMATING]&&!a[ge.INTERACTING]&&!Ei(l))if(o){const c=n.projection,h=o.getImage(l,r,i,c);h&&(this.loadImage(h)?this.image=h:h.getState()===B.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=we(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!gi(r,n))return null;const o=this.image.getExtent(),a=this.image.getImage(),l=Z(o),c=Math.floor(a.width*((n[0]-o[0])/l));if(c<0||c>=a.width)return null;const h=le(o),u=Math.floor(a.height*((o[3]-n[1])/h));return u<0||u>=a.height?null:this.getImageData(a,c,u)}renderFrame(e,t){const i=this.image,n=i.getExtent(),r=i.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=i.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],h=e.pixelRatio,u=e.viewState,d=u.center,g=u.resolution,f=h*o/(g*l),m=h*a/(g*l);this.prepareContainer(e,t);const _=this.context.canvas.width,p=this.context.canvas.height,y=this.getRenderContext(e);let x=!1,E=!0;if(c.extent){const S=at(c.extent,u.projection);E=ce(S,e.extent),x=E&&!Qe(S,e.extent),x&&this.clipUnrotated(y,e,S)}const C=i.getImage(),w=vt(this.tempTransform,_/2,p/2,f,m,0,l*(n[0]-d[0])/o,l*(d[1]-n[3])/a);this.renderedResolution=a*h/l;const R=C.width*w[0],T=C.height*w[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,e),E&&R>=.5&&T>=.5){const S=w[4],v=w[5],G=c.opacity;G!==1&&(y.save(),y.globalAlpha=G),y.drawImage(C,0,0,+C.width,+C.height,S,v,R,T),G!==1&&y.restore()}return this.postRender(this.context,e),x&&y.restore(),y.imageSmoothingEnabled=!0,this.container}}class up extends dr{constructor(e){e=e||{},super(e)}}class _u extends up{constructor(e){super(e)}createRenderer(){return new hp(this)}getData(e){return super.getData(e)}}function pu(s){return function(e){const t=e.buffers,i=e.meta,n=e.imageOps,r=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(n){const d=new Array(a);for(let f=0;f<a;++f)d[f]=new ImageData(new Uint8ClampedArray(t[f]),r,o);return s(d,i).data.buffer}const c=new Uint8ClampedArray(l),h=new Array(a),u=new Array(a);for(let d=0;d<a;++d)h[d]=new Uint8ClampedArray(t[d]),u[d]=[0,0,0,0];for(let d=0;d<l;d+=4){for(let f=0;f<a;++f){const m=h[f];u[f][0]=m[d],u[f][1]=m[d+1],u[f][2]=m[d+2],u[f][3]=m[d+3]}const g=s(u,i);c[d]=g[0],c[d+1]=g[1],c[d+2]=g[2],c[d+3]=g[3]}return c.buffer}}function dp(s,e){const i=Object.keys(s.lib||{}).map(function(r){return"const "+r+" = "+s.lib[r].toString()+";"}).concat(["const __minion__ = ("+pu.toString()+")(",s.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return n.addEventListener("message",e),n}function fp(s,e){const t=pu(s.operation);let i=!1;return{postMessage:function(n){setTimeout(function(){i||e({data:{buffer:t(n),meta:n.meta}})},0)},terminate:function(){i=!0}}}class gp extends jo{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const i=new Array(t);if(t)for(let n=0;n<t;++n)i[n]=dp(e,this.onWorkerMessage_.bind(this,n));else i[0]=fp(e,this.onWorkerMessage_.bind(this,0));this.workers_=i,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,i){this.enqueue_({inputs:e,meta:t,callback:i}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,i=e.inputs[0].height,n=e.inputs.map(function(l){return l.data.buffer}),r=this.workers_.length;if(this.running_=r,r===1){this.workers_[0].postMessage({buffers:n,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},n);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/r);for(let l=0;l<r;++l){const c=l*a,h=[];for(let u=0,d=n.length;u<d;++u)h.push(n[u].slice(c,c+a));this.workers_[l].postMessage({buffers:h,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},h)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let i,n;if(t===1)i=new Uint8ClampedArray(this.dataLookup_[0].buffer),n=this.dataLookup_[0].meta;else{const r=e.inputs[0].data.length;i=new Uint8ClampedArray(r),n=new Array(t);const o=4*Math.ceil(r/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,c=a*o;i.set(new Uint8ClampedArray(l),c),n[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(i,e.inputs[0].width,e.inputs[0].height),n),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const xc={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Ec extends bt{constructor(e,t,i){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=i}}class mp extends Ir{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=yp(e.sources);const t=this.changed.bind(this);for(let i=0,n=this.layers_.length;i<n;++i)this.layers_[i].addEventListener(ie.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new ad(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:je(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:pp(this.layers_),pixelRatio:1,pixelToCoordinateTransform:je(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Y(this),renderTargets:{}},this.setAttributions(function(i){var r;const n=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],c=l instanceof ss?l:l.getSource();if(!c)continue;const h=(r=c.getAttributions())==null?void 0:r(i);typeof h=="string"?n.push(h):h!==void 0&&n.push(...h)}return n}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new gp({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,i){const n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);const r=Me(e);n.size[0]=Math.ceil(Z(e)/t),n.size[1]=Math.ceil(le(e)/t),n.extent=[r[0]-n.size[0]*t/2,r[1]-n.size[1]*t/2,r[0]+n.size[0]*t/2,r[1]+n.size[1]*t/2],n.time=Date.now();const o=n.viewState;return o.center=r,o.projection=i,o.resolution=t,n}allSourcesReady_(){let e=!0,t;for(let i=0,n=this.layers_.length;i<n;++i)if(t=this.layers_[i].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,i,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const r=this.updateFrameState_(e,t,n);if(this.requestedFrameState_=r,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!mi(r.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),r.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,i=new Array(t);for(let r=0;r<t;++r){e.layerIndex=r,e.renderTargets={};const o=_p(this.layers_[r],e);if(o)i[r]=o;else return}const n={};this.dispatchEvent(new Ec(xc.BEFOREOPERATIONS,e,n)),this.processor_.process(i,n,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,i,n){if(t||!i)return;const r=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!mi(r,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(Z(r)/o),c=Math.round(le(r)/o);a=ae(l,c),this.renderedImageCanvas_=new E_(r,o,1,a.canvas)}a.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Ec(xc.AFTEROPERATIONS,e,n))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let i=0,n=this.layers_.length;i<n&&(t=this.layers_[i].getSource().getResolutions(e),!t);++i);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}mp.prototype.dispose;let ni=null;function _p(s,e){const t=s.getRenderer();if(!t)throw new Error("Unsupported layer type: "+s);if(!t.prepareFrame(e))return null;const i=e.size[0],n=e.size[1];if(i===0||n===0)return null;const r=t.renderFrame(e,null);let o;if(r instanceof HTMLCanvasElement)o=r;else{if(r&&(o=r.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===i&&o.height===n)return o.getContext("2d").getImageData(0,0,i,n)}if(!ni)ni=ae(i,n,void 0,{willReadFrequently:!0});else{const a=ni.canvas;a.width!==i||a.height!==n?ni=ae(i,n,void 0,{willReadFrequently:!0}):ni.clearRect(0,0,i,n)}return ni.drawImage(o,0,0,i,n),ni.getImageData(0,0,i,n)}function pp(s){return s.map(function(e){return e.getLayerState()})}function yp(s){const e=s.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=xp(s[i]);return t}function xp(s){let e;return s instanceof ss?s instanceof Aa?e=new zh({source:s}):s instanceof Ir&&(e=new _u({source:s})):e=s,e}class nx extends rs{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:H("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Mm(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=H("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const c=Jn(t,i);n=Pc(e.bounds,c)}const r=sn(i),o=e.minzoom||0,a=e.maxzoom||22,l=wr({extent:r,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=ba(e.tiles,l),e.attribution&&!this.getAttributions()){const c=n!==void 0?n:r;this.setAttributions(function(h){return ce(c,h.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class Ep extends rs{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Fe(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,n){const r=H(i),o=this.getProjection()||r;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=Ci(e,r,o),c=jn(o,r,e,t),h=a.getZForResolution(c,this.zDirection),u=a.getResolution(h),d=a.getTileCoordForCoordAndZ(l,h);if(a.getResolutions().length<=d[0])return;let g=a.getTileCoordExtent(d,this.tmpExtent_);const f=this.gutter_;f!==0&&(g=tt(g,u*f,g));const m={QUERY_LAYERS:this.params_.LAYERS};Object.assign(m,Js(this.params_,"GetFeatureInfo"),n);const _=Math.floor((l[0]-g[0])/u),p=Math.floor((g[3]-l[1])/u);return m[this.v13_?"I":"X"]=_,m[this.v13_?"J":"Y"]=p,this.getRequestUrl_(d,g,1,o||r,m)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:$s,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;i.LAYER=n}if(e!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*n/r}return Object.assign(i,t),Xn(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,n,r){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=Wt(Ch(e),o.length);a=o[l]}return mu(t,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(e[0]),i,n,a,r,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||$s;this.v13_=$o(e,"1.3")>=0}tileUrlFunction(e,t,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const r=n.getResolution(e[0]);let o=n.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=tt(o,r*a,o));const l=Object.assign({},Js(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,i,l)}}class sx extends rs{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let n=e.urls;n===void 0&&e.url!==void 0&&(n=Sh(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:n,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=Ao(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(Ao(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?Xn(e,i):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const n=this.tileGrid,r=this.dimensions_;return function(o,a,l){if(!o)return;const c={TileMatrix:n.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(c,r);let h=e;return t=="KVP"?h=Xn(h,c):h=h.replace(/\{(\w+?)\}/g,function(u,d){return encodeURIComponent(c[d])}),h}}}function rx(s,e){var P;const t=s.Contents.Layer,i=t==null?void 0:t.find(function(F){return F.Identifier==e.layer});if(!i)return null;const n=s.Contents.TileMatrixSet;let r;i.TileMatrixSetLink.length>1?"projection"in e?r=i.TileMatrixSetLink.findIndex(function(F){const U=n.find(function(N){return N.Identifier==F.TileMatrixSet}).SupportedCRS,O=H(U),k=H(e.projection);return O&&k?de(O,k):U==e.projection}):r=i.TileMatrixSetLink.findIndex(function(F){return F.TileMatrixSet==e.matrixSet}):r=0,r<0&&(r=0);const o=i.TileMatrixSetLink[r].TileMatrixSet,a=i.TileMatrixSetLink[r].TileMatrixSetLimits;let l=i.Format[0];"format"in e&&(l=e.format),r=i.Style.findIndex(function(F){return"style"in e?F.Title==e.style:F.isDefault}),r<0&&(r=0);const c=i.Style[r].Identifier,h={};"Dimension"in i&&i.Dimension.forEach(function(F,L,U){const O=F.Identifier;let k=F.Default;k===void 0&&(k=F.Value[0]),h[O]=k});const d=s.Contents.TileMatrixSet.find(function(F){return F.Identifier==o});let g;const f=d.SupportedCRS;if(f&&(g=H(f)),"projection"in e){const F=H(e.projection);F&&(!g||de(F,g))&&(g=F)}let m=!1;const _=g.getAxisOrientation().startsWith("ne");let p=d.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:p.MatrixWidth-1,MaxTileRow:p.MatrixHeight-1};if(a){y=a[a.length-1];const F=d.TileMatrix.find(L=>L.Identifier===y.TileMatrix||d.Identifier+":"+L.Identifier===y.TileMatrix);F&&(p=F)}const x=(P=i.BoundingBox)==null?void 0:P.find(F=>H(F.crs)&&de(H(F.crs),g)),E=p.ScaleDenominator*28e-5/g.getMetersPerUnit(),C=_?[p.TopLeftCorner[1],p.TopLeftCorner[0]]:p.TopLeftCorner,w=p.TileWidth*E,R=p.TileHeight*E;let T=(x==null?void 0:x.extent)??d.BoundingBox;T&&_&&(T=[T[1],T[0],T[3],T[2]]);let S=[C[0]+w*y.MinTileCol,C[1]-R*(1+y.MaxTileRow),C[0]+w*(1+y.MaxTileCol),C[1]-R*y.MinTileRow];if(T!==void 0&&!Qe(T,S)){const F=i.WGS84BoundingBox,L=H("EPSG:4326").getExtent();if(S=T,F)m=F[0]===L[0]&&F[2]===L[2];else{const U=Vi(T,d.SupportedCRS,"EPSG:4326");m=U[0]-1e-10<=L[0]&&U[2]+1e-10>=L[2]}}const v=ym(d,S,a),G=[];let A=e.requestEncoding;if(A=A!==void 0?A:"","OperationsMetadata"in s&&"GetTile"in s.OperationsMetadata){const F=s.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let L=0,U=F.length;L<U;++L)if(F[L].Constraint){const k=F[L].Constraint.find(function(N){return N.name=="GetEncoding"}).AllowedValues.Value;if(A===""&&(A=k[0]),A==="KVP")k.includes("KVP")&&G.push(F[L].href);else break}else F[L].href&&(A="KVP",G.push(F[L].href))}return G.length===0&&(A="REST",i.ResourceURL.forEach(function(F){F.resourceType==="tile"&&(l=F.format,G.push(F.template))})),{urls:G,layer:e.layer,matrixSet:o,format:l,projection:g,requestEncoding:A,tileGrid:v,style:c,dimensions:h,wrapX:m,crossOrigin:e.crossOrigin}}class Cp{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Rr,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?H(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=H(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return $()}readFeature(e,t){return $()}readFeatures(e,t){return $()}readGeometry(e,t){return $()}readProjection(e){return $()}writeFeature(e,t){return $()}writeFeatures(e,t){return $()}writeGeometry(e,t){return $()}}function qa(s,e,t){const i=t?H(t.featureProjection):null,n=t?H(t.dataProjection):null;let r=s;if(i&&n&&!de(i,n)){e&&(r=s.clone());const o=e?i:n,a=e?n:i;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(gt(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let c=0,h=l.length;c<h;++c)l[c]=Math.round(l[c]*o)/o;return l};r===s&&(r=s.clone()),r.applyTransform(a)}return r}const wp={Point:mt,LineString:yi,Polygon:At,MultiPoint:as,MultiLineString:Vn,MultiPolygon:Yn};function Tp(s,e,t){return Array.isArray(e[0])?($c(s,0,e,t)||(s=s.slice(),Eo(s,0,e,t)),s):(ga(s,0,e,t)||(s=s.slice(),ks(s,0,e,t)),s)}function Rp(s,e){var r;const t=s.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Rp({...s,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const n=t.layout.length;return qa(new Pe(i,i==="Polygon"?Tp(t.flatCoordinates,t.ends,n):t.flatCoordinates,(r=t.ends)==null?void 0:r.flat(),n,s.properties||{},s.id).enableSimplifyTransformed(),!1,e)}function Sp(s,e){if(!s)return null;if(Array.isArray(s)){const i=s.map(n=>Sp(n,e));return new Zs(i)}const t=wp[s.type];return qa(new t(s.flatCoordinates,s.layout||"XY",s.ends),!1,e)}const Ip={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Cc={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class vp extends Bh{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=je(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,i,n,r,o,a,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,i,n,r,o,a,l)}getTile(e,t,i,n){const r=this.getOrCreateTile(e,t,i,n);if(!r)return null;const o=n.viewState,a=o.resolution,l=n.viewHints,c=this.getLayer().getSource(),h=c.getTileGridForProjection(o.projection),u=!(l[ge.ANIMATING]||l[ge.INTERACTING]),d=h.getZForResolution(a,c.zDirection)===e;return u&&d?r.wantedResolution=a:r.wantedResolution||(r.wantedResolution=h.getResolution(e)),r}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const n=this.getLayer(),r=n.getRevision(),o=n.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(n);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==r&&l.renderedPixelRatio===t&&l.renderedRenderOrder==o)return;const c=n.getSource(),h=!!n.getDeclutter(),u=c.getTileGrid(),g=c.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),f=c.getSourceTiles(t,i,e),m=Y(n);delete e.hitDetectionImageData[m],e.executorGroups[m]=[],l.dirty=!1;for(let _=0,p=f.length;_<p;++_){const y=f[_];if(y.getState()!=D.LOADED)continue;const x=c.getProjection(),E=y.tileCoord;let C=u.getTileCoordExtent(E);i&&x&&!de(i,x)&&(C=Vi(C,x,i,32));const w=Ae(g,C),R=tt(w,n.getRenderBuffer()*a,this.tempExtent),T=mi(C,w)?null:R,S=new Ah(0,w,a,t),v=bo(a,t),G=function(U,O){let k;const N=U.getStyleFunction()||n.getStyleFunction();if(N&&(k=N(U,a)),k){const z=this.renderFeature(U,v,k,S,h,O);l.dirty=l.dirty||z}},A=y.getFeatures();o&&o!==l.renderedRenderOrder&&A.sort(o);for(let U=0,O=A.length;U<O;++U){let k=A[U];i&&y.projection&&!de(i,y.projection)&&(k=k.clone(),k.getGeometry().applyTransform(gt(y.projection,i))),(!T||ce(T,k.getGeometry().getExtent()))&&G.call(this,k,U)}const P=S.finish(),F=n.getRenderMode()!=="vector"&&h&&f.length===1?null:w,L=new Ph(F,a,t,c.getOverlaps(),P,n.getRenderBuffer(),!0);e.executorGroups[m].push(L)}l.renderedRevision=r,l.renderedPixelRatio=t,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,n,r){var x,E;const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(t.viewState.projection),u=Fs([e]);tt(u,o*i,u);const d={},g=function(C,w,R){let T=C.getId();T===void 0&&(T=Y(C));const S=d[T];if(S){if(S!==!0&&R<S.distanceSq){if(R===0)return d[T]=!0,r.splice(r.lastIndexOf(S),1),n(C,l,w);S.geometry=w,S.distanceSq=R}}else{if(R===0)return d[T]=!0,n(C,l,w);r.push(d[T]={feature:C,layer:l,geometry:w,distanceSq:R,callback:n})}},f=this.renderedTiles,m=Y(l),_=l.getDeclutter(),p=_?(E=(x=t.declutter)==null?void 0:x[_])==null?void 0:E.all().map(C=>C.value):null;let y;e:for(let C=0,w=f.length;C<w;++C){const R=f[C],T=h.getTileCoordExtent(R.wrappedTileCoord);if(!ce(T,u))continue;const S=R.executorGroups[m];for(let v=0,G=S.length;v<G;++v)if(y=S[v].forEachFeatureAtCoordinate(e,o,a,i,g,p),y)break e}return y}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,i)=>{const n=this.getLayer(),r=n.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,c=r.getTileGridForProjection(o),h=we(this.renderedPixelToCoordinateTransform_,e.slice()),u=c.getTileCoordForCoordAndResolution(h,l).toString(),d=this.renderedTiles.find(x=>x.tileCoord.toString()===u&&x.getState()===D.LOADED);if(!d||d.loadingSourceTiles>0){t([]);return}r.getWrapX()&&o.canWrapX()&&!Qe(a,c.getTileCoordExtent(d.tileCoord))&&Oc(h,o);const g=Y(n),f=c.getTileCoordExtent(d.wrappedTileCoord),m=ft(f),_=[(h[0]-m[0])/l,(m[1]-h[1])/l],p=d.getSourceTiles().reduce((x,E)=>x.concat(E.getFeatures()),[]);let y=d.hitDetectionImageData[g];if(!y){const x=ye(c.getTileSize(c.getZForResolution(l,r.zDirection))),E=this.renderedRotation_,C=[this.getRenderTransform(c.getTileCoordCenter(d.wrappedTileCoord),l,0,ze,x[0]*ze,x[1]*ze,0)];y=Mh(x,C,p,n.getStyleFunction(),c.getTileCoordExtent(d.wrappedTileCoord),d.getReplayState(n).renderedResolution,E),d.hitDetectionImageData[g]=y}t(Oh(_,p,y))})}getFeaturesInExtent(e){const t=[],i=this.getTileCache();if(i.getCount()===0)return t;const r=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=r.getZForResolution(this.renderedResolution),a={};return i.forEach(l=>{if(l.tileCoord[0]!==o||l.getState()!==D.LOADED)return;const c=l.getSourceTiles();for(let h=0,u=c.length;h<u;++h){const d=c[h],g=d.getKey();if(g in a)continue;a[g]=!0;const f=d.tileCoord;if(ce(e,r.getTileCoordExtent(f))){const m=d.getFeatures();if(m)for(let _=0,p=m.length;_<p;++_){const y=m[_],x=y.getGeometry();ce(e,x.getExtent())&&t.push(y)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){var d;const i=this.context,n=i.globalAlpha;i.globalAlpha=t.opacity;const r=e.viewHints,o=!(r[ge.ANIMATING]||r[ge.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?(d=e.declutter)==null?void 0:d[l]:void 0,h=Y(this.getLayer()),u=this.renderedTiles;for(let g=0,f=u.length;g<f;++g){const m=u[g],_=m.executorGroups[h];if(_)for(let p=_.length-1;p>=0;--p)_[p].execute(this.context,a,this.getTileRenderTransform(m,e),e.viewState.rotation,o,Ws,c)}i.globalAlpha=n}renderDeferredInternal(e){const t=this.renderedTiles,i=Y(this.getLayer()),n=t.reduce((l,c,h)=>(c.executorGroups[i].forEach(u=>l.push({executorGroup:u,index:h})),l),[]),r=n.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),o={};for(let l=0,c=n.length;l<c;++l){const h=n[l].executorGroup.getDeferredZIndexContexts();for(const u in h)o[u]=!0}Object.keys(o).map(Number).sort(ht).forEach(l=>{r.forEach((c,h)=>{c[l]&&(c[l].forEach(u=>{const{executorGroup:d,index:g}=n[h],f=d.getRenderedContext(),m=f.globalAlpha;f.globalAlpha=this.renderedOpacity_;const _=this.tileClipContexts_[g];_&&_.draw(f),u.draw(f),_&&f.restore(),f.globalAlpha=m,u.clear()}),c[l].length=0)})})}getTileRenderTransform(e,t){const i=t.pixelRatio,n=t.viewState,r=n.center,o=n.resolution,a=n.rotation,l=t.size,c=Math.round(l[0]*i),h=Math.round(l[1]*i),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),g=e.tileCoord,f=d.getTileCoordExtent(e.wrappedTileCoord),m=d.getTileCoordExtent(g,this.tempExtent)[0]-f[0];return ar(Ss(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(r,o,a,i,c,h,m))}postRender(e,t){var C;const i=t.viewHints,n=!(i[ge.ANIMATING]||i[ge.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const r=this.getLayer(),o=r.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=r.getDeclutter(),c=l?Cc[o].filter(w=>!Ws.includes(w)):Cc[o],h=t.viewState,u=h.rotation,d=r.getSource(),f=d.getTileGridForProjection(h.projection).getZForResolution(h.resolution,d.zDirection),m=this.renderedTiles,_=[],p=[],y=[],x=Y(r);let E=!0;for(let w=m.length-1;w>=0;--w){const R=m[w];E=E&&!R.getReplayState(r).dirty;const T=R.executorGroups[x].filter(L=>L.hasExecutors(c));if(T.length===0)continue;const S=this.getTileRenderTransform(R,t),v=R.tileCoord[0];let G=!1;const A=T[0].getClipCoords(S);let P=e,F;if(A){F=new Pa,P=F.getContext();for(let L=0,U=_.length;L<U;++L)if(f!==v&&v<p[L]){const O=_[L];ce([A[0],A[3],A[4],A[7]],[O[0],O[3],O[4],O[7]])&&(G||(P.save(),G=!0),P.beginPath(),P.moveTo(A[0],A[1]),P.lineTo(A[2],A[3]),P.lineTo(A[4],A[5]),P.lineTo(A[6],A[7]),P.moveTo(O[6],O[7]),P.lineTo(O[4],O[5]),P.lineTo(O[2],O[3]),P.lineTo(O[0],O[1]),P.clip())}_.push(A),p.push(v)}for(let L=0,U=T.length;L<U;++L)T[L].execute(e,[e.canvas.width,e.canvas.height],S,u,n,c,(C=t.declutter)==null?void 0:C[l]);G&&(P===e?P.restore():y[w]=F)}e.globalAlpha=a,this.ready=E,this.tileClipContexts_=y,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,i,n,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,c=i.length;l<c;++l)a=Ks(n,e,i[l],t,this.boundHandleStyleImageChange_,void 0,r,o)||a;else a=Ks(n,e,i,t,this.boundHandleStyleImageChange_,void 0,r,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),n=t.getRevision(),r=e.wantedResolution;return i.renderedTileResolution!==r||i.renderedTileRevision!==n}renderTileImage_(e,t){const i=this.getLayer(),n=e.getReplayState(i),r=i.getRevision(),o=e.executorGroups[Y(i)];n.renderedTileRevision=r;const a=e.wrappedTileCoord,l=a[0],c=i.getSource();let h=t.pixelRatio;const d=t.viewState.projection,g=c.getTileGridForProjection(d),f=g.getResolution(e.tileCoord[0]),m=t.pixelRatio/e.wantedResolution*f,_=g.getResolution(l),p=e.getContext();h=Math.round(Math.max(h,m/h));const y=c.getTilePixelSize(l,h,d);p.canvas.width=y[0],p.canvas.height=y[1];const x=h/m;if(x!==1){const R=Al(this.tmpTransform_);Ss(R,x,x),p.setTransform.apply(p,R)}const E=g.getTileCoordExtent(a,this.tempExtent),C=m/_,w=Al(this.tmpTransform_);Ss(w,C,-C),rf(w,-E[0],-E[3]);for(let R=0,T=o.length;R<T;++R)o[R].execute(p,[p.canvas.width*x,p.canvas.height*x],w,0,!0,Ip[i.getRenderMode()],null);n.renderedTileResolution=e.wantedResolution}}class $a extends Ra{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const i=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i;const n=e.renderMode||"hybrid";se(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new vp(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(jt.PRELOAD)}getUseInterimTilesOnError(){return this.get(jt.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(jt.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(jt.USE_INTERIM_TILES_ON_ERROR,e)}}const Go=65536*65536,wc=1/Go,Ap=12,Tc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),co=0,Es=1,_n=2,Cs=5;class bp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,i=this.length){for(;this.pos<i;){const n=this.readVarint(),r=n>>3,o=this.pos;this.type=n&7,e(r,t,this),this.pos===o&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Go;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Go;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let i,n;return n=t[this.pos++],i=n&127,n<128||(n=t[this.pos++],i|=(n&127)<<7,n<128)||(n=t[this.pos++],i|=(n&127)<<14,n<128)||(n=t[this.pos++],i|=(n&127)<<21,n<128)?i:(n=t[this.pos],i|=(n&15)<<28,Lp(i,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Ap&&Tc?Tc.decode(this.buf.subarray(t,e)):Xp(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===_n?this.readVarint()+this.pos:this.pos+1}skip(e){const t=e&7;if(t===co)for(;this.buf[this.pos++]>127;);else if(t===_n)this.pos=this.readVarint()+this.pos;else if(t===Cs)this.pos+=4;else if(t===Es)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*wc),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*wc),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Pp(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;const t=this.pos;this.pos=Vp(this.buf,e,this.pos);const i=this.pos-t;i>=128&&Rc(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let i=0;i<t;i++)this.buf[this.pos++]=e[i]}writeRawMessage(e,t){this.pos++;const i=this.pos;e(t,this);const n=this.pos-i;n>=128&&Rc(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,i){this.writeTag(e,_n),this.writeRawMessage(t,i)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Op,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Dp,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Np,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Gp,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,kp,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Up,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Bp,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,zp,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,jp,t)}writeBytesField(e,t){this.writeTag(e,_n),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,Cs),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,Cs),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,Es),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,Es),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,co),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,co),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,_n),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,Cs),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,Es),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function Lp(s,e,t){const i=t.buf;let n,r;if(r=i[t.pos++],n=(r&112)>>4,r<128||(r=i[t.pos++],n|=(r&127)<<3,r<128)||(r=i[t.pos++],n|=(r&127)<<10,r<128)||(r=i[t.pos++],n|=(r&127)<<17,r<128)||(r=i[t.pos++],n|=(r&127)<<24,r<128)||(r=i[t.pos++],n|=(r&1)<<31,r<128))return ki(s,n,e);throw new Error("Expected varint not more than 10 bytes")}function ki(s,e,t){return t?e*4294967296+(s>>>0):(e>>>0)*4294967296+(s>>>0)}function Pp(s,e){let t,i;if(s>=0?(t=s%4294967296|0,i=s/4294967296|0):(t=~(-s%4294967296),i=~(-s/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Fp(t,i,e),Mp(i,e)}function Fp(s,e,t){t.buf[t.pos++]=s&127|128,s>>>=7,t.buf[t.pos++]=s&127|128,s>>>=7,t.buf[t.pos++]=s&127|128,s>>>=7,t.buf[t.pos++]=s&127|128,s>>>=7,t.buf[t.pos]=s&127}function Mp(s,e){const t=(s&7)<<4;e.buf[e.pos++]|=t|((s>>>=3)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127)))))}function Rc(s,e,t){const i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(let n=t.pos-1;n>=s;n--)t.buf[n+i]=t.buf[n]}function Op(s,e){for(let t=0;t<s.length;t++)e.writeVarint(s[t])}function Dp(s,e){for(let t=0;t<s.length;t++)e.writeSVarint(s[t])}function Gp(s,e){for(let t=0;t<s.length;t++)e.writeFloat(s[t])}function kp(s,e){for(let t=0;t<s.length;t++)e.writeDouble(s[t])}function Np(s,e){for(let t=0;t<s.length;t++)e.writeBoolean(s[t])}function Up(s,e){for(let t=0;t<s.length;t++)e.writeFixed32(s[t])}function Bp(s,e){for(let t=0;t<s.length;t++)e.writeSFixed32(s[t])}function zp(s,e){for(let t=0;t<s.length;t++)e.writeFixed64(s[t])}function jp(s,e){for(let t=0;t<s.length;t++)e.writeSFixed64(s[t])}function Xp(s,e,t){let i="",n=e;for(;n<t;){const r=s[n];let o=null,a=r>239?4:r>223?3:r>191?2:1;if(n+a>t)break;let l,c,h;a===1?r<128&&(o=r):a===2?(l=s[n+1],(l&192)===128&&(o=(r&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=s[n+1],c=s[n+2],(l&192)===128&&(c&192)===128&&(o=(r&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=s[n+1],c=s[n+2],h=s[n+3],(l&192)===128&&(c&192)===128&&(h&192)===128&&(o=(r&15)<<18|(l&63)<<12|(c&63)<<6|h&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),n+=a}return i}function Vp(s,e,t){for(let i=0,n,r;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(r)if(n<56320){s[t++]=239,s[t++]=191,s[t++]=189,r=n;continue}else n=r-55296<<10|n-56320|65536,r=null;else{n>56319||i+1===e.length?(s[t++]=239,s[t++]=191,s[t++]=189):r=n;continue}else r&&(s[t++]=239,s[t++]=191,s[t++]=189,r=null);n<128?s[t++]=n:(n<2048?s[t++]=n>>6|192:(n<65536?s[t++]=n>>12|224:(s[t++]=n>>18|240,s[t++]=n>>12&63|128),s[t++]=n>>6&63|128),s[t++]=n&63|128)}return t}class Yp extends Cp{constructor(e){super(),e=e||{},this.dataProjection=new sr({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:Pe,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,n){e.pos=t.geometry;const r=e.readVarint()+e.pos;let o=1,a=0,l=0,c=0,h=0,u=0;for(;e.pos<r;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),c+=e.readSVarint(),o===1&&h>u&&(n.push(h),u=h),i.push(l,c),h+=2;else if(o===7)h>u&&(i.push(i[u],i[u+1]),h+=2);else throw new Error("Invalid command found in the PBF")}h>u&&(n.push(h),u=h)}createFeature_(e,t,i){const n=t.type;if(n===0)return null;let r;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],c=[];this.readRawGeometry_(e,t,l,c);const h=qp(n,c.length);if(this.featureClass===Pe)r=new this.featureClass(h,l,c,2,o,a),r.transform(i.dataProjection);else{let u;if(h=="Polygon"){const f=Jc(l,c);u=f.length>1?new Yn(l,"XY",f):new At(l,"XY",c)}else u=h==="Point"?new mt(l,"XY"):h==="LineString"?new yi(l,"XY"):h==="MultiPoint"?new as(l,"XY"):h==="MultiLineString"?new Vn(l,"XY",c):null;const d=this.featureClass;r=new d,this.geometryName_&&r.setGeometryName(this.geometryName_);const g=qa(u,!1,i);r.setGeometry(g),a!==void 0&&r.setId(a),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const n=H(t.dataProjection);n.setWorldExtent(t.extent),t.dataProjection=n;const r=new bp(e),o=r.readFields(Wp,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const c=o[l],h=c?[0,0,c.extent,c.extent]:null;n.setExtent(h);for(let u=0,d=c.length;u<d;++u){const g=Zp(r,c,u),f=this.createFeature_(r,g,t);f!==null&&a.push(f)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function Wp(s,e,t){if(s===3){const i={keys:[],values:[],features:[]},n=t.readVarint()+t.pos;t.readFields(Kp,i,n),i.length=i.features.length,i.length&&(e[i.name]=i)}}function Kp(s,e,t){if(s===15)e.version=t.readVarint();else if(s===1)e.name=t.readString();else if(s===5)e.extent=t.readVarint();else if(s===2)e.features.push(t.pos);else if(s===3)e.keys.push(t.readString());else if(s===4){let i=null;const n=t.readVarint()+t.pos;for(;t.pos<n;)s=t.readVarint()>>3,i=s===1?t.readString():s===2?t.readFloat():s===3?t.readDouble():s===4?t.readVarint64():s===5?t.readVarint():s===6?t.readSVarint():s===7?t.readBoolean():null;e.values.push(i)}}function Hp(s,e,t){if(s==1)e.id=t.readVarint();else if(s==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const n=e.layer.keys[t.readVarint()],r=e.layer.values[t.readVarint()];e.properties[n]=r}}else s==3?e.type=t.readVarint():s==4&&(e.geometry=t.pos)}function Zp(s,e,t){s.pos=e.features[t];const i=s.readVarint()+s.pos,n={layer:e,type:0,properties:{}};return s.readFields(Hp,n,i),n}function qp(s,e){let t;return s===1?t=e===1?"Point":"MultiPoint":s===2?t=e===1?"LineString":"MultiLineString":s===3&&(t="Polygon"),t}let ws,yu;function ko(){if(ws===void 0){const s=document.createElement("canvas");s.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; image-rendering: pixelated;");const e=s.style.imageRendering;ws=!!e,ws&&(yu=e)}return ws}function $p(){return ko(),yu||""}function Is(s){return s.get("olcs_projection")||s.getProjection()}let Jp=0;function pe(s){return s.olcs_uid||(s.olcs_uid=++Jp)}function ho(s){const e=s,t=e.readyPromise;return t||(e.ready!==void 0?e.ready?Promise.resolve(s):new Promise((i,n)=>{const r=setInterval(()=>{e.ready&&(clearInterval(r),i(s))},20)}):Promise.reject("Not a readyable object"))}function xu(){const s=document.createElement("canvas");return s.width=1,s.height=1,s}class Eu{constructor(e,t,i){I(this,"source_");I(this,"projection_");I(this,"fallbackProj_");I(this,"map_");I(this,"shouldRequestNextLevel");I(this,"emptyCanvas_",xu());I(this,"emptyCanvasPromise_",Promise.resolve(this.emptyCanvas_));I(this,"tilingScheme_");I(this,"ready_");I(this,"rectangle_");I(this,"errorEvent",new Cesium.Event);I(this,"credit");I(this,"proxy");this.source_=t,this.projection_=null,this.ready_=!1,this.fallbackProj_=i||null,this.tilingScheme_=new Cesium.WebMercatorTilingScheme,this.rectangle_=null,this.map_=e,this.shouldRequestNextLevel=!1;const n=this.source_.get("olcs_proxy");n&&(typeof n=="function"?this.proxy={getURL:n}:typeof n=="string"&&(this.proxy=new Cesium.DefaultProxy(n))),this.source_.on("change",r=>{this.handleSourceChanged_()}),this.handleSourceChanged_()}get ready(){return this.ready_}get rectangle(){return this.rectangle_}get tilingScheme(){return this.tilingScheme_}get _ready(){return this.ready_}get tileWidth(){const e=this.source_.getTileGrid();if(e){const t=e.getTileSize(0);return Array.isArray(t)?t[0]:t}return 256}get tileHeight(){const e=this.source_.getTileGrid();if(e){const t=e.getTileSize(0);return Array.isArray(t)?t[1]:t}return 256}get maximumLevel(){const e=this.source_.getTileGrid();return e?e.getMaxZoom():18}get minimumLevel(){return 0}get tileDiscardPolicy(){}get hasAlphaChannel(){return!0}pickFeatures(e,t,i,n,r){}handleSourceChanged_(){if(!this.ready_&&this.source_.getState()=="ready"){this.projection_=Is(this.source_)||this.fallbackProj_;const e={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(this.source_.getTileGrid()!==null&&this.source_.getTileGrid().forEachTileCoord(this.projection_.getExtent(),0,([t,i,n])=>{e.numberOfLevelZeroTilesX=i+1,e.numberOfLevelZeroTilesY=n+1}),this.projection_.getCode()==="EPSG:4326")this.shouldRequestNextLevel=e.numberOfLevelZeroTilesX===1&&e.numberOfLevelZeroTilesY===1,this.tilingScheme_=new Cesium.GeographicTilingScheme(e);else if(this.projection_.getCode()==="EPSG:3857")this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(e);else return;this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}}getTileCredits(e,t,i){const n=this.source_.getAttributions();if(!n)return[];const r=this.map_.getView().calculateExtent(this.map_.getSize()),o=this.map_.getView().getCenter(),a=this.shouldRequestNextLevel?i+1:i;return nl(n,a,o,r)}requestImage(e,t,i,n){const r=this.source_.getTileUrlFunction();if(r&&this.projection_){const o=this.shouldRequestNextLevel?i+1:i;let a=r.call(this.source_,[o,e,t],1,this.projection_);return this.proxy&&(a=this.proxy.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvasPromise_}else return this.emptyCanvasPromise_}}const Qp=new Yp({featureClass:Pe}),ey=[new He({stroke:new Ht({color:"blue",width:2})})];class ty{constructor(e){I(this,"urls");I(this,"emptyCanvas_",xu());I(this,"emptyCanvasPromise_",Promise.resolve(this.emptyCanvas_));I(this,"tilingScheme_",new Cesium.WebMercatorTilingScheme);I(this,"ready_",!0);I(this,"rectangle_");I(this,"tileRectangle_");I(this,"tileWidth",256);I(this,"tileHeight",256);I(this,"maximumLevel",20);I(this,"minimumLevel_",0);I(this,"featureCache");I(this,"tileCache");I(this,"tileFunction_");I(this,"styleFunction_");I(this,"projection_",H("EPSG:3857"));I(this,"errorEvent",new Cesium.Event);I(this,"credit");I(this,"proxy");this.urls=e.urls,this.rectangle_=e.rectangle||this.tilingScheme.rectangle,this.credit=e.credit,this.styleFunction_=e.styleFunction||(()=>ey),this.tileRectangle_=new Cesium.Rectangle;const t=e.cacheSize!==void 0?e.cacheSize:50;this.tileCache=new Xs(t),this.featureCache=e.featureCache||new Xs(t),this.minimumLevel_=e.minimumLevel||0;const i=ns(this.projection_);this.tileFunction_=ba(this.urls,i)}get minimumLevel(){return this.minimumLevel_}get ready(){return this.ready_}get rectangle(){return this.rectangle_}get tilingScheme(){return this.tilingScheme_}getTileCredits(e,t,i){return[]}get _ready(){return this.ready_}get tileDiscardPolicy(){}get hasAlphaChannel(){return!0}pickFeatures(e,t,i,n,r){}getTileFeatures(e,t,i){const n=this.getCacheKey_(e,t,i);let r;if(this.featureCache.containsKey(n)&&(r=this.featureCache.get(n)),!r){const o=this.getUrl_(e,t,i);if(r=fetch(o).then(a=>a.ok?a:Promise.reject(a)).then(a=>a.arrayBuffer()).then(a=>this.readFeaturesFromBuffer(a)),this.featureCache.set(n,r),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return r}readFeaturesFromBuffer(e){const t=Qp.readFeatures(e),i=this.tileWidth/4096;return t.forEach(n=>{const r=n.getFlatCoordinates();for(let o=0;o<r.length;++o)r[o]*=i}),t}getUrl_(e,t,i){return this.tileFunction_([e,t,i],1,this.projection_)}getCacheKey_(e,t,i){return`${e}_${t}_${i}`}requestImage(e,t,i,n){if(i<this.minimumLevel_)return this.emptyCanvasPromise_;try{const r=this.getCacheKey_(i,e,t);let o;if(this.tileCache.containsKey(r)&&(o=this.tileCache.get(r)),!o&&(o=this.getTileFeatures(i,e,t).then(a=>{this.tilingScheme.tileXYToNativeRectangle(e,t,i,this.tileRectangle_);const l=(this.tileRectangle_.east-this.tileRectangle_.west)/this.tileWidth;return this.rasterizeFeatures(a,this.styleFunction_,l)}),this.tileCache.set(r,o),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return o}catch(r){console.trace(r),this.errorEvent.raiseEvent("could not render pbf to tile",r)}}rasterizeFeatures(e,t,i){const n=document.createElement("canvas"),r=x_(n.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return e.forEach(o=>{const a=t(o,i);a&&(Array.isArray(a)?a.forEach(l=>{r.setStyle(l),r.drawGeometry(o)}):(r.setStyle(a),r.drawGeometry(o)))}),n}}function Cu(s,e){const t=s.camera,i=s.canvas,n=t.frustum,r=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(t.position,e,new Cesium.Cartesian3));return n.getPixelDimensions(i.clientWidth,i.clientHeight,r,s.pixelRatio,new Cesium.Cartesian2)}function iy(s,e,t){const i=Cu(s,e),n=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(-i.x*t,-i.y*t,0),new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(i.x*t,i.y*t,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([r,o])}function ny(s,e){s.applyTransform((t,i,n)=>{if(console.assert(t===i),n!==void 0&&n>=3)for(let r=0;r<i.length;r+=n)i[r+2]=i[r+2]+e;return i})}function sy(s,e=0,t=Cesium.Cartesian3.ZERO,i=new Cesium.Cartesian3(1,1,1)){const n=Yt(s),r=Cesium.Transforms.eastNorthUpToFixedFrame(n),o=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(t,o,i);return Cesium.Matrix4.multiply(r,a,new Cesium.Matrix4)}function vr(s,e,t,i,n){const r=Cesium.Math.clamp,o=Cesium.defaultValue,a=n,l=o(a==null?void 0:a.duration,500),c=o(a==null?void 0:a.easing,Td),h=a==null?void 0:a.callback;let u=0;const d=new Cesium.Matrix4,g=Date.now(),f=function(){const _=Date.now()-g,p=c(r(_/l,0,1));console.assert(p>=u),s.transform.clone(d);const y=(p-u)*e;u=p,s.lookAtTransform(i),s.rotate(t,y),s.lookAtTransform(d),p<1?window.requestAnimationFrame(f):h&&h()};window.requestAnimationFrame(f)}function Ja(s,e,t,i){const n=s.camera,r=tl(s,t),o=n.right,a=Cesium.Quaternion.fromAxisAngle(o,r),l=Cesium.Matrix3.fromQuaternion(a),c=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n.position,t,c);const h=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(l,c,h),Cesium.Cartesian3.add(h,t,h);const u=Cesium.Matrix4.fromTranslation(h);vr(n,e,h,u,i)}function Qa(s,e){const t=s.camera.getPickRay(e);return s.globe.pick(t,s)||s.camera.pickEllipsoid(e)}function Ar(s){const e=s.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight);return Qa(s,t)}function wu(s){const e=s.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return Qa(s,t)}function Tu(s){const e=s.camera,t=new Cesium.Ray(e.position,e.direction);let i=s.globe.pick(t,s);if(!i){const a=Cesium.Ellipsoid.WGS84,l=Cesium.IntersectionTests.rayEllipsoid(t,a);l&&(i=Cesium.Ray.getPoint(t,l.start))}if(!i)return;const n=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(i,n);const o=el(e.direction,n,e.right)-Math.PI;return Cesium.Math.convertLongitudeRange(o)}function Ru(s){const e=s.camera,t=e.frustum.fovy/2,i=e.direction,n=Cesium.Quaternion.fromAxisAngle(e.right,t),r=Cesium.Matrix3.fromQuaternion(n),o=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(r,i,o),new Cesium.Ray(e.position,o)}function el(s,e,t){const i=new Cesium.Cartesian3,n=new Cesium.Cartesian3,r=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(s,i),Cesium.Cartesian3.normalize(e,n),Cesium.Cartesian3.cross(i,n,r);const o=Cesium.Cartesian3.dot(i,n),a=Cesium.Cartesian3.magnitude(r),l=Cesium.Cartesian3.dot(t,r),c=Math.atan2(a,o);return l>=0?c:-c}function tl(s,e){const t=s.camera,i=t.frustum.fovy/2,n=Ru(s),r=Cesium.Cartesian3.clone(n.direction);Cesium.Cartesian3.negate(r,r);const o=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(e,o);const a=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(t.right,a),el(o,r,a)+i}function il(s,e){if(s&&e){const t=Vi(s,e,"EPSG:4326");return Cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3])}else return null}function Su(s,e,t,i){const n=e.get("olcs_skip");if(n)return null;let r=null;if(e instanceof ap&&e.getUrl()){const o={olcs_proxy:e.get("olcs_proxy"),olcs_extent:e.get("olcs_extent"),olcs_projection:e.get("olcs_projection"),"olcs.imagesource":e},a=e.getImageLoadFunction(),l=e.get("olcs_tileLoadFunction")||function(h,u){a(h,u)};e=new Ep({url:e.getUrl(),attributions:e.getAttributions(),projection:e.getProjection(),tileLoadFunction:l,params:e.getParams()}),e.setProperties(o)}if(e instanceof rs){let o=Is(e);if(o||(o=t),Bo(o))r=new Eu(s,e,t);else return null}else if(e instanceof np){let o=Is(e);if(o||(o=t),Bo(o)){const a=Cesium.Rectangle.fromDegrees(e.getImageExtent()[0],e.getImageExtent()[1],e.getImageExtent()[2],e.getImageExtent()[3],new Cesium.Rectangle);r=new Cesium.SingleTileImageryProvider({url:e.getUrl(),rectangle:a})}else return null}else if(e instanceof lp&&i instanceof $a){let o=Is(e);if(o||(o=t),n===!1){const a=o.getCode().split(":")[1],l=e.urls.map(m=>m.replace(a,"3857")),c=i.getExtent(),h=il(c,o),u=e.get("olcs_minimumLevel"),d=e.getAttributions(),g=i.getStyleFunction();let f;if(c&&d){const m=Me(c);f=nl(d,0,m,c)[0]}return r=new ty({credit:f,rectangle:h,minimumLevel:u,styleFunction:g,urls:l}),r}return null}else return null;return r}function Iu(s,e,t){if(!(e instanceof zh)&&!(e instanceof _u)&&!(e instanceof $a))return null;const i=e.getSource();if(!i)return null;let n=i.get("olcs_provider");if(n||(n=Su(s,i,t,e)),!n)return null;const r={},a=e.get("olcs_extent")||e.getExtent();return a&&(r.rectangle=il(a,t)),new Cesium.ImageryLayer(n,r)}function No(s,e){let t=1,i=!0;[s.layer].concat(s.parents).forEach(n=>{const r=n.getOpacity();r!==void 0&&(t*=r);const o=n.getVisible();o!==void 0&&(i=i&&o)}),e.alpha=t,e.show=i}function Yt(s){const e=s;return e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1])}function vs(s){console.assert(s!==null);const e=Yt,t=[];for(let i=0;i<s.length;++i)t.push(e(s[i]));return t}function Rn(s,e){console.assert(e);const t=H("EPSG:4326"),i=H(e);if(i.getCode()!==t.getCode()){const n=s.getProperties();s=s.clone(),s.transform(i,t),s.setProperties(n)}return s}function Uo(s){if(s=s||"black",Array.isArray(s))return new Cesium.Color(Cesium.Color.byteToFloat(s[0]),Cesium.Color.byteToFloat(s[1]),Cesium.Color.byteToFloat(s[2]),s[3]);if(typeof s=="string")return Cesium.Color.fromCssColorString(s);if(s instanceof CanvasPattern||s instanceof CanvasGradient){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=e.height=256,t.fillStyle=s,t.fillRect(0,0,e.width,e.height),new Cesium.ImageMaterialProperty({image:e})}console.assert(!1,"impossible")}function ry(s){let e="";const t=/\{(\d|[a-z])-(\d|[a-z])\}/,i=t.exec(s);if(i){s=s.replace(t,"{s}");const n=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let o;for(o=n;o<=r;++o)e+=String.fromCharCode(o)}return{url:s,subdomains:e}}function vu(s,e){return new Promise((t,i)=>{const n=e.camera,r=Ar(e);if(!r){i("Could not get bottom pivot");return}const o=s.getView().getRotation();if(o===void 0){i("The view is not initialized");return}const a=tl(e,r);Ja(e,o,r);const l=Cesium.Matrix4.fromTranslation(r),c=n.right,h={callback:()=>{const u=s.getView();bu(u),t(void 0)}};vr(n,-a,c,l,h)})}function Au(s,e){return new Promise((t,i)=>{const n=s.camera,r=Ar(s);if(!r){i("could not get bottom pivot");return}const o={callback:()=>t(void 0)},a=Cesium.Matrix4.fromTranslation(r),l=n.right;vr(n,-e,l,a,o)})}function bu(s,e=0){const t=s.getResolution();s.setRotation(e),s.constrainResolution?s.setResolution(s.constrainResolution(t)):s.setResolution(s.getConstrainedResolution(t))}function Bo(s){const e=s.getCode()==="EPSG:3857",t=s.getCode()==="EPSG:4326";return e||t}function nl(s,e,t,i){if(!s)return[];let n=s({viewState:{zoom:e,center:t,projection:void 0,resolution:void 0,rotation:void 0},extent:i});return Array.isArray(n)||(n=[n]),n.map(r=>new Cesium.Credit(r,!0))}function Lu(s,e,t,i){const n=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=s*n.clientHeight,c=Math.cos(Math.abs(e));return l*a*c/2/Math.tan(o/2)}function Pu(s,e,t,i){const n=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=2*s*Math.tan(o/2),c=Math.cos(Math.abs(e));return l/a/c/n.clientHeight}function Fu(s,e,t){let i=!1;return function(){if(!i){const n=s.position,r=Cesium.Cartographic.fromCartesian(n);if(Cesium.Cartesian3.distance(e.center,n)>e.radius*t(r.height)){if(s.flying===!0)return;{i=!0;const a=()=>i=!1;s.flyToBoundingSphere(e,{complete:a,cancel:a})}}}}}class oy{constructor(e){I(this,"ol3d");I(this,"scene_");I(this,"canvas_");I(this,"_boundNotifyRepaintRequired");I(this,"repaintEventNames_",["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"]);this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.isDestroyed()||this.scene_.requestRender()}}function Ts(s){return s*180/Math.PI}function Bi(s){return s*Math.PI/180}function Rs(s,e,t){const i=t||s.length;if(e)for(let n=0;n<i;++n)e[n]=s[n];return s}class Mu{constructor(e,t){I(this,"scene_");I(this,"cam_");I(this,"map_");I(this,"view_");I(this,"viewListenKey_",null);I(this,"toLonLat_",Rs);I(this,"fromLonLat_",Rs);I(this,"tilt_",0);I(this,"distance_",0);I(this,"lastCameraViewMatrix_",null);I(this,"viewUpdateInProgress_",!1);this.scene_=e,this.cam_=e.camera,this.map_=t,this.map_.on("change:view",i=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}destroy(){$e(this.viewListenKey_),this.viewListenKey_=null}setView_(e){if($e(this.viewListenKey_),this.viewListenKey_=null,this.view_=e,e){const t=gt(e.getProjection(),"EPSG:4326"),i=gt("EPSG:4326",e.getProjection());console.assert(t&&i),this.toLonLat_=t,this.fromLonLat_=i,this.viewListenKey_=e.on("propertychange",n=>this.handleViewChangedEvent_()),this.readFromView()}else this.toLonLat_=Rs,this.fromLonLat_=Rs}handleViewChangedEvent_(){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(Bi(t[0]),Bi(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([Ts(e.longitude),Ts(e.latitude)]);return console.assert(t),t}setAltitude(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(Bi(t[0]),Bi(t[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(i);i.height=o||0}const n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const t=this.toLonLat_(e);console.assert(t);const i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,Bi(t[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=wu(t);let n=i;if(!n){const o=t.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(n,this.cam_.position);const r=e.cartesianToCartographic(n);if(this.view_.setCenter(this.fromLonLat_([Ts(r.longitude),Ts(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),i){const o=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,i,l),Cesium.Cartesian3.normalize(l,l);const c=this.cam_.up,h=this.cam_.right,u=new Cesium.Cartesian3(-i.y,i.x,0),d=Cesium.Cartesian3.angleBetween(h,u),f=Cesium.Cartesian3.cross(i,c,new Cesium.Cartesian3).z;this.view_.setRotation(f<0?d:-d);const m=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(m)?0:m}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;setTimeout(()=>this.viewUpdateInProgress_=!1,1e3)}checkCameraChange(e){const t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;(!t||!Cesium.Matrix4.equalsEpsilon(t,i,1e-7))&&(this.lastCameraViewMatrix_=i.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,t){return Lu(e,t,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,t){return Pu(e,t,this.scene_,this.view_.getProjection())}}class sl{constructor(e,t){I(this,"map");I(this,"view");I(this,"scene");I(this,"olLayers");I(this,"mapLayerGroup");I(this,"layerMap",{});I(this,"olLayerListenKeys",{});I(this,"olGroupListenKeys_",{});this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup()}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const i=t.splice(0,1)[0],n=i.layer,r=pe(n).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(n instanceof Dn)this.listenForGroupChanges_(n),n!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(i)),o||n.getLayers().forEach(a=>{if(a){const l={layer:a,parents:n===this.mapLayerGroup?[]:[i.layer].concat(i.parents)};t.push(l)}});else if(o=this.createSingleLayerCounterparts(i),!o){const a=r,l=i,c=()=>{const h=this.createSingleLayerCounterparts(l);h&&(l.layer.un("change",c),this.addCesiumObjects_(h,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(l.layer.on("change",c))}o&&this.addCesiumObjects_(o,r,n)}this.orderLayers()}addCesiumObjects_(e,t,i){this.layerMap[t]=e,this.olLayerListenKeys[t].push(i.on("change:zIndex",()=>this.orderLayers())),e.forEach(n=>{this.addCesiumObject(n)})}removeAndDestroySingleLayer_(e){const t=pe(e).toString(),i=this.layerMap[t];return i&&(i.forEach(n=>{this.removeSingleCesiumObject(n,!1),this.destroyCesiumObject(n)}),this.olLayerListenKeys[t].forEach($e),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!i}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const t=pe(e).toString();this.olGroupListenKeys_[t].forEach(n=>{$e(n)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}removeLayer_(e){if(e){const t=[e];for(;t.length>0;){const i=t.splice(0,1)[0],n=this.removeAndDestroySingleLayer_(i);i instanceof Dn&&(this.unlistenSingleGroup_(i),n||i.getLayers().forEach(r=>{t.push(r)}))}}}listenForGroupChanges_(e){const t=pe(e).toString();console.assert(this.olGroupListenKeys_[t]===void 0);const i=[];this.olGroupListenKeys_[t]=i;let n=[];const r=(function(){const o=e.getLayers();o&&(n=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],i.push(...n))}).bind(this);r(),i.push(e.on("change:layers",o=>{n.forEach(a=>{const l=i.indexOf(a);l>=0&&i.splice(l,1),$e(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach($e);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach($e);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}}class Ou extends sl{constructor(t,i){super(t,i);I(this,"cesiumLayers_");I(this,"ourLayers_");this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(t){this.cesiumLayers_.add(t),this.ourLayers_.add(t)}destroyCesiumObject(t){t.destroy()}removeSingleCesiumObject(t,i){this.cesiumLayers_.remove(t,i),this.ourLayers_.remove(t,!1)}removeAllCesiumObjects(t){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),t);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(t,i){const n=Iu(this.map,t,i);return n?[n]:null}createSingleLayerCounterparts(t){const i=t.layer,n=pe(i).toString(),r=this.view.getProjection();console.assert(r);const o=this.convertLayerToCesiumImageries(i,r);if(o){const a=[];if([t.layer].concat(t.parents).forEach(l=>{a.push(l.on(["change:opacity","change:visible"],()=>{console.assert(o);for(let c=0;c<o.length;++c)No(t,o[c])}))}),i instanceof Ra){let l=i.getStyleFunction();a.push(i.on("change",()=>{var h;const c=i.getStyleFunction();if(l!==c){l=c;for(let u=0;u<o.length;++u){const d=o[u];d._imageryCache&&(d._imageryCache={});const g=d.imageryProvider;g&&((h=g.tileCache)==null||h.clear(),g.styleFunction_=c)}this.scene.requestRender()}}))}for(let l=0;l<o.length;++l)No(t,o[l]);a.push(i.on("change:extent",l=>{for(let c=0;c<o.length;++c)this.cesiumLayers_.remove(o[c],!0),this.ourLayers_.remove(o[c],!1);delete this.layerMap[pe(i)],this.synchronize()})),a.push(i.on("change",l=>{for(let c=0;c<o.length;++c){const h=this.cesiumLayers_.indexOf(o[c]);h>=0&&(this.cesiumLayers_.remove(o[c],!1),this.cesiumLayers_.add(o[c],h))}})),this.olLayerListenKeys[n].push(...a)}return Array.isArray(o)?o:null}orderLayers(){const t=[],i={},n=[this.mapLayerGroup];for(;n.length>0;){const r=n.splice(0,1)[0];if(t.push(r),i[pe(r)]=r.getZIndex()||0,r instanceof Dn){const o=r.getLayers();o&&n.unshift(...o.getArray())}}t.sort((r,o)=>i[pe(r)]-i[pe(o)]),t.forEach(r=>{const o=pe(r).toString(),a=this.layerMap[o];a&&a.forEach(l=>{this.raiseToTop(l)})})}raiseToTop(t){this.cesiumLayers_.raiseToTop(t)}}class Du{constructor(e,t){I(this,"olListenKeys",[]);I(this,"context");I(this,"rootCollection_");const i=new Cesium.BillboardCollection({scene:t}),n=new Cesium.PrimitiveCollection;this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:n},this.rootCollection_.add(i),this.rootCollection_.add(n)}destroy(){this.olListenKeys.forEach($e),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Gu{constructor(e){I(this,"scene");I(this,"boundOnRemoveOrClearFeatureListener_",this.onRemoveOrClearFeature_.bind(this));I(this,"defaultBillboardEyeOffset_",new Cesium.Cartesian3(0,0,10));this.scene=e,this.scene=e}onRemoveOrClearFeature_(e){const t=e.target;console.assert(t instanceof qs);const i=t.olcs_cancellers;if(i){const n=e.feature;if(n){const r=pe(n),o=i[r];o&&(o(),delete i[r])}else{for(const r in i)i.hasOwnProperty(r)&&i[r]();t.olcs_cancellers={}}}}setReferenceForPicking(e,t,i){i.olLayer=e,i.olFeature=t}createColoredPrimitive(e,t,i,n,r,o){const a=function(d,g){const f=new Cesium.GeometryInstance({geometry:d});return g&&!(g instanceof Cesium.ImageMaterialProperty)&&(f.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(g)}),f},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState.lineWidth=o);const c=a(n,r),h=this.getHeightReference(e,t,i);let u;if(h===Cesium.HeightReference.CLAMP_TO_GROUND){if(!("createShadowVolume"in c.geometry.constructor))return null;u=new Cesium.GroundPrimitive({geometryInstances:c})}else u=new Cesium.Primitive({geometryInstances:c});if(r instanceof Cesium.ImageMaterialProperty){const d=r.image.getValue().toDataURL();u.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:d}}})})}else u.appearance=new Cesium.MaterialAppearance({...l,material:new Cesium.Material({translucent:r.alpha!==1,fabric:{type:"Color",uniforms:{color:r}}})}),u instanceof Cesium.Primitive&&(t.get("olcs_shadows")||e.get("olcs_shadows"))&&(u.shadows=1);return this.setReferenceForPicking(e,t,u),u}extractColorFromOlStyle(e,t){var a;const i=(a=e.getFill())==null?void 0:a.getColor(),n=e.getStroke()?e.getStroke().getColor():null;let r="black";n&&t?r=n:i&&(r=i);const o=Uo(r);return"red"in o?o:Cesium.Color.BLACK}extractLineWidthFromOlStyle(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return t!==void 0?t:1}wrapFillAndOutlineGeometries(e,t,i,n,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),c=new Cesium.PrimitiveCollection;if(o.getFill()){const h=this.createColoredPrimitive(e,t,i,n,a);console.assert(!!h),c.add(h)}if(o.getStroke()&&r){const h=this.extractLineWidthFromOlStyle(o),u=this.createColoredPrimitive(e,t,i,r,l,h);u&&c.add(u)}return c}addTextStyle(e,t,i,n,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!n.getText())return o;const a=n.getText(),l=this.olGeometry4326TextPartToCesium(e,t,i,a);return l&&o.add(l),o}csAddBillboard(e,t,i,n,r,o){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(t);return this.setReferenceForPicking(i,n,a),a}olCircleGeometryToCesium(e,t,i,n,r){i=Rn(i,n),console.assert(i.getType()=="Circle");const o=i.getCenter(),a=o.length==3?o[2]:0,l=o.slice();l[0]+=i.getRadius();const c=Yt(o),h=Yt(l),u=Cesium.Cartesian3.distance(c,h),d=new Cesium.CircleGeometry({center:c,radius:u,height:a});let g,f;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){const _=this.extractLineWidthFromOlStyle(r);if(_){const p=vf(i.getCenter(),u),y=vs(p.getLinearRing(0).getCoordinates()),x=g=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:y,width:_})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN});ho(g).then(()=>{this.setReferenceForPicking(e,t,x._primitive)})}}else f=new Cesium.CircleOutlineGeometry({center:c,radius:u,extrudedHeight:a,height:a});const m=this.wrapFillAndOutlineGeometries(e,t,i,d,f,r);return g&&m.add(g),this.addTextStyle(e,t,i,r,m)}olLineStringGeometryToCesium(e,t,i,n,r){i=Rn(i,n),console.assert(i.getType()=="LineString");const o=vs(i.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const c=this.getHeightReference(e,t,i),h=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)});if(c===Cesium.HeightReference.CLAMP_TO_GROUND){const u=new Cesium.GroundPolylineGeometry({positions:o,width:a}),d=l=new Cesium.GroundPolylinePrimitive({appearance:h,geometryInstances:new Cesium.GeometryInstance({geometry:u})});ho(l).then(()=>{this.setReferenceForPicking(e,t,d._primitive)})}else{const u=new Cesium.PolylineGeometry({positions:o,width:a,vertexFormat:h.vertexFormat});l=new Cesium.Primitive({appearance:h,geometryInstances:new Cesium.GeometryInstance({geometry:u})})}return this.setReferenceForPicking(e,t,l),this.addTextStyle(e,t,i,r,l)}olPolygonGeometryToCesium(e,t,i,n,r){i=Rn(i,n),console.assert(i.getType()=="Polygon");const o=this.getHeightReference(e,t,i);let a,l,c;if(i.getCoordinates()[0].length==5&&t.get("olcs_polygon_kind")==="rectangle"){const u=i.getCoordinates()[0],d=Fs(u),g=Cesium.Rectangle.fromDegrees(d[0],d[1],d[2],d[3]);let f=0;if(u[0].length==3)for(let _=0;_<u.length;_++)f=Math.max(f,u[_][2]);const m=t.get("olcs_extruded_height");a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:f,extrudedHeight:m}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:f,extrudedHeight:m})}else{const u=i.getLinearRings(),d={positions:[],holes:[]},g=d;console.assert(u.length>0);for(let m=0;m<u.length;++m){const _=u[m].getCoordinates(),p=vs(_);console.assert(p&&p.length>0),m===0?d.positions=p:d.holes.push({positions:p,holes:[]})}const f=t.get("olcs_extruded_height");if(a=new Cesium.PolygonGeometry({polygonHierarchy:g,perPositionHeight:!0,extrudedHeight:f}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const m=this.extractLineWidthFromOlStyle(r);if(m>0){const _=[d.positions];if(d.holes)for(let x=0;x<d.holes.length;++x)_.push(d.holes[x].positions);const p=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),y=[];for(const x of _){const E=new Cesium.GroundPolylineGeometry({positions:x,width:m});y.push(new Cesium.GeometryInstance({geometry:E}))}c=new Cesium.GroundPolylinePrimitive({appearance:p,geometryInstances:y}),ho(c).then(()=>{this.setReferenceForPicking(e,t,c._primitive)})}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:d,perPositionHeight:!0,extrudedHeight:f})}const h=this.wrapFillAndOutlineGeometries(e,t,i,a,l,r);return c&&h.add(c),this.addTextStyle(e,t,i,r,h)}getHeightReference(e,t,i){let n=i.get("altitudeMode");n===void 0&&(n=t.get("altitudeMode")),n===void 0&&(n=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return n==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:n==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,t,i,n,r,o,a,l){o instanceof Ji&&o.load();const c=o.getImage(1),h=function(d){return d.src!=""&&d.naturalHeight!=0&&d.naturalWidth!=0&&d.complete},u=(function(){if(!c||!(c instanceof HTMLCanvasElement||c instanceof Image||c instanceof HTMLImageElement))return;const d=i.getCoordinates(),g=Yt(d);let f;const m=o.getOpacity();m!==void 0&&(f=new Cesium.Color(1,1,1,m));const _=o.getScale(),p=this.getHeightReference(e,t,i),y={image:c,color:f,scale:Array.isArray(_)?(_[0]+_[1])/2:_,heightReference:p,position:g};if(Object.assign(y,t.get("cesiumOptions")),o instanceof Ji){const E=o.getAnchor();if(E){const C=Array.isArray(_)?_[0]:_,w=Array.isArray(_)?_[1]:_;y.pixelOffset=new Cesium.Cartesian2((c.width/2-E[0])*C,(c.height/2-E[1])*w)}}const x=this.csAddBillboard(a,y,e,t,i,r);l&&l(x)}).bind(this);if(c instanceof Image&&!h(c)){let d=!1;const g=e.getSource(),f=function(){d=!0};g.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let m=g.olcs_cancellers;m||(m=g.olcs_cancellers={});const _=pe(t);m[_]&&m[_](),m[_]=f;const p=function(){c.removeEventListener("load",p),!a.isDestroyed()&&!d&&u()};c.addEventListener("load",p)}else u()}olPointGeometryToCesium(e,t,i,n,r,o,a){console.assert(i.getType()=="Point"),i=Rn(i,n);let l=null;const c=r.getImage();if(c){const h=i.get("olcs_model")||t.get("olcs_model");if(h){l=new Cesium.PrimitiveCollection;const u=h(),d=Object.assign({},{scene:this.scene},u.cesiumOptions);if("fromGltf"in Cesium.Model){const g=Cesium.Model.fromGltf(d);l.add(g)}else Cesium.Model.fromGltfAsync(d).then(g=>{l.add(g)});u.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:u.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,n,r,c,o,a)}return r.getText()?this.addTextStyle(e,t,i,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,t,i,n,r,o,a){switch(i.getType()){case"MultiPoint":{const l=i.getPoints();if(r.getText()){const c=new Cesium.PrimitiveCollection;return l.forEach(h=>{console.assert(h);const u=this.olPointGeometryToCesium(e,t,h,n,r,o,a);u&&c.add(u)}),c}else return l.forEach(c=>{console.assert(c),this.olPointGeometryToCesium(e,t,c,n,r,o,a)}),null}case"MultiLineString":{const l=i.getLineStrings(),c=new Cesium.PrimitiveCollection;return l.forEach(h=>{const u=this.olLineStringGeometryToCesium(e,t,h,n,r);c.add(u)}),c}case"MultiPolygon":{const l=i.getPolygons(),c=new Cesium.PrimitiveCollection;return l.forEach(h=>{const u=this.olPolygonGeometryToCesium(e,t,h,n,r);c.add(u)}),c}default:console.assert(!1,`Unhandled multi geometry type${i.getType()}`)}}olGeometry4326TextPartToCesium(e,t,i,n){const r=n.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=Me(i.getExtent());if(i instanceof Lt){const f=i.getFirstCoordinate();a[2]=f.length==3?f[2]:0}const l={position:Yt(a)};l.text=Array.isArray(r)?r.join(" "):r,l.heightReference=this.getHeightReference(e,t,i);const c=n.getOffsetX(),h=n.getOffsetY();if(c!=0||h!=0){const f=new Cesium.Cartesian2(c,h);l.pixelOffset=f}l.font=n.getFont()||"10px sans-serif";let u;n.getFill()&&(l.fillColor=this.extractColorFromOlStyle(n,!1),u=Cesium.LabelStyle.FILL),n.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(n),l.outlineColor=this.extractColorFromOlStyle(n,!0),u=Cesium.LabelStyle.OUTLINE),n.getFill()&&n.getStroke()&&(u=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=u;let d;switch(n.getTextAlign()){case"left":d=Cesium.HorizontalOrigin.LEFT;break;case"right":d=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:d=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=d,n.getTextBaseline()){let f;switch(n.getTextBaseline()){case"top":f=Cesium.VerticalOrigin.TOP;break;case"middle":f=Cesium.VerticalOrigin.CENTER;break;case"bottom":f=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":f=Cesium.VerticalOrigin.TOP;break;case"hanging":f=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${n.getTextBaseline()}`)}l.verticalOrigin=f}const g=o.add(l);return this.setReferenceForPicking(e,t,g),o}olStyleToCesium(e,t,i){const n=t.getFill(),r=t.getStroke();if(i&&!r||!i&&!n)return null;const o=i?r.getColor():n.getColor(),a=Uo(o),l=r.getLineDash();return i&&l?Cesium.Material.fromType("PolylineDash",{dashPattern:ay(l),color:a}):Cesium.Material.fromType("Color",{color:a})}computePlainStyle(e,t,i,n){const r=t.getStyleFunction();let o=null;return r&&(o=r(t,n)),!o&&i&&(o=i(t,n)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(e,t,i){if(i)return i;const n=e.get("olcs_3d_geometry");if(n&&n instanceof Gs)return n;if(t){const r=t.getGeometryFunction()(e);if(r instanceof Gs)return r}return e.getGeometry()}olFeatureToCesium(e,t,i,n,r){const o=this.getGeometryFromFeature(t,i,r);if(!o)return null;const a=n.projection,l=function(c){const h=n.featureToCesiumMap[pe(t)];h instanceof Array?h.push(c):n.featureToCesiumMap[pe(t)]=[c]};switch(o.getType()){case"GeometryCollection":const c=new Cesium.PrimitiveCollection;return o.getGeometriesArray().forEach(d=>{if(d){const g=this.olFeatureToCesium(e,t,i,n,d);g&&c.add(g)}}),c;case"Point":const h=n.billboards,u=this.olPointGeometryToCesium(e,t,o,a,i,h,l);return u||null;case"Circle":return this.olCircleGeometryToCesium(e,t,o,a,i);case"LineString":return this.olLineStringGeometryToCesium(e,t,o,a,i);case"Polygon":return this.olPolygonGeometryToCesium(e,t,o,a,i);case"MultiPoint":return this.olMultiGeometryToCesium(e,t,o,a,i,n.billboards,l)||null;case"MultiLineString":return this.olMultiGeometryToCesium(e,t,o,a,i,n.billboards,l)||null;case"MultiPolygon":return this.olMultiGeometryToCesium(e,t,o,a,i,n.billboards,l)||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(e,t,i){const n=t.getProjection(),r=t.getResolution();if(r===void 0||!n)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=e.getSource();o instanceof jh&&(o=o.getSource()),console.assert(o instanceof qs);const a=o.getFeatures(),l=new Du(n,this.scene),c=l.context;for(let h=0;h<a.length;++h){const u=a[h];if(!u)continue;const d=e.getStyleFunction(),g=this.computePlainStyle(e,u,d,r);if(!g||!g.length)continue;let f=null;for(let m=0;m<g.length;m++){const _=this.olFeatureToCesium(e,u,g[m],c);if(_){if(!f)f=_;else if(_){let p=0,y;for(;y=_.get(p);)f.add(y),p++}}}f&&(i[pe(u)]=f,l.getRootPrimitive().add(f))}return l}convert(e,t,i,n){const r=t.getProjection(),o=t.getResolution();if(o==null||!r)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,i,a,o);if(!l||!l.length)return null;n.projection=r;let c=null;for(let h=0;h<l.length;h++){const u=this.olFeatureToCesium(e,i,l[h],n);if(!c)c=u;else if(u){let d=0,g;for(;g=u.get(d);)c.add(g),d++}}return c}}function ay(s){s.length<2&&(s=[1,1]);const e=s.length%2===0?s:[...s,...s],i=e.reduce((r,o)=>r+o,0)/16;let n=e.map((r,o)=>{const a=o%2===0?"1":"0";let l=Math.round(r/i);return o===0&&l===0&&(l=1),a.repeat(l)}).join("");return n.length<16?n=n.padEnd(16,"0"):n.length>16&&(n=n.substring(0,16)),n[15]==="1"&&(n=n.substring(0,15)+"0"),console.assert(n.length===16),parseInt(n,2)}class ku extends sl{constructor(t,i,n){super(t,i);I(this,"converter");I(this,"csAllPrimitives_");this.converter=n||new Gu(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(t){console.assert(t);const i=t.getRootPrimitive();i.counterpart=t,this.csAllPrimitives_.add(t.getRootPrimitive())}destroyCesiumObject(t){t.getRootPrimitive().destroy()}removeSingleCesiumObject(t,i){t.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(t.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(t){if(this.csAllPrimitives_.destroyPrimitives=t,t)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(t,i){let n=!0;[t.layer].concat(t.parents).forEach(r=>{const o=r.getVisible();o!==void 0?n=n&&o:n=!1}),i.show=n}createSingleLayerCounterparts(t){const i=t.layer;if(!(i instanceof g_)||i instanceof $a)return null;console.assert(i instanceof dr);let n=i.getSource();if(n instanceof jh&&(n=n.getSource()),!n)return null;console.assert(n instanceof qs),console.assert(this.view);const r=this.view,o={},a=this.converter.olVectorLayerToCesium(i,r,o),l=a.getRootPrimitive(),c=a.olListenKeys;[t.layer].concat(t.parents).forEach(d=>{c.push(d.on("change:visible",()=>{this.updateLayerVisibility(t,l)}))}),this.updateLayerVisibility(t,l);const h=d=>{const g=a.context,f=this.converter.convert(i,r,d,g);f&&(o[pe(d)]=f,l.add(f))},u=d=>{const g=pe(d),f=a.context,m=f.featureToCesiumMap[g];m&&(delete f.featureToCesiumMap[g],m.forEach(p=>{p instanceof Cesium.Billboard&&f.billboards.remove(p)}));const _=o[g];delete o[g],_&&l.remove(_)};return c.push(n.on("addfeature",d=>{console.assert(d.feature),h(d.feature)})),c.push(n.on("removefeature",d=>{console.assert(d.feature),u(d.feature)})),c.push(n.on("changefeature",d=>{const g=d.feature;console.assert(g),u(g),h(g)})),a?[a]:null}}function ly(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function cy(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function Nu(s,e){const t=s.cloneNode();s.nodeName==="CANVAS"&&t.getContext("2d").drawImage(s,0,0),e&&e.appendChild(t),s.nodeType!==Node.TEXT_NODE&&t.addEventListener("click",n=>{s.dispatchEvent(new MouseEvent("click",n)),n.stopPropagation()});const i=s.childNodes;for(let n=0;n<i.length;n++)i[n]&&Nu(i[n],t);return t}class hy extends C_{constructor(t){const i=t.parent;super(i.getOptions());I(this,"scenePostRenderListenerRemover_",null);I(this,"scene_");I(this,"synchronizer_");I(this,"parent_");I(this,"positionWGS84_");I(this,"observer_");I(this,"attributeObserver_",[]);I(this,"listenerKeys_");this.scene_=t.scene,this.synchronizer_=t.synchronizer,this.parent_=i,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const n=r=>this.setPropertyFromEvent_(r);this.listenerKeys_.push(this.parent_.on("change:element",n)),this.listenerKeys_.push(this.parent_.on("change:offset",n)),this.listenerKeys_.push(this.parent_.on("change:position",n)),this.listenerKeys_.push(this.parent_.on("change:positioning",n)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged(),this.handlePositionChanged()}observeTarget_(t){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(i=>{i.disconnect()}),this.attributeObserver_.length=0;for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1){const r=new MutationObserver(this.handleElementChanged.bind(this));r.observe(n,{attributes:!0,subtree:!0}),this.attributeObserver_.push(r)}}}}setPropertyFromEvent_(t){t.target&&t.key&&this.set(t.key,t.target.get(t.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),ly(this.element)),this.scenePostRenderListenerRemover_=null;const t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}}handlePositionChanged(){if(!this.parent_)return;const t=this.getPosition();if(t){const i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=Ci(t,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){cy(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const i of Array.from(t.parentNode.childNodes)){const n=Nu(i,null);this.element.appendChild(n)}t.parentNode&&this.observeTarget_(t.parentNode)}updatePixelPosition(){const t=this.positionWGS84_;if(!this.scene_||!t){this.setVisible(!1);return}let i=0;if(t.length===2){const d=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(t[0],t[1]));d&&this.scene_.globe.tilesLoaded&&(t[2]=d),d&&(i=d)}else i=t[2];const n=Cesium.Cartesian3.fromDegrees(t[0],t[1],i),r=this.scene_.camera,o=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(o,r.position).isPointVisible(n)){this.setVisible(!1);return}if(r.frustum.computeCullingVolume(r.position,r.direction,r.up).computeVisibility(new Cesium.BoundingSphere(n))!==1){this.setVisible(!1);return}this.setVisible(!0);const c=this.scene_.cartesianToCanvasCoordinates(n),h=[c.x,c.y],u=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(h,u)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),$e(this.listenerKeys_),this.listenerKeys_.splice(0),"removeNode"in this.element?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Uu{constructor(e,t){I(this,"map");I(this,"scene");I(this,"overlayCollection_");I(this,"overlayContainerStopEvent_");I(this,"overlayContainer_");I(this,"overlayMap_",new Map);I(this,"overlayEvents",["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"]);I(this,"listenerKeys_",[]);this.map=e,this.scene=t,this.map=e,this.overlayCollection_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.overlayEvents.forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,n=>n.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_)}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.overlayCollection_.forEach(e=>{this.addOverlay(e)}),this.listenerKeys_.push(this.overlayCollection_.on("add",e=>this.addOverlay(e.element))),this.listenerKeys_.push(this.overlayCollection_.on("remove",e=>this.removeOverlay(e.element)))}addOverlay(e){if(!e)return;const t=new hy({scene:this.scene,synchronizer:this,parent:e});this.overlayMap_.set(pe(e),t)}removeOverlay(e){const t=pe(e),i=this.overlayMap_.get(t);i&&(i.destroy(),this.overlayMap_.delete(t))}destroyAll(){this.overlayMap_.forEach(e=>{e.destroy()}),this.overlayMap_.clear(),$e(this.listenerKeys_),this.listenerKeys_.length=0}}const uo={DONE:0,PENDING:1,FAILED:2};class br{constructor(e){I(this,"autoRenderLoop_",null);I(this,"map_");I(this,"time_");I(this,"to4326Transform_");I(this,"resolutionScale_",1);I(this,"canvasClientWidth_",0);I(this,"canvasClientHeight_",0);I(this,"resolutionScaleChanged_",!0);I(this,"container_");I(this,"isOverMap_");I(this,"canvas_");I(this,"enabled_",!1);I(this,"pausedInteractions_",[]);I(this,"hiddenRootGroup_",null);I(this,"scene_");I(this,"camera_");I(this,"globe_");I(this,"dataSourceCollection_");I(this,"dataSourceDisplay_");I(this,"lastFrameTime_",0);I(this,"renderId_");I(this,"targetFrameRate_",Number.POSITIVE_INFINITY);I(this,"blockCesiumRendering_",!1);I(this,"warmingUp_",!1);I(this,"trackedFeature_",null);I(this,"trackedEntity_",null);I(this,"entityView_",null);I(this,"needTrackedEntityUpdate_",!1);I(this,"boundingSphereScratch_",new Cesium.BoundingSphere);I(this,"synchronizers_");I(this,"refresh2DAfterCameraMoveEndOnly",!1);I(this,"moveEndRemoveCallback_");this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=gt(this.map_.getView().getProjection(),"EPSG:4326");const t="position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;";this.container_=document.createElement("DIV");const i=document.createAttribute("style");i.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(i);let n=e.target||this.map_.getViewport();if(typeof n=="string"&&(n=document.getElementById(n)),n.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const h=["click","dblclick","mousedown","touchstart","pointerdown","mousewheel","wheel"];for(let u=0,d=h.length;u<d;++u)this.container_.addEventListener(h[u],g=>g.stopPropagation())}this.canvas_=document.createElement("canvas");const r=document.createAttribute("style");r.value=t,this.canvas_.setAttributeNode(r),ko()&&(this.canvas_.style.imageRendering=$p()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_);const o=e.sceneOptions!==void 0?{...e.sceneOptions,canvas:this.canvas_,scene3DOnly:!0}:{canvas:this.canvas_,scene3DOnly:!0};this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;Array.isArray(a.tiltEventTypes)?(a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT})):console.log("sscc is not an array"),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new Mu(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({tileHeight:1,tileWidth:1,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_}),this.synchronizers_=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Ou(this.map_,this.scene_),new ku(this.map_,this.scene_),new Uu(this.map_,this.scene_)],this.handleResize_();for(let h=this.synchronizers_.length-1;h>=0;--h)this.synchronizers_[h].synchronize();new Cesium.EventHelper().add(this.scene_.postRender,br.prototype.updateTrackedEntity_,this),this.moveEndRemoveCallback_=this.scene_.camera.moveEnd.addEventListener(()=>{this.refresh2DAfterCameraMoveEndOnly&&this.camera_.checkCameraChange()})}destroy(){cancelAnimationFrame(this.renderId_),this.renderId_=void 0,this.synchronizers_.forEach(e=>e.destroyAll()),this.camera_.destroy(),this.scene_.destroy(),this.scene_._postRender=null,this.moveEndRemoveCallback_(),this.container_.remove()}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t){this.render_();return}this.lastFrameTime_=e;const n=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(n),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===uo.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(n,this.boundingSphereScratch_))}this.scene_.render(n),this.refresh2DAfterCameraMoveEndOnly||this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i===uo.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const n=i!==uo.FAILED?this.boundingSphereScratch_:void 0;n&&(n.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),n),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(e===0||t===0||e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let i=this.resolutionScale_;ko()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let t;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){t=this.map_.getInteractions(),t.forEach((n,r,o)=>{this.pausedInteractions_.push(n)}),t.clear(),this.map_.addInteraction=n=>this.pausedInteractions_.push(n),this.map_.removeInteraction=n=>{let r=!1;return this.pausedInteractions_=this.pausedInteractions_.filter(o=>{const a=o!==n;return r||(r=a),a}),r?n:void 0};const i=this.map_.getLayerGroup();i.getVisible()&&(this.hiddenRootGroup_=i,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(i=>{t.push(i)}),this.pausedInteractions_.length=0,this.map_.addInteraction=i=>this.map_.getInteractions().push(i),this.map_.removeInteraction=i=>this.map_.getInteractions().remove(i),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const i=this.globe_.ellipsoid,n=this.scene_.camera,r=i.cartesianToCartographic(n.position);r.height<e&&(r.height=e,n.position=i.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new oy(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}setRefresh2DAfterCameraMoveEndOnly(e){this.refresh2DAfterCameraMoveEndOnly=e}throwOnUnitializedMap_(){const t=this.map_.getView(),i=t.getCenter();if(!t.isDef()||isNaN(i[0])||isNaN(i[1]))throw new Error(`The OpenLayers map is not properly initialized: ${i} / ${t.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const i=this.to4326Transform_,n=function(){const o=e.getGeometry();console.assert(o instanceof mt);const a=o instanceof mt?o.getCoordinates():[],l=i(a,void 0,a.length);return Yt(l)},r={position:new Cesium.CallbackProperty((o,a)=>n(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}function uy(s,e,t){const i=e/t;let n;return i>1?(n=[s.width,s.width/i],n[1]>s.height&&(n=[s.height*i,s.height])):(n=[s.height*i,s.height],n[0]>s.width&&(n=[s.width,s.width/i])),{scaling:[n[0]/s.width,n[1]/s.height],width:n[0],height:n[1],offsetX:(s.width-n[0])/2,offsetY:(s.height-n[1])/2}}let pn=null;class Kn{constructor(e){I(this,"gl");I(this,"programInfo");I(this,"positionBuffer");this.gl=e;const t=this.initShaderProgram();this.programInfo={program:t,attribLocations:{vertexPosition:e.getAttribLocation(t,"aVertexPosition")},uniformLocations:{uScaling:e.getUniformLocation(t,"uScaling")}},this.positionBuffer=e.createBuffer();const i=[1,1,-1,1,1,-1,-1,-1];e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW)}getVertexShaderSource(){return`
      attribute vec4 aVertexPosition;
      uniform vec2 uScaling;
      void main() {
        gl_Position = vec4(aVertexPosition[0] * uScaling[0], aVertexPosition[1] * uScaling[1], -1.0, 1.0);
      }
    `}getFragmentShaderSource(){return`
      precision highp float;
      void main() {
        gl_FragColor = vec4(.5, .5, .5, .6);
      }
  `}initShaderProgram(){const e=this.gl,t=this.getVertexShaderSource(),i=this.getFragmentShaderSource(),n=Kn.loadShader(e,e.VERTEX_SHADER,t),r=Kn.loadShader(e,e.FRAGMENT_SHADER,i),o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(`Unable to initialize the shader program: ${e.getProgramInfoLog(o)}`);return o}drawMask(e){const t=this.gl,i=this.programInfo;t.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(i.attribLocations.vertexPosition,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.attribLocations.vertexPosition),t.useProgram(i.program),t.enable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),t.uniform2fv(i.uniformLocations.uScaling,e),t.blendFunc(t.ZERO,t.ONE),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.stencilFunc(t.EQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.uniform2fv(i.uniformLocations.uScaling,[1,1]),t.blendFunc(t.ZERO,t.SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,4)}static loadShader(e,t,i){const n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(`An error occurred compiling the shaders: ${e.getShaderInfoLog(n)}`);return n}}function dy(s,e){const t=s.canvas,i=t.getContext("webgl2")||t.getContext("webgl");if(e){if(!pn){const n=new Kn(i);pn=s.postRender.addEventListener(()=>{n.drawMask(e())})}}else pn&&(pn(),pn=null);s.requestRender()}function fy(s,e){return new Promise((t,i)=>{const n=s.postRender.addEventListener(()=>{n();try{let r;if(e){const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(s.canvas,e.offsetX,e.offsetY,e.width,e.height,0,0,e.width,e.height),r=o.toDataURL()}else r=s.canvas.toDataURL();t(r)}catch(r){i(r)}});s.requestRender()})}class Bu{constructor(e){I(this,"promise");I(this,"url_");this.url_=e}load(){return this.promise||(this.promise=new Promise((e,t)=>{const i=document.createElement("script");i.onload=()=>e(),i.onerror=()=>t(),document.head.appendChild(i),i.src=this.url_})),this.promise}}class gy extends nn{constructor(t,{map:i,cameraExtentInRadians:n,cesiumIonDefaultAccessToken:r}){super();I(this,"cesiumUrl_");I(this,"boundingSphere_");I(this,"promise_");I(this,"cesiumIonDefaultAccessToken_");I(this,"map");I(this,"cameraExtentInRadians");I(this,"ol3d");I(this,"cesiumInitialTilt_",Bi(50));I(this,"fogDensity",1e-4);I(this,"fogSSEFactor",25);I(this,"minimumZoomDistance",2);I(this,"maximumZoomDistance",1e7);I(this,"limitCameraToBoundingSphereRatio",t=>t>3e3?9:3);this.cesiumUrl_=t,console.assert(i),this.map=i,this.cameraExtentInRadians=n||null,this.cesiumIonDefaultAccessToken_=r}load(){if(!this.promise_){const t=new Bu(this.cesiumUrl_);this.promise_=t.load().then(()=>this.onCesiumLoaded())}return this.promise_}onCesiumLoaded(){if(this.cameraExtentInRadians){const i=new Cesium.Rectangle(...this.cameraExtentInRadians);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=i,this.boundingSphere_=Cesium.BoundingSphere.fromRectangle3D(i,Cesium.Ellipsoid.WGS84,300)}this.cesiumIonDefaultAccessToken_&&(Cesium.Ion.defaultAccessToken=this.cesiumIonDefaultAccessToken_),this.ol3d=this.instantiateOLCesium();const t=this.ol3d.getCesiumScene();return this.configureForUsability(t),this.configureForPerformance(t),this.dispatchEvent("load"),this.ol3d}instantiateOLCesium(){const t=new br({map:this.map}),i=t.getCesiumScene();return Cesium.createWorldTerrainAsync().then(n=>i.terrainProvider=n),t}configureForPerformance(t){const i=t.fog;i.enabled=!0,i.density=this.fogDensity,i.screenSpaceErrorFactor=this.fogSSEFactor}configureForUsability(t){const i=t.screenSpaceCameraController;i.minimumZoomDistance=this.minimumZoomDistance,i.maximumZoomDistance=this.maximumZoomDistance,t.globe.depthTestAgainstTerrain=!0,t.globe.baseColor=Cesium.Color.WHITE,t.backgroundColor=Cesium.Color.WHITE,this.boundingSphere_&&t.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this)),this.ol3d.enableAutoRenderLoop()}limitCameraToBoundingSphere(){const t=this.ol3d.getCesiumScene();Fu(t.camera,this.boundingSphere_,this.limitCameraToBoundingSphereRatio)}toggle3d(){return this.load().then(t=>{const i=t.getEnabled(),n=t.getCesiumScene();return i?(console.assert(this.map),vu(this.map,n).then(()=>{t.setEnabled(!1),this.dispatchEvent("toggle")})):(t.setEnabled(!0),this.dispatchEvent("toggle"),Au(n,this.cesiumInitialTilt_))})}set3dWithView(t,i,n,r,o){return this.load().then(a=>{const l=a.getEnabled(),h=a.getCesiumScene().camera,u=Cesium.Cartesian3.fromDegrees(t,i,n),d=Cesium.Math.toRadians(r),g=Cesium.Math.toRadians(o),m={heading:d,pitch:g,roll:0};l||(a.setEnabled(!0),this.dispatchEvent("toggle")),h.setView({destination:u,orientation:m})})}is3dEnabled(){return!!this.ol3d&&this.ol3d.getEnabled()}getHeading(){return this.map&&this.map.getView().getRotation()||0}getTiltOnGlobe(){const t=this.ol3d.getCesiumScene();return-Tu(t)}setHeading(t){const i=this.ol3d.getCesiumScene(),n=Ar(i);n&&Ja(i,t,n)}getOl3d(){return this.ol3d}getCesiumViewMatrix(){return this.ol3d.getCesiumScene().camera.viewMatrix}getCesiumScene(){return this.ol3d.getCesiumScene()}flyToRectangle(t,i=0){const n=this.getCesiumScene().camera,r=n.getRectangleCameraCoordinates(t),o=Cesium.Cartesian3.magnitude(r)+i;return Cesium.Cartesian3.normalize(r,r),Cesium.Cartesian3.multiplyByScalar(r,o,r),new Promise((a,l)=>{if(!this.cameraExtentInRadians){l();return}n.flyTo({destination:r,complete:()=>a(),cancel:()=>l(),endTransform:Cesium.Matrix4.IDENTITY})})}}const ox=Object.freeze(Object.defineProperty({__proto__:null,AbstractSynchronizer:sl,ContribLazyLoader:Bu,ContribManager:gy,FeatureConverter:Gu,MaskDrawer:Kn,OLCSCamera:Mu,OLImageryProvider:Eu,OverlaySynchronizer:Uu,RasterSynchronizer:Ou,VectorLayerCounterpart:Du,VectorSynchronizer:ku,applyHeightOffsetToGeometry:ny,attributionsFunctionToCredits:nl,autoDrawMask:dy,bottomFovRay:Ru,calcDistanceForResolution:Lu,calcResolutionForDistance:Pu,computeAngleToZenith:tl,computeBoundingBoxAtTarget:iy,computePixelSizeAtCoordinate:Cu,computeRectangle:uy,computeSignedTiltAngleOnGlobe:Tu,convertColorToCesium:Uo,convertUrlToCesium:ry,createMatrixAtCoordinates:sy,default:br,extentToRectangle:il,isCesiumProjection:Bo,limitCameraToBoundingSphere:Fu,normalizeView:bu,ol4326CoordinateArrayToCsCartesians:vs,ol4326CoordinateToCesiumCartesian:Yt,olGeometryCloneTo4326:Rn,pickBottomPoint:Ar,pickCenterPoint:wu,pickOnTerrainOrEllipsoid:Qa,resetToNorthZenith:vu,rotateAroundAxis:vr,rotateAroundBottomCenter:Au,setHeadingUsingBottomCenter:Ja,signedAngleBetween:el,sourceToImageryProvider:Su,takeScreenshot:fy,tileLayerToImageryLayer:Iu,updateCesiumLayerProperties:No},Symbol.toStringTag,{value:"Module"}));export{ix as $,xd as A,Fs as B,Ma as C,Yy as D,ie as E,Zt as F,Zs as G,mt as H,Pl as I,as as J,tr as K,yi as L,Vn as M,ir as N,Ky as O,At as P,nr as Q,ft as R,He as S,zh as T,jy as U,Gl as V,wh as W,bt as X,Bm as Y,tx as Z,qt as _,by as a,yy as a$,ex as a0,Jy as a1,Ue as a2,er as a3,me as a4,xe as a5,Cy as a6,$t as a7,As as a8,rd as a9,jf as aA,It as aB,nm as aC,li as aD,Ra as aE,Uy as aF,Xf as aG,bl as aH,sd as aI,je as aJ,ad as aK,Ut as aL,we as aM,wy as aN,ge as aO,bi as aP,zy as aQ,Y as aR,Zo as aS,Ei as aT,mi as aU,qn as aV,dd as aW,Sd as aX,Dn as aY,se as aZ,dr as a_,Dy as aa,Gy as ab,ky as ac,vc as ad,tn as ae,zf as af,Ny as ag,Oy as ah,Cd as ai,fo as aj,Td as ak,xy as al,Ey as am,yd as an,pd as ao,Lf as ap,jo as aq,$ as ar,vt as as,of as at,Oc as au,Z as av,Vf as aw,lt as ax,zo as ay,gn as az,Py as b,sx as b$,Er as b0,Xy as b1,Hn as b2,D as b3,_h as b4,xh as b5,js as b6,om as b7,zs as b8,ae as b9,Ot as bA,nh as bB,pm as bC,Cp as bD,Pe as bE,Rp as bF,Sp as bG,di as bH,qa as bI,xf as bJ,gf as bK,ca as bL,wr as bM,sn as bN,lp as bO,Yp as bP,es as bQ,Ry as bR,ar as bS,Cr as bT,Pc as bU,Sy as bV,sr as bW,Qd as bX,_u as bY,np as bZ,rx as b_,_m as ba,ne as bb,va as bc,Vs as bd,Xs as be,Lc as bf,Vy as bg,Al as bh,Ss as bi,Ay as bj,rf as bk,Ju as bl,Ae as bm,at as bn,gi as bo,Te as bp,lg as bq,J as br,Le as bs,ke as bt,Je as bu,pi as bv,En as bw,Cn as bx,b as by,_i as bz,Fy as c,Ep as c0,nx as c1,$a as c2,T_ as c3,Ji as c4,wa as c5,Pn as c6,Sl as c7,ss as c8,mp as c9,Hy as ca,cp as cb,de as cc,bp as cd,Qy as ce,qy as cf,$y as cg,ox as ch,qs as d,g_ as e,Ht as f,My as g,Rr as h,ia as i,vl as j,Me as k,ye as l,H as m,Iy as n,vy as o,Wy as p,Ty as q,Yn as r,ui as s,Vi as t,Zn as u,he as v,Ly as w,py as x,td as y,Ft as z};
