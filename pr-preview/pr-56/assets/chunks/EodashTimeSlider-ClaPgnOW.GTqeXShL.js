import{u as b,i as M}from"./mosaic-ByH9wgDF.B6VCLG5a.js";import{_ as A,u as k,af as B,k as C,an as T,ba as p,i as c,ak as L}from"./eo-dash.DiOahPOc.js";import"./main.B8cLqrk6.js";import"./main.C4raI1He.js";import{c as V}from"./create-layers-config-BrGl0JJZ.CtyFcVxj.js";import{w as j,c as y,f as I,j as F,o as S,i as v,u as g,g as G}from"./runtime-core.esm-bundler.MgDDUQih.js";import"./item.C4vh4W0H.js";import"./cesium.DzXtLnwn.js";import"./olcs.Cqh799zv.js";import"./runtime-dom.esm-bundler.CVWPxwnJ.js";import"./mdi.C8D1Z8V3.js";import"./addCommonStyleSheet.SqMauTqt.js";import"./dayjs.min.Db6vYW3d.js";import"./when.BR7zwNJC.js";import"./map.DiiNQ3pp.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./getElement.CdRlZPdn.js";import"./index.D6yXn0Ww.js";import"./index.B3SgK6yd.js";import"./static.DvyM9ImY.js";import"./repeat.C5sjkfr2.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.D5ycj-Q3.js";import"./unsafe-html.hV7nDmyB.js";import"./orient2d.DArCjZZA.js";import"./index.2GfG_t-c.js";const N="eox-itemfilter[data-v-936c4bd1]{--inline-container-height: 40px}",P=[".for",".animate",".initDate"],z={class:"d-flex g-10 align-center"},K=[".filters"],U={__name:"EodashTimeSlider",props:{filters:{type:Array,default:()=>[]},animate:{type:Boolean,default:!0},useMosaic:{type:Boolean,default:!0},mosaicIndicators:{type:Array,default:()=>["sentinel-2-l2a"]}},setup(u){const n=u,s=k(),h=G(()=>!n.useMosaic||!s.mosaicEndpoint?!1:!n.mosaicIndicators||!n.mosaicIndicators.length?!0:n.mosaicIndicators.includes(c.value)),m=F(!1);j(c,async()=>{var e,t,a,r;if(await new Promise(i=>setTimeout(i,400)),h.value){m.value=!0,p.value+=1;return}const o=(t=(e=T.value)==null?void 0:e.layers)==null?void 0:t.find(i=>{var f;return((f=i.properties)==null?void 0:f.id)==="AnalysisGroup"});if(!o||!(o!=null&&o.layers.length)){m.value=!1;return}for(const i of o.layers)if((r=(a=i==null?void 0:i.properties)==null?void 0:a.timeControlValues)!=null&&r.length){m.value=!0;return}m.value=!1,p.value+=1},{immediate:!0}),s.mosaicEndpoint&&n.useMosaic&&b(s.mosaicEndpoint,void 0,s,n.mosaicIndicators);let l=[0,0],E="";const _=async o=>{const{date:e}=o.detail,[t,a]=e;if(!(t==l[0]&&a==l[1])){if(E!==c.value&&(setTimeout(()=>{console.log("[eodash] Triggering timeslider update"),p.value+=1},400),E=c.value),l=[t,a],!h.value){C.value=t.toISOString();return}M(s.mosaicEndpoint,{timeRange:[t.toISOString(),a.toISOString()],collection:c.value,cloudCover:d||void 0})}};let d=null;const O=o=>{var a,r;if(!h.value)return;const{filters:e}=o.detail,t=((r=(a=e.find(i=>i.key==="eo:cloud_cover"))==null?void 0:a.state)==null?void 0:r.max)||null;t===null||t===d||[0,100].includes(t)||(d=t,t===100&&(d=null),M(s.mosaicEndpoint,{timeRange:l==null?void 0:l.map(i=>new Date(i).toISOString()),collection:c.value,cloudCover:t}))},{selectedStac:R}=B(k()),D=async o=>{const{generate:e,selectedRangeItems:t}=o.detail,a=await Promise.all(Object.values(t).flatMap(async r=>{const i=[];for(const f of r)await V(R.value,L,f.originalDate).then(x=>{x=w(x),i.push({layers:x,date:f.originalDate})});return i})).then(r=>r.flat());e({mapLayers:a})};function w(o){return o.map(e=>e.type==="Group"?(e.layers=w(e.layers),e):(e.source&&(e.source.crossOrigin="anonymous"),e))}return(o,e)=>m.value?(S(),y("eox-timecontrol",{key:g(p),ref:"eoxTimecontrol",".for":g(T),onSelect:_,titleKey:"title",externalMapRendering:"",".animate":u.animate,".initDate":g(C)},[v("div",z,[e[0]||(e[0]=v("eox-timecontrol-date",{class:"flex-grow-1"},null,-1)),v("eox-timecontrol-picker",{".range":!1,".showDots":!0,".showItems":!0,".popup":!0},null,32),u.filters.length?(S(),y("eox-itemfilter",{key:0,onFilter:O,".inlineMode":!0,showResults:!1,".filters":g(u.filters)},null,40,K)):I("v-if",!0),u.animate?(S(),y("eox-timecontrol-timelapse",{key:1,onExport:D},null,32)):I("v-if",!0)]),e[1]||(e[1]=v("eox-timecontrol-timeline",{class:"mt-2"},null,-1))],40,P)):I("v-if",!0)}},he=A(U,[["styles",[N]],["__scopeId","data-v-936c4bd1"]]);export{he as default};
