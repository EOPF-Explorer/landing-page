const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.DV5BVH5q.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/map.CJAoysws.js","assets/chunks/index.jYV8uuws.js","assets/chunks/Group.BuEEX7y8.js","assets/chunks/Vector.DMLrFA3s.js","assets/chunks/XYZ.DipmalTG.js","assets/chunks/item.Bx-rtsOD.js","assets/chunks/framework.BZlrR07V.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/webimage.CU41Mh7j.js","assets/chunks/proj4.Dg0Z8G9Q.js"])))=>i.map(i=>d[i]);
var Cy=Object.defineProperty;var Ly=(n,e,t)=>e in n?Cy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var me=(n,e,t)=>Ly(n,typeof e!="symbol"?e+"":e,t);import{c5 as Fy,aZ as Mt,b as we,c6 as My,bn as ft,c7 as Oy,c8 as Ny,as as ao,c9 as El,aN as xs,aM as _i,b0 as Wo,G as Fn,aL as Pr,a_ as tr,ca as Ho,cb as Q,cc as Y,cd as z,ce as gu,cf as lo,cg as Dy,ch as Gy,ci as rn,cj as uo,c as Xd,ck as ne,cl as I,cm as Ne,cn as ce,co as Xt,cp as xi,cq as Jr,cr as Ki,cs as Zd,ct as co,cu as ho,cv as X,cw as P,cx as B,cy as qo,cz as Ke,cA as vt,cB as mu,cC as Wd,cD as fo,cE as gn,cF as Uy,bk as Hd,I as Fr,an as Wt,cG as Pe,a$ as By,aO as an,S as mh,cH as Bt,cI as _r,ax as ky,aR as yu,bf as zy,be as $y,bu as po,cJ as jy,bD as Ji,bJ as Vy,cK as Xy,aX as Zy,bV as Tl,cL as yh,bU as Ga,cM as _h,c4 as xh,_ as bn,aY as _u,v as Wy,cN as Hy,cO as qy,bt as Er,ai as Qi,ah as xu,cP as nn,bs as ro,i as ci,N as xt,H as Ve,cQ as hi,cR as ei,cS as Yy,af as Te,D as qd,a4 as _t,J as bu,cT as Ky,T as Jy,E as Ft,br as pe,cU as Eu,bx as ur,cV as Qy,cW as Tu,cX as wl,cY as vl,cZ as ln,c_ as e_,c$ as Sl,Z as Ua,d0 as t_,d1 as Rl,d2 as Yd,d3 as r_,d4 as Hn,bH as n_,bE as bh,d5 as i_,bI as wu,d6 as s_,b7 as Kd,a9 as Ur,d7 as bs,d8 as o_,d9 as a_,da as ye,db as es,dc as ts,dd as Ot,de as Mn,df as kn,dg as l_,dh as ie,di as Eh,dj as u_,bm as c_,bp as h_,dk as Jd,dl as f_,K as rs,n as d_,aG as Es,l as Or,b3 as Qr,dm as p_,ac as un,$ as Yo,aH as vu,u as go,dn as Qd,dp as En,dq as g_,dr as m_,c1 as ep,av as cr,ds as y_,ao as Su,dt as __,bo as x_,am as b_,bg as E_,aF as zr,du as Ts,bX as ws,dv as Ru,g as Pu,bN as tp,Y as T_,bS as w_,aV as Pl,bT as Th,dw as v_,dx as S_,dy as R_,dz as P_,dA as A_,bQ as Au,dB as I_,dC as C_,dD as L_,m as F_,dE as Ba,dF as ns,dG as Ko,dH as M_,b8 as O_,a8 as N_,dI as wh,bl as vh,dJ as Sh,aS as D_,aU as G_,dK as Al,dL as rp,at as Rh,ay as mo,az as np,aA as bi,au as Ph,aB as zn,aC as Iu,dM as U_,dN as ip,bP as B_,a5 as k_,dO as Cu,h as z_,bL as $_,bM as j_,dP as V_,aI as X_,aJ as Z_,dQ as W_,dR as sp,dS as H_,dT as q_,dU as Y_,c3 as K_,b4 as J_,dV as Q_,y as e0,dW as t0,dX as r0,bd as n0,bi as i0,bc as s0,dY as o0}from"./map.CJAoysws.js";import{R as a0}from"./index.jYV8uuws.js";import{u as ct,a8 as wt,y as op,b as Lu,j as cn,G as Fu,l as ap,A as On,C as Nn,i as xr,D as is,v as lp,ap as l0,x as up,h as Mu,Y as ss,p as Sn,M as u0,k as Ei,K as c0,E as Dn,J as h0,ad as f0,ar as Us,af as d0,B as Ou,a7 as cp,au as Ah,ae as p0,a as g0,L as hp,ag as yo,ah as m0}from"./Group.BuEEX7y8.js";import{R as os,G as y0,a as fp,M as dp,c as pp,L as gp,F as mp,C as yp,B as _0,E as x0,H as ka,d as b0,h as E0,D as Ih,Z as T0,r as Ch,g as w0,l as v0,b as Xi,V as Jo,e as S0}from"./Vector.DMLrFA3s.js";import{aW as Qo,ah as Qe,aX as _p,ac as _o,as as R0,aY as ue,P as xp,m as bp,x as Ue,aZ as St,a_ as Ep,aO as P0,aM as A0,a$ as I0,b0 as C0,aR as L0,b1 as Ti,aH as Tp,at as as,ar as Yr,a7 as ls,a6 as wp,b2 as vp,b3 as F0,b4 as Lh,b5 as Fh,b6 as za,B as Nu,b7 as M0,b8 as O0,b9 as Mh,ba as Oh,bb as N0,a4 as xo,v as Rn,au as D0,bc as Il,bd as $a,be as Nh,bf as G0,av as U0,bg as Bs,bh as Sp,bi as B0,bj as k0,bk as z0,aV as ea,bl as Rp,bm as Du,ae as $0,bn as ta,bo as vs,bp as j0,bq as bo,br as V0,bs as X0,bt as Z0,bu as W0,bv as Gu,bw as H0,bx as q0,by as Y0,bz as Dh,bA as Pp,aT as K0,D as Ap,F as ti,u as zi,t as Tn,bB as Ip,bC as Gh,an as J0,z as Q0,A as ex,bD as tx,bE as rx,X as Uh,W as Bh,bF as nx,C as ra,M as Eo,e as ix,ag as kh,bG as sx,bH as ox,bI as ax,V as lx,bJ as Cl,bK as Ll,bL as ux}from"./XYZ.DipmalTG.js";import{S as cx,a as hx,u as Uu,b as Cp,C as Fl,I as To,M as fx,A as ks,c as Ni,i as ja,d as dx,f as px,g as zh}from"./item.Bx-rtsOD.js";import{g as Lp}from"./commonjsHelpers.BosuxZz1.js";import{a5 as $r}from"./framework.BZlrR07V.js";import{p as gx}from"./index.Du0sVlOV.js";function Fp(n,e){const t=(""+n).split("."),r=(""+e).split(".");for(let i=0;i<Math.max(t.length,r.length);i++){const s=parseInt(t[i]||"0",10),o=parseInt(r[i]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function mx(n,e,t,r){const i=document.createElement("script"),s="olc_"+ct(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}let yx=class extends Qo{constructor(e,t,r,i,s){const o=s!==void 0?Qe.IDLE:Qe.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Qe.ERROR):this.state=Qe.LOADED,this.changed()}load(){this.state==Qe.IDLE&&(this.state=Qe.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}};const $h=[];class _x extends _p{constructor(e,t,r,i,s){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=s,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=_o(1,1,$h)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const t=ct(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedPixelRatio:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(R0(this.context_),$h.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let Mp=class extends _p{constructor(e,t,r,i,s,o){super(e,t,o),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==ue.IDLE&&(this.setState(ue.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(ue.ERROR)}setFeatures(e){this.features_=e,this.setState(ue.LOADED)}setLoader(e){this.loader_=e}};class Bu extends cx{constructor(e,t=null,r={},i=[]){super(e,t,r,i)}getAll(){return[]}}class xx extends hx{constructor(e,t=null){super(e,t)}}class Op extends Bu{constructor(e,t=null){const r={collections:i=>i.map(s=>s instanceof Fl?s:new Fl(s))};super(e,t,r)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Uu(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Cp(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Np extends Bu{constructor(e,t=null){const r={features:i=>i.map(s=>s instanceof To?s:new To(s))};super(e,t,r)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Uu(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Cp(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function zs(n,e=!0,t=!1){return e&&(n=fx.stac(n,t)),n.type==="Feature"?new To(n):n.type==="FeatureCollection"?new Np(n):n.type==="Collection"||!n.type&&typeof n.extent<"u"&&typeof n.license<"u"?new Fl(n):!n.type&&Array.isArray(n.collections)?new Op(n):new xx(n)}const bx={Point:vx,LineString:Sx,Polygon:Ix,MultiPoint:Px,MultiLineString:Rx,MultiPolygon:Ax},Ex={Point:Cx,LineString:Lx,Polygon:Fx,MultiPoint:Ox,MultiLineString:Mx,MultiPolygon:Nx};class Tx extends Fy{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,r){const i=e,s=jh(i.geometry,t),o=new Mt;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[r];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const r=e,i=[],s=r.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return jh(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const r=e.spatialReference.wkid;return we("EPSG:"+r)}return null}writeGeometryObject(e,t){return Vh(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={};if(!e.hasProperties())return r.attributes={},r;const i=e.getProperties(),s=e.getGeometry();if(s){r.geometry=Vh(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(r.geometry.spatialReference={wkid:Number(we(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return My(i)?r.attributes={}:r.attributes=i,r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{features:r}}}function jh(n,e){if(!n)return null;let t;if(typeof n.x=="number"&&typeof n.y=="number")t="Point";else if(n.points)t="MultiPoint";else if(n.paths)n.paths.length===1?t="LineString":t="MultiLineString";else if(n.rings){const i=n,s=wi(i),o=wx(i.rings,s);o.length===1?(t="Polygon",n=Object.assign({},n,{rings:o[0]})):(t="MultiPolygon",n=Object.assign({},n,{rings:o}))}const r=bx[t];return ft(r(n),!1,e)}function wx(n,e){const t=[],r=[],i=[];let s,o;for(s=0,o=n.length;s<o;++s)t.length=0,Oy(t,0,n[s],e.length),Ny(t,0,t.length,e.length)?r.push([n[s]]):i.push(n[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=r.length-1;s>=0;s--){const u=r[s][0];if(ao(new El(u).getExtent(),new El(a).getExtent())){r[s].push(a),l=!0;break}}l||r.push([a.reverse()])}return r}function vx(n){let e;return n.m!==void 0&&n.z!==void 0?e=new tr([n.x,n.y,n.z,n.m],"XYZM"):n.z!==void 0?e=new tr([n.x,n.y,n.z],"XYZ"):n.m!==void 0?e=new tr([n.x,n.y,n.m],"XYM"):e=new tr([n.x,n.y]),e}function Sx(n){const e=wi(n);return new Pr(n.paths[0],e)}function Rx(n){const e=wi(n);return new _i(n.paths,e)}function wi(n){let e="XY";return n.hasZ===!0&&n.hasM===!0?e="XYZM":n.hasZ===!0?e="XYZ":n.hasM===!0&&(e="XYM"),e}function Px(n){const e=wi(n);return new Wo(n.points,e)}function Ax(n){const e=wi(n);return new xs(n.rings,e)}function Ix(n){const e=wi(n);return new Fn(n.rings,e)}function Cx(n,e){const t=n.getCoordinates();let r;const i=n.getLayout();if(i==="XYZ")r={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")r={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")r={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")r={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return r}function Ss(n){const e=n.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Lx(n,e){const t=Ss(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:[n.getCoordinates()]}}function Fx(n,e){const t=Ss(n);return{hasZ:t.hasZ,hasM:t.hasM,rings:n.getCoordinates(!1)}}function Mx(n,e){const t=Ss(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:n.getCoordinates()}}function Ox(n,e){const t=Ss(n);return{hasZ:t.hasZ,hasM:t.hasM,points:n.getCoordinates()}}function Nx(n,e){const t=Ss(n),r=n.getCoordinates(!1),i=[];for(let s=0;s<r.length;s++)for(let o=r[s].length-1;o>=0;o--)i.push(r[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function Vh(n,e){const t=Ex[n.getType()];return t(ft(n,!0,e),e)}const Dr="http://www.opengis.net/gml",Dx=/^\s*$/;class Z extends Ho{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Y(this.readFeaturesInternal),featureMembers:Q(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const r=e.localName;let i=null;if(r=="FeatureCollection")i=z([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(r=="featureMembers"||r=="featureMember"||r=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",u="p0";if(!o&&e.childNodes){o=[],a={};for(let f=0,p=e.childNodes.length;f<p;++f){const d=e.childNodes[f];if(d.nodeType===1){const g=d.nodeName.split(":").pop();if(!o.includes(g)){let m="",y=0;const _=d.namespaceURI;for(const x in a){if(a[x]===_){m=x;break}++y}m||(m=l+y,a[m]=_),o.push(m+":"+g)}}}r!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[u]=f}const c={},h=Array.isArray(o)?o:[o];for(const f in a){const p={};for(let d=0,g=h.length;d<g;++d)(h[d].includes(":")?h[d].split(":")[0]:u)===f&&(p[h[d].split(":").pop()]=r=="featureMembers"?Y(this.readFeatureElement,this):Q(this.readFeatureElement,this));c[a[f]]=p}r=="featureMember"||r=="member"?i=z(void 0,c,e,t):i=z([],c,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),z(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?gu(i,r):void 0}readGeometryElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?ft(i,!1,r):void 0}readFeatureElementInternal(e,t,r){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let u;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(u=lo(l,!1),Dx.test(u)&&(u=void 0)):(r&&(u=c==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),u?c!=="boundedBy"&&(i=c):u=this.readFeatureElementInternal(l,t,!1));const h=l.attributes.length;if(h>0&&!(u instanceof Dy)){u={_content_:u};for(let f=0;f<h;f++){const p=l.attributes[f].name;u[p]=l.attributes[f].value}}s[c]?(s[c]instanceof Array||(s[c]=[s[c]]),s[c].push(u)):s[c]=u}if(!r)return s;const o=new Mt(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||Gy(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new tr(r,"XYZ")}readMultiPoint(e,t){const r=z([],this.MULTIPOINT_PARSERS,e,t,this);if(r)return new Wo(r)}readMultiLineString(e,t){const r=z([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new _i(r)}readMultiPolygon(e,t){const r=z([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new xs(r)}pointMemberParser(e,t){rn(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){rn(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){rn(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Pr(r,"XYZ")}readFlatLinearRing(e,t){const r=z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(r)return r}readLinearRing(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new El(r,"XYZ")}readPolygon(e,t){const r=z([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)uo(i,r[o]),s.push(i.length);return new Fn(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null}readFeaturesFromNode(e,t){const r={featureType:this.featureType,featureNS:this.featureNS};return r&&Object.assign(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]}readProjectionFromNode(e){return we(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}Z.prototype.namespace=Dr;Z.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};Z.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};Z.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};Z.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Y(Z.prototype.pointMemberParser),pointMembers:Y(Z.prototype.pointMemberParser)}};Z.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Y(Z.prototype.lineStringMemberParser),lineStringMembers:Y(Z.prototype.lineStringMemberParser)}};Z.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Y(Z.prototype.polygonMemberParser),polygonMembers:Y(Z.prototype.polygonMemberParser)}};Z.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Y(Z.prototype.readFlatCoordinatesFromNode)}};Z.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Y(Z.prototype.readLineString)}};Z.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Y(Z.prototype.readPolygon)}};Z.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(Z.prototype.readFlatLinearRing)}};const Gx=Dr+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Ux={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class le extends Z{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Dr].featureMember=Y(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Gx}readFlatCoordinates(e,t){const r=lo(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const u=we(s);u&&(o=u.getAxisOrientation())}const a=r.trim().split(/\s+/),l=[];for(let u=0,c=a.length;u<c;u++){const h=a[u].split(/,+/),f=parseFloat(h[0]),p=parseFloat(h[1]),d=h.length===3?parseFloat(h[2]):0;o.startsWith("en")?l.push(f,p,d):l.push(p,f,d)}return l}readBox(e,t){const r=z([null],this.BOX_PARSERS_,e,t,this);return Xd(r[1][0],r[1][1],r[1][3],r[1][4])}innerBoundaryIsParser(e,t){const r=z(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}outerBoundaryIsParser(e,t){const r=z(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="MultiLineString"&&a===!0&&(r="MultiCurve")),ne("http://www.opengis.net/gml",r)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const p=h[f];p!=null&&(l.push(f),u.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=I(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=I(ce)))}}const c=Object.assign({},s);c.node=e,Ne(c,s.serializers,Xt(void 0,o),u,r,l)}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}else if(e.nodeName==="Curve"){const o=ne(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Ne({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=gu(t,i):o=ft(t,!0,i),Ne(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}createCoordinatesNode_(e){const t=ne(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,u=new Array(l);for(let c=0;c<l;++c){const h=a[c];u[c]=this.getCoords_(h,o,s)}ce(e,u.join(" "))}writeCurveSegments_(e,t,r){const i=ne(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Ne({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=ne(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),ne(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,r){const i=ne(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeRing(e,t,r){const i=ne(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}getCoords_(e,t,r){let s=(t?we(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(r){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),u=this.getCoords_(l,o,s);ce(a,u)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();Ne({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,Xt("pointMember"),a,r,void 0,this)}writePointMember(e,t,r){const i=ne(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Ne({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Ne({node:e},this.ENVELOPE_SERIALIZERS,xi,a,r,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return ne("http://www.opengis.net/gml",Ux[i.nodeName])}}le.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Q(le.prototype.readFlatCoordinates)}};le.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:le.prototype.innerBoundaryIsParser,outerBoundaryIs:le.prototype.outerBoundaryIsParser}};le.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Y(le.prototype.readFlatCoordinates)}};le.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(Z.prototype.readPoint),MultiPoint:Q(Z.prototype.readMultiPoint),LineString:Q(Z.prototype.readLineString),MultiLineString:Q(Z.prototype.readMultiLineString),LinearRing:Q(Z.prototype.readLinearRing),Polygon:Q(Z.prototype.readPolygon),MultiPolygon:Q(Z.prototype.readMultiPolygon),Box:Q(le.prototype.readBox)}};le.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:I(le.prototype.writeCurveOrLineString),MultiCurve:I(le.prototype.writeMultiCurveOrLineString),Point:I(le.prototype.writePoint),MultiPoint:I(le.prototype.writeMultiPoint),LineString:I(le.prototype.writeCurveOrLineString),MultiLineString:I(le.prototype.writeMultiCurveOrLineString),LinearRing:I(le.prototype.writeLinearRing),Polygon:I(le.prototype.writeSurfaceOrPolygon),MultiPolygon:I(le.prototype.writeMultiSurfaceOrPolygon),Surface:I(le.prototype.writeSurfaceOrPolygon),MultiSurface:I(le.prototype.writeMultiSurfaceOrPolygon),Envelope:I(le.prototype.writeEnvelope)}};le.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:I(le.prototype.writeLineStringOrCurveMember),curveMember:I(le.prototype.writeLineStringOrCurveMember)}};le.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:I(le.prototype.writeRing),innerBoundaryIs:I(le.prototype.writeRing)}};le.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:I(le.prototype.writePointMember)}};le.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:I(le.prototype.writeSurfaceOrPolygonMember),polygonMember:I(le.prototype.writeSurfaceOrPolygonMember)}};le.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:I(ce),upperCorner:I(ce)}};const Bx=Dr+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",kx={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class U extends Z{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Bx,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const r=z([],this.MULTICURVE_PARSERS,e,t,this);if(r)return new _i(r)}readFlatCurveRing(e,t){const r=z([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=r.length;s<o;++s)uo(i,r[s].getFlatCoordinates());return i}readMultiSurface(e,t){const r=z([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new xs(r)}curveMemberParser(e,t){rn(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){rn(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return z([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return z([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return z([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const r=z(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}exteriorParser(e,t){const r=z(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}readSurface(e,t){const r=z([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)uo(i,r[o]),s.push(i.length);return new Fn(i,"XYZ",s)}}readCurve(e,t){const r=z([null],this.CURVE_PARSERS,e,t,this);if(r)return new Pr(r,"XYZ")}readEnvelope(e,t){const r=z([null],this.ENVELOPE_PARSERS,e,t,this);return Xd(r[1][0],r[1][1],r[2][0],r[2][1])}readFlatPos(e,t){let r=lo(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(r);)s.push(parseFloat(o[1])),r=r.substr(o[0].length);if(r!=="")return;const l=t[0].srsName;if((l?we(l).getAxisOrientation():"enu")==="neu")for(let h=0,f=s.length;h<f;h+=3){const p=s[h],d=s[h+1];s[h]=d,s[h+1]=p}const c=s.length;if(c==2&&s.push(0),c!==0)return s}readFlatPosList(e,t){const r=lo(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?we(s).getAxisOrientation():"enu",l=r.split(/\s+/);let u=2;e.getAttribute("srsDimension")?u=Jr(e.getAttribute("srsDimension")):e.getAttribute("dimension")?u=Jr(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?u=Jr(e.parentNode.getAttribute("srsDimension")):o&&(u=Jr(o));const c=a.startsWith("en");let h,f,p;const d=[];for(let g=0,m=l.length;g<m;g+=u)h=parseFloat(l[g]),f=parseFloat(l[g+1]),p=u===3?parseFloat(l[g+2]):0,c?d.push(h,f,p):d.push(f,h,p);return d}writePos_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=a?we(a).getAxisOrientation():"enu",u=t.getCoordinates();let c=l.startsWith("en")?u[0]+" "+u[1]:u[1]+" "+u[0];if(s){const h=u[2]||0;c+=" "+h}ce(e,c)}getCoords_(e,t,r){let s=(t?we(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(r){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),u=l.length,c=new Array(u);let h;for(let f=0;f<u;++f)h=l[f],c[f]=this.getCoords_(h,a,s);ce(e,c.join(" "))}writePoint(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ne(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,r)}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Ne({node:e},this.ENVELOPE_SERIALIZERS,xi,a,r,o,this)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ne(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),ne(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Ne({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=ne(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=ne(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}else if(e.nodeName==="Curve"){const o=ne(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Ne({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();Ne({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,Xt("pointMember"),a,r,void 0,this)}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Ne({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeRing(e,t,r){const i=ne(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writePointMember(e,t,r){const i=ne(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeSurfacePatches_(e,t,r){const i=ne(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeCurveSegments_(e,t,r){const i=ne(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=gu(t,i):o=ft(t,!0,i),Ne(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const p=h[f];p!=null&&(l.push(f),u.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=I(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=I(ce)))}}const c=Object.assign({},s);c.node=e,Ne(c,s.serializers,Xt(void 0,o),u,r,l)}writeFeatureMembers_(e,t,r){const i=r[r.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=I(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,Ne(l,a,Xt(s,o),t,r)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return ne(this.namespace,kx[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="LineString"&&a===!0?r="Curve":r==="MultiLineString"&&l===!0&&(r="MultiCurve")),ne(this.namespace,r)}writeGeometryNode(e,t){t=this.adaptOptions(t);const r=ne(this.namespace,"geom"),i={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(r,e,[i]),r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=ne(this.namespace,"featureMembers");r.setAttributeNS(Ki,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(r,e,[i]),r}}U.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Q(U.prototype.readFlatPos),posList:Q(U.prototype.readFlatPosList),coordinates:Q(le.prototype.readFlatCoordinates)}};U.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:U.prototype.interiorParser,exterior:U.prototype.exteriorParser}};U.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(Z.prototype.readPoint),MultiPoint:Q(Z.prototype.readMultiPoint),LineString:Q(Z.prototype.readLineString),MultiLineString:Q(Z.prototype.readMultiLineString),LinearRing:Q(Z.prototype.readLinearRing),Polygon:Q(Z.prototype.readPolygon),MultiPolygon:Q(Z.prototype.readMultiPolygon),Surface:Q(U.prototype.readSurface),MultiSurface:Q(U.prototype.readMultiSurface),Curve:Q(U.prototype.readCurve),MultiCurve:Q(U.prototype.readMultiCurve),Envelope:Q(U.prototype.readEnvelope)}};U.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Y(U.prototype.curveMemberParser),curveMembers:Y(U.prototype.curveMemberParser)}};U.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Y(U.prototype.surfaceMemberParser),surfaceMembers:Y(U.prototype.surfaceMemberParser)}};U.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Y(Z.prototype.readLineString),Curve:Y(U.prototype.readCurve)}};U.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Y(Z.prototype.readPolygon),Surface:Y(U.prototype.readSurface)}};U.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Q(U.prototype.readPatch)}};U.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Q(U.prototype.readSegment)}};U.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Y(U.prototype.readFlatPosList),upperCorner:Y(U.prototype.readFlatPosList)}};U.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Q(U.prototype.readPolygonPatch)}};U.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Zd(U.prototype.readLineStringSegment)}};Z.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(Z.prototype.readFlatLinearRing),Ring:Q(U.prototype.readFlatCurveRing)}};U.prototype.writeFeatures;U.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:I(U.prototype.writeRing),interior:I(U.prototype.writeRing)}};U.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:I(ce),upperCorner:I(ce)}};U.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:I(U.prototype.writeSurfaceOrPolygonMember),polygonMember:I(U.prototype.writeSurfaceOrPolygonMember)}};U.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:I(U.prototype.writePointMember)}};U.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:I(U.prototype.writeLineStringOrCurveMember),curveMember:I(U.prototype.writeLineStringOrCurveMember)}};U.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:I(U.prototype.writeCurveOrLineString),MultiCurve:I(U.prototype.writeMultiCurveOrLineString),Point:I(U.prototype.writePoint),MultiPoint:I(U.prototype.writeMultiPoint),LineString:I(U.prototype.writeCurveOrLineString),MultiLineString:I(U.prototype.writeMultiCurveOrLineString),LinearRing:I(U.prototype.writeLinearRing),Polygon:I(U.prototype.writeSurfaceOrPolygon),MultiPolygon:I(U.prototype.writeMultiSurfaceOrPolygon),Surface:I(U.prototype.writeSurfaceOrPolygon),MultiSurface:I(U.prototype.writeMultiSurfaceOrPolygon),Envelope:I(U.prototype.writeEnvelope)}};const ku=U;ku.prototype.writeFeatures;ku.prototype.writeFeaturesNode;const $e=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],zx="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",$x={rte:Dp,trk:Gp,wpt:Up},jx=X($e,{rte:Y(Dp),trk:Y(Gp),wpt:Y(Up)}),Vx=X($e,{text:P(B,"linkText"),type:P(B,"linkType")}),Xx=X($e,{name:P(B),email:_b,link:Rs}),Zx=X($e,{name:P(B),desc:P(B),author:P(gb),copyright:P(mb),link:Rs,time:P(qo),keywords:P(B),bounds:yb,extensions:na}),Wx=X($e,{year:P(Ke),license:P(B)}),Hx=X($e,{rte:I(Tb),trk:I(wb),wpt:I(Sb)});class qx extends Ho{constructor(e){super(),e=e||{},this.dataProjection=we("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(co(e)):ho(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const r=this.readMetadataFromNode(t);if(r)return r}return null}readMetadataFromNode(e){if(!$e.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if($e.includes(t.namespaceURI)&&t.localName==="metadata")return z({},Zx,t,[]);return null}readFeatureFromNode(e,t){if(!$e.includes(e.namespaceURI))return null;const r=$x[e.localName];if(!r)return null;const i=r(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!$e.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const r=z([],jx,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=ne("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ki),r.setAttributeNS(Ki,"xsi:schemaLocation",zx),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),Ne({node:r},Hx,pb,e,[t]),r}}const Yx=X($e,{name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Rs,number:P(Ke),extensions:na,type:P(B),rtept:xb}),Kx=X($e,{ele:P(vt),time:P(qo)}),Jx=X($e,{name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Rs,number:P(Ke),type:P(B),extensions:na,trkseg:Eb}),Qx=X($e,{trkpt:bb}),eb=X($e,{ele:P(vt),time:P(qo)}),tb=X($e,{ele:P(vt),time:P(qo),magvar:P(vt),geoidheight:P(vt),name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Rs,sym:P(B),type:P(B),fix:P(B),sat:P(Ke),hdop:P(vt),vdop:P(vt),pdop:P(vt),ageofdgpsdata:P(vt),dgpsid:P(Ke),extensions:na}),rb=["text","type"],nb=X($e,{text:I(ce),type:I(ce)}),ib=X($e,["name","cmt","desc","src","link","number","type","rtept"]),sb=X($e,{name:I(ce),cmt:I(ce),desc:I(ce),src:I(ce),link:I(ju),number:I(fo),type:I(ce),rtept:Wd(I(Vu))}),ob=X($e,["ele","time"]),ab=X($e,["name","cmt","desc","src","link","number","type","trkseg"]),lb=X($e,{name:I(ce),cmt:I(ce),desc:I(ce),src:I(ce),link:I(ju),number:I(fo),type:I(ce),trkseg:Wd(I(vb))}),ub=Xt("trkpt"),cb=X($e,{trkpt:I(Vu)}),hb=X($e,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),fb=X($e,{ele:I(gn),time:I(Uy),magvar:I(gn),geoidheight:I(gn),name:I(ce),cmt:I(ce),desc:I(ce),src:I(ce),link:I(ju),sym:I(ce),type:I(ce),fix:I(ce),sat:I(fo),hdop:I(gn),vdop:I(gn),pdop:I(gn),ageofdgpsdata:I(gn),dgpsid:I(fo)}),db={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function pb(n,e,t){const r=n.getGeometry();if(r){const i=db[r.getType()];if(i){const s=e[e.length-1].node;return ne(s.namespaceURI,i)}}}function zu(n,e,t,r){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in r?(n.push(r.ele),delete r.ele,e.hasZ=!0):n.push(0),"time"in r?(n.push(r.time),delete r.time,e.hasM=!0):n.push(0),n}function $u(n,e,t){let r="XY",i=2;if(n.hasZ&&n.hasM?(r="XYZM",i=4):n.hasZ?(r="XYZ",i=3):n.hasM&&(r="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],n.hasZ&&(e[s*i+2]=e[s*4+2]),n.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return r}function gb(n,e){const t=z({},Xx,n,e);if(t)return t}function mb(n,e){const t=z({},Wx,n,e);if(t){const r=n.getAttribute("author");return r!==null&&(t.author=r),t}}function yb(n,e){const t=e[e.length-1],r=n.getAttribute("minlat"),i=n.getAttribute("minlon"),s=n.getAttribute("maxlat"),o=n.getAttribute("maxlon");i!==null&&r!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(r)],[parseFloat(o),parseFloat(s)]])}function _b(n,e){const t=e[e.length-1],r=n.getAttribute("id"),i=n.getAttribute("domain");r!==null&&i!==null&&(t.email=`${r}@${i}`)}function Rs(n,e){const t=e[e.length-1],r=n.getAttribute("href");r!==null&&(t.link=r),rn(Vx,n,e)}function na(n,e){const t=e[e.length-1];t.extensionsNode_=n}function xb(n,e){const t=z({},Kx,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;zu(i,s,n,t)}}function bb(n,e){const t=z({},eb,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;zu(i,s,n,t)}}function Eb(n,e){const t=e[e.length-1];rn(Qx,n,e);const r=t.flatCoordinates;t.ends.push(r.length)}function Dp(n,e){const t=e[0],r=z({flatCoordinates:[],layoutOptions:{}},Yx,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.layoutOptions;delete r.layoutOptions;const o=$u(s,i),a=new Pr(i,o);ft(a,!1,t);const l=new Mt(a);return l.setProperties(r,!0),l}function Gp(n,e){const t=e[0],r=z({flatCoordinates:[],ends:[],layoutOptions:{}},Jx,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.ends;delete r.ends;const o=r.layoutOptions;delete r.layoutOptions;const a=$u(o,i,s),l=new _i(i,a,s);ft(l,!1,t);const u=new Mt(l);return u.setProperties(r,!0),u}function Up(n,e){const t=e[0],r=z({},tb,n,e);if(!r)return;const i={},s=zu([],i,n,r),o=$u(i,s),a=new tr(s,o);ft(a,!1,t);const l=new Mt(a);return l.setProperties(r,!0),l}function ju(n,e,t){n.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];Ne({node:n},nb,xi,s,t,rb)}function Vu(n,e,t){const r=t[t.length-1],s=r.node.namespaceURI,o=r.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),r.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=n.nodeName=="rtept"?ob[s]:hb[s],u=mu(o,l);Ne({node:n,properties:o},fb,xi,u,t,l)}function Tb(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const c=ft(o,!0,r);s.geometryLayout=c.getLayout(),i.rtept=c.getCoordinates()}const a=t[t.length-1].node,l=ib[a.namespaceURI],u=mu(i,l);Ne(s,sb,xi,u,t,l)}function wb(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const c=ft(o,!0,r);i.trkseg=c.getLineStrings()}const a=t[t.length-1].node,l=ab[a.namespaceURI],u=mu(i,l);Ne(s,lb,xi,u,t,l)}function vb(n,e,t){const r={node:n};r.geometryLayout=e.getLayout(),r.properties={},Ne(r,cb,ub,e.getCoordinates(),t)}function Sb(n,e,t){const r=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=ft(s,!0,r);i.geometryLayout=o.getLayout(),Vu(n,o.getCoordinates(),t)}}class Xu extends Hd{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText($s(e),this.adaptOptions(t))}readFeatureFromText(e,t){return Fr()}readFeatures(e,t){return this.readFeaturesFromText($s(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return Fr()}readGeometry(e,t){return this.readGeometryFromText($s(e),this.adaptOptions(t))}readGeometryFromText(e,t){return Fr()}readProjection(e){return this.readProjectionFromText($s(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return Fr()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return Fr()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return Fr()}}function $s(n){return typeof n=="string"?n:""}const Rb=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Pb=/^H.([A-Z]{3}).*?:(.*)/,Ab=/^HFDTE(\d{2})(\d{2})(\d{2})/,Ib=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,Cb=/\r\n|\r|\n/;class Lb extends Xu{constructor(e){super(),e=e||{},this.dataProjection=we("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const r=this.altitudeMode_,i=e.split(Cb),s={},o=[];let a=2e3,l=0,u=1,c=-1,h,f;for(h=0,f=i.length;h<f;++h){const m=i[h];let y;if(m.charAt(0)=="B"){if(y=Rb.exec(m),y){const _=parseInt(y[1],10),x=parseInt(y[2],10),T=parseInt(y[3],10);let b=parseInt(y[4],10)+parseInt(y[5],10)/6e4;this.lad_&&(b+=parseInt(m.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),y[6]=="S"&&(b=-b);let E=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(this.lod_&&(E+=parseInt(m.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),y[9]=="W"&&(E=-E),o.push(E,b),r!="none"){let S;r=="gps"?S=parseInt(y[11],10):r=="barometric"?S=parseInt(y[12],10):S=0,o.push(S)}let w=Date.UTC(a,l,u,_,x,T);w<c&&(w=Date.UTC(a,l,u+1,_,x,T)),o.push(w/1e3),c=w}}else if(m.charAt(0)=="H")y=Ib.exec(m),y?(u=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=Ab.exec(m),y?(u=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=Pb.exec(m),y&&(s[y[1]]=y[2].trim())));else if(m.charAt(0)=="I"){const _=parseInt(m.slice(1,3),10);for(let x=0;x<_;x++){const T=m.slice(7+x*7,10+x*7);if(T==="LAD"||T==="LOD"){const b=parseInt(m.slice(3+x*7,5+x*7),10)-1,E=parseInt(m.slice(5+x*7,7+x*7),10);T==="LAD"?(this.lad_=!0,this.ladStart_=b,this.ladStop_=E):T==="LOD"&&(this.lod_=!0,this.lodStart_=b,this.lodStop_=E)}}}}if(o.length===0)return null;const p=r=="none"?"XYM":"XYZM",d=new Pr(o,p),g=new Mt(ft(d,!1,t));return g.setProperties(s,!0),g}readFeaturesFromText(e,t){const r=this.readFeatureFromText(e,t);return r?[r]:[]}}const et={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Gn={};Gn[et.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Gn[et.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Gn[et.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Gn.none={none:{supports:[],formats:[],qualities:[]}};const Fb=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Xh=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Mb=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Ob(n){let e=n.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Gn[et.VERSION1].level0),{url:n.imageInfo["@id"]===void 0?void 0:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,n.imageInfo.formats===void 0?[]:n.imageInfo.formats],qualities:[...e.qualities,n.imageInfo.qualities===void 0?[]:n.imageInfo.qualities],resolutions:n.imageInfo.scale_factors,tileSize:n.imageInfo.tile_width!==void 0?n.imageInfo.tile_height!==void 0?[n.imageInfo.tile_width,n.imageInfo.tile_height]:[n.imageInfo.tile_width,n.imageInfo.tile_width]:n.imageInfo.tile_height!=null?[n.imageInfo.tile_height,n.imageInfo.tile_height]:void 0}}function Nb(n){const e=n.getComplianceLevelSupportedFeatures(),t=Array.isArray(n.imageInfo.profile)&&n.imageInfo.profile.length>1,r=t&&n.imageInfo.profile[1].supports?n.imageInfo.profile[1].supports:[],i=t&&n.imageInfo.profile[1].formats?n.imageInfo.profile[1].formats:[],s=t&&n.imageInfo.profile[1].qualities?n.imageInfo.profile[1].qualities:[];return{url:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(o){return o.width})[0],n.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...r],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function Db(n){const e=n.getComplianceLevelSupportedFeatures(),t=n.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...n.imageInfo.extraFormats],r=n.imageInfo.preferredFormats!==void 0&&Array.isArray(n.imageInfo.preferredFormats)&&n.imageInfo.preferredFormats.length>0?n.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:n.imageInfo.id,sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(i){return i.width})[0],n.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:n.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...n.imageInfo.extraFeatures],formats:t,qualities:n.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...n.imageInfo.extraQualities],preferredFormat:r}}const ia={};ia[et.VERSION1]=Ob;ia[et.VERSION2]=Nb;ia[et.VERSION3]=Db;class Gb{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return et.VERSION1;case"http://iiif.io/api/image/2/context.json":return et.VERSION2;case"http://iiif.io/api/image/3/context.json":return et.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(et.VERSION1)&&this.imageInfo.identifier)return et.VERSION1;break}Wt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case et.VERSION1:if(Fb.test(this.imageInfo.profile))return this.imageInfo.profile;break;case et.VERSION3:if(Mb.test(this.imageInfo.profile))return this.imageInfo.profile;break;case et.VERSION2:if(typeof this.imageInfo.profile=="string"&&Xh.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Xh.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const r=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(r)?r[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Gn.none.none:Gn[e][t]}getTileSourceOptions(e){const t=e||{},r=this.getImageApiVersion();if(r===void 0)return;const i=r===void 0?void 0:ia[r](this);if(i!==void 0)return{url:i.url,version:r,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}let Zu=class{read(e){if(!e)return null;if(typeof e=="string"){const t=co(e);return this.readFromDocument(t)}return ho(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Fr()}};const Ub="http://www.w3.org/1999/xlink";function vi(n){return n.getAttributeNS(Ub,"href")}const Nt=[null,"http://www.opengis.net/ows/1.1"],Bb=X(Nt,{ServiceIdentification:P(uE),ServiceProvider:P(hE),OperationsMetadata:P(aE)});let Bp=class extends Zu{constructor(){super()}readFromNode(e){const t=z({},Bb,e,[]);return t||null}};const kb=X(Nt,{DeliveryPoint:P(B),City:P(B),AdministrativeArea:P(B),PostalCode:P(B),Country:P(B),ElectronicMailAddress:P(B)}),zb=X(Nt,{Value:Pe(fE)}),$b=X(Nt,{AllowedValues:P(eE)}),jb=X(Nt,{Phone:P(lE),Address:P(Qb)}),Vb=X(Nt,{HTTP:P(sE)}),Xb=X(Nt,{Get:Pe(iE),Post:void 0}),Zb=X(Nt,{DCP:P(nE)}),Wb=X(Nt,{Operation:oE}),Hb=X(Nt,{Voice:P(B),Facsimile:P(B)}),qb=X(Nt,{Constraint:Pe(tE)}),Yb=X(Nt,{IndividualName:P(B),PositionName:P(B),ContactInfo:P(rE)}),Kb=X(Nt,{Abstract:P(B),AccessConstraints:P(B),Fees:P(B),Title:P(B),ServiceTypeVersion:P(B),ServiceType:P(B)}),Jb=X(Nt,{ProviderName:P(B),ProviderSite:P(vi),ServiceContact:P(cE)});function Qb(n,e){return z({},kb,n,e)}function eE(n,e){return z({},zb,n,e)}function tE(n,e){const t=n.getAttribute("name");if(t)return z({name:t},$b,n,e)}function rE(n,e){return z({},jb,n,e)}function nE(n,e){return z({},Vb,n,e)}function iE(n,e){const t=vi(n);if(t)return z({href:t},qb,n,e)}function sE(n,e){return z({},Xb,n,e)}function oE(n,e){const t=n.getAttribute("name"),r=z({},Zb,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function aE(n,e){return z({},Wb,n,e)}function lE(n,e){return z({},Hb,n,e)}function uE(n,e){return z({},Kb,n,e)}function cE(n,e){return z({},Yb,n,e)}function hE(n,e){return z({},Jb,n,e)}function fE(n,e){return B(n)}function Zh(n,e,t,r,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=n[o++];i[s++]=n[o++],i[s++]=a;for(let l=2;l<r;++l)i[s++]=n[o++]}return i.length=s,i}class dE extends Xu{constructor(e){super(),e=e||{},this.dataProjection=we("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t);return new Mt(r)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const r=By(this.geometryLayout_),i=gE(e,r,this.factor_);Zh(i,0,i.length,r,i);const s=new Pr(i,this.geometryLayout_);return ft(s,!1,this.adaptOptions(t))}writeFeatureText(e,t){const r=e.getGeometry();if(r)return this.writeGeometryText(r,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=ft(e,!0,this.adaptOptions(t));const r=e.getFlatCoordinates(),i=e.getStride();return Zh(r,0,r.length,i,r),pE(r,i,this.factor_)}}function pE(n,e,t){t=t||1e5;const r=new Array(e).fill(0);for(let i=0,s=n.length;i<s;)for(let o=0;o<e;++o,++i){const a=n[i]*t,l=a<0?Math.ceil(a-.5):Math.round(a),u=l-r[o];r[o]=l,n[i]=u}return mE(n)}function gE(n,e,t){t=t||1e5;const r=new Array(e).fill(0),i=yE(n);for(let s=0,o=i.length;s<o;)for(let a=0;a<e;++a,++s)r[a]+=i[s],i[s]=r[a]/t;return i}function mE(n){for(let e=0,t=n.length;e<t;++e){const r=n[e];n[e]=r<0?~(r<<1):r<<1}return _E(n)}function yE(n){const e=xE(n);for(let t=0,r=e.length;t<r;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function _E(n){let e="";for(let t=0,r=n.length;t<r;++t)e+=bE(n[t]);return e}function xE(n){const e=[];let t=0,r=0;for(let i=0,s=n.length;i<s;++i){const o=n.charCodeAt(i)-63;t|=(o&31)<<r,o<32?(e.push(t),t=0,r=0):r+=5}return e}function bE(n){let e,t="";for(;n>=32;)e=(32|n&31)+63,t+=String.fromCharCode(e),n>>=5;return e=n+63,t+=String.fromCharCode(e),t}class xe extends U{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,r){const i=r[r.length-1];r[r.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,r)}}xe.prototype.namespace="http://www.opengis.net/gml/3.2";xe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Q(U.prototype.readFlatPos),posList:Q(U.prototype.readFlatPosList),coordinates:Q(le.prototype.readFlatCoordinates)}};xe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:U.prototype.interiorParser,exterior:U.prototype.exteriorParser}};xe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Q(Z.prototype.readPoint),MultiPoint:Q(Z.prototype.readMultiPoint),LineString:Q(Z.prototype.readLineString),MultiLineString:Q(Z.prototype.readMultiLineString),LinearRing:Q(Z.prototype.readLinearRing),Polygon:Q(Z.prototype.readPolygon),MultiPolygon:Q(Z.prototype.readMultiPolygon),Surface:Q(xe.prototype.readSurface),MultiSurface:Q(U.prototype.readMultiSurface),Curve:Q(xe.prototype.readCurve),MultiCurve:Q(U.prototype.readMultiCurve),Envelope:Q(xe.prototype.readEnvelope)}};xe.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Y(U.prototype.curveMemberParser),curveMembers:Y(U.prototype.curveMemberParser)}};xe.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Y(U.prototype.surfaceMemberParser),surfaceMembers:Y(U.prototype.surfaceMemberParser)}};xe.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Y(Z.prototype.readLineString),Curve:Y(U.prototype.readCurve)}};xe.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Y(Z.prototype.readPolygon),Surface:Y(U.prototype.readSurface)}};xe.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Q(U.prototype.readPatch)}};xe.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Q(U.prototype.readSegment)}};xe.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Y(U.prototype.readFlatPosList),upperCorner:Y(U.prototype.readFlatPosList)}};xe.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Q(U.prototype.readPolygonPatch)}};xe.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Zd(U.prototype.readLineStringSegment)}};xe.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Y(Z.prototype.pointMemberParser),pointMembers:Y(Z.prototype.pointMemberParser)}};xe.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Y(Z.prototype.lineStringMemberParser),lineStringMembers:Y(Z.prototype.lineStringMemberParser)}};xe.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Y(Z.prototype.polygonMemberParser),polygonMembers:Y(Z.prototype.polygonMemberParser)}};xe.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Y(Z.prototype.readFlatCoordinatesFromNode)}};xe.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Y(Z.prototype.readLineString)}};xe.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Y(Z.prototype.readPolygon)}};xe.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Q(Z.prototype.readFlatLinearRing),Ring:Q(xe.prototype.readFlatCurveRing)}};xe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:I(U.prototype.writeRing),interior:I(U.prototype.writeRing)}};xe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:I(ce),upperCorner:I(ce)}};xe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:I(U.prototype.writeSurfaceOrPolygonMember),polygonMember:I(U.prototype.writeSurfaceOrPolygonMember)}};xe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:I(U.prototype.writePointMember)}};xe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:I(U.prototype.writeLineStringOrCurveMember),curveMember:I(U.prototype.writeLineStringOrCurveMember)}};xe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:I(U.prototype.writeCurveOrLineString),MultiCurve:I(U.prototype.writeMultiCurveOrLineString),Point:I(xe.prototype.writePoint),MultiPoint:I(U.prototype.writeMultiPoint),LineString:I(U.prototype.writeCurveOrLineString),MultiLineString:I(U.prototype.writeMultiCurveOrLineString),LinearRing:I(U.prototype.writeLinearRing),Polygon:I(U.prototype.writeSurfaceOrPolygon),MultiPolygon:I(U.prototype.writeMultiSurfaceOrPolygon),Surface:I(U.prototype.writeSurfaceOrPolygon),MultiSurface:I(U.prototype.writeMultiSurfaceOrPolygon),Envelope:I(U.prototype.writeEnvelope)}};class kp{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class EE extends kp{constructor(e,t){super(e),this.conditions=t,Wt(this.conditions.length>=2,"At least 2 conditions are required")}}class TE extends EE{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class wE extends kp{constructor(e,t,r){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=r}}function vE(n){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TE,e))}function SE(n,e,t){return new wE(n,e,t)}const Wh={"http://www.opengis.net/gml":{boundedBy:P(Z.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Y(Z.prototype.readFeaturesInternal)}},RE={"http://www.opengis.net/wfs":{totalInserted:P(Ke),totalUpdated:P(Ke),totalDeleted:P(Ke)},"http://www.opengis.net/wfs/2.0":{totalInserted:P(Ke),totalUpdated:P(Ke),totalDeleted:P(Ke)}},PE={"http://www.opengis.net/wfs":{TransactionSummary:P(qh,"transactionSummary"),InsertResults:P(Kh,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:P(qh,"transactionSummary"),InsertResults:P(Kh,"insertIds")}},AE={"http://www.opengis.net/wfs":{PropertyName:I(ce)},"http://www.opengis.net/wfs/2.0":{PropertyName:I(ce)}},zp={"http://www.opengis.net/wfs":{Insert:I(Jh),Update:I(ef),Delete:I(Qh),Property:I(tf),Native:I(rf)},"http://www.opengis.net/wfs/2.0":{Insert:I(Jh),Update:I(ef),Delete:I(Qh),Property:I(tf),Native:I(rf)}},$p="feature",Wu="http://www.w3.org/2000/xmlns/",Hu={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Ml={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},qu={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Hh={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Yu={"2.0.0":xe,"1.1.0":U,"1.0.0":le},IE="1.1.0";class CE extends Ho{constructor(e){super(),e=e||{},this.version_=e.version?e.version:IE,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Yu[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Hh[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const i=[r];let s;this.version_==="2.0.0"?s=Wh:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=z([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=co(e);return this.readTransactionResponseFromDocument(t)}return ho(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=co(e);return this.readFeatureCollectionMetadataFromDocument(t)}return ho(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=Jr(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,z(t,Wh,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return z({},PE,e,[])}writeGetFeature(e){const t=ne(Ml[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Ki,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Wt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(Wt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),df(t,e.featureTypes,[r])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:i.geometryName,filter:s}),df(t,[i.name],[r])});return t}combineBboxAndFilter(e,t,r,i){const s=SE(e,t,r);return i?vE(i,s):s}writeTransaction(e,t,r,i){const s=[],o=i.version?i.version:this.version_,a=ne(Ml[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Ki,"xsi:schemaLocation",Hh[o]);const u=LE(a,l,o,i);return e&&js("Insert",e,s,u),t&&js("Update",t,s,u),r&&js("Delete",r,s,u),i.nativeElements&&js("Native",i.nativeElements,s,u),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const r=[{}];return this.gmlFormat_.readGeometryElement(t,r),we(r.pop().srsName)}}return null}}function LE(n,e,t,r){const i=r.featurePrefix?r.featurePrefix:$p;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:n},{version:t,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:i,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},e)}function js(n,e,t,r){Ne(r,zp,Xt(n),e,t)}function qh(n,e){return z({},RE,n,e)}const FE={"http://www.opengis.net/ogc":{FeatureId:Y(function(n,e){return n.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:Y(function(n,e){return n.getAttribute("fid")})}};function Yh(n,e){rn(FE,n,e)}const ME={"http://www.opengis.net/wfs":{Feature:Yh},"http://www.opengis.net/wfs/2.0":{Feature:Yh}};function Kh(n,e){return z([],ME,n,e)}function Jh(n,e,t){const r=t[t.length-1],i=r.featureType,s=r.featureNS,o=r.gmlVersion,a=ne(s,i);n.appendChild(a),o===2?le.prototype.writeFeatureElement(a,e,t):o===3?U.prototype.writeFeatureElement(a,e,t):xe.prototype.writeFeatureElement(a,e,t)}function jp(n,e,t){const i=t[t.length-1].version,s=Hu[i],o=ne(s,"Filter"),a=ne(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),n.appendChild(o)}function Ku(n,e){n=n||$p;const t=n+":";return e.startsWith(t)?e:t+e}function Qh(n,e,t){const r=t[t.length-1];Wt(e.getId()!==void 0,"Features must have an id set");const i=r.featureType,s=r.featurePrefix,o=r.featureNS,a=Ku(s,i);n.setAttribute("typeName",a),n.setAttributeNS(Wu,"xmlns:"+s,o);const l=e.getId();l!==void 0&&jp(n,l,t)}function ef(n,e,t){const r=t[t.length-1];Wt(e.getId()!==void 0,"Features must have an id set");const i=r.version,s=r.featureType,o=r.featurePrefix,a=r.featureNS,l=Ku(o,s),u=e.getGeometryName();n.setAttribute("typeName",l),n.setAttributeNS(Wu,"xmlns:"+o,a);const c=e.getId();if(c!==void 0){const h=e.getKeys(),f=[];for(let p=0,d=h.length;p<d;p++){const g=e.get(h[p]);if(g!==void 0){let m=h[p];g&&typeof g.getSimplifiedGeometry=="function"&&(m=u),f.push({name:m,value:g})}}Ne({version:i,gmlVersion:r.gmlVersion,node:n,hasZ:r.hasZ,srsName:r.srsName},zp,Xt("Property"),f,t),jp(n,c,t)}}function tf(n,e,t){const r=t[t.length-1],i=r.version,s=Ml[i],a=ne(s,i==="2.0.0"?"ValueReference":"Name"),l=r.gmlVersion;if(n.appendChild(a),ce(a,e.name),e.value!==void 0&&e.value!==null){const u=ne(s,"Value");n.appendChild(u),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?le.prototype.writeGeometryElement(u,e.value,t):l===3?U.prototype.writeGeometryElement(u,e.value,t):xe.prototype.writeGeometryElement(u,e.value,t):ce(u,e.value)}}function rf(n,e,t){e.vendorId&&n.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&n.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ce(n,e.value)}const sa={"http://www.opengis.net/wfs":{Query:I(nf)},"http://www.opengis.net/wfs/2.0":{Query:I(nf)},"http://www.opengis.net/ogc":{During:I(af),And:I(Vs),Or:I(Vs),Not:I(lf),BBOX:I(sf),Contains:I(Hr),Intersects:I(Hr),Within:I(Hr),DWithin:I(of),PropertyIsEqualTo:I(Yt),PropertyIsNotEqualTo:I(Yt),PropertyIsLessThan:I(Yt),PropertyIsLessThanOrEqualTo:I(Yt),PropertyIsGreaterThan:I(Yt),PropertyIsGreaterThanOrEqualTo:I(Yt),PropertyIsNull:I(uf),PropertyIsBetween:I(cf),PropertyIsLike:I(hf)},"http://www.opengis.net/fes/2.0":{During:I(af),And:I(Vs),Or:I(Vs),Not:I(lf),BBOX:I(sf),Contains:I(Hr),Disjoint:I(Hr),Intersects:I(Hr),ResourceId:I(NE),Within:I(Hr),DWithin:I(of),PropertyIsEqualTo:I(Yt),PropertyIsNotEqualTo:I(Yt),PropertyIsLessThan:I(Yt),PropertyIsLessThanOrEqualTo:I(Yt),PropertyIsGreaterThan:I(Yt),PropertyIsGreaterThanOrEqualTo:I(Yt),PropertyIsNull:I(uf),PropertyIsBetween:I(cf),PropertyIsLike:I(hf)}};function nf(n,e,t){const r=t[t.length-1],i=r.version,s=r.featurePrefix,o=r.featureNS,a=r.propertyNames,l=r.srsName;let u;s?u=Ku(s,e):u=e;let c;i==="2.0.0"?c="typeNames":c="typeName",n.setAttribute(c,u),l&&n.setAttribute("srsName",l),o&&n.setAttributeNS(Wu,"xmlns:"+s,o);const h=Object.assign({},r);h.node=n,Ne(h,AE,Xt("PropertyName"),a,t);const f=r.filter;if(f){const p=ne(oa(i),"Filter");n.appendChild(p),OE(p,f,t)}}function OE(n,e,t){const r=t[t.length-1],i={node:n};Object.assign(i,{context:r}),Ne(i,sa,Xt(e.getTagName()),[e],t)}function sf(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=Yu[s];Si(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.extent,t)}function NE(n,e,t){n.setAttribute("rid",e.rid)}function Hr(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=Yu[s];Si(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.geometry,t)}function of(n,e,t){const s=t[t.length-1].context.version;Hr(n,e,t);const o=ne(oa(s),"Distance");ce(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),n.appendChild(o)}function af(n,e,t){const s=t[t.length-1].context.version;wo(qu[s],"ValueReference",n,e.propertyName);const o=ne(Dr,"TimePeriod");n.appendChild(o);const a=ne(Dr,"begin");o.appendChild(a),ff(a,e.begin);const l=ne(Dr,"end");o.appendChild(l),ff(l,e.end)}function Vs(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const u=o[a];Ne(s,sa,Xt(u.getTagName()),[u],t)}}function lf(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.condition;Ne(s,sa,Xt(o.getTagName()),[o],t)}function Yt(n,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),Si(s,n,e.propertyName),vo(s,n,""+e.expression)}function uf(n,e,t){const s=t[t.length-1].context.version;Si(s,n,e.propertyName)}function cf(n,e,t){const s=t[t.length-1].context.version,o=oa(s);Si(s,n,e.propertyName);const a=ne(o,"LowerBoundary");n.appendChild(a),vo(s,a,""+e.lowerBoundary);const l=ne(o,"UpperBoundary");n.appendChild(l),vo(s,l,""+e.upperBoundary)}function hf(n,e,t){const s=t[t.length-1].context.version;n.setAttribute("wildCard",e.wildCard),n.setAttribute("singleChar",e.singleChar),n.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),Si(s,n,e.propertyName),vo(s,n,""+e.pattern)}function wo(n,e,t,r){const i=ne(n,e);ce(i,r),t.appendChild(i)}function vo(n,e,t){wo(oa(n),"Literal",e,t)}function Si(n,e,t){n==="2.0.0"?wo(qu[n],"ValueReference",e,t):wo(Hu[n],"PropertyName",e,t)}function ff(n,e){const t=ne(Dr,"TimeInstant");n.appendChild(t);const r=ne(Dr,"timePosition");t.appendChild(r),ce(r,e)}function df(n,e,t){const r=t[t.length-1],i=Object.assign({},r);i.node=n,Ne(i,sa,Xt("Query"),e,t)}function oa(n){let e;return n==="2.0.0"?e=qu[n]:e=Hu[n],e}const Ce={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class pf{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readLineString());return t}readWkbHeader(e){const r=this.readUint8()>0,i=this.readUint32(r),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),u=(i&268435455)%1e3,c=["XY",o?"Z":"",a?"M":""].join(""),h=l?this.readUint32(r):null;if(e!==void 0&&e!==u)throw new Error("Unexpected WKB geometry type "+u);if(this.initialized_){if(this.isLittleEndian_!==r)throw new Error("Inconsistent endian");if(this.layout_!==c)throw new Error("Inconsistent geometry layout");if(h&&this.srid_!==h)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=r,this.hasZ_=o,this.hasM_=a,this.layout_=c,this.srid_=h,this.initialized_=!0;return u}readWkbPayload(e){switch(e){case Ce.POINT:return this.readPoint();case Ce.LINE_STRING:return this.readLineString();case Ce.POLYGON:case Ce.TRIANGLE:return this.readPolygon();case Ce.MULTI_POINT:return this.readMultiPoint();case Ce.MULTI_LINE_STRING:return this.readMultiLineString();case Ce.MULTI_POLYGON:case Ce.POLYHEDRAL_SURFACE:case Ce.TIN:return this.readMultiPolygon();case Ce.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const r=this.readUint32(),i=[];for(let s=0;s<r;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Ce.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Ce.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Ce.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case Ce.POINT:return new tr(t,this.layout_);case Ce.LINE_STRING:return new Pr(t,this.layout_);case Ce.POLYGON:case Ce.TRIANGLE:return new Fn(t,this.layout_);case Ce.MULTI_POINT:return new Wo(t,this.layout_);case Ce.MULTI_LINE_STRING:return new _i(t,this.layout_);case Ce.MULTI_POLYGON:case Ce.POLYHEDRAL_SURFACE:case Ce.TIN:return new xs(t,this.layout_);case Ce.GEOMETRY_COLLECTION:return new an(t);default:return null}}getSrid(){return this.srid_}}class DE{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const r=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in r?r[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writePoint(e[r],t)}writePolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeLineString(e[r],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const r=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof mh)return r(e.getLayout(),t);if(e instanceof an){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const r={Point:Ce.POINT,LineString:Ce.LINE_STRING,Polygon:Ce.POLYGON,MultiPoint:Ce.MULTI_POINT,MultiLineString:Ce.MULTI_LINE_STRING,MultiPolygon:Ce.MULTI_POLYGON,GeometryCollection:Ce.GEOMETRY_COLLECTION},i=e.getType(),s=r[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof mh?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof an&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),r=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:r.setUint8(i,s[1]);break;case 4:r.setUint32(i,s[1],this.isLittleEndian_);break;case 8:r.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class GE extends Hd{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Mt({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let r=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof an?r=i.getGeometriesArray():r=[i],r.map(s=>new Mt({geometry:s}))}readGeometry(e,t){const r=gf(e);if(!r)return null;const s=new pf(r).readGeometry();return this.viewCache_=r,t=this.getReadOptions(e,t),this.viewCache_=null,ft(s,!1,t)}readProjection(e){const t=this.viewCache_||gf(e);if(!t)return;const r=new pf(t);return r.readWkbHeader(),r.getSrid()&&we("EPSG:"+r.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new an(e.map(r=>r.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const r=new DE({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&we(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}r.writeGeometry(ft(e,!0,t),i);const s=r.getBuffer();return this.hex_?UE(s):s}}function UE(n){const e=new Uint8Array(n);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function BE(n){const e=new Uint8Array(n.length/2);for(let t=0;t<n.length/2;t++)e[t]=parseInt(n.substr(t*2,2),16);return new DataView(e.buffer)}function gf(n){return typeof n=="string"?BE(n):ArrayBuffer.isView(n)?n instanceof DataView?n:new DataView(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new DataView(n):null}const kE={POINT:tr,LINESTRING:Pr,POLYGON:Fn,MULTIPOINT:Wo,MULTILINESTRING:_i,MULTIPOLYGON:xs},Vp="EMPTY",Xp="Z",Zp="M",zE="ZM",Re={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},$E={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class jE{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let r=e,i;if(e=="(")i=Re.LEFT_PAREN;else if(e==",")i=Re.COMMA;else if(e==")")i=Re.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")i=Re.NUMBER,r=this.readNumber_();else if(this.isAlpha_(e))i=Re.TEXT,r=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")i=Re.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:r,type:i}}readNumber_(){let e;const t=this.index_;let r=!1,i=!1;do e=="."?r=!0:(e=="e"||e=="E")&&(i=!0),e=this.nextChar_();while(this.isNumeric_(e,r)||!i&&(e=="e"||e=="E")||i&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class VE{constructor(e){this.lexer_=e,this.token_={position:0,type:Re.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(Re.TEXT)){const r=t.value;r===Xp?e="XYZ":r===Zp?e="XYM":r===zE&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(Re.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(Re.COMMA));if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(Re.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(Re.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(Re.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(Re.LEFT_PAREN)){let e;if(this.token_.type==Re.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(Re.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(Re.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(Re.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let r=0;r<t;++r){const i=this.token_;if(this.match(Re.NUMBER))e.push(i.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(Re.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(Re.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(Re.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(Re.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(Re.TEXT)&&this.token_.value==Vp;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(Re.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const r=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(r)return new an([]);const o=this.parseGeometryCollectionText_();return new an(o)}const i=kE[t];if(!i)throw new Error("Invalid geometry type: "+t);let s;if(r)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new i(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class XE extends Xu{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new jE(e);return new VE(t).parse()}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t),i=new Mt;return i.setGeometry(r),i}readFeaturesFromText(e,t){let r=[];const i=this.readGeometryFromText(e,t);this.splitCollection_&&i.getType()=="GeometryCollection"?r=i.getGeometriesArray():r=[i];const s=[];for(let o=0,a=r.length;o<a;++o){const l=new Mt;l.setGeometry(r[o]),s.push(l)}return s}readGeometryFromText(e,t){const r=this.parse_(e);return ft(r,!1,t)}writeFeatureText(e,t){const r=e.getGeometry();return r?this.writeGeometryText(r,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const r=[];for(let s=0,o=e.length;s<o;++s)r.push(e[s].getGeometry());const i=new an(r);return this.writeGeometryText(i,t)}writeGeometryText(e,t){return qp(ft(e,!0,t))}}function Wp(n){const e=n.getCoordinates();return e.length===0?"":e.join(" ")}function ZE(n){const e=[],t=n.getPoints();for(let r=0,i=t.length;r<i;++r)e.push("("+Wp(t[r])+")");return e.join(",")}function WE(n){const e=[],t=n.getGeometries();for(let r=0,i=t.length;r<i;++r)e.push(qp(t[r]));return e.join(",")}function Ju(n){const e=n.getCoordinates(),t=[];for(let r=0,i=e.length;r<i;++r)t.push(e[r].join(" "));return t.join(",")}function HE(n){const e=[],t=n.getLineStrings();for(let r=0,i=t.length;r<i;++r)e.push("("+Ju(t[r])+")");return e.join(",")}function Hp(n){const e=[],t=n.getLinearRings();for(let r=0,i=t.length;r<i;++r)e.push("("+Ju(t[r])+")");return e.join(",")}function qE(n){const e=[],t=n.getPolygons();for(let r=0,i=t.length;r<i;++r)e.push("("+Hp(t[r])+")");return e.join(",")}function YE(n){const e=n.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=Xp),(e==="XYM"||e==="XYZM")&&(t+=Zp),t}const KE={Point:Wp,LineString:Ju,Polygon:Hp,MultiPoint:ZE,MultiLineString:HE,MultiPolygon:qE,GeometryCollection:WE};function qp(n){const e=n.getType(),t=KE[e],r=t(n);let i=$E[e];if(typeof n.getFlatCoordinates=="function"){const s=YE(n);s.length>0&&(i+=" "+s)}return r.length===0?i+" "+Vp:i+"("+r+")"}const st=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Ps(n){return ky(n[0].version,"1.3")>=0}const JE=X(st,{Service:P(bT),Capability:P(xT)}),QE=X(st,{Request:P(IT),Exception:P(vT),Layer:P(ST),UserDefinedSymbolization:P(yT)});class eT extends Zu{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=z({version:this.version},JE,e,[]);return t||null}}const Yp={Name:P(B),Title:P(B),Abstract:P(B),KeywordList:P(rg),OnlineResource:P(vi),ContactInformation:P(ET),Fees:P(B),AccessConstraints:P(B)},tT=X(st,Yp),rT=X(st,{...Yp,LayerLimit:P(Ke),MaxWidth:P(Ke),MaxHeight:P(Ke)}),nT=X(st,{ContactPersonPrimary:P(TT),ContactPosition:P(B),ContactAddress:P(wT),ContactVoiceTelephone:P(B),ContactFacsimileTelephone:P(B),ContactElectronicMailAddress:P(B)}),iT=X(st,{ContactPerson:P(B),ContactOrganization:P(B)}),sT=X(st,{AddressType:P(B),Address:P(B),City:P(B),StateOrProvince:P(B),PostCode:P(B),Country:P(B)}),oT=X(st,{Format:Y(B)}),Kp={Name:P(B),Title:P(B),Abstract:P(B),KeywordList:P(rg),BoundingBox:Pe(eg),Dimension:Pe(RT),Attribution:P(mT),AuthorityURL:Pe(FT),Identifier:Pe(B),MetadataURL:Pe(MT),DataURL:Pe(Br),FeatureListURL:Pe(Br),Style:Pe(OT),Layer:Pe(aa)},Jp=X(st,{...Kp,SRS:Pe(B),Extent:P(PT),ScaleHint:Pe(AT),LatLonBoundingBox:P((n,e)=>eg(n,e,!1)),Layer:Pe(aa)}),Qp=X(st,{...Kp,CRS:Pe(B),EX_GeographicBoundingBox:P(_T),MinScaleDenominator:P(vt),MaxScaleDenominator:P(vt),Layer:Pe(aa)}),aT=X(st,{Title:P(B),OnlineResource:P(vi),LogoURL:P(tg)}),lT=X(st,{westBoundLongitude:P(vt),eastBoundLongitude:P(vt),southBoundLatitude:P(vt),northBoundLatitude:P(vt)}),uT=X(st,{GetCapabilities:P(Di),GetMap:P(Di),GetFeatureInfo:P(Di),DescribeLayer:P(Di),GetLegendGraphic:P(Di)}),cT=X(st,{Format:Pe(B),DCPType:Pe(CT)}),hT=X(st,{HTTP:P(LT)}),fT=X(st,{Get:P(Br),Post:P(Br)}),dT=X(st,{Name:P(B),Title:P(B),Abstract:P(B),LegendURL:Pe(tg),StyleSheetURL:P(Br),StyleURL:P(Br)}),pT=X(st,{Format:P(B),OnlineResource:P(vi)}),gT=X(st,{Keyword:Y(B)});function mT(n,e){return z({},aT,n,e)}function yT(n,e){return{SupportSLD:!!Bt(n.getAttribute("SupportSLD")),UserLayer:!!Bt(n.getAttribute("UserLayer")),UserStyle:!!Bt(n.getAttribute("UserStyle")),RemoteWFS:!!Bt(n.getAttribute("RemoteWFS")),InlineFeatureData:!!Bt(n.getAttribute("InlineFeatureData")),RemoteWCS:!!Bt(n.getAttribute("RemoteWCS"))}}function eg(n,e,t=!0){const r=[_r(n.getAttribute("minx")),_r(n.getAttribute("miny")),_r(n.getAttribute("maxx")),_r(n.getAttribute("maxy"))],i=[_r(n.getAttribute("resx")),_r(n.getAttribute("resy"))],s={extent:r,res:i};return t&&(Ps(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function _T(n,e){const t=z({},lT,n,e);if(!t)return;const r=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(r===void 0||i===void 0||s===void 0||o===void 0))return[r,i,s,o]}function xT(n,e){return z({},QE,n,e)}function bT(n,e){return z({},Ps(e)?rT:tT,n,e)}function ET(n,e){return z({},nT,n,e)}function TT(n,e){return z({},iT,n,e)}function wT(n,e){return z({},sT,n,e)}function vT(n,e){return z([],oT,n,e)}function ST(n,e){const t=z({},Ps(e)?Qp:Jp,n,e);return t.Layer===void 0?Object.assign(t,aa(n,e)):t}function aa(n,e){const t=Ps(e),r=e[e.length-1],i=z({},t?Qp:Jp,n,e);if(!i)return;let s=Bt(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),i.queryable=s!==void 0?s:!1;let o=Jr(n.getAttribute("cascaded"));o===void 0&&(o=r.cascaded),i.cascaded=o;let a=Bt(n.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let l=Bt(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),i.noSubsets=l!==void 0?l:!1;let u=_r(n.getAttribute("fixedWidth"));u||(u=r.fixedWidth),i.fixedWidth=u;let c=_r(n.getAttribute("fixedHeight"));c||(c=r.fixedHeight),i.fixedHeight=c;const h=["Style","AuthorityURL"];t?h.push("CRS"):h.push("SRS","Dimension"),h.forEach(function(p){if(p in r){const d=i[p]||[];i[p]=d.concat(r[p])}});const f=["BoundingBox","Attribution"];return t?f.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):f.push("LatLonBoundingBox","ScaleHint","Extent"),f.forEach(function(p){if(!(p in i)){const d=r[p];i[p]=d}}),i}function RT(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return Ps(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:Bt(n.getAttribute("multipleValues")),nearestValue:Bt(n.getAttribute("nearestValue")),current:Bt(n.getAttribute("current")),values:B(n)}),t}function PT(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:Bt(n.getAttribute("nearestValue"))}}function AT(n,e){return{min:_r(n.getAttribute("min")),max:_r(n.getAttribute("max"))}}function Br(n,e){return z({},pT,n,e)}function IT(n,e){return z({},uT,n,e)}function CT(n,e){return z({},hT,n,e)}function LT(n,e){return z({},fT,n,e)}function Di(n,e){return z({},cT,n,e)}function tg(n,e){const t=Br(n,e);if(t){const r=[Jr(n.getAttribute("width")),Jr(n.getAttribute("height"))];return t.size=r,t}}function FT(n,e){const t=Br(n,e);if(t)return t.name=n.getAttribute("name"),t}function MT(n,e){const t=Br(n,e);if(t)return t.type=n.getAttribute("type"),t}function OT(n,e){return z({},dT,n,e)}function rg(n,e){return z([],gT,n,e)}const NT="_feature",DT="_layer";class GT extends Ho{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new le,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const r=e.localName;let i=[];if(e.childNodes.length===0)return i;if(r=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,u=t[0],c=DT,h=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(h))continue;const f=h+NT;u.featureType=f,u.featureNS=this.featureNS_;const p={};p[f]=Y(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const d=X([u.featureNS,null],p);l.setAttribute("namespaceURI",this.featureNS_);const g=z([],d,l,t,this.gmlFormat_);g&&uo(i,g)}if(r=="FeatureCollection"){const s=z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const r={};return t&&Object.assign(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])}}const Ar=[null,"http://www.opengis.net/wmts/1.0"],Ri=[null,"http://www.opengis.net/ows/1.1"],UT=X(Ar,{Contents:P(HT)});let ng=class extends Zu{constructor(){super(),this.owsParser_=new Bp}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=z(r,UT,e,[]),r||null):null}};const BT=X(Ar,{Layer:Pe(qT),TileMatrixSet:Pe(YT)}),kT=X(Ar,{Style:Pe(KT),Format:Pe(B),TileMatrixSetLink:Pe(JT),Dimension:Pe(QT),ResourceURL:Pe(ew)},X(Ri,{Title:P(B),Abstract:P(B),WGS84BoundingBox:P(sg),BoundingBox:Pe(tw),Identifier:P(B)})),zT=X(Ar,{LegendURL:Pe(rw)},X(Ri,{Title:P(B),Identifier:P(B)})),$T=X(Ar,{TileMatrixSet:P(B),TileMatrixSetLimits:P(iw)}),jT=X(Ar,{TileMatrixLimits:Y(sw)}),VT=X(Ar,{TileMatrix:P(B),MinTileRow:P(Ke),MaxTileRow:P(Ke),MinTileCol:P(Ke),MaxTileCol:P(Ke)}),XT=X(Ar,{Default:P(B),Value:Pe(B)},X(Ri,{Identifier:P(B)})),ig=X(Ri,{LowerCorner:Y(Ol),UpperCorner:Y(Ol)}),ZT=X(Ar,{WellKnownScaleSet:P(B),TileMatrix:Pe(nw)},X(Ri,{SupportedCRS:P(B),Identifier:P(B),BoundingBox:P(sg)})),WT=X(Ar,{TopLeftCorner:P(Ol),ScaleDenominator:P(vt),TileWidth:P(Ke),TileHeight:P(Ke),MatrixWidth:P(Ke),MatrixHeight:P(Ke)},X(Ri,{Identifier:P(B)}));function HT(n,e){return z({},BT,n,e)}function qT(n,e){return z({},kT,n,e)}function YT(n,e){return z({},ZT,n,e)}function KT(n,e){const t=z({},zT,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function JT(n,e){return z({},$T,n,e)}function QT(n,e){return z({},XT,n,e)}function ew(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function sg(n,e){const t=z([],ig,n,e);if(t.length==2)return yu(t)}function tw(n,e){const t=n.getAttribute("crs"),r=z([],ig,n,e);if(r.length==2)return{extent:yu(r),crs:t}}function rw(n,e){const t={};return t.format=n.getAttribute("format"),t.href=vi(n),t}function Ol(n,e){const t=B(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function nw(n,e){return z({},WT,n,e)}function iw(n,e){return z([],jT,n,e)}function sw(n,e){return z({},VT,n,e)}window.eoxMapAdvancedOlFormats={EsriJSON:Tx,GML:ku,GPX:qx,IGC:Lb,IIIFInfo:Gb,KML:$y,OWS:Bp,Polyline:dE,TopoJSON:zy,WFS:CE,WKB:GE,WKT:XE,WMSCapabilities:eT,WMSGetFeatureInfo:GT,WMTSCapabilities:ng};function og(n,e,t){const r=[];let i=n(0),s=n(1),o=e(i),a=e(s);const l=[s,i],u=[a,o],c=[1,0],h={};let f=1e5,p,d,g,m,y,_;for(;--f>0&&c.length>0;)g=c.pop(),i=l.pop(),o=u.pop(),_=g.toString(),_ in h||(r.push(o[0],o[1]),h[_]=!0),m=c.pop(),s=l.pop(),a=u.pop(),y=(g+m)/2,p=n(y),d=e(p),jy(d[0],d[1],o[0],o[1],a[0],a[1])<t?(r.push(a[0],a[1]),_=m.toString(),h[_]=!0):(c.push(m,y,y,g),u.push(a,d,d,o),l.push(s,p,p,i));return r}function ow(n,e,t,r,i){const s=we("EPSG:4326");return og(function(o){return[n,e+(t-e)*o]},po(s,r),i)}function aw(n,e,t,r,i){const s=we("EPSG:4326");return og(function(o){return[e+(t-e)*o,n]},po(s,r),i)}function lw(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=n.inversePixelTransform[0],t=n.inversePixelTransform[1],r=Math.sqrt(e*e+t*t),i=n.frameState,s=Ji(n.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Vy(i.viewState.resolution,r);let a;return new Xy(n.context,r,i.extent,s,i.viewState.rotation,o,a)}const uw=new Tl({color:"rgba(0,0,0,0.2)"}),cw=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class hw extends Zy{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:uw,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?yh.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?yh.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Ga({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new _h({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new xh({color:"rgba(0,0,0,1)"}),stroke:new Tl({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=r=>{const i=r.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Ga({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new _h({font:"12px Calibri,sans-serif",textAlign:"right",fill:new xh({color:"rgba(0,0,0,1)"}),stroke:new Tl({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=r=>{const i=r.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(bn.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:cw,this.setSource(new _u({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Wy,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Ga({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let r=e.slice();return this.projection_&&this.getSource().getWrapX()&&Hy(r,this.projection_),this.loadedExtent_&&(qy(this.loadedExtent_,r,t)?r=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[r]}loaderFunction(e,t,r){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=Er(s,e);if(this.renderedExtent_&&Qi(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,xu(o)))return;const a=nn(o),l=t*t/4;(!this.projection_||!ro(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(o,a,t,l);let c=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(c+=this.meridians_.length),this.parallelsLabels_&&(c+=this.parallels_.length);let h;for(;c>this.featurePool_.length;)h=new Mt,this.featurePool_.push(h);const f=i.getFeaturesCollection();f.clear();let p=0,d,g;for(d=0,g=this.meridians_.length;d<g;++d)h=this.featurePool_[p++],h.setGeometry(this.meridians_[d]),h.setStyle(this.lineStyle_),f.push(h);for(d=0,g=this.parallels_.length;d<g;++d)h=this.featurePool_[p++],h.setGeometry(this.parallels_[d]),h.setStyle(this.lineStyle_),f.push(h)}addMeridian_(e,t,r,i,s,o){const a=this.getMeridian_(e,t,r,i,o);if(ci(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new tr([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,r,i,s,o){const a=this.getParallel_(e,t,r,i,o);if(ci(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new tr([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,r=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=nn(s);let a=s;if(t){const d=i[0]*r,g=i[1]*r;a=[o[0]-d/2,o[1]-g/2,o[0]+d/2,o[1]+g/2]}let l=0,u=0,c=this.latLabelPosition_<.5;const h=this.projection_.getExtent(),f=xt(h);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ao(h,s)){l=Math.floor((s[0]-h[0])/f),u=Math.ceil((s[2]-h[2])/f);const d=Math.abs(t)>Math.PI/2;c=c!==d}const p=lw(e);for(let d=l;d<=u;++d){let g=this.meridians_.length+this.parallels_.length,m,y,_,x;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){const T=this.meridians_[y];if(!t&&d===0)x=this.getMeridianPoint_(T,s,y);else{const b=T.clone();b.translate(d*f,0),b.rotate(-t,o),x=this.getMeridianPoint_(b,a,y),x.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(x),m.set("graticule_label",this.meridiansLabels_[y].text),p.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(d===l&&c||d===u&&!c))for(y=0,_=this.parallels_.length;y<_;++y){const T=this.parallels_[y];if(!t&&d===0)x=this.getParallelPoint_(T,s,y);else{const b=T.clone();b.translate(d*f,0),b.rotate(-t,o),x=this.getParallelPoint_(b,a,y),x.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(x),m.set("graticule_label",this.parallelsLabels_[y].text),p.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(e,t,r,i){const s=this.getInterval_(r);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=xt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ao(a,e)&&(xt(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const u=[Ve(t[0],this.minX_,this.maxX_),Ve(t[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(u);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let h=Ve(c[0],this.minLon_,this.maxLon_),f=Ve(c[1],this.minLat_,this.maxLat_);const p=this.maxLines_;let d,g,m,y,_=e;o||(_=[Ve(e[0],this.minX_,this.maxX_),Ve(e[1],this.minY_,this.maxY_),Ve(e[2],this.minX_,this.maxX_),Ve(e[3],this.minY_,this.maxY_)]);const x=hi(_,this.toLonLatTransform_,void 0,8);let T=x[3],b=x[2],E=x[1],w=x[0];if(o||(ei(_,this.bottomLeft_)&&(w=this.minLon_,E=this.minLat_),ei(_,this.bottomRight_)&&(b=this.maxLon_,E=this.minLat_),ei(_,this.topLeft_)&&(w=this.minLon_,T=this.maxLat_),ei(_,this.topRight_)&&(b=this.maxLon_,T=this.maxLat_),T=Ve(T,f,this.maxLat_),b=Ve(b,h,this.maxLon_),E=Ve(E,this.minLat_,f),w=Ve(w,this.minLon_,h)),h=Math.floor(h/s)*s,y=Ve(h,this.minLon_,this.maxLon_),g=this.addMeridian_(y,E,T,i,e,0),d=0,o)for(;(y-=s)>=w&&d++<p;)g=this.addMeridian_(y,E,T,i,e,g);else for(;y!=this.minLon_&&d++<p;)y=Math.max(y-s,this.minLon_),g=this.addMeridian_(y,E,T,i,e,g);if(y=Ve(h,this.minLon_,this.maxLon_),d=0,o)for(;(y+=s)<=b&&d++<p;)g=this.addMeridian_(y,E,T,i,e,g);else for(;y!=this.maxLon_&&d++<p;)y=Math.min(y+s,this.maxLon_),g=this.addMeridian_(y,E,T,i,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),f=Math.floor(f/s)*s,m=Ve(f,this.minLat_,this.maxLat_),g=this.addParallel_(m,w,b,i,e,0),d=0;m!=this.minLat_&&d++<p;)m=Math.max(m-s,this.minLat_),g=this.addParallel_(m,w,b,i,e,g);for(m=Ve(f,this.minLat_,this.maxLat_),d=0;m!=this.maxLat_&&d++<p;)m=Math.min(m+s,this.maxLat_),g=this.addParallel_(m,w,b,i,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)}getInterval_(e){const t=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,u=this.intervals_.length;l<u;++l){const c=Ve(this.intervals_[l]/2,0,90),h=Ve(r,-90+c,90-c);if(o[0]=t-c,o[1]=h-c,a[0]=t+c,a[1]=h+c,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,r,i,s){const o=ow(e,t,r,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new Pr(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,r){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),u=Ve(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),h=[i[s-1]+(i[o-1]-i[s-1])*(u-i[s])/(i[o]-i[s]),u],f=this.meridiansLabels_[r].geom;return f.setCoordinates(h),f}getMeridians(){return this.meridians_}getParallel_(e,t,r,i,s){const o=aw(e,t,r,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new Pr(o,"XY"),a}getParallelPoint_(e,t,r){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),u=Ve(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),c=i[s+1]+(i[o+1]-i[s+1])*(u-i[s])/(i[o]-i[s]),h=[u,c],f=this.parallelsLabels_[r].geom;return f.setCoordinates(h),f}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=we("EPSG:4326"),r=e.getWorldExtent();this.maxLat_=r[3],this.maxLon_=r[2],this.minLat_=r[1],this.minLon_=r[0];const i=po(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,u){u=u||2;const c=i(a,l,u);for(let h=0,f=c.length;h<f;h+=u)c[h]<o&&(c[h]+=360);return c}}this.fromLonLatTransform_=po(t,e);const s=hi([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(nn(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}function $n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function So(n,e){return n[0]=e[0],n[1]=e[1],n[4]=e[2],n[5]=e[3],n[12]=e[4],n[13]=e[5],n}function Nl(n,e,t,r,i,s,o){o=o??$n();const a=1/(n-e),l=1/(t-r),u=1/(i-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*u,o[11]=0,o[12]=(n+e)*a,o[13]=(r+t)*l,o[14]=(s+i)*u,o[15]=1,o}function mf(n,e,t,r,i){return i=i??$n(),i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i[4]=n[4]*t,i[5]=n[5]*t,i[6]=n[6]*t,i[7]=n[7]*t,i[8]=n[8]*r,i[9]=n[9]*r,i[10]=n[10]*r,i[11]=n[11]*r,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function fw(n,e,t,r,i){i=i??$n();let s,o,a,l,u,c,h,f,p,d,g,m;return n===i?(i[12]=n[0]*e+n[4]*t+n[8]*r+n[12],i[13]=n[1]*e+n[5]*t+n[9]*r+n[13],i[14]=n[2]*e+n[6]*t+n[10]*r+n[14],i[15]=n[3]*e+n[7]*t+n[11]*r+n[15]):(s=n[0],o=n[1],a=n[2],l=n[3],u=n[4],c=n[5],h=n[6],f=n[7],p=n[8],d=n[9],g=n[10],m=n[11],i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=u,i[5]=c,i[6]=h,i[7]=f,i[8]=p,i[9]=d,i[10]=g,i[11]=m,i[12]=s*e+u*t+p*r+n[12],i[13]=o*e+c*t+d*r+n[13],i[14]=a*e+h*t+g*r+n[14],i[15]=l*e+f*t+m*r+n[15]),i}function dw(n,e,t,r){return r=r??$n(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n,r[13]=e,r[14]=t,r[15]=1,r}const Un=34962,As=34963,Qu=35044,ii=35048,pw=5121,gw=5123,mw=5125,ag=5126,yf=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function yw(n,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!Yy},e);const t=yf.length;for(let r=0;r<t;++r)try{const i=n.getContext(yf[r],e);if(i)return i}catch{}return null}const _w={STATIC_DRAW:Qu};class sn{constructor(e,t){this.array_=null,this.type_=e,Wt(e===Un||e===As,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:_w.STATIC_DRAW}ofSize(e){return this.array_=new(Xs(this.type_))(e),this}fromArray(e){return this.array_=Xs(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Xs(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Xs(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Xs(n){switch(n){case Un:return Float32Array;case As:return Uint32Array;default:return Float32Array}}const Zs={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},xw=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,bw=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class _f{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||xw),t.compileShader(r);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||bw),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,r[0],r[1],o,a,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Te(s.canvas);if(!e.renderTargets[l]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,i=1;this.uniforms_.forEach(function(s){if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(s.location,i++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(s.location,r[0],r[1]);return;case 3:t.uniform3f(s.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(s.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(s.location,r)})}}const yr={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},We={UNSIGNED_BYTE:pw,UNSIGNED_SHORT:gw,UNSIGNED_INT:mw,FLOAT:ag},Ro={};function xf(n){return"shared/"+n}let bf=0;function Ew(){const n="unique/"+bf;return bf+=1,n}function Tw(n){let e=Ro[n];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:yw(t)},Ro[n]=e}return e.users+=1,e.context}function ww(n){const e=Ro[n];if(!e||(e.users-=1,e.users>0))return;const t=e.context,r=t.getExtension("WEBGL_lose_context");r&&r.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Ro[n]}class vw extends qd{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?xf(e.canvasCacheKey):Ew(),this.gl_=Tw(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Zs.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Zs.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=_t(),this.offsetScaleMatrix_=_t(),this.tmpMat4_=$n(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(r=>new _f({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new _f({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===xf(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}getInstancedRenderingExtension_(){const e=this.getExtension("ANGLE_instanced_arrays");return Wt(!!e,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),e}bindBuffer(e){const t=this.gl_,r=Te(e);let i=this.bufferCache_[r];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[r]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=Te(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Zs.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Zs.RESTORED,this.boundHandleWebGLContextRestored_),ww(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),r?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,r,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,r?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const i=r.UNSIGNED_INT,s=4,o=t-e,a=e*s;r.drawElements(r.TRIANGLES,o,i,a)}drawElementsInstanced(e,t,r){const i=this.gl_;this.getExtension("OES_element_index_uint");const s=this.getInstancedRenderingExtension_(),o=i.UNSIGNED_INT,a=4,l=t-e,u=e*a;s.drawElementsInstancedANGLE(i.TRIANGLES,l,o,u,r);for(let c=0;c<this.maxAttributeCount_;c++)s.vertexAttribDivisorANGLE(c,0)}finalizeDraw(e,t,r){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,r):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(yr.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(yr.ZOOM,e.viewState.zoom),this.setUniformFloatValue(yr.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(yr.PIXEL_RATIO,i),this.setUniformFloatVec2(yr.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(yr.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(yr.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(yr.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,i=0;this.uniforms_.forEach(s=>{if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=r):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&o&&s.prevValue!==r&&(s.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),i++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(s.name,So(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:t.uniform2f(this.getUniformLocation(s.name),r[0],r[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),r[0],r[1],r[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(this.getUniformLocation(s.name),r)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}getProgram(e,t){const r=this.gl_,i=this.compileShader(e,r.FRAGMENT_SHADER),s=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,s),r.linkProgram(o),!r.getShaderParameter(i,r.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getShaderParameter(s,r.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${r.getShaderInfoLog(s)}`;throw new Error(a)}if(r.deleteShader(s),!r.getProgramParameter(o,r.LINK_STATUS)){const a=`GL program linking failed: ${r.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Te(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Te(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return bu(t,0,0,2/(s*r[0]),2/(s*r[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,r,i,s,o){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,t,r,!1,i,s),o&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(a,1))}enableAttributes_(e,t){const r=Sw(e);let i=0;for(let s=0;s<e.length;s++){const o=e[s];o.name&&this.enableAttributeArray_(o.name,o.size,o.type||ag,r,i,t),i+=o.size*lg(o.type)}}enableAttributes(e){this.enableAttributes_(e,!1)}enableAttributesInstanced(e){this.enableAttributes_(e,!0)}handleWebGLContextLost(e){Ky(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,i){const s=this.gl_;r=r||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,u=0,c=s.RGBA,h=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,c,h,t):t?s.texImage2D(s.TEXTURE_2D,a,l,c,h,t):s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,c,h,null),r}}function Sw(n){let e=0;for(let t=0;t<n.length;t++){const r=n[t];e+=r.size*lg(r.type)}return e}function lg(n){switch(n){case We.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case We.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case We.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case We.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Rw extends Jy{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(Ft.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===pe.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Eu){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(Ft.CHANGE,this.handleTileChange_)}}uploadTile(){Fr()}setReady(){this.ready=!0,this.dispatchEvent(Ft.CHANGE)}handleTileChange_(){this.tile.getState()===pe.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(Ft.CHANGE,this.handleTileChange_)}}function ug(n,e,t){const r=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r)}function Pw(n,e,t,r){ug(n,e,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}function Ef(n,e,t,r,i,s){const o=n.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,n.getExtension("OES_texture_float"),l=n.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),ug(o,e,s&&l);const u=t.byteLength/r[1];let c=1;u%8===0?c=8:u%4===0?c=4:u%2===0&&(c=2);let h;switch(i){case 1:{h=o.LUMINANCE;break}case 2:{h=o.LUMINANCE_ALPHA;break}case 3:{h=o.RGB;break}case 4:{h=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,h,r[0],r[1],0,h,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let qn=null;function Aw(){qn=ln(1,1,void 0,{willReadFrequently:!0})}class Iw extends Rw{constructor(e){super(e),this.textures=[],this.renderSize_=ur(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new sn(Un,Qu);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var r;const t=(r=this.helper)==null?void 0:r.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),r=this.tile;this.textures.length=0;let i;r instanceof Eu||r instanceof Qy?i=r.getImage():i=r.getData();const s=vl(i);if(s){const _=t.createTexture();this.textures.push(_),this.bandCount=4,Pw(t,_,s,r.interpolate),this.setReady();return}i=wl(i);const o=r.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=i instanceof Float32Array,u=a[0]*a[1],c=l?Float32Array:Uint8Array,h=c.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/h/a[0]);const p=Math.ceil(this.bandCount/4);if(p===1){const _=t.createTexture();this.textures.push(_),Ef(e,_,i,a,this.bandCount,r.interpolate),this.setReady();return}const d=new Array(p);for(let _=0;_<p;++_){const x=t.createTexture();this.textures.push(x);const T=_<p-1?4:(this.bandCount-1)%4+1;d[_]=new c(u*T)}let g=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let x=0;x<y;++x){const T=i[m+x],b=Math.floor(g/this.bandCount),E=x%this.bandCount,w=Math.floor(E/4),S=d[w],v=S.length/u,R=E%4;S[b*v+R]=T,++g}m+=f/h}for(let _=0;_<p;++_){const x=this.textures[_],T=d[_],b=T.length/u;Ef(e,x,T,a,b,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];qn||Aw(),qn.clearRect(0,0,1,1);const a=e.width,l=e.height,u=a-2*i,c=l-2*i,h=i+Math.floor(u*(t/s)),f=i+Math.floor(c*(r/o));let p;try{qn.drawImage(e,h,f,1,1,0,0,1,1),p=qn.getImageData(0,0,1,1).data}catch{return qn=null,null}return p}getArrayPixelData_(e,t,r,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],u=t[1],c=l+2*s,h=u+2*s,f=s+Math.floor(l*(r/o)),p=s+Math.floor(u*(i/a));if(e instanceof DataView){const g=e.byteLength/(c*h),m=g*(p*c+f),y=e.buffer.slice(m,m+g);return new DataView(y)}const d=this.bandCount*(p*c+f);return e.slice(d,d+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Tu){const r=this.tile.getData(),i=wl(r);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(vl(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class Is extends e_{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=_t(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(Sl.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(bn.PRECOMPOSE)){const i=new Ua(bn.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(bn.POSTCOMPOSE)){const i=new Ua(bn.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,r=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,u=l.getRenderer();if(!(u instanceof Is)){t=!0;continue}const c=l.getClassName();if((t||c!==i)&&(r+=1,t=!1),i=c,u===this)break}const s="map/"+e.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new vw({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(Sl.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){bu(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const s=new Ua(e,this.inversePixelTransform_,r,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(bn.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(bn.POSTRENDER,e,t)}}const Cw={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function Tf(n){return 1/(n+2)}function Lw(){return{tileIds:new Set,representationsByZ:{}}}function wf(n,e){return n.tileIds.has(Te(e))}function vf(n,e,t){const r=n.representationsByZ;t in r||(r[t]=new Set),r[t].add(e),n.tileIds.add(Te(e.tile))}function Va(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Er(e,Kd(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=Er(e,i))}return e}function Dl(n,e){return`${Te(n)},${n.getKey()},${n.getRevision()},${Hn(e)}`}class Fw extends Is{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=_t(),this.tempMat4=$n(),this.tempTileRange_=new t_(0,0,0,0),this.tempTileCoord_=Rl(0,0,0),this.tempSize_=[0,0];const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Yd(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const r=this.getLayer().getRenderSource();return!r||xu(Va(e,e.extent))?!1:r.getState()==="ready"}createTileRepresentation(e){return Fr()}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),h=Te(l);h in e.wantedTiles||(e.wantedTiles[h]={});const f=e.wantedTiles[h],p=this.tileRepresentationCache,d=a.getMapInternal(),g=Math.max(r-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection)),m=o.rotation,y=m?r_(o.center,o.resolution,m,e.size):void 0;for(let _=r;_>=g;--_){const x=u.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),T=u.getResolution(_);for(let b=x.minX;b<=x.maxX;++b)for(let E=x.minY;E<=x.maxY;++E){if(m&&!u.tileCoordIntersectsViewport([_,b,E],y))continue;const w=Rl(_,b,E,this.tempTileCoord_),S=Dl(l,w);let v,R;if(p.containsKey(S)&&(v=p.get(S),R=v.tile),(!v||v.tile.key!==l.getKey())&&(R=l.getTile(_,b,E,e.pixelRatio,o.projection),!R)||wf(i,R))continue;v?v.setTile(R):(v=this.createTileRepresentation({tile:R,grid:u,helper:this.helper,gutter:c}),p.set(S,v)),vf(i,v,_);const C=R.getKey();f[C]=!0,R.getState()===pe.IDLE&&(e.tileQueue.isKeyQueued(C)||e.tileQueue.enqueue([R,h,u.getTileCoordCenter(w),T]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,i,s,o,a,l,u,c,h){}renderTileMask(e,t,r,i){}drawTile_(e,t,r,i,s,o,a){if(!t.ready)return;const u=t.tile.tileCoord,c=Hn(u),h=c in o?o[c]:1,f=a.getResolution(r),p=ur(a.getTileSize(r),this.tempSize_),d=a.getOrigin(r),g=a.getTileCoordExtent(u),m=h<1?-1:Tf(r);h<1&&(e.animate=!0);const y=e.viewState,_=y.center[0],x=y.center[1],T=p[0]+2*i,b=p[1]+2*i,E=T/b,w=(_-d[0])/(p[0]*f),S=(d[1]-x)/(p[1]*f),v=y.resolution/f,R=u[1],C=u[2];n_(this.tileTransform_),bh(this.tileTransform_,2/(e.size[0]*v/T),-2/(e.size[1]*v/T)),i_(this.tileTransform_,y.rotation),bh(this.tileTransform_,1,1/E),wu(this.tileTransform_,(p[0]*(R-w)-i)/T,(p[1]*(C-S)-i)/b),this.renderTile(t,this.tileTransform_,e,s,f,p,d,g,m,i,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(r.projection),a=s.getGutterForProjection(r.projection),l=Va(e,e.extent),u=o.getZForResolution(r.resolution,s.zDirection),c=Lw(),h=i.getPreload();if(e.nextExtent){const x=o.getZForResolution(r.nextResolution,s.zDirection),T=Va(e,e.nextExtent);this.enqueueTiles(e,T,x,c,h)}this.enqueueTiles(e,l,u,c,0),h>0&&setTimeout(()=>{this.enqueueTiles(e,l,u-1,c,h-1)},0);const f={};let p=!1;const d=c.representationsByZ;if(u in d){const x=Te(this),T=e.time;for(const b of d[u]){const E=b.tile;if(E.getState()===pe.EMPTY)continue;const w=E.tileCoord;if(b.ready){const R=E.getAlpha(x,T);if(R===1){E.endTransition(x);continue}p=!0;const C=Hn(w);f[C]=R}if(this.renderComplete=!1,this.findAltTiles_(o,w,u+1,c))continue;const v=o.getMinZoom();for(let R=u-1;R>=v&&!this.findAltTiles_(o,w,R,c);--R);}}const g=Object.keys(d).map(Number).sort(s_);if(this.beforeTilesMaskRender(e))for(let x=0,T=g.length;x<T;++x){const b=g[x];for(const E of d[b]){const w=E.tile.tileCoord;if(Hn(w)in f)continue;const v=o.getTileCoordExtent(w);this.renderTileMask(E,b,v,Tf(b))}}this.beforeTilesRender(e,p);for(let x=0,T=g.length;x<T;++x){const b=g[x];for(const E of d[b]){const w=E.tile.tileCoord;Hn(w)in f||this.drawTile_(e,E,b,a,l,f,o)}}if(u in d)for(const x of d[u]){const T=x.tile.tileCoord;Hn(T)in f&&this.drawTile_(e,x,u,a,l,f,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas();return this.tileRepresentationCache.expireCache(),this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let c=s.minY;c<=s.maxY;++c){const h=Dl(l,[r,u,c]);let f=!1;if(a.containsKey(h)){const p=a.get(h);p.ready&&!wf(i,p.tile)&&(vf(i,p,r),f=!0)}f||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const te={...Cw,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},no={TEXTURE_COORD:"a_textureCoord"},Mw=[{name:no.TEXTURE_COORD,size:2,type:We.FLOAT}];class Ow extends Fw{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new sn(As,Qu),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const r of this.paletteTextures_)r.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const r of this.paletteTextures_)r.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new Iw(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,i,s,o,a,l,u,c,h){const f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Mw);let p=0;for(;p<e.textures.length;){const E=`${te.TILE_TEXTURE_ARRAY}[${p}]`;this.helper.bindTexture(e.textures[p],p,E),++p}for(let E=0;E<this.paletteTextures_.length;++E){const w=this.paletteTextures_[E],S=w.getTexture(f);this.helper.bindTexture(S,p,w.name),++p}const d=r.viewState,g=o[0]+2*c,m=o[1]+2*c,_=e.tile.tileCoord,x=_[1],T=_[2];this.helper.setUniformMatrixValue(te.TILE_TRANSFORM,So(this.tempMat4,t)),this.helper.setUniformFloatValue(te.TRANSITION_ALPHA,h),this.helper.setUniformFloatValue(te.DEPTH,u);let b=i;c>0&&(b=l,Er(b,i,b)),this.helper.setUniformFloatVec4(te.RENDER_EXTENT,b),this.helper.setUniformFloatValue(te.RESOLUTION,d.resolution),this.helper.setUniformFloatValue(te.ZOOM,d.zoom),this.helper.setUniformFloatValue(te.TEXTURE_PIXEL_WIDTH,g),this.helper.setUniformFloatValue(te.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(te.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(te.TEXTURE_ORIGIN_X,a[0]+x*o[0]*s-c*s),this.helper.setUniformFloatValue(te.TEXTURE_ORIGIN_Y,a[1]-T*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const r=this.frameState;if(!r)return null;const i=this.getLayer(),s=Ur(r.pixelToCoordinateTransform,e.slice()),o=r.viewState,a=i.getExtent();if(a&&!ei(Kd(a,o.projection),s))return null;const l=i.getSources(yu([s]),o.resolution);let u,c,h;for(u=l.length-1;u>=0;--u)if(c=l[u],c.getState()==="ready"){if(h=c.getTileGridForProjection(o.projection),c.getWrapX())break;const p=h.getExtent();if(!p||ei(p,s))break}if(u<0)return null;const f=this.tileRepresentationCache;for(let p=h.getZForResolution(o.resolution);p>=h.getMinZoom();--p){const d=h.getTileCoordForCoordAndZ(s,p),g=Dl(c,d);if(!f.containsKey(g))continue;const m=f.get(g);if(m.tile.getState()===pe.EMPTY)return null;if(!m.loaded)continue;const _=h.getOrigin(p),x=ur(h.getTileSize(p)),T=h.getResolution(p),b=(s[0]-_[0])/T-d[1]*x[0],E=(_[1]-s[1])/T-d[2]*x[1];return m.getPixelData(b,E)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const r of this.paletteTextures_)r.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class Nw{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function Dw(n,e){return`operator_${n}_${Object.keys(e.functions).length}`}function on(n){const e=n.toString();return e.includes(".")?e:e+".0"}function ec(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(on).join(", ")})`}function io(n){const e=bs(n),t=e.length>3?e[3]:1;return ec([e[0]/255,e[1]/255,e[2]/255,t])}function Gw(n){const e=ur(n);return ec(e)}const Xa={};let Uw=0;function fi(n){return n in Xa||(Xa[n]=Uw++),Xa[n]}function Mr(n){return on(fi(n))}function la(n){return"u_var_"+n}function tc(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const Za="getBandValue",cg="u_paletteTextures",hg="featureId",fg="geometryType",Gl=-9999999;function Bw(n,e,t,r){const i=o_(n,e,t);return rc(i,e,r)}function Ee(n){return(e,t,r)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=rc(t.args[o],r,e);return n(s,e)}}const kw={[ie.Get]:(n,e)=>{const r=e.args[0].value;r in n.properties||(n.properties[r]={name:r,type:e.type});let s="a_prop_"+r;return Eh(e.type,es)&&(s=`(${s} > 0.0)`),s},[ie.Id]:n=>(n.featureId=!0,"a_"+hg),[ie.GeometryType]:n=>(n.geometryType=!0,"a_"+fg),[ie.LineMetric]:()=>"currentLineMetric",[ie.Var]:(n,e)=>{const r=e.args[0].value;r in n.variables||(n.variables[r]={name:r,type:e.type});let s=la(r);return Eh(e.type,es)&&(s=`(${s} > 0.0)`),s},[ie.Has]:(n,e)=>{const r=e.args[0].value;return r in n.properties||(n.properties[r]={name:r,type:e.type}),`(a_prop_${r} != ${on(Gl)})`},[ie.Resolution]:()=>"u_resolution",[ie.Zoom]:()=>"u_zoom",[ie.Time]:()=>"u_time",[ie.Any]:Ee(n=>`(${n.join(" || ")})`),[ie.All]:Ee(n=>`(${n.join(" && ")})`),[ie.Not]:Ee(([n])=>`(!${n})`),[ie.Equal]:Ee(([n,e])=>`(${n} == ${e})`),[ie.NotEqual]:Ee(([n,e])=>`(${n} != ${e})`),[ie.GreaterThan]:Ee(([n,e])=>`(${n} > ${e})`),[ie.GreaterThanOrEqualTo]:Ee(([n,e])=>`(${n} >= ${e})`),[ie.LessThan]:Ee(([n,e])=>`(${n} < ${e})`),[ie.LessThanOrEqualTo]:Ee(([n,e])=>`(${n} <= ${e})`),[ie.Multiply]:Ee(n=>`(${n.join(" * ")})`),[ie.Divide]:Ee(([n,e])=>`(${n} / ${e})`),[ie.Add]:Ee(n=>`(${n.join(" + ")})`),[ie.Subtract]:Ee(([n,e])=>`(${n} - ${e})`),[ie.Clamp]:Ee(([n,e,t])=>`clamp(${n}, ${e}, ${t})`),[ie.Mod]:Ee(([n,e])=>`mod(${n}, ${e})`),[ie.Pow]:Ee(([n,e])=>`pow(${n}, ${e})`),[ie.Abs]:Ee(([n])=>`abs(${n})`),[ie.Floor]:Ee(([n])=>`floor(${n})`),[ie.Ceil]:Ee(([n])=>`ceil(${n})`),[ie.Round]:Ee(([n])=>`floor(${n} + 0.5)`),[ie.Sin]:Ee(([n])=>`sin(${n})`),[ie.Cos]:Ee(([n])=>`cos(${n})`),[ie.Atan]:Ee(([n,e])=>e!==void 0?`atan(${n}, ${e})`:`atan(${n})`),[ie.Sqrt]:Ee(([n])=>`sqrt(${n})`),[ie.Match]:Ee(n=>{const e=n[0],t=n[n.length-1];let r=null;for(let i=n.length-3;i>=1;i-=2){const s=n[i],o=n[i+1];r=`(${e} == ${s} ? ${o} : ${r||t})`}return r}),[ie.Between]:Ee(([n,e,t])=>`(${n} >= ${e} && ${n} <= ${t})`),[ie.Interpolate]:Ee(([n,e,...t])=>{let r="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=r||t[i+1],a=t[i+2],l=t[i+3];let u;n===on(1)?u=`(${e} - ${s}) / (${a} - ${s})`:u=`(pow(${n}, (${e} - ${s})) - 1.0) / (pow(${n}, (${a} - ${s})) - 1.0)`,r=`mix(${o}, ${l}, clamp(${u}, 0.0, 1.0))`}return r}),[ie.Case]:Ee(n=>{const e=n[n.length-1];let t=null;for(let r=n.length-3;r>=0;r-=2){const i=n[r],s=n[r+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[ie.In]:Ee(([n,...e],t)=>{const r=Dw("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[r]=`bool ${r}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${r}(${n})`}),[ie.Array]:Ee(n=>`vec${n.length}(${n.join(", ")})`),[ie.Color]:Ee(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`vec4(vec3(${n[0]} / 255.0), ${n[1]})`;const e=n.slice(0,3).map(r=>`${r} / 255.0`);if(n.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=n[3];return`vec4(${e.join(", ")}, ${t})`}),[ie.Band]:Ee(([n,e,t],r)=>{if(!(Za in r.functions)){let i="";const s=r.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const u=`${te.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${u}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[Za]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${te.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${te.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${Za}(${n}, ${e??"0.0"}, ${t??"0.0"})`}),[ie.Palette]:(n,e)=>{const[t,...r]=e.args,i=r.length,s=new Uint8Array(i*4);for(let u=0;u<r.length;u++){const c=r[u].value,h=bs(c),f=u*4;s[f]=h[0],s[f+1]=h[1],s[f+2]=h[2],s[f+3]=h[3]*255}n.paletteTextures||(n.paletteTextures=[]);const o=`${cg}[${n.paletteTextures.length}]`,a=new Nw(o,s);n.paletteTextures.push(a);const l=rc(t,ye,n);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function rc(n,e,t){if(n instanceof a_){const r=kw[n.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return r(t,n,e)}if((n.type&ye)>0)return on(n.value);if((n.type&es)>0)return n.value.toString();if((n.type&ts)>0)return Mr(n.value.toString());if((n.type&Ot)>0)return io(n.value);if((n.type&Mn)>0)return ec(n.value);if((n.type&kn)>0)return Gw(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${l_(e)})`)}function zw(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Sf=.985;function K(n,e,t){const r=u_();return Bw(e,t,r,n)}function $w(n){const e=bs(n),t=e[0]*256,r=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+r,i+s]}const jw=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function nc(n){return n===Ot||n===kn?2:n===Mn?4:1}function Ul(n){const e=nc(n);return e>1?`vec${e}`:"float"}function dg(n,e){for(const t in e.variables){const r=e.variables[t],i=la(r.name);let s=Ul(r.type);r.type===Ot&&(s="vec4"),n.addUniform(i,s)}for(const t in e.properties){const r=e.properties[t],i=Ul(r.type),s=`a_prop_${r.name}`;r.type===Ot?n.addAttribute(s,i,`unpackColor(${s})`,"vec4"):n.addAttribute(s,i)}for(const t in e.functions)n.addVertexShaderFunction(e.functions[t]),n.addFragmentShaderFunction(e.functions[t])}function pg(n,e){const t={};for(const r in n.variables){const i=n.variables[r],s=la(i.name);t[s]=()=>{const o=e[i.name];if(typeof o=="number")return o;if(typeof o=="boolean")return o?1:0;if(i.type===Ot){const a=[...bs(o||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??(a[3]=1),a}return typeof o=="string"?fi(o):o}}return t}function gg(n){const e={};for(const t in n.properties){const r=n.properties[t],i=s=>{const o=s.get(r.name);return r.type===Ot?$w([...bs(o||"#eee")]):typeof o=="string"?fi(o):typeof o=="boolean"?o?1:0:o};e[`prop_${r.name}`]={size:nc(r.type),callback:i}}return e}const jn=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${jw}
`,Vn=zw();class mg{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${on(Vn["circle-radius"])} + ${on(Vn["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=io(Vn["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=on(Vn["stroke-width"]),this.strokeColorExpression_=io(Vn["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Mr("round"),this.strokeJoinExpression_=Mr("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=io(Vn["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e,t){return this.uniforms_.push({name:e,type:t}),this}addAttribute(e,t,r,i){return this.attributes_.push({name:e,type:t,varyingName:e.replace(/^a_/,"v_"),varyingType:i??t,varyingExpression:r??e}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setStrokePatternLengthExpression(e){return this.strokePatternLengthExpression_=e,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){return this.vertexShaderFunctions_.includes(e)?this:(this.vertexShaderFunctions_.push(e),this)}addFragmentShaderFunction(e){return this.fragmentShaderFunctions_.includes(e)?this:(this.fragmentShaderFunctions_.push(e),this)}getSymbolVertexShader(){return this.hasSymbol_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Sf} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Sf}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Mr("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Mr("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Mr("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Mr("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${jn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}class Po{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let r=0;r<e.length;r++)this.addFeature(e[r],t)}addFeature(e,t){let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}clearFeatureEntryInPointBatch_(e){const t=Te(e),r=this.pointBatch.entries[t];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[t],r}clearFeatureEntryInLineStringBatch_(e){const t=Te(e),r=this.lineStringBatch.entries[t];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[t],r}clearFeatureEntryInPolygonBatch_(e){const t=Te(e),r=this.polygonBatch.entries[t];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[t],r}addGeometry_(e,t){var i;const r=e.getType();switch(r){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEndss(),t,Te(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,Te(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Te(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,Te(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Te(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Te(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,r,i,s,o,a){let l;switch(e){case"MultiPolygon":{const u=r;for(let c=0,h=u.length;c<h;c++){let f=u[c];const p=c>0?u[c-1]:null,d=p?p[p.length-1]:0,g=f[f.length-1];f=d>0?f.map(m=>m-d):f,this.addCoordinates_("Polygon",t.slice(d,g),f,i,s,o,a)}break}case"MultiLineString":{const u=r;for(let c=0,h=u.length;c<h;c++){const f=c>0?u[c-1]:0;this.addCoordinates_("LineString",t.slice(f,u[c]),null,i,s,o,a)}break}case"MultiPoint":for(let u=0,c=t.length;u<c;u+=o)this.addCoordinates_("Point",t.slice(u,u+2),null,i,s,null,null);break;case"Polygon":{const u=r;if(i instanceof c_){const f=h_(t,u);if(f.length>1){this.addCoordinates_("MultiPolygon",t,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const c=r.length,h=r.map((f,p,d)=>p>0?(f-d[p-1])/o:f/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=c,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(Vw(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(h),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=c;for(let f=0,p=u.length;f<p;f++){const d=f>0?u[f-1]:0;this.addCoordinates_("LinearRing",t.slice(d,u[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(Xw(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(e,t){const r=this.uidToRef_.get(e),i=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,r||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e,t){if(!this.uidToRef_.get(Te(e)))return;this.removeFeature(e);let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,Te(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new Po;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let r=!0;for(const i of this.refToFeature_.values())e(i)&&(t.addFeature(i),r=!1);return r?new Po:t}}function Vw(n,e){return e===2?n:n.filter((t,r)=>r%e<2)}function Xw(n,e,t){return e===3&&t==="XYM"?n:e===4?n.filter((r,i)=>i%e!==2):e===3?n.map((r,i)=>i%e!==2?r:0):new Array(n.length*1.5).fill(0).map((r,i)=>i%3===2?0:n[Math.round(i/1.5)])}function yg(){const n='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}const Zi={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function _g(n,e){e=e||[];const t=256,r=t-1,i=Math.floor(n/t/t/t)/r,s=Math.floor(n/t/t)%t/r,o=Math.floor(n/t)%t/r,a=n%t/r;return e[0]=i*256*255+s*255,e[1]=o*256*255+a*255,e}function xg(n){let e=0;const t=256,r=t-1;return e+=Math.round(n[0]*t*t*t*r),e+=Math.round(n[1]*t*t*r),e+=Math.round(n[2]*t*r),e+=Math.round(n[3]*r),e}function ic(n,e,t,r){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);let l=(a==null?void 0:a[0])??a;l===Gl&&console.warn('The "has" operator might return false positives.'),l===void 0?l=Gl:l===null&&(l=0),n[r+i++]=l,!(!o.size||o.size===1)&&(n[r+i++]=a[1],!(o.size<3)&&(n[r+i++]=a[2],!(o.size<4)&&(n[r+i++]=a[3])))}return i}function ua(n){return Object.keys(n).reduce((e,t)=>e+(n[t].size||1),0)}function Zw(n,e,t,r){const i=(2+ua(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++)s[0]=l.flatCoordss[u][0],s[1]=l.flatCoordss[u][1],Ur(r,s),e[o++]=s[0],e[o++]=s[1],o+=ic(e,t,l,o)}return e}function Ww(n,e,t,r){const i=3*n.verticesCount+(1+ua(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++){s.length=l.flatCoordss[u].length,Jd(l.flatCoordss[u],0,s.length,3,r,s,3),o+=ic(e,t,l,o),e[o++]=s.length/3;for(let h=0,f=s.length;h<f;h+=3)e[o++]=s[h],e[o++]=s[h+1],e[o++]=s[h+2]}}return e}function Hw(n,e,t,r){const i=2*n.verticesCount+(1+ua(t))*n.geometriesCount+n.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++){s.length=l.flatCoordss[u].length,Jd(l.flatCoordss[u],0,s.length,2,r,s),o+=ic(e,t,l,o),e[o++]=l.ringsVerticesCounts[u].length;for(let h=0,f=l.ringsVerticesCounts[u].length;h<f;h++)e[o++]=l.ringsVerticesCounts[u][h];for(let h=0,f=s.length;h<f;h+=2)e[o++]=s[h],e[o++]=s[h+1]}}return e}function Ao(n){return(JSON.stringify(n).split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0),0)>>>0).toString()}function sc(n,e,t,r){if(`${r}radius`in n&&r!=="icon-"){let i=K(t,n[`${r}radius`],ye);if(`${r}radius2`in n){const s=K(t,n[`${r}radius2`],ye);i=`max(${i}, ${s})`}`${r}stroke-width`in n&&(i=`(${i} + ${K(t,n[`${r}stroke-width`],ye)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${r}scale`in n){const i=K(t,n[`${r}scale`],kn);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${r}displacement`in n&&e.setSymbolOffsetExpression(K(t,n[`${r}displacement`],Mn)),`${r}rotation`in n&&e.setSymbolRotationExpression(K(t,n[`${r}rotation`],ye)),`${r}rotate-with-view`in n&&e.setSymbolRotateWithView(!!n[`${r}rotate-with-view`])}function bg(n,e,t,r,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&r!==null){const l=`smoothstep(-${r} + 0.63, -${r} - 0.58, ${n})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${n}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function oc(n,e,t,r,i){const s=new Image;s.crossOrigin=n[`${r}cross-origin`]===void 0?"anonymous":n[`${r}cross-origin`],Wt(typeof n[`${r}src`]=="string",`WebGL layers do not support expressions for the ${r}src style property`),s.src=n[`${r}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`u_texture${i}_size`,"vec2");const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`u_texture${i}`,"sampler2D"),o}function ac(n,e,t,r,i){let s=K(t,n[`${e}offset`],kn);if(`${e}offset-origin`in n)switch(n[`${e}offset-origin`]){case"top-right":s=`vec2(${r}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${r}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${r} - ${i} - ${s}`;break}return s}function qw(n,e,t,r){r.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,sc(n,e,r,"circle-");let i=null;"circle-opacity"in n&&(i=K(r,n["circle-opacity"],ye));let s="coordsPx";"circle-scale"in n&&(s=`coordsPx / ${K(r,n["circle-scale"],kn)}`);let o=null;"circle-fill-color"in n&&(o=K(r,n["circle-fill-color"],Ot));let a=null;"circle-stroke-color"in n&&(a=K(r,n["circle-stroke-color"],Ot));let l=K(r,n["circle-radius"],ye),u=null;"circle-stroke-width"in n&&(u=K(r,n["circle-stroke-width"],ye),l=`(${l} + ${u} * 0.5)`);const c=`circleDistanceField(${s}, ${l})`,h=bg(c,o,a,u,i);e.setSymbolColorExpression(h)}function Yw(n,e,t,r){r.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,r.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,r.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,sc(n,e,r,"shape-");let i=null;"shape-opacity"in n&&(i=K(r,n["shape-opacity"],ye));let s="coordsPx";"shape-scale"in n&&(s=`coordsPx / ${K(r,n["shape-scale"],kn)}`);let o=null;"shape-fill-color"in n&&(o=K(r,n["shape-fill-color"],Ot));let a=null;"shape-stroke-color"in n&&(a=K(r,n["shape-stroke-color"],Ot));let l=null;"shape-stroke-width"in n&&(l=K(r,n["shape-stroke-width"],ye));const u=K(r,n["shape-points"],ye);let c="0.";"shape-angle"in n&&(c=K(r,n["shape-angle"],ye));let h,f=K(r,n["shape-radius"],ye);if(l!==null&&(f=`${f} + ${l} * 0.5`),"shape-radius2"in n){let d=K(r,n["shape-radius2"],ye);l!==null&&(d=`${d} + ${l} * 0.5`),h=`starDistanceField(${s}, ${u}, ${f}, ${d}, ${c})`}else h=`regularDistanceField(${s}, ${u}, ${f}, ${c})`;const p=bg(h,o,a,l,i);e.setSymbolColorExpression(p)}function Kw(n,e,t,r){let i="vec4(1.0)";"icon-color"in n&&(i=K(r,n["icon-color"],Ot)),"icon-opacity"in n&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${K(r,n["icon-opacity"],ye)})`);const s=Ao(n["icon-src"]),o=oc(n,e,t,"icon-",s);if(e.setSymbolColorExpression(`${i} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in n&&"icon-height"in n&&e.setSymbolSizeExpression(`vec2(${K(r,n["icon-width"],ye)}, ${K(r,n["icon-height"],ye)})`),"icon-offset"in n&&"icon-size"in n){const a=K(r,n["icon-size"],Mn),l=e.getSymbolSizeExpression();e.setSymbolSizeExpression(a);const u=ac(n,"icon-",r,"v_quadSizePx",a);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(sc(n,e,r,"icon-"),"icon-anchor"in n){const a=K(r,n["icon-anchor"],Mn);let l="1.0";"icon-scale"in n&&(l=K(r,n["icon-scale"],kn));let u;n["icon-anchor-x-units"]==="pixels"&&n["icon-anchor-y-units"]==="pixels"?u=`${a} * ${l}`:n["icon-anchor-x-units"]==="pixels"?u=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:n["icon-anchor-y-units"]==="pixels"?u=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:u=`${a} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in n)switch(n["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${c}`)}}function Jw(n,e,t,r){if("stroke-color"in n&&e.setStrokeColorExpression(K(r,n["stroke-color"],Ot)),"stroke-pattern-src"in n){const i=Ao(n["stroke-pattern-src"]),s=oc(n,e,t,"stroke-pattern-",i);let o=s,a="vec2(0.)";"stroke-pattern-offset"in n&&"stroke-pattern-size"in n&&(o=K(r,n["stroke-pattern-size"],Mn),a=ac(n,"stroke-pattern-",r,s,o));let l="0.";"stroke-pattern-spacing"in n&&(l=K(r,n["stroke-pattern-spacing"],ye));let u="0.";"stroke-pattern-start-offset"in n&&(u=K(r,n["stroke-pattern-start-offset"],ye)),r.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;const c=`u_texture${i}`;let h="1.";"stroke-color"in n&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${c}, ${s}, ${a}, ${o}, ${l}, ${u}, currentLengthPx, currentRadiusRatio, v_width)`),r.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,e.setStrokePatternLengthExpression(`computeStrokePatternLength(${o}, ${l}, v_width)`)}if("stroke-width"in n&&e.setStrokeWidthExpression(K(r,n["stroke-width"],ye)),"stroke-offset"in n&&e.setStrokeOffsetExpression(K(r,n["stroke-offset"],ye)),"stroke-line-cap"in n&&e.setStrokeCapExpression(K(r,n["stroke-line-cap"],ts)),"stroke-line-join"in n&&e.setStrokeJoinExpression(K(r,n["stroke-line-join"],ts)),"stroke-miter-limit"in n&&e.setStrokeMiterLimitExpression(K(r,n["stroke-miter-limit"],ye)),"stroke-line-dash"in n){r.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Mr("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${Mr("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=n["stroke-line-dash"].map(d=>K(r,d,ye));i.length%2===1&&(i=[...i,...i]);let s="0.";"stroke-line-dash-offset"in n&&(s=K(r,n["stroke-line-dash-offset"],ye));const a=`dashDistanceField_${Ao(n["stroke-line-dash"])}`,l=i.map((d,g)=>`float dashLength${g}`).join(", "),u=i.map((d,g)=>`dashLength${g}`).join(" + ");let c="0.",h=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType, lineWidth)`;for(let d=2;d<i.length;d+=2)c=`${c} + dashLength${d-2} + dashLength${d-1}`,h=`min(${h}, getSingleDashDistance(distance, radius, ${c}, dashLength${d}, totalDashLength, capType, lineWidth))`;r.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${u};
  return ${h};
}`;const f=i.map((d,g)=>`${d}`).join(", ");e.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width, ${f})`);let p=i.join(" + ");e.getStrokePatternLengthExpression()&&(r.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,p=`combinePatternLengths(${e.getStrokePatternLengthExpression()}, ${p})`),e.setStrokePatternLengthExpression(p)}}function Qw(n,e,t,r){if("fill-color"in n&&e.setFillColorExpression(K(r,n["fill-color"],Ot)),"fill-pattern-src"in n){const i=Ao(n["fill-pattern-src"]),s=oc(n,e,t,"fill-pattern-",i);let o=s,a="vec2(0.)";"fill-pattern-offset"in n&&"fill-pattern-size"in n&&(o=K(r,n["fill-pattern-size"],Mn),a=ac(n,"fill-pattern-",r,s,o)),r.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${i}`;let u="1.";"fill-color"in n&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${l}, ${s}, ${a}, ${o}, pxOrigin, pxPos)`)}}function Bl(n,e,t){const r=tc(),i=new mg,s={};if("icon-src"in n?Kw(n,i,s,r):"shape-points"in n?Yw(n,i,s,r):"circle-radius"in n&&qw(n,i,s,r),Jw(n,i,s,r),Qw(n,i,s,r),t){const l=K(r,t,es);i.setFragmentDiscardExpression(`!${l}`)}const o={};function a(l,u,c,h){if(!r[l])return;const f=Ul(c),p=nc(c);i.addAttribute(`a_${u}`,f),o[u]={size:p,callback:h}}return a("geometryType",fg,ts,l=>fi(f_(l.getGeometry()))),a("featureId",hg,ts|ye,l=>{const u=l.getId()??null;return typeof u=="string"?fi(u):u}),dg(i,r),{builder:i,attributes:{...o,...gg(r)},uniforms:{...s,...pg(r,e)}}}const ev=[];let Wa;function tv(){return Wa||(Wa=yg()),Wa}let rv=0;const Kt={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"};class nv{constructor(e,t,r,i){this.helper_,this.hitDetectionEnabled_=!!i,this.styleShaders=iv(e,t),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return _g(this.ref,ev)},size:2});for(const s of this.styleShaders){for(const o in s.attributes)o in this.customAttributes_||(this.customAttributes_[o]=s.attributes[o]);for(const o in s.uniforms)o in this.uniforms_||(this.uniforms_[o]=s.uniforms[o])}this.renderPasses_=this.styleShaders.map(s=>{const o={},a=Object.entries(this.customAttributes_).map(([l,u])=>({name:l in s.attributes||l==="hitColor"?`a_${l}`:null,size:u.size||1,type:We.FLOAT}));return s.builder.getFillVertexShader()&&(o.fillRenderPass={vertexShader:s.builder.getFillVertexShader(),fragmentShader:s.builder.getFillFragmentShader(),attributesDesc:[{name:Kt.POSITION,size:2,type:We.FLOAT},...a],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),s.builder.getStrokeVertexShader()&&(o.strokeRenderPass={vertexShader:s.builder.getStrokeVertexShader(),fragmentShader:s.builder.getStrokeFragmentShader(),attributesDesc:[{name:Kt.LOCAL_POSITION,size:2,type:We.FLOAT}],instancedAttributesDesc:[{name:Kt.SEGMENT_START,size:2,type:We.FLOAT},{name:Kt.MEASURE_START,size:1,type:We.FLOAT},{name:Kt.SEGMENT_END,size:2,type:We.FLOAT},{name:Kt.MEASURE_END,size:1,type:We.FLOAT},{name:Kt.JOIN_ANGLES,size:2,type:We.FLOAT},{name:Kt.DISTANCE_LOW,size:1,type:We.FLOAT},{name:Kt.DISTANCE_HIGH,size:1,type:We.FLOAT},{name:Kt.ANGLE_TANGENT_SUM,size:1,type:We.FLOAT},...a],instancePrimitiveVertexCount:6}),s.builder.getSymbolVertexShader()&&(o.symbolRenderPass={vertexShader:s.builder.getSymbolVertexShader(),fragmentShader:s.builder.getSymbolFragmentShader(),attributesDesc:[{name:Kt.LOCAL_POSITION,size:2,type:We.FLOAT}],instancedAttributesDesc:[{name:Kt.POSITION,size:2,type:We.FLOAT},...a],instancePrimitiveVertexCount:6}),o}),this.hasFill_=this.renderPasses_.some(s=>s.fillRenderPass),this.hasStroke_=this.renderPasses_.some(s=>s.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(s=>s.symbolRenderPass),this.setHelper(r)}async generateBuffers(e,t){if(e.isEmpty())return null;const r=this.generateRenderInstructions_(e,t),[i,s,o]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",t),this.generateBuffersForType_(r.lineStringInstructions,"LineString",t),this.generateBuffersForType_(r.pointInstructions,"Point",t)]),a=rs(_t(),t);return{polygonBuffers:i,lineStringBuffers:s,pointBuffers:o,invertVerticesTransform:a}}generateRenderInstructions_(e,t){const r=this.hasFill_?Hw(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?Ww(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?Zw(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:r,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,r){if(e===null)return null;const i=rv++;let s;switch(t){case"Polygon":s=Zi.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Zi.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Zi.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:r,customAttributesSize:ua(this.customAttributes_)},a=tv();return a.postMessage(o,[e.buffer]),e=null,new Promise(l=>{const u=c=>{const h=c.data;if(h.id!==i||(a.removeEventListener("message",u),!this.helper_.getGL()))return;const f=new sn(As,ii).fromArrayBuffer(h.indicesBuffer),p=new sn(Un,ii).fromArrayBuffer(h.vertexAttributesBuffer),d=new sn(Un,ii).fromArrayBuffer(h.instanceAttributesBuffer);this.helper_.flushBufferData(f),this.helper_.flushBufferData(p),this.helper_.flushBufferData(d),l([f,p,d])};a.addEventListener("message",u)})}render(e,t,r){for(const i of this.renderPasses_)i.fillRenderPass&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],e.polygonBuffers[2],i.fillRenderPass,t,r),i.strokeRenderPass&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],e.lineStringBuffers[2],i.strokeRenderPass,t,r),i.symbolRenderPass&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],e.pointBuffers[2],i.symbolRenderPass,t,r)}renderInternal_(e,t,r,i,s,o){const a=e.getSize();if(a===0)return;const l=i.instancedAttributesDesc.length;if(this.helper_.useProgram(i.program,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i.attributesDesc),this.helper_.bindBuffer(r),this.helper_.enableAttributesInstanced(i.instancedAttributesDesc),o(),l){const u=i.instancedAttributesDesc.reduce((h,f)=>h+(f.size||1),0),c=r.getSize()/u;this.helper_.drawElementsInstanced(0,a,c)}else this.helper_.drawElements(0,a)}setHelper(e,t=null){this.helper_=e;for(const r of this.renderPasses_)r.fillRenderPass&&(r.fillRenderPass.program=this.helper_.getProgram(r.fillRenderPass.fragmentShader,r.fillRenderPass.vertexShader)),r.strokeRenderPass&&(r.strokeRenderPass.program=this.helper_.getProgram(r.strokeRenderPass.fragmentShader,r.strokeRenderPass.vertexShader)),r.symbolRenderPass&&(r.symbolRenderPass.program=this.helper_.getProgram(r.symbolRenderPass.fragmentShader,r.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1]),this.helper_.flushBufferData(t.polygonBuffers[2])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1]),this.helper_.flushBufferData(t.lineStringBuffers[2])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1]),this.helper_.flushBufferData(t.pointBuffers[2])))}}function iv(n,e){const t=Array.isArray(n)?n:[n];if("style"in t[0]){const r=[],i=t,s=[];for(const o of i){const a=Array.isArray(o.style)?o.style:[o.style];let l=o.filter;o.else&&s.length&&(l=["all",...s.map(c=>["!",c])],o.filter&&l.push(o.filter),l.length<3&&(l=l[1])),o.filter&&s.push(o.filter);const u=a.map(c=>Bl(c,e,l));r.push(...u)}return r}return"builder"in t[0]?t:t.map(r=>Bl(r,e,null))}const dr=new Uint8Array(4);class Eg{constructor(e,t){this.helper_=e;const r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){d_(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return dr[0]=0,dr[1]=0,dr[2]=0,dr[3]=0,dr;this.readAll();const r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return dr[0]=this.data_[r*4],dr[1]=this.data_[r*4+1],dr[2]=this.data_[r*4+2],dr[3]=this.data_[r*4+3],dr}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}function Tg(n,e){const t=n.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=n.extent,a=i?xt(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}const Xn={...yr,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class wg extends Is{constructor(e,t){const r={[Xn.RENDER_EXTENT]:[0,0,0,0],[Xn.PATTERN_ORIGIN]:[0,0],[Xn.GLOBAL_ALPHA]:1};super(e,{uniforms:r,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=Es(),this.currentTransform_=_t(),this.tmpCoords_=[0,0],this.tmpTransform_=_t(),this.tmpMat4_=$n(),this.currentFrameStateTransform_=_t(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(t),this.batch_=new Po,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let r;this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[Or(t,Qr.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),Or(t,Qr.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,r),this),Or(t,Qr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Or(t,Qr.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.style_=e.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new nv(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Eg(this.helper))}handleSourceFeatureAdded_(e,t){const r=t.feature;this.batch_.addFeature(r,e)}handleSourceFeatureChanged_(e,t){const r=t.feature;this.batch_.changeFeature(r,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){p_(this.tmpTransform_,this.currentFrameStateTransform_),Ji(this.tmpTransform_,e),this.helper.setUniformMatrixValue(Xn.PROJECTION_MATRIX,So(this.tmpMat4_,this.tmpTransform_)),rs(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Xn.SCREEN_TO_WORLD_MATRIX,So(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,rs(this.tmpTransform_,e),Ur(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Xn.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=Tg(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[un.ANIMATING]&&!e.viewHints[un.INTERACTING],o=!Qi(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,c=t instanceof Yo?t.getRenderBuffer():0,h=vu(e.extent,c*u);r.loadFeatures(h,u,l),this.ready=!1;const f=this.helper.makeProjectionTransform(e,_t());this.styleRenderer_.generateBuffers(this.batch_,f).then(p=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=p,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,r,i,s){let o=r;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),wu(this.currentFrameStateTransform_,o*s,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,e,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)});while(++o<i)}forEachFeatureAtCoordinate(e,t,r,i,s){if(Wt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;const o=Ur(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=xg(l),c=this.batch_.getFeatureFromRef(u);if(c)return i(c,this.getLayer(),null)}disposeBuffers(e){const t=r=>{for(const i of r)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){go(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const Lr={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},sv=["#00f","#0ff","#0f0","#ff0","#f00"];class ov extends Yo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(Lr.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:sv),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const r=e.weight?e.weight:"weight";this.weight_=r,this.setRenderOrder(null)}getBlur(){return this.get(Lr.BLUR)}getGradient(){return this.get(Lr.GRADIENT)}getRadius(){return this.get(Lr.RADIUS)}handleGradientChanged_(){this.gradient_=av(this.getGradient())}setBlur(e){const t=this.get(Lr.BLUR);if(this.set(Lr.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(Lr.GRADIENT,e)}setRadius(e){const t=this.get(Lr.RADIUS);if(this.set(Lr.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new mg,t=tc(),r=K(t,this.filter_,es);let i=K(t,this.getRadius(),ye),s=K(t,this.getBlur(),ye);const o={};typeof this.getBlur()=="number"&&(s="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const a={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const h=typeof this.weight_=="string"?f=>f.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:f=>{const p=h(f);return p!==void 0?Ve(p,0,1):1}},l="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const h=["clamp",this.weight_,0,1];l=K(t,h,ye)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${s});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${s}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${s}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${r}`),dg(e,t);const u=gg(t),c=pg(t,this.styleVariables_);return new wg(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...u,...a},uniforms:{...c,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function av(n){const r=ln(1,256),i=r.createLinearGradient(0,0,1,256),s=1/(n.length-1);for(let o=0,a=n.length;o<a;++o)i.addColorStop(o*s,n[o]);return r.fillStyle=i,r.fillRect(0,0,1,256),r.canvas}class lc extends Qd{constructor(e,t,r,i,s){const o=s!==void 0?En.IDLE:En.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=En.ERROR):this.state=En.LOADED,this.changed()}load(){this.state==En.IDLE&&(this.state=En.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class lv extends g_{constructor(e){super(e),this.vectorRenderer_=new m_(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=_t(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=Ur(this.coordinateToVectorPixelTransform_,Ur(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){var c;const t=e.pixelRatio,r=e.viewState,i=r.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),ep(a,this.layerImageRatio_));const l=xt(a)/i,u=cr(a)/i;if(!s[un.ANIMATING]&&!s[un.INTERACTING]&&!xu(a)){o.useContainer(null,null);const h=o.context,f=e.layerStatesArray[e.layerIndex],p=Object.assign({},f,{opacity:1}),d=Object.assign({},e,{extent:a,size:[l,u],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[p],layerIndex:0,declutter:null}),g=this.getLayer().getDeclutter();g&&(d.declutter={[g]:new a0(9)});const m=new lc(a,i,t,h.canvas,function(y){o.prepareFrame(d)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(d,null),o.renderDeclutter(d),o.renderDeferred(d),y())});m.addEventListener(Ft.CHANGE,()=>{if(m.getState()!==En.LOADED)return;this.image=m;const y=m.getPixelRatio(),_=y_(m.getResolution())*t/y;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=bu(this.coordinateToVectorPixelTransform_,l/2,u/2,1/_,-1/_,0,-r.center[0],-r.center[1])}),m.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!((c=this.getLayer().getSource())!=null&&c.loading)&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,r,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,i,s):super.forEachFeatureAtCoordinate(e,t,r,i,s)}}class uv extends Yo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new lv(this)}}class cv extends Is{constructor(e,t){const r=t.uniforms||{},i=_t();r[yr.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new sn(Un,ii),this.instanceAttributesBuffer_=new sn(Un,ii),this.indicesBuffer_=new sn(As,ii),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:We.FLOAT}}):[];this.attributes=[{name:"a_localPosition",size:2,type:We.FLOAT}],this.instanceAttributes=[{name:"a_position",size:2,type:We.FLOAT}],this.hitDetectionEnabled_&&(this.instanceAttributes.push({name:"a_hitColor",size:2,type:We.FLOAT}),this.instanceAttributes.push({name:"a_featureUid",size:1,type:We.FLOAT})),this.instanceAttributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=Es(),this.currentTransform_=i,this.renderTransform_=_t(),this.invertRenderTransform_=_t(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=yg(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Zi.GENERATE_POINT_BUFFERS){const u=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexAttributesBuffer),this.instanceAttributesBuffer_.fromArrayBuffer(l.instanceAttributesBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.helper.flushBufferData(this.instanceAttributesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indicesBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=u,rs(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Or(o,Qr.ADDFEATURE,this.handleSourceFeatureAdded_,this),Or(o,Qr.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Or(o,Qr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Or(o,Qr.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{const l=a.getGeometry();l&&l.getType()==="Point"&&(this.featureCache_[Te(a)]={feature:a,properties:a.getProperties(),flatCoordinates:l.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Eg(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,r=t.getGeometry();r&&r.getType()==="Point"&&(this.featureCache_[Te(t)]={feature:t,properties:t.getProperties(),flatCoordinates:r.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,r=Te(t),i=this.featureCache_[r],s=t.getGeometry();i?s&&s.getType()==="Point"?(i.properties=t.getProperties(),i.flatCoordinates=s.getFlatCoordinates()):(delete this.featureCache_[r],this.featureCount_--):s&&s.getType()==="Point"&&(this.featureCache_[r]={feature:t,properties:t.getProperties(),flatCoordinates:s.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,r=Te(t);r in this.featureCache_&&(delete this.featureCache_[r],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=Tg(e,this.getLayer());return this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[un.ANIMATING]&&!e.viewHints[un.INTERACTING],o=!Qi(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,c=t instanceof Yo?t.getRenderBuffer():0,h=vu(e.extent,c*u);r.loadFeatures(h,u,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),!0}rebuildBuffers_(e){const t=_t();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?5:2)+this.customAttributes.length,s=i*this.featureCount_,o=this.renderInstructions_&&this.renderInstructions_.length===s?this.renderInstructions_:new Float32Array(s);this.renderInstructions_=null;let a=[];const l=[];let u=-1;e.viewState.projection;for(const h in this.featureCache_){const f=this.featureCache_[h];if(a[0]=f.flatCoordinates[0],a[1]=f.flatCoordinates[1],Ur(t,a),o[++u]=a[0],o[++u]=a[1],this.hitDetectionEnabled_){const p=_g(u+3,l);o[++u]=p[0],o[++u]=p[1],o[++u]=Number(h)}for(let p=0;p<this.customAttributes.length;p++){const d=this.customAttributes[p].callback(f.feature,f.properties);o[++u]=d}}const c={id:++this.lastSentId,type:Zi.GENERATE_POINT_BUFFERS,renderInstructions:o.buffer,customAttributesSize:i-2};c.projectionTransform=t,this.ready=!1,this.worker_.postMessage(c,[o.buffer])}forEachFeatureAtCoordinate(e,t,r,i,s){if(Wt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=Ur(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=xg(l),c=this.renderInstructions_[u],h=Math.floor(c).toString(),p=this.getLayer().getSource().getFeatureByUid(h);if(p)return i(p,this.getLayer(),null)}renderWorlds(e,t,r,i,s){let o=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));const a=this.instanceAttributes.reduce((u,c)=>u+(c.size||1),0),l=this.instanceAttributesBuffer_.getSize()/a;do{this.helper.bindBuffer(this.indicesBuffer_),this.helper.bindBuffer(this.verticesBuffer_),this.helper.enableAttributes(this.attributes),this.helper.bindBuffer(this.instanceAttributesBuffer_),this.helper.enableAttributesInstanced(this.instanceAttributes),this.helper.makeProjectionTransform(e,this.currentTransform_),wu(this.currentTransform_,o*s,0),Ji(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const u=this.indicesBuffer_.getSize();this.helper.drawElementsInstanced(0,u,l)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){go(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class hv extends Su{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=Bl(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new cv(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function Rf(n,e){const t=`
    attribute vec2 ${no.TEXTURE_COORD};
    uniform mat4 ${te.TILE_TRANSFORM};
    uniform float ${te.TEXTURE_PIXEL_WIDTH};
    uniform float ${te.TEXTURE_PIXEL_HEIGHT};
    uniform float ${te.TEXTURE_RESOLUTION};
    uniform float ${te.TEXTURE_ORIGIN_X};
    uniform float ${te.TEXTURE_ORIGIN_Y};
    uniform float ${te.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${no.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${te.TEXTURE_ORIGIN_X} + ${te.TEXTURE_RESOLUTION} * ${te.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${te.TEXTURE_ORIGIN_Y} - ${te.TEXTURE_RESOLUTION} * ${te.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${te.TILE_TRANSFORM} * vec4(${no.TEXTURE_COORD}, ${te.DEPTH}, 1.0);
    }
  `,r={...tc(),bandCount:e},i=[];if(n.color!==void 0){const h=K(r,n.color,Ot);i.push(`color = ${h};`)}if(n.contrast!==void 0){const h=K(r,n.contrast,ye);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb - (${h} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const h=K(r,n.exposure,ye);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const h=K(r,n.saturation,ye);i.push(`
      float saturation = ${h} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const h=K(r,n.gamma,ye);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${h}));`)}if(n.brightness!==void 0){const h=K(r,n.brightness,ye);i.push(`color.rgb = clamp(color.rgb + ${h}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(r.variables).length;if(o>1&&!n.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let h=0;h<o;++h){const f=r.variables[Object.keys(r.variables)[h]];if(!(f.name in n.variables))throw new Error(`Missing '${f.name}' in style variables`);const p=la(f.name);s[p]=function(){let d=n.variables[f.name];return typeof d=="string"&&(d=fi(d)),d!==void 0?d:-9999999}}const a=Object.keys(s).map(function(h){return`uniform float ${h};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${te.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${cg}[${r.paletteTextures.length}];`);const u=Object.keys(r.functions).map(function(h){return r.functions[h]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${te.RENDER_EXTENT};
    uniform float ${te.TRANSITION_ALPHA};
    uniform float ${te.TEXTURE_PIXEL_WIDTH};
    uniform float ${te.TEXTURE_PIXEL_HEIGHT};
    uniform float ${te.RESOLUTION};
    uniform float ${te.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${te.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${te.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${te.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${te.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${te.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${te.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:r.paletteTextures}}class vg extends __{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(Sl.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Rf(this.style_,this.getSourceBandCount_());return new Ow(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],r.prepareFrame(e)&&(i=r.renderFrame(e));return i}render(e,t){this.rendered=!0;const r=e.viewState,i=this.getSources(e.extent,r.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const u=i[a],c=u.getState();if(c=="loading"){const h=()=>{u.getState()=="ready"&&(u.removeEventListener("change",h),this.changed())};u.addEventListener("change",h)}s=s&&c=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=r.resolution,o;if(this.renderedResolution_>.5*r.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=Rf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}vg.prototype.dispose;class fv extends Su{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new wg(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}class Sg{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=mp,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let r=t.dataProjection?Ue(t.dataProjection):this.readProjection(e);t.extent&&r&&r.getUnits()==="tile-pixels"&&(r=Ue(r),r.setWorldExtent(t.extent)),t={dataProjection:r,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return wt()}readFeature(e,t){return wt()}readFeatures(e,t){return wt()}readGeometry(e,t){return wt()}readProjection(e){return wt()}writeFeature(e,t){return wt()}writeFeatures(e,t){return wt()}writeGeometry(e,t){return wt()}}function ca(n,e,t){const r=t?Ue(t.featureProjection):null,i=t?Ue(t.dataProjection):null;let s=n;if(r&&i&&!St(r,i)){e&&(s=n.clone());const o=e?r:i,a=e?i:r;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(Ep(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let u=0,c=l.length;u<c;++u)l[u]=Math.round(l[u]*o)/o;return l};s===n&&(s=n.clone()),s.applyTransform(a)}return s}const dv={Point:bp,LineString:gp,Polygon:xp,MultiPoint:pp,MultiLineString:dp,MultiPolygon:fp};function pv(n,e,t){return Array.isArray(e[0])?(P0(n,0,e,t)||(n=n.slice(),A0(n,0,e,t)),n):(I0(n,0,e,t)||(n=n.slice(),C0(n,0,e,t)),n)}function Rg(n,e){var s;const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Rg({...n,geometry:o})).flat();const r=t.type==="MultiPolygon"?"Polygon":t.type;if(r==="GeometryCollection"||r==="Circle")throw new Error("Unsupported geometry type: "+r);const i=t.layout.length;return ca(new os(r,r==="Polygon"?pv(t.flatCoordinates,t.ends,i):t.flatCoordinates,(s=t.ends)==null?void 0:s.flat(),i,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function uc(n,e){if(!n)return null;if(Array.isArray(n)){const r=n.map(i=>uc(i,e));return new y0(r)}const t=dv[n.type];return ca(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class gv extends Sg{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Ws(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Ws(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return wt()}readFeaturesFromObject(e,t){return wt()}readGeometry(e,t){return this.readGeometryFromObject(Ws(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return wt()}readProjection(e){return this.readProjectionFromObject(Ws(e))}readProjectionFromObject(e){return wt()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return wt()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return wt()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return wt()}}function Ws(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class kl extends gv{constructor(e){e=e||{},super(),this.dataProjection=Ue(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=Ue(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let r=null;e.type==="Feature"?r=e:r={type:"Feature",geometry:e,properties:null};const i=cc(r.geometry);if(this.featureClass===os)return Rg({geometry:i,id:r.id,properties:r.properties},t);const s=new mp;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&r.geometry_name&&s.setGeometryName(r.geometry_name),s.setGeometry(uc(i,t)),"id"in r&&s.setId(r.id),r.properties&&s.setProperties(r.properties,!0),s}readFeaturesFromObject(e,t){const r=e;let i=null;if(r.type==="FeatureCollection"){const s=e;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const u=this.readFeatureFromObject(o[a],t);u&&i.push(u)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return mv(e,t)}readProjectionFromObject(e){const t=e.crs;let r;if(t)if(t.type=="name")r=Ue(t.properties.name);else if(t.type==="EPSG")r=Ue("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else r=this.dataProjection;return r}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(r.id=i),!e.hasProperties())return r;const s=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=zl(o,t),delete s[e.getGeometryName()]),op(s)||(r.properties=s),r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:r}}writeGeometryObject(e,t){return zl(e,this.adaptOptions(t))}}function cc(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=_v(n);break}case"LineString":{t=xv(n);break}case"Polygon":{t=wv(n);break}case"MultiPoint":{t=Ev(n);break}case"MultiLineString":{t=bv(n);break}case"MultiPolygon":{t=Tv(n);break}case"GeometryCollection":{t=yv(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function mv(n,e){const t=cc(n);return uc(t,e)}function yv(n,e){return n.geometries.map(function(r){return cc(r)})}function _v(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:Ti(e.length)}}function xv(n){var r;const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:Ti(((r=e[0])==null?void 0:r.length)||2)}}function bv(n){var s,o;const e=n.coordinates,t=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length)||2,r=[],i=Tp(r,0,e,t);return{type:"MultiLineString",flatCoordinates:r,ends:i,layout:Ti(t)}}function Ev(n){var t;const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Ti(((t=e[0])==null?void 0:t.length)||2)}}function Tv(n){var s,o;const e=n.coordinates,t=[],r=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,i=L0(t,0,e,r);return{type:"MultiPolygon",flatCoordinates:t,ends:i,layout:Ti(r)}}function wv(n){var s,o;const e=n.coordinates,t=[],r=(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length,i=Tp(t,0,e,r);return{type:"Polygon",flatCoordinates:t,ends:i,layout:Ti(r)}}function zl(n,e){n=ca(n,!0,e);const t=n.getType();let r;switch(t){case"Point":{r=Iv(n);break}case"LineString":{r=Sv(n);break}case"Polygon":{r=Cv(n,e);break}case"MultiPoint":{r=Pv(n);break}case"MultiLineString":{r=Rv(n);break}case"MultiPolygon":{r=Av(n,e);break}case"GeometryCollection":{r=vv(n,e);break}case"Circle":{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return r}function vv(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(r){return zl(r,e)})}}function Sv(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function Rv(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Pv(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Av(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Iv(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function Cv(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}function hc(n,e){return Pg(n,e,[]).join("")}function Pg(n,e,t){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t.push(n.nodeValue);else{let r;for(r=n.firstChild;r;r=r.nextSibling)Pg(r,e,t)}return t}function Lv(n){return"documentElement"in n}function Fv(n){return new DOMParser().parseFromString(n,"application/xml")}function $l(n,e){return function(t,r){const i=n.call(this,t,r);i!==void 0&&r[r.length-1].push(i)}}function Lt(n,e,t){return function(r,i){const s=n.call(this,r,i);if(s!==void 0){const o=i[i.length-1],a=r.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function q(n,e,t){return function(r,i){const s=n.call(this,r,i);if(s!==void 0){const o=i[i.length-1],a=r.localName;o[a]=s}}}function Fe(n,e,t){t=t!==void 0?t:{};let r,i;for(r=0,i=n.length;r<i;++r)t[n[r]]=e;return t}function Mv(n,e,t,r){let i;for(i=e.firstElementChild;i;i=i.nextElementSibling){const s=n[i.namespaceURI];if(s!==void 0){const o=s[i.localName];o!==void 0&&o.call(r,i,t)}}}function Be(n,e,t,r,i){return r.push(n),Mv(e,t,r,i),r.pop()}class Ag{read(e){if(!e)return null;if(typeof e=="string"){const t=Fv(e);return this.readFromDocument(t)}return Lv(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){wt()}}const Ov="http://www.w3.org/1999/xlink";function fc(n){return n.getAttributeNS(Ov,"href")}function Nv(n){const e=hc(n,!1);return Dv(e)}function Dv(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function en(n){const e=hc(n,!1);return Gv(e)}function Gv(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function _e(n){return hc(n,!1).trim()}const Dt=[null,"http://www.opengis.net/ows/1.1"],Uv=Fe(Dt,{ServiceIdentification:q(u1),ServiceProvider:q(h1),OperationsMetadata:q(a1)});class Bv extends Ag{constructor(){super()}readFromNode(e){const t=Be({},Uv,e,[]);return t||null}}const kv=Fe(Dt,{DeliveryPoint:q(_e),City:q(_e),AdministrativeArea:q(_e),PostalCode:q(_e),Country:q(_e),ElectronicMailAddress:q(_e)}),zv=Fe(Dt,{Value:Lt(f1)}),$v=Fe(Dt,{AllowedValues:q(e1)}),jv=Fe(Dt,{Phone:q(l1),Address:q(Qv)}),Vv=Fe(Dt,{HTTP:q(s1)}),Xv=Fe(Dt,{Get:Lt(i1),Post:void 0}),Zv=Fe(Dt,{DCP:q(n1)}),Wv=Fe(Dt,{Operation:o1}),Hv=Fe(Dt,{Voice:q(_e),Facsimile:q(_e)}),qv=Fe(Dt,{Constraint:Lt(t1)}),Yv=Fe(Dt,{IndividualName:q(_e),PositionName:q(_e),ContactInfo:q(r1)}),Kv=Fe(Dt,{Abstract:q(_e),AccessConstraints:q(_e),Fees:q(_e),Title:q(_e),ServiceTypeVersion:q(_e),ServiceType:q(_e)}),Jv=Fe(Dt,{ProviderName:q(_e),ProviderSite:q(fc),ServiceContact:q(c1)});function Qv(n,e){return Be({},kv,n,e)}function e1(n,e){return Be({},zv,n,e)}function t1(n,e){const t=n.getAttribute("name");if(t)return Be({name:t},$v,n,e)}function r1(n,e){return Be({},jv,n,e)}function n1(n,e){return Be({},Vv,n,e)}function i1(n,e){const t=fc(n);if(t)return Be({href:t},qv,n,e)}function s1(n,e){return Be({},Xv,n,e)}function o1(n,e){const t=n.getAttribute("name"),r=Be({},Zv,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function a1(n,e){return Be({},Wv,n,e)}function l1(n,e){return Be({},Hv,n,e)}function u1(n,e){return Be({},Kv,n,e)}function c1(n,e){return Be({},Yv,n,e)}function h1(n,e){return Be({},Jv,n,e)}function f1(n,e){return _e(n)}const Ir=[null,"http://www.opengis.net/wmts/1.0"],Pi=[null,"http://www.opengis.net/ows/1.1"],d1=Fe(Ir,{Contents:q(v1)});let p1=class extends Ag{constructor(){super(),this.owsParser_=new Bv}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=Be(r,d1,e,[]),r||null):null}};const g1=Fe(Ir,{Layer:Lt(S1),TileMatrixSet:Lt(R1)}),m1=Fe(Ir,{Style:Lt(P1),Format:Lt(_e),TileMatrixSetLink:Lt(A1),Dimension:Lt(I1),ResourceURL:Lt(C1)},Fe(Pi,{Title:q(_e),Abstract:q(_e),WGS84BoundingBox:q(Cg),BoundingBox:Lt(L1),Identifier:q(_e)})),y1=Fe(Ir,{LegendURL:Lt(F1)},Fe(Pi,{Title:q(_e),Identifier:q(_e)})),_1=Fe(Ir,{TileMatrixSet:q(_e),TileMatrixSetLimits:q(O1)}),x1=Fe(Ir,{TileMatrixLimits:$l(N1)}),b1=Fe(Ir,{TileMatrix:q(_e),MinTileRow:q(en),MaxTileRow:q(en),MinTileCol:q(en),MaxTileCol:q(en)}),E1=Fe(Ir,{Default:q(_e),Value:Lt(_e)},Fe(Pi,{Identifier:q(_e)})),Ig=Fe(Pi,{LowerCorner:$l(jl),UpperCorner:$l(jl)}),T1=Fe(Ir,{WellKnownScaleSet:q(_e),TileMatrix:Lt(M1)},Fe(Pi,{SupportedCRS:q(_e),Identifier:q(_e),BoundingBox:q(Cg)})),w1=Fe(Ir,{TopLeftCorner:q(jl),ScaleDenominator:q(Nv),TileWidth:q(en),TileHeight:q(en),MatrixWidth:q(en),MatrixHeight:q(en)},Fe(Pi,{Identifier:q(_e)}));function v1(n,e){return Be({},g1,n,e)}function S1(n,e){return Be({},m1,n,e)}function R1(n,e){return Be({},T1,n,e)}function P1(n,e){const t=Be({},y1,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function A1(n,e){return Be({},_1,n,e)}function I1(n,e){return Be({},E1,n,e)}function C1(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function Cg(n,e){const t=Be([],Ig,n,e);if(t.length==2)return Lu(t)}function L1(n,e){const t=n.getAttribute("crs"),r=Be([],Ig,n,e);if(r.length==2)return{extent:Lu(r),crs:t}}function F1(n,e){const t={};return t.format=n.getAttribute("format"),t.href=fc(n),t}function jl(n,e){const t=_e(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function M1(n,e){return Be({},w1,n,e)}function O1(n,e){return Be([],x1,n,e)}function N1(n,e){return Be({},b1,n,e)}class D1 extends yp{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,s=i.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=cn(l,as(t.extent,i.projection))),!a[Yr.ANIMATING]&&!a[Yr.INTERACTING]&&!Fu(l))if(o){const u=i.projection,c=o.getImage(l,s,r,u);c&&(this.loadImage(c)?this.image=c:c.getState()===Qe.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=ls(t.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!ap(s,i))return null;const o=this.image.getExtent(),a=this.image.getImage(),l=On(o),u=Math.floor(a.width*((i[0]-o[0])/l));if(u<0||u>=a.width)return null;const c=Nn(o),h=Math.floor(a.height*((o[3]-i[1])/c));return h<0||h>=a.height?null:this.getImageData(a,u,h)}renderFrame(e,t){const r=this.image,i=r.getExtent(),s=r.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=r.getPixelRatio(),u=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,h=e.viewState,f=h.center,p=h.resolution,d=c*o/(p*l),g=c*a/(p*l);this.prepareContainer(e,t);const m=this.context.canvas.width,y=this.context.canvas.height,_=this.getRenderContext(e);let x=!1,T=!0;if(u.extent){const v=as(u.extent,h.projection);T=xr(v,e.extent),x=T&&!is(v,e.extent),x&&this.clipUnrotated(_,e,v)}const b=r.getImage(),E=wp(this.tempTransform,m/2,y/2,d,g,0,l*(i[0]-f[0])/o,l*(f[1]-i[3])/a);this.renderedResolution=a*c/l;const w=b.width*E[0],S=b.height*E[3];if(this.getLayer().getSource().getInterpolate()||(_.imageSmoothingEnabled=!1),this.preRender(_,e),T&&w>=.5&&S>=.5){const v=E[4],R=E[5],C=u.opacity;C!==1&&(_.save(),_.globalAlpha=C),_.drawImage(b,0,0,+b.width,+b.height,v,R,w,S),C!==1&&_.restore()}return this.postRender(this.context,e),x&&_.restore(),_.imageSmoothingEnabled=!0,this.container}}class G1 extends vp{constructor(e){e=e||{},super(e)}}class dc extends G1{constructor(e){super(e)}createRenderer(){return new D1(this)}getData(e){return super.getData(e)}}function Ha(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const r=n[t],i=r.has(e);return i||r.add(e),!i}function U1(n,e,t){const r=n[t];return r?r.delete(e):!1}function Pf(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=cn(e,as(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=cn(e,i))}return e}class Lg extends yp{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=lp(),this.tempTileRange_=new F0(0,0,0,0),this.tempTileCoord_=Lh(0,0,0);const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Fh(r),this.sourceTileCache_=null,this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new Fh(512)),this.sourceTileCache_}getOrCreateTile(e,t,r,i){const s=this.tileCache_,a=this.getLayer().getSource(),l=za(a,a.getKey(),e,t,r);let u;if(s.containsKey(l))u=s.get(l);else{const c=i.viewState.projection,h=a.getProjection();if(u=a.getTile(e,t,r,i.pixelRatio,c,!h||St(h,c)?void 0:this.getSourceTileCache()),!u)return null;s.set(l,u)}return u}getTile(e,t,r,i){const s=this.getOrCreateTile(e,t,r,i);return s||null}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=ls(t.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!ap(s,i))return null;const o=t.viewState,a=r.getRenderSource(),l=a.getTileGridForProjection(o.projection),u=a.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const h=l.getTileCoordForCoordAndZ(i,c),f=this.getTile(c,h[1],h[2],t);if(!f||f.getState()!==ue.LOADED)continue;const p=l.getOrigin(c),d=Nu(l.getTileSize(c)),g=l.getResolution(c);let m;if(f instanceof M0||f instanceof O0)m=f.getImage();else if(f instanceof Mh){if(m=Oh(f.getData()),!m)continue}else continue;const y=Math.floor(u*((i[0]-p[0])/g-h[1]*d[0])),_=Math.floor(u*((p[1]-i[1])/g-h[2]*d[1])),x=Math.round(u*a.getGutterForProjection(o.projection));return this.getImageData(m,y+x,_+x)}return null}prepareFrame(e){var i;this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const r=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==r&&(this.renderedSourceRevision_=r,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),(i=this.sourceTileCache_)==null||i.clear())):this.renderedSourceRevision_=r,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),c=ct(l);c in e.wantedTiles||(e.wantedTiles[c]={});const h=e.wantedTiles[c],f=a.getMapInternal(),p=Math.max(r-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection)),d=o.rotation,g=d?l0(o.center,o.resolution,d,e.size):void 0;for(let m=r;m>=p;--m){const y=u.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),_=u.getResolution(m);for(let x=y.minX;x<=y.maxX;++x)for(let T=y.minY;T<=y.maxY;++T){if(d&&!u.tileCoordIntersectsViewport([m,x,T],g))continue;const b=this.getTile(m,x,T,e);if(!b||!Ha(i,b,m))continue;const w=b.getKey();if(h[w]=!0,b.getState()===ue.IDLE&&!e.tileQueue.isKeyQueued(w)){const S=Lh(m,x,T,this.tempTileCoord_);e.tileQueue.enqueue([b,c,u.getTileCoordCenter(S),_])}}}}findStaleTile_(e,t){const r=this.tileCache_,i=e[0],s=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const u=za(this.getLayer().getSource(),a[l],i,s,o);if(r.containsKey(u)){const c=r.peek(u);if(c.getState()===ue.LOADED)return c.endTransition(ct(this)),Ha(t,c,i),!0}}return!1}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),u=l.getKey();for(let c=s.minX;c<=s.maxX;++c)for(let h=s.minY;h<=s.maxY;++h){const f=za(l,u,r,c,h);let p=!1;if(a.containsKey(f)){const d=a.peek(f);d.getState()===ue.LOADED&&(Ha(i,d,r),p=!0)}p||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],i=e.viewState,s=i.projection,o=i.resolution,a=i.center,l=e.pixelRatio,u=this.getLayer(),c=u.getSource(),h=c.getTileGridForProjection(s),f=h.getZForResolution(o,c.zDirection),p=h.getResolution(f),d=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==d&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=d):this.renderedSourceKey_=d;let g=e.extent;const m=c.getTilePixelRatio(l);this.prepareContainer(e,t);const y=this.context.canvas.width,_=this.context.canvas.height,x=r.extent&&as(r.extent);x&&(g=cn(g,as(r.extent)));const T=p*y/2/m,b=p*_/2/m,E=[a[0]-T,a[1]-b,a[0]+T,a[1]+b],w={};this.renderedTiles.length=0;const S=u.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const $=h.getZForResolution(i.nextResolution,c.zDirection),V=Pf(e,e.nextExtent);this.enqueueTiles(e,V,$,w,S)}const v=Pf(e,g);if(this.enqueueTiles(e,v,f,w,0),S>0&&setTimeout(()=>{this.enqueueTiles(e,v,f-1,w,S-1)},0),!(f in w))return this.container;const R=ct(this),C=e.time;for(const $ of w[f]){const V=$.getState();if(V===ue.EMPTY)continue;const H=$.tileCoord;if(V===ue.LOADED&&$.getAlpha(R,C)===1){$.endTransition(R);continue}if(V!==ue.ERROR&&(this.renderComplete=!1),this.findStaleTile_(H,w)){U1(w,$,f),e.animate=!0;continue}if(this.findAltTiles_(h,H,f+1,w))continue;const J=h.getMinZoom();for(let G=f-1;G>=J&&!this.findAltTiles_(h,H,G,w);--G);}const F=p/o*l/m,N=this.getRenderContext(e);wp(this.tempTransform,y/2,_/2,F,F,0,-y/2,-_/2),r.extent&&this.clipUnrotated(N,e,x),c.getInterpolate()||(N.imageSmoothingEnabled=!1),this.preRender(N,e);const D=Object.keys(w).map(Number);D.sort(up);let A;const M=[],O=[];for(let $=D.length-1;$>=0;--$){const V=D[$],H=c.getTilePixelSize(V,l,s),fe=h.getResolution(V)/p,J=H[0]*fe*F,G=H[1]*fe*F,Ae=h.getTileCoordForCoordAndZ(Mu(E),V),Ie=h.getTileCoordExtent(Ae),be=ls(this.tempTransform,[m*(Ie[0]-E[0])/p,m*(E[3]-Ie[3])/p]),ot=m*c.getGutterForProjection(s);for(const Me of w[V]){if(Me.getState()!==ue.LOADED)continue;const Je=Me.tileCoord,Ht=Ae[1]-Je[1],dt=Math.round(be[0]-(Ht-1)*J),pt=Ae[2]-Je[2],j=Math.round(be[1]-(pt-1)*G),gt=Math.round(be[0]-Ht*J),Rt=Math.round(be[1]-pt*G),de=dt-gt,pn=j-Rt,Cr=D.length===1;let rt=!1;A=[gt,Rt,gt+de,Rt,gt+de,Rt+pn,gt,Rt+pn];for(let jr=0,nt=M.length;jr<nt;++jr)if(!Cr&&V<O[jr]){const at=M[jr];xr([gt,Rt,gt+de,Rt+pn],[at[0],at[3],at[4],at[7]])&&(rt||(N.save(),rt=!0),N.beginPath(),N.moveTo(A[0],A[1]),N.lineTo(A[2],A[3]),N.lineTo(A[4],A[5]),N.lineTo(A[6],A[7]),N.moveTo(at[6],at[7]),N.lineTo(at[4],at[5]),N.lineTo(at[2],at[3]),N.lineTo(at[0],at[1]),N.clip())}M.push(A),O.push(V),this.drawTile(Me,e,gt,Rt,de,pn,ot,Cr),rt&&N.restore(),this.renderedTiles.unshift(Me),this.updateUsedTiles(e.usedTiles,c,Me)}}if(this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!ss(this.renderedExtent_,E),this.renderedExtent_=E,this.renderedPixelRatio=l,this.postRender(this.context,e),r.extent&&N.restore(),N.imageSmoothingEnabled=!0,this.renderComplete){const $=(V,H)=>{var G;const ee=ct(c),fe=H.wantedTiles[ee],J=fe?Object.keys(fe).length:0;this.updateCacheSize(J),this.tileCache_.expireCache(),(G=this.sourceTileCache_)==null||G.expireCache()};e.postRenderFunctions.push($)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,r,i,s,o,a,l){let u;if(e instanceof Mh){if(u=Oh(e.getData()),!u)throw new Error("Rendering array data is not yet supported")}else u=this.getTileImage(e);if(!u)return;const c=this.getRenderContext(t),h=ct(this),f=t.layerStatesArray[t.layerIndex],p=f.opacity*(l?e.getAlpha(h,t.time):1),d=p!==c.globalAlpha;d&&(c.save(),c.globalAlpha=p),c.drawImage(u,a,a,u.width-2*a,u.height-2*a,r,i,s,o),d&&c.restore(),p!==f.opacity?t.animate=!0:l&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,r){const i=ct(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}}class Io extends N0{constructor(e){super(e)}createRenderer(){return new Lg(this,{cacheSize:this.getCacheSize()})}}const B1={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Af={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class k1 extends Lg{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=xo(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,r,i,s,o,a,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,s,o,a,l)}getTile(e,t,r,i){const s=this.getOrCreateTile(e,t,r,i);if(!s)return null;const o=i.viewState,a=o.resolution,l=i.viewHints,u=this.getLayer().getSource(),c=u.getTileGridForProjection(o.projection),h=!(l[Yr.ANIMATING]||l[Yr.INTERACTING]),f=c.getZForResolution(a,u.zDirection)===e;return h&&f?s.wantedResolution=a:s.wantedResolution||(s.wantedResolution=c.getResolution(e)),s}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const i=this.getLayer(),s=i.getRevision(),o=i.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedPixelRatio===t&&l.renderedRenderOrder==o)return;const u=i.getSource(),c=!!i.getDeclutter(),h=u.getTileGrid(),p=u.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),d=u.getSourceTiles(t,r,e),g=ct(i);delete e.hitDetectionImageData[g],e.executorGroups[g]=[],l.dirty=!1;for(let m=0,y=d.length;m<y;++m){const _=d[m];if(_.getState()!=ue.LOADED)continue;const x=u.getProjection(),T=_.tileCoord;let b=h.getTileCoordExtent(T);r&&x&&!St(r,x)&&(b=Rn(b,x,r,32));const E=cn(p,b),w=Sn(E,i.getRenderBuffer()*a,this.tempExtent),S=ss(b,E)?null:w,v=new _0(0,E,a,t),R=w0(a,t),C=function(M,O){let $;const V=M.getStyleFunction()||i.getStyleFunction();if(V&&($=V(M,a)),$){const H=this.renderFeature(M,R,$,v,c,O);l.dirty=l.dirty||H}},F=_.getFeatures();o&&o!==l.renderedRenderOrder&&F.sort(o);for(let M=0,O=F.length;M<O;++M){let $=F[M];r&&_.projection&&!St(r,_.projection)&&($=$.clone(),$.getGeometry().applyTransform(Ep(_.projection,r))),(!S||xr(S,$.getGeometry().getExtent()))&&C.call(this,$,M)}const N=v.finish(),D=i.getRenderMode()!=="vector"&&c&&d.length===1?null:E,A=new x0(D,a,t,u.getOverlaps(),N,i.getRenderBuffer(),!0);e.executorGroups[g].push(A)}l.renderedRevision=s,l.renderedPixelRatio=t,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,r,i,s){var x,T;const o=t.viewState.resolution,a=t.viewState.rotation;r=r??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),h=Lu([e]);Sn(h,o*r,h);const f={},p=function(b,E,w){let S=b.getId();S===void 0&&(S=ct(b));const v=f[S];if(v){if(v!==!0&&w<v.distanceSq){if(w===0)return f[S]=!0,s.splice(s.lastIndexOf(v),1),i(b,l,E);v.geometry=E,v.distanceSq=w}}else{if(w===0)return f[S]=!0,i(b,l,E);s.push(f[S]={feature:b,layer:l,geometry:E,distanceSq:w,callback:i})}},d=this.renderedTiles,g=ct(l),m=l.getDeclutter(),y=m?(T=(x=t.declutter)==null?void 0:x[m])==null?void 0:T.all().map(b=>b.value):null;let _;e:for(let b=0,E=d.length;b<E;++b){const w=d[b],S=c.getTileCoordExtent(w.wrappedTileCoord);if(!xr(S,h))continue;const v=w.executorGroups[g];for(let R=0,C=v.length;R<C;++R)if(_=v[R].forEachFeatureAtCoordinate(e,o,a,r,p,y),_)break e}return _}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,r)=>{const i=this.getLayer(),s=i.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,u=s.getTileGridForProjection(o),c=ls(this.renderedPixelToCoordinateTransform_,e.slice()),h=u.getTileCoordForCoordAndResolution(c,l).toString(),f=this.renderedTiles.find(x=>x.tileCoord.toString()===h&&x.getState()===ue.LOADED);if(!f||f.loadingSourceTiles>0){t([]);return}s.getWrapX()&&o.canWrapX()&&!is(a,u.getTileCoordExtent(f.tileCoord))&&D0(c,o);const p=ct(i),d=u.getTileCoordExtent(f.wrappedTileCoord),g=Mu(d),m=[(c[0]-g[0])/l,(g[1]-c[1])/l],y=f.getSourceTiles().reduce((x,T)=>x.concat(T.getFeatures()),[]);let _=f.hitDetectionImageData[p];if(!_){const x=Nu(u.getTileSize(u.getZForResolution(l,s.zDirection))),T=this.renderedRotation_,b=[this.getRenderTransform(u.getTileCoordCenter(f.wrappedTileCoord),l,0,ka,x[0]*ka,x[1]*ka,0)];_=b0(x,b,y,i.getStyleFunction(),u.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(i).renderedResolution,T),f.hitDetectionImageData[p]=_}t(E0(m,y,_))})}getFeaturesInExtent(e){const t=[],r=this.getTileCache();if(r.getCount()===0)return t;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=s.getZForResolution(this.renderedResolution),a={};return r.forEach(l=>{if(l.tileCoord[0]!==o||l.getState()!==ue.LOADED)return;const u=l.getSourceTiles();for(let c=0,h=u.length;c<h;++c){const f=u[c],p=f.getKey();if(p in a)continue;a[p]=!0;const d=f.tileCoord;if(xr(e,s.getTileCoordExtent(d))){const g=f.getFeatures();if(g)for(let m=0,y=g.length;m<y;++m){const _=g[m],x=_.getGeometry();xr(e,x.getExtent())&&t.push(_)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){var f;const r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[Yr.ANIMATING]||s[Yr.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),u=l?(f=e.declutter)==null?void 0:f[l]:void 0,c=ct(this.getLayer()),h=this.renderedTiles;for(let p=0,d=h.length;p<d;++p){const g=h[p],m=g.executorGroups[c];if(m)for(let y=m.length-1;y>=0;--y)m[y].execute(this.context,a,this.getTileRenderTransform(g,e),e.viewState.rotation,o,Ih,u)}r.globalAlpha=i}renderDeferredInternal(e){const t=this.renderedTiles,r=ct(this.getLayer()),i=t.reduce((l,u,c)=>(u.executorGroups[r].forEach(h=>l.push({executorGroup:h,index:c})),l),[]),s=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),o={};for(let l=0,u=i.length;l<u;++l){const c=i[l].executorGroup.getDeferredZIndexContexts();for(const h in c)o[h]=!0}Object.keys(o).map(Number).sort(up).forEach(l=>{s.forEach((u,c)=>{u[l]&&(u[l].forEach(h=>{const{executorGroup:f,index:p}=i[c],d=f.getRenderedContext(),g=d.globalAlpha;d.globalAlpha=this.renderedOpacity_;const m=this.tileClipContexts_[p];m&&m.draw(d),h.draw(d),m&&d.restore(),d.globalAlpha=g,h.clear()}),u[l].length=0)})})}getTileRenderTransform(e,t){const r=t.pixelRatio,i=t.viewState,s=i.center,o=i.resolution,a=i.rotation,l=t.size,u=Math.round(l[0]*r),c=Math.round(l[1]*r),f=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),p=e.tileCoord,d=f.getTileCoordExtent(e.wrappedTileCoord),g=f.getTileCoordExtent(p,this.tempExtent)[0]-d[0];return Il($a(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(s,o,a,r,u,c,g))}postRender(e,t){var b;const r=t.viewHints,i=!(r[Yr.ANIMATING]||r[Yr.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),u=l?Af[o].filter(E=>!Ih.includes(E)):Af[o],c=t.viewState,h=c.rotation,f=s.getSource(),d=f.getTileGridForProjection(c.projection).getZForResolution(c.resolution,f.zDirection),g=this.renderedTiles,m=[],y=[],_=[],x=ct(s);let T=!0;for(let E=g.length-1;E>=0;--E){const w=g[E];T=T&&!w.getReplayState(s).dirty;const S=w.executorGroups[x].filter(A=>A.hasExecutors(u));if(S.length===0)continue;const v=this.getTileRenderTransform(w,t),R=w.tileCoord[0];let C=!1;const F=S[0].getClipCoords(v);let N=e,D;if(F){D=new T0,N=D.getContext();for(let A=0,M=m.length;A<M;++A)if(d!==R&&R<y[A]){const O=m[A];xr([F[0],F[3],F[4],F[7]],[O[0],O[3],O[4],O[7]])&&(C||(N.save(),C=!0),N.beginPath(),N.moveTo(F[0],F[1]),N.lineTo(F[2],F[3]),N.lineTo(F[4],F[5]),N.lineTo(F[6],F[7]),N.moveTo(O[6],O[7]),N.lineTo(O[4],O[5]),N.lineTo(O[2],O[3]),N.lineTo(O[0],O[1]),N.clip())}m.push(F),y.push(R)}for(let A=0,M=S.length;A<M;++A)S[A].execute(e,[e.canvas.width,e.canvas.height],v,h,i,u,(b=t.declutter)==null?void 0:b[l]);C&&(N===e?N.restore():_[E]=D)}e.globalAlpha=a,this.ready=T,this.tileClipContexts_=_,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,s,o){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,u=r.length;l<u;++l)a=Ch(i,e,r[l],t,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=Ch(i,e,r,t,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const r=e.getReplayState(t),i=t.getRevision(),s=e.wantedResolution;return r.renderedTileResolution!==s||r.renderedTileRevision!==i}renderTileImage_(e,t){const r=this.getLayer(),i=e.getReplayState(r),s=r.getRevision(),o=e.executorGroups[ct(r)];i.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],u=r.getSource();let c=t.pixelRatio;const f=t.viewState.projection,p=u.getTileGridForProjection(f),d=p.getResolution(e.tileCoord[0]),g=t.pixelRatio/e.wantedResolution*d,m=p.getResolution(l),y=e.getContext();c=Math.round(Math.max(c,g/c));const _=u.getTilePixelSize(l,c,f);y.canvas.width=_[0],y.canvas.height=_[1];const x=c/g;if(x!==1){const w=Nh(this.tmpTransform_);$a(w,x,x),y.setTransform.apply(y,w)}const T=p.getTileCoordExtent(a,this.tempExtent),b=g/m,E=Nh(this.tmpTransform_);$a(E,b,-b),G0(E,-T[0],-T[3]);for(let w=0,S=o.length;w<S;++w)o[w].execute(y,[y.canvas.width*x,y.canvas.height*x],E,0,!0,B1[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}}class si extends U0{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const r=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;const i=e.renderMode||"hybrid";u0(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new k1(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Bs.PRELOAD)}getUseInterimTilesOnError(){return this.get(Bs.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(Bs.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(Bs.USE_INTERIM_TILES_ON_ERROR,e)}}function Vl(n){return Array.isArray(n)?Math.min(...n):n}class z1 extends Qo{constructor(e,t,r,i,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?cn(r,u):r,h=Ei(c),f=Sp(e,t,h,i),p=z0,d=new B0(e,t,c,l,f*p,i),g=d.calculateSourceExtent(),m=Fu(g)?null:o(g,f,s),y=m?Qe.IDLE:Qe.EMPTY,_=m?m.getPixelRatio():1;super(r,i,_,y),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=d,this.targetResolution_=i,this.targetExtent_=r,this.sourceImage_=m,this.sourcePixelRatio_=_,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Qe.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==Qe.LOADED){const t=On(this.targetExtent_)/this.targetResolution_,r=Nn(this.targetExtent_)/this.targetResolution_;this.canvas_=k0(t,r,this.sourcePixelRatio_,Vl(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==Qe.IDLE){this.state=Qe.LOADING,this.changed();const e=this.sourceImage_.getState();e==Qe.LOADED||e==Qe.ERROR?this.reproject_():(this.sourceListenerKey_=c0(this.sourceImage_,Dn.CHANGE,t=>{const r=this.sourceImage_.getState();(r==Qe.LOADED||r==Qe.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){h0(this.sourceListenerKey_),this.sourceListenerKey_=null}}const ri=4,qa={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class $1 extends Ou{constructor(e,t){super(e),this.image=t}}class pc extends ea{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const r=f0(t,e,0);e=t[r]}return e}getImage(e,t,r,i){const s=this.getProjection();if(!s||!i||St(s,i))return s&&(i=s),this.getImageInternal(e,t,r,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&St(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==t&&ss(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new z1(s,i,e,t,r,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,r,i){if(this.loader){const s=V1(e,t,r,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&is(this.wantedExtent_,s)||is(this.image.getExtent(),s))&&(this.wantedResolution_&&Vl(this.wantedResolution_)===o||Vl(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Qo(s,o,r,this.loader),this.image.addEventListener(Dn.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let r;switch(t.getState()){case Qe.LOADING:this.loading=!0,r=qa.IMAGELOADSTART;break;case Qe.LOADED:this.loading=!1,r=qa.IMAGELOADEND;break;case Qe.ERROR:this.loading=!1,r=qa.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new $1(r,t))}}function j1(n,e){n.getImage().src=e}function V1(n,e,t,r){const i=e/t,s=Ei(n),o=Us(On(n)/i,ri),a=Us(Nn(n)/i,ri),l=Us((r-1)*o/2,ri),u=o+2*l,c=Us((r-1)*a/2,ri),h=a+2*c;return d0(s,i,0,[u,h])}function X1(n){const e=n.load||Rp,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=On(t)/s.width,a=Nn(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}let Z1=class extends pc{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:j1;super({attributions:e.attributions,interpolate:e.interpolate,projection:Ue(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Qo(this.imageExtent_,void 0,1,X1({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),Rp(i))})),this.image.addEventListener(Dn.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return xr(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}},gc=class extends Du{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:Ue("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)mx(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=Ue("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const u=$0(t,r);i=cp(e.bounds,u)}const s=ta(r),o=e.minzoom||0,a=e.maxzoom||22,l=vs({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=j0(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(c){return xr(u,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}};const Xl="1.3.0";function W1(n,e,t,r,i){i.WIDTH=t[0],i.HEIGHT=t[1];const s=r.getAxisOrientation(),o=Fp(i.VERSION,"1.3")>=0;i[o?"CRS":"SRS"]=r.getCode();const a=o&&s.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return i.BBOX=a.join(","),bo(n,i)}function H1(n,e,t,r,i,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=e/t,l=[Ah(On(n)/a,ri),Ah(Nn(n)/a,ri)];if(t!=1)switch(o){case"geoserver":const c=90*t+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+c:s.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":s.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":s.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return W1(i,n,l,r,s)}function If(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:Xl,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}class q1 extends Du{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=lp(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,r,i){const s=Ue(r),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=V0(e,s,o),u=Sp(o,s,e,t),c=a.getZForResolution(u,this.zDirection),h=a.getResolution(c),f=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=f[0])return;let p=a.getTileCoordExtent(f,this.tmpExtent_);const d=this.gutter_;d!==0&&(p=Sn(p,h*d,p));const g={QUERY_LAYERS:this.params_.LAYERS};Object.assign(g,If(this.params_,"GetFeatureInfo"),i);const m=Math.floor((l[0]-p[0])/h),y=Math.floor((p[3]-l[1])/h);return g[this.v13_?"I":"X"]=m,g[this.v13_?"J":"Y"]=y,this.getRequestUrl_(f,p,1,o||s,g)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const r={SERVICE:"WMS",VERSION:Xl,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;r.LAYER=i}if(e!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;r.SCALE=e*i/s}return Object.assign(r,t),bo(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=p0(X0(e),o.length);a=o[l]}return H1(t,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(e[0]),r,i,a,s,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||Xl;this.v13_=Fp(e,"1.3")>=0}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const s=i.getResolution(e[0]);let o=i.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Sn(o,s*a,o));const l=Object.assign({},If(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,r,l)}}class Cs extends Z0{constructor(e){const t=e.projection||"EPSG:3857",r=e.extent||ta(t),i=e.tileGrid||vs({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:i,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Fg,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Mp,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,r){if(r.getState()===ue.IDLE){r.setState(ue.LOADING);const i=r.wrappedTileCoord,s=this.getTileGridForProjection(t);let o=s.getTileCoordExtent(i);const a=i[0],l=s.getResolution(a);Sn(o,-l,o);const u=this.projection;t&&this.projection&&!St(t,u)&&(o=Rn(o,t,u));const c=this.tileGrid,h=c.getExtent();h&&cn(o,h,o);let f=l;t&&u&&!St(t,u)&&(f=l/u.getMetersPerUnit()/t.getMetersPerUnit());const p=c.getZForResolution(f,this.zDirection);c.forEachTileCoord(o,p,d=>{const g=this.tileUrlFunction(d,e,t);this.sourceTiles_[g]||(this.sourceTiles_[g]=new this.tileClass(d,g?ue.IDLE:ue.EMPTY,g,this.format_,this.tileLoadFunction));const m=this.sourceTiles_[g];r.sourceTiles.push(m),this.tileKeysBySourceTileUrl_[g]||(this.tileKeysBySourceTileUrl_[g]=[]),this.tileKeysBySourceTileUrl_[g].push(r.getKey());const y=m.getState();if(y<ue.LOADED){const _=x=>{this.handleTileChange(x);const T=m.getState();if(T===ue.LOADED||T===ue.ERROR){const b=m.getKey();b in r.errorTileKeys?m.getState()===ue.LOADED&&delete r.errorTileKeys[b]:r.loadingSourceTiles--,T===ue.ERROR?r.errorTileKeys[b]=!0:m.removeEventListener(Dn.CHANGE,_),r.loadingSourceTiles===0&&r.setState(op(r.errorTileKeys)?ue.LOADED:ue.ERROR)}};m.addEventListener(Dn.CHANGE,_),r.loadingSourceTiles++}y===ue.IDLE&&(m.extent=c.getTileCoordExtent(d),m.projection=this.projection,m.resolution=c.getResolution(d[0]),m.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(d=>d.getState()===ue.ERROR)?ue.ERROR:ue.LOADED)}return r.sourceTiles}removeSourceTiles(e){const t=e.getKey(),r=e.sourceTiles;for(let i=0,s=r.length;i<s;++i){const o=r[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[o])return;const a=this.tileKeysBySourceTileUrl_[o].indexOf(t);a!==-1&&(this.tileKeysBySourceTileUrl_[o].splice(a,1),this.tileKeysBySourceTileUrl_[o].length===0&&(delete this.tileKeysBySourceTileUrl_[o],delete this.sourceTiles_[o]))}}getTile(e,t,r,i,s){const o=[e,t,r];let a=this.getTileCoordForTileUrlFunction(o,s);const l=this.getTileGrid().getExtent(),u=this.projection,c=this.getTileGridForProjection(s);if(a&&l){const p=c.getTileCoordExtent(a);Sn(p,-c.getResolution(e),p),xr(l,!s||!u||St(s,u)?p:Rn(p,s,u))||(a=null)}let h=!0;if(a!==null){const p=this.tileGrid,d=c.getResolution(e);let g=d;s&&u&&!St(s,u)&&(g=d/u.getMetersPerUnit()/s.getMetersPerUnit());const m=p.getZForResolution(g,1),y=c.getTileCoordExtent(a);Sn(y,-d,y),p.forEachTileCoord(!s||!u||St(s,u)?y:Rn(y,s,u),m,_=>{h=h&&!this.tileUrlFunction(_,i,u)})}const f=new _x(o,h?ue.EMPTY:ue.IDLE,a,this.getSourceTiles.bind(this,i,s),this.removeSourceTiles.bind(this));return f.key=this.getKey(),f}getTileGridForProjection(e){const t=e.getCode();let r=this.tileGrids_[t];if(!r){const i=this.projection;if(i!==null&&!St(i,e))return W0(e);const s=this.tileGrid,o=s.getResolutions().slice(),a=o.map(function(c,h){return s.getOrigin(h)}),l=o.map(function(c,h){return s.getTileSize(h)}),u=H0+1;for(let c=o.length;c<u;++c)o.push(o[c-1]/2),a.push(a[c-1]),l.push(l[c-1]);r=new Gu({extent:s.getExtent(),origins:a,resolutions:o,tileSizes:l}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){const i=this.getTileGridForProjection(r),s=Nu(i.getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function Fg(n,e){n.setLoader(function(t,r,i){v0(e,n.getFormat(),t,r,i,n.onLoad.bind(n),n.onError.bind(n))})}class Y1 extends Du{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",r=e.tileGrid;let i=e.urls;i===void 0&&e.url!==void 0&&(i=Y0(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:i,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=Dh(i.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(Dh(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?bo(e,r):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in r?r[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const u={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(u,s);let c=e;return t=="KVP"?c=bo(c,u):c=c.replace(/\{(\w+?)\}/g,function(h,f){return encodeURIComponent(u[f])}),c}}}function K1(n,e){var N;const t=n.Contents.Layer,r=t==null?void 0:t.find(function(D){return D.Identifier==e.layer});if(!r)return null;const i=n.Contents.TileMatrixSet;let s;r.TileMatrixSetLink.length>1?"projection"in e?s=r.TileMatrixSetLink.findIndex(function(D){const M=i.find(function(V){return V.Identifier==D.TileMatrixSet}).SupportedCRS,O=Ue(M),$=Ue(e.projection);return O&&$?St(O,$):M==e.projection}):s=r.TileMatrixSetLink.findIndex(function(D){return D.TileMatrixSet==e.matrixSet}):s=0,s<0&&(s=0);const o=r.TileMatrixSetLink[s].TileMatrixSet,a=r.TileMatrixSetLink[s].TileMatrixSetLimits;let l=r.Format[0];"format"in e&&(l=e.format),s=r.Style.findIndex(function(D){return"style"in e?D.Title==e.style:D.isDefault}),s<0&&(s=0);const u=r.Style[s].Identifier,c={};"Dimension"in r&&r.Dimension.forEach(function(D,A,M){const O=D.Identifier;let $=D.Default;$===void 0&&($=D.Value[0]),c[O]=$});const f=n.Contents.TileMatrixSet.find(function(D){return D.Identifier==o});let p;const d=f.SupportedCRS;if(d&&(p=Ue(d)),"projection"in e){const D=Ue(e.projection);D&&(!p||St(D,p))&&(p=D)}let g=!1;const m=p.getAxisOrientation().startsWith("ne");let y=f.TileMatrix[0],_={MinTileCol:0,MinTileRow:0,MaxTileCol:y.MatrixWidth-1,MaxTileRow:y.MatrixHeight-1};if(a){_=a[a.length-1];const D=f.TileMatrix.find(A=>A.Identifier===_.TileMatrix||f.Identifier+":"+A.Identifier===_.TileMatrix);D&&(y=D)}const x=(N=r.BoundingBox)==null?void 0:N.find(D=>Ue(D.crs)&&St(Ue(D.crs),p)),T=y.ScaleDenominator*28e-5/p.getMetersPerUnit(),b=m?[y.TopLeftCorner[1],y.TopLeftCorner[0]]:y.TopLeftCorner,E=y.TileWidth*T,w=y.TileHeight*T;let S=(x==null?void 0:x.extent)??f.BoundingBox;S&&m&&(S=[S[1],S[0],S[3],S[2]]);let v=[b[0]+E*_.MinTileCol,b[1]-w*(1+_.MaxTileRow),b[0]+E*(1+_.MaxTileCol),b[1]-w*_.MinTileRow];if(S!==void 0&&!is(S,v)){const D=r.WGS84BoundingBox,A=Ue("EPSG:4326").getExtent();if(v=S,D)g=D[0]===A[0]&&D[2]===A[2];else{const M=Rn(S,f.SupportedCRS,"EPSG:4326");g=M[0]-1e-10<=A[0]&&M[2]+1e-10>=A[2]}}const R=q0(f,v,a),C=[];let F=e.requestEncoding;if(F=F!==void 0?F:"","OperationsMetadata"in n&&"GetTile"in n.OperationsMetadata){const D=n.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let A=0,M=D.length;A<M;++A)if(D[A].Constraint){const $=D[A].Constraint.find(function(V){return V.name=="GetEncoding"}).AllowedValues.Value;if(F===""&&(F=$[0]),F==="KVP")$.includes("KVP")&&C.push(D[A].href);else break}else D[A].href&&(F="KVP",C.push(D[A].href))}return C.length===0&&(F="REST",r.ResourceURL.forEach(function(D){D.resourceType==="tile"&&(l=D.format,C.push(D.template))})),{urls:C,layer:e.layer,matrixSet:o,format:l,projection:p,requestEncoding:F,tileGrid:R,style:u,dimensions:c,wrapX:g,crossOrigin:e.crossOrigin}}class mc extends Sg{constructor(e){super(),e=e||{},this.dataProjection=new Pp({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:os,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,i){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,u=0,c=0,h=0;for(;e.pos<s;){if(!a){const f=e.readVarint();o=f&7,a=f>>3}if(a--,o===1||o===2)l+=e.readSVarint(),u+=e.readSVarint(),o===1&&c>h&&(i.push(c),h=c),r.push(l,u),c+=2;else if(o===7)c>h&&(r.push(r[h],r[h+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>h&&(i.push(c),h=c)}createFeature_(e,t,r){const i=t.type;if(i===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],u=[];this.readRawGeometry_(e,t,l,u);const c=rS(i,u.length);if(this.featureClass===os)s=new this.featureClass(c,l,u,2,o,a),s.transform(r.dataProjection);else{let h;if(c=="Polygon"){const d=K0(l,u);h=d.length>1?new fp(l,"XY",d):new xp(l,"XY",u)}else h=c==="Point"?new bp(l,"XY"):c==="LineString"?new gp(l,"XY"):c==="MultiPoint"?new pp(l,"XY"):c==="MultiLineString"?new dp(l,"XY",u):null;const f=this.featureClass;s=new f,this.geometryName_&&s.setGeometryName(this.geometryName_);const p=ca(h,!1,r);s.setGeometry(p),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const r=this.layers_;t=this.adaptOptions(t);const i=Ue(t.dataProjection);i.setWorldExtent(t.extent),t.dataProjection=i;const s=new x_(e),o=s.readFields(J1,{}),a=[];for(const l in o){if(r&&!r.includes(l))continue;const u=o[l],c=u?[0,0,u.extent,u.extent]:null;i.setExtent(c);for(let h=0,f=u.length;h<f;++h){const p=tS(s,u,h),d=this.createFeature_(s,p,t);d!==null&&a.push(d)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function J1(n,e,t){if(n===3){const r={keys:[],values:[],features:[]},i=t.readVarint()+t.pos;t.readFields(Q1,r,i),r.length=r.features.length,r.length&&(e[r.name]=r)}}function Q1(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let r=null;const i=t.readVarint()+t.pos;for(;t.pos<i;)n=t.readVarint()>>3,r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(r)}}function eS(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[i]=s}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function tS(n,e,t){n.pos=e.features[t];const r=n.readVarint()+n.pos,i={layer:e,type:0,properties:{}};return n.readFields(eS,i,r),i}function rS(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}var kt=Uint8Array,ni=Uint16Array,nS=Int32Array,Mg=new kt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Og=new kt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iS=new kt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ng=function(n,e){for(var t=new ni(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new nS(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},Dg=Ng(Mg,2),Gg=Dg.b,sS=Dg.r;Gg[28]=258,sS[258]=28;var oS=Ng(Og,0),aS=oS.b,Zl=new ni(32768);for(var ze=0;ze<32768;++ze){var Zr=(ze&43690)>>1|(ze&21845)<<1;Zr=(Zr&52428)>>2|(Zr&13107)<<2,Zr=(Zr&61680)>>4|(Zr&3855)<<4,Zl[ze]=((Zr&65280)>>8|(Zr&255)<<8)>>1}var Wi=function(n,e,t){for(var r=n.length,i=0,s=new ni(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new ni(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new ni(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var u=i<<4|n[i],c=e-n[i],h=o[n[i]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)a[Zl[h]>>l]=u}else for(a=new ni(r),i=0;i<r;++i)n[i]&&(a[i]=Zl[o[n[i]-1]++]>>15-n[i]);return a},Ls=new kt(288);for(var ze=0;ze<144;++ze)Ls[ze]=8;for(var ze=144;ze<256;++ze)Ls[ze]=9;for(var ze=256;ze<280;++ze)Ls[ze]=7;for(var ze=280;ze<288;++ze)Ls[ze]=8;var Ug=new kt(32);for(var ze=0;ze<32;++ze)Ug[ze]=5;var lS=Wi(Ls,9,1),uS=Wi(Ug,5,1),Ya=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},nr=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},Ka=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},cS=function(n){return(n+7)/8|0},hS=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new kt(n.subarray(e,t))},fS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ut=function(n,e,t){var r=new Error(e||fS[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Ut),!t)throw r;return r},yc=function(n,e,t,r){var i=n.length,s=0;if(!i||e.f&&!e.l)return t||new kt(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new kt(i*3));var u=function(Ht){var dt=t.length;if(Ht>dt){var pt=new kt(Math.max(dt*2,Ht));pt.set(t),t=pt}},c=e.f||0,h=e.p||0,f=e.b||0,p=e.l,d=e.d,g=e.m,m=e.n,y=i*8;do{if(!p){c=nr(n,h,1);var _=nr(n,h+1,3);if(h+=3,_)if(_==1)p=lS,d=uS,g=9,m=5;else if(_==2){var E=nr(n,h,31)+257,w=nr(n,h+10,15)+4,S=E+nr(n,h+5,31)+1;h+=14;for(var v=new kt(S),R=new kt(19),C=0;C<w;++C)R[iS[C]]=nr(n,h+C*3,7);h+=w*3;for(var F=Ya(R),N=(1<<F)-1,D=Wi(R,F,1),C=0;C<S;){var A=D[nr(n,h,N)];h+=A&15;var x=A>>4;if(x<16)v[C++]=x;else{var M=0,O=0;for(x==16?(O=3+nr(n,h,3),h+=2,M=v[C-1]):x==17?(O=3+nr(n,h,7),h+=3):x==18&&(O=11+nr(n,h,127),h+=7);O--;)v[C++]=M}}var $=v.subarray(0,E),V=v.subarray(E);g=Ya($),m=Ya(V),p=Wi($,g,1),d=Wi(V,m,1)}else Ut(1);else{var x=cS(h)+4,T=n[x-4]|n[x-3]<<8,b=x+T;if(b>i){l&&Ut(0);break}a&&u(f+T),t.set(n.subarray(x,b),f),e.b=f+=T,e.p=h=b*8,e.f=c;continue}if(h>y){l&&Ut(0);break}}a&&u(f+131072);for(var H=(1<<g)-1,ee=(1<<m)-1,fe=h;;fe=h){var M=p[Ka(n,h)&H],J=M>>4;if(h+=M&15,h>y){l&&Ut(0);break}if(M||Ut(2),J<256)t[f++]=J;else if(J==256){fe=h,p=null;break}else{var G=J-254;if(J>264){var C=J-257,Ae=Mg[C];G=nr(n,h,(1<<Ae)-1)+Gg[C],h+=Ae}var Ie=d[Ka(n,h)&ee],be=Ie>>4;Ie||Ut(3),h+=Ie&15;var V=aS[be];if(be>3){var Ae=Og[be];V+=Ka(n,h)&(1<<Ae)-1,h+=Ae}if(h>y){l&&Ut(0);break}a&&u(f+131072);var ot=f+G;if(f<V){var Me=s-V,Je=Math.min(V,ot);for(Me+f<0&&Ut(3);f<Je;++f)t[f]=r[Me+f]}for(;f<ot;++f)t[f]=t[f-V]}}e.l=p,e.p=fe,e.b=f,e.f=c,p&&(c=1,e.m=g,e.d=d,e.n=m)}while(!c);return f!=t.length&&o?hS(t,0,f):t.subarray(0,f)},dS=new kt(0),pS=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Ut(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},gS=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},mS=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Ut(6,"invalid zlib data"),(n[1]>>5&1)==1&&Ut(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function yS(n,e){return yc(n,{i:2},e,e)}function _S(n,e){var t=pS(n);return t+8>n.length&&Ut(6,"invalid gzip data"),yc(n.subarray(t,-8),{i:2},new kt(gS(n)),e)}function xS(n,e){return yc(n.subarray(mS(n),-4),{i:2},e,e)}function bS(n,e){return n[0]==31&&n[1]==139&&n[2]==8?_S(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?yS(n,e):xS(n,e)}var ES=typeof TextDecoder<"u"&&new TextDecoder,TS=0;try{ES.decode(dS,{stream:!0}),TS=1}catch{}var wS=Object.defineProperty,vS=Math.pow,De=(n,e)=>wS(n,"name",{value:e,configurable:!0}),ht=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())});De((n,e)=>{let t=!1,r="",i=L.GridLayer.extend({createTile:De((s,o)=>{let a=document.createElement("img"),l=new AbortController,u=l.signal;return a.cancel=()=>{l.abort()},t||(n.getHeader().then(c=>{c.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):c.tileType===2?r="image/png":c.tileType===3?r="image/jpeg":c.tileType===4?r="image/webp":c.tileType===5&&(r="image/avif")}),t=!0),n.getZxy(s.z,s.x,s.y,u).then(c=>{if(c){let h=new Blob([c.data],{type:r}),f=window.URL.createObjectURL(h);a.src=f}else a.style.display="none";a.cancel=void 0,o(void 0,a)}).catch(c=>{if(c.name!=="AbortError")throw c}),a},"createTile"),_removeTile:De(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var SS=De(n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);let r=new AbortController;return n(e,r).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:De(()=>r.abort(),"cancel")}},"v3compat"),RS=class{constructor(e){this.tilev4=De((t,r)=>ht(this,null,function*(){if(t.type==="json"){let p=t.url.substr(10),d=this.tiles.get(p);if(d||(d=new us(p),this.tiles.set(p,d)),this.metadata){let m=yield d.getTileJson(t.url);return r.signal.throwIfAborted(),{data:m}}let g=yield d.getHeader();return r.signal.throwIfAborted(),(g.minLon>=g.maxLon||g.minLat>=g.maxLat)&&console.error(`Bounds of PMTiles archive ${g.minLon},${g.minLat},${g.maxLon},${g.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:g.minZoom,maxzoom:g.maxZoom,bounds:[g.minLon,g.minLat,g.maxLon,g.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new us(o),this.tiles.set(o,a));let l=s[2],u=s[3],c=s[4],h=yield a.getHeader(),f=yield a==null?void 0:a.getZxy(+l,+u,+c,r.signal);if(r.signal.throwIfAborted(),f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(h.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=SS(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};De(RS,"Protocol");function Bg(n,e){return(e>>>0)*4294967296+(n>>>0)}De(Bg,"toNum");function kg(n,e){let t=e.buf,r=t[e.pos++],i=(r&112)>>4;if(r<128||(r=t[e.pos++],i|=(r&127)<<3,r<128)||(r=t[e.pos++],i|=(r&127)<<10,r<128)||(r=t[e.pos++],i|=(r&127)<<17,r<128)||(r=t[e.pos++],i|=(r&127)<<24,r<128)||(r=t[e.pos++],i|=(r&1)<<31,r<128))return Bg(n,i);throw new Error("Expected varint not more than 10 bytes")}De(kg,"readVarintRemainder");function Yn(n){let e=n.buf,t=e[n.pos++],r=t&127;return t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,kg(r,n))}De(Yn,"readVarint");function _c(n,e,t,r,i){return i===0?r!==0?[n-1-t,n-1-e]:[t,e]:[e,t]}De(_c,"rotate");function zg(n,e,t){if(n>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<n||t>=1<<n)throw new Error("tile x/y outside zoom level bounds");let r=((1<<n)*(1<<n)-1)/3,i=n-1,[s,o]=[e,t];for(let a=1<<i;a>0;a>>=1){let l=s&a,u=o&a;r+=(3*l^u)*(1<<i),[s,o]=_c(a,s,o,l,u),i--}return r}De(zg,"zxyToTileId");function $g(n){let e=3*n+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}De($g,"tileIdToZ");function PS(n){let e=$g(n)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,r=n-t,i=0,s=0,o=1<<e;for(let a=1;a<o;a<<=1){let l=a&r/2,u=a&(r^l);[i,s]=_c(a,i,s,l,u),r=r/2,i+=l,s+=u}return[e,i,s]}De(PS,"tileIdToZxy");var AS=(n=>(n[n.Unknown=0]="Unknown",n[n.None=1]="None",n[n.Gzip=2]="Gzip",n[n.Brotli=3]="Brotli",n[n.Zstd=4]="Zstd",n))(AS||{});function ha(n,e){return ht(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return bS(new Uint8Array(n));let t=new Response(n).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}De(ha,"defaultDecompress");var Kn=(n=>(n[n.Unknown=0]="Unknown",n[n.Mvt=1]="Mvt",n[n.Png=2]="Png",n[n.Jpeg=3]="Jpeg",n[n.Webp=4]="Webp",n[n.Avif=5]="Avif",n))(Kn||{});function jg(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}De(jg,"tileTypeExt");var IS=127;function Vg(n,e){let t=0,r=n.length-1;for(;t<=r;){let i=r+t>>1,s=e-n[i].tileId;if(s>0)t=i+1;else if(s<0)r=i-1;else return n[i]}return r>=0&&(n[r].runLength===0||e-n[r].tileId<n[r].runLength)?n[r]:null}De(Vg,"findTile");var CS=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return ht(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};De(CS,"FileSource");var Xg=class{constructor(e,t=new Headers){var r,i;this.url=e,this.customHeaders=t,this.mustReload=!1;let s="";"navigator"in globalThis&&(s=(i=(r=globalThis.navigator)==null?void 0:r.userAgent)!=null?i:"");let o=s.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(s);this.chromeWindowsNoCache=!1,o&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,i){return ht(this,null,function*(){let s,o;r?o=r:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&u.status===416){let f=u.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let p=+f.substr(8);u=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${p-1}`}})}let c=u.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),u.status===416||i&&c&&c!==i)throw this.mustReload=!0,new Wl(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let h=u.headers.get("Content-Length");if(u.status===200&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:c||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};De(Xg,"FetchSource");var LS=Xg;function Jt(n,e){let t=n.getUint32(e+4,!0),r=n.getUint32(e+0,!0);return t*vS(2,32)+r}De(Jt,"getUint64");function Zg(n,e){let t=new DataView(n),r=t.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Jt(t,8),rootDirectoryLength:Jt(t,16),jsonMetadataOffset:Jt(t,24),jsonMetadataLength:Jt(t,32),leafDirectoryOffset:Jt(t,40),leafDirectoryLength:Jt(t,48),tileDataOffset:Jt(t,56),tileDataLength:Jt(t,64),numAddressedTiles:Jt(t,72),numTileEntries:Jt(t,80),numTileContents:Jt(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}De(Zg,"bytesToHeader");function xc(n){let e={buf:new Uint8Array(n),pos:0},t=Yn(e),r=[],i=0;for(let s=0;s<t;s++){let o=Yn(e);r.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)r[s].runLength=Yn(e);for(let s=0;s<t;s++)r[s].length=Yn(e);for(let s=0;s<t;s++){let o=Yn(e);o===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=o-1}return r}De(xc,"deserializeIndex");var Wg=class extends Error{};De(Wg,"EtagMismatch");var Wl=Wg;function bc(n,e){return ht(this,null,function*(){let t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let r=t.data.slice(0,IS),i=Zg(r,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${n.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=xc(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}De(bc,"getHeaderAndRoot");function Ec(n,e,t,r,i){return ht(this,null,function*(){let s=yield n.getBytes(t,r,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=xc(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}De(Ec,"getDirectory");var FS=class{constructor(e=100,t=!0,r=ha){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return ht(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let i=yield bc(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,r,i){return ht(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield Ec(e,this.decompress,t,r,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return ht(this,null,function*(){this.cache.delete(e.getKey())})}};De(FS,"ResolvedValueCache");var Hg=class{constructor(e=100,t=!0,r=ha){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return ht(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((s,o)=>{bc(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,r,i){return ht(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,u)=>{Ec(e,this.decompress,t,r,i).then(c=>{l(c),this.prune()}).catch(c=>{u(c)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return ht(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,r)})}};De(Hg,"SharedPromiseCache");var MS=Hg,qg=class{constructor(e,t,r){typeof e=="string"?this.source=new LS(e):this.source=e,r?this.decompress=r:this.decompress=ha,t?this.cache=t:this.cache=new MS}getHeader(){return ht(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,i){return ht(this,null,function*(){let s=zg(e,t,r),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let u=0;u<=3;u++){let c=yield this.cache.getDirectory(this.source,a,l,o),h=Vg(c,s);if(h){if(h.runLength>0){let f=yield this.source.getBytes(o.tileDataOffset+h.offset,h.length,i,o.etag);return{data:yield this.decompress(f.data,o.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}a=o.leafDirectoryOffset+h.offset,l=h.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,i){return ht(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,i)}catch(s){if(s instanceof Wl)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,i);throw s}})}getMetadataAttempt(){return ht(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return ht(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof Wl)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return ht(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),i=jg(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};De(qg,"PMTiles");var us=qg,Yg=Object.defineProperty,Cf=Object.getOwnPropertySymbols,OS=Object.prototype.hasOwnProperty,NS=Object.prototype.propertyIsEnumerable,Lf=(n,e,t)=>e in n?Yg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Co=(n,e)=>{for(var t in e||(e={}))OS.call(e,t)&&Lf(n,t,e[t]);if(Cf)for(var t of Cf(e))NS.call(e,t)&&Lf(n,t,e[t]);return n},fa=(n,e)=>Yg(n,"name",{value:e,configurable:!0}),DS=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),Kg=class extends Ap{constructor(e){super(Co(Co({},e),{state:"loading"})),this.loadImage=fa(r=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=r}),"loadImage");const t=new us(e.url);t.getHeader().then(r=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||vs({extent:ta(i),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((s,o,a)=>DS(this,null,function*(){const l=yield t.getZxy(s,o,a);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),c=yield this.loadImage(u);return URL.revokeObjectURL(u),c})),this.setState("ready")})}};fa(Kg,"PMTilesRasterSource");var Ff=Kg,Jg=class extends Cs{constructor(e){super(Co(Co({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new mc})),this.tileLoadFunction=fa((t,r)=>{const i=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),o=r.match(s);if(!(o&&o.length>=4))throw Error("Could not parse tile URL");const a=+o[1],l=+o[2],u=+o[3];i.setLoader((c,h,f)=>{this.pmtiles_.getZxy(a,l,u).then(p=>{if(p){const d=i.getFormat();i.setFeatures(d.readFeatures(p.data,{extent:c,featureProjection:f})),i.setState(ue.LOADED)}else i.setFeatures([]),i.setState(ue.EMPTY)}).catch(p=>{i.setFeatures([]),i.setState(ue.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new us(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",i=e.extent||ta(r);this.tileGrid=e.tileGrid||vs({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};fa(Jg,"PMTilesVectorSource");var GS=Jg;class US extends Ou{constructor(e){super(Dn.ERROR),this.error=e}}function bt(n){return(e,...t)=>BS(n,e,t)}function Ai(n,e){return bt(Qg(n,e).get)}const{apply:BS,getOwnPropertyDescriptor:Qg,getPrototypeOf:Tc,ownKeys:kS}=Reflect,{iterator:Fs,toStringTag:zS}=Symbol,$S=Object,{create:wc,defineProperty:jS}=$S,VS=Array,XS=VS.prototype,em=XS[Fs],ZS=bt(em),tm=ArrayBuffer,WS=tm.prototype;Ai(WS,"byteLength");const Mf=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Mf&&Ai(Mf.prototype,"byteLength");const rm=Tc(Uint8Array);rm.from;const Ct=rm.prototype;Ct[Fs];bt(Ct.keys);bt(Ct.values);bt(Ct.entries);bt(Ct.set);bt(Ct.reverse);bt(Ct.fill);bt(Ct.copyWithin);bt(Ct.sort);bt(Ct.slice);bt(Ct.subarray);Ai(Ct,"buffer");Ai(Ct,"byteOffset");Ai(Ct,"length");Ai(Ct,zS);const HS=Uint8Array,nm=Uint16Array,vc=Uint32Array,qS=Float32Array,cs=Tc([][Fs]()),im=bt(cs.next),YS=bt(function*(){}().next),KS=Tc(cs),JS=DataView.prototype,QS=bt(JS.getUint16),Sc=WeakMap,sm=Sc.prototype,om=bt(sm.get),eR=bt(sm.set),am=new Sc,tR=wc(null,{next:{value:function(){const e=om(am,this);return im(e)}},[Fs]:{value:function(){return this}}});function rR(n){if(n[Fs]===em&&cs.next===im)return n;const e=wc(tR);return eR(am,e,ZS(n)),e}const nR=new Sc,iR=wc(KS,{next:{value:function(){const e=om(nR,this);return YS(e)},writable:!0,configurable:!0}});for(const n of kS(cs))n!=="next"&&jS(iR,n,Qg(cs,n));const lm=new tm(4),sR=new qS(lm),oR=new vc(lm),pr=new nm(512),gr=new HS(512);for(let n=0;n<256;++n){const e=n-127;e<-24?(pr[n]=0,pr[n|256]=32768,gr[n]=24,gr[n|256]=24):e<-14?(pr[n]=1024>>-e-14,pr[n|256]=1024>>-e-14|32768,gr[n]=-e-1,gr[n|256]=-e-1):e<=15?(pr[n]=e+15<<10,pr[n|256]=e+15<<10|32768,gr[n]=13,gr[n|256]=13):e<128?(pr[n]=31744,pr[n|256]=64512,gr[n]=24,gr[n|256]=24):(pr[n]=31744,pr[n|256]=64512,gr[n]=13,gr[n|256]=13)}const Rc=new vc(2048);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Rc[n]=e|t}for(let n=1024;n<2048;++n)Rc[n]=939524096+(n-1024<<13);const Ii=new vc(64);for(let n=1;n<31;++n)Ii[n]=n<<23;Ii[31]=1199570944;Ii[32]=2147483648;for(let n=33;n<63;++n)Ii[n]=2147483648+(n-32<<23);Ii[63]=3347054592;const um=new nm(64);for(let n=1;n<64;++n)n!==32&&(um[n]=1024);function aR(n){const e=n>>10;return oR[0]=Rc[um[e]+(n&1023)]+Ii[e],sR[0]}function cm(n,e,...t){return aR(QS(n,e,...rR(t)))}var Pc={exports:{}};function hm(n,e,t){const r=t&&t.debug||!1;r&&console.log("[xml-utils] getting "+e+" in "+n);const i=typeof n=="object"?n.outer:n,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],u=e+"\\="+l+"([^"+l+"]*)"+l;r&&console.log("[xml-utils] pattern:",u);const h=new RegExp(u).exec(s);if(r&&console.log("[xml-utils] match:",h),h)return h[1]}}Pc.exports=hm;Pc.exports.default=hm;var lR=Pc.exports;const Ja=Lp(lR);var Ac={exports:{}},Ic={exports:{}},Cc={exports:{}};function fm(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index:-1}Cc.exports=fm;Cc.exports.default=fm;var uR=Cc.exports,Lc={exports:{}};function dm(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index+i[0].length-1:-1}Lc.exports=dm;Lc.exports.default=dm;var cR=Lc.exports,Fc={exports:{}};function pm(n,e){const t=new RegExp(e,"g"),r=n.match(t);return r?r.length:0}Fc.exports=pm;Fc.exports.default=pm;var hR=Fc.exports;const fR=uR,Qa=cR,Of=hR;function gm(n,e,t){const r=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;r&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=fR(n,`<${e}[ 
>/]`,s);if(r&&console.log("[xml-utils] start:",o),o===-1)return;const a=n.slice(o+e.length);let l=Qa(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(r&&console.log("[xml-utils] selfClosing:",u),u===!1)if(i){let p=0,d=1,g=0;for(;(l=Qa(a,"[ /]"+e+">",p))!==-1;){const m=a.substring(p,l+1);if(d+=Of(m,"<"+e+`[ 
	>]`),g+=Of(m,"</"+e+">"),g>=d)break;p=l}}else l=Qa(a,"[ /]"+e+">",0);const c=o+e.length+l+1;if(r&&console.log("[xml-utils] end:",c),c===-1)return;const h=n.slice(o,c);let f;return u?f=null:f=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:f,outer:h,start:o,end:c}}Ic.exports=gm;Ic.exports.default=gm;var dR=Ic.exports;const pR=dR;function mm(n,e,t){const r=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=pR(n,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,r.push(a);return i&&console.log("findTagsByName found",r.length,"tags"),r}Ac.exports=mm;Ac.exports.default=mm;var gR=Ac.exports;const mR=Lp(gR),Hi={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},mr={};for(const n in Hi)Hi.hasOwnProperty(n)&&(mr[Hi[n]]=parseInt(n,10));const yR=[mr.BitsPerSample,mr.ExtraSamples,mr.SampleFormat,mr.StripByteCounts,mr.StripOffsets,mr.StripRowCounts,mr.TileByteCounts,mr.TileOffsets,mr.SubIFDs],el={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},oe={};for(const n in el)el.hasOwnProperty(n)&&(oe[el[n]]=parseInt(n,10));const At={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},_R={Unspecified:0},V2={AddCompression:1},X2={None:0,Deflate:1,Zstandard:2},xR={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function bR(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=256-n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function ER(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function TR(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<n.length;++a,l+=3){const u=n[a];i[l]=e[u]/65536*256,i[l+1]=e[u+s]/65536*256,i[l+2]=e[u+o]/65536*256}return i}function wR(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=4,s+=3){const o=n[i],a=n[i+1],l=n[i+2],u=n[i+3];r[s]=255*((255-o)/256)*((255-u)/256),r[s+1]=255*((255-a)/256)*((255-u)/256),r[s+2]=255*((255-l)/256)*((255-u)/256)}return r}function vR(n){const{width:e,height:t}=n,r=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i],a=n[i+1],l=n[i+2];r[s]=o+1.402*(l-128),r[s+1]=o-.34414*(a-128)-.71414*(l-128),r[s+2]=o+1.772*(a-128)}return r}const SR=.95047,RR=1,PR=1.08883;function AR(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i+0],a=n[i+1]<<24>>24,l=n[i+2]<<24>>24;let u=(o+16)/116,c=a/500+u,h=u-l/200,f,p,d;c=SR*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),u=RR*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=PR*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),f=c*3.2406+u*-1.5372+h*-.4986,p=c*-.9689+u*1.8758+h*.0415,d=c*.0557+u*-.204+h*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,r[s]=Math.max(0,Math.min(1,f))*255,r[s+1]=Math.max(0,Math.min(1,p))*255,r[s+2]=Math.max(0,Math.min(1,d))*255}return r}const ym=new Map;function fn(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>ym.set(t,e))}async function _m(n){const e=ym.get(n.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const t=await e();return new t(n)}fn([void 0,1],()=>$r(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(n=>n.default));fn(5,()=>$r(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(n=>n.default));fn(6,()=>{throw new Error("old style JPEG compression is not supported.")});fn(7,()=>$r(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(n=>n.default));fn([8,32946],()=>$r(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(n=>n.default));fn(32773,()=>$r(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(n=>n.default));fn(34887,()=>$r(()=>import("./lerc.DV5BVH5q.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15,16])).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));fn(50001,()=>$r(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([17,1])).then(n=>n.default));function da(n,e,t,r=1){return new(Object.getPrototypeOf(n)).constructor(e*t*r)}function IR(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=da(a,r,i);for(let u=0;u<i;++u){const c=Math.min(Math.round(o*u),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(s*h),e-1),p=a[c*e+f];l[u*r+h]=p}}return l})}function oi(n,e,t){return(1-t)*n+t*e}function CR(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=da(a,r,i);for(let u=0;u<i;++u){const c=o*u,h=Math.floor(c),f=Math.min(Math.ceil(c),t-1);for(let p=0;p<r;++p){const d=s*p,g=d%1,m=Math.floor(d),y=Math.min(Math.ceil(d),e-1),_=a[h*e+m],x=a[h*e+y],T=a[f*e+m],b=a[f*e+y],E=oi(oi(_,x,g),oi(T,b,g),c%1);l[u*r+p]=E}}return l})}function LR(n,e,t,r,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return IR(n,e,t,r,i);case"bilinear":case"linear":return CR(n,e,t,r,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function FR(n,e,t,r,i,s){const o=e/r,a=t/i,l=da(n,r,i,s);for(let u=0;u<i;++u){const c=Math.min(Math.round(a*u),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(o*h),e-1);for(let p=0;p<s;++p){const d=n[c*e*s+f*s+p];l[u*r*s+h*s+p]=d}}}return l}function MR(n,e,t,r,i,s){const o=e/r,a=t/i,l=da(n,r,i,s);for(let u=0;u<i;++u){const c=a*u,h=Math.floor(c),f=Math.min(Math.ceil(c),t-1);for(let p=0;p<r;++p){const d=o*p,g=d%1,m=Math.floor(d),y=Math.min(Math.ceil(d),e-1);for(let _=0;_<s;++_){const x=n[h*e*s+m*s+_],T=n[h*e*s+y*s+_],b=n[f*e*s+m*s+_],E=n[f*e*s+y*s+_],w=oi(oi(x,T,g),oi(b,E,g),c%1);l[u*r*s+p*s+_]=w}}}return l}function OR(n,e,t,r,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return FR(n,e,t,r,i,s);case"bilinear":case"linear":return MR(n,e,t,r,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function NR(n,e,t){let r=0;for(let i=e;i<t;++i)r+=n[i];return r}function Hl(n,e,t){switch(n){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function DR(n,e){return(n===1||n===2)&&e<=32&&e%8===0?!1:!(n===3&&(e===16||e===32||e===64))}function GR(n,e,t,r,i,s,o){const a=new DataView(n),l=t===2?o*s:o*s*r,u=t===2?1:r,c=Hl(e,i,l),h=parseInt("1".repeat(i),2);if(e===1){let f;t===1?f=r*i:f=i;let p=s*f;p&7&&(p=p+7&-8);for(let d=0;d<o;++d){const g=d*p;for(let m=0;m<s;++m){const y=g+m*u*i;for(let _=0;_<u;++_){const x=y+_*i,T=(d*s+m)*u+_,b=Math.floor(x/8),E=x%8;if(E+i<=8)c[T]=a.getUint8(b)>>8-i-E&h;else if(E+i<=16)c[T]=a.getUint16(b)>>16-i-E&h;else if(E+i<=24){const w=a.getUint16(b)<<8|a.getUint8(b+2);c[T]=w>>24-i-E&h}else c[T]=a.getUint32(b)>>32-i-E&h}}}}return c.buffer}class xm{constructor(e,t,r,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(i,s){return cm(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return Hl(r,i,t)}async getTileOrStrip(e,t,r,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=r*o*a+t*o+e);let c,h;this.isTiled?(c=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:c,length:h}],s))[0];let p;return u===null||!u[l]?(p=(async()=>{let d=await i.decode(this.fileDirectory,f);const g=this.getSampleFormat(),m=this.getBitsPerSample();return DR(g,m)&&(d=GR(d,g,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),d})(),u!==null&&(u[l]=p)):p=u[l],{x:e,y:t,sample:r,data:await p}}async _readRaster(e,t,r,i,s,o,a,l,u){const c=this.getTileWidth(),h=this.getTileHeight(),f=this.getWidth(),p=this.getHeight(),d=Math.max(Math.floor(e[0]/c),0),g=Math.min(Math.ceil(e[2]/c),Math.ceil(f/c)),m=Math.max(Math.floor(e[1]/h),0),y=Math.min(Math.ceil(e[3]/h),Math.ceil(p/h)),_=e[2]-e[0];let x=this.getBytesPerPixel();const T=[],b=[];for(let S=0;S<t.length;++S)this.planarConfiguration===1?T.push(NR(this.fileDirectory.BitsPerSample,0,t[S])/8):T.push(0),b.push(this.getReaderForSample(t[S]));const E=[],{littleEndian:w}=this;for(let S=m;S<y;++S)for(let v=d;v<g;++v){let R;this.planarConfiguration===1&&(R=this.getTileOrStrip(v,S,0,s,u));for(let C=0;C<t.length;++C){const F=C,N=t[C];this.planarConfiguration===2&&(x=this.getSampleByteSize(N),R=this.getTileOrStrip(v,S,N,s,u));const D=R.then(A=>{const M=A.data,O=new DataView(M),$=this.getBlockHeight(A.y),V=A.y*h,H=A.x*c,ee=V+$,fe=(A.x+1)*c,J=b[F],G=Math.min($,$-(ee-e[3]),p-V),Ae=Math.min(c,c-(fe-e[2]),f-H);for(let Ie=Math.max(0,e[1]-V);Ie<G;++Ie)for(let be=Math.max(0,e[0]-H);be<Ae;++be){const ot=(Ie*c+be)*x,Me=J.call(O,ot+T[F],w);let Je;i?(Je=(Ie+V-e[1])*_*t.length+(be+H-e[0])*t.length+F,r[Je]=Me):(Je=(Ie+V-e[1])*_+be+H-e[0],r[F][Je]=Me)}});E.push(D)}}if(await Promise.all(E),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let S;return i?S=OR(r,e[2]-e[0],e[3]-e[1],o,a,t.length,l):S=LR(r,e[2]-e[0],e[3]-e[1],o,a,l),S.width=o,S.height=a,S}return r.width=o||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=c[2]-c[0],f=c[3]-c[1],p=h*f,d=this.getSamplesPerPixel();if(!t||!t.length)for(let _=0;_<d;++_)t.push(_);else for(let _=0;_<t.length;++_)if(t[_]>=d)return Promise.reject(new RangeError(`Invalid sample index '${t[_]}'.`));let g;if(r){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,x=Math.max.apply(null,this.fileDirectory.BitsPerSample);g=Hl(_,x,p*t.length),l&&g.fill(l)}else{g=[];for(let _=0;_<t.length;++_){const x=this.getArrayForSample(t[_],p);Array.isArray(l)&&_<l.length?x.fill(l[_]):l&&!Array.isArray(l)&&x.fill(l),g.push(x)}}const m=i||await _m(this.fileDirectory);return await this._readRaster(c,t,g,r,m,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===At.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==_R.Unspecified&&a){y=[];for(let _=0;_<this.fileDirectory.BitsPerSample.length;_+=1)y.push(_)}return this.readRasters({window:e,interleave:t,samples:y,pool:r,width:i,height:s,resampleMethod:o,signal:l})}let h;switch(c){case At.WhiteIsZero:case At.BlackIsZero:case At.Palette:h=[0];break;case At.CMYK:h=[0,1,2,3];break;case At.YCbCr:case At.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:u,interleave:!0,samples:h,pool:r,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:p}=this,d=await this.readRasters(f),g=2**this.fileDirectory.BitsPerSample[0];let m;switch(c){case At.WhiteIsZero:m=bR(d,g);break;case At.BlackIsZero:m=ER(d,g);break;case At.Palette:m=TR(d,p.ColorMap);break;case At.CMYK:m=wR(d);break;case At.YCbCr:m=vR(d);break;case At.CIELab:m=AR(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),_=new Uint8Array(m.length/3),x=new Uint8Array(m.length/3);for(let T=0,b=0;T<m.length;T+=3,++b)y[b]=m[T],_[b]=m[T+1],x[b]=m[T+2];m=[y,_,x]}return m.width=d.width,m.height=d.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=mR(r,"Item");e===null?i=i.filter(s=>Ja(s,"sample")===void 0):i=i.filter(s=>Number(Ja(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[Ja(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return r[1]===0&&r[4]===0?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,u,c,h]=this.fileDirectory.ModelTransformation,p=[[0,0],[0,t],[r,0],[r,t]].map(([m,y])=>[a+i*m+s*y,h+l*m+u*y]),d=p.map(m=>m[0]),g=p.map(m=>m[1]);return[Math.min(...d),Math.min(...g),Math.max(...d),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*r,u=a+s[1]*t;return[Math.min(o,l),Math.min(a,u),Math.max(o,l),Math.max(a,u)]}}}class UR{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let r=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return cm(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class BR{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const kR=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class bm{constructor(e=kR,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(r=>{$r(()=>import("./decoder.tqM1uIvc.js"),[]).then(i=>{r(i.create)})}),this._awaitingDecoder.then(r=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:r(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?_m(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,r(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Nf=`\r
\r
`;function Em(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const e={};for(const[t,r]of n)e[t.toLowerCase()]=r;return e}function zR(n){const e=n.split(`\r
`).map(t=>{const r=t.split(":").map(i=>i.trim());return r[0]=r[0].toLowerCase(),r});return Em(e)}function $R(n){const[e,...t]=n.split(";").map(i=>i.trim()),r=t.map(i=>i.split("="));return{type:e,params:Em(r)}}function ql(n){let e,t,r;return n&&([,e,t,r]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),r=parseInt(r,10)),{start:e,end:t,total:r}}function jR(n,e){let t=null;const r=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)r.decode(new Uint8Array(n,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<n.byteLength;){const a=r.decode(new Uint8Array(n,t,Math.min(s.length+1024,n.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(Nf),c=zR(l.substr(0,u)),{start:h,end:f,total:p}=ql(c["content-range"]),d=t+s.length+u+Nf.length,g=parseInt(f,10)+1-parseInt(h,10);i.push({headers:c,data:n.slice(d,d+g),offset:h,length:g,fileSize:p}),t=d+g+4}return i}class Mc{async fetch(e,t=void 0){return Promise.all(e.map(r=>this.fetchSlice(r,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class VR extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield e)}for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function XR(n){return new Promise(e=>setTimeout(e,n))}function ZR(n,e){const t=Array.isArray(n)?n:Array.from(n),r=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,r[s]])}class di extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,di),this.name="AbortError"}}class WR extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const HR=WR;class qR{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class Df{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class YR extends Mc{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new VR({maxSize:r,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:p}of e){let d=f+p;const{fileSize:g}=this;g!==null&&(d=Math.min(d,g));const m=Math.floor(f/this.blockSize)*this.blockSize;for(let y=m;y<d;y+=this.blockSize){const _=Math.floor(y/this.blockSize);!this.blockCache.has(_)&&!this.blockRequests.has(_)&&(this.blockIdsToFetch.add(_),i.push(_)),this.blockRequests.has(_)&&r.push(this.blockRequests.get(_)),s.push(_)}}await XR(),this.fetchBlocks(t);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(r),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const f of l){const p=this.blockRequests.get(f);if(!p)throw new Error(`Block ${f} is not in the block requests`);a.push(p)}await Promise.allSettled(a)}if(t&&t.aborted)throw new di("Request was aborted");const u=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),c=u.filter(f=>!f);if(c.length)throw new HR(c,"Request failed");const h=new Map(ZR(s,u));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await r)[i],l=o*this.blockSize,u=l-a.offset,c=Math.min(u+this.blockSize,a.data.byteLength),h=a.data.slice(u,c),f=new qR(l,h.byteLength,h,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let r=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(r.push(o),i=o):(s.push(new Df(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[o],i=o);return s.push(new Df(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(r=>{let i=r.offset+r.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(r.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(r.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const c=t.get(u),h=c.offset-r.offset,f=c.top-i;let p=0,d=0,g;h<0?p=-h:h>0&&(d=h),f<0?g=c.length-p:g=i-c.offset-p;const m=new Uint8Array(c.data,p,g);l.set(m,d)}return a})}}class Oc{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Nc{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class KR extends Oc{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class JR extends Nc{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new KR(r)}}class QR extends Oc{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class eP extends Nc{constructRequest(e,t){return new Promise((r,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;r(new QR(s,o))},s.onerror=i,s.onabort=()=>i(new di("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const tl={};class tP extends Oc{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class rP extends Nc{constructor(e){super(e),this.parsedUrl=tl.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",tl)}constructRequest(e,t){return new Promise((r,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",c=>{u.push(c)}),o.on("end",()=>{const c=Buffer.concat(u).buffer;l(c)}),o.on("error",i)});r(new tP(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new di("Request aborted")),t.addEventListener("abort",()=>s.destroy(new di("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Dc extends Mc{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(r=>this.fetchSlice(r,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(r.ok)if(r.status===206){const{type:i,params:s}=$R(r.getHeader("content-type"));if(i==="multipart/byteranges"){const h=jR(await r.getData(),s.boundary);return this._fileSize=h[0].fileSize||null,h}const o=await r.getData(),{start:a,end:l,total:u}=ql(r.getHeader("content-range"));this._fileSize=u||null;const c=[{data:o,offset:a,length:l-a}];if(e.length>1){const h=await Promise.all(e.slice(1).map(f=>this.fetchSlice(f,t)));return c.concat(h)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await r.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=ql(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:r,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Gc(n,{blockSize:e,cacheSize:t}){return e===null?n:new YR(n,{blockSize:e,cacheSize:t})}function nP(n,{headers:e={},credentials:t,maxRanges:r=0,allowFullFile:i=!1,...s}={}){const o=new JR(n,t),a=new Dc(o,e,r,i);return Gc(a,s)}function iP(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new eP(n),o=new Dc(s,e,t,r);return Gc(o,i)}function sP(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new rP(n),o=new Dc(s,e,t,r);return Gc(o,i)}function Yl(n,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?nP(n,t):typeof XMLHttpRequest<"u"?iP(n,t):sP(n,t)}class oP extends Mc{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>r(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function aP(n){return new oP(n)}function Kl(n){switch(n){case oe.BYTE:case oe.ASCII:case oe.SBYTE:case oe.UNDEFINED:return 1;case oe.SHORT:case oe.SSHORT:return 2;case oe.LONG:case oe.SLONG:case oe.FLOAT:case oe.IFD:return 4;case oe.RATIONAL:case oe.SRATIONAL:case oe.DOUBLE:case oe.LONG8:case oe.SLONG8:case oe.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function lP(n){const e=n.GeoKeyDirectory;if(!e)return null;const t={};for(let r=4;r<=e[3]*4;r+=4){const i=xR[e[r]],s=e[r+1]?Hi[e[r+1]]:null,o=e[r+2],a=e[r+3];let l=null;if(!s)l=a;else{if(l=n[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Zn(n,e,t,r){let i=null,s=null;const o=Kl(e);switch(e){case oe.BYTE:case oe.ASCII:case oe.UNDEFINED:i=new Uint8Array(t),s=n.readUint8;break;case oe.SBYTE:i=new Int8Array(t),s=n.readInt8;break;case oe.SHORT:i=new Uint16Array(t),s=n.readUint16;break;case oe.SSHORT:i=new Int16Array(t),s=n.readInt16;break;case oe.LONG:case oe.IFD:i=new Uint32Array(t),s=n.readUint32;break;case oe.SLONG:i=new Int32Array(t),s=n.readInt32;break;case oe.LONG8:case oe.IFD8:i=new Array(t),s=n.readUint64;break;case oe.SLONG8:i=new Array(t),s=n.readInt64;break;case oe.RATIONAL:i=new Uint32Array(t*2),s=n.readUint32;break;case oe.SRATIONAL:i=new Int32Array(t*2),s=n.readInt32;break;case oe.FLOAT:i=new Float32Array(t),s=n.readFloat32;break;case oe.DOUBLE:i=new Float64Array(t),s=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===oe.RATIONAL||e===oe.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(n,r+a*o),i[a+1]=s.call(n,r+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(n,r+a*o);return e===oe.ASCII?new TextDecoder("utf-8").decode(i):i}class uP{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class Hs extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Tm{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const c=await this.getImageCount(),h=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[d,g]=l.getOrigin(),[m,y]=l.getResolution();a=[d+t[0]*m,g+t[1]*y,d+t[2]*m,g+t[3]*y]}const p=a||h;if(r){if(s)throw new Error("Both width and resX passed");s=(p[2]-p[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(p[3]-p[1])/i}}if(s||o){const p=[];for(let d=0;d<c;++d){const g=await this.getImage(d),{SubfileType:m,NewSubfileType:y}=g.fileDirectory;(d===0||m===2||y&1)&&p.push(g)}p.sort((d,g)=>d.getWidth()-g.getWidth());for(let d=0;d<p.length;++d){const g=p[d],m=(h[2]-h[0])/g.getWidth(),y=(h[3]-h[1])/g.getHeight();if(u=g,s&&s>m||o&&o>y)break}}let f=t;if(a){const[p,d]=l.getOrigin(),[g,m]=u.getResolution(l);f=[Math.round((a[0]-p)/g),Math.round((a[1]-d)/m),Math.round((a[2]-p)/g),Math.round((a[3]-d)/m)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return u.readRasters({...e,window:f})}}class pi extends Tm{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new BR((await this.source.fetch([{offset:e,length:typeof t<"u"?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let h=0;h<s;l+=t,++h){const f=i.readUint16(l),p=i.readUint16(l+2),d=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let g,m;const y=Kl(p),_=l+(this.bigTiff?12:8);if(y*d<=(this.bigTiff?8:4))g=Zn(i,p,d,_);else{const x=i.readOffset(_),T=Kl(p)*d;if(i.covers(x,T))g=Zn(i,p,d,x);else{const b=await this.getSlice(x,T);g=Zn(b,p,d,x)}}d===1&&yR.indexOf(f)===-1&&!(p===oe.RATIONAL||p===oe.SRATIONAL)?m=g[0]:m=g,a[Hi[f]]=m}const u=lP(a),c=i.readOffset(e+r+t*s);return new uP(a,u,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Hs?new Hs(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Hs(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new xm(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(r instanceof Hs)t=!1;else throw r}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===Zn(i,oe.ASCII,t.length,e)){const o=Zn(i,oe.ASCII,r,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>r&&(i=await this.getSlice(e,a));const l=Zn(i,oe.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,c])=>{this.ghostValues[u]=c})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],s=new UR(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=u?s.getUint64(8,a):s.getUint32(4,a);return new pi(e,a,u,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class cP extends Tm{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(r);return new xm(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,r)=>t+r,0),this.imageCount}}async function wm(n,e={},t){return pi.fromSource(Yl(n,e),t)}async function vm(n,e){return pi.fromSource(aP(n),e)}async function Sm(n,e=[],t={},r){const i=await pi.fromSource(Yl(n,t),r),s=await Promise.all(e.map(o=>pi.fromSource(Yl(o,t))));return new cP(i,s)}const hP="https://stac-extensions.github.io/label/v1.*/schema.json",Rm=new ti({color:"rgba(0,0,0,0)"});function Pm(n,e,t="rgba(255,255,255,0.4)",r=5){let i=Rm;t&&(i=new ti({color:t}));const s=new zi({color:n,width:e});return new Tn({image:new Ip({fill:i,stroke:s,radius:r}),fill:i,stroke:s})}const fP=Pm("#3399CC",3),Gf=Pm("#ff9933",2,null);function dP(n,e){const t={url:n.getAbsoluteUrl()};let r=n,i=n.getBands();i.length===1&&(r=i[0],i=[]);const{minimum:s,maximum:o}=r.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof o=="number"&&(t.max=o),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:u,maximum:c}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof c=="number"&&(typeof t.max>"u"||c>t.max)&&(t.max=c)}const a=r.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const u of i){const c=u.getNoDataValues();if(c.length>0){if(typeof l>"u")l=c[0];else if(l!==c[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=n.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function pP(n){try{const{fromProjectionCode:e,fromEPSGCode:t}=await $r(async()=>{const{fromProjectionCode:r,fromEPSGCode:i}=await import("./proj4.Dg0Z8G9Q.js");return{fromProjectionCode:r,fromEPSGCode:i}},__vite__mapDeps([18,13,11,10]));return typeof e=="function"?await e(n):await t(n)}catch{return null}}async function Uf(n,e=void 0){return void 0||e}function Bf(n,e){const t=n.clone();return e.hasOnlyBounds()||t.setFill(Rm),t}function gP(n){let e=n.href;if(e.includes("{s}"))if(Array.isArray(n["href:servers"])&&n["href:servers"].length>0){const t=Math.random()*n["href:servers"].length|0;e=e.replace("{s}",n["href:servers"][t])}else return null;return e}function kf(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"}function mP(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function yP(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=At;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const zf="STATISTICS_MAXIMUM",$f="STATISTICS_MINIMUM",rl=256;let nl;function _P(){return nl||(nl=new bm),nl}function xP(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function bP(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function EP(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}async function jf(n,e,t,r){const i=n[e];if(i&&i!==32767){const s="EPSG:"+i;let o=Ue(s);if(!o&&r&&(o=await pP(s)),!o){const a=tx(n[t]);a&&(o=new Pp({code:s,units:a}))}return o||null}}async function TP(n,e){const t=n.geoKeys;if(!t)return null;const r=await jf(t,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",e);return r||await jf(t,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",e)}function wP(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function vP(n,e){let t;return n.blob?t=vm(n.blob):n.overviews?t=Sm(n.url,n.overviews,e):t=wm(n.url,e),t.then(wP)}function $i(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)$i(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function SP(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function RP(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}let Am=class extends Ap{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=vP(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){return r.configure_(s)}).catch(function(s){Gh(s),r.error_=s,r.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=await TP(i,this.loadMissingProjection_);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,u,c,h,f,p]=s,d=Il(Il([1/Math.sqrt(o*o+c*c),0,0,-1/Math.sqrt(a*a+h*h),u,p],[o,c,a,h,0,0]),[1,0,0,1,-u,-p]);this.transformMatrix=d,this.addAlpha_=!0;break}}}async configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let c=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(v=>{mP(v)?_.push(v):y.push(v)});const x=y.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let T,b;const E=new Array(x),w=new Array(x),S=new Array(x);l[m]=new Array(x),u[m]=new Array(x);for(let v=0;v<x;++v){const R=y[v],C=R.getGDALNoData();u[m][v]=R.getGDALMetadata(0),l[m][v]=C;const F=this.sourceInfo_[m].bands;a[m]=F?F.length:R.getSamplesPerPixel();const N=x-(v+1);T||(T=xP(R)),b||(b=bP(R));const D=EP(R,y[0]);S[N]=D[0];const A=[R.getTileWidth(),R.getTileHeight()];A[0]!==A[1]&&A[1]<rl&&(A[0]=rl,A[1]=rl),E[N]=A;const M=D[0]/Math.abs(D[1]);w[N]=[A[0],A[1]/M]}if(t?cn(t,T,t):t=T,!r)r=b;else{const v=`Origin mismatch for source ${m}, got [${b}] but expected [${r}]`;$i(r,b,0,v,this.viewRejector)}if(!o)o=S,this.resolutionFactors_[m]=1;else{o.length-c>S.length&&(c=o.length-S.length);const v=o[o.length-1]/S[S.length-1];this.resolutionFactors_[m]=v;const R=S.map(F=>F*=v),C=`Resolution mismatch for source ${m}, got [${R}] but expected [${o}]`;$i(o.slice(c,o.length),R,.02,C,this.viewRejector)}i?$i(i.slice(c,i.length),w,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=w,s?$i(s.slice(c,s.length),E,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=E,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let x=0;x<_.length;++x)if(y[_[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let m=0;m<h;++m)f+=a[m];this.bandCount=f;const p=new Gu({extent:t,minZoom:c,origin:r,resolutions:o,tileSizes:i});this.tileGrid=p,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const d=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=J0(xo(),this.transformMatrix.slice()),y=rx(_=>ls(m,_));g=cp(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:ex(Ei(g),this.projection),extent:Q0(g,this.projection),zoom:d})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,u=this.sourceInfo_,c=_P();for(let h=0;h<o;++h){const f=u[h],p=this.resolutionFactors_[h],d=[Math.round(t*(s[0]*p)),Math.round(r*(s[1]*p)),Math.round((t+1)*(s[0]*p)),Math.round((r+1)*(s[1]*p))],g=this.sourceImagery_[h][e];let m;f.bands&&(m=f.bands.map(function(b){return b-1}));let y;"nodata"in f&&f.nodata!==null?y=f.nodata:m?y=m.map(function(b){return l[h][b]}):y=l[h];const _={window:d,width:s[0],height:s[1],samples:m,fillValue:y,pool:c,interleave:!1,signal:i.signal};yP(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const x=o+h,T=this.sourceMasks_[h][e];if(!T){a[x]=Promise.resolve(null);continue}a[x]=T.readRasters({window:d,width:s[0],height:s[1],samples:[0],pool:c,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw Gh(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,c=this.addAlpha_,h=e[0]*e[1],f=h*o;let p;u?p=new Uint8Array(f):p=new Float32Array(f);let d=0;for(let g=0;g<h;++g){let m=c;for(let y=0;y<s;++y){const _=i[y];let x=_.min,T=_.max,b,E;if(u){const w=r[y][0];x===void 0&&(w&&$f in w?x=parseFloat(w[$f]):x=SP(t[y][0])),T===void 0&&(w&&zf in w?T=parseFloat(w[zf]):T=RP(t[y][0])),b=255/(T-x),E=-x*b}for(let w=0;w<a[y];++w){const S=t[y][w][g];let v;if(u?v=g0(b*S+E,0,255):v=S,!c)p[d]=v;else{let R=_.nodata;if(R===void 0){let F;_.bands?F=_.bands[w]-1:F=w,R=l[y][F]}const C=isNaN(R);(!C&&S!==R||C&&!isNaN(S))&&(m=!1,p[d]=v)}d++}if(!m){const w=s+y,S=t[w];S&&!S[0][g]&&(m=!0)}}c&&(m||(p[d]=255),d++)}return p}};Am.prototype.getView;class ke{constructor(e){this.name=e}toString(){return this.name}}ke.GeoTIFF=new ke("GeoTIFF");ke.ImageStatic=new ke("ImageStatic");ke.PMTilesRaster=new ke("PMTilesRaster");ke.PMTilesVector=new ke("PMTilesVector");ke.TileJSON=new ke("TileJSON");ke.TileWMS=new ke("TileWMS");ke.WMTS=new ke("WMTS");ke.XYZ=new ke("XYZ");class Uc extends hp{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||fP,this.collectionStyle_=e.collectionStyle||Gf,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(r=>this.configure_(r,e.url,e.children,e.assets,e.bands)).catch(r=>this.handleError_(r))}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return t==="json"?await r.json():t==="text"?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const r=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!r||Fu(r)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new US(e))}configure_(e,t=null,r=null,i=null,s=[]){let o;e instanceof ks||e instanceof Ni?o=e:(o=zs(e,!this.disableMigration_),t&&t.includes("://")&&o.setAbsoluteUrl(t)),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Bf(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=c=>this.handleError_(c),u=[];r&&u.push(this.setChildren(r,null,!1).catch(l)),i&&u.push(this.setAssets(i,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new Uc(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(r)}async addPreviewImage_(e){const t=await Uf(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(r.length!==1)return;const i=r[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:Rn(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(ke.ImageStatic,s,e));const o=new dc({source:new Z1(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=gP(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new us(r.url).getHeader();let l;switch(a.tileType){case Kn.Mvt:l=new GS(await i(ke.PMTilesVector,r));break;case Kn.Avif:case Kn.Jpeg:case Kn.Png:case Kn.Webp:l=new Ff(await i(ke.PMTilesRaster,r));break;default:return}s.push(l);break;case"tilejson":s.push(new gc(await i(ke.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const h in e["wms:layers"]){const f=e["wms:layers"][h]||"";let p="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][h]=="string"&&(p=e["wms:styles"][h]);const d=Object.assign({LAYERS:f,STYLES:p},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(d.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(d.FORMAT=e.type);const g=await i(ke.TileWMS,Object.assign({},r,{params:d}));s.push(new q1(g))}break;case"wmts":const u=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!u)return;let c=[];Array.isArray(e["wmts:layer"])?c=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(c=[e["wmts:layer"]]);for(const h of c){let f=Object.assign({},r,{layer:h,requestEncoding:e["wmts:encoding"]==="rest"?"REST":"KVP"});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await i(ke.WMTS,f);const p=K1(u,f);if(p!==null){if(typeof e.uriTemplate=="string"){let d=e.uriTemplate;const g=ja(e.variables)?e.variables:{};for(const m in g){const y=g[m];let _;if(kf(y.const)?_=y.const:kf(y.default)?_=y.default:Array.isArray(y.enum)&&y.enum.length>0&&(_=y.enum[0]),typeof _<"u")d=d.replaceAll(`{${m}}`,String(_));else continue}delete p.urls,p.url=d}s.push(new Y1(p))}}break;case"xyz":s.push(new Uh(await i(ke.XYZ,r)));break;default:return}return s.map(o=>{let a;return o instanceof Cs?a=new si({source:o,declutter:!0}):o instanceof Ff?a=new Bh({source:o}):a=new Io({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let r={sources:[dP(e,this.bands_)],convertToRGB:"auto",loadMissingProjection:!0};const i=await Uf();i&&(r.projection=i),this.getSourceOptions_&&(r=await this.getSourceOptions_(ke.GeoTIFF,r,e));const s=new Am(r),o=new Promise((a,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):a()})});try{await o;const a=new Bh({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(ke.XYZ,r,e));const i=new Io({source:new Uh(r)});return this.addLayer_(i,e),i}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=dx(t.getBoundingBox()):e=t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,Bf(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const i=new kl,s=new Xi({format:i,loader:(o,a,l)=>{e=px(e);const u=i.readFeatures(e,{featureProjection:l});s.addFeatures(u)}});return t||(t=Gf),new Jo({source:s,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof To))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),r;t.length>1&&(r=t.find(s=>s.roles.includes("labels-vector"))),r||(r=e.getAsset("vector_labels")),r||(t=e.getAssets().filter(s=>s.type===zh&&!s.roles),t.length===1&&(r=t[0]));const i=e.getLinksWithRels(["source"]);if(r&&i.length>0){const s=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return zs(l)}catch(l){return this.handleError_(l),null}}),o=(await Promise.all(s)).filter(a=>a instanceof Ni);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(r)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const o=t.item(s);o.get("stac")&&!o.get("bounds")&&t.removeAt(s)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async o=>await this.addLayerForLink(o));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const s=i.map(async o=>{if(o){if(o.type===zh)return await this.addGeoJson_(o);if(o.isGeoTIFF())return await this.addGeoTiff_(o);if(o.canBrowserDisplayImage())return await this.addPreviewImage_(o)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(r instanceof Bu)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof Ni){if(r.isItem()&&r.supportsExtension(hP)&&r.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const o=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(o&&this.displayOverview_&&(a=await this.addGeoTiff_(o)),this.displayPreview_&&(!o||!a)){const l=r.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(r=>r!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof ks)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=r.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):r.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const r=this.getData();this.assets_=e.map(i=>r instanceof Ni&&typeof i=="string"?r.getAsset(i):i instanceof ks?i:new ks(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof Np?this.children_=e.getAll():e instanceof Op?this.children_=e.getAll():ja(e)&&e.type==="FeatureCollection"?this.children_=zs(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof Ni?i:zs(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&ja(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const i=this.getChildren();if(i){const s=i.map(o=>o.getBoundingBox());t=Uu(s)}if(t)return Rn(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const r=t.getMetadata("attribution");r&&r.push(r)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const r=new URL(e);t!=="rest"&&(r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities"));const i=await this.fetch_(r.toString(),"text");return new p1().read(i)}catch{return null}}}var PP=8,AP={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},IP={"*":{type:"source"}},CP=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],LP={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},FP={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},MP={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},OP={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},NP={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},DP={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},GP={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},UP=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],BP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},kP={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},zP={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$P={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jP={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},VP={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},XP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ZP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},WP={type:"array",value:"*"},HP={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},qP={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},YP={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},KP={type:"array",value:"*",minimum:1},JP={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},QP={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},eA={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},tA={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},rA=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],nA={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},iA={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},sA={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},oA={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},aA={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},lA={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},uA={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},cA={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},hA={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},fA={"*":{type:"string"}},dA={$version:PP,$root:AP,sources:IP,source:CP,source_vector:LP,source_raster:FP,source_raster_dem:MP,source_geojson:OP,source_video:NP,source_image:DP,layer:GP,layout:UP,layout_background:BP,layout_fill:kP,layout_circle:zP,layout_heatmap:$P,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:jP,layout_symbol:VP,layout_raster:XP,layout_hillshade:ZP,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:WP,filter_operator:HP,geometry_type:qP,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:YP,expression:KP,light:JP,sky:QP,terrain:eA,projection:tA,paint:rA,paint_fill:nA,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:iA,paint_circle:sA,paint_heatmap:oA,paint_symbol:aA,paint_raster:lA,paint_hillshade:uA,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:cA,transition:hA,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:fA};const pA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function gA(n,e){const t={};for(const r in n)r!=="ref"&&(t[r]=n[r]);return pA.forEach(r=>{r in e&&(t[r]=e[r])}),t}function Im(n){n=n.slice();const e=Object.create(null);for(let t=0;t<n.length;t++)e[n[t].id]=n[t];for(let t=0;t<n.length;t++)"ref"in n[t]&&(n[t]=gA(n[t],e[n[t].ref]));return n}class br extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Bc{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,i]of t)this.bindings[r]=i}concat(e){return new Bc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const pa={kind:"null"},k={kind:"number"},ae={kind:"string"},se={kind:"boolean"},Tr={kind:"color"},ga={kind:"projectionDefinition"},Pn={kind:"object"},re={kind:"value"},mA={kind:"error"},ma={kind:"collator"},ya={kind:"formatted"},_a={kind:"padding"},hs={kind:"colorArray"},xa={kind:"numberArray"},Ms={kind:"resolvedImage"},ba={kind:"variableAnchorOffsetCollection"};function zt(n,e){return{kind:"array",itemType:n,N:e}}function Xe(n){if(n.kind==="array"){const e=Xe(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const yA=[pa,k,ae,se,Tr,ga,ya,Pn,zt(re),_a,xa,hs,Ms,ba];function fs(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fs(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of yA)if(!fs(t,e))return null}}return`Expected ${Xe(n)} but found ${Xe(e)} instead.`}function kc(n,e){return e.some(t=>t.kind===n.kind)}function An(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}function Wr(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const Cm=.96422,Lm=1,Fm=.82521,Mm=4/29,ai=6/29,Om=3*ai*ai,_A=ai*ai*ai,xA=Math.PI/180,bA=180/Math.PI;function Nm(n){return n=n%360,n<0&&(n+=360),n}function Dm([n,e,t,r]){n=il(n),e=il(e),t=il(t);let i,s;const o=sl((.2225045*n+.7168786*e+.0606169*t)/Lm);n===e&&e===t?i=s=o:(i=sl((.4360747*n+.3850649*e+.1430804*t)/Cm),s=sl((.0139322*n+.0971045*e+.7141733*t)/Fm));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),r]}function il(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function sl(n){return n>_A?Math.pow(n,1/3):n/Om+Mm}function Gm([n,e,t,r]){let i=(n+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=Lm*al(i),s=Cm*al(s),o=Fm*al(o),[ol(3.1338561*s-1.6168667*i-.4906146*o),ol(-.9787684*s+1.9161415*i+.033454*o),ol(.0719453*s-.2289914*i+1.4052427*o),r]}function ol(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function al(n){return n>ai?n*n*n:Om*(n-Mm)}function EA(n){const[e,t,r,i]=Dm(n),s=Math.sqrt(t*t+r*r);return[Math.round(s*1e4)?Nm(Math.atan2(r,t)*bA):NaN,s,e,i]}function TA([n,e,t,r]){return n=isNaN(n)?0:n*xA,Gm([t,Math.cos(n)*e,Math.sin(n)*e,r])}function wA([n,e,t,r]){n=Nm(n),e/=100,t/=100;function i(s){const o=(s+n/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),r]}const vA=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function Um(n,e){return vA(n,e)?n[e]:void 0}function SA(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const e=Um(RA,n);if(e){const[i,s,o]=e;return[i/255,s/255,o/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const s=n.length<6?1:2;let o=1;return[qs(n.slice(o,o+=s)),qs(n.slice(o,o+=s)),qs(n.slice(o,o+=s)),qs(n.slice(o,o+s)||"ff")]}if(n.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=n.match(i);if(s){const[o,a,l,u,c,h,f,p,d,g,m,y]=s,_=[u||" ",f||" ",g].join("");if(_==="  "||_==="  /"||_===",,"||_===",,,"){const x=[l,h,d].join(""),T=x==="%%%"?100:x===""?255:0;if(T){const b=[Jn(+a/T,0,1),Jn(+c/T,0,1),Jn(+p/T,0,1),m?Vf(+m,y):1];if(Xf(b))return b}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=n.match(t);if(r){const[i,s,o,a,l,u,c,h,f]=r,p=[o||" ",l||" ",c].join("");if(p==="  "||p==="  /"||p===",,"||p===",,,"){const d=[+s,Jn(+a,0,100),Jn(+u,0,100),h?Vf(+h,f):1];if(Xf(d))return wA(d)}}}function qs(n){return parseInt(n.padEnd(2,n),16)/255}function Vf(n,e){return Jn(e?n/100:n,0,1)}function Jn(n,e,t){return Math.min(Math.max(e,n),t)}function Xf(n){return!n.some(Number.isNaN)}const RA={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function In(n,e,t){return n+t*(e-n)}function ds(n,e,t){return n.map((r,i)=>In(r,e[i],t))}class Le{constructor(e,t,r,i=1,s=!0){this.r=e,this.g=t,this.b=r,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,r,i]))}static parse(e){if(e instanceof Le)return e;if(typeof e!="string")return;const t=SA(e);if(t)return new Le(...t,!1)}get rgb(){const{r:e,g:t,b:r,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,r/s,i])}get hcl(){return this.overwriteGetter("hcl",EA(this.rgb))}get lab(){return this.overwriteGetter("lab",Dm(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,i]=this.rgb;return`rgba(${[e,t,r].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(e,t,r,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=ds(e.rgb,t.rgb,r);return new Le(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=e.hcl,[u,c,h,f]=t.hcl;let p,d;if(!isNaN(s)&&!isNaN(u)){let x=u-s;u>s&&x>180?x-=360:u<s&&s-u>180&&(x+=360),p=s+r*x}else isNaN(s)?isNaN(u)?p=NaN:(p=u,(a===1||a===0)&&(d=c)):(p=s,(h===1||h===0)&&(d=o));const[g,m,y,_]=TA([p,d??In(o,c,r),In(a,h,r),In(l,f,r)]);return new Le(g,m,y,_,!1)}case"lab":{const[s,o,a,l]=Gm(ds(e.lab,t.lab,r));return new Le(s,o,a,l,!1)}}}}Le.black=new Le(0,0,0,1);Le.white=new Le(1,1,1,1);Le.transparent=new Le(0,0,0,0);Le.red=new Le(1,0,0,1);class zc{constructor(e,t,r){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const PA=["bottom","center","top"];class Jl{constructor(e,t,r,i,s,o){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=s,this.verticalAlign=o}}class Gr{constructor(e){this.sections=e}static fromString(e){return new Gr([new Jl(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Gr?e:Gr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ar{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ar)return e;if(typeof e=="number")return new ar([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ar(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new ar(ds(e.values,t.values,r))}}class lr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof lr)return e;if(typeof e=="number")return new lr([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new lr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new lr(ds(e.values,t.values,r))}}class $t{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $t)return e;if(typeof e=="string"){const r=Le.parse(e);return r?new $t([r]):void 0}if(!Array.isArray(e))return;const t=[];for(const r of e){if(typeof r!="string")return;const i=Le.parse(r);if(!i)return;t.push(i)}return new $t(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r,i="rgb"){const s=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)s.push(Le.interpolate(e.values[o],t.values[o],r,i));return new $t(s)}}class He extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const AA=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class wr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof wr)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const r=e[t],i=e[t+1];if(typeof r!="string"||!AA.has(r)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new wr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){const i=e.values,s=t.values;if(i.length!==s.length)throw new He(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new He(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,u]=i[a+1],[c,h]=s[a+1];o.push([In(l,c,r),In(u,h,r)])}return new wr(o)}}class dn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new dn({name:e,available:!1}):null}}class ir{constructor(e,t,r){this.from=e,this.to=t,this.transition=r}static interpolate(e,t,r){return new ir(e,t,r)}static parse(e){if(e instanceof ir)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new ir(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new ir(e.from,e.to,e.transition);if(typeof e=="string")return new ir(e,e,1)}}function Bm(n,e,t,r){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[n,e,t,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[n,e,t,r]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ps(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ir||n instanceof Le||n instanceof zc||n instanceof Gr||n instanceof ar||n instanceof lr||n instanceof $t||n instanceof wr||n instanceof dn)return!0;if(Array.isArray(n)){for(const e of n)if(!ps(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!ps(n[e]))return!1;return!0}else return!1}function tt(n){if(n===null)return pa;if(typeof n=="string")return ae;if(typeof n=="boolean")return se;if(typeof n=="number")return k;if(n instanceof Le)return Tr;if(n instanceof ir)return ga;if(n instanceof zc)return ma;if(n instanceof Gr)return ya;if(n instanceof ar)return _a;if(n instanceof lr)return xa;if(n instanceof $t)return hs;if(n instanceof wr)return ba;if(n instanceof dn)return Ms;if(Array.isArray(n)){const e=n.length;let t;for(const r of n){const i=tt(r);if(!t)t=i;else{if(t===i)continue;t=re;break}}return zt(t||re,e)}else return Pn}function qi(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Le||n instanceof ir||n instanceof Gr||n instanceof ar||n instanceof lr||n instanceof $t||n instanceof wr||n instanceof dn?n.toString():JSON.stringify(n)}class gi{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ps(e[1]))return t.error("invalid value");const r=e[1];let i=tt(r);const s=t.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new gi(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ys={string:ae,number:k,boolean:se,object:Pn};class sr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=1,i;const s=e[0];if(s==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in Ys)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=Ys[u],r++}else a=re;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],r++}i=zt(a,l)}else{if(!Ys[s])throw new Error(`Types doesn't contain name = ${s}`);i=Ys[s]}const o=[];for(;r<e.length;r++){const a=t.parse(e[r],r,re);if(!a)return null;o.push(a)}return new sr(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(fs(this.type,tt(r))){if(t===this.args.length-1)throw new He(`Expected value to be of type ${Xe(this.type)}, but found ${Xe(tt(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Zf={"to-boolean":se,"to-color":Tr,"to-number":k,"to-string":ae};class tn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(!Zf[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Zf[r],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,re);if(!a)return null;s.push(a)}return new tn(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,r;for(const i of this.args){if(t=i.evaluate(e),r=null,t instanceof Le)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?r=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:r=Bm(t[0],t[1],t[2],t[3]),!r))return new Le(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new He(r||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const r of this.args){t=r.evaluate(e);const i=ar.parse(t);if(i)return i}throw new He(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=lr.parse(t);if(i)return i}throw new He(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=$t.parse(t);if(i)return i}throw new He(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const r of this.args){t=r.evaluate(e);const i=wr.parse(t);if(i)return i}throw new He(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const r of this.args){if(t=r.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new He(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Gr.fromString(qi(this.args[0].evaluate(e)));case"resolvedImage":return dn.fromString(qi(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return qi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const IA=["Unknown","Point","LineString","Polygon"];class km{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?IA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Le.parse(e),this._parseColorCache.set(e,t)),t}}class Ea{constructor(e,t,r=[],i,s=new Bc,o=[]){this.registry=e,this.path=r,this.key=r.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,r,i,s={}){return t?this.concat(t,r,i)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(i,s,o){return o==="assert"?new sr(s,[i]):o==="coerce"?new tn(s,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=r(o,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=r(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof gi)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new km;try{o=new gi(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const i=typeof e=="number"?this.path.concat(e):this.path,s=r?this.scope.concat(r):this.scope;return new Ea(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const r=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new br(r,e))}checkSubtype(e,t){const r=fs(e,t);return r&&this.error(r),r}}class Ta{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;r.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return i?new Ta(r,i):null}outputDefined(){return this.result.outputDefined()}}class wa{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new wa(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class $c{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,k),i=t.parse(e[2],2,zt(t.expectedType||re));if(!r||!i)return null;const s=i.type;return new $c(s.itemType,r,i)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new He(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new He(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new He(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class jc{constructor(e,t){this.type=se,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,re),i=t.parse(e[2],2,re);return!r||!i?null:kc(r.type,[se,ae,k,pa,re])?new jc(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(r.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!An(t,["boolean","string","number","null"]))throw new He(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(tt(t))} instead.`);if(!An(r,["string","array"]))throw new He(`Expected second argument to be of type array or string, but found ${Xe(tt(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Lo{constructor(e,t,r){this.type=k,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,re),i=t.parse(e[2],2,re);if(!r||!i)return null;if(!kc(r.type,[se,ae,k,pa,re]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,k);return s?new Lo(r,i,s):null}else return new Lo(r,i)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!An(t,["boolean","string","number","null"]))throw new He(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(tt(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),An(r,["string"])){const s=r.indexOf(t,i);return s===-1?-1:[...r.slice(0,s)].length}else{if(An(r,["array"]))return r.indexOf(t,i);throw new He(`Expected second argument to be of type array or string, but found ${Xe(tt(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Vc{constructor(e,t,r,i,s,o){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let r,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const h=e[u+1];Array.isArray(c)||(c=[c]);const f=t.concat(u);if(c.length===0)return f.error("Expected at least one branch label.");for(const d of c){if(typeof d!="number"&&typeof d!="string")return f.error("Branch labels must be numbers or strings.");if(typeof d=="number"&&Math.abs(d)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof d=="number"&&Math.floor(d)!==d)return f.error("Numeric branch labels must be integer values.");if(!r)r=tt(d);else if(f.checkSubtype(r,tt(d)))return null;if(typeof s[String(d)]<"u")return f.error("Branch labels must be unique.");s[String(d)]=o.length}const p=t.parse(h,u,i);if(!p)return null;i=i||p.type,o.push(p)}const a=t.parse(e[1],1,re);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(r,a.type)?null:new Vc(r,i,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(tt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Xc{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,se);if(!a)return null;const l=t.parse(e[o+1],o+1,r);if(!l)return null;i.push([a,l]),r=r||l.type}const s=t.parse(e[e.length-1],e.length-1,r);if(!s)return null;if(!r)throw new Error("Can't infer output type");return new Xc(r,i,s)}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class Fo{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,re),i=t.parse(e[2],2,k);if(!r||!i)return null;if(!kc(r.type,[zt(re),ae,re]))return t.error(`Expected first argument to be of type array or string, but found ${Xe(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,k);return s?new Fo(r.type,r,i,s):null}else return new Fo(r.type,r,i)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),An(t,["string"]))return[...t].slice(r,i).join("");if(An(t,["array"]))return t.slice(r,i);throw new He(`Expected first argument to be of type array or string, but found ${Xe(tt(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function zm(n,e){const t=n.length-1;let r=0,i=t,s=0,o,a;for(;r<=i;)if(s=Math.floor((r+i)/2),o=n[s],a=n[s+1],o<=e){if(s===t||e<a)return s;r=s+1}else if(o>e)i=s-1;else throw new He("Input is not a number.");return 0}class va{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of r)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,k);if(!r)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const h=t.parse(l,c,s);if(!h)return null;s=s||h.type,i.push([a,h])}return new va(s,r,i)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=zm(t,i);return r[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function CA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ll,Wf;function LA(){if(Wf)return ll;Wf=1,ll=n;function n(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var s=this.sampleCurveX(r)-e;if(Math.abs(s)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r=r-s/o}var a=0,l=1;for(r=e,i=0;i<20&&(s=this.sampleCurveX(r),!(Math.abs(s-e)<t));i++)e>s?a=r:l=r,r=(l-a)*.5+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ll}var FA=LA(),MA=CA(FA);class vr{constructor(e,t,r,i,s){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,r,i){let s=0;if(e.name==="exponential")s=ul(t,e.base,r,i);else if(e.name==="linear")s=ul(t,1,r,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new MA(o[0],o[1],o[2],o[3]).solve(ul(t,1,r,i))}return s}static parse(e,t){let[r,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,k),!s)return null;const a=[];let l=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&t.expectedType!=hs?l=Tr:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],h=o[u+1],f=u+3,p=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const d=t.parse(h,p,l);if(!d)return null;l=l||d.type,a.push([c,d])}return!Wr(l,k)&&!Wr(l,ga)&&!Wr(l,Tr)&&!Wr(l,_a)&&!Wr(l,xa)&&!Wr(l,hs)&&!Wr(l,ba)&&!Wr(l,zt(k))?t.error(`Type ${Xe(l)} is not interpolatable.`):new vr(l,r,i,s,a)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=zm(t,i),a=t[o],l=t[o+1],u=vr.interpolationFactor(this.interpolation,i,a,l),c=r[o].evaluate(e),h=r[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return In(c,h,u);case"color":return Le.interpolate(c,h,u);case"padding":return ar.interpolate(c,h,u);case"colorArray":return $t.interpolate(c,h,u);case"numberArray":return lr.interpolate(c,h,u);case"variableAnchorOffsetCollection":return wr.interpolate(c,h,u);case"array":return ds(c,h,u);case"projectionDefinition":return ir.interpolate(c,h,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return Le.interpolate(c,h,u,"hcl");case"colorArray":return $t.interpolate(c,h,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Le.interpolate(c,h,u,"lab");case"colorArray":return $t.interpolate(c,h,u,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ul(n,e,t,r){const i=r-t,s=n-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class gs{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=null;const i=t.expectedType;i&&i.kind!=="value"&&(r=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,s.push(l)}if(!r)throw new Error("No output type");return i&&s.some(a=>fs(i,a.type))?new gs(re,s):new gs(r,s)}evaluate(e){let t=null,r=0,i;for(const s of this.args)if(r++,t=s.evaluate(e),t&&t instanceof dn&&!t.available&&(i||(i=t.name),t=null,r===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Hf(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function OA(n,e,t){return e===t}function NA(n,e,t){return e!==t}function DA(n,e,t){return e<t}function GA(n,e,t){return e>t}function UA(n,e,t){return e<=t}function BA(n,e,t){return e>=t}function $m(n,e,t,r){return r.compare(e,t)===0}function kA(n,e,t,r){return!$m(n,e,t,r)}function zA(n,e,t,r){return r.compare(e,t)<0}function $A(n,e,t,r){return r.compare(e,t)>0}function jA(n,e,t,r){return r.compare(e,t)<=0}function VA(n,e,t,r){return r.compare(e,t)>=0}function Ci(n,e,t){const r=n!=="=="&&n!=="!=";return class jm{constructor(s,o,a){this.type=se,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,re);if(!l)return null;if(!Hf(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${Xe(l.type)}'.`);let u=o.parse(s[2],2,re);if(!u)return null;if(!Hf(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${Xe(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${Xe(l.type)}' and '${Xe(u.type)}'.`);r&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new sr(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new sr(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,ma),!c)return null}return new jm(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const l=tt(o),u=tt(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new He(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=tt(o),u=tt(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const XA=Ci("==",OA,$m),ZA=Ci("!=",NA,kA),WA=Ci("<",DA,zA),HA=Ci(">",GA,$A),qA=Ci("<=",UA,jA),YA=Ci(">=",BA,VA);class Sa{constructor(e,t,r){this.type=ma,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");const i=t.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,se);if(!i)return null;const s=t.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,se);if(!s)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,ae),!o)?null:new Sa(i,s,o)}evaluate(e){return new zc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Zc{constructor(e,t,r,i,s){this.type=ae,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const r=t.parse(e[1],1,k);if(!r)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,ae),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,ae),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,k),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,k),!l)?null:new Zc(r,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Wc{constructor(e){this.type=ya,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,k),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,zt(ae)),!u))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,Tr),!c))return null;let h=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!PA.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(h=t.parse(a["vertical-align"],1,ae),!h)return null}const f=i[i.length-1];f.scale=l,f.font=u,f.textColor=c,f.verticalAlign=h}else{const l=t.parse(e[o],1,re);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Wc(i)}evaluate(e){const t=r=>{const i=r.content.evaluate(e);return tt(i)===Ms?new Jl("",i,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new Jl(qi(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)};return new Gr(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class Hc{constructor(e){this.type=Ms,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const r=t.parse(e[1],1,ae);return r?new Hc(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=dn.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class qc{constructor(e){this.type=k,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Xe(r.type)} instead.`):new qc(r):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new He(`Expected value to be of type string or array, but found ${Xe(tt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Sr=8192;function KA(n,e){const t=JA(n[0]),r=eI(n[1]),i=Math.pow(2,e.z);return[Math.round(t*i*Sr),Math.round(r*i*Sr)]}function Yc(n,e){const t=Math.pow(2,e.z),r=(n[0]/Sr+e.x)/t,i=(n[1]/Sr+e.y)/t;return[QA(r),tI(i)]}function JA(n){return(180+n)/360}function QA(n){return n*360-180}function eI(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function tI(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function Os(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ms(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function rI(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function nI(n,e,t){const r=n[0]-e[0],i=n[1]-e[1],s=n[0]-t[0],o=n[1]-t[1];return r*o-s*i===0&&r*s<=0&&i*o<=0}function Ra(n,e,t,r){const i=[e[0]-n[0],e[1]-n[1]],s=[r[0]-t[0],r[1]-t[1]];return aI(s,i)===0?!1:!!(qf(n,e,t,r)&&qf(t,r,n,e))}function iI(n,e,t){for(const r of t)for(let i=0;i<r.length-1;++i)if(Ra(n,e,r[i],r[i+1]))return!0;return!1}function Li(n,e,t=!1){let r=!1;for(const i of e)for(let s=0;s<i.length-1;s++){if(nI(n,i[s],i[s+1]))return t;rI(n,i[s],i[s+1])&&(r=!r)}return r}function sI(n,e){for(const t of e)if(Li(n,t))return!0;return!1}function Vm(n,e){for(const t of n)if(!Li(t,e))return!1;for(let t=0;t<n.length-1;++t)if(iI(n[t],n[t+1],e))return!1;return!0}function oI(n,e){for(const t of e)if(Vm(n,t))return!0;return!1}function aI(n,e){return n[0]*e[1]-n[1]*e[0]}function qf(n,e,t,r){const i=n[0]-t[0],s=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=r[0]-t[0],u=r[1]-t[1],c=i*u-l*s,h=o*u-l*a;return c>0&&h<0||c<0&&h>0}function Kc(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=[];for(let o=0;o<n[i].length;o++){const a=KA(n[i][o],t);Os(e,a),s.push(a)}r.push(s)}return r}function Xm(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=Kc(n[i],e,t);r.push(s)}return r}function Zm(n,e,t,r){if(n[0]<t[0]||n[0]>t[2]){const i=r*.5;let s=n[0]-t[0]>i?-r:t[0]-n[0]>i?r:0;s===0&&(s=n[0]-t[2]>i?-r:t[2]-n[0]>i?r:0),n[0]+=s}Os(e,n)}function lI(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function Yf(n,e,t,r){const i=Math.pow(2,r.z)*Sr,s=[r.x*Sr,r.y*Sr],o=[];for(const a of n)for(const l of a){const u=[l.x+s[0],l.y+s[1]];Zm(u,e,t,i),o.push(u)}return o}function Kf(n,e,t,r){const i=Math.pow(2,r.z)*Sr,s=[r.x*Sr,r.y*Sr],o=[];for(const a of n){const l=[];for(const u of a){const c=[u.x+s[0],u.y+s[1]];Os(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=i/2){lI(e);for(const a of o)for(const l of a)Zm(l,e,t,i)}return o}function uI(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=Kc(e.coordinates,r,i),o=Yf(n.geometry(),t,r,i);if(!ms(t,r))return!1;for(const a of o)if(!Li(a,s))return!1}if(e.type==="MultiPolygon"){const s=Xm(e.coordinates,r,i),o=Yf(n.geometry(),t,r,i);if(!ms(t,r))return!1;for(const a of o)if(!sI(a,s))return!1}return!0}function cI(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=Kc(e.coordinates,r,i),o=Kf(n.geometry(),t,r,i);if(!ms(t,r))return!1;for(const a of o)if(!Vm(a,s))return!1}if(e.type==="MultiPolygon"){const s=Xm(e.coordinates,r,i),o=Kf(n.geometry(),t,r,i);if(!ms(t,r))return!1;for(const a of o)if(!oI(a,s))return!1}return!0}class Cn{constructor(e,t){this.type=se,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ps(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const i=[];for(const s of r.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new Cn(r,s)}}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new Cn(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Cn(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return uI(e,this.geometries);if(e.geometryType()==="LineString")return cI(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Wm{constructor(e=[],t=(r,i)=>r<i?-1:r>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(r(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=(e<<1)+1;const a=o+1;if(a<this.length&&r(t[a],t[o])<0&&(o=a),r(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function hI(n,e){if(n.length<=1)return[n];const r=[];let i,s;for(const o of n){const a=fI(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&r.push(i),i=[o]):i.push(o))}return i&&r.push(i),r}function fI(n){let e=0;for(let t=0,r=n.length,i=r-1,s,o;t<r;i=t++)s=n[t],o=n[i],e+=(o.x-s.x)*(s.y+o.y);return e}const dI=6378.137,Jf=1/298.257223563,Qf=Jf*(2-Jf),ed=Math.PI/180;class Jc{constructor(e){const t=ed*dI*1e3,r=Math.cos(e*ed),i=1/(1-Qf*(1-r*r)),s=Math.sqrt(i);this.kx=t*s*r,this.ky=t*s*i*(1-Qf)}distance(e,t){const r=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+i*i)}pointOnLine(e,t){let r=1/0,i,s,o,a;for(let l=0;l<e.length-1;l++){let u=e[l][0],c=e[l][1],h=this.wrap(e[l+1][0]-u)*this.kx,f=(e[l+1][1]-c)*this.ky,p=0;(h!==0||f!==0)&&(p=(this.wrap(t[0]-u)*this.kx*h+(t[1]-c)*this.ky*f)/(h*h+f*f),p>1?(u=e[l+1][0],c=e[l+1][1]):p>0&&(u+=h/this.kx*p,c+=f/this.ky*p)),h=this.wrap(t[0]-u)*this.kx,f=(t[1]-c)*this.ky;const d=h*h+f*f;d<r&&(r=d,i=u,s=c,o=l,a=p)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Ql=100,eu=50;function Hm(n,e){return e[0]-n[0]}function Mo(n){return n[1]-n[0]+1}function kr(n,e){return n[1]>=n[0]&&n[1]<e}function tu(n,e){if(n[0]>n[1])return[null,null];const t=Mo(n);if(e){if(t===2)return[n,null];const i=Math.floor(t/2);return[[n[0],n[0]+i],[n[0]+i,n[1]]]}if(t===1)return[n,null];const r=Math.floor(t/2)-1;return[[n[0],n[0]+r],[n[0]+r+1,n[1]]]}function ru(n,e){if(!kr(e,n.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)Os(t,n[r]);return t}function nu(n){const e=[1/0,1/0,-1/0,-1/0];for(const t of n)for(const r of t)Os(e,r);return e}function td(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Qc(n,e,t){if(!td(n)||!td(e))return NaN;let r=0,i=0;return n[2]<e[0]&&(r=e[0]-n[2]),n[0]>e[2]&&(r=n[0]-e[2]),n[1]>e[3]&&(i=n[1]-e[3]),n[3]<e[1]&&(i=e[1]-n[3]),t.distance([0,0],[r,i])}function vn(n,e,t){const r=t.pointOnLine(e,n);return t.distance(n,r.point)}function eh(n,e,t,r,i){const s=Math.min(vn(n,[t,r],i),vn(e,[t,r],i)),o=Math.min(vn(t,[n,e],i),vn(r,[n,e],i));return Math.min(s,o)}function pI(n,e,t,r,i){if(!(kr(e,n.length)&&kr(r,t.length)))return 1/0;let o=1/0;for(let a=e[0];a<e[1];++a){const l=n[a],u=n[a+1];for(let c=r[0];c<r[1];++c){const h=t[c],f=t[c+1];if(Ra(l,u,h,f))return 0;o=Math.min(o,eh(l,u,h,f,i))}}return o}function gI(n,e,t,r,i){if(!(kr(e,n.length)&&kr(r,t.length)))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let l=r[0];l<=r[1];++l)if(o=Math.min(o,i.distance(n[a],t[l])),o===0)return o;return o}function mI(n,e,t){if(Li(n,e,!0))return 0;let r=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(r=Math.min(r,vn(n,[o,s],t)),r===0))return r;const a=t.pointOnLine(i,n);if(r=Math.min(r,t.distance(n,a.point)),r===0)return r}return r}function yI(n,e,t,r){if(!kr(e,n.length))return NaN;for(let s=e[0];s<=e[1];++s)if(Li(n[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=n[s],a=n[s+1];for(const l of t)for(let u=0,c=l.length,h=c-1;u<c;h=u++){const f=l[h],p=l[u];if(Ra(o,a,f,p))return 0;i=Math.min(i,eh(o,a,f,p,r))}}return i}function rd(n,e){for(const t of n)for(const r of t)if(Li(r,e,!0))return!0;return!1}function _I(n,e,t,r=1/0){const i=nu(n),s=nu(e);if(r!==1/0&&Qc(i,s,t)>=r)return r;if(ms(i,s)){if(rd(n,e))return 0}else if(rd(e,n))return 0;let o=1/0;for(const a of n)for(let l=0,u=a.length,c=u-1;l<u;c=l++){const h=a[c],f=a[l];for(const p of e)for(let d=0,g=p.length,m=g-1;d<g;m=d++){const y=p[m],_=p[d];if(Ra(h,f,y,_))return 0;o=Math.min(o,eh(h,f,y,_,t))}}return o}function nd(n,e,t,r,i,s){if(!s)return;const o=Qc(ru(r,s),i,t);o<e&&n.push([o,s,[0,0]])}function Ks(n,e,t,r,i,s,o){if(!s||!o)return;const a=Qc(ru(r,s),ru(i,o),t);a<e&&n.push([a,s,o])}function Oo(n,e,t,r,i=1/0){let s=Math.min(r.distance(n[0],t[0][0]),i);if(s===0)return s;const o=new Wm([[0,[0,n.length-1],[0,0]]],Hm),a=nu(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],c=e?eu:Ql;if(Mo(u)<=c){if(!kr(u,n.length))return NaN;if(e){const h=yI(n,u,t,r);if(isNaN(h)||h===0)return h;s=Math.min(s,h)}else for(let h=u[0];h<=u[1];++h){const f=mI(n[h],t,r);if(s=Math.min(s,f),s===0)return 0}}else{const h=tu(u,e);nd(o,s,r,n,a,h[0]),nd(o,s,r,n,a,h[1])}}return s}function No(n,e,t,r,i,s=1/0){let o=Math.min(s,i.distance(n[0],t[0]));if(o===0)return o;const a=new Wm([[0,[0,n.length-1],[0,t.length-1]]],Hm);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=l[2],h=e?eu:Ql,f=r?eu:Ql;if(Mo(u)<=h&&Mo(c)<=f){if(!kr(u,n.length)&&kr(c,t.length))return NaN;let p;if(e&&r)p=pI(n,u,t,c,i),o=Math.min(o,p);else if(e&&!r){const d=n.slice(u[0],u[1]+1);for(let g=c[0];g<=c[1];++g)if(p=vn(t[g],d,i),o=Math.min(o,p),o===0)return o}else if(!e&&r){const d=t.slice(c[0],c[1]+1);for(let g=u[0];g<=u[1];++g)if(p=vn(n[g],d,i),o=Math.min(o,p),o===0)return o}else p=gI(n,u,t,c,i),o=Math.min(o,p)}else{const p=tu(u,e),d=tu(c,r);Ks(a,o,i,n,t,p[0],d[0]),Ks(a,o,i,n,t,p[0],d[1]),Ks(a,o,i,n,t,p[1],d[0]),Ks(a,o,i,n,t,p[1],d[1])}}return o}function xI(n,e){const t=n.geometry(),r=t.flat().map(o=>Yc([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Jc(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,No(r,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,No(r,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Oo(r,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function bI(n,e){const t=n.geometry(),r=t.flat().map(o=>Yc([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Jc(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,No(r,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,No(r,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Oo(r,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function EI(n,e){const t=n.geometry();if(t.length===0||t[0].length===0)return NaN;const r=hI(t).map(o=>o.map(a=>a.map(l=>Yc([l.x,l.y],n.canonical)))),i=new Jc(r[0][0][0][1]);let s=1/0;for(const o of e)for(const a of r){switch(o.type){case"Point":s=Math.min(s,Oo([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,Oo(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,_I(a,o.coordinates,i,s));break}if(s===0)return s}return s}function cl(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Ln{constructor(e,t){this.type=k,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ps(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new Ln(r,r.features.map(i=>cl(i.geometry)).flat());if(r.type==="Feature")return new Ln(r,cl(r.geometry));if("type"in r&&"coordinates"in r)return new Ln(r,cl(r))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return xI(e,this.geometries);if(e.geometryType()==="LineString")return bI(e,this.geometries);if(e.geometryType()==="Polygon")return EI(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ns{constructor(e){this.type=re,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=e[1];return r==null?t.error("Global state property must be defined."):typeof r!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ns(r)}evaluate(e){var t;const r=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!r||Object.keys(r).length===0?null:Um(r,this.key)}eachChild(){}outputDefined(){return!1}}const Pa={"==":XA,"!=":ZA,">":HA,"<":WA,">=":YA,"<=":qA,array:sr,at:$c,boolean:sr,case:Xc,coalesce:gs,collator:Sa,format:Wc,image:Hc,in:jc,"index-of":Lo,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:qc,let:Ta,literal:gi,match:Vc,number:sr,"number-format":Zc,object:sr,slice:Fo,step:va,string:sr,"to-boolean":tn,"to-color":tn,"to-number":tn,"to-string":tn,var:wa,within:Cn,distance:Ln,"global-state":Ns};class jt{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const r=e[0],i=jt.definitions[r];if(!i)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of a){l=new Ea(t.registry,Do,t.path,null,t.scope);const h=[];let f=!1;for(let p=1;p<e.length;p++){const d=e[p],g=Array.isArray(u)?u[p-1]:u.type,m=l.parse(d,1+h.length,g);if(!m){f=!0;break}h.push(m)}if(!f){if(Array.isArray(u)&&u.length!==h.length){l.error(`Expected ${u.length} arguments, but found ${h.length} instead.`);continue}for(let p=0;p<h.length;p++){const d=Array.isArray(u)?u[p]:u.type,g=h[p];l.concat(p+1).checkSubtype(d,g.type)}if(l.errors.length===0)return new jt(r,s,c,h)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([f])=>wI(f)).join(" | "),h=[];for(let f=1;f<e.length;f++){const p=t.parse(e[f],1+h.length);if(!p)return null;h.push(Xe(p.type))}t.error(`Expected arguments of type ${c}, but found (${h.join(", ")}) instead.`)}return null}static register(e,t){jt.definitions=t;for(const r in t)e[r]=jt}}function id(n,[e,t,r,i]){e=e.evaluate(n),t=t.evaluate(n),r=r.evaluate(n);const s=i?i.evaluate(n):1,o=Bm(e,t,r,s);if(o)throw new He(o);return new Le(e/255,t/255,r/255,s,!1)}function sd(n,e){return n in e}function hl(n,e){const t=e[n];return typeof t>"u"?null:t}function TI(n,e,t,r){for(;t<=r;){const i=t+r>>1;if(e[i]===n)return!0;e[i]>n?r=i-1:t=i+1}return!1}function mn(n){return{type:n}}jt.register(Pa,{error:[mA,[ae],(n,[e])=>{throw new He(e.evaluate(n))}],typeof:[ae,[re],(n,[e])=>Xe(tt(e.evaluate(n)))],"to-rgba":[zt(k,4),[Tr],(n,[e])=>{const[t,r,i,s]=e.evaluate(n).rgb;return[t*255,r*255,i*255,s]}],rgb:[Tr,[k,k,k],id],rgba:[Tr,[k,k,k,k],id],has:{type:se,overloads:[[[ae],(n,[e])=>sd(e.evaluate(n),n.properties())],[[ae,Pn],(n,[e,t])=>sd(e.evaluate(n),t.evaluate(n))]]},get:{type:re,overloads:[[[ae],(n,[e])=>hl(e.evaluate(n),n.properties())],[[ae,Pn],(n,[e,t])=>hl(e.evaluate(n),t.evaluate(n))]]},"feature-state":[re,[ae],(n,[e])=>hl(e.evaluate(n),n.featureState||{})],properties:[Pn,[],n=>n.properties()],"geometry-type":[ae,[],n=>n.geometryType()],id:[re,[],n=>n.id()],zoom:[k,[],n=>n.globals.zoom],"heatmap-density":[k,[],n=>n.globals.heatmapDensity||0],elevation:[k,[],n=>n.globals.elevation||0],"line-progress":[k,[],n=>n.globals.lineProgress||0],accumulated:[re,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[k,mn(k),(n,e)=>{let t=0;for(const r of e)t+=r.evaluate(n);return t}],"*":[k,mn(k),(n,e)=>{let t=1;for(const r of e)t*=r.evaluate(n);return t}],"-":{type:k,overloads:[[[k,k],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[k],(n,[e])=>-e.evaluate(n)]]},"/":[k,[k,k],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[k,[k,k],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[k,[],()=>Math.LN2],pi:[k,[],()=>Math.PI],e:[k,[],()=>Math.E],"^":[k,[k,k],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[k,[k],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[k,[k],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[k,[k],(n,[e])=>Math.log(e.evaluate(n))],log2:[k,[k],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[k,[k],(n,[e])=>Math.sin(e.evaluate(n))],cos:[k,[k],(n,[e])=>Math.cos(e.evaluate(n))],tan:[k,[k],(n,[e])=>Math.tan(e.evaluate(n))],asin:[k,[k],(n,[e])=>Math.asin(e.evaluate(n))],acos:[k,[k],(n,[e])=>Math.acos(e.evaluate(n))],atan:[k,[k],(n,[e])=>Math.atan(e.evaluate(n))],min:[k,mn(k),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[k,mn(k),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[k,[k],(n,[e])=>Math.abs(e.evaluate(n))],round:[k,[k],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[k,[k],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[k,[k],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[se,[ae,re],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[se,[re],(n,[e])=>n.id()===e.value],"filter-type-==":[se,[ae],(n,[e])=>n.geometryType()===e.value],"filter-<":[se,[ae,re],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<i}],"filter-id-<":[se,[re],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<r}],"filter->":[se,[ae,re],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>i}],"filter-id->":[se,[re],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>r}],"filter-<=":[se,[ae,re],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[se,[re],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<=r}],"filter->=":[se,[ae,re],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[se,[re],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>=r}],"filter-has":[se,[re],(n,[e])=>e.value in n.properties()],"filter-has-id":[se,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[se,[zt(ae)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[se,[zt(re)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[se,[ae,zt(re)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[se,[ae,zt(re)],(n,[e,t])=>TI(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:se,overloads:[[[se,se],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[mn(se),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:se,overloads:[[[se,se],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[mn(se),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[se,[se],(n,[e])=>!e.evaluate(n)],"is-supported-script":[se,[ae],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[ae,[ae],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ae,[ae],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ae,mn(re),(n,e)=>e.map(t=>qi(t.evaluate(n))).join("")],"resolved-locale":[ae,[ma],(n,[e])=>e.evaluate(n).resolvedLocale()]});function wI(n){return Array.isArray(n)?`(${n.map(Xe).join(", ")})`:`(${Xe(n.type)}...)`}function Do(n){if(n instanceof wa)return Do(n.boundExpression);if(n instanceof jt&&n.name==="error")return!1;if(n instanceof Sa)return!1;if(n instanceof Cn)return!1;if(n instanceof Ln)return!1;if(n instanceof Ns)return!1;const e=n instanceof tn||n instanceof sr;let t=!0;return n.eachChild(r=>{e?t=t&&Do(r):t=t&&r instanceof gi}),t?th(n)&&nh(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function th(n){if(n instanceof jt){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof Cn||n instanceof Ln)return!1;let e=!0;return n.eachChild(t=>{e&&!th(t)&&(e=!1)}),e}function rh(n){if(n instanceof jt&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!rh(t)&&(e=!1)}),e}function nh(n,e){if(n instanceof jt&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(r=>{t&&!nh(r,e)&&(t=!1)}),t}function iu(n){return{result:"success",value:n}}function Qn(n){return{result:"error",value:n}}function vI(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function SI(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function RI(n){return!!n.expression&&n.expression.interpolated}function qm(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&tt(n)===Pn}class PI{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new km,this._defaultValue=t?LI(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new He(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function AI(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Pa}function Ym(n,e){const t=new Ea(Pa,Do,[],e?CI(e):void 0),r=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?iu(new PI(r,e)):Qn(t.errors)}class od{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!rh(t.expression),this.globalStateRefs=Aa(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}}class ad{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!rh(t.expression),this.globalStateRefs=Aa(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}interpolationFactor(e,t,r){return this.interpolationType?vr.interpolationFactor(this.interpolationType,e,t,r):0}}function II(n,e){const t=Ym(n,e);if(t.result==="error")return t;const r=t.value.expression,i=th(r);if(!i&&!vI(e))return Qn([new br("","data expressions not supported")]);const s=nh(r,["zoom"]);if(!s&&!SI(e))return Qn([new br("","zoom expressions not supported")]);const o=so(r);if(!o&&!s)return Qn([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof br)return Qn([o]);if(o instanceof vr&&!RI(e))return Qn([new br("",'"interpolate" expressions cannot be used with this property')]);if(!o)return iu(i?new od("constant",t.value):new od("source",t.value));const a=o instanceof vr?o.interpolation:void 0;return iu(i?new ad("camera",t.value,o.labels,a):new ad("composite",t.value,o.labels,a))}function so(n){let e=null;if(n instanceof Ta)e=so(n.result);else if(n instanceof gs){for(const t of n.args)if(e=so(t),e)break}else(n instanceof va||n instanceof vr)&&n.input instanceof jt&&n.input.name==="zoom"&&(e=n);return e instanceof br||n.eachChild(t=>{const r=so(t);r instanceof br?e=r:!e&&r?e=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Aa(n,e=new Set){return n instanceof Ns&&e.add(n.key),n.eachChild(t=>{Aa(t,e)}),e}function CI(n){const e={color:Tr,string:ae,number:k,enum:ae,boolean:se,formatted:ya,padding:_a,numberArray:xa,colorArray:hs,projectionDefinition:ga,resolvedImage:Ms,variableAnchorOffsetCollection:ba};return n.type==="array"?zt(e[n.value]||re,n.length):e[n.type]}function LI(n){if(n.type==="color"&&qm(n.default))return new Le(0,0,0,0);switch(n.type){case"color":return Le.parse(n.default)||null;case"padding":return ar.parse(n.default)||null;case"numberArray":return lr.parse(n.default)||null;case"colorArray":return $t.parse(n.default)||null;case"variableAnchorOffsetCollection":return wr.parse(n.default)||null;case"projectionDefinition":return ir.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function Km(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Km(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const FI={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function MI(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Km(n)||(n=Go(n));const e=Ym(n,FI);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=Jm(n);return{filter:(r,i,s)=>e.value.evaluate(r,i,{},s),needGeometry:t,getGlobalStateRefs:()=>Aa(e.value.expression)}}}function OI(n,e){return n<e?-1:n>e?1:0}function Jm(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Jm(n[e]))return!0;return!1}function Go(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?fl(n[1],n[2],"=="):e==="!="?Js(fl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?fl(n[1],n[2],e):e==="any"?NI(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(Go)):e==="none"?["all"].concat(n.slice(1).map(Go).map(Js)):e==="in"?ld(n[1],n.slice(2)):e==="!in"?Js(ld(n[1],n.slice(2))):e==="has"?ud(n[1]):e==="!has"?Js(ud(n[1])):!0}function fl(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function NI(n){return["any"].concat(n.map(Go))}function ld(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(OI)]]:["filter-in-small",n,["literal",e]]}}function ud(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Js(n){return["!",n]}function ys(n){return typeof n=="object"?["literal",n]:n}function DI(n,e){let t=n.stops;if(!t)return GI(n,e);const r=t&&typeof t[0][0]=="object",i=r||n.property!==void 0,s=r||!i;return t=t.map(o=>!i&&e.tokens&&typeof o[1]=="string"?[o[0],zI(o[1])]:[o[0],ys(o[1])]),r?UI(n,e,t):s?kI(n,e,t):su(n,e,t)}function GI(n,e){const t=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,n.default];{const r=[e.type==="color"?"to-color":e.type,t,ys(n.default)];return e.type==="array"&&r.splice(1,0,e.value,e.length||null),r}}function ih(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function UI(n,e,t){const r={},i={},s=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;r[u]===void 0&&(r[u]={zoom:u,type:n.type,property:n.property,default:n.default},i[u]=[],s.push(u)),i[u].push([l[0].value,l[1]])}if(oh({},e)==="exponential"){const a=[ih(n),["linear"],["zoom"]];for(const l of s){const u=su(r[l],e,i[l]);li(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const u=su(r[l],e,i[l]);li(a,l,u,!0)}return sh(a),a}}function BI(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function cd(n,e){const t=ys(BI(n.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function su(n,e,t){const r=oh(n,e),i=["get",n.property];if(r==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",i,o[0]],o[1]);return s.push(cd(n,e)),s}else if(r==="categorical"){const s=["match",i];for(const o of t)li(s,o[0],o[1],!1);return s.push(cd(n,e)),s}else if(r==="interval"){const s=["step",["number",i]];for(const o of t)li(s,o[0],o[1],!0);return sh(s),n.default===void 0?s:["case",["==",["typeof",i],"number"],s,ys(n.default)]}else if(r==="exponential"){const s=n.base!==void 0?n.base:1,o=[ih(n),s===1?["linear"]:["exponential",s],["number",i]];for(const a of t)li(o,a[0],a[1],!1);return n.default===void 0?o:["case",["==",["typeof",i],"number"],o,ys(n.default)]}else throw new Error(`Unknown property function type ${r}`)}function kI(n,e,t,r=["zoom"]){const i=oh(n,e);let s,o=!1;if(i==="interval")s=["step",r],o=!0;else if(i==="exponential"){const a=n.base!==void 0?n.base:1;s=[ih(n),a===1?["linear"]:["exponential",a],r]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)li(s,a[0],a[1],o);return sh(s),s}function sh(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function li(n,e,t,r){n.length>3&&e===n[n.length-2]||(r&&n.length===2||n.push(e),n.push(t))}function oh(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function zI(n){const e=["concat"],t=/{([^{}]+)}/g;let r=0;for(let i=t.exec(n);i!==null;i=t.exec(n)){const s=n.slice(r,t.lastIndex-i[0].length);r=t.lastIndex,s.length>0&&e.push(s),e.push(["get",i[1]])}if(e.length===1)return n;if(r<n.length)e.push(n.slice(r));else if(e.length===2)return["to-string",e[1]];return e}const $I=dA;var hd={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Gi=" ",fd=/(italic|oblique)$/i,dd={};function ou(n,e,t){var r=dd[n];if(!r){Array.isArray(n)||(n=[n]);for(var i=400,s="normal",o=[],a,l,u=0,c=n.length;u<c;++u){var h=n[u],f=h.split(" "),p=f[f.length-1].toLowerCase();p=="normal"||p=="italic"||p=="oblique"?(s=l?s:p,l=!0,f.pop(),p=f[f.length-1].toLowerCase()):fd.test(p)&&(p=p.replace(fd,""),s=l?s:f[f.length-1].replace(p,""),l=!0);for(var d in hd){var g=f.length>1?f[f.length-2].toLowerCase():"";if(p==d||p==d.replace("-","")||g+"-"+p==d){i=a?i:hd[d],f.pop(),g&&d.startsWith(g)&&f.pop();break}}!a&&typeof p=="number"&&(i=p,a=!0);var m=f.join(Gi).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");m.indexOf(Gi)!==-1&&(m='"'+m+'"'),o.push(m)}r=dd[n]=[s,i,o]}return r[0]+Gi+r[1]+Gi+e+"px"+(t?"/"+t:"")+Gi+r[2]}const Qm="https://api.mapbox.com";function ah(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function jI(n,e,t){if(typeof n=="string")return[{id:"default",url:pd(n,e,t)}];for(const r of n)r.url=pd(r.url,e,t);return n}function pd(n,e,t){const r=ah(n);if(!r)return decodeURI(new URL(n,t).href);const i="sprites/";if(r.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${n}`);const s=r.slice(i.length);return`${Qm}/styles/v1/${s}/sprite?access_token=${e}`}function Uo(n,e){const t=ah(n);if(!t)return decodeURI(new URL(n,location.href).href);const r="styles/";if(t.indexOf(r)!==0)throw new Error(`unexpected style url: ${n}`);const i=t.slice(r.length);return`${Qm}/styles/v1/${i}?&access_token=${e}`}const VI=["a","b","c","d"];function oo(n,e,t,r){const i=new URL(n,r||location.href),s=ah(n);if(!s)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`]}return VI.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const or=Object.freeze({}),gd={},md={};let XI=0;function lh(n){return n.id||(n.id=XI++),n.id}function ZI(n,e){return lh(n)+"."+ct(e)}function ey(n){let e=gd[n.id];return e||(e={},gd[lh(n)]=e),e}function WI(n){let e=md[n.id];return e||(e={},md[lh(n)]=e),e}function dl(n){return n*Math.PI/180}const Rr=function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n}();function Ia(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const t=document.createElement("canvas");return t.width=n,t.height=e,t}function uh(n,e){let t=0;const r=e.length;for(;t<r;++t)if(e[t]<n&&t+1<r){const s=e[t]/e[t+1];return t+Math.log(e[t]/n)/Math.log(s)}return r-1}function ji(n,e){const t=Math.floor(n),r=Math.pow(2,n-t);return e[t]/r}const Wn={};function mi(n,e,t={},r){if(e in Wn)return r&&(r.url=Wn[e][0].url),Wn[e][1];const i=t.transformRequest&&t.transformRequest(e,n)||e,s=function(l){return delete Wn[e],Promise.reject(new Error("Error fetching source "+e))},o=function(l){return delete Wn[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=yo(()=>i).then(l=>l instanceof Response?(r&&(r.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),r&&(r.url=l.url),fetch(l).then(o).catch(s))).catch(s);return Wn[e]=[i,a],a}function ty(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const t=JSON.parse(n);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return n=Uo(n,e.accessToken),mi("Style",n,e);else return Promise.resolve(n)}const yd={};function ry(n,e,t={}){const r=[e,JSON.stringify(n)].toString();let i=yd[r];if(!i||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof Mp)a.setLoader((c,h,f)=>{const p=function(d){d.arrayBuffer().then(g=>{const y=a.getFormat().readFeatures(g,{extent:c,featureProjection:f});a.setFeatures(y)})};yo(()=>u).then(d=>{if(d instanceof Response)return p(d);fetch(d).then(p).catch(g=>a.setState(ue.ERROR))}).catch(d=>a.setState(ue.ERROR))});else{const c=a.getImage();yo(()=>u).then(h=>{if(typeof h=="string"){c.src=h;return}const f=p=>p.blob().then(d=>{const g=URL.createObjectURL(d);c.addEventListener("load",()=>URL.revokeObjectURL(g)),c.addEventListener("error",()=>URL.revokeObjectURL(g)),c.src=g});if(h instanceof Response)return f(h);fetch(h).then(f).catch(p=>a.setState(ue.ERROR))}).catch(h=>a.setState(ue.ERROR))}});const o=n.url;if(o&&!n.tiles){const a=oo(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:a}),tileLoadFunction:s});else{const l={};i=mi("Source",a[0],t,l).then(function(u){return u.tiles=u.tiles.map(function(c){return u.scheme==="tms"&&(c=c.replace("{y}","{-y}")),oo(c,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else n.tiles?(n=Object.assign({},n,{tiles:n.tiles.map(function(a){return n.scheme==="tms"&&(a=a.replace("{y}","{-y}")),oo(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:s})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));yd[r]=i}return i}function _d(n,e,t,r){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],s=Ia(i[0],i[1]),o=s.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,i[0],i[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${r.r*255},${r.g*255},${r.b*255},${r.a})`;const l=a.data;for(let u=0,c=a.width;u<c;++u)for(let h=0,f=a.height;h<f;++h){const p=(h*c+u)*4;l[p+3]>0&&o.arc(u,h,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function HI(n,e,t){const r=Math.max(0,Math.min(1,(t-n)/(e-n)));return r*r*(3-2*r)}function xd(n,e,t){const r=Ia(e.width,e.height),i=r.getContext("2d");i.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let u=0,c=s.height;u<c;++u){const h=(u*l+a)*4,f=o[h+3]/255,p=.75,d=.1,g=HI(p-d,p+d,f);g>0?(o[h+0]=Math.round(255*t.r*g),o[h+1]=Math.round(255*t.g*g),o[h+2]=Math.round(255*t.b*g),o[h+3]=Math.round(255*g)):o[h+3]=0}return i.putImageData(s,0,0),r}const qI=Array(256).join("");function au(n,e){if(e>=.05){let t="";const r=n.split(`
`),i=qI.slice(0,Math.round(e/.1));for(let s=0,o=r.length;s<o;++s)s>0&&(t+=`
`),t+=r[s].split("").join(i);return t}return n}let pl;function ny(){return pl||(pl=Ia(1,1).getContext("2d")),pl}function yn(n,e){return ny().measureText(n).width+(n.length-1)*e}const Bo={};nx.on("propertychange",()=>{for(const n in Bo)delete Bo[n]});function lu(n,e,t,r){if(n.indexOf(`
`)!==-1){const o=n.split(`
`),a=[];for(let l=0,u=o.length;l<u;++l)a.push(lu(o[l],e,t,r));return a.join(`
`)}const i=t+","+e+","+n+","+r;let s=Bo[i];if(!s){const o=n.split(" ");if(o.length>1){const a=ny();a.font=e;const u=a.measureText("M").width*t;let c="";const h=[];for(let f=0,p=o.length;f<p;++f){const d=o[f],g=c+(c?" ":"")+d;yn(g,r)<=u?c=g:(c&&h.push(c),c=d)}c&&h.push(c);for(let f=0,p=h.length;f<p&&p>1;++f){const d=h[f];if(yn(d,r)<u*.35){const g=f>0?yn(h[f-1],r):1/0,m=f<p-1?yn(h[f+1],r):1/0;h.splice(f,1),p-=1,g<m?(h[f-1]+=" "+d,f-=1):h[f]=d+" "+h[f]}}for(let f=0,p=h.length-1;f<p;++f){const d=h[f],g=h[f+1];if(yn(d,r)>u*.7&&yn(g,r)<u*.6){const m=d.split(" "),y=m.pop();yn(y,r)<u*.2&&(h[f]=m.join(" "),h[f+1]=y+" "+g),p-=1}}s=h.join(`
`)}else s=n;s=au(s,r),Bo[i]=s}return s}const YI=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],bd={};function KI(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(ra)return n;let t;for(let r=0,i=n.length;r<i;++r){const s=n[r];if(s in bd)continue;bd[s]=!0;const a=ou(s,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let r=0,i=t.length;r<i;++r){const s=t[r],o=s[0];if(YI.includes(o))continue;const a=s[1],l=s[2];if(!(await document.fonts.load(`${l} ${a} 16px "${o}"`)).some(c=>c.family.replace(/^['"]|['"]$/g,"").toLowerCase()===o.toLowerCase()&&c.weight==a&&c.style===l)){const c=e.replace("{font-family}",o.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",o.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+c+'"]')){const h=document.createElement("link");h.href=c,h.rel="stylesheet",document.head.appendChild(h)}}}})(),n}const JI={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},QI={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},eC=function(n,e){const t=II(n,e);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return t.value},Zt={zoom:0,distanceFromCenter:0};jt.register(Pa,{...jt.definitions,pitch:[{kind:"number"},[],n=>Zt.pitch||90],"distance-from-center":[{kind:"number"},[],n=>Zt.distanceFromCenter||0]});let Qs,gl;function W(n,e,t,r,i,s){const o=n.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[o]||(i[o]={});const a=i[o];if(!a[t]){let l=(n[e]||or)[t];const u=$I[`${e}_${n.type}`][t];l===void 0&&(l=u.default);let c=AI(l);if(!c&&qm(l)&&(l=DI(l,u),c=!0),c){const h=eC(l,u);a[t]=h.evaluate.bind(h)}else u.type=="color"&&(l=Le.parse(l)),a[t]=function(){return l}}return a[t](Zt,r,s)}function Ed(n,e,t,r){return W(n,"layout",`${t}-allow-overlap`,e,r)?W(n,"layout",`${t}-ignore-placement`,e,r)?"none":"obstacle":"declutter"}function tC(n,e,t,r){if(r||console.warn("No filterCache provided to evaluateFilter()"),!(n in r))try{r[n]=MI(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),r[n]=function(){return!1}}return r[n](Zt,t)}function qr(n,e){if(n){if(n.a===0||e===0)return;const t=n.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(n.r*255/t)+","+Math.round(n.g*255/t)+","+Math.round(n.b*255/t)+","+t*e+")"}return n}const rC=/\{[^{}}]*\}/g;function ml(n,e){return n.replace(rC,function(t){return e[t.slice(1,-1)]||""})}function Td(n,e){let t=n.split(":")[0];return t===n&&(t="default"),e[t]}const nC={};function iC(n,e,t,r=Rr,i=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");nC[ZI(e,n)]=Array.from(arguments);const l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(const b in s){const E=s[b];yo(()=>E).then(async w=>{let S;if(typeof Image<"u"){const v=new Image;if(typeof w=="string")v.crossOrigin="anonymous",v.src=w;else{let R;w instanceof Request?R=await fetch(w):w instanceof Response&&(R=w);const C=await R.blob();S=URL.createObjectURL(C),v.src=S}v.addEventListener("load",function R(){v.removeEventListener("load",R),l[b]={image:v,size:[v.width,v.height]},n.changed(),S&&URL.revokeObjectURL(S)}),v.addEventListener("error",function R(){URL.revokeObjectURL(S),v.removeEventListener("error",R)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const v=self;v.postMessage({action:"loadImage",src:w}),v.addEventListener("message",function(C){C.data.action==="imageLoaded"&&C.data.src===w&&(l[b]={image:C.data.image,size:[C.data.image.width,C.data.image.height]})})}})}const u=Im(e.layers),c={},h=[],f={},p={},d=ey(e),g=WI(e);let m;for(let b=0,E=u.length;b<E;++b){const w=u[b],S=w.id;if(typeof t=="string"&&w.source==t||Array.isArray(t)&&t.indexOf(S)!==-1){const v=w["source-layer"];if(m){if(w.source!==m)throw new Error(`Layer "${S}" does not use source "${m}`)}else{m=w.source;const C=e.sources[m];if(!C)throw new Error(`Source "${m}" is not defined`);const F=C.type;if(F!=="vector"&&F!=="geojson")throw new Error(`Source "${m}" is not of type "vector" or "geojson", but "${F}"`)}let R=c[v];R||(R=[],c[v]=R),R.push({layer:w,index:b}),h.push(S)}}const y=new zi,_=new ti,x=[],T=function(b,E,w){var $,V,H;const S=((H=(V=($=n.getSource)==null?void 0:$.call(n))==null?void 0:V.format_)==null?void 0:H.layerName_)??"mvt:layer",v=b.getProperties(),R=c[v[S]];if(!R)return;let C=r.indexOf(E);C==-1&&(C=uh(E,r)),Zt.zoom=C,Zt.distanceFromCenter=0;const F=b.getGeometry(),N=JI[F.getType()],D=n.get("map");if(D&&D instanceof Eo&&N===1){const ee=D.getSize();if(ee){const fe=D.getView().getCenter(),J=Ei(F.getExtent());Zt.distanceFromCenter=ix(fe,J)/E/ee[1]}}const A={id:b.getId(),properties:v,type:N},M=n.get("mapbox-featurestate")[b.getId()];let O=-1;for(let ee=0,fe=R.length;ee<fe;++ee){const J=R[ee],G=J.layer,Ae=G.id;if(w!==void 0&&w!==Ae)continue;const Ie=G.layout||or,be=G.paint||or;if(Ie.visibility==="none"||"minzoom"in G&&C<G.minzoom||"maxzoom"in G&&C>=G.maxzoom)continue;const ot=G.filter;if(!ot||tC(Ae,ot,A,g)){let Me,Je,Ht,dt,pt,j;const gt=J.index;if(N==3&&(G.type=="fill"||G.type=="fill-extrusion"))if(Je=W(G,"paint",G.type+"-opacity",A,d,M),G.type+"-pattern"in be){const Ze=W(G,"paint",G.type+"-pattern",A,d,M);if(Ze){const je=typeof Ze=="string"?ml(Ze,v):Ze.toString(),Ge=Td(je,l);if(i&&i[je]&&Ge){++O,j=x[O],(!j||!j.getFill()||j.getStroke()||j.getText())&&(j=new Tn({fill:new ti}),x[O]=j),Ht=j.getFill(),j.setZIndex(gt);const Oe=je+"."+Je;let it=p[Oe];if(!it){const ge=i[je],ve=Ia(ge.width,ge.height),lt=ve.getContext("2d");lt.globalAlpha=Je,lt.drawImage(Ge.image,ge.x,ge.y,ge.width,ge.height,0,0,ge.width,ge.height),it=lt.createPattern(ve,"repeat"),p[Oe]=it}Ht.setColor(it)}}}else Me=qr(W(G,"paint",G.type+"-color",A,d,M),Je),G.type+"-outline-color"in be&&(pt=qr(W(G,"paint",G.type+"-outline-color",A,d,M),Je)),pt||(pt=Me),(Me||pt)&&(++O,j=x[O],(!j||Me&&!j.getFill()||!Me&&j.getFill()||pt&&!j.getStroke()||!pt&&j.getStroke()||j.getText())&&(j=new Tn({fill:Me?new ti:void 0,stroke:pt?new zi:void 0}),x[O]=j),Me&&(Ht=j.getFill(),Ht.setColor(Me)),pt&&(dt=j.getStroke(),dt.setColor(pt),dt.setWidth(.5)),j.setZIndex(gt));if(N!=1&&G.type=="line"){"line-pattern"in be?Me=void 0:Me=qr(W(G,"paint","line-color",A,d,M),W(G,"paint","line-opacity",A,d,M));const Ze=W(G,"paint","line-width",A,d,M);Me&&Ze>0&&(++O,j=x[O],(!j||!j.getStroke()||j.getFill()||j.getText())&&(j=new Tn({stroke:new zi}),x[O]=j),dt=j.getStroke(),dt.setLineCap(W(G,"layout","line-cap",A,d,M)),dt.setLineJoin(W(G,"layout","line-join",A,d,M)),dt.setMiterLimit(W(G,"layout","line-miter-limit",A,d,M)),dt.setColor(Me),dt.setWidth(Ze),dt.setLineDash(be["line-dasharray"]?W(G,"paint","line-dasharray",A,d,M).map(function(je){return je*Ze}):null),j.setZIndex(gt))}let Rt=!1,de=null,pn=0,Cr,rt,jr;if((N==1||N==2)&&"icon-image"in Ie){const Ze=W(G,"layout","icon-image",A,d,M);if(Ze){Cr=typeof Ze=="string"?ml(Ze,v):Ze.toString();let je;const Ge=a?a(n,Cr):void 0,Oe=Td(Cr,l);if(i&&i[Cr]&&Oe||Ge){const it=W(G,"layout","icon-rotation-alignment",A,d,M);if(N==2){const ge=b.getGeometry();if(ge.getFlatMidpoint||ge.getFlatMidpoints){const ve=ge.getExtent();if(Math.sqrt(Math.max(Math.pow((ve[2]-ve[0])/E,2),Math.pow((ve[3]-ve[1])/E,2)))>150){const mt=ge.getType()==="MultiLineString"?ge.getFlatMidpoints():ge.getFlatMidpoint();if(gl||(Qs=[NaN,NaN],gl=new os("Point",Qs,[],2,{},void 0)),je=gl,Qs[0]=mt[0],Qs[1]=mt[1],W(G,"layout","symbol-placement",A,d,M)==="line"&&it==="map"){const rr=ge.getStride(),Pt=ge.getFlatCoordinates();for(let Gt=0,qe=Pt.length-rr;Gt<qe;Gt+=rr){const Et=Pt[Gt],qt=Pt[Gt+1],Ye=Pt[Gt+rr],Xr=Pt[Gt+rr+1],Ry=Math.min(Et,Ye),Py=Math.max(Et,Ye),Da=mt[0],Ay=mt[1],Iy=(Xr-qt)*(Da-Et)-(Ye-Et)*(Ay-qt);if(Math.abs(Iy)<.001&&Da<=Py&&Da>=Ry){pn=Math.atan2(qt-Xr,Ye-Et);break}}}}}}if(N!==2||je){const ge=W(G,"layout","icon-size",A,d,M),ve=be["icon-color"]!==void 0?W(G,"paint","icon-color",A,d,M):null;if(!ve||ve.a!==0){const lt=W(G,"paint","icon-halo-color",A,d,M),mt=W(G,"paint","icon-halo-width",A,d,M);let fr=`${Cr}.${ge}.${mt}.${lt}`;if(ve!==null&&(fr+=`.${ve}`),rt=f[fr],!rt){const rr=Ed(G,A,"icon",d);let Pt;"icon-offset"in Ie&&(Pt=W(G,"layout","icon-offset",A,d,M).slice(0),Pt[0]*=ge,Pt[1]*=-ge);let Gt=ve?[ve.r*255,ve.g*255,ve.b*255,ve.a]:void 0;if(Ge){const qe={color:Gt,rotateWithView:it==="map",displacement:Pt,declutterMode:rr,scale:ge};typeof Ge=="string"?qe.src=Ge:(qe.img=Ge,qe.imgSize=[Ge.width,Ge.height]),rt=new kh(qe)}else{const qe=i[Cr];let Et,qt,Ye;if(mt)qe.sdf?(Et=_d(xd(Oe.image,qe,ve||[0,0,0,1]),{x:0,y:0,width:qe.width,height:qe.height,pixelRatio:qe.pixelRatio},mt,lt),Gt=void 0):Et=_d(Oe.image,qe,mt,lt);else{if(qe.sdf&&!Oe.unSDFed){const Xr=xd(Oe.image,{x:0,y:0,width:Oe.size[0],height:Oe.size[1]},{r:1,g:1,b:1});Oe.image=Xr,Oe.unSDFed=!0}Et=Oe.image,qt=[qe.width,qe.height],Ye=[qe.x,qe.y]}rt=new kh({color:Gt,img:Et,imgSize:Oe.size,size:qt,offset:Ye,rotateWithView:it==="map",scale:ge/qe.pixelRatio,displacement:Pt,declutterMode:rr})}f[fr]=rt}}rt&&(++O,j=x[O],(!j||!j.getImage()||j.getFill()||j.getStroke())&&(j=new Tn,x[O]=j),j.setGeometry(je),rt.setRotation(pn+dl(W(G,"layout","icon-rotate",A,d,M))),rt.setOpacity(W(G,"paint","icon-opacity",A,d,M)),rt.setAnchor(QI[W(G,"layout","icon-anchor",A,d,M)]),j.setImage(rt),de=j.getText(),j.setText(void 0),j.setZIndex(gt),Rt=!0,jr=!1)}else jr=!0}}}if(N==1&&G.type==="circle"){++O,j=x[O],(!j||!j.getImage()||j.getFill()||j.getStroke())&&(j=new Tn,x[O]=j);const Ze="circle-radius"in be?W(G,"paint","circle-radius",A,d,M):5,je=qr(W(G,"paint","circle-stroke-color",A,d,M),W(G,"paint","circle-stroke-opacity",A,d,M)),Ge=W(G,"paint","circle-translate",A,d,M),Oe=qr(W(G,"paint","circle-color",A,d,M),W(G,"paint","circle-opacity",A,d,M)),it=W(G,"paint","circle-stroke-width",A,d,M),ge=Ze+"."+je+"."+Oe+"."+it+"."+Ge[0]+"."+Ge[1];rt=f[ge],rt||(rt=new Ip({radius:Ze,displacement:[Ge[0],-Ge[1]],stroke:je&&it>0?new zi({width:it,color:je}):void 0,fill:Oe?new ti({color:Oe}):void 0,declutterMode:"none"}),f[ge]=rt),j.setImage(rt),de=j.getText(),j.setText(void 0),j.setGeometry(void 0),j.setZIndex(gt),Rt=!0}let nt,at,Mi,Vr,Oi,Na;if("text-field"in Ie){Vr=Math.round(W(G,"layout","text-size",A,d,M));const Ze=W(G,"layout","text-font",A,d,M);Mi=W(G,"layout","text-line-height",A,d,M),at=ou(o?o(Ze,e.metadata?e.metadata["ol:webfonts"]:void 0):Ze,Vr,Mi),at.includes("sans-serif")||(at+=",sans-serif"),Oi=W(G,"layout","text-letter-spacing",A,d,M),Na=W(G,"layout","text-max-width",A,d,M);const je=W(G,"layout","text-field",A,d,M);typeof je=="object"&&je.sections?je.sections.length===1?nt=je.toString():nt=je.sections.reduce((Ge,Oe,it)=>{const ge=Oe.fontStack?Oe.fontStack.split(","):Ze,ve=ou(o?o(ge):ge,Vr*(Oe.scale||1),Mi);let lt=Oe.text;if(lt===`
`)return Ge.push(`
`,""),Ge;if(N==2)return Ge.push(au(lt,Oi),ve),Ge;lt=lu(lt,ve,Na,Oi).split(`
`);for(let mt=0,fr=lt.length;mt<fr;++mt)mt>0&&Ge.push(`
`,""),Ge.push(lt[mt],ve);return Ge},[]):nt=ml(je,v).trim(),Je=W(G,"paint","text-opacity",A,d,M)}if(nt&&Je&&!jr){Rt||(++O,j=x[O],(!j||!j.getText()||j.getFill()||j.getStroke())&&(j=new Tn,x[O]=j),j.setImage(void 0),j.setGeometry(void 0));const Ze=Ed(G,A,"text",d);j.getText()||j.setText(de),de=j.getText(),(!de||"getDeclutterMode"in de&&de.getDeclutterMode()!==Ze)&&(de=new sx({padding:[2,2,2,2],declutterMode:Ze}),j.setText(de));const je=W(G,"layout","text-transform",A,d,M);je=="uppercase"?nt=Array.isArray(nt)?nt.map((Ye,Xr)=>Xr%2?Ye:Ye.toUpperCase()):nt.toUpperCase():je=="lowercase"&&(nt=Array.isArray(nt)?nt.map((Ye,Xr)=>Xr%2?Ye:Ye.toLowerCase()):nt.toLowerCase());const Ge=Array.isArray(nt)?nt:N==2?au(nt,Oi):lu(nt,at,Na,Oi);if(de.setText(Ge),de.setFont(at),de.setRotation(dl(W(G,"layout","text-rotate",A,d,M))),typeof de.setKeepUpright=="function"){const Ye=W(G,"layout","text-keep-upright",A,d,M);de.setKeepUpright(Ye)}const Oe=W(G,"layout","text-anchor",A,d,M),it=Rt||N==1?"point":W(G,"layout","symbol-placement",A,d,M);let ge;if(it==="line-center"?(de.setPlacement("line"),ge="center"):de.setPlacement(it),it==="line"&&typeof de.setRepeat=="function"){const Ye=W(G,"layout","symbol-spacing",A,d,M);de.setRepeat(Ye*2)}de.setOverflow(it==="point");let ve=W(G,"paint","text-halo-width",A,d,M);const lt=W(G,"layout","text-offset",A,d,M),mt=W(G,"paint","text-translate",A,d,M);let fr=0,rr=0;if(it=="point"){ge="center",Oe.indexOf("left")!==-1?(ge="left",rr=ve):Oe.indexOf("right")!==-1&&(ge="right",rr=-ve);const Ye=W(G,"layout","text-rotation-alignment",A,d,M);de.setRotateWithView(Ye=="map")}else de.setMaxAngle(dl(W(G,"layout","text-max-angle",A,d,M))*nt.length/Ge.length),de.setRotateWithView(!1);de.setTextAlign(ge);let Pt="middle";Oe.indexOf("bottom")==0?(Pt="bottom",fr=-ve-.5*(Mi-1)*Vr):Oe.indexOf("top")==0&&(Pt="top",fr=ve+.5*(Mi-1)*Vr),de.setTextBaseline(Pt);const Gt=W(G,"layout","text-justify",A,d,M);de.setJustify(Gt==="auto"?void 0:Gt),de.setOffsetX(lt[0]*Vr+rr+mt[0]),de.setOffsetY(lt[1]*Vr+fr+mt[1]),_.setColor(qr(W(G,"paint","text-color",A,d,M),Je)),de.setFill(_);const qe=qr(W(G,"paint","text-halo-color",A,d,M),Je);if(qe&&ve>0){y.setColor(qe),ve*=2;const Ye=.5*Vr;y.setWidth(ve<=Ye?ve:Ye),de.setStroke(y)}else de.setStroke(void 0);const Et=W(G,"layout","text-padding",A,d,M),qt=de.getPadding();Et!==qt[0]&&(qt[0]=Et,qt[1]=Et,qt[2]=Et,qt[3]=Et),j.setZIndex(gt)}}}if(O>-1)return x.length=O+1,x};return n.setStyle(T),n.set("mapbox-layers",h),n.set("mapbox-source",m),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),T}function iy(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const f=new Array(a);for(let d=0;d<a;++d)f[d]=new ImageData(new Uint8ClampedArray(t[d]),s,o);return n(f,r).data.buffer}const u=new Uint8ClampedArray(l),c=new Array(a),h=new Array(a);for(let f=0;f<a;++f)c[f]=new Uint8ClampedArray(t[f]),h[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let d=0;d<a;++d){const g=c[d];h[d][0]=g[f],h[d][1]=g[f+1],h[d][2]=g[f+2],h[d][3]=g[f+3]}const p=n(h,r);u[f]=p[0],u[f+1]=p[1],u[f+2]=p[2],u[f+3]=p[3]}return u.buffer}}function sC(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+iy.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function oC(n,e){const t=iy(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}let aC=class extends m0{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=sC(e,this.onWorkerMessage_.bind(this,i));else r[0]=oC(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,c=[];for(let h=0,f=i.length;h<f;++h)c.push(i[h].slice(u,u+a));this.workers_[l].postMessage({buffers:c,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},c)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,u=a*o;r.set(new Uint8ClampedArray(l),u),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}};const wd={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};let vd=class extends Ou{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}},sy=class extends pc{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=cC(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(Dn.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new ox(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:xo(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:uC(this.layers_),pixelRatio:1,pixelToCoordinateTransform:xo(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ct(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],u=l instanceof ea?l:l.getSource();if(!u)continue;const c=(s=u.getAttributions())==null?void 0:s(r);typeof c=="string"?i.push(c):c!==void 0&&i.push(...c)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new aC({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Ei(e);i.size[0]=Math.ceil(On(e)/t),i.size[1]=Math.ceil(Nn(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!ss(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=lC(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new vd(wd.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ss(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(On(s)/o),u=Math.round(Nn(s)/o);a=_o(l,u),this.renderedImageCanvas_=new yx(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new vd(wd.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}};sy.prototype.dispose;let _n=null;function lC(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!_n)_n=_o(r,i,void 0,{willReadFrequently:!0});else{const a=_n.canvas;a.width!==r||a.height!==i?_n=_o(r,i,void 0,{willReadFrequently:!0}):_n.clearRect(0,0,r,i)}return _n.drawImage(o,0,0,r,i),_n.getImageData(0,0,r,i)}function uC(n){return n.map(function(e){return e.getLayerState()})}function cC(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=hC(n[r]);return t}function hC(n){let e;return n instanceof ea?n instanceof ax?e=new Io({source:n}):n instanceof pc&&(e=new dc({source:n})):e=n,e}function fC(n,e){const t=n[0],r=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=r-1,u=i-1,c=[0,0,0,0],h=2*Math.PI,f=Math.PI/2,p=Math.PI*e.sunEl/180,d=Math.PI*e.sunAz/180,g=Math.cos(p),m=Math.sin(p),y=e.highlightColor,_=e.shadowColor,x=e.accentColor,T=e.encoding;let b,E,w,S,v,R,C,F,N,D,A,M,O,$,V,H,ee,fe,J,G,Ae,Ie;function be(ot,Me="mapbox"){if(Me==="mapbox")return(ot[0]*256*256+ot[1]*256+ot[2])*.1-1e4;if(Me==="terrarium")return ot[0]*256+ot[1]+ot[2]/256-32768}for(E=0;E<=u;++E)for(v=E===0?0:E-1,R=E===u?u:E+1,b=0;b<=l;++b)w=b===0?0:b-1,S=b===l?l:b+1,C=(E*r+w)*4,c[0]=s[C],c[1]=s[C+1],c[2]=s[C+2],c[3]=s[C+3],F=e.vert*be(c,T),C=(E*r+S)*4,c[0]=s[C],c[1]=s[C+1],c[2]=s[C+2],c[3]=s[C+3],N=e.vert*be(c,T),D=(N-F)/a,C=(v*r+b)*4,c[0]=s[C],c[1]=s[C+1],c[2]=s[C+2],c[3]=s[C+3],F=e.vert*be(c,T),C=(R*r+b)*4,c[0]=s[C],c[1]=s[C+1],c[2]=s[C+2],c[3]=s[C+3],N=e.vert*be(c,T),A=(N-F)/a,O=Math.atan2(A,-D),O<0?O=f-O:O>f?O=h-O+f:O=f-O,M=Math.atan(Math.sqrt(D*D+A*A)),Ie=m*Math.cos(M)+g*Math.sin(M)*Math.cos(d-O),$=Math.cos(M),V=255*Ie,J=Math.min(Math.max(2*e.sunEl,0),1),G=1.875-e.opacity*1.75,Ae=e.opacity!==.5?f*((Math.pow(G,M)-1)/(Math.pow(G,f)-1)):M,ee={r:(1-$)*x.r*J*255,g:(1-$)*x.g*J*255,b:(1-$)*x.b*J*255,a:(1-$)*x.a*J*255},H=Math.abs(((O+d)/Math.PI+.5)%2-1),fe={r:(y.r*(1-H)+_.r*H)*V,g:(y.g*(1-H)+_.g*H)*V,b:(y.b*(1-H)+_.b*H)*V,a:(y.a*(1-H)+_.a*H)*V},C=(E*r+b)*4,o[C]=ee.r*(1-H)+fe.r,o[C+1]=ee.g*(1-H)+fe.g,o[C+2]=ee.b*(1-H)+fe.b,o[C+3]=s[C+3]*e.opacity*J*Math.sin(Ae);return new ImageData(o,r,i)}function dC(n,e=512){return n.getExtent()?vs({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():Rr}function oy(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((r,i)=>{e.accessToken=r,e.accessTokenParam=i})),e}function pC(n,e,t="",r={},i=void 0){let s,o,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,r=a):l=t,typeof r=="string"?(s=r,a={}):(s=r.styleUrl,a=r),a.updateSource===!1&&(u=!1),i||(i=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:Uo(s,a.accessToken),a=oy(s,a)),new Promise(function(c,h){ty(e,a).then(function(f){if(f.version!=8)return h(new Error("glStyle version 8 required."));if(!(n instanceof Jo||n instanceof si))return h(new Error("Can only apply to VectorLayer or VectorTileLayer"));const p=n instanceof si?"vector":"geojson";if(l?Array.isArray(l)?o=f.layers.find(function(T){return T.id===l[0]}).source:o=l:(o=f.layers.find(function(T){return T.source&&f.sources[T.source].type===p}).source,l=o),!o)return h(new Error(`No ${p} source found in the glStyle.`));function d(){if(!u)return Promise.resolve();if(n instanceof si)return uy(f.sources[o],s,a).then(function(w){const S=n.getSource();S?w!==S&&(S.setTileUrlFunction(w.getTileUrlFunction()),typeof S.setUrls=="function"&&typeof w.getUrls=="function"&&S.setUrls(w.getUrls()),S.format_||(S.format_=w.format_),S.getAttributions()||S.setAttributions(w.getAttributions()),S.getTileLoadFunction()===Fg&&S.setTileLoadFunction(w.getTileLoadFunction()),St(S.getProjection(),w.getProjection())&&(S.tileGrid=w.getTileGrid())):n.setSource(w);const v=n.getSource().getTileGrid();!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())&&v.getMinZoom()>0&&n.setMaxResolution(ji(Math.max(0,v.getMinZoom()-1e-12),v.getResolutions()))});const T=f.sources[o];let b=n.getSource();(!b||b.get("mapbox-source")!==T)&&(b=fy(T,s,a));const E=n.getSource();return E?b!==E&&(E.getAttributions()||E.setAttributions(b.getAttributions()),E.format_||(E.format_=b.getFormat()),E.url_=b.getUrl()):n.setSource(b),Promise.resolve()}let g,m;const y={},_={};function x(){if(!m&&(!f.sprite||y)){if(a.projection&&!i){const w=Ue(a.projection).getUnits();w!=="m"&&(i=Rr.map(S=>S/Cl[w]))}let T;const b=n.getSource();b instanceof Cs&&b.format_ instanceof mc&&(T=b.format_.layerName_),m=iC(n,f,l,i,y,_,(E,w=a.webfonts)=>KI(E,w),a.getImage,T),n.getStyle()?d().then(c).catch(h):h(new Error(`Nothing to show for source [${o}]`))}else m?(n.setStyle(m),d().then(c).catch(h)):h(new Error("Something went wrong trying to apply style."))}if(f.sprite){const T=jI(f.sprite,a.accessToken,s||location.href);g=ra?1:window.devicePixelRatio>=1.5?.5:1;const b=g==.5?"@2x":"";Promise.all(T.map(function(E){const w=new URL(E.url);let S=w.origin+w.pathname+b+".json"+w.search;return new Promise(function(v,R){mi("Sprite",S,a).then(v).catch(function(C){S=w.origin+w.pathname+".json"+w.search,mi("Sprite",S,a).then(v).catch(R)})}).then(function(v){v===void 0&&h(new Error("No sprites found."));let R;if(R=w.origin+w.pathname+b+".png"+w.search,a.transformRequest){const C=a.transformRequest(R,"SpriteImage")||R;(C instanceof Request||C instanceof Promise)&&(R=C)}_[E.id]=R;for(const C in v){const F=E.id=="default"?C:`${E.id}:${C}`;y[F]=v[C]}}).catch(function(v){h(new Error(`Sprites cannot be loaded: ${S}: ${v.message}`))})})).then(x).catch(h)}else x()}).catch(h)})}function ay(n,e){let t;return n.some(function(r){if(r.id==e)return t=r.source,!0}),t}function gC(n,e){const t=n.bounds;if(t){const r=Ll([t[0],t[1]],e),i=Ll([t[2],t[3]],e);return[r[0],r[1],i[0],i[1]]}return Ue(e).getExtent()}function ly(n,e,t){const r=new gc({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),i=r.getTileJSON(),s=r.getTileGrid(),o=Ue(t.projection||"EPSG:3857"),a=gC(i,o),l=o.getExtent(),u=i.minzoom||0,c=i.maxzoom||22,h={attributions:r.getAttributions(),projection:o,tileGrid:new Gu({origin:l?Mu(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:dC(o,e.tileSize).slice(0,c+1),tileSize:s.getTileSize(0)})};return Array.isArray(i.tiles)?h.urls=i.tiles:h.url=i.tiles,h}function mC(n,e,t,r){const i={id:n.id,type:n.type},s=n.layout||{},o=n.paint||{};i.paint=o,Zt.zoom=uh(e,t.resolutions||Rr),Zt.distanceFromCenter=0;let a;const l=W(i,"paint","background-color",or,r);return o["background-opacity"]!==void 0&&(a=W(i,"paint","background-opacity",or,r)),s.visibility=="none"?void 0:qr(l,a)}function yC(n,e,t){const r=ra?{style:{}}:document.createElement("div");return r.className="ol-mapbox-style-background",r.style.position="absolute",r.style.width="100%",r.style.height="100%",new vp({source:new ea({}),render(i){const s=mC(n,i.viewState.resolution,e,t);return r.style.backgroundColor=s,r}})}function uy(n,e,t){return new Promise(function(r,i){ry(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=ly(n,s,t);a.tileLoadFunction=o,a.format=new mc({layerName:"mvt:layer"});const l=new Cs(a);l.set("mapbox-source",n),r(l)}).catch(i)})}function _C(n,e,t){const r=new si({declutter:!0,visible:!1});return uy(n,e,t).then(function(i){r.setSource(i)}).catch(function(i){r.setSource(void 0)}),r}function cy(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function xC(n,e,t){return new Promise(function(r,i){ry(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new gc({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=ly(n,s,t).tileGrid,t.projection&&(a.projection=Ue(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(u,c,h){const f=cy(h);let p=l(u,c,h);if(p.indexOf(f)!=-1){const d=a.getTileGrid().getTileCoordExtent(u);p=p.replace(f,d.toString())}return p}),a.set("mapbox-source",n),r(a)}).catch(function(s){i(s)})})}function hy(n,e,t){const r=new Io;return xC(n,e,t).then(function(i){r.setSource(i)}).catch(function(){r.setSource(void 0)}),r}function bC(n,e,t){const r=hy(n,e,t);return new dc({source:new sy({operationType:"image",operation:fC,sources:[r]})})}function fy(n,e,t){const r=t.projection?new kl({dataProjection:t.projection}):new kl,i=n.data,s={};if(typeof i=="string"){const[a]=oo(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(h,f,p)=>{const d=cy(p);return a.replace(d,`${h.join(",")}`)},c=new Xi({attributions:n.attribution,format:r,loader:(h,f,p,d,g)=>{const m=typeof u=="function"?u(h,f,p):u;mi("GeoJSON",m,t).then(y=>{const _=c.getFormat().readFeatures(y,{featureProjection:p});c.addFeatures(_),d(_)}).catch(y=>{c.removeLoadedExtent(h),g()})},strategy:S0});return c.set("mapbox-source",n),c}const l=new Xi({attributions:n.attribution,format:r,url:a,loader:(u,c,h,f,p)=>{mi("GeoJSON",a,t).then(d=>{const g=l.getFormat().readFeatures(d,{featureProjection:h});l.addFeatures(g),f(g)}).catch(d=>{l.removeLoadedExtent(u),p()})}});return l}s.features=r.readFeatures(i,{featureProjection:"EPSG:3857"});const o=new Xi(Object.assign({attributions:n.attribution,format:r},s));return o.set("mapbox-source",n),o}function EC(n,e,t){return new Jo({declutter:!0,source:fy(n,e,t),visible:!1})}function TC(n,e,t){let r=null;return function(i){n.paint&&"raster-opacity"in n.paint&&i.frameState.viewState.zoom!==r&&(r=i.frameState.viewState.zoom,delete t[n.id],wC(n,e,r,t))}}function wC(n,e,t,r){Zt.zoom=t,Zt.distanceFromCenter=0;const i=W(n,"paint","raster-opacity",or,r);e.setOpacity(i)}function vC(n,e){function t(){const r=e.get("mapbox-style");if(!r)return;const i=Im(r.layers),s=n.get("mapbox-layers"),o=i.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});n.get("visible")!==o&&n.setVisible(o)}n.on("change",t),t()}function SC(n,e,t,r){const i=ey(n),s=n.layers,o=t.type,a=t.source||ay(s,t.ref),l=n.sources[a];let u;if(o=="background")u=yC(t,r,i);else if(l.type=="vector")u=_C(l,e,r);else if(l.type=="raster")u=hy(l,e,r),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",TC(t,u,i));else if(l.type=="geojson")u=EC(l,e,r);else if(l.type=="raster-dem"&&t.type=="hillshade"){const h=bC(l,e,r);u=h,h.getSource().on("beforeoperations",function(f){const p=f.data;p.resolution=ux(r.projection||"EPSG:3857",f.resolution,Ei(f.extent),"m"),Zt.zoom=uh(f.resolution,r.resolutions||Rr),Zt.distanceFromCenter=0,p.encoding=l.encoding,p.vert=5*W(t,"paint","hillshade-exaggeration",or,i),p.sunAz=W(t,"paint","hillshade-illumination-direction",or,i),p.sunEl=35,p.opacity=.3,p.highlightColor=W(t,"paint","hillshade-highlight-color",or,i),p.shadowColor=W(t,"paint","hillshade-shadow-color",or,i),p.accentColor=W(t,"paint","hillshade-accent-color",or,i)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const c=a;return u&&u.set("mapbox-source",c),u}function Sd(n,e,t,r){const i=[];let s=null;if(e instanceof Eo){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const h=r.projection?Ue(r.projection):s.getProjection();s=new lx(Object.assign(s.getProperties(),{maxResolution:Rr[0]/Cl[h.getUnits()],projection:r.projection||s.getProjection()})),e.setView(s)}"center"in n&&!s.getCenter()&&s.setCenter(Ll(n.center,s.getProjection())),"zoom"in n&&s.getZoom()===void 0&&s.setResolution(Rr[0]/Cl[s.getProjection().getUnits()]/Math.pow(2,n.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",n),e.set("mapbox-metadata",{styleUrl:t,options:r});const o=n.layers;let a=[],l,u,c;for(let h=0,f=o.length;h<f;++h){const p=o[h],d=p.type;if(d=="heatmap"){console.debug(`layers[${h}].type "${d}" not supported`);continue}else c=p.source||ay(o,p.ref),(!c||c!=u)&&(a.length&&(i.push(Rd(l,a,n,t,e,r)),a=[]),l=SC(n,t,p,r),l instanceof Jo||l instanceof si||(a=[]),u=l.get("mapbox-source")),a.push(p.id)}return i.push(Rd(l,a,n,t,e,r)),Promise.all(i)}function RC(n,e,t={}){let r,i;if(ra){if(!(n instanceof Eo)&&!(n instanceof hp))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=n}else typeof n=="string"||n instanceof HTMLElement?i=new Eo({target:n}):i=n;if(typeof e=="string"){const s=e.startsWith("data:")?location.href:Uo(e,t.accessToken);t=oy(s,t),r=new Promise(function(o,a){ty(e,t).then(function(l){Sd(l,i,s,t).then(function(){o(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else r=new Promise(function(s,o){Sd(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:Uo(t.styleUrl,t.accessToken),t).then(function(){s(i)}).catch(o)});return r}function Rd(n,e,t,r,i,s={}){let o=24,a=0;const l=t.layers;for(let u=0,c=l.length;u<c;++u){const h=l[u];e.indexOf(h.id)!==-1&&(o=Math.min("minzoom"in h?h.minzoom:0,o),a=Math.max("maxzoom"in h?h.maxzoom:24,a))}return new Promise(function(u,c){const h=function(){const p=n.getSource();if(!p||p.getState()==="error"){c(new Error("Error accessing data for source "+n.get("mapbox-source")));return}if("getTileGrid"in p){const d=p.getTileGrid();if(d){const g=d.getMinZoom();(o>0||g>0)&&n.setMaxResolution(Math.min(ji(Math.max(0,o-1e-12),Rr),ji(Math.max(0,g-1e-12),d.getResolutions()))),a<24&&n.setMinResolution(ji(a,Rr))}}else o>0&&n.setMaxResolution(ji(Math.max(0,o-1e-12),Rr));p instanceof Xi||p instanceof Cs?pC(n,t,e,Object.assign({styleUrl:r},s)).then(function(){vC(n,i),u()}).catch(c):u()};n.set("mapbox-layers",e);const f=i.getLayers();f.getArray().indexOf(n)===-1&&f.push(n),n.getSource()?h():n.once("change:source",h)})}class PC extends b_{constructor(e={}){const{mapboxStyle:t,applyOptions:r,...i}=e;super(i),t&&this.applyMapboxStyle(t,r)}applyMapboxStyle(e,t){return RC(this,e,t)}}E_(gx);window.eoxMapAdvancedOlLayers={Graticule:hw,Heatmap:ov,Layer:Su,VectorImage:uv,WebGLPoints:hv,WebGLTile:vg,WebGLVector:fv,STAC:Uc,MapboxStyle:PC};function AC(n){const e=n[0],t=new Array(e);let r=1<<e-1,i,s;for(i=0;i<e;++i)s=48,n[1]&r&&(s+=1),n[2]&r&&(s+=2),t[i]=String.fromCharCode(s),r>>=1;return t.join("")}const IC='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class CC extends zr{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:we("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r=(e.url||"https://dev.virtualearth.net/REST/v1/Imagery/Metadata/")+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=Ts(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=ws({extent:s,minZoom:t.zoomMin,maxZoom:r,tileSize:a});this.tileGrid=l;const u=this.culture_,c=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=Ru(t.imageUrlSubdomains.map(function(f){const p=[0,0,0],d=t.imageUrl.replace("{subdomain}",f).replace("{culture}",u);return function(g,m,y){if(!g)return;Rl(g[0],g[1],g[2],p);const _=new URL(d.replace("{quadkey}",AC(p))),x=_.searchParams;return c&&(x.set("dpi","d1"),x.set("device","mobile")),h===!0?x.delete("n"):h===!1&&x.set("n","z"),_.toString()}})),t.imageryProviders){const f=Pu(we("EPSG:4326"),this.getProjection());this.setAttributions(p=>{const d=[],g=p.viewState,m=this.getTileGrid(),y=m.getZForResolution(g.resolution,this.zDirection),x=m.getTileCoordForCoordAndZ(g.center,y)[0];return t.imageryProviders.map(function(T){let b=!1;const E=T.coverageAreas;for(let w=0,S=E.length;w<S;++w){const v=E[w];if(x>=v.zoomMin&&x<=v.zoomMax){const R=v.bbox,C=[R[1],R[0],R[3],R[2]],F=hi(C,f);if(ci(F,p.extent)){b=!0;break}}}b&&d.push(T.attribution)}),d.push(IC),d})}this.setState("ready")}}class LC extends tp{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const r=new XMLHttpRequest;r.addEventListener("load",this.handleInitResponse_.bind(this,e)),r.addEventListener("error",this.handleInitError_.bind(this)),r.open("POST",t),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const r=t.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const FC=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,MC=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class OC{constructor(e){this.gl_=e,this.program_=uu(e,MC,FC),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,r,i,s,o,a,l,u,c,h,f,p){const d=this.gl_;l===void 0&&(l=i),u===void 0&&(u=s),o===void 0&&(o=t),a===void 0&&(a=r),c===void 0&&(c=o),h===void 0&&(h=a),f===void 0&&(f=d.canvas.width),p===void 0&&(p=d.canvas.height),d.bindTexture(d.TEXTURE_2D,e),d.useProgram(this.program_),d.bindBuffer(d.ARRAY_BUFFER,this.positionBuffer),d.enableVertexAttribArray(this.positionLocation),d.vertexAttribPointer(this.positionLocation,2,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,this.texcoordBuffer),d.enableVertexAttribArray(this.texcoordLocation),d.vertexAttribPointer(this.texcoordLocation,2,d.FLOAT,!1,0,0);let g=Nl(0,f,0,p,-1,1);g=fw(g,l,u,0),g=mf(g,c,h,1),d.uniformMatrix4fv(this.matrixLocation,!1,g);let m=dw(i/t,s/r,0);m=mf(m,o/t,a/r,1),d.uniformMatrix4fv(this.textureMatrixLocation,!1,m),d.uniform1i(this.textureLocation,0),d.drawArrays(d.TRIANGLES,0,this.positions.length/2)}}function Pd(n,e,t){const r=n.createShader(e);if(r===null)throw new Error("Shader compilation failed");if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){const i=n.getShaderInfoLog(r);throw i===null?new Error("Shader info log creation failed"):new Error(i)}return r}function uu(n,e,t){const r=n.createProgram(),i=Pd(n,n.VERTEX_SHADER,t),s=Pd(n,n.FRAGMENT_SHADER,e);if(r===null)throw new Error("Program creation failed");if(n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r)===null?new Error("Program info log creation failed"):new Error;return r}const NC=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,DC=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,GC=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,UC=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function BC(n,e,t,r){let i;return t&&t.length?i=t.shift():T_?i=new OffscreenCanvas(n||300,e||300):i=document.createElement("canvas"),n&&(i.width=n),e&&(i.height=e),i.getContext("webgl",r)}function kC(n){const e=n.canvas;e.width=1,e.height=1,n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)}const Ad=[];function zC(n,e,t,r,i,s,o,a,l,u,c,h,f,p){const d=Math.round(r*e),g=Math.round(r*t);n.canvas.width=d,n.canvas.height=g;let m,y;if(y=n.createTexture(),n.bindTexture(n.TEXTURE_2D,y),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),f?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,d,g,0,n.RGBA,c,null),m=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,m),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,y,0),m===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(l.length===0)return{width:d,height:g,framebuffer:m,texture:y};const _=Es();l.forEach(function(R,C,F){w_(_,R.extent)});let x,T,b;const E=1/i;{if(x=n.createTexture(),y===null)throw new Error("Could not create texture");T=Math.round(xt(_)*E),b=Math.round(cr(_)*E);const R=n.getParameter(n.MAX_TEXTURE_SIZE),C=Math.max(T,b),F=C>R?R/C:1,N=Math.round(T*F),D=Math.round(b*F);n.bindTexture(n.TEXTURE_2D,x),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),f?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,N,D,0,n.RGBA,c,null);const A=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,A),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,x,0);const M=new OC(n);l.forEach(function(O,$,V){const H=(O.extent[0]-_[0])*E*F,ee=-(O.extent[3]-_[3])*E*F,fe=xt(O.extent)*E*F,J=cr(O.extent)*E*F;if(n.bindFramebuffer(n.FRAMEBUFFER,A),n.viewport(0,0,N,D),O.clipExtent){const G=(O.clipExtent[0]-_[0])*E*F,Ae=-(O.clipExtent[3]-_[3])*E*F,Ie=xt(O.clipExtent)*E*F,be=cr(O.clipExtent)*E*F;n.enable(n.SCISSOR_TEST),n.scissor(f?G:Math.round(G),f?Ae:Math.round(Ae),f?Ie:Math.round(G+Ie)-Math.round(G),f?be:Math.round(Ae+be)-Math.round(Ae))}M.drawImage(O.texture,O.width,O.height,u,u,O.width-2*u,O.height-2*u,f?H:Math.round(H),f?ee:Math.round(ee),f?fe:Math.round(H+fe)-Math.round(H),f?J:Math.round(ee+J)-Math.round(ee),N,D),n.disable(n.SCISSOR_TEST)}),n.deleteFramebuffer(A)}const w=Pl(o),S=Pl(_),v=R=>{const C=(R[0][0]-w[0])/s*r,F=-(R[0][1]-w[1])/s*r,N=(R[1][0]-w[0])/s*r,D=-(R[1][1]-w[1])/s*r,A=(R[2][0]-w[0])/s*r,M=-(R[2][1]-w[1])/s*r;return{u1:N,v1:D,u0:C,v0:F,u2:A,v2:M}};n.bindFramebuffer(n.FRAMEBUFFER,m),n.viewport(0,0,d,g);{const R=[],C=[],F=uu(n,UC,GC);n.useProgram(F);const N=n.getUniformLocation(F,"u_texture");n.bindTexture(n.TEXTURE_2D,x),n.uniform1i(N,0),a.getTriangles().forEach(function(H,ee,fe){const J=H.source,G=H.target,{u1:Ae,v1:Ie,u0:be,v0:ot,u2:Me,v2:Je}=v(G),Ht=(J[0][0]-S[0])/i/T,dt=-(J[0][1]-S[1])/i/b,pt=(J[1][0]-S[0])/i/T,j=-(J[1][1]-S[1])/i/b,gt=(J[2][0]-S[0])/i/T,Rt=-(J[2][1]-S[1])/i/b;R.push(Ae,Ie,be,ot,Me,Je),C.push(pt,j,Ht,dt,gt,Rt)});const D=Nl(0,d,g,0,-1,1),A=n.getUniformLocation(F,"u_matrix");n.uniformMatrix4fv(A,!1,D);const M=n.getAttribLocation(F,"a_position"),O=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,O),n.bufferData(n.ARRAY_BUFFER,new Float32Array(R),n.STATIC_DRAW),n.vertexAttribPointer(M,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(M);const $=n.getAttribLocation(F,"a_texcoord"),V=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,V),n.bufferData(n.ARRAY_BUFFER,new Float32Array(C),n.STATIC_DRAW),n.vertexAttribPointer($,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray($),n.drawArrays(n.TRIANGLES,0,R.length/2)}if(h){const R=uu(n,DC,NC);n.useProgram(R);const C=Nl(0,d,g,0,-1,1),F=n.getUniformLocation(R,"u_matrix");n.uniformMatrix4fv(F,!1,C);const N=Array.isArray(h)?h:[0,0,0,255],D=n.getUniformLocation(R,"u_val");n.uniform4fv(D,N);const A=n.getAttribLocation(R,"a_position"),M=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,M),n.vertexAttribPointer(A,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(A);const O=a.getTriangles().reduce(function($,V){const H=V.target,{u1:ee,v1:fe,u0:J,v0:G,u2:Ae,v2:Ie}=v(H);return $.concat([ee,fe,J,G,J,G,Ae,Ie,Ae,Ie,ee,fe])},[]);n.bufferData(n.ARRAY_BUFFER,new Float32Array(O),n.STATIC_DRAW),n.drawArrays(n.LINES,0,O.length/2)}return{width:d,height:g,framebuffer:m,texture:y}}class $C extends Tu{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,r=t.getExtent(),i=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?i?Er(r,i):r:i;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?Er(s,o):s;if(Th(l)===0){this.state=pe.EMPTY;return}r&&(a?a=Er(a,r):a=r);const u=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,h=v_(t,c,l,u);if(!isFinite(h)||h<=0){this.state=pe.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:S_;if(this.triangulation_=new R_(t,c,l,a,h*f,u,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=pe.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let p=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(p[1]=Ve(p[1],a[1],a[3]),p[3]=Ve(p[3],a[1],a[3])):p=Er(p,a)),!Th(p))this.state=pe.EMPTY;else{let d=0,g=0;t.canWrapX()&&(d=xt(r),g=Math.floor((p[0]-r[0])/d)),P_(p.slice(),t,!0).forEach(y=>{const _=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),x=e.getTileFunction;for(let T=_.minX;T<=_.maxX;T++)for(let b=_.minY;b<=_.maxY;b++){const E=x(this.sourceZ_,T,b,this.pixelRatio_);if(E){const w=g*d;this.sourceTiles_.push({tile:E,offset:w})}}++g}),this.sourceTiles_.length===0&&(this.state=pe.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(T=>{var ee;const b=T.tile;if(!b||b.getState()!==pe.LOADED)return;const E=b.getSize(),w=this.gutter_;let S;const v=wl(b.getData());v?S=v:(t=!0,S=A_(vl(b.getData())));const R=[E[0]+2*w,E[1]+2*w],C=S instanceof Float32Array,F=R[0]*R[1],N=C?Float32Array:Uint8ClampedArray,D=new N(S.buffer),A=N.BYTES_PER_ELEMENT,M=A*D.length/F,O=D.byteLength/R[1],$=Math.floor(O/A/R[0]),V=this.sourceTileGrid_.getTileCoordExtent(b.tileCoord);V[0]+=T.offset,V[2]+=T.offset;const H=(ee=this.clipExtent_)==null?void 0:ee.slice();H&&(H[0]+=T.offset,H[2]+=T.offset),e.push({extent:V,clipExtent:H,data:D,dataType:N,bytesPerPixel:M,pixelSize:R,bandCount:$})}),this.sourceTiles_.length=0,e.length===0){this.state=pe.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(r),s=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],a=Math.round(s*this.pixelRatio_),l=Math.round(o*this.pixelRatio_),u=this.targetTileGrid_.getResolution(r),c=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=e[0].bandCount,p=new e[0].dataType(f*a*l),d=BC(a,l,Ad,{premultipliedAlpha:!1,antialias:!1});let g;const m=d.RGBA;let y;e[0].dataType==Float32Array?(y=d.FLOAT,d.getExtension("WEBGL_color_buffer_float"),d.getExtension("OES_texture_float"),d.getExtension("EXT_float_blend"),g=d.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=d.UNSIGNED_BYTE,g=this.interpolate);const _=4,x=Math.ceil(f/_);for(let T=x-1;T>=0;--T){const b=[];for(let N=0,D=e.length;N<D;++N){const A=e[N],M=A.pixelSize,O=M[0],$=M[1],V=new A.dataType(_*O*$),H=A.data;let ee=T*_;for(let J=0,G=V.length;J<G;J+=_)V[J]=H[ee],V[J+1]=H[ee+1],V[J+2]=H[ee+2],V[J+3]=H[ee+3],ee+=f;const fe=d.createTexture();d.bindTexture(d.TEXTURE_2D,fe),g?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texImage2D(d.TEXTURE_2D,0,m,O,$,0,m,y,V),b.push({extent:A.extent,clipExtent:A.clipExtent,texture:fe,width:O,height:$})}const{framebuffer:E,width:w,height:S}=zC(d,s,o,this.pixelRatio_,c,u,h,this.triangulation_,b,this.gutter_,y,this.renderEdges_,g),v=w,R=S*_,C=new e[0].dataType(v*R);d.bindFramebuffer(d.FRAMEBUFFER,E),d.readPixels(0,0,w,S,d.RGBA,y,C);let F=T*_;for(let N=0,D=C.length;N<D;N+=_){const A=(v-1-(N/R|0))*R+N%R;p[F]=C[A],p[F+1]=C[A+1],p[F+2]=C[A+2],p[F+3]=C[A+3],F+=f}}if(kC(d),Ad.push(d.canvas),t){const T=ln(s,o),b=new ImageData(p,s);T.putImageData(b,0,0),this.reprojData_=T.canvas}else this.reprojData_=p;this.reprojSize_=[a,l],this.state=pe.LOADED,this.changed()}load(){if(this.state!==pe.IDLE&&this.state!==pe.ERROR)return;this.state=pe.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const r=t.getState();if(r!==pe.IDLE&&r!==pe.LOADING)return;e++;const i=Or(t,Ft.CHANGE,()=>{const s=t.getState();(s==pe.LOADED||s==pe.ERROR||s==pe.EMPTY)&&(go(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==pe.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(go),this.sourcesListenerKeys_=null}}class Ca extends Au{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let r=e.tileGrid;r===void 0&&t&&(r=ws({extent:Ts(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:r,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?ur(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?ur(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||ro(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,r,i,s,o){const a=this.tileGrid||this.getTileGridForProjection(s||i),l=Math.max.apply(null,a.getResolutions().map((d,g)=>{const m=ur(a.getTileSize(g)),y=this.getTileSize(g);return Math.max(y[0]/m[0],y[1]/m[1])})),u=this.getTileGridForProjection(i),c=[e,t,r],h=this.getTileCoordForTileUrlFunction(c,i),f=Object.assign({sourceProj:s||i,sourceTileGrid:a,targetProj:i,targetTileGrid:u,tileCoord:c,wrappedTileCoord:h,pixelRatio:l,gutter:this.gutter_,getTileFunction:(d,g,m,y)=>this.getTile(d,g,m,y,void 0,o),transformMatrix:this.transformMatrix},this.tileOptions),p=new $C(f);return p.key=this.getKey(),p}getTile(e,t,r,i,s,o){var E;const a=this.getProjection();if(s&&(a&&!ro(a,s)||this.transformMatrix))return this.getReprojTile_(e,t,r,s,a,o);const l=this.getTileSize(e),u=this.loader_,c=new AbortController,h={signal:c.signal,crossOrigin:this.crossOrigin_},f=this.getTileCoordForTileUrlFunction([e,t,r]);if(!f)return null;const p=this.getKey(),d=I_(this,p,e,t,r);if(o&&o.containsKey(d))return o.get(d);const g=f[0],m=f[1],y=f[2],_=(E=this.getTileGrid())==null?void 0:E.getFullTileRange(g);_&&(h.maxY=_.getHeight()-1);function x(){return F_(function(){return u(g,m,y,h)})}const T=Object.assign({tileCoord:[e,t,r],loader:x,size:l,controller:c},this.tileOptions),b=new Tu(T);return b.key=this.getKey(),b.addEventListener(Ft.CHANGE,this.handleTileChange_),o==null||o.set(d,b),b}handleTileChange_(e){const t=e.target,r=Te(t),i=t.getState();let s;i==pe.LOADING?(this.tileLoadingKeys_[r]=!0,s=Ba.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=i==pe.ERROR?Ba.TILELOADERROR:i==pe.LOADED?Ba.TILELOADEND:void 0),s&&this.dispatchEvent(new C_(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ro(t,e))&&!this.transformMatrix)return this.tileGrid;const r=Te(e);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=L_(e)),this.tileGridForProjection_[r]}setTileGridForProjection(e,t){const r=we(e);if(r){const i=Te(r);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function jC(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function VC(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=At;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const Id="STATISTICS_MAXIMUM",Cd="STATISTICS_MINIMUM",yl=256;let _l;function XC(){return _l||(_l=new bm),_l}function ZC(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function WC(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function HC(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}function qC(n){const e=n.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let r=we(t);if(!r){const i=wh(e.ProjLinearUnitsGeoKey);i&&(r=new vh({code:t,units:i}))}return r}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let r=we(t);if(!r){const i=wh(e.GeogAngularUnitsGeoKey);i&&(r=new vh({code:t,units:i}))}return r}return null}function YC(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function KC(n,e){let t;return n.blob?t=vm(n.blob):n.overviews?t=Sm(n.url,n.overviews,e):t=wm(n.url,e),t.then(YC)}function Vi(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)Vi(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function JC(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function QC(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class dy extends Ca{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=KC(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){r.configure_(s)}).catch(function(s){ns(s),r.error_=s,r.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=qC(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,u,c,h,f,p]=s,d=Ji(Ji([1/Math.sqrt(o*o+c*c),0,0,-1/Math.sqrt(a*a+h*h),u,p],[o,c,a,h,0,0]),[1,0,0,1,-u,-p]);this.transformMatrix=d,this.addAlpha_=!0;break}}}configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let c=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(v=>{jC(v)?_.push(v):y.push(v)});const x=y.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let T,b;const E=new Array(x),w=new Array(x),S=new Array(x);l[m]=new Array(x),u[m]=new Array(x);for(let v=0;v<x;++v){const R=y[v],C=R.getGDALNoData();u[m][v]=R.getGDALMetadata(0),l[m][v]=C;const F=this.sourceInfo_[m].bands;a[m]=F?F.length:R.getSamplesPerPixel();const N=x-(v+1);T||(T=ZC(R)),b||(b=WC(R));const D=HC(R,y[0]);S[N]=D[0];const A=[R.getTileWidth(),R.getTileHeight()];A[0]!==A[1]&&A[1]<yl&&(A[0]=yl,A[1]=yl),E[N]=A;const M=D[0]/Math.abs(D[1]);w[N]=[A[0],A[1]/M]}if(t?Er(t,T,t):t=T,!r)r=b;else{const v=`Origin mismatch for source ${m}, got [${b}] but expected [${r}]`;Vi(r,b,0,v,this.viewRejector)}if(!o)o=S,this.resolutionFactors_[m]=1;else{o.length-c>S.length&&(c=o.length-S.length);const v=o[o.length-1]/S[S.length-1];this.resolutionFactors_[m]=v;const R=S.map(F=>F*=v),C=`Resolution mismatch for source ${m}, got [${R}] but expected [${o}]`;Vi(o.slice(c,o.length),R,.02,C,this.viewRejector)}i?Vi(i.slice(c,i.length),w,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=w,s?Vi(s.slice(c,s.length),E,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=E,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let x=0;x<_.length;++x)if(y[_[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let m=0;m<h;++m)f+=a[m];this.bandCount=f;const p=new Ko({extent:t,minZoom:c,origin:r,resolutions:o,tileSizes:i});this.tileGrid=p,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const d=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=rs(_t(),this.transformMatrix.slice()),y=M_(_=>Ur(m,_));g=hi(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:N_(nn(g),this.projection),extent:O_(g,this.projection),zoom:d})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,u=this.sourceInfo_,c=XC();for(let h=0;h<o;++h){const f=u[h],p=this.resolutionFactors_[h],d=[Math.round(t*(s[0]*p)),Math.round(r*(s[1]*p)),Math.round((t+1)*(s[0]*p)),Math.round((r+1)*(s[1]*p))],g=this.sourceImagery_[h][e];let m;f.bands&&(m=f.bands.map(function(b){return b-1}));let y;"nodata"in f&&f.nodata!==null?y=f.nodata:m?y=m.map(function(b){return l[h][b]}):y=l[h];const _={window:d,width:s[0],height:s[1],samples:m,fillValue:y,pool:c,interleave:!1,signal:i.signal};VC(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const x=o+h,T=this.sourceMasks_[h][e];if(!T){a[x]=Promise.resolve(null);continue}a[x]=T.readRasters({window:d,width:s[0],height:s[1],samples:[0],pool:c,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw ns(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,c=this.addAlpha_,h=e[0]*e[1],f=h*o;let p;u?p=new Uint8Array(f):p=new Float32Array(f);let d=0;for(let g=0;g<h;++g){let m=c;for(let y=0;y<s;++y){const _=i[y];let x=_.min,T=_.max,b,E;if(u){const w=r[y][0];x===void 0&&(w&&Cd in w?x=parseFloat(w[Cd]):x=JC(t[y][0])),T===void 0&&(w&&Id in w?T=parseFloat(w[Id]):T=QC(t[y][0])),b=255/(T-x),E=-x*b}for(let w=0;w<a[y];++w){const S=t[y][w][g];let v;if(u?v=Ve(b*S+E,0,255):v=S,!c)p[d]=v;else{let R=_.nodata;if(R===void 0){let F;_.bands?F=_.bands[w]-1:F=w,R=l[y][F]}const C=isNaN(R);(!C&&S!==R||C&&!isNaN(S))&&(m=!1,p[d]=v)}d++}if(!m){const w=s+y,S=t[w];S&&!S[0][g]&&(m=!0)}}c&&(m||(p[d]=255),d++)}return p}}dy.prototype.getView;const eL=22;class tL extends zr{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const r={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(r.imageFormat=e.imageFormat),e.scale&&(r.scale=e.scale),t&&(r.highDpi=!0),e.layerTypes&&(r.layerTypes=e.layerTypes),e.styles&&(r.styles=e.styles),e.overlay===!0&&(r.overlay=!0),e.apiOptions&&(r.apiOptions=e.apiOptions),this.sessionTokenRequest_=r,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_;const i=e.url||"https://tile.googleapis.com/";this.createSessionUrl_=i+"v1/createSession",this.tileUrl_=i+"v1/2dtiles",this.attributionUrl_=i+"tile/v1/viewport",this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=this.createSessionUrl_+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},r=await this.fetchSessionToken(e,t);if(!r.ok){try{const f=await r.json();this.error_=new Error(f.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await r.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=ws({extent:Ts(this.getProjection()),maxZoom:eL,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_,u=this.tileUrl_;this.tileUrlFunction=function(f,p,d){const g=f[0],m=f[1],y=f[2];return`${u}/${g}/${m}/${y}?session=${a}&key=${l}`};const c=parseInt(i.expiry,10)*1e3,h=Math.max(c-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[un.ANIMATING]||e.viewHints[un.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,r]=Sh(D_(e.extent),e.viewState.projection),[i,s]=Sh(G_(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${r}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const u=this.sessionTokenValue_,c=this.apiKey_,f=`${this.attributionUrl_}?session=${u}&key=${c}&${l}`;return this.previousViewportAttribution_=await fetch(f).then(p=>p.json()).then(p=>p.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let py=class extends Eu{constructor(e,t,r,i,s,o,a){super(t,r,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==pe.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const r=ln(t[0],t[1]);return r.drawImage(e,0,0),this.zoomifyImage_=r.canvas,r.canvas}return e}};class rL extends zr{constructor(e){const t=e.size,r=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||Al;let u=l*i;switch(r){case"default":for(;s>u||o>u;)a.push([Math.ceil(s/u),Math.ceil(o/u)]),u+=u;break;case"truncated":let E=s,w=o;for(;E>u||w>u;)a.push([Math.ceil(E/u),Math.ceil(w/u)]),E>>=1,w>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const c=[i],h=[0];for(let E=1,w=a.length;E<w;E++)c.push(i<<E),h.push(a[E-1][0]*a[E-1][1]+h[E-1]);c.reverse();const f=new Ko({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:c});let p=e.url;p&&!p.includes("{TileGroup}")&&!p.includes("{tileIndex}")&&(p+="{TileGroup}/{z}-{x}-{y}.jpg");const d=rp(p);let g=l*i;function m(E){return function(w,S,v){if(!w)return;const R=w[0],C=w[1],F=w[2],N=C+F*a[R][0],D=(N+h[R])/g|0,A={z:R,x:C,y:F,tileIndex:N,TileGroup:"TileGroup"+D};return E.replace(/\{(\w+?)\}/g,function(M,O){return A[O]})}}const y=Ru(d.map(m)),_=py.bind(null,ur(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:f,tileUrlFunction:y,transition:e.transition}),this.zDirection=e.zDirection;const x=f.getTileCoordForCoordAndResolution(nn(f.getExtent()),c[c.length-1]),T=y(x,1,null),b=new Image;b.addEventListener("error",()=>{g=l,this.changed()}),b.src=T}}function Ui(n){return n.toLocaleString("en",{maximumFractionDigits:10})}class nL extends zr{constructor(e){const t=e||{};let r=t.url||"";r=r+(r.lastIndexOf("/")===r.length-1||r===""?"":"/");const i=t.version||et.VERSION2,s=t.sizes||[],o=t.size;Wt(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],u=t.tileSize,c=t.tilePixelRatio||1,h=t.format||"jpg",f=t.quality||(t.version==et.VERSION1?"native":"default");let p=t.resolutions||[];const d=t.supports||[],g=t.extent||[0,-l,a,0],m=s!=null&&Array.isArray(s)&&s.length>0,y=u!==void 0&&(typeof u=="number"&&Number.isInteger(u)&&u>0||Array.isArray(u)&&u.length>0),_=d!=null&&Array.isArray(d)&&(d.includes("regionByPx")||d.includes("regionByPct"))&&(d.includes("sizeByWh")||d.includes("sizeByH")||d.includes("sizeByW")||d.includes("sizeByPct"));let x,T,b;if(p.sort(function(v,R){return R-v}),y||_)if(u!=null&&(typeof u=="number"&&Number.isInteger(u)&&u>0?(x=u,T=u):Array.isArray(u)&&u.length>0&&((u.length==1||u[1]==null&&Number.isInteger(u[0]))&&(x=u[0],T=u[0]),u.length==2&&(Number.isInteger(u[0])&&Number.isInteger(u[1])?(x=u[0],T=u[1]):u[0]==null&&Number.isInteger(u[1])&&(x=u[1],T=u[1])))),(x===void 0||T===void 0)&&(x=Al,T=Al),p.length==0){b=Math.max(Math.ceil(Math.log(a/x)/Math.LN2),Math.ceil(Math.log(l/T)/Math.LN2));for(let v=b;v>=0;v--)p.push(Math.pow(2,v))}else{const v=Math.max(...p);b=Math.round(Math.log(v)/Math.LN2)}else if(x=a,T=l,p=[],m){s.sort(function(R,C){return R[0]-C[0]}),b=-1;const v=[];for(let R=0;R<s.length;R++){const C=a/s[R][0];if(p.length>0&&p[p.length-1]==C){v.push(R);continue}p.push(C),b++}if(v.length>0)for(let R=0;R<v.length;R++)s.splice(v[R]-R,1)}else p.push(1),s.push([a,l]),b=0;const E=new Ko({tileSize:[x,T],extent:g,origin:Pl(g),resolutions:p}),w=function(v,R,C){let F,N;const D=v[0];if(D>b)return;const A=v[1],M=v[2],O=p[D];if(!(A===void 0||M===void 0||O===void 0||A<0||Math.ceil(a/O/x)<=A||M<0||Math.ceil(l/O/T)<=M)){if(_||y){const $=A*x*O,V=M*T*O;let H=x*O,ee=T*O,fe=x,J=T;if($+H>a&&(H=a-$),V+ee>l&&(ee=l-V),$+x*O>a&&(fe=Math.floor((a-$+O-1)/O)),V+T*O>l&&(J=Math.floor((l-V+O-1)/O)),$==0&&H==a&&V==0&&ee==l)F="full";else if(!_||d.includes("regionByPx"))F=$+","+V+","+H+","+ee;else if(d.includes("regionByPct")){const G=Ui($/a*100),Ae=Ui(V/l*100),Ie=Ui(H/a*100),be=Ui(ee/l*100);F="pct:"+G+","+Ae+","+Ie+","+be}i==et.VERSION3&&(!_||d.includes("sizeByWh"))?N=fe+","+J:!_||d.includes("sizeByW")?N=fe+",":d.includes("sizeByH")?N=","+J:d.includes("sizeByWh")?N=fe+","+J:d.includes("sizeByPct")&&(N="pct:"+Ui(100/O))}else if(F="full",m){const $=s[D][0],V=s[D][1];i==et.VERSION3?$==a&&V==l?N="max":N=$+","+V:$==a?N="full":N=$+","}else N=i==et.VERSION3?"max":"full";return r+F+"/"+N+"/0/"+f+"."+h}},S=py.bind(null,ur(u||256).map(function(v){return v*c}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:S,tileGrid:E,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:w,transition:t.transition}),this.zDirection=t.zDirection}}function gy(n,e,t,r,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/r,l=[Rh(xt(e)/a,Ph),Rh(cr(e)/a,Ph)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*r:90*r);const u=n.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return mo(u,s)}function iL(n){const e=n.load?n.load:bi,t=we(n.projection||"EPSG:3857"),r=n.ratio??1.5,i=n.crossOrigin??null;return function(s,o,a){a=n.hidpi?a:1;const l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,n.params),s=np(s,o,a,r);const u=gy(n.url,s,o,a,t,l),c=new Image;return c.crossOrigin=i,e(c,u).then(h=>{const f=xt(s)/h.width*a;return{image:h,extent:s,resolution:f,pixelRatio:a}})}}class sL extends zn{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Iu,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=iL({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),bi(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class oL extends zn{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,r,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==r&&ao(s.getExtent(),e))return s;e=e.slice(),ep(e,this.ratio_);const o=xt(e)/t,a=cr(e)/t,l=[o*r,a*r],u=this.canvasFunction_.call(this,e,t,r,l,i);return u&&(s=new lc(e,t,r,u)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function aL(n,e,t,r){const i=xt(n),s=cr(n),o=e[0],a=e[1],l=.0254/r;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function lL(n,e,t,r,i,s,o){const a=aL(t,r,s,o),l=nn(t),u={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(u,e),mo(n,u)}function uL(n){const e=n.load||bi,t=n.useOverlay??!1,r=n.metersPerUnit||1,i=n.displayDpi||96,s=n.ratio??1,o=n.crossOrigin??null;return function(a,l,u){const c=new Image;c.crossOrigin=o,a=np(a,l,u,s);const h=xt(a)/l,f=cr(a)/l,p=[h*u,f*u],d=lL(n.url,n.params,a,p,t,r,i);return e(c,d).then(g=>({image:g,extent:a,pixelRatio:u}))}}class cL extends zn{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Iu,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=uL({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),bi(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}function hL(n){const e=n.load||bi,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=xt(t)/s.width,a=cr(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class fL extends zn{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:Iu;super({attributions:e.attributions,interpolate:e.interpolate,projection:we(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Qd(this.imageExtent_,void 0,1,hL({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),bi(i))})),this.image.addEventListener(Ft.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return ci(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const dL=new Error("Image failed to load");function my(n,e,t,r,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(dL)),a.src=ip(n,e,t,r,i.maxY)})}function Ld(n){return function(e,t,r,i){const s=U_(n,e,t,r);return my(s,e,t,r,i)}}function pL(n){return function(e,t,r,i){const s=n(e,t,r,i);return my(s,e,t,r,i)}}function Fd(n){let e;if(Array.isArray(n))e=Ld(n);else if(typeof n=="string"){const t=rp(n);e=Ld(t)}else if(typeof n=="function")e=pL(n);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let Md=0;function Od(n){return Array.isArray(n)?n.join(`
`):typeof n=="string"?n:(++Md,"url-function-key-"+Md)}class yy extends Ca{constructor(e){e=e||{};let t=e.loader,r;e.url&&(t=Fd(e.url),r=Od(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:r,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=Fd(e);this.setLoader(t),this.setKey(Od(e)),this.getState()!=="ready"&&this.setState("ready")}}function ch(n,e,t,r){const i=document.createElement("script"),s="olc_"+Te(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class gL extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class mL extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function _y(n){return new Promise(function(e,t){function r(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(u){const c="Error parsing response text as JSON: "+u.message;t(new Error(c));return}e(l);return}t(new gL(a))}function i(o){t(new mL(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",r),s.addEventListener("error",i),s.open("GET",n),s.setRequestHeader("Accept","application/json"),s.send()})}function xy(n,e){return e.includes("://")?e:new URL(e,n).href}const yL={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},_L={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function by(n,e){if(!e.length)return n;const t=new URL(n,"file:/");if(t.pathname.split("/").includes("collections"))return ns('The "collections" query parameter cannot be added to collection endpoints'),n;const r=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",r);const i=n.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function xL(n,e,t){let r,i;for(let s=0;s<n.length;++s){const o=n[s];if(o.rel==="item"){if(o.type===e){r=o.href;break}(yL[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return t&&(r=by(r,t)),r}function bL(n,e,t,r){let i,s;const o={};for(let a=0;a<n.length;++a){const l=n[a];if(o[l.type]=l.href,l.rel==="item"){if(l.type===e){i=l.href;break}_L[l.type]&&(s=l.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const l=t[a];if(o[l]){i=o[l];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return r&&(i=by(i,r)),i}function Nd(n,e,t,r){let i=n.projection;if(!i&&(typeof e.crs=="string"?i=we(e.crs):"uri"in e.crs&&(i=we(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(E=>E.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),l=e.tileMatrices,u={};for(let E=0;E<l.length;++E){const w=l[E];u[w.id]=w}const c={},h=[];if(r)for(let E=0;E<r.length;++E){const w=r[E],S=w.tileMatrix;h.push(S),c[S]=w}else for(let E=0;E<l.length;++E){const w=l[E].id;h.push(w)}const f=h.length,p=new Array(f),d=new Array(f),g=new Array(f),m=new Array(f),y=[-1/0,-1/0,1/0,1/0];for(let E=0;E<f;++E){const w=h[E],S=u[w],v=S.pointOfOrigin;a?p[E]=[v[1],v[0]]:p[E]=v,d[E]=S.cellSize,g[E]=[S.matrixWidth,S.matrixHeight],m[E]=[S.tileWidth,S.tileHeight];const R=c[w];if(R){const C=S.cellSize*S.tileWidth,F=p[E][0]+R.minTileCol*C,N=p[E][0]+(R.maxTileCol+1)*C,D=S.cellSize*S.tileHeight,A=S.cornerOfOrigin==="bottomLeft";let M,O;A?(M=p[E][1]+R.minTileRow*D,O=p[E][1]+(R.maxTileRow+1)*D):(M=p[E][1]-(R.maxTileRow+1)*D,O=p[E][1]-R.minTileRow*D),Er(y,[F,M,N,O],y)}}const _=new Ko({origins:p,resolutions:d,sizes:g,tileSizes:m,extent:r?y:void 0}),x=n.context,T=n.url;function b(E,w,S){if(!E)return;const v=h[E[0]],R=u[v],C=R.cornerOfOrigin==="bottomLeft",F={tileMatrix:v,tileCol:E[1],tileRow:C?-E[2]-1:E[2]};if(r){const D=c[R.id];if(F.tileCol<D.minTileCol||F.tileCol>D.maxTileCol||F.tileRow<D.minTileRow||F.tileRow>D.maxTileRow)return}Object.assign(F,{z:F.tileMatrix,x:F.tileCol,y:F.tileRow},x);const N=t.replace(/\{(\w+?)\}/g,function(D,A){return F[A]});return xy(T,N)}return{grid:_,projection:i,urlTemplate:t,urlFunction:b}}function EL(n,e){const t=e.tileMatrixSetLimits;let r;if(e.dataType==="map")r=xL(e.links,n.mediaType,n.collections);else if(e.dataType==="vector")r=bL(e.links,n.mediaType,n.supportedMediaTypes,n.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return Nd(n,e.tileMatrixSet,r,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=xy(n.url,s);return _y(o).then(function(a){return Nd(n,a,r,t)})}function Ey(n){return _y(n.url).then(function(e){return EL(n,e)})}class TL extends zr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};Ey(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){ns(e),this.setState("error")}}class wL extends B_{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};Ey(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){ns(e),this.setState("error")}}function Ty(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const f=new Array(a);for(let d=0;d<a;++d)f[d]=new ImageData(new Uint8ClampedArray(t[d]),s,o);return n(f,r).data.buffer}const u=new Uint8ClampedArray(l),c=new Array(a),h=new Array(a);for(let f=0;f<a;++f)c[f]=new Uint8ClampedArray(t[f]),h[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let d=0;d<a;++d){const g=c[d];h[d][0]=g[f],h[d][1]=g[f+1],h[d][2]=g[f+2],h[d][3]=g[f+3]}const p=n(h,r);u[f]=p[0],u[f+1]=p[1],u[f+2]=p[2],u[f+3]=p[3]}return u.buffer}}function vL(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+Ty.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function SL(n,e){const t=Ty(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}class RL extends qd{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=vL(e,this.onWorkerMessage_.bind(this,i));else r[0]=SL(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,c=[];for(let h=0,f=i.length;h<f;++h)c.push(i[h].slice(u,u+a));this.workers_[l].postMessage({buffers:c,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},c)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,u=a*o;r.set(new Uint8ClampedArray(l),u),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const Dd={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Gd extends z_{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}}class wy extends zn{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=IL(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(Ft.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new k_(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:_t(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:AL(this.layers_),pixelRatio:1,pixelToCoordinateTransform:_t(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Te(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],u=l instanceof Cu?l:l.getSource();if(!u)continue;const c=(s=u.getAttributions())==null?void 0:s(r);typeof c=="string"?i.push(c):c!==void 0&&i.push(...c)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new RL({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=nn(e);i.size[0]=Math.ceil(xt(e)/t),i.size[1]=Math.ceil(cr(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Qi(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=PL(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new Gd(Dd.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Qi(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(xt(s)/o),u=Math.round(cr(s)/o);a=ln(l,u),this.renderedImageCanvas_=new lc(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Gd(Dd.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}wy.prototype.dispose;let xn=null;function PL(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!xn)xn=ln(r,i,void 0,{willReadFrequently:!0});else{const a=xn.canvas;a.width!==r||a.height!==i?xn=ln(r,i,void 0,{willReadFrequently:!0}):xn.clearRect(0,0,r,i)}return xn.drawImage(o,0,0,r,i),xn.getImageData(0,0,r,i)}function AL(n){return n.map(function(e){return e.getLayerState()})}function IL(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=CL(n[r]);return t}function CL(n){let e;return n instanceof Cu?n instanceof Au?e=new $_({source:n}):n instanceof zn&&(e=new j_({source:n})):e=n,e}const LL='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',FL='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',ML='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',OL={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_toner_dark:{extension:"png"},stamen_toner_blacklite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},NL={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_dark:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_blacklite:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class DL extends tp{constructor(e){const t=e.layer.indexOf("-"),r=t==-1?e.layer:e.layer.slice(0,t),i=NL[r]||{minZoom:0,maxZoom:20,retina:!0},s=OL[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,u=[LL,FL,V_];e.layer.startsWith("stamen_")&&u.splice(1,0,ML),super({attributions:u,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class GL extends zr{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Es(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const u=X_(Z_(e),a.length);l=a[u]}return gy(l,r,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}setParams(e){this.params_=Object.assign({},e),this.setKey(this.getKeyForParams_())}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=ur(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=W_(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,r,a)}}class UL extends yy{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",r=e.source,i=e.color||"grey";super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:r!==void 0?r.getWrapX():void 0});const s=()=>{var a;this.projection=e.projection!==void 0?we(e.projection):r!==void 0?r.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:r!==void 0?r.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:r!==void 0?r.zDirection:this.zDirection,r instanceof Ca&&(this.transformMatrix=((a=r.transformMatrix)==null?void 0:a.slice())||null);const o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((l,u)=>ur(o.getTileSize(u)).map(c=>Math.max(Math.floor(c),1)))),this.setLoader((l,u,c,h)=>{const f=ip(t,l,u,c,h.maxY),[p,d]=this.getTileSize(l),g=ln(p,d);return g.strokeStyle=i,g.strokeRect(.5,.5,p+.5,d+.5),g.fillStyle=i,g.strokeStyle="white",g.textAlign="center",g.textBaseline="middle",g.font="24px sans-serif",g.lineWidth=4,g.strokeText(f,p/2,d/2,p),g.fillText(f,p/2,d/2,p),Promise.resolve(g.canvas)}),this.setState("ready")};if(r===void 0||r.getState()==="ready")s();else{const o=()=>{r.getState()==="ready"&&(r.removeEventListener(Ft.CHANGE,o),s())};r.addEventListener(Ft.CHANGE,o)}}}class BL extends zr{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:we("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)ch(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=we("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const u=Pu(t,r);i=hi(e.bounds,u)}const s=Ts(r),o=e.minzoom||0,a=e.maxzoom||22,l=ws({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=sp(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(c){return ci(u,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class kL extends Y_{constructor(e,t,r,i,s,o){super(e,t),this.src_=r,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),r=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-r)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,r){this.state==pe.EMPTY&&r===!0?(this.state=pe.IDLE,K_(this,Ft.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):r===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=pe.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=pe.LOADED,this.changed()}loadInternal_(){if(this.state==pe.IDLE)if(this.state=pe.LOADING,this.jsonp_)ch(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(r)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(pe.EMPTY)}}class zL extends Au{constructor(e){if(super({projection:we("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=H_,this.template_=void 0,this.jsonp_=e.jsonp||!1,this.tileCache_=new Yd(512),e.url)if(this.jsonp_)ch(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,r,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s),a=this.getTile(o[0],o[1],o[2],1,this.getProjection());a.getState()==pe.IDLE&&a.load(),a.forDataAtCoordinate(e,r,i)}else i===!0?setTimeout(function(){r(null)},0):r(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=we("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const c=Pu(t,r);i=hi(e.bounds,c)}const s=Ts(r),o=e.minzoom||0,a=e.maxzoom||22,l=ws({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const u=e.grids;if(!u){this.setState("error");return}if(this.tileUrlFunction_=sp(u,l),e.attribution){const c=i!==void 0?i:s;this.setAttributions(function(h){return ci(c,h.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,r,i,s){const o=[e,t,r],a=this.getTileCoordForTileUrlFunction(o,s),l=this.tileUrlFunction_(a,i,s),u=`${this.getKey()},${q_(e,t,r)}`;if(this.tileCache_.containsKey(u))return this.tileCache_.get(u);this.tileCache_.expireCache();const c=new kL(o,l!==void 0?pe.IDLE:pe.EMPTY,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache_.set(u,c),c}}class $L extends _u{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const r=t.getGeometry();return Wt(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,r){var i;(i=this.source)==null||i.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ft.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ft.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const r=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Es(),t=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let s=0,o=r.length;s<o;s++){const a=r[s];if(!(Te(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();J_(u,e),vu(e,t,e);const c=this.source.getFeaturesInExtent(e).filter(function(h){const f=Te(h);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,t){const r=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Q_(r,l.getCoordinates()):e.splice(a,1)}e0(r,1/e.length);const i=nn(t),s=this.interpolationRatio,o=new tr([r[0]*(1-s)+i[0]*s,r[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Mt({geometry:o,features:e})}}class ko extends $L{constructor(e={}){super({...e,createCluster:ko.defaultCreateCluster,geometryFunction:ko.defaultGeometryFunction})}static defaultCreateCluster(e,t){const r=t.length===1&&t[0].getGeometry()instanceof Fn?t[0].getGeometry():e,i=new Mt({geometry:r,features:t});if(t.length===1){const s=t[0];for(const o in s.getProperties())o!=="geometry"&&i.set(o,s.get(o))}return i}static defaultGeometryFunction(e){const t=e&&e.getGeometry();return t instanceof tr?t:t instanceof Fn?t.getInteriorPoint():null}}class jL extends zr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new ng().read(e),s=t0(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Ru(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?mo(e,r):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in r?r[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t==="KVP"?l=mo(l,a):l=l.replace(/\{(\w+?)\}/g,(u,c)=>a[c]),l}}}const Nr=new Uint8Array([102,103,98,3,102,103,98,0]),Vt=4,Bi=4,ki=4,Ds=4,Kr=new Int32Array(2),Ud=new Float32Array(Kr.buffer),Bd=new Float64Array(Kr.buffer),eo=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var cu;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(cu||(cu={}));class hr{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new hr(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Kr[0]=this.readInt32(e),Ud[0]}readFloat64(e){return Kr[eo?0:1]=this.readInt32(e),Kr[eo?1:0]=this.readInt32(e+4),Bd[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Ud[0]=t,this.writeInt32(e,Kr[0])}writeFloat64(e,t){Bd[0]=t,this.writeInt32(e,Kr[eo?0:1]),this.writeInt32(e+4,Kr[eo?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Bi+ki)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<ki;t++)e+=String.fromCharCode(this.readInt8(this.position_+Bi+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=Bi;const i=this.bytes_.subarray(e,e+r);return t===cu.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Bi}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=ki)throw new Error("FlatBuffers: file identifier must be length "+ki);for(let t=0;t<ki;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Bi+t))return!1;return!0}createScalarList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s)}return r}createObjList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s.unpack())}return r}}var Se,yt=((Se={})[Se.Byte=0]="Byte",Se[Se.UByte=1]="UByte",Se[Se.Bool=2]="Bool",Se[Se.Short=3]="Short",Se[Se.UShort=4]="UShort",Se[Se.Int=5]="Int",Se[Se.UInt=6]="UInt",Se[Se.Long=7]="Long",Se[Se.ULong=8]="ULong",Se[Se.Float=9]="Float",Se[Se.Double=10]="Double",Se[Se.String=11]="String",Se[Se.Json=12]="Json",Se[Se.DateTime=13]="DateTime",Se[Se.Binary=14]="Binary",Se);class ut{constructor(){me(this,"bb",null);me(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new ut).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Ds),(t||new ut).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):yt.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,yt.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,i,s,o,a,l,u,c,h,f){return ut.startColumn(e),ut.addName(e,t),ut.addType(e,r),ut.addTitle(e,i),ut.addDescription(e,s),ut.addWidth(e,o),ut.addPrecision(e,a),ut.addScale(e,l),ut.addNullable(e,u),ut.addUnique(e,c),ut.addPrimaryKey(e,h),ut.addMetadata(e,f),ut.endColumn(e)}}var he,Tt=((he={})[he.Unknown=0]="Unknown",he[he.Point=1]="Point",he[he.LineString=2]="LineString",he[he.Polygon=3]="Polygon",he[he.MultiPoint=4]="MultiPoint",he[he.MultiLineString=5]="MultiLineString",he[he.MultiPolygon=6]="MultiPolygon",he[he.GeometryCollection=7]="GeometryCollection",he[he.CircularString=8]="CircularString",he[he.CompoundCurve=9]="CompoundCurve",he[he.CurvePolygon=10]="CurvePolygon",he[he.MultiCurve=11]="MultiCurve",he[he.MultiSurface=12]="MultiSurface",he[he.Curve=13]="Curve",he[he.Surface=14]="Surface",he[he.PolyhedralSurface=15]="PolyhedralSurface",he[he.TIN=16]="TIN",he[he.Triangle=17]="Triangle",he);class It{constructor(){me(this,"bb",null);me(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new It).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Ds),(t||new It).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Tt.Unknown}parts(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new It).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Tt.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,i,s,o,a,l,u){return It.startGeometry(e),It.addEnds(e,t),It.addXy(e,r),It.addZ(e,i),It.addM(e,s),It.addT(e,o),It.addTm(e,a),It.addType(e,l),It.addParts(e,u),It.endGeometry(e)}}class er{constructor(){me(this,"bb",null);me(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new er).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Ds),(t||new er).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new It).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let r=this.bb.__offset(this.bb_pos,8);return r?(t||new ut).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,i){return er.startFeature(e),er.addGeometry(e,t),er.addProperties(e,r),er.addColumns(e,i),er.endFeature(e)}}function xl(n,e){let t=[];for(let r=0;r<n.length;r+=2){let i=[n[r],n[r+1]];e&&i.push(e[r>>1]),t.push(i)}return t}new TextEncoder;let kd=new TextDecoder;function VL(n,e){let t={};if(!e||e.length===0)return t;let r=n.propertiesArray();if(!r)return t;let i=new DataView(r.buffer,r.byteOffset),s=n.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],u=l.name;switch(l.type){case yt.Bool:t[u]=!!i.getUint8(o),o+=1;break;case yt.Byte:t[u]=i.getInt8(o),o+=1;break;case yt.UByte:t[u]=i.getUint8(o),o+=1;break;case yt.Short:t[u]=i.getInt16(o,!0),o+=2;break;case yt.UShort:t[u]=i.getUint16(o,!0),o+=2;break;case yt.Int:t[u]=i.getInt32(o,!0),o+=4;break;case yt.UInt:t[u]=i.getUint32(o,!0),o+=4;break;case yt.Long:t[u]=Number(i.getBigInt64(o,!0)),o+=8;break;case yt.ULong:t[u]=Number(i.getBigUint64(o,!0)),o+=8;break;case yt.Float:t[u]=i.getFloat32(o,!0),o+=4;break;case yt.Double:t[u]=i.getFloat64(o,!0),o+=8;break;case yt.DateTime:case yt.String:{let c=i.getUint32(o,!0);o+=4,t[u]=kd.decode(r.subarray(o,o+c)),o+=c;break}case yt.Json:{let c=i.getUint32(o,!0);o+=4;let h=kd.decode(r.subarray(o,o+c));t[u]=JSON.parse(h),o+=c;break}case yt.Binary:{let c=i.getUint32(o,!0);o+=4,t[u]=r.subarray(o,o+c),o+=c;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const hh=new Uint8Array(0);function XL(){return this._source.cancel()}function ZL(n,e){if(!n.length)return e;if(!e.length)return n;var t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function WL(){var n=this,e=n._array.subarray(n._index);return n._source.read().then(function(t){return n._array=hh,n._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:ZL(e,t.value)}})}function HL(n){if((n|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var r=new Uint8Array(n);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=hh,e._index=0,t>0?r.subarray(0,t):null):t+s.value.length>=n?(e._array=s.value,e._index=n-t,r.set(s.value.subarray(0,n-t),t),r):(r.set(s.value,t),t+=s.value.length,i())})}()}function qL(n){return typeof n.slice=="function"?n:new La(typeof n.read=="function"?n:n.getReader())}function La(n){this._source=n,this._array=hh,this._index=0}La.prototype.read=WL;La.prototype.slice=HL;La.prototype.cancel=XL;class Qt{constructor(){me(this,"bb",null);me(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Qt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Ds),(t||new Qt).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,i,s,o,a){return Qt.startCrs(e),Qt.addOrg(e,t),Qt.addCode(e,r),Qt.addName(e,i),Qt.addDescription(e,s),Qt.addWkt(e,o),Qt.addCodeString(e,a),Qt.endCrs(e)}}class zo{constructor(){me(this,"bb",null);me(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new zo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Ds),(t||new zo).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Tt.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new ut).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Qt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Tt.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function Fa(n){let e=zo.getRootAsHeader(n),t=e.featuresCount(),r=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}const Zo=class Zo{constructor(){me(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};me(Zo,"global",new Zo);let $o=Zo;const YL=40,KL=16;function Ma(n,e){e=Math.min(Math.max(+e,2),65535);let t=n,r=t;do r+=t=Math.ceil(t/e);while(t!==1);return 40*r}function JL(n,e){if(e<2)throw Error("Node size must be at least 2");if(n===0)throw Error("Number of items must be greater than 0");let t=n,r=t,i=[t];do r+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=r,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*vy(n,e,t,r){class i{constructor(p,d){me(this,"_level");me(this,"nodes");this._level=d,this.nodes=p}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(p){this.nodes[1]=p}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,u=JL(n,e),c=u[0][0],h=[new i([0,1],u.length-1)];for(;h.length!==0;){let f=h.shift(),p=f.startNodeIdx(),d=p>=c,g=(()=>{let[,_]=u[f.level()],x=Math.min(f.endNodeIdx()+e,_);return d&&x<_?x+1:x})(),m=g-p,y=new DataView(await r(40*p,40*m));for(let _=p;_<g;_++){let x=_-p,T=40*x;if(a<y.getFloat64(T+0,!0)||l<y.getFloat64(T+8,!0)||s>y.getFloat64(T+16,!0)||o>y.getFloat64(T+24,!0))continue;let b=y.getBigUint64(T+32,!0);if(d){let v=(()=>{if(_<n-1){let C=(x+1)*40;return y.getBigUint64(C+32,!0)-b}return null})(),R=_-c;yield[Number(b),R,Number(v)];continue}let E=$o.global.extraRequestThreshold()/40,w=h[h.length-1];if(w!==void 0&&w.level()===f.level()-1&&b<w.endNodeIdx()+E){w.extendEndNodeIdx(Number(b));continue}let S=(()=>{let v=f.level()-1;return new i([Number(b),Number(b)+1],v)})();w!==void 0&&(w.level(),S.level()),h.push(S)}}}class fh{constructor(e,t,r,i){me(this,"bytes");me(this,"header");me(this,"headerLength");me(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=r,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((o,a)=>Nr[a]===o))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(8,!0);if(t>10485760||t<8)throw Error("Invalid header size");let r=e.subarray(12,12+t),i=Fa(new hr(r)),s=Ma(i.featuresCount,i.indexNodeSize);return new fh(e,i,t,s)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=async(i,s)=>{let o=t+i;return this.bytes.slice(o,o+s).buffer};for await(let i of vy(this.header.featuresCount,this.header.indexNodeSize,e,r)){let[s,o]=i,a=this.readFeature(s);yield{id:o,feature:a}}}lengthBeforeTree(){return Nr.length+Vt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),r=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+r),s=new Uint8Array(r+Vt);s.set(i,Vt);let o=new hr(s);return o.setPosition(Vt),er.getRootAsFeature(o)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hu=function(n,e){return hu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},hu(n,e)};function QL(n,e){hu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function yi(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,[])).next())})}function hn(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Fi(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _s(n){return this instanceof _s?(this.v=n,this):new _s(n)}function e2(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{l(r[f](p))}catch(d){h(s[0][3],d)}}function l(f){f.value instanceof _s?Promise.resolve(f.value.v).then(u,c):h(s[0][2],f)}function u(f){a("next",f)}function c(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}var Sy=function(n){QL(e,n);function e(t){var r=n.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function n(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),n.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();function fu(n){n!=null&&typeof n.then=="function"&&n.then(Xo,Xo)}var bl=0,zd=1,Bn=2,jo=3,du=4,Vo=1024,Xo=function(){};function ui(n){var e=n.err,t=Promise.resolve(n.execution).then(function(r){if(e!=null)throw e;return r});return n.err=void 0,n.execution=t.then(function(){},function(){}),n.pending===void 0?t:n.pending.then(function(){return t})}function wn(n,e){var t=n.state>=jo;return Promise.resolve(e).then(function(r){return!t&&n.state>=du?ui(n).then(function(i){return{value:i,done:!0}}):{value:r,done:t}})}function dh(n,e){var t,r;if(!(n.state>=Bn))if(n.state=Bn,n.onnext(),n.onstop(),n.err==null&&(n.err=e),n.pushes.length===0&&(typeof n.buffer>"u"||n.buffer.empty))Yi(n);else try{for(var i=Fi(n.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}function Yi(n){var e,t;if(!(n.state>=jo)){n.state<Bn&&dh(n),n.state=jo,n.buffer=void 0;try{for(var r=Fi(n.nexts),i=r.next();!i.done;i=r.next()){var s=i.value,o=n.pending===void 0?ui(n):n.pending.then(function(){return ui(n)});s.resolve(wn(n,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}n.pushes=[],n.nexts=[]}}function $d(n){n.state>=du||(n.state<jo&&Yi(n),n.state=du)}function t2(n,e){if(fu(e),n.pushes.length>=Vo)throw new Sy("No more than "+Vo+" pending calls to push are allowed on a single repeater.");if(n.state>=Bn)return Promise.resolve(void 0);var t=n.pending===void 0?Promise.resolve(e):n.pending.then(function(){return e});t=t.catch(function(l){n.state<Bn&&(n.err=l),$d(n)});var r;if(n.nexts.length){var i=n.nexts.shift();i.resolve(wn(n,t)),n.nexts.length?r=Promise.resolve(n.nexts[0].value):typeof n.buffer<"u"&&!n.buffer.full?r=Promise.resolve(void 0):r=new Promise(function(l){return n.onnext=l})}else typeof n.buffer<"u"&&!n.buffer.full?(n.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(l){return n.pushes.push({resolve:l,value:t})});var s=!0,o={},a=r.catch(function(l){if(s)throw l});return o.then=function(l,u){return s=!1,Promise.prototype.then.call(r,l,u)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(r,l)},o.finally=r.finally.bind(r),n.pending=t.then(function(){return a}).catch(function(l){n.err=l,$d(n)}),o}function r2(n){var e=dh.bind(null,n),t=new Promise(function(r){return n.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function n2(n){if(!(n.state>=zd)){n.state=zd;var e=t2.bind(null,n),t=r2(n);n.execution=new Promise(function(r){return r(n.executor(e,t))}),n.execution.catch(function(){return dh(n)})}}var to=new WeakMap,Gs=function(){function n(e,t){to.set(this,{executor:e,buffer:t,err:void 0,state:bl,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Xo,onstop:Xo})}return n.prototype.next=function(e){fu(e);var t=to.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=Vo)throw new Sy("No more than "+Vo+" pending calls to next are allowed on a single repeater.");if(t.state<=bl&&n2(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=wn(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return r}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,wn(t,s.value)}else if(t.state>=Bn)return Yi(t),wn(t,ui(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},n.prototype.return=function(e){fu(e);var t=to.get(this);if(t===void 0)throw new Error("WeakMap error");return Yi(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),wn(t,ui(t))},n.prototype.throw=function(e){var t=to.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=bl||t.state>=Bn||typeof t.buffer<"u"&&!t.buffer.empty?(Yi(t),t.err==null&&(t.err=e),wn(t,ui(t))):this.next(Promise.reject(e))},n.prototype[Symbol.asyncIterator]=function(){return this},n.race=i2,n.merge=s2,n.zip=o2,n.latest=a2,n}();function Oa(n,e){var t,r,i=[],s=function(u){u!=null&&typeof u[Symbol.asyncIterator]=="function"?i.push(u[Symbol.asyncIterator]()):u!=null&&typeof u[Symbol.iterator]=="function"?i.push(u[Symbol.iterator]()):i.push(function(){return e2(this,arguments,function(){return hn(this,function(f){switch(f.label){case 0:return e.yieldValues?[4,_s(u)]:[3,3];case 1:return[4,f.sent()];case 2:f.sent(),f.label=3;case 3:return e.returnValues?[4,_s(u)]:[3,5];case 4:return[2,f.sent()];case 5:return[2]}})})}())};try{for(var o=Fi(n),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}function i2(n){var e=this,t=Oa(n,{returnValues:!0});return new Gs(function(r,i){return yi(e,void 0,void 0,function(){var s,o,a,l,u,c;return hn(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),l=void 0,u=0,c=function(){var f,p,d,g,m,y;return hn(this,function(_){switch(_.label){case 0:f=u;try{for(p=(m=void 0,Fi(t)),d=p.next();!d.done;d=p.next())g=d.value,Promise.resolve(g.next()).then(function(x){x.done?(i(),a===void 0&&(a=x)):u===f&&(u++,s(x))},function(x){return i(x)})}catch(x){m={error:x}}finally{try{d&&!d.done&&(y=p.return)&&y.call(p)}finally{if(m)throw m.error}}return[4,new Promise(function(x){return s=x})];case 1:return l=_.sent(),l===void 0?[3,3]:[4,r(l.value)];case 2:_.sent(),_.label=3;case 3:return[2]}})},h.label=2;case 2:return o?[3,4]:[5,c()];case 3:return h.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function s2(n){var e=this,t=Oa(n,{yieldValues:!0});return new Gs(function(r,i){return yi(e,void 0,void 0,function(){var s,o,a,l=this;return hn(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var c,h;o=!0;try{for(var f=Fi(s),p=f.next();!p.done;p=f.next()){var d=p.value;d()}}catch(g){c={error:g}}finally{try{p&&!p.done&&(h=f.return)&&h.call(f)}finally{if(c)throw c.error}}}),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,Promise.all(t.map(function(c,h){return yi(l,void 0,void 0,function(){var f,p;return hn(this,function(d){switch(d.label){case 0:d.trys.push([0,,6,9]),d.label=1;case 1:return o?[3,5]:(Promise.resolve(c.next()).then(function(g){return s[h](g)},function(g){return i(g)}),[4,new Promise(function(g){s[h]=g})]);case 2:return f=d.sent(),f===void 0?[3,4]:f.done?(a=f,[2]):[4,r(f.value)];case 3:d.sent(),d.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return p=c.return,p?[4,c.return()]:[3,8];case 7:p=d.sent(),d.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return u.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function o2(n){var e=this,t=Oa(n,{returnValues:!0});return new Gs(function(r,i){return yi(e,void 0,void 0,function(){var s,o,a,l;return hn(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),u.label=1;case 1:u.trys.push([1,,6,8]),u.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(c){return c.next()})).then(function(c){return s(c)},function(c){return i(c)}),[4,new Promise(function(c){return s=c})]);case 3:return a=u.sent(),a===void 0?[2]:(l=a.map(function(c){return c.value}),a.some(function(c){return c.done})?[2,l]:[4,r(l)]);case 4:return u.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(c){return c.return&&c.return()}))];case 7:return u.sent(),[7];case 8:return[2]}})})})}function a2(n){var e=this,t=Oa(n,{yieldValues:!0,returnValues:!0});return new Gs(function(r,i){return yi(e,void 0,void 0,function(){var s,o,a,l,u,c=this;return hn(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var f,p;s();try{for(var d=Fi(o),g=d.next();!g.done;g=d.next()){var m=g.value;m()}}catch(y){f={error:y}}finally{try{g&&!g.done&&(p=d.return)&&p.call(d)}finally{if(f)throw f.error}}a=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(t.map(function(f){return f.next()})).then(function(f){return s(f)},function(f){return i(f)}),[4,new Promise(function(f){return s=f})];case 2:return l=h.sent(),l===void 0?[2]:(u=l.map(function(f){return f.value}),l.every(function(f){return f.done})?[2,u]:[4,r(u.slice())]);case 3:return h.sent(),[4,Promise.all(t.map(function(f,p){return yi(c,void 0,void 0,function(){var d;return hn(this,function(g){switch(g.label){case 0:if(l[p].done)return[2,l[p].value];g.label=1;case 1:return a?[3,4]:(Promise.resolve(f.next()).then(function(m){return o[p](m)},function(m){return i(m)}),[4,new Promise(function(m){return o[p]=m})]);case 2:return d=g.sent(),d===void 0?[2,l[p].value]:d.done?[2,d.value]:(u[p]=d.value,[4,r(u.slice())]);case 3:return g.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}class ph{constructor(e,t,r,i,s,o={}){me(this,"headerClient");me(this,"header");me(this,"headerLength");me(this,"indexLength");me(this,"nocache");me(this,"headers");this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=i,this.nocache=s,this.headers=o}static async open(e,t,r={}){let i,s=new jd(e,t,r),o=2024+(()=>{let c,h=0;for(c=0;c<3;c++)h+=KL**c*YL;return h})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((c,h)=>Nr[h]===c))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await s.getRange(12,i,o,"header"),l=Fa(new hr(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let u=Ma(l.featuresCount,l.indexNodeSize);return new ph(s,l,i,u,t,r)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=this.headerClient,i=async(l,u)=>r.getRange(t+l,u,0,"index"),s=[],o=[];for await(let l of vy(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[u,c]=l,[,,h]=l;if(h||(h=4),o.length===0){o.push([u,h,c]);continue}let f=o[o.length-1];u-(f[0]+f[1])>$o.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([u,h,c])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*Gs.merge(a)}lengthBeforeTree(){return Nr.length+Vt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new jd(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[r]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-r;for(let[l,,u]of e){let c=await this.readFeature(o,l,a);yield{id:u,feature:c},a=0}o.logUsage("feature")}async readFeature(e,t,r){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,r,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,r,"feature data")),a=new Uint8Array(i+Vt);a.set(o,Vt);let l=new hr(a);return l.setPosition(Vt),er.getRootAsFeature(l)}}class jd{constructor(e,t,r={}){me(this,"httpClient");me(this,"bytesEverUsed",0);me(this,"bytesEverFetched",0);me(this,"buffer",new ArrayBuffer(0));me(this,"head",0);if(typeof e=="string")this.httpClient=new Vd(e,t,r);else if(e instanceof Vd)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,r,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,r);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Vd{constructor(e,t,r={}){me(this,"url");me(this,"nocache");me(this,"headers");me(this,"requestsEverMade",0);me(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=r}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}async function*l2(n,e,t,r){if(!n.subarray(0,3).every((h,f)=>Nr[f]===h))throw Error("Not a FlatGeobuf file");if(t){let h=fh.open(n);for await(let f of h.selectBbox(t))yield e(f.id,f.feature,h.header);return}let i=new hr(n),s=i.readUint32(Nr.length);i.setPosition(Nr.length+Vt);let o=Fa(i),a=Nr.length+Vt+s,{indexNodeSize:l,featuresCount:u}=o;l>0&&(a+=Ma(u,l));let c=0;for(;a<i.capacity();){let h=i.readUint32(a);i.setPosition(a+Vt);let f=er.getRootAsFeature(i);yield e(c++,f,o),a+=Vt+h}}async function*u2(n,e,t){let r,i=qL(n),s=async p=>await i.slice(p),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((p,d)=>Nr[d]===p))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new hr(o),l=a.readUint32(0);o=new Uint8Array(await s(l));let u=Fa(a=new hr(o)),{indexNodeSize:c,featuresCount:h}=u;if(c>0){let p=Ma(h,c);await s(p)}let f=0;for(;r=await h2(s,u,e,f++);)yield r}async function*c2(n,e,t,r,i=!1,s={}){let o=await ph.open(n,i,s);for await(let a of o.selectBbox(e))yield t(a.id,a.feature,o.header)}async function h2(n,e,t,r){let i=new Uint8Array(await n(4,"feature length"));if(i.byteLength===0)return;let s=new hr(i),o=s.readUint32(0);i=new Uint8Array(await n(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new hr(a)).setPosition(Vt),t(r,er.getRootAsFeature(s),e)}function pu(n,e){let t=e;if(t===Tt.Unknown&&(t=n.type()),t===Tt.GeometryCollection){let i=[];for(let s=0;s<n.partsLength();s++){let o=n.parts(s),a=o.type();i.push(pu(o,a))}return{type:Tt[t],geometries:i}}if(t===Tt.MultiPolygon){let i=[];for(let s=0;s<n.partsLength();s++)i.push(pu(n.parts(s),Tt.Polygon));return{type:Tt[t],coordinates:i.map(s=>s.coordinates)}}let r=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case Tt.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case Tt.MultiPoint:case Tt.LineString:return xl(o,a);case Tt.MultiLineString:case Tt.Polygon:return function(l,u,c){let h;if(!c||c.length===0)return[xl(l,u)];let f=0,p=Array.from(c).map(d=>l.slice(f,f=d<<1));return u&&(f=0,h=Array.from(c).map(d=>u.slice(f,f=d))),p.map((d,g)=>xl(d,h?h[g]:void 0))}(o,a,i.endsArray())}}(n,t);return{type:Tt[t],coordinates:r}}function gh(n,e,t){let r=t.columns;return{type:"Feature",id:n,geometry:pu(e.geometry(),t.geometryType),properties:VL(e,r)}}async function*f2(n,e,t){yield*l2(n,gh,e)}function d2(n,e){return u2(n,gh)}function p2(n,e,t,r=!1,i={}){return c2(n,e,gh,t,r,i)}function g2(n,e,t,r=!1,i={}){return n instanceof Uint8Array?f2(n,e):n instanceof ReadableStream?d2(n):p2(n,e,t,r,i)}class m2 extends _u{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX,strategy:r0}),this.dataProjection=e.projection||n0.dataProjection,this.resourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const r=i0(e,t.getCode(),this.dataProjection);return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}}async loader(e,t,r,i,s){const o=this.fgbBoundingBox(e,r);try{if(o.minX!==-1/0){const a=[],l=g2(this.resourceURL,o),u=new s0({featureProjection:r,dataProjection:this.dataProjection});for await(const c of l){const h=u.readFeature(c);a.push(h)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={BingMaps:CC,CartoDB:LC,Cluster:ko,DataTile:Ca,GeoTIFF:dy,Google:tL,IIIF:nL,Image:zn,ImageArcGISRest:sL,ImageCanvas:oL,ImageMapGuide:cL,ImageStatic:fL,ImageTile:yy,OGCMapTile:TL,OGCVectorTile:wL,Raster:wy,Source:Cu,StadiaMaps:DL,TileArcGISRest:GL,TileDebug:UL,TileImage:zr,TileJSON:BL,UrlTile:o0,UTFGrid:zL,Zoomify:rL,WMTSCapabilities:jL,FlatGeoBuf:m2};const K2=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{V2 as L,X2 as a,K2 as i};
