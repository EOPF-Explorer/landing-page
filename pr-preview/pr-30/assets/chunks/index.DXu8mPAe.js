const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.BjRHki-8.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/map.CJAoysws.js","assets/chunks/index.jYV8uuws.js","assets/chunks/Group.DKtNZ3u7.js","assets/chunks/XYZ.DvwMvOCi.js","assets/chunks/item.Bx-rtsOD.js","assets/chunks/framework.BX3ruMRd.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/webimage.CU41Mh7j.js","assets/chunks/proj4.C_WYg9Q4.js"])))=>i.map(i=>d[i]);
var b0=Object.defineProperty;var E0=(n,e,t)=>e in n?b0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ye=(n,e,t)=>E0(n,typeof e!="symbol"?e+"":e,t);import{c5 as T0,aZ as Wt,b as Ae,c6 as w0,bn as St,c7 as S0,c8 as v0,as as la,c9 as Oc,aN as fo,aM as ds,b0 as il,G as _i,aL as Jr,a_ as Er,ca as sl,cb as re,cc as Q,cd as X,ce as Du,cf as ca,cg as R0,ch as C0,ci as Bn,cj as ua,c as wg,ck as se,cl as F,cm as Ue,cn as fe,co as ar,cp as fs,cq as On,cr as js,cs as Sg,ct as ha,cu as da,cv as Z,cw as I,cx as $,cy as ol,cz as ot,cA as Ft,cB as Gu,cC as vg,cD as fa,cE as Qn,cF as P0,bk as Rg,I as hn,an as cr,cG as Me,a$ as I0,aO as Xn,S as Ud,cH as Qt,cI as $r,ax as A0,aR as ku,bf as L0,be as F0,bu as pa,cJ as M0,bD as Xs,bJ as O0,cK as N0,aX as D0,bV as Nc,cL as Bd,bU as Yl,cM as zd,c4 as $d,_ as ii,aY as Uu,v as G0,cN as k0,cO as U0,bt as Xr,ai as Vs,ah as Bu,cP as zn,bs as na,i as rs,N as Pt,H as Qe,cQ as ns,cR as $i,cS as B0,af as Ie,D as Cg,a4 as Ct,J as zu,cT as z0,T as $0,E as Vt,br as _e,cU as $u,bx as Ar,cV as j0,cW as ju,cX as Dc,cY as Gc,cZ as Vn,c_ as X0,c$ as kc,Z as Hl,d0 as V0,d1 as Uc,d2 as Pg,d3 as W0,d4 as Ni,bH as Z0,bE as jd,d5 as Y0,bI as Xu,d6 as H0,b7 as Ig,a9 as bn,d7 as po,d8 as q0,d9 as K0,da as Te,db as Ws,dc as Zs,dd as Zt,de as xi,df as Ri,dg as J0,dh as oe,di as Xd,dj as Q0,bm as ex,bp as tx,dk as Ag,dl as rx,K as Ys,n as nx,aG as go,l as fn,b3 as Nn,dm as ix,ac as Wn,$ as al,aH as Vu,u as ga,dn as Lg,dp as si,dq as sx,dr as ox,c1 as Fg,av as Lr,ds as ax,ao as Wu,dt as lx,bo as cx,am as ux,bg as hx,aF as wn,du as mo,bX as yo,dv as Zu,g as Yu,bN as Mg,Y as dx,bS as fx,aV as Bc,bT as Vd,dw as px,dx as gx,dy as mx,dz as yx,dA as _x,bQ as Hu,dB as xx,dC as bx,dD as Ex,m as Tx,dE as ql,dF as Hs,dG as ll,dH as wx,b8 as Sx,a8 as vx,dI as Wd,bl as Zd,dJ as Yd,aS as Rx,aU as Cx,dK as zc,dL as Og,at as Hd,ay as ma,az as Ng,aA as ps,au as qd,aB as Ci,aC as qu,dM as Px,dN as Dg,bP as Ix,a5 as Ax,dO as Ku,h as Lx,bL as Fx,bM as Mx,dP as Ox,aI as Nx,aJ as Dx,dQ as Gx,dR as Gg,dS as kx,dT as Ux,dU as Bx,c3 as zx,b4 as $x,dV as jx,y as Xx,dW as Vx,dX as Wx,bd as Zx,bi as Yx,bc as Hx,dY as qx}from"./map.CJAoysws.js";import{R as kg}from"./index.jYV8uuws.js";import{Z as ve,i as Kx,u as qs,l as Ks,E as Qr,b as Ds,p as Ug,j as bi,an as Jx,q as _r,x as _o,n as Qx,a5 as eb,a as qn,H as gn,s as tb,z as rb,y as nb,o as Fr,m as ib,k as Lt,_ as is,ac as Ju,O as xo,a6 as cl,a8 as sb,a9 as ob,aa as ab,e as er,g as Zn,I as ul,a4 as Js,F as xt,ao as Vr,ag as lb,C as Yi,a2 as Ei,ap as cb,aq as ub,ar as hb,a3 as db,as as Wr,aj as $c,ad as fb,ah as pb,X as gb,d as jc,at as mb,J as yb,ak as ko,M as _b,B as hl,h as Bg,au as Kd,K as xb,V as bb,P as Eb,$ as Tb,a0 as Jd,ae as wb,Q as Sb,L as zg,N as ya,S as vb}from"./Group.DKtNZ3u7.js";import{G as Rb,S as dl,m as Cb,k as Pb,l as Ib,n as ji,o as $g,p as Ab,q as jg,r as Lb,s as Fb,u as Xc,v as Xg,x as Mb,y as Qu,P as _a,z as Ob,A as Nb,B as Db,C as Gb,E as Vc,F as Wc,H as Vg,I as Wg,J as kb,K as xa,L as Ub,N as Zg,O as Bb,Q as Yg,d as $e,R as Yn,T as Hi,U as Tr,V as zb,Y as Mt,Z as Hg,_ as $b,$ as jb,a0 as gs,a1 as Qd,a2 as Xb,a3 as ef,a4 as Vb,a5 as Wb,a6 as Zb,i as bo,a7 as Mr,a8 as Tt,a9 as qg,aa as Yb,ab as Hb,ac as Xi,ad as ss,ae as xr,af as We,ag as Kg,ah as qb,ai as tf,aj as rf,ak as Kl,al as de,h as eh,am as Kb,an as Jb,ao as nf,ap as sf,aq as Qb,ar as Dn,as as br,at as ba,au as Ea,av as mn,aw as yn,ax as Ta,ay as wa,az as Sa,aA as eE,aB as ci,aC as va,aD as Qs,aE as Jg,aF as tE,aG as rE,aH as nE,aI as iE,aJ as sE,aK as of,aL as oE,aM as Qg,aN as aE,t as th,aO as Zc,aP as em,aQ as tm,aR as rm,aS as di,aT as Yc,aU as Jl,aV as af,aW as lE,aX as Uo,aY as fl,aZ as nm,a_ as cE,a$ as uE,b0 as hE,b1 as Eo,b2 as im,b3 as rh,b4 as pl,b5 as To,b6 as dE,b7 as Ra,b8 as fE,b9 as pE,ba as sm,bb as gE,bc as mE,bd as nh,be as yE,bf as _E,bg as xE,bh as lf,bi as om,D as am,bj as Vi,bk as Fs,bl as oi,bm as lm,bn as cf,f as bE,bo as EE,bp as TE,X as uf,W as hf,bq as wE,M as Ca,br as SE,bs as vE,bt as RE,bu as CE,bv as PE,bw as Hc,bx as qc,by as IE}from"./XYZ.DvwMvOCi.js";import{S as AE,a as LE,u as ih,b as cm,C as Kc,I as Pa,M as FE,A as Bo,c as Rs,i as Ql,d as ME,f as OE,g as df}from"./item.Bx-rtsOD.js";import{g as um}from"./commonjsHelpers.BosuxZz1.js";import{a5 as Sn}from"./framework.BX3ruMRd.js";import{p as NE}from"./index.Du0sVlOV.js";function hm(n,e){const t=(""+n).split("."),r=(""+e).split(".");for(let i=0;i<Math.max(t.length,r.length);i++){const s=parseInt(t[i]||"0",10),o=parseInt(r[i]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function DE(n,e,t,r){const i=document.createElement("script"),s="olc_"+ve(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class sh extends AE{constructor(e,t=null,r={},i=[]){super(e,t,r,i)}getAll(){return[]}}class GE extends LE{constructor(e,t=null){super(e,t)}}class dm extends sh{constructor(e,t=null){const r={collections:i=>i.map(s=>s instanceof Kc?s:new Kc(s))};super(e,t,r)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return ih(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return cm(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class fm extends sh{constructor(e,t=null){const r={features:i=>i.map(s=>s instanceof Pa?s:new Pa(s))};super(e,t,r)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return ih(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return cm(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function zo(n,e=!0,t=!1){return e&&(n=FE.stac(n,t)),n.type==="Feature"?new Pa(n):n.type==="FeatureCollection"?new fm(n):n.type==="Collection"||!n.type&&typeof n.extent<"u"&&typeof n.license<"u"?new Kc(n):!n.type&&Array.isArray(n.collections)?new dm(n):new GE(n)}const kE={Point:$E,LineString:jE,Polygon:ZE,MultiPoint:VE,MultiLineString:XE,MultiPolygon:WE},UE={Point:YE,LineString:HE,Polygon:qE,MultiPoint:JE,MultiLineString:KE,MultiPolygon:QE};class BE extends T0{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,r){const i=e,s=ff(i.geometry,t),o=new Wt;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[r];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const r=e,i=[],s=r.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return ff(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const r=e.spatialReference.wkid;return Ae("EPSG:"+r)}return null}writeGeometryObject(e,t){return pf(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={};if(!e.hasProperties())return r.attributes={},r;const i=e.getProperties(),s=e.getGeometry();if(s){r.geometry=pf(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(r.geometry.spatialReference={wkid:Number(Ae(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return w0(i)?r.attributes={}:r.attributes=i,r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{features:r}}}function ff(n,e){if(!n)return null;let t;if(typeof n.x=="number"&&typeof n.y=="number")t="Point";else if(n.points)t="MultiPoint";else if(n.paths)n.paths.length===1?t="LineString":t="MultiLineString";else if(n.rings){const i=n,s=ms(i),o=zE(i.rings,s);o.length===1?(t="Polygon",n=Object.assign({},n,{rings:o[0]})):(t="MultiPolygon",n=Object.assign({},n,{rings:o}))}const r=kE[t];return St(r(n),!1,e)}function zE(n,e){const t=[],r=[],i=[];let s,o;for(s=0,o=n.length;s<o;++s)t.length=0,S0(t,0,n[s],e.length),v0(t,0,t.length,e.length)?r.push([n[s]]):i.push(n[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=r.length-1;s>=0;s--){const c=r[s][0];if(la(new Oc(c).getExtent(),new Oc(a).getExtent())){r[s].push(a),l=!0;break}}l||r.push([a.reverse()])}return r}function $E(n){let e;return n.m!==void 0&&n.z!==void 0?e=new Er([n.x,n.y,n.z,n.m],"XYZM"):n.z!==void 0?e=new Er([n.x,n.y,n.z],"XYZ"):n.m!==void 0?e=new Er([n.x,n.y,n.m],"XYM"):e=new Er([n.x,n.y]),e}function jE(n){const e=ms(n);return new Jr(n.paths[0],e)}function XE(n){const e=ms(n);return new ds(n.paths,e)}function ms(n){let e="XY";return n.hasZ===!0&&n.hasM===!0?e="XYZM":n.hasZ===!0?e="XYZ":n.hasM===!0&&(e="XYM"),e}function VE(n){const e=ms(n);return new il(n.points,e)}function WE(n){const e=ms(n);return new fo(n.rings,e)}function ZE(n){const e=ms(n);return new _i(n.rings,e)}function YE(n,e){const t=n.getCoordinates();let r;const i=n.getLayout();if(i==="XYZ")r={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")r={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")r={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")r={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return r}function wo(n){const e=n.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function HE(n,e){const t=wo(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:[n.getCoordinates()]}}function qE(n,e){const t=wo(n);return{hasZ:t.hasZ,hasM:t.hasM,rings:n.getCoordinates(!1)}}function KE(n,e){const t=wo(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:n.getCoordinates()}}function JE(n,e){const t=wo(n);return{hasZ:t.hasZ,hasM:t.hasM,points:n.getCoordinates()}}function QE(n,e){const t=wo(n),r=n.getCoordinates(!1),i=[];for(let s=0;s<r.length;s++)for(let o=r[s].length-1;o>=0;o--)i.push(r[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function pf(n,e){const t=UE[n.getType()];return t(St(n,!0,e),e)}const _n="http://www.opengis.net/gml",eT=/^\s*$/;class H extends sl{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Q(this.readFeaturesInternal),featureMembers:re(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const r=e.localName;let i=null;if(r=="FeatureCollection")i=X([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(r=="featureMembers"||r=="featureMember"||r=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",c="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,f=e.childNodes.length;d<f;++d){const p=e.childNodes[d];if(p.nodeType===1){const g=p.nodeName.split(":").pop();if(!o.includes(g)){let m="",y=0;const _=p.namespaceURI;for(const x in a){if(a[x]===_){m=x;break}++y}m||(m=l+y,a[m]=_),o.push(m+":"+g)}}}r!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[c]=d}const u={},h=Array.isArray(o)?o:[o];for(const d in a){const f={};for(let p=0,g=h.length;p<g;++p)(h[p].includes(":")?h[p].split(":")[0]:c)===d&&(f[h[p].split(":").pop()]=r=="featureMembers"?Q(this.readFeatureElement,this):re(this.readFeatureElement,this));u[a[d]]=f}r=="featureMember"||r=="member"?i=X(void 0,u,e,t):i=X([],u,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),X(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?Du(i,r):void 0}readGeometryElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?St(i,!1,r):void 0}readFeatureElementInternal(e,t,r){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let c;const u=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(c=ca(l,!1),eT.test(c)&&(c=void 0)):(r&&(c=u==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),c?u!=="boundedBy"&&(i=u):c=this.readFeatureElementInternal(l,t,!1));const h=l.attributes.length;if(h>0&&!(c instanceof R0)){c={_content_:c};for(let d=0;d<h;d++){const f=l.attributes[d].name;c[f]=l.attributes[d].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(c)):s[u]=c}if(!r)return s;const o=new Wt(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||C0(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Er(r,"XYZ")}readMultiPoint(e,t){const r=X([],this.MULTIPOINT_PARSERS,e,t,this);if(r)return new il(r)}readMultiLineString(e,t){const r=X([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new ds(r)}readMultiPolygon(e,t){const r=X([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new fo(r)}pointMemberParser(e,t){Bn(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Bn(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Bn(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Jr(r,"XYZ")}readFlatLinearRing(e,t){const r=X(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(r)return r}readLinearRing(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Oc(r,"XYZ")}readPolygon(e,t){const r=X([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)ua(i,r[o]),s.push(i.length);return new _i(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return X(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null}readFeaturesFromNode(e,t){const r={featureType:this.featureType,featureNS:this.featureNS};return r&&Object.assign(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]}readProjectionFromNode(e){return Ae(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}H.prototype.namespace=_n;H.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};H.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};H.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};H.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Q(H.prototype.pointMemberParser),pointMembers:Q(H.prototype.pointMemberParser)}};H.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Q(H.prototype.lineStringMemberParser),lineStringMembers:Q(H.prototype.lineStringMemberParser)}};H.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Q(H.prototype.polygonMemberParser),polygonMembers:Q(H.prototype.polygonMemberParser)}};H.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Q(H.prototype.readFlatCoordinatesFromNode)}};H.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Q(H.prototype.readLineString)}};H.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Q(H.prototype.readPolygon)}};H.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:re(H.prototype.readFlatLinearRing)}};const tT=_n+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",rT={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class he extends H{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[_n].featureMember=Q(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:tT}readFlatCoordinates(e,t){const r=ca(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const c=Ae(s);c&&(o=c.getAxisOrientation())}const a=r.trim().split(/\s+/),l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c].split(/,+/),d=parseFloat(h[0]),f=parseFloat(h[1]),p=h.length===3?parseFloat(h[2]):0;o.startsWith("en")?l.push(d,f,p):l.push(f,d,p)}return l}readBox(e,t){const r=X([null],this.BOX_PARSERS_,e,t,this);return wg(r[1][0],r[1][1],r[1][3],r[1][4])}innerBoundaryIsParser(e,t){const r=X(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}outerBoundaryIsParser(e,t){const r=X(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="MultiLineString"&&a===!0&&(r="MultiCurve")),se("http://www.opengis.net/gml",r)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const h=t.getProperties();for(const d in h){const f=h[d];f!=null&&(l.push(d),c.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=F(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=F(fe)))}}const u=Object.assign({},s);u.node=e,Ue(u,s.serializers,ar(void 0,o),c,r,l)}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}else if(e.nodeName==="Curve"){const o=se(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Ue({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Du(t,i):o=St(t,!0,i),Ue(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}createCoordinatesNode_(e){const t=se(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,c=new Array(l);for(let u=0;u<l;++u){const h=a[u];c[u]=this.getCoords_(h,o,s)}fe(e,c.join(" "))}writeCurveSegments_(e,t,r){const i=se(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Ue({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=se(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),se(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,r){const i=se(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeRing(e,t,r){const i=se(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}getCoords_(e,t,r){let s=(t?Ae(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(r){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),c=this.getCoords_(l,o,s);fe(a,c)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();Ue({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,ar("pointMember"),a,r,void 0,this)}writePointMember(e,t,r){const i=se(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Ue({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Ue({node:e},this.ENVELOPE_SERIALIZERS,fs,a,r,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return se("http://www.opengis.net/gml",rT[i.nodeName])}}he.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:re(he.prototype.readFlatCoordinates)}};he.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:he.prototype.innerBoundaryIsParser,outerBoundaryIs:he.prototype.outerBoundaryIsParser}};he.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Q(he.prototype.readFlatCoordinates)}};he.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:re(H.prototype.readPoint),MultiPoint:re(H.prototype.readMultiPoint),LineString:re(H.prototype.readLineString),MultiLineString:re(H.prototype.readMultiLineString),LinearRing:re(H.prototype.readLinearRing),Polygon:re(H.prototype.readPolygon),MultiPolygon:re(H.prototype.readMultiPolygon),Box:re(he.prototype.readBox)}};he.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(he.prototype.writeCurveOrLineString),MultiCurve:F(he.prototype.writeMultiCurveOrLineString),Point:F(he.prototype.writePoint),MultiPoint:F(he.prototype.writeMultiPoint),LineString:F(he.prototype.writeCurveOrLineString),MultiLineString:F(he.prototype.writeMultiCurveOrLineString),LinearRing:F(he.prototype.writeLinearRing),Polygon:F(he.prototype.writeSurfaceOrPolygon),MultiPolygon:F(he.prototype.writeMultiSurfaceOrPolygon),Surface:F(he.prototype.writeSurfaceOrPolygon),MultiSurface:F(he.prototype.writeMultiSurfaceOrPolygon),Envelope:F(he.prototype.writeEnvelope)}};he.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(he.prototype.writeLineStringOrCurveMember),curveMember:F(he.prototype.writeLineStringOrCurveMember)}};he.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:F(he.prototype.writeRing),innerBoundaryIs:F(he.prototype.writeRing)}};he.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(he.prototype.writePointMember)}};he.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(he.prototype.writeSurfaceOrPolygonMember),polygonMember:F(he.prototype.writeSurfaceOrPolygonMember)}};he.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(fe),upperCorner:F(fe)}};const nT=_n+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",iT={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class z extends H{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:nT,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const r=X([],this.MULTICURVE_PARSERS,e,t,this);if(r)return new ds(r)}readFlatCurveRing(e,t){const r=X([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=r.length;s<o;++s)ua(i,r[s].getFlatCoordinates());return i}readMultiSurface(e,t){const r=X([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new fo(r)}curveMemberParser(e,t){Bn(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Bn(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return X([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return X([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return X([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return X([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const r=X(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}exteriorParser(e,t){const r=X(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}readSurface(e,t){const r=X([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)ua(i,r[o]),s.push(i.length);return new _i(i,"XYZ",s)}}readCurve(e,t){const r=X([null],this.CURVE_PARSERS,e,t,this);if(r)return new Jr(r,"XYZ")}readEnvelope(e,t){const r=X([null],this.ENVELOPE_PARSERS,e,t,this);return wg(r[1][0],r[1][1],r[2][0],r[2][1])}readFlatPos(e,t){let r=ca(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(r);)s.push(parseFloat(o[1])),r=r.substr(o[0].length);if(r!=="")return;const l=t[0].srsName;if((l?Ae(l).getAxisOrientation():"enu")==="neu")for(let h=0,d=s.length;h<d;h+=3){const f=s[h],p=s[h+1];s[h]=p,s[h+1]=f}const u=s.length;if(u==2&&s.push(0),u!==0)return s}readFlatPosList(e,t){const r=ca(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?Ae(s).getAxisOrientation():"enu",l=r.split(/\s+/);let c=2;e.getAttribute("srsDimension")?c=On(e.getAttribute("srsDimension")):e.getAttribute("dimension")?c=On(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?c=On(e.parentNode.getAttribute("srsDimension")):o&&(c=On(o));const u=a.startsWith("en");let h,d,f;const p=[];for(let g=0,m=l.length;g<m;g+=c)h=parseFloat(l[g]),d=parseFloat(l[g+1]),f=c===3?parseFloat(l[g+2]):0,u?p.push(h,d,f):p.push(d,h,f);return p}writePos_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=a?Ae(a).getAxisOrientation():"enu",c=t.getCoordinates();let u=l.startsWith("en")?c[0]+" "+c[1]:c[1]+" "+c[0];if(s){const h=c[2]||0;u+=" "+h}fe(e,u)}getCoords_(e,t,r){let s=(t?Ae(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(r){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),c=l.length,u=new Array(c);let h;for(let d=0;d<c;++d)h=l[d],u[d]=this.getCoords_(h,a,s);fe(e,u.join(" "))}writePoint(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=se(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,r)}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Ue({node:e},this.ENVELOPE_SERIALIZERS,fs,a,r,o,this)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=se(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),se(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Ue({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=se(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=se(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}else if(e.nodeName==="Curve"){const o=se(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Ue({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();Ue({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,ar("pointMember"),a,r,void 0,this)}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Ue({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeRing(e,t,r){const i=se(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writePointMember(e,t,r){const i=se(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeSurfacePatches_(e,t,r){const i=se(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeCurveSegments_(e,t,r){const i=se(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Du(t,i):o=St(t,!0,i),Ue(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const h=t.getProperties();for(const d in h){const f=h[d];f!=null&&(l.push(d),c.push(f),d==a||typeof f.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=F(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=F(fe)))}}const u=Object.assign({},s);u.node=e,Ue(u,s.serializers,ar(void 0,o),c,r,l)}writeFeatureMembers_(e,t,r){const i=r[r.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=F(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,Ue(l,a,ar(s,o),t,r)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return se(this.namespace,iT[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="LineString"&&a===!0?r="Curve":r==="MultiLineString"&&l===!0&&(r="MultiCurve")),se(this.namespace,r)}writeGeometryNode(e,t){t=this.adaptOptions(t);const r=se(this.namespace,"geom"),i={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(r,e,[i]),r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=se(this.namespace,"featureMembers");r.setAttributeNS(js,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(r,e,[i]),r}}z.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:re(z.prototype.readFlatPos),posList:re(z.prototype.readFlatPosList),coordinates:re(he.prototype.readFlatCoordinates)}};z.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:z.prototype.interiorParser,exterior:z.prototype.exteriorParser}};z.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:re(H.prototype.readPoint),MultiPoint:re(H.prototype.readMultiPoint),LineString:re(H.prototype.readLineString),MultiLineString:re(H.prototype.readMultiLineString),LinearRing:re(H.prototype.readLinearRing),Polygon:re(H.prototype.readPolygon),MultiPolygon:re(H.prototype.readMultiPolygon),Surface:re(z.prototype.readSurface),MultiSurface:re(z.prototype.readMultiSurface),Curve:re(z.prototype.readCurve),MultiCurve:re(z.prototype.readMultiCurve),Envelope:re(z.prototype.readEnvelope)}};z.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Q(z.prototype.curveMemberParser),curveMembers:Q(z.prototype.curveMemberParser)}};z.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Q(z.prototype.surfaceMemberParser),surfaceMembers:Q(z.prototype.surfaceMemberParser)}};z.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Q(H.prototype.readLineString),Curve:Q(z.prototype.readCurve)}};z.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Q(H.prototype.readPolygon),Surface:Q(z.prototype.readSurface)}};z.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:re(z.prototype.readPatch)}};z.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:re(z.prototype.readSegment)}};z.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Q(z.prototype.readFlatPosList),upperCorner:Q(z.prototype.readFlatPosList)}};z.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:re(z.prototype.readPolygonPatch)}};z.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Sg(z.prototype.readLineStringSegment)}};H.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:re(H.prototype.readFlatLinearRing),Ring:re(z.prototype.readFlatCurveRing)}};z.prototype.writeFeatures;z.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:F(z.prototype.writeRing),interior:F(z.prototype.writeRing)}};z.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(fe),upperCorner:F(fe)}};z.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(z.prototype.writeSurfaceOrPolygonMember),polygonMember:F(z.prototype.writeSurfaceOrPolygonMember)}};z.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(z.prototype.writePointMember)}};z.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(z.prototype.writeLineStringOrCurveMember),curveMember:F(z.prototype.writeLineStringOrCurveMember)}};z.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(z.prototype.writeCurveOrLineString),MultiCurve:F(z.prototype.writeMultiCurveOrLineString),Point:F(z.prototype.writePoint),MultiPoint:F(z.prototype.writeMultiPoint),LineString:F(z.prototype.writeCurveOrLineString),MultiLineString:F(z.prototype.writeMultiCurveOrLineString),LinearRing:F(z.prototype.writeLinearRing),Polygon:F(z.prototype.writeSurfaceOrPolygon),MultiPolygon:F(z.prototype.writeMultiSurfaceOrPolygon),Surface:F(z.prototype.writeSurfaceOrPolygon),MultiSurface:F(z.prototype.writeMultiSurfaceOrPolygon),Envelope:F(z.prototype.writeEnvelope)}};const oh=z;oh.prototype.writeFeatures;oh.prototype.writeFeaturesNode;const He=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],sT="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",oT={rte:pm,trk:gm,wpt:mm},aT=Z(He,{rte:Q(pm),trk:Q(gm),wpt:Q(mm)}),lT=Z(He,{text:I($,"linkText"),type:I($,"linkType")}),cT=Z(He,{name:I($),email:DT,link:So}),uT=Z(He,{name:I($),desc:I($),author:I(MT),copyright:I(OT),link:So,time:I(ol),keywords:I($),bounds:NT,extensions:gl}),hT=Z(He,{year:I(ot),license:I($)}),dT=Z(He,{rte:F(BT),trk:F(zT),wpt:F(jT)});class fT extends sl{constructor(e){super(),e=e||{},this.dataProjection=Ae("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(ha(e)):da(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const r=this.readMetadataFromNode(t);if(r)return r}return null}readMetadataFromNode(e){if(!He.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(He.includes(t.namespaceURI)&&t.localName==="metadata")return X({},uT,t,[]);return null}readFeatureFromNode(e,t){if(!He.includes(e.namespaceURI))return null;const r=oT[e.localName];if(!r)return null;const i=r(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!He.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const r=X([],aT,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=se("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",js),r.setAttributeNS(js,"xsi:schemaLocation",sT),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),Ue({node:r},dT,FT,e,[t]),r}}const pT=Z(He,{name:I($),cmt:I($),desc:I($),src:I($),link:So,number:I(ot),extensions:gl,type:I($),rtept:GT}),gT=Z(He,{ele:I(Ft),time:I(ol)}),mT=Z(He,{name:I($),cmt:I($),desc:I($),src:I($),link:So,number:I(ot),type:I($),extensions:gl,trkseg:UT}),yT=Z(He,{trkpt:kT}),_T=Z(He,{ele:I(Ft),time:I(ol)}),xT=Z(He,{ele:I(Ft),time:I(ol),magvar:I(Ft),geoidheight:I(Ft),name:I($),cmt:I($),desc:I($),src:I($),link:So,sym:I($),type:I($),fix:I($),sat:I(ot),hdop:I(Ft),vdop:I(Ft),pdop:I(Ft),ageofdgpsdata:I(Ft),dgpsid:I(ot),extensions:gl}),bT=["text","type"],ET=Z(He,{text:F(fe),type:F(fe)}),TT=Z(He,["name","cmt","desc","src","link","number","type","rtept"]),wT=Z(He,{name:F(fe),cmt:F(fe),desc:F(fe),src:F(fe),link:F(ch),number:F(fa),type:F(fe),rtept:vg(F(uh))}),ST=Z(He,["ele","time"]),vT=Z(He,["name","cmt","desc","src","link","number","type","trkseg"]),RT=Z(He,{name:F(fe),cmt:F(fe),desc:F(fe),src:F(fe),link:F(ch),number:F(fa),type:F(fe),trkseg:vg(F($T))}),CT=ar("trkpt"),PT=Z(He,{trkpt:F(uh)}),IT=Z(He,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),AT=Z(He,{ele:F(Qn),time:F(P0),magvar:F(Qn),geoidheight:F(Qn),name:F(fe),cmt:F(fe),desc:F(fe),src:F(fe),link:F(ch),sym:F(fe),type:F(fe),fix:F(fe),sat:F(fa),hdop:F(Qn),vdop:F(Qn),pdop:F(Qn),ageofdgpsdata:F(Qn),dgpsid:F(fa)}),LT={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function FT(n,e,t){const r=n.getGeometry();if(r){const i=LT[r.getType()];if(i){const s=e[e.length-1].node;return se(s.namespaceURI,i)}}}function ah(n,e,t,r){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in r?(n.push(r.ele),delete r.ele,e.hasZ=!0):n.push(0),"time"in r?(n.push(r.time),delete r.time,e.hasM=!0):n.push(0),n}function lh(n,e,t){let r="XY",i=2;if(n.hasZ&&n.hasM?(r="XYZM",i=4):n.hasZ?(r="XYZ",i=3):n.hasM&&(r="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],n.hasZ&&(e[s*i+2]=e[s*4+2]),n.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return r}function MT(n,e){const t=X({},cT,n,e);if(t)return t}function OT(n,e){const t=X({},hT,n,e);if(t){const r=n.getAttribute("author");return r!==null&&(t.author=r),t}}function NT(n,e){const t=e[e.length-1],r=n.getAttribute("minlat"),i=n.getAttribute("minlon"),s=n.getAttribute("maxlat"),o=n.getAttribute("maxlon");i!==null&&r!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(r)],[parseFloat(o),parseFloat(s)]])}function DT(n,e){const t=e[e.length-1],r=n.getAttribute("id"),i=n.getAttribute("domain");r!==null&&i!==null&&(t.email=`${r}@${i}`)}function So(n,e){const t=e[e.length-1],r=n.getAttribute("href");r!==null&&(t.link=r),Bn(lT,n,e)}function gl(n,e){const t=e[e.length-1];t.extensionsNode_=n}function GT(n,e){const t=X({},gT,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;ah(i,s,n,t)}}function kT(n,e){const t=X({},_T,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;ah(i,s,n,t)}}function UT(n,e){const t=e[e.length-1];Bn(yT,n,e);const r=t.flatCoordinates;t.ends.push(r.length)}function pm(n,e){const t=e[0],r=X({flatCoordinates:[],layoutOptions:{}},pT,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.layoutOptions;delete r.layoutOptions;const o=lh(s,i),a=new Jr(i,o);St(a,!1,t);const l=new Wt(a);return l.setProperties(r,!0),l}function gm(n,e){const t=e[0],r=X({flatCoordinates:[],ends:[],layoutOptions:{}},mT,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.ends;delete r.ends;const o=r.layoutOptions;delete r.layoutOptions;const a=lh(o,i,s),l=new ds(i,a,s);St(l,!1,t);const c=new Wt(l);return c.setProperties(r,!0),c}function mm(n,e){const t=e[0],r=X({},xT,n,e);if(!r)return;const i={},s=ah([],i,n,r),o=lh(i,s),a=new Er(s,o);St(a,!1,t);const l=new Wt(a);return l.setProperties(r,!0),l}function ch(n,e,t){n.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];Ue({node:n},ET,fs,s,t,bT)}function uh(n,e,t){const r=t[t.length-1],s=r.node.namespaceURI,o=r.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),r.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=n.nodeName=="rtept"?ST[s]:IT[s],c=Gu(o,l);Ue({node:n,properties:o},AT,fs,c,t,l)}function BT(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const u=St(o,!0,r);s.geometryLayout=u.getLayout(),i.rtept=u.getCoordinates()}const a=t[t.length-1].node,l=TT[a.namespaceURI],c=Gu(i,l);Ue(s,wT,fs,c,t,l)}function zT(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const u=St(o,!0,r);i.trkseg=u.getLineStrings()}const a=t[t.length-1].node,l=vT[a.namespaceURI],c=Gu(i,l);Ue(s,RT,fs,c,t,l)}function $T(n,e,t){const r={node:n};r.geometryLayout=e.getLayout(),r.properties={},Ue(r,PT,CT,e.getCoordinates(),t)}function jT(n,e,t){const r=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=St(s,!0,r);i.geometryLayout=o.getLayout(),uh(n,o.getCoordinates(),t)}}class hh extends Rg{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText($o(e),this.adaptOptions(t))}readFeatureFromText(e,t){return hn()}readFeatures(e,t){return this.readFeaturesFromText($o(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return hn()}readGeometry(e,t){return this.readGeometryFromText($o(e),this.adaptOptions(t))}readGeometryFromText(e,t){return hn()}readProjection(e){return this.readProjectionFromText($o(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return hn()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return hn()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return hn()}}function $o(n){return typeof n=="string"?n:""}const XT=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,VT=/^H.([A-Z]{3}).*?:(.*)/,WT=/^HFDTE(\d{2})(\d{2})(\d{2})/,ZT=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,YT=/\r\n|\r|\n/;class HT extends hh{constructor(e){super(),e=e||{},this.dataProjection=Ae("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const r=this.altitudeMode_,i=e.split(YT),s={},o=[];let a=2e3,l=0,c=1,u=-1,h,d;for(h=0,d=i.length;h<d;++h){const m=i[h];let y;if(m.charAt(0)=="B"){if(y=XT.exec(m),y){const _=parseInt(y[1],10),x=parseInt(y[2],10),E=parseInt(y[3],10);let b=parseInt(y[4],10)+parseInt(y[5],10)/6e4;this.lad_&&(b+=parseInt(m.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),y[6]=="S"&&(b=-b);let T=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(this.lod_&&(T+=parseInt(m.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),y[9]=="W"&&(T=-T),o.push(T,b),r!="none"){let v;r=="gps"?v=parseInt(y[11],10):r=="barometric"?v=parseInt(y[12],10):v=0,o.push(v)}let w=Date.UTC(a,l,c,_,x,E);w<u&&(w=Date.UTC(a,l,c+1,_,x,E)),o.push(w/1e3),u=w}}else if(m.charAt(0)=="H")y=ZT.exec(m),y?(c=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=WT.exec(m),y?(c=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=VT.exec(m),y&&(s[y[1]]=y[2].trim())));else if(m.charAt(0)=="I"){const _=parseInt(m.slice(1,3),10);for(let x=0;x<_;x++){const E=m.slice(7+x*7,10+x*7);if(E==="LAD"||E==="LOD"){const b=parseInt(m.slice(3+x*7,5+x*7),10)-1,T=parseInt(m.slice(5+x*7,7+x*7),10);E==="LAD"?(this.lad_=!0,this.ladStart_=b,this.ladStop_=T):E==="LOD"&&(this.lod_=!0,this.lodStart_=b,this.lodStop_=T)}}}}if(o.length===0)return null;const f=r=="none"?"XYM":"XYZM",p=new Jr(o,f),g=new Wt(St(p,!1,t));return g.setProperties(s,!0),g}readFeaturesFromText(e,t){const r=this.readFeatureFromText(e,t);return r?[r]:[]}}const pt={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Ti={};Ti[pt.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Ti[pt.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Ti[pt.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Ti.none={none:{supports:[],formats:[],qualities:[]}};const qT=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,gf=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,KT=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function JT(n){let e=n.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Ti[pt.VERSION1].level0),{url:n.imageInfo["@id"]===void 0?void 0:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,n.imageInfo.formats===void 0?[]:n.imageInfo.formats],qualities:[...e.qualities,n.imageInfo.qualities===void 0?[]:n.imageInfo.qualities],resolutions:n.imageInfo.scale_factors,tileSize:n.imageInfo.tile_width!==void 0?n.imageInfo.tile_height!==void 0?[n.imageInfo.tile_width,n.imageInfo.tile_height]:[n.imageInfo.tile_width,n.imageInfo.tile_width]:n.imageInfo.tile_height!=null?[n.imageInfo.tile_height,n.imageInfo.tile_height]:void 0}}function QT(n){const e=n.getComplianceLevelSupportedFeatures(),t=Array.isArray(n.imageInfo.profile)&&n.imageInfo.profile.length>1,r=t&&n.imageInfo.profile[1].supports?n.imageInfo.profile[1].supports:[],i=t&&n.imageInfo.profile[1].formats?n.imageInfo.profile[1].formats:[],s=t&&n.imageInfo.profile[1].qualities?n.imageInfo.profile[1].qualities:[];return{url:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(o){return o.width})[0],n.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...r],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function ew(n){const e=n.getComplianceLevelSupportedFeatures(),t=n.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...n.imageInfo.extraFormats],r=n.imageInfo.preferredFormats!==void 0&&Array.isArray(n.imageInfo.preferredFormats)&&n.imageInfo.preferredFormats.length>0?n.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:n.imageInfo.id,sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(i){return i.width})[0],n.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:n.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...n.imageInfo.extraFeatures],formats:t,qualities:n.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...n.imageInfo.extraQualities],preferredFormat:r}}const ml={};ml[pt.VERSION1]=JT;ml[pt.VERSION2]=QT;ml[pt.VERSION3]=ew;class tw{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return pt.VERSION1;case"http://iiif.io/api/image/2/context.json":return pt.VERSION2;case"http://iiif.io/api/image/3/context.json":return pt.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(pt.VERSION1)&&this.imageInfo.identifier)return pt.VERSION1;break}cr(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case pt.VERSION1:if(qT.test(this.imageInfo.profile))return this.imageInfo.profile;break;case pt.VERSION3:if(KT.test(this.imageInfo.profile))return this.imageInfo.profile;break;case pt.VERSION2:if(typeof this.imageInfo.profile=="string"&&gf.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&gf.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const r=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(r)?r[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Ti.none.none:Ti[e][t]}getTileSourceOptions(e){const t=e||{},r=this.getImageApiVersion();if(r===void 0)return;const i=r===void 0?void 0:ml[r](this);if(i!==void 0)return{url:i.url,version:r,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}let dh=class{read(e){if(!e)return null;if(typeof e=="string"){const t=ha(e);return this.readFromDocument(t)}return da(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){hn()}};const rw="http://www.w3.org/1999/xlink";function ys(n){return n.getAttributeNS(rw,"href")}const Yt=[null,"http://www.opengis.net/ows/1.1"],nw=Z(Yt,{ServiceIdentification:I(Cw),ServiceProvider:I(Iw),OperationsMetadata:I(vw)});let ym=class extends dh{constructor(){super()}readFromNode(e){const t=X({},nw,e,[]);return t||null}};const iw=Z(Yt,{DeliveryPoint:I($),City:I($),AdministrativeArea:I($),PostalCode:I($),Country:I($),ElectronicMailAddress:I($)}),sw=Z(Yt,{Value:Me(Aw)}),ow=Z(Yt,{AllowedValues:I(_w)}),aw=Z(Yt,{Phone:I(Rw),Address:I(yw)}),lw=Z(Yt,{HTTP:I(ww)}),cw=Z(Yt,{Get:Me(Tw),Post:void 0}),uw=Z(Yt,{DCP:I(Ew)}),hw=Z(Yt,{Operation:Sw}),dw=Z(Yt,{Voice:I($),Facsimile:I($)}),fw=Z(Yt,{Constraint:Me(xw)}),pw=Z(Yt,{IndividualName:I($),PositionName:I($),ContactInfo:I(bw)}),gw=Z(Yt,{Abstract:I($),AccessConstraints:I($),Fees:I($),Title:I($),ServiceTypeVersion:I($),ServiceType:I($)}),mw=Z(Yt,{ProviderName:I($),ProviderSite:I(ys),ServiceContact:I(Pw)});function yw(n,e){return X({},iw,n,e)}function _w(n,e){return X({},sw,n,e)}function xw(n,e){const t=n.getAttribute("name");if(t)return X({name:t},ow,n,e)}function bw(n,e){return X({},aw,n,e)}function Ew(n,e){return X({},lw,n,e)}function Tw(n,e){const t=ys(n);if(t)return X({href:t},fw,n,e)}function ww(n,e){return X({},cw,n,e)}function Sw(n,e){const t=n.getAttribute("name"),r=X({},uw,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function vw(n,e){return X({},hw,n,e)}function Rw(n,e){return X({},dw,n,e)}function Cw(n,e){return X({},gw,n,e)}function Pw(n,e){return X({},pw,n,e)}function Iw(n,e){return X({},mw,n,e)}function Aw(n,e){return $(n)}function mf(n,e,t,r,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=n[o++];i[s++]=n[o++],i[s++]=a;for(let l=2;l<r;++l)i[s++]=n[o++]}return i.length=s,i}class Lw extends hh{constructor(e){super(),e=e||{},this.dataProjection=Ae("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t);return new Wt(r)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const r=I0(this.geometryLayout_),i=Mw(e,r,this.factor_);mf(i,0,i.length,r,i);const s=new Jr(i,this.geometryLayout_);return St(s,!1,this.adaptOptions(t))}writeFeatureText(e,t){const r=e.getGeometry();if(r)return this.writeGeometryText(r,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=St(e,!0,this.adaptOptions(t));const r=e.getFlatCoordinates(),i=e.getStride();return mf(r,0,r.length,i,r),Fw(r,i,this.factor_)}}function Fw(n,e,t){t=t||1e5;const r=new Array(e).fill(0);for(let i=0,s=n.length;i<s;)for(let o=0;o<e;++o,++i){const a=n[i]*t,l=a<0?Math.ceil(a-.5):Math.round(a),c=l-r[o];r[o]=l,n[i]=c}return Ow(n)}function Mw(n,e,t){t=t||1e5;const r=new Array(e).fill(0),i=Nw(n);for(let s=0,o=i.length;s<o;)for(let a=0;a<e;++a,++s)r[a]+=i[s],i[s]=r[a]/t;return i}function Ow(n){for(let e=0,t=n.length;e<t;++e){const r=n[e];n[e]=r<0?~(r<<1):r<<1}return Dw(n)}function Nw(n){const e=Gw(n);for(let t=0,r=e.length;t<r;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function Dw(n){let e="";for(let t=0,r=n.length;t<r;++t)e+=kw(n[t]);return e}function Gw(n){const e=[];let t=0,r=0;for(let i=0,s=n.length;i<s;++i){const o=n.charCodeAt(i)-63;t|=(o&31)<<r,o<32?(e.push(t),t=0,r=0):r+=5}return e}function kw(n){let e,t="";for(;n>=32;)e=(32|n&31)+63,t+=String.fromCharCode(e),n>>=5;return e=n+63,t+=String.fromCharCode(e),t}class Se extends z{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,r){const i=r[r.length-1];r[r.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,r)}}Se.prototype.namespace="http://www.opengis.net/gml/3.2";Se.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:re(z.prototype.readFlatPos),posList:re(z.prototype.readFlatPosList),coordinates:re(he.prototype.readFlatCoordinates)}};Se.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:z.prototype.interiorParser,exterior:z.prototype.exteriorParser}};Se.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:re(H.prototype.readPoint),MultiPoint:re(H.prototype.readMultiPoint),LineString:re(H.prototype.readLineString),MultiLineString:re(H.prototype.readMultiLineString),LinearRing:re(H.prototype.readLinearRing),Polygon:re(H.prototype.readPolygon),MultiPolygon:re(H.prototype.readMultiPolygon),Surface:re(Se.prototype.readSurface),MultiSurface:re(z.prototype.readMultiSurface),Curve:re(Se.prototype.readCurve),MultiCurve:re(z.prototype.readMultiCurve),Envelope:re(Se.prototype.readEnvelope)}};Se.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Q(z.prototype.curveMemberParser),curveMembers:Q(z.prototype.curveMemberParser)}};Se.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Q(z.prototype.surfaceMemberParser),surfaceMembers:Q(z.prototype.surfaceMemberParser)}};Se.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Q(H.prototype.readLineString),Curve:Q(z.prototype.readCurve)}};Se.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Q(H.prototype.readPolygon),Surface:Q(z.prototype.readSurface)}};Se.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:re(z.prototype.readPatch)}};Se.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:re(z.prototype.readSegment)}};Se.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Q(z.prototype.readFlatPosList),upperCorner:Q(z.prototype.readFlatPosList)}};Se.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:re(z.prototype.readPolygonPatch)}};Se.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Sg(z.prototype.readLineStringSegment)}};Se.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Q(H.prototype.pointMemberParser),pointMembers:Q(H.prototype.pointMemberParser)}};Se.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Q(H.prototype.lineStringMemberParser),lineStringMembers:Q(H.prototype.lineStringMemberParser)}};Se.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Q(H.prototype.polygonMemberParser),polygonMembers:Q(H.prototype.polygonMemberParser)}};Se.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Q(H.prototype.readFlatCoordinatesFromNode)}};Se.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Q(H.prototype.readLineString)}};Se.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Q(H.prototype.readPolygon)}};Se.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:re(H.prototype.readFlatLinearRing),Ring:re(Se.prototype.readFlatCurveRing)}};Se.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:F(z.prototype.writeRing),interior:F(z.prototype.writeRing)}};Se.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:F(fe),upperCorner:F(fe)}};Se.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:F(z.prototype.writeSurfaceOrPolygonMember),polygonMember:F(z.prototype.writeSurfaceOrPolygonMember)}};Se.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:F(z.prototype.writePointMember)}};Se.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:F(z.prototype.writeLineStringOrCurveMember),curveMember:F(z.prototype.writeLineStringOrCurveMember)}};Se.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:F(z.prototype.writeCurveOrLineString),MultiCurve:F(z.prototype.writeMultiCurveOrLineString),Point:F(Se.prototype.writePoint),MultiPoint:F(z.prototype.writeMultiPoint),LineString:F(z.prototype.writeCurveOrLineString),MultiLineString:F(z.prototype.writeMultiCurveOrLineString),LinearRing:F(z.prototype.writeLinearRing),Polygon:F(z.prototype.writeSurfaceOrPolygon),MultiPolygon:F(z.prototype.writeMultiSurfaceOrPolygon),Surface:F(z.prototype.writeSurfaceOrPolygon),MultiSurface:F(z.prototype.writeMultiSurfaceOrPolygon),Envelope:F(z.prototype.writeEnvelope)}};class _m{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class Uw extends _m{constructor(e,t){super(e),this.conditions=t,cr(this.conditions.length>=2,"At least 2 conditions are required")}}class Bw extends Uw{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class zw extends _m{constructor(e,t,r){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=r}}function $w(n){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Bw,e))}function jw(n,e,t){return new zw(n,e,t)}const yf={"http://www.opengis.net/gml":{boundedBy:I(H.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Q(H.prototype.readFeaturesInternal)}},Xw={"http://www.opengis.net/wfs":{totalInserted:I(ot),totalUpdated:I(ot),totalDeleted:I(ot)},"http://www.opengis.net/wfs/2.0":{totalInserted:I(ot),totalUpdated:I(ot),totalDeleted:I(ot)}},Vw={"http://www.opengis.net/wfs":{TransactionSummary:I(xf,"transactionSummary"),InsertResults:I(Ef,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:I(xf,"transactionSummary"),InsertResults:I(Ef,"insertIds")}},Ww={"http://www.opengis.net/wfs":{PropertyName:F(fe)},"http://www.opengis.net/wfs/2.0":{PropertyName:F(fe)}},xm={"http://www.opengis.net/wfs":{Insert:F(Tf),Update:F(Sf),Delete:F(wf),Property:F(vf),Native:F(Rf)},"http://www.opengis.net/wfs/2.0":{Insert:F(Tf),Update:F(Sf),Delete:F(wf),Property:F(vf),Native:F(Rf)}},bm="feature",fh="http://www.w3.org/2000/xmlns/",ph={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Jc={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},gh={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},_f={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},mh={"2.0.0":Se,"1.1.0":z,"1.0.0":he},Zw="1.1.0";class Yw extends sl{constructor(e){super(),e=e||{},this.version_=e.version?e.version:Zw,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new mh[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:_f[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const i=[r];let s;this.version_==="2.0.0"?s=yf:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=X([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=ha(e);return this.readTransactionResponseFromDocument(t)}return da(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=ha(e);return this.readFeatureCollectionMetadataFromDocument(t)}return da(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=On(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,X(t,yf,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return X({},Vw,e,[])}writeGetFeature(e){const t=se(Jc[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(js,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),cr(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(cr(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),Df(t,e.featureTypes,[r])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:i.geometryName,filter:s}),Df(t,[i.name],[r])});return t}combineBboxAndFilter(e,t,r,i){const s=jw(e,t,r);return i?$w(i,s):s}writeTransaction(e,t,r,i){const s=[],o=i.version?i.version:this.version_,a=se(Jc[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(js,"xsi:schemaLocation",_f[o]);const c=Hw(a,l,o,i);return e&&jo("Insert",e,s,c),t&&jo("Update",t,s,c),r&&jo("Delete",r,s,c),i.nativeElements&&jo("Native",i.nativeElements,s,c),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const r=[{}];return this.gmlFormat_.readGeometryElement(t,r),Ae(r.pop().srsName)}}return null}}function Hw(n,e,t,r){const i=r.featurePrefix?r.featurePrefix:bm;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:n},{version:t,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:i,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},e)}function jo(n,e,t,r){Ue(r,xm,ar(n),e,t)}function xf(n,e){return X({},Xw,n,e)}const qw={"http://www.opengis.net/ogc":{FeatureId:Q(function(n,e){return n.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:Q(function(n,e){return n.getAttribute("fid")})}};function bf(n,e){Bn(qw,n,e)}const Kw={"http://www.opengis.net/wfs":{Feature:bf},"http://www.opengis.net/wfs/2.0":{Feature:bf}};function Ef(n,e){return X([],Kw,n,e)}function Tf(n,e,t){const r=t[t.length-1],i=r.featureType,s=r.featureNS,o=r.gmlVersion,a=se(s,i);n.appendChild(a),o===2?he.prototype.writeFeatureElement(a,e,t):o===3?z.prototype.writeFeatureElement(a,e,t):Se.prototype.writeFeatureElement(a,e,t)}function Em(n,e,t){const i=t[t.length-1].version,s=ph[i],o=se(s,"Filter"),a=se(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),n.appendChild(o)}function yh(n,e){n=n||bm;const t=n+":";return e.startsWith(t)?e:t+e}function wf(n,e,t){const r=t[t.length-1];cr(e.getId()!==void 0,"Features must have an id set");const i=r.featureType,s=r.featurePrefix,o=r.featureNS,a=yh(s,i);n.setAttribute("typeName",a),n.setAttributeNS(fh,"xmlns:"+s,o);const l=e.getId();l!==void 0&&Em(n,l,t)}function Sf(n,e,t){const r=t[t.length-1];cr(e.getId()!==void 0,"Features must have an id set");const i=r.version,s=r.featureType,o=r.featurePrefix,a=r.featureNS,l=yh(o,s),c=e.getGeometryName();n.setAttribute("typeName",l),n.setAttributeNS(fh,"xmlns:"+o,a);const u=e.getId();if(u!==void 0){const h=e.getKeys(),d=[];for(let f=0,p=h.length;f<p;f++){const g=e.get(h[f]);if(g!==void 0){let m=h[f];g&&typeof g.getSimplifiedGeometry=="function"&&(m=c),d.push({name:m,value:g})}}Ue({version:i,gmlVersion:r.gmlVersion,node:n,hasZ:r.hasZ,srsName:r.srsName},xm,ar("Property"),d,t),Em(n,u,t)}}function vf(n,e,t){const r=t[t.length-1],i=r.version,s=Jc[i],a=se(s,i==="2.0.0"?"ValueReference":"Name"),l=r.gmlVersion;if(n.appendChild(a),fe(a,e.name),e.value!==void 0&&e.value!==null){const c=se(s,"Value");n.appendChild(c),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?he.prototype.writeGeometryElement(c,e.value,t):l===3?z.prototype.writeGeometryElement(c,e.value,t):Se.prototype.writeGeometryElement(c,e.value,t):fe(c,e.value)}}function Rf(n,e,t){e.vendorId&&n.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&n.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&fe(n,e.value)}const yl={"http://www.opengis.net/wfs":{Query:F(Cf)},"http://www.opengis.net/wfs/2.0":{Query:F(Cf)},"http://www.opengis.net/ogc":{During:F(Af),And:F(Xo),Or:F(Xo),Not:F(Lf),BBOX:F(Pf),Contains:F(Ln),Intersects:F(Ln),Within:F(Ln),DWithin:F(If),PropertyIsEqualTo:F(dr),PropertyIsNotEqualTo:F(dr),PropertyIsLessThan:F(dr),PropertyIsLessThanOrEqualTo:F(dr),PropertyIsGreaterThan:F(dr),PropertyIsGreaterThanOrEqualTo:F(dr),PropertyIsNull:F(Ff),PropertyIsBetween:F(Mf),PropertyIsLike:F(Of)},"http://www.opengis.net/fes/2.0":{During:F(Af),And:F(Xo),Or:F(Xo),Not:F(Lf),BBOX:F(Pf),Contains:F(Ln),Disjoint:F(Ln),Intersects:F(Ln),ResourceId:F(Qw),Within:F(Ln),DWithin:F(If),PropertyIsEqualTo:F(dr),PropertyIsNotEqualTo:F(dr),PropertyIsLessThan:F(dr),PropertyIsLessThanOrEqualTo:F(dr),PropertyIsGreaterThan:F(dr),PropertyIsGreaterThanOrEqualTo:F(dr),PropertyIsNull:F(Ff),PropertyIsBetween:F(Mf),PropertyIsLike:F(Of)}};function Cf(n,e,t){const r=t[t.length-1],i=r.version,s=r.featurePrefix,o=r.featureNS,a=r.propertyNames,l=r.srsName;let c;s?c=yh(s,e):c=e;let u;i==="2.0.0"?u="typeNames":u="typeName",n.setAttribute(u,c),l&&n.setAttribute("srsName",l),o&&n.setAttributeNS(fh,"xmlns:"+s,o);const h=Object.assign({},r);h.node=n,Ue(h,Ww,ar("PropertyName"),a,t);const d=r.filter;if(d){const f=se(_l(i),"Filter");n.appendChild(f),Jw(f,d,t)}}function Jw(n,e,t){const r=t[t.length-1],i={node:n};Object.assign(i,{context:r}),Ue(i,yl,ar(e.getTagName()),[e],t)}function Pf(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=mh[s];_s(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.extent,t)}function Qw(n,e,t){n.setAttribute("rid",e.rid)}function Ln(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=mh[s];_s(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.geometry,t)}function If(n,e,t){const s=t[t.length-1].context.version;Ln(n,e,t);const o=se(_l(s),"Distance");fe(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),n.appendChild(o)}function Af(n,e,t){const s=t[t.length-1].context.version;Ia(gh[s],"ValueReference",n,e.propertyName);const o=se(_n,"TimePeriod");n.appendChild(o);const a=se(_n,"begin");o.appendChild(a),Nf(a,e.begin);const l=se(_n,"end");o.appendChild(l),Nf(l,e.end)}function Xo(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const c=o[a];Ue(s,yl,ar(c.getTagName()),[c],t)}}function Lf(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.condition;Ue(s,yl,ar(o.getTagName()),[o],t)}function dr(n,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),_s(s,n,e.propertyName),Aa(s,n,""+e.expression)}function Ff(n,e,t){const s=t[t.length-1].context.version;_s(s,n,e.propertyName)}function Mf(n,e,t){const s=t[t.length-1].context.version,o=_l(s);_s(s,n,e.propertyName);const a=se(o,"LowerBoundary");n.appendChild(a),Aa(s,a,""+e.lowerBoundary);const l=se(o,"UpperBoundary");n.appendChild(l),Aa(s,l,""+e.upperBoundary)}function Of(n,e,t){const s=t[t.length-1].context.version;n.setAttribute("wildCard",e.wildCard),n.setAttribute("singleChar",e.singleChar),n.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),_s(s,n,e.propertyName),Aa(s,n,""+e.pattern)}function Ia(n,e,t,r){const i=se(n,e);fe(i,r),t.appendChild(i)}function Aa(n,e,t){Ia(_l(n),"Literal",e,t)}function _s(n,e,t){n==="2.0.0"?Ia(gh[n],"ValueReference",e,t):Ia(ph[n],"PropertyName",e,t)}function Nf(n,e){const t=se(_n,"TimeInstant");n.appendChild(t);const r=se(_n,"timePosition");t.appendChild(r),fe(r,e)}function Df(n,e,t){const r=t[t.length-1],i=Object.assign({},r);i.node=n,Ue(i,yl,ar("Query"),e,t)}function _l(n){let e;return n==="2.0.0"?e=gh[n]:e=ph[n],e}const Oe={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Gf{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readLineString());return t}readWkbHeader(e){const r=this.readUint8()>0,i=this.readUint32(r),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),c=(i&268435455)%1e3,u=["XY",o?"Z":"",a?"M":""].join(""),h=l?this.readUint32(r):null;if(e!==void 0&&e!==c)throw new Error("Unexpected WKB geometry type "+c);if(this.initialized_){if(this.isLittleEndian_!==r)throw new Error("Inconsistent endian");if(this.layout_!==u)throw new Error("Inconsistent geometry layout");if(h&&this.srid_!==h)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=r,this.hasZ_=o,this.hasM_=a,this.layout_=u,this.srid_=h,this.initialized_=!0;return c}readWkbPayload(e){switch(e){case Oe.POINT:return this.readPoint();case Oe.LINE_STRING:return this.readLineString();case Oe.POLYGON:case Oe.TRIANGLE:return this.readPolygon();case Oe.MULTI_POINT:return this.readMultiPoint();case Oe.MULTI_LINE_STRING:return this.readMultiLineString();case Oe.MULTI_POLYGON:case Oe.POLYHEDRAL_SURFACE:case Oe.TIN:return this.readMultiPolygon();case Oe.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const r=this.readUint32(),i=[];for(let s=0;s<r;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Oe.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Oe.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Oe.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case Oe.POINT:return new Er(t,this.layout_);case Oe.LINE_STRING:return new Jr(t,this.layout_);case Oe.POLYGON:case Oe.TRIANGLE:return new _i(t,this.layout_);case Oe.MULTI_POINT:return new il(t,this.layout_);case Oe.MULTI_LINE_STRING:return new ds(t,this.layout_);case Oe.MULTI_POLYGON:case Oe.POLYHEDRAL_SURFACE:case Oe.TIN:return new fo(t,this.layout_);case Oe.GEOMETRY_COLLECTION:return new Xn(t);default:return null}}getSrid(){return this.srid_}}class eS{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const r=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in r?r[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writePoint(e[r],t)}writePolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeLineString(e[r],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const r=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof Ud)return r(e.getLayout(),t);if(e instanceof Xn){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const r={Point:Oe.POINT,LineString:Oe.LINE_STRING,Polygon:Oe.POLYGON,MultiPoint:Oe.MULTI_POINT,MultiLineString:Oe.MULTI_LINE_STRING,MultiPolygon:Oe.MULTI_POLYGON,GeometryCollection:Oe.GEOMETRY_COLLECTION},i=e.getType(),s=r[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof Ud?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof Xn&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),r=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:r.setUint8(i,s[1]);break;case 4:r.setUint32(i,s[1],this.isLittleEndian_);break;case 8:r.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class tS extends Rg{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Wt({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let r=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof Xn?r=i.getGeometriesArray():r=[i],r.map(s=>new Wt({geometry:s}))}readGeometry(e,t){const r=kf(e);if(!r)return null;const s=new Gf(r).readGeometry();return this.viewCache_=r,t=this.getReadOptions(e,t),this.viewCache_=null,St(s,!1,t)}readProjection(e){const t=this.viewCache_||kf(e);if(!t)return;const r=new Gf(t);return r.readWkbHeader(),r.getSrid()&&Ae("EPSG:"+r.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new Xn(e.map(r=>r.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const r=new eS({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&Ae(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}r.writeGeometry(St(e,!0,t),i);const s=r.getBuffer();return this.hex_?rS(s):s}}function rS(n){const e=new Uint8Array(n);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function nS(n){const e=new Uint8Array(n.length/2);for(let t=0;t<n.length/2;t++)e[t]=parseInt(n.substr(t*2,2),16);return new DataView(e.buffer)}function kf(n){return typeof n=="string"?nS(n):ArrayBuffer.isView(n)?n instanceof DataView?n:new DataView(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new DataView(n):null}const iS={POINT:Er,LINESTRING:Jr,POLYGON:_i,MULTIPOINT:il,MULTILINESTRING:ds,MULTIPOLYGON:fo},Tm="EMPTY",wm="Z",Sm="M",sS="ZM",Fe={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},oS={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class aS{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let r=e,i;if(e=="(")i=Fe.LEFT_PAREN;else if(e==",")i=Fe.COMMA;else if(e==")")i=Fe.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")i=Fe.NUMBER,r=this.readNumber_();else if(this.isAlpha_(e))i=Fe.TEXT,r=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")i=Fe.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:r,type:i}}readNumber_(){let e;const t=this.index_;let r=!1,i=!1;do e=="."?r=!0:(e=="e"||e=="E")&&(i=!0),e=this.nextChar_();while(this.isNumeric_(e,r)||!i&&(e=="e"||e=="E")||i&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class lS{constructor(e){this.lexer_=e,this.token_={position:0,type:Fe.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(Fe.TEXT)){const r=t.value;r===wm?e="XYZ":r===Sm?e="XYM":r===sS&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(Fe.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(Fe.COMMA));if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(Fe.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(Fe.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(Fe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(Fe.LEFT_PAREN)){let e;if(this.token_.type==Fe.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(Fe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(Fe.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(Fe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let r=0;r<t;++r){const i=this.token_;if(this.match(Fe.NUMBER))e.push(i.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(Fe.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(Fe.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(Fe.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(Fe.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(Fe.TEXT)&&this.token_.value==Tm;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(Fe.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const r=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(r)return new Xn([]);const o=this.parseGeometryCollectionText_();return new Xn(o)}const i=iS[t];if(!i)throw new Error("Invalid geometry type: "+t);let s;if(r)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new i(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class cS extends hh{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new aS(e);return new lS(t).parse()}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t),i=new Wt;return i.setGeometry(r),i}readFeaturesFromText(e,t){let r=[];const i=this.readGeometryFromText(e,t);this.splitCollection_&&i.getType()=="GeometryCollection"?r=i.getGeometriesArray():r=[i];const s=[];for(let o=0,a=r.length;o<a;++o){const l=new Wt;l.setGeometry(r[o]),s.push(l)}return s}readGeometryFromText(e,t){const r=this.parse_(e);return St(r,!1,t)}writeFeatureText(e,t){const r=e.getGeometry();return r?this.writeGeometryText(r,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const r=[];for(let s=0,o=e.length;s<o;++s)r.push(e[s].getGeometry());const i=new Xn(r);return this.writeGeometryText(i,t)}writeGeometryText(e,t){return Cm(St(e,!0,t))}}function vm(n){const e=n.getCoordinates();return e.length===0?"":e.join(" ")}function uS(n){const e=[],t=n.getPoints();for(let r=0,i=t.length;r<i;++r)e.push("("+vm(t[r])+")");return e.join(",")}function hS(n){const e=[],t=n.getGeometries();for(let r=0,i=t.length;r<i;++r)e.push(Cm(t[r]));return e.join(",")}function _h(n){const e=n.getCoordinates(),t=[];for(let r=0,i=e.length;r<i;++r)t.push(e[r].join(" "));return t.join(",")}function dS(n){const e=[],t=n.getLineStrings();for(let r=0,i=t.length;r<i;++r)e.push("("+_h(t[r])+")");return e.join(",")}function Rm(n){const e=[],t=n.getLinearRings();for(let r=0,i=t.length;r<i;++r)e.push("("+_h(t[r])+")");return e.join(",")}function fS(n){const e=[],t=n.getPolygons();for(let r=0,i=t.length;r<i;++r)e.push("("+Rm(t[r])+")");return e.join(",")}function pS(n){const e=n.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=wm),(e==="XYM"||e==="XYZM")&&(t+=Sm),t}const gS={Point:vm,LineString:_h,Polygon:Rm,MultiPoint:uS,MultiLineString:dS,MultiPolygon:fS,GeometryCollection:hS};function Cm(n){const e=n.getType(),t=gS[e],r=t(n);let i=oS[e];if(typeof n.getFlatCoordinates=="function"){const s=pS(n);s.length>0&&(i+=" "+s)}return r.length===0?i+" "+Tm:i+"("+r+")"}const bt=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function vo(n){return A0(n[0].version,"1.3")>=0}const mS=Z(bt,{Service:I(kS),Capability:I(GS)}),yS=Z(bt,{Request:I(ZS),Exception:I($S),Layer:I(jS),UserDefinedSymbolization:I(NS)});class _S extends dh{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=X({version:this.version},mS,e,[]);return t||null}}const Pm={Name:I($),Title:I($),Abstract:I($),KeywordList:I(Om),OnlineResource:I(ys),ContactInformation:I(US),Fees:I($),AccessConstraints:I($)},xS=Z(bt,Pm),bS=Z(bt,{...Pm,LayerLimit:I(ot),MaxWidth:I(ot),MaxHeight:I(ot)}),ES=Z(bt,{ContactPersonPrimary:I(BS),ContactPosition:I($),ContactAddress:I(zS),ContactVoiceTelephone:I($),ContactFacsimileTelephone:I($),ContactElectronicMailAddress:I($)}),TS=Z(bt,{ContactPerson:I($),ContactOrganization:I($)}),wS=Z(bt,{AddressType:I($),Address:I($),City:I($),StateOrProvince:I($),PostCode:I($),Country:I($)}),SS=Z(bt,{Format:Q($)}),Im={Name:I($),Title:I($),Abstract:I($),KeywordList:I(Om),BoundingBox:Me(Fm),Dimension:Me(XS),Attribution:I(OS),AuthorityURL:Me(qS),Identifier:Me($),MetadataURL:Me(KS),DataURL:Me(En),FeatureListURL:Me(En),Style:Me(JS),Layer:Me(xl)},Am=Z(bt,{...Im,SRS:Me($),Extent:I(VS),ScaleHint:Me(WS),LatLonBoundingBox:I((n,e)=>Fm(n,e,!1)),Layer:Me(xl)}),Lm=Z(bt,{...Im,CRS:Me($),EX_GeographicBoundingBox:I(DS),MinScaleDenominator:I(Ft),MaxScaleDenominator:I(Ft),Layer:Me(xl)}),vS=Z(bt,{Title:I($),OnlineResource:I(ys),LogoURL:I(Mm)}),RS=Z(bt,{westBoundLongitude:I(Ft),eastBoundLongitude:I(Ft),southBoundLatitude:I(Ft),northBoundLatitude:I(Ft)}),CS=Z(bt,{GetCapabilities:I(Cs),GetMap:I(Cs),GetFeatureInfo:I(Cs),DescribeLayer:I(Cs),GetLegendGraphic:I(Cs)}),PS=Z(bt,{Format:Me($),DCPType:Me(YS)}),IS=Z(bt,{HTTP:I(HS)}),AS=Z(bt,{Get:I(En),Post:I(En)}),LS=Z(bt,{Name:I($),Title:I($),Abstract:I($),LegendURL:Me(Mm),StyleSheetURL:I(En),StyleURL:I(En)}),FS=Z(bt,{Format:I($),OnlineResource:I(ys)}),MS=Z(bt,{Keyword:Q($)});function OS(n,e){return X({},vS,n,e)}function NS(n,e){return{SupportSLD:!!Qt(n.getAttribute("SupportSLD")),UserLayer:!!Qt(n.getAttribute("UserLayer")),UserStyle:!!Qt(n.getAttribute("UserStyle")),RemoteWFS:!!Qt(n.getAttribute("RemoteWFS")),InlineFeatureData:!!Qt(n.getAttribute("InlineFeatureData")),RemoteWCS:!!Qt(n.getAttribute("RemoteWCS"))}}function Fm(n,e,t=!0){const r=[$r(n.getAttribute("minx")),$r(n.getAttribute("miny")),$r(n.getAttribute("maxx")),$r(n.getAttribute("maxy"))],i=[$r(n.getAttribute("resx")),$r(n.getAttribute("resy"))],s={extent:r,res:i};return t&&(vo(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function DS(n,e){const t=X({},RS,n,e);if(!t)return;const r=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(r===void 0||i===void 0||s===void 0||o===void 0))return[r,i,s,o]}function GS(n,e){return X({},yS,n,e)}function kS(n,e){return X({},vo(e)?bS:xS,n,e)}function US(n,e){return X({},ES,n,e)}function BS(n,e){return X({},TS,n,e)}function zS(n,e){return X({},wS,n,e)}function $S(n,e){return X([],SS,n,e)}function jS(n,e){const t=X({},vo(e)?Lm:Am,n,e);return t.Layer===void 0?Object.assign(t,xl(n,e)):t}function xl(n,e){const t=vo(e),r=e[e.length-1],i=X({},t?Lm:Am,n,e);if(!i)return;let s=Qt(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),i.queryable=s!==void 0?s:!1;let o=On(n.getAttribute("cascaded"));o===void 0&&(o=r.cascaded),i.cascaded=o;let a=Qt(n.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let l=Qt(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),i.noSubsets=l!==void 0?l:!1;let c=$r(n.getAttribute("fixedWidth"));c||(c=r.fixedWidth),i.fixedWidth=c;let u=$r(n.getAttribute("fixedHeight"));u||(u=r.fixedHeight),i.fixedHeight=u;const h=["Style","AuthorityURL"];t?h.push("CRS"):h.push("SRS","Dimension"),h.forEach(function(f){if(f in r){const p=i[f]||[];i[f]=p.concat(r[f])}});const d=["BoundingBox","Attribution"];return t?d.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):d.push("LatLonBoundingBox","ScaleHint","Extent"),d.forEach(function(f){if(!(f in i)){const p=r[f];i[f]=p}}),i}function XS(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return vo(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:Qt(n.getAttribute("multipleValues")),nearestValue:Qt(n.getAttribute("nearestValue")),current:Qt(n.getAttribute("current")),values:$(n)}),t}function VS(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:Qt(n.getAttribute("nearestValue"))}}function WS(n,e){return{min:$r(n.getAttribute("min")),max:$r(n.getAttribute("max"))}}function En(n,e){return X({},FS,n,e)}function ZS(n,e){return X({},CS,n,e)}function YS(n,e){return X({},IS,n,e)}function HS(n,e){return X({},AS,n,e)}function Cs(n,e){return X({},PS,n,e)}function Mm(n,e){const t=En(n,e);if(t){const r=[On(n.getAttribute("width")),On(n.getAttribute("height"))];return t.size=r,t}}function qS(n,e){const t=En(n,e);if(t)return t.name=n.getAttribute("name"),t}function KS(n,e){const t=En(n,e);if(t)return t.type=n.getAttribute("type"),t}function JS(n,e){return X({},LS,n,e)}function Om(n,e){return X([],MS,n,e)}const QS="_feature",e1="_layer";class t1 extends sl{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new he,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const r=e.localName;let i=[];if(e.childNodes.length===0)return i;if(r=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,c=t[0],u=e1,h=l.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(h))continue;const d=h+QS;c.featureType=d,c.featureNS=this.featureNS_;const f={};f[d]=Q(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const p=Z([c.featureNS,null],f);l.setAttribute("namespaceURI",this.featureNS_);const g=X([],p,l,t,this.gmlFormat_);g&&ua(i,g)}if(r=="FeatureCollection"){const s=X([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const r={};return t&&Object.assign(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])}}const en=[null,"http://www.opengis.net/wmts/1.0"],xs=[null,"http://www.opengis.net/ows/1.1"],r1=Z(en,{Contents:I(d1)});let Nm=class extends dh{constructor(){super(),this.owsParser_=new ym}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=X(r,r1,e,[]),r||null):null}};const n1=Z(en,{Layer:Me(f1),TileMatrixSet:Me(p1)}),i1=Z(en,{Style:Me(g1),Format:Me($),TileMatrixSetLink:Me(m1),Dimension:Me(y1),ResourceURL:Me(_1)},Z(xs,{Title:I($),Abstract:I($),WGS84BoundingBox:I(Gm),BoundingBox:Me(x1),Identifier:I($)})),s1=Z(en,{LegendURL:Me(b1)},Z(xs,{Title:I($),Identifier:I($)})),o1=Z(en,{TileMatrixSet:I($),TileMatrixSetLimits:I(T1)}),a1=Z(en,{TileMatrixLimits:Q(w1)}),l1=Z(en,{TileMatrix:I($),MinTileRow:I(ot),MaxTileRow:I(ot),MinTileCol:I(ot),MaxTileCol:I(ot)}),c1=Z(en,{Default:I($),Value:Me($)},Z(xs,{Identifier:I($)})),Dm=Z(xs,{LowerCorner:Q(Qc),UpperCorner:Q(Qc)}),u1=Z(en,{WellKnownScaleSet:I($),TileMatrix:Me(E1)},Z(xs,{SupportedCRS:I($),Identifier:I($),BoundingBox:I(Gm)})),h1=Z(en,{TopLeftCorner:I(Qc),ScaleDenominator:I(Ft),TileWidth:I(ot),TileHeight:I(ot),MatrixWidth:I(ot),MatrixHeight:I(ot)},Z(xs,{Identifier:I($)}));function d1(n,e){return X({},n1,n,e)}function f1(n,e){return X({},i1,n,e)}function p1(n,e){return X({},u1,n,e)}function g1(n,e){const t=X({},s1,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function m1(n,e){return X({},o1,n,e)}function y1(n,e){return X({},c1,n,e)}function _1(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function Gm(n,e){const t=X([],Dm,n,e);if(t.length==2)return ku(t)}function x1(n,e){const t=n.getAttribute("crs"),r=X([],Dm,n,e);if(r.length==2)return{extent:ku(r),crs:t}}function b1(n,e){const t={};return t.format=n.getAttribute("format"),t.href=ys(n),t}function Qc(n,e){const t=$(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function E1(n,e){return X({},h1,n,e)}function T1(n,e){return X([],a1,n,e)}function w1(n,e){return X({},l1,n,e)}window.eoxMapAdvancedOlFormats={EsriJSON:BE,GML:oh,GPX:fT,IGC:HT,IIIFInfo:tw,KML:F0,OWS:ym,Polyline:Lw,TopoJSON:L0,WFS:Yw,WKB:tS,WKT:cS,WMSCapabilities:_S,WMSGetFeatureInfo:t1,WMTSCapabilities:Nm};function km(n,e,t){const r=[];let i=n(0),s=n(1),o=e(i),a=e(s);const l=[s,i],c=[a,o],u=[1,0],h={};let d=1e5,f,p,g,m,y,_;for(;--d>0&&u.length>0;)g=u.pop(),i=l.pop(),o=c.pop(),_=g.toString(),_ in h||(r.push(o[0],o[1]),h[_]=!0),m=u.pop(),s=l.pop(),a=c.pop(),y=(g+m)/2,f=n(y),p=e(f),M0(p[0],p[1],o[0],o[1],a[0],a[1])<t?(r.push(a[0],a[1]),_=m.toString(),h[_]=!0):(u.push(m,y,y,g),c.push(a,p,p,o),l.push(s,f,f,i));return r}function S1(n,e,t,r,i){const s=Ae("EPSG:4326");return km(function(o){return[n,e+(t-e)*o]},pa(s,r),i)}function v1(n,e,t,r,i){const s=Ae("EPSG:4326");return km(function(o){return[e+(t-e)*o,n]},pa(s,r),i)}function R1(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=n.inversePixelTransform[0],t=n.inversePixelTransform[1],r=Math.sqrt(e*e+t*t),i=n.frameState,s=Xs(n.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=O0(i.viewState.resolution,r);let a;return new N0(n.context,r,i.extent,s,i.viewState.rotation,o,a)}const C1=new Nc({color:"rgba(0,0,0,0.2)"}),P1=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class I1 extends D0{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:C1,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?Bd.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?Bd.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Yl({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new zd({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new $d({color:"rgba(0,0,0,1)"}),stroke:new Nc({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=r=>{const i=r.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Yl({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new zd({font:"12px Calibri,sans-serif",textAlign:"right",fill:new $d({color:"rgba(0,0,0,1)"}),stroke:new Nc({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=r=>{const i=r.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(ii.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:P1,this.setSource(new Uu({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new G0,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Yl({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let r=e.slice();return this.projection_&&this.getSource().getWrapX()&&k0(r,this.projection_),this.loadedExtent_&&(U0(this.loadedExtent_,r,t)?r=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[r]}loaderFunction(e,t,r){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=Xr(s,e);if(this.renderedExtent_&&Vs(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,Bu(o)))return;const a=zn(o),l=t*t/4;(!this.projection_||!na(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(o,a,t,l);let u=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(u+=this.meridians_.length),this.parallelsLabels_&&(u+=this.parallels_.length);let h;for(;u>this.featurePool_.length;)h=new Wt,this.featurePool_.push(h);const d=i.getFeaturesCollection();d.clear();let f=0,p,g;for(p=0,g=this.meridians_.length;p<g;++p)h=this.featurePool_[f++],h.setGeometry(this.meridians_[p]),h.setStyle(this.lineStyle_),d.push(h);for(p=0,g=this.parallels_.length;p<g;++p)h=this.featurePool_[f++],h.setGeometry(this.parallels_[p]),h.setStyle(this.lineStyle_),d.push(h)}addMeridian_(e,t,r,i,s,o){const a=this.getMeridian_(e,t,r,i,o);if(rs(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new Er([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,r,i,s,o){const a=this.getParallel_(e,t,r,i,o);if(rs(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new Er([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,r=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=zn(s);let a=s;if(t){const p=i[0]*r,g=i[1]*r;a=[o[0]-p/2,o[1]-g/2,o[0]+p/2,o[1]+g/2]}let l=0,c=0,u=this.latLabelPosition_<.5;const h=this.projection_.getExtent(),d=Pt(h);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!la(h,s)){l=Math.floor((s[0]-h[0])/d),c=Math.ceil((s[2]-h[2])/d);const p=Math.abs(t)>Math.PI/2;u=u!==p}const f=R1(e);for(let p=l;p<=c;++p){let g=this.meridians_.length+this.parallels_.length,m,y,_,x;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){const E=this.meridians_[y];if(!t&&p===0)x=this.getMeridianPoint_(E,s,y);else{const b=E.clone();b.translate(p*d,0),b.rotate(-t,o),x=this.getMeridianPoint_(b,a,y),x.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(x),m.set("graticule_label",this.meridiansLabels_[y].text),f.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(p===l&&u||p===c&&!u))for(y=0,_=this.parallels_.length;y<_;++y){const E=this.parallels_[y];if(!t&&p===0)x=this.getParallelPoint_(E,s,y);else{const b=E.clone();b.translate(p*d,0),b.rotate(-t,o),x=this.getParallelPoint_(b,a,y),x.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(x),m.set("graticule_label",this.parallelsLabels_[y].text),f.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(e,t,r,i){const s=this.getInterval_(r);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=Pt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!la(a,e)&&(Pt(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const c=[Qe(t[0],this.minX_,this.maxX_),Qe(t[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(c);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let h=Qe(u[0],this.minLon_,this.maxLon_),d=Qe(u[1],this.minLat_,this.maxLat_);const f=this.maxLines_;let p,g,m,y,_=e;o||(_=[Qe(e[0],this.minX_,this.maxX_),Qe(e[1],this.minY_,this.maxY_),Qe(e[2],this.minX_,this.maxX_),Qe(e[3],this.minY_,this.maxY_)]);const x=ns(_,this.toLonLatTransform_,void 0,8);let E=x[3],b=x[2],T=x[1],w=x[0];if(o||($i(_,this.bottomLeft_)&&(w=this.minLon_,T=this.minLat_),$i(_,this.bottomRight_)&&(b=this.maxLon_,T=this.minLat_),$i(_,this.topLeft_)&&(w=this.minLon_,E=this.maxLat_),$i(_,this.topRight_)&&(b=this.maxLon_,E=this.maxLat_),E=Qe(E,d,this.maxLat_),b=Qe(b,h,this.maxLon_),T=Qe(T,this.minLat_,d),w=Qe(w,this.minLon_,h)),h=Math.floor(h/s)*s,y=Qe(h,this.minLon_,this.maxLon_),g=this.addMeridian_(y,T,E,i,e,0),p=0,o)for(;(y-=s)>=w&&p++<f;)g=this.addMeridian_(y,T,E,i,e,g);else for(;y!=this.minLon_&&p++<f;)y=Math.max(y-s,this.minLon_),g=this.addMeridian_(y,T,E,i,e,g);if(y=Qe(h,this.minLon_,this.maxLon_),p=0,o)for(;(y+=s)<=b&&p++<f;)g=this.addMeridian_(y,T,E,i,e,g);else for(;y!=this.maxLon_&&p++<f;)y=Math.min(y+s,this.maxLon_),g=this.addMeridian_(y,T,E,i,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),d=Math.floor(d/s)*s,m=Qe(d,this.minLat_,this.maxLat_),g=this.addParallel_(m,w,b,i,e,0),p=0;m!=this.minLat_&&p++<f;)m=Math.max(m-s,this.minLat_),g=this.addParallel_(m,w,b,i,e,g);for(m=Qe(d,this.minLat_,this.maxLat_),p=0;m!=this.maxLat_&&p++<f;)m=Math.min(m+s,this.maxLat_),g=this.addParallel_(m,w,b,i,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)}getInterval_(e){const t=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,c=this.intervals_.length;l<c;++l){const u=Qe(this.intervals_[l]/2,0,90),h=Qe(r,-90+u,90-u);if(o[0]=t-u,o[1]=h-u,a[0]=t+u,a[1]=h+u,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,r,i,s){const o=S1(e,t,r,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new Jr(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,r){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),c=Qe(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),h=[i[s-1]+(i[o-1]-i[s-1])*(c-i[s])/(i[o]-i[s]),c],d=this.meridiansLabels_[r].geom;return d.setCoordinates(h),d}getMeridians(){return this.meridians_}getParallel_(e,t,r,i,s){const o=v1(e,t,r,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new Jr(o,"XY"),a}getParallelPoint_(e,t,r){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),c=Qe(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),u=i[s+1]+(i[o+1]-i[s+1])*(c-i[s])/(i[o]-i[s]),h=[c,u],d=this.parallelsLabels_[r].geom;return d.setCoordinates(h),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=Ae("EPSG:4326"),r=e.getWorldExtent();this.maxLat_=r[3],this.maxLon_=r[2],this.minLat_=r[1],this.minLon_=r[0];const i=pa(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,c){c=c||2;const u=i(a,l,c);for(let h=0,d=u.length;h<d;h+=c)u[h]<o&&(u[h]+=360);return u}}this.fromLonLatTransform_=pa(t,e);const s=ns([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(zn(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}function Pi(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function La(n,e){return n[0]=e[0],n[1]=e[1],n[4]=e[2],n[5]=e[3],n[12]=e[4],n[13]=e[5],n}function eu(n,e,t,r,i,s,o){o=o??Pi();const a=1/(n-e),l=1/(t-r),c=1/(i-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*c,o[11]=0,o[12]=(n+e)*a,o[13]=(r+t)*l,o[14]=(s+i)*c,o[15]=1,o}function Uf(n,e,t,r,i){return i=i??Pi(),i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i[4]=n[4]*t,i[5]=n[5]*t,i[6]=n[6]*t,i[7]=n[7]*t,i[8]=n[8]*r,i[9]=n[9]*r,i[10]=n[10]*r,i[11]=n[11]*r,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function A1(n,e,t,r,i){i=i??Pi();let s,o,a,l,c,u,h,d,f,p,g,m;return n===i?(i[12]=n[0]*e+n[4]*t+n[8]*r+n[12],i[13]=n[1]*e+n[5]*t+n[9]*r+n[13],i[14]=n[2]*e+n[6]*t+n[10]*r+n[14],i[15]=n[3]*e+n[7]*t+n[11]*r+n[15]):(s=n[0],o=n[1],a=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],f=n[8],p=n[9],g=n[10],m=n[11],i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=u,i[6]=h,i[7]=d,i[8]=f,i[9]=p,i[10]=g,i[11]=m,i[12]=s*e+c*t+f*r+n[12],i[13]=o*e+u*t+p*r+n[13],i[14]=a*e+h*t+g*r+n[14],i[15]=l*e+d*t+m*r+n[15]),i}function L1(n,e,t,r){return r=r??Pi(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n,r[13]=e,r[14]=t,r[15]=1,r}const wi=34962,Ro=34963,xh=35044,qi=35048,F1=5121,M1=5123,O1=5125,Um=5126,Bf=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function N1(n,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!B0},e);const t=Bf.length;for(let r=0;r<t;++r)try{const i=n.getContext(Bf[r],e);if(i)return i}catch{}return null}const D1={STATIC_DRAW:xh};class $n{constructor(e,t){this.array_=null,this.type_=e,cr(e===wi||e===Ro,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:D1.STATIC_DRAW}ofSize(e){return this.array_=new(Vo(this.type_))(e),this}fromArray(e){return this.array_=Vo(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Vo(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Vo(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Vo(n){switch(n){case wi:return Float32Array;case Ro:return Uint32Array;default:return Float32Array}}const Wo={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},G1=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,k1=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class zf{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||G1),t.compileShader(r);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||k1),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,c=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,r[0],r[1],o,a,l,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Ie(s.canvas);if(!e.renderTargets[l]){const c=s.getContextAttributes();c&&c.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,i=1;this.uniforms_.forEach(function(s){if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(s.location,i++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(s.location,r[0],r[1]);return;case 3:t.uniform3f(s.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(s.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(s.location,r)})}}const zr={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},rt={UNSIGNED_BYTE:F1,UNSIGNED_SHORT:M1,UNSIGNED_INT:O1,FLOAT:Um},Fa={};function $f(n){return"shared/"+n}let jf=0;function U1(){const n="unique/"+jf;return jf+=1,n}function B1(n){let e=Fa[n];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:N1(t)},Fa[n]=e}return e.users+=1,e.context}function z1(n){const e=Fa[n];if(!e||(e.users-=1,e.users>0))return;const t=e.context,r=t.getExtension("WEBGL_lose_context");r&&r.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Fa[n]}class $1 extends Cg{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?$f(e.canvasCacheKey):U1(),this.gl_=B1(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Wo.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Wo.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Ct(),this.offsetScaleMatrix_=Ct(),this.tmpMat4_=Pi(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(r=>new zf({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new zf({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===$f(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}getInstancedRenderingExtension_(){const e=this.getExtension("ANGLE_instanced_arrays");return cr(!!e,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),e}bindBuffer(e){const t=this.gl_,r=Ie(e);let i=this.bufferCache_[r];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[r]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=Ie(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Wo.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Wo.RESTORED,this.boundHandleWebGLContextRestored_),z1(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),r?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,r,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,r?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const i=r.UNSIGNED_INT,s=4,o=t-e,a=e*s;r.drawElements(r.TRIANGLES,o,i,a)}drawElementsInstanced(e,t,r){const i=this.gl_;this.getExtension("OES_element_index_uint");const s=this.getInstancedRenderingExtension_(),o=i.UNSIGNED_INT,a=4,l=t-e,c=e*a;s.drawElementsInstancedANGLE(i.TRIANGLES,l,o,c,r);for(let u=0;u<this.maxAttributeCount_;u++)s.vertexAttribDivisorANGLE(u,0)}finalizeDraw(e,t,r){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,r):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(zr.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(zr.ZOOM,e.viewState.zoom),this.setUniformFloatValue(zr.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(zr.PIXEL_RATIO,i),this.setUniformFloatVec2(zr.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(zr.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(zr.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(zr.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,i=0;this.uniforms_.forEach(s=>{if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=r):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&o&&s.prevValue!==r&&(s.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),i++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(s.name,La(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:t.uniform2f(this.getUniformLocation(s.name),r[0],r[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),r[0],r[1],r[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(this.getUniformLocation(s.name),r)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}getProgram(e,t){const r=this.gl_,i=this.compileShader(e,r.FRAGMENT_SHADER),s=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,s),r.linkProgram(o),!r.getShaderParameter(i,r.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getShaderParameter(s,r.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${r.getShaderInfoLog(s)}`;throw new Error(a)}if(r.deleteShader(s),!r.getProgramParameter(o,r.LINK_STATUS)){const a=`GL program linking failed: ${r.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Ie(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Ie(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return zu(t,0,0,2/(s*r[0]),2/(s*r[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,r,i,s,o){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,t,r,!1,i,s),o&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(a,1))}enableAttributes_(e,t){const r=j1(e);let i=0;for(let s=0;s<e.length;s++){const o=e[s];o.name&&this.enableAttributeArray_(o.name,o.size,o.type||Um,r,i,t),i+=o.size*Bm(o.type)}}enableAttributes(e){this.enableAttributes_(e,!1)}enableAttributesInstanced(e){this.enableAttributes_(e,!0)}handleWebGLContextLost(e){z0(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,i){const s=this.gl_;r=r||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,c=0,u=s.RGBA,h=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],c,u,h,t):t?s.texImage2D(s.TEXTURE_2D,a,l,u,h,t):s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],c,u,h,null),r}}function j1(n){let e=0;for(let t=0;t<n.length;t++){const r=n[t];e+=r.size*Bm(r.type)}return e}function Bm(n){switch(n){case rt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case rt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case rt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case rt.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class X1 extends $0{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(Vt.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===_e.LOADED,this.loaded)this.uploadTile();else{if(e instanceof $u){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(Vt.CHANGE,this.handleTileChange_)}}uploadTile(){hn()}setReady(){this.ready=!0,this.dispatchEvent(Vt.CHANGE)}handleTileChange_(){this.tile.getState()===_e.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(Vt.CHANGE,this.handleTileChange_)}}function zm(n,e,t){const r=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r)}function V1(n,e,t,r){zm(n,e,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}function Xf(n,e,t,r,i,s){const o=n.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,n.getExtension("OES_texture_float"),l=n.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),zm(o,e,s&&l);const c=t.byteLength/r[1];let u=1;c%8===0?u=8:c%4===0?u=4:c%2===0&&(u=2);let h;switch(i){case 1:{h=o.LUMINANCE;break}case 2:{h=o.LUMINANCE_ALPHA;break}case 3:{h=o.RGB;break}case 4:{h=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,h,r[0],r[1],0,h,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let Di=null;function W1(){Di=Vn(1,1,void 0,{willReadFrequently:!0})}class Z1 extends X1{constructor(e){super(e),this.textures=[],this.renderSize_=Ar(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new $n(wi,xh);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var r;const t=(r=this.helper)==null?void 0:r.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),r=this.tile;this.textures.length=0;let i;r instanceof $u||r instanceof j0?i=r.getImage():i=r.getData();const s=Gc(i);if(s){const _=t.createTexture();this.textures.push(_),this.bandCount=4,V1(t,_,s,r.interpolate),this.setReady();return}i=Dc(i);const o=r.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=i instanceof Float32Array,c=a[0]*a[1],u=l?Float32Array:Uint8Array,h=u.BYTES_PER_ELEMENT,d=i.byteLength/a[1];this.bandCount=Math.floor(d/h/a[0]);const f=Math.ceil(this.bandCount/4);if(f===1){const _=t.createTexture();this.textures.push(_),Xf(e,_,i,a,this.bandCount,r.interpolate),this.setReady();return}const p=new Array(f);for(let _=0;_<f;++_){const x=t.createTexture();this.textures.push(x);const E=_<f-1?4:(this.bandCount-1)%4+1;p[_]=new u(c*E)}let g=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let x=0;x<y;++x){const E=i[m+x],b=Math.floor(g/this.bandCount),T=x%this.bandCount,w=Math.floor(T/4),v=p[w],S=v.length/c,C=T%4;v[b*S+C]=E,++g}m+=d/h}for(let _=0;_<f;++_){const x=this.textures[_],E=p[_],b=E.length/c;Xf(e,x,E,a,b,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];Di||W1(),Di.clearRect(0,0,1,1);const a=e.width,l=e.height,c=a-2*i,u=l-2*i,h=i+Math.floor(c*(t/s)),d=i+Math.floor(u*(r/o));let f;try{Di.drawImage(e,h,d,1,1,0,0,1,1),f=Di.getImageData(0,0,1,1).data}catch{return Di=null,null}return f}getArrayPixelData_(e,t,r,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],c=t[1],u=l+2*s,h=c+2*s,d=s+Math.floor(l*(r/o)),f=s+Math.floor(c*(i/a));if(e instanceof DataView){const g=e.byteLength/(u*h),m=g*(f*u+d),y=e.buffer.slice(m,m+g);return new DataView(y)}const p=this.bandCount*(f*u+d);return e.slice(p,p+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof ju){const r=this.tile.getData(),i=Dc(r);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(Gc(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class Co extends X0{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Ct(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(kc.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(ii.PRECOMPOSE)){const i=new Hl(ii.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(ii.POSTCOMPOSE)){const i=new Hl(ii.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,r=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,c=l.getRenderer();if(!(c instanceof Co)){t=!0;continue}const u=l.getClassName();if((t||u!==i)&&(r+=1,t=!1),i=u,c===this)break}const s="map/"+e.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new $1({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(kc.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){zu(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const s=new Hl(e,this.inversePixelTransform_,r,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(ii.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(ii.POSTRENDER,e,t)}}const Y1={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function Vf(n){return 1/(n+2)}function H1(){return{tileIds:new Set,representationsByZ:{}}}function Wf(n,e){return n.tileIds.has(Ie(e))}function Zf(n,e,t){const r=n.representationsByZ;t in r||(r[t]=new Set),r[t].add(e),n.tileIds.add(Ie(e.tile))}function ec(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Xr(e,Ig(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=Xr(e,i))}return e}function tu(n,e){return`${Ie(n)},${n.getKey()},${n.getRevision()},${Ni(e)}`}class q1 extends Co{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=Ct(),this.tempMat4=Pi(),this.tempTileRange_=new V0(0,0,0,0),this.tempTileCoord_=Uc(0,0,0),this.tempSize_=[0,0];const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Pg(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const r=this.getLayer().getRenderSource();return!r||Bu(ec(e,e.extent))?!1:r.getState()==="ready"}createTileRepresentation(e){return hn()}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),u=l.getGutterForProjection(o.projection),h=Ie(l);h in e.wantedTiles||(e.wantedTiles[h]={});const d=e.wantedTiles[h],f=this.tileRepresentationCache,p=a.getMapInternal(),g=Math.max(r-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),m=o.rotation,y=m?W0(o.center,o.resolution,m,e.size):void 0;for(let _=r;_>=g;--_){const x=c.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),E=c.getResolution(_);for(let b=x.minX;b<=x.maxX;++b)for(let T=x.minY;T<=x.maxY;++T){if(m&&!c.tileCoordIntersectsViewport([_,b,T],y))continue;const w=Uc(_,b,T,this.tempTileCoord_),v=tu(l,w);let S,C;if(f.containsKey(v)&&(S=f.get(v),C=S.tile),(!S||S.tile.key!==l.getKey())&&(C=l.getTile(_,b,T,e.pixelRatio,o.projection),!C)||Wf(i,C))continue;S?S.setTile(C):(S=this.createTileRepresentation({tile:C,grid:c,helper:this.helper,gutter:u}),f.set(v,S)),Zf(i,S,_);const P=C.getKey();d[P]=!0,C.getState()===_e.IDLE&&(e.tileQueue.isKeyQueued(P)||e.tileQueue.enqueue([C,h,c.getTileCoordCenter(w),E]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,i,s,o,a,l,c,u,h){}renderTileMask(e,t,r,i){}drawTile_(e,t,r,i,s,o,a){if(!t.ready)return;const c=t.tile.tileCoord,u=Ni(c),h=u in o?o[u]:1,d=a.getResolution(r),f=Ar(a.getTileSize(r),this.tempSize_),p=a.getOrigin(r),g=a.getTileCoordExtent(c),m=h<1?-1:Vf(r);h<1&&(e.animate=!0);const y=e.viewState,_=y.center[0],x=y.center[1],E=f[0]+2*i,b=f[1]+2*i,T=E/b,w=(_-p[0])/(f[0]*d),v=(p[1]-x)/(f[1]*d),S=y.resolution/d,C=c[1],P=c[2];Z0(this.tileTransform_),jd(this.tileTransform_,2/(e.size[0]*S/E),-2/(e.size[1]*S/E)),Y0(this.tileTransform_,y.rotation),jd(this.tileTransform_,1,1/T),Xu(this.tileTransform_,(f[0]*(C-w)-i)/E,(f[1]*(P-v)-i)/b),this.renderTile(t,this.tileTransform_,e,s,d,f,p,g,m,i,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(r.projection),a=s.getGutterForProjection(r.projection),l=ec(e,e.extent),c=o.getZForResolution(r.resolution,s.zDirection),u=H1(),h=i.getPreload();if(e.nextExtent){const x=o.getZForResolution(r.nextResolution,s.zDirection),E=ec(e,e.nextExtent);this.enqueueTiles(e,E,x,u,h)}this.enqueueTiles(e,l,c,u,0),h>0&&setTimeout(()=>{this.enqueueTiles(e,l,c-1,u,h-1)},0);const d={};let f=!1;const p=u.representationsByZ;if(c in p){const x=Ie(this),E=e.time;for(const b of p[c]){const T=b.tile;if(T.getState()===_e.EMPTY)continue;const w=T.tileCoord;if(b.ready){const C=T.getAlpha(x,E);if(C===1){T.endTransition(x);continue}f=!0;const P=Ni(w);d[P]=C}if(this.renderComplete=!1,this.findAltTiles_(o,w,c+1,u))continue;const S=o.getMinZoom();for(let C=c-1;C>=S&&!this.findAltTiles_(o,w,C,u);--C);}}const g=Object.keys(p).map(Number).sort(H0);if(this.beforeTilesMaskRender(e))for(let x=0,E=g.length;x<E;++x){const b=g[x];for(const T of p[b]){const w=T.tile.tileCoord;if(Ni(w)in d)continue;const S=o.getTileCoordExtent(w);this.renderTileMask(T,b,S,Vf(b))}}this.beforeTilesRender(e,f);for(let x=0,E=g.length;x<E;++x){const b=g[x];for(const T of p[b]){const w=T.tile.tileCoord;Ni(w)in d||this.drawTile_(e,T,b,a,l,d,o)}}if(c in p)for(const x of p[c]){const E=x.tile.tileCoord;Ni(E)in d&&this.drawTile_(e,x,c,a,l,d,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas();return this.tileRepresentationCache.expireCache(),this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let c=s.minX;c<=s.maxX;++c)for(let u=s.minY;u<=s.maxY;++u){const h=tu(l,[r,c,u]);let d=!1;if(a.containsKey(h)){const f=a.get(h);f.ready&&!Wf(i,f.tile)&&(Zf(i,f,r),d=!0)}d||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const ne={...Y1,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},ia={TEXTURE_COORD:"a_textureCoord"},K1=[{name:ia.TEXTURE_COORD,size:2,type:rt.FLOAT}];class J1 extends q1{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new $n(Ro,xh),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const r of this.paletteTextures_)r.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const r of this.paletteTextures_)r.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new Z1(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,i,s,o,a,l,c,u,h){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(K1);let f=0;for(;f<e.textures.length;){const T=`${ne.TILE_TEXTURE_ARRAY}[${f}]`;this.helper.bindTexture(e.textures[f],f,T),++f}for(let T=0;T<this.paletteTextures_.length;++T){const w=this.paletteTextures_[T],v=w.getTexture(d);this.helper.bindTexture(v,f,w.name),++f}const p=r.viewState,g=o[0]+2*u,m=o[1]+2*u,_=e.tile.tileCoord,x=_[1],E=_[2];this.helper.setUniformMatrixValue(ne.TILE_TRANSFORM,La(this.tempMat4,t)),this.helper.setUniformFloatValue(ne.TRANSITION_ALPHA,h),this.helper.setUniformFloatValue(ne.DEPTH,c);let b=i;u>0&&(b=l,Xr(b,i,b)),this.helper.setUniformFloatVec4(ne.RENDER_EXTENT,b),this.helper.setUniformFloatValue(ne.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(ne.ZOOM,p.zoom),this.helper.setUniformFloatValue(ne.TEXTURE_PIXEL_WIDTH,g),this.helper.setUniformFloatValue(ne.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(ne.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(ne.TEXTURE_ORIGIN_X,a[0]+x*o[0]*s-u*s),this.helper.setUniformFloatValue(ne.TEXTURE_ORIGIN_Y,a[1]-E*o[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const r=this.frameState;if(!r)return null;const i=this.getLayer(),s=bn(r.pixelToCoordinateTransform,e.slice()),o=r.viewState,a=i.getExtent();if(a&&!$i(Ig(a,o.projection),s))return null;const l=i.getSources(ku([s]),o.resolution);let c,u,h;for(c=l.length-1;c>=0;--c)if(u=l[c],u.getState()==="ready"){if(h=u.getTileGridForProjection(o.projection),u.getWrapX())break;const f=h.getExtent();if(!f||$i(f,s))break}if(c<0)return null;const d=this.tileRepresentationCache;for(let f=h.getZForResolution(o.resolution);f>=h.getMinZoom();--f){const p=h.getTileCoordForCoordAndZ(s,f),g=tu(u,p);if(!d.containsKey(g))continue;const m=d.get(g);if(m.tile.getState()===_e.EMPTY)return null;if(!m.loaded)continue;const _=h.getOrigin(f),x=Ar(h.getTileSize(f)),E=h.getResolution(f),b=(s[0]-_[0])/E-p[1]*x[0],T=(_[1]-s[1])/E-p[2]*x[1];return m.getPixelData(b,T)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const r of this.paletteTextures_)r.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class Q1{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function ev(n,e){return`operator_${n}_${Object.keys(e.functions).length}`}function jn(n){const e=n.toString();return e.includes(".")?e:e+".0"}function bh(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(jn).join(", ")})`}function sa(n){const e=po(n),t=e.length>3?e[3]:1;return bh([e[0]/255,e[1]/255,e[2]/255,t])}function tv(n){const e=Ar(n);return bh(e)}const tc={};let rv=0;function os(n){return n in tc||(tc[n]=rv++),tc[n]}function dn(n){return jn(os(n))}function bl(n){return"u_var_"+n}function Eh(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const rc="getBandValue",$m="u_paletteTextures",jm="featureId",Xm="geometryType",ru=-9999999;function nv(n,e,t,r){const i=q0(n,e,t);return Th(i,e,r)}function Pe(n){return(e,t,r)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Th(t.args[o],r,e);return n(s,e)}}const iv={[oe.Get]:(n,e)=>{const r=e.args[0].value;r in n.properties||(n.properties[r]={name:r,type:e.type});let s="a_prop_"+r;return Xd(e.type,Ws)&&(s=`(${s} > 0.0)`),s},[oe.Id]:n=>(n.featureId=!0,"a_"+jm),[oe.GeometryType]:n=>(n.geometryType=!0,"a_"+Xm),[oe.LineMetric]:()=>"currentLineMetric",[oe.Var]:(n,e)=>{const r=e.args[0].value;r in n.variables||(n.variables[r]={name:r,type:e.type});let s=bl(r);return Xd(e.type,Ws)&&(s=`(${s} > 0.0)`),s},[oe.Has]:(n,e)=>{const r=e.args[0].value;return r in n.properties||(n.properties[r]={name:r,type:e.type}),`(a_prop_${r} != ${jn(ru)})`},[oe.Resolution]:()=>"u_resolution",[oe.Zoom]:()=>"u_zoom",[oe.Time]:()=>"u_time",[oe.Any]:Pe(n=>`(${n.join(" || ")})`),[oe.All]:Pe(n=>`(${n.join(" && ")})`),[oe.Not]:Pe(([n])=>`(!${n})`),[oe.Equal]:Pe(([n,e])=>`(${n} == ${e})`),[oe.NotEqual]:Pe(([n,e])=>`(${n} != ${e})`),[oe.GreaterThan]:Pe(([n,e])=>`(${n} > ${e})`),[oe.GreaterThanOrEqualTo]:Pe(([n,e])=>`(${n} >= ${e})`),[oe.LessThan]:Pe(([n,e])=>`(${n} < ${e})`),[oe.LessThanOrEqualTo]:Pe(([n,e])=>`(${n} <= ${e})`),[oe.Multiply]:Pe(n=>`(${n.join(" * ")})`),[oe.Divide]:Pe(([n,e])=>`(${n} / ${e})`),[oe.Add]:Pe(n=>`(${n.join(" + ")})`),[oe.Subtract]:Pe(([n,e])=>`(${n} - ${e})`),[oe.Clamp]:Pe(([n,e,t])=>`clamp(${n}, ${e}, ${t})`),[oe.Mod]:Pe(([n,e])=>`mod(${n}, ${e})`),[oe.Pow]:Pe(([n,e])=>`pow(${n}, ${e})`),[oe.Abs]:Pe(([n])=>`abs(${n})`),[oe.Floor]:Pe(([n])=>`floor(${n})`),[oe.Ceil]:Pe(([n])=>`ceil(${n})`),[oe.Round]:Pe(([n])=>`floor(${n} + 0.5)`),[oe.Sin]:Pe(([n])=>`sin(${n})`),[oe.Cos]:Pe(([n])=>`cos(${n})`),[oe.Atan]:Pe(([n,e])=>e!==void 0?`atan(${n}, ${e})`:`atan(${n})`),[oe.Sqrt]:Pe(([n])=>`sqrt(${n})`),[oe.Match]:Pe(n=>{const e=n[0],t=n[n.length-1];let r=null;for(let i=n.length-3;i>=1;i-=2){const s=n[i],o=n[i+1];r=`(${e} == ${s} ? ${o} : ${r||t})`}return r}),[oe.Between]:Pe(([n,e,t])=>`(${n} >= ${e} && ${n} <= ${t})`),[oe.Interpolate]:Pe(([n,e,...t])=>{let r="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=r||t[i+1],a=t[i+2],l=t[i+3];let c;n===jn(1)?c=`(${e} - ${s}) / (${a} - ${s})`:c=`(pow(${n}, (${e} - ${s})) - 1.0) / (pow(${n}, (${a} - ${s})) - 1.0)`,r=`mix(${o}, ${l}, clamp(${c}, 0.0, 1.0))`}return r}),[oe.Case]:Pe(n=>{const e=n[n.length-1];let t=null;for(let r=n.length-3;r>=0;r-=2){const i=n[r],s=n[r+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[oe.In]:Pe(([n,...e],t)=>{const r=ev("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[r]=`bool ${r}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${r}(${n})`}),[oe.Array]:Pe(n=>`vec${n.length}(${n.join(", ")})`),[oe.Color]:Pe(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`vec4(vec3(${n[0]} / 255.0), ${n[1]})`;const e=n.slice(0,3).map(r=>`${r} / 255.0`);if(n.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=n[3];return`vec4(${e.join(", ")}, ${t})`}),[oe.Band]:Pe(([n,e,t],r)=>{if(!(rc in r.functions)){let i="";const s=r.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const c=`${ne.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[rc]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${ne.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${ne.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${rc}(${n}, ${e??"0.0"}, ${t??"0.0"})`}),[oe.Palette]:(n,e)=>{const[t,...r]=e.args,i=r.length,s=new Uint8Array(i*4);for(let c=0;c<r.length;c++){const u=r[c].value,h=po(u),d=c*4;s[d]=h[0],s[d+1]=h[1],s[d+2]=h[2],s[d+3]=h[3]*255}n.paletteTextures||(n.paletteTextures=[]);const o=`${$m}[${n.paletteTextures.length}]`,a=new Q1(o,s);n.paletteTextures.push(a);const l=Th(t,Te,n);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Th(n,e,t){if(n instanceof K0){const r=iv[n.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return r(t,n,e)}if((n.type&Te)>0)return jn(n.value);if((n.type&Ws)>0)return n.value.toString();if((n.type&Zs)>0)return dn(n.value.toString());if((n.type&Zt)>0)return sa(n.value);if((n.type&xi)>0)return bh(n.value);if((n.type&Ri)>0)return tv(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${J0(e)})`)}function sv(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Yf=.985;function te(n,e,t){const r=Q0();return nv(e,t,r,n)}function ov(n){const e=po(n),t=e[0]*256,r=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+r,i+s]}const av=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function wh(n){return n===Zt||n===Ri?2:n===xi?4:1}function nu(n){const e=wh(n);return e>1?`vec${e}`:"float"}function Vm(n,e){for(const t in e.variables){const r=e.variables[t],i=bl(r.name);let s=nu(r.type);r.type===Zt&&(s="vec4"),n.addUniform(i,s)}for(const t in e.properties){const r=e.properties[t],i=nu(r.type),s=`a_prop_${r.name}`;r.type===Zt?n.addAttribute(s,i,`unpackColor(${s})`,"vec4"):n.addAttribute(s,i)}for(const t in e.functions)n.addVertexShaderFunction(e.functions[t]),n.addFragmentShaderFunction(e.functions[t])}function Wm(n,e){const t={};for(const r in n.variables){const i=n.variables[r],s=bl(i.name);t[s]=()=>{const o=e[i.name];if(typeof o=="number")return o;if(typeof o=="boolean")return o?1:0;if(i.type===Zt){const a=[...po(o||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??(a[3]=1),a}return typeof o=="string"?os(o):o}}return t}function Zm(n){const e={};for(const t in n.properties){const r=n.properties[t],i=s=>{const o=s.get(r.name);return r.type===Zt?ov([...po(o||"#eee")]):typeof o=="string"?os(o):typeof o=="boolean"?o?1:0:o};e[`prop_${r.name}`]={size:wh(r.type),callback:i}}return e}const Ii=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${av}
`,Ai=sv();class Ym{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${jn(Ai["circle-radius"])} + ${jn(Ai["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=sa(Ai["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=jn(Ai["stroke-width"]),this.strokeColorExpression_=sa(Ai["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=dn("round"),this.strokeJoinExpression_=dn("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=sa(Ai["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e,t){return this.uniforms_.push({name:e,type:t}),this}addAttribute(e,t,r,i){return this.attributes_.push({name:e,type:t,varyingName:e.replace(/^a_/,"v_"),varyingType:i??t,varyingExpression:r??e}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setStrokePatternLengthExpression(e){return this.strokePatternLengthExpression_=e,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){return this.vertexShaderFunctions_.includes(e)?this:(this.vertexShaderFunctions_.push(e),this)}addFragmentShaderFunction(e){return this.fragmentShaderFunctions_.includes(e)?this:(this.fragmentShaderFunctions_.push(e),this)}getSymbolVertexShader(){return this.hasSymbol_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Yf} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Yf}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${dn("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${dn("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${dn("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${dn("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Ii}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}class Ma{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let r=0;r<e.length;r++)this.addFeature(e[r],t)}addFeature(e,t){let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}clearFeatureEntryInPointBatch_(e){const t=Ie(e),r=this.pointBatch.entries[t];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[t],r}clearFeatureEntryInLineStringBatch_(e){const t=Ie(e),r=this.lineStringBatch.entries[t];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[t],r}clearFeatureEntryInPolygonBatch_(e){const t=Ie(e),r=this.polygonBatch.entries[t];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[t],r}addGeometry_(e,t){var i;const r=e.getType();switch(r){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEndss(),t,Ie(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,Ie(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Ie(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,Ie(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Ie(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(r,s.getFlatCoordinates(),null,t,Ie(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,r,i,s,o,a){let l;switch(e){case"MultiPolygon":{const c=r;for(let u=0,h=c.length;u<h;u++){let d=c[u];const f=u>0?c[u-1]:null,p=f?f[f.length-1]:0,g=d[d.length-1];d=p>0?d.map(m=>m-p):d,this.addCoordinates_("Polygon",t.slice(p,g),d,i,s,o,a)}break}case"MultiLineString":{const c=r;for(let u=0,h=c.length;u<h;u++){const d=u>0?c[u-1]:0;this.addCoordinates_("LineString",t.slice(d,c[u]),null,i,s,o,a)}break}case"MultiPoint":for(let c=0,u=t.length;c<u;c+=o)this.addCoordinates_("Point",t.slice(c,c+2),null,i,s,null,null);break;case"Polygon":{const c=r;if(i instanceof ex){const d=tx(t,c);if(d.length>1){this.addCoordinates_("MultiPolygon",t,d,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const u=r.length,h=r.map((d,f,p)=>f>0?(d-p[f-1])/o:d/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(lv(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(h),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=u;for(let d=0,f=c.length;d<f;d++){const p=d>0?c[d-1]:0;this.addCoordinates_("LinearRing",t.slice(p,c[d]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(cv(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(e,t){const r=this.uidToRef_.get(e),i=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,r||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e,t){if(!this.uidToRef_.get(Ie(e)))return;this.removeFeature(e);let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,Ie(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new Ma;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let r=!0;for(const i of this.refToFeature_.values())e(i)&&(t.addFeature(i),r=!1);return r?new Ma:t}}function lv(n,e){return e===2?n:n.filter((t,r)=>r%e<2)}function cv(n,e,t){return e===3&&t==="XYM"?n:e===4?n.filter((r,i)=>i%e!==2):e===3?n.map((r,i)=>i%e!==2?r:0):new Array(n.length*1.5).fill(0).map((r,i)=>i%3===2?0:n[Math.round(i/1.5)])}function Hm(){const n='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}const Gs={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function qm(n,e){e=e||[];const t=256,r=t-1,i=Math.floor(n/t/t/t)/r,s=Math.floor(n/t/t)%t/r,o=Math.floor(n/t)%t/r,a=n%t/r;return e[0]=i*256*255+s*255,e[1]=o*256*255+a*255,e}function Km(n){let e=0;const t=256,r=t-1;return e+=Math.round(n[0]*t*t*t*r),e+=Math.round(n[1]*t*t*r),e+=Math.round(n[2]*t*r),e+=Math.round(n[3]*r),e}function Sh(n,e,t,r){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);let l=(a==null?void 0:a[0])??a;l===ru&&console.warn('The "has" operator might return false positives.'),l===void 0?l=ru:l===null&&(l=0),n[r+i++]=l,!(!o.size||o.size===1)&&(n[r+i++]=a[1],!(o.size<3)&&(n[r+i++]=a[2],!(o.size<4)&&(n[r+i++]=a[3])))}return i}function El(n){return Object.keys(n).reduce((e,t)=>e+(n[t].size||1),0)}function uv(n,e,t,r){const i=(2+El(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++)s[0]=l.flatCoordss[c][0],s[1]=l.flatCoordss[c][1],bn(r,s),e[o++]=s[0],e[o++]=s[1],o+=Sh(e,t,l,o)}return e}function hv(n,e,t,r){const i=3*n.verticesCount+(1+El(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){s.length=l.flatCoordss[c].length,Ag(l.flatCoordss[c],0,s.length,3,r,s,3),o+=Sh(e,t,l,o),e[o++]=s.length/3;for(let h=0,d=s.length;h<d;h+=3)e[o++]=s[h],e[o++]=s[h+1],e[o++]=s[h+2]}}return e}function dv(n,e,t,r){const i=2*n.verticesCount+(1+El(t))*n.geometriesCount+n.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){s.length=l.flatCoordss[c].length,Ag(l.flatCoordss[c],0,s.length,2,r,s),o+=Sh(e,t,l,o),e[o++]=l.ringsVerticesCounts[c].length;for(let h=0,d=l.ringsVerticesCounts[c].length;h<d;h++)e[o++]=l.ringsVerticesCounts[c][h];for(let h=0,d=s.length;h<d;h+=2)e[o++]=s[h],e[o++]=s[h+1]}}return e}function Oa(n){return(JSON.stringify(n).split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0),0)>>>0).toString()}function vh(n,e,t,r){if(`${r}radius`in n&&r!=="icon-"){let i=te(t,n[`${r}radius`],Te);if(`${r}radius2`in n){const s=te(t,n[`${r}radius2`],Te);i=`max(${i}, ${s})`}`${r}stroke-width`in n&&(i=`(${i} + ${te(t,n[`${r}stroke-width`],Te)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${r}scale`in n){const i=te(t,n[`${r}scale`],Ri);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${r}displacement`in n&&e.setSymbolOffsetExpression(te(t,n[`${r}displacement`],xi)),`${r}rotation`in n&&e.setSymbolRotationExpression(te(t,n[`${r}rotation`],Te)),`${r}rotate-with-view`in n&&e.setSymbolRotateWithView(!!n[`${r}rotate-with-view`])}function Jm(n,e,t,r,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&r!==null){const l=`smoothstep(-${r} + 0.63, -${r} - 0.58, ${n})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${n}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Rh(n,e,t,r,i){const s=new Image;s.crossOrigin=n[`${r}cross-origin`]===void 0?"anonymous":n[`${r}cross-origin`],cr(typeof n[`${r}src`]=="string",`WebGL layers do not support expressions for the ${r}src style property`),s.src=n[`${r}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`u_texture${i}_size`,"vec2");const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`u_texture${i}`,"sampler2D"),o}function Ch(n,e,t,r,i){let s=te(t,n[`${e}offset`],Ri);if(`${e}offset-origin`in n)switch(n[`${e}offset-origin`]){case"top-right":s=`vec2(${r}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${r}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${r} - ${i} - ${s}`;break}return s}function fv(n,e,t,r){r.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,vh(n,e,r,"circle-");let i=null;"circle-opacity"in n&&(i=te(r,n["circle-opacity"],Te));let s="coordsPx";"circle-scale"in n&&(s=`coordsPx / ${te(r,n["circle-scale"],Ri)}`);let o=null;"circle-fill-color"in n&&(o=te(r,n["circle-fill-color"],Zt));let a=null;"circle-stroke-color"in n&&(a=te(r,n["circle-stroke-color"],Zt));let l=te(r,n["circle-radius"],Te),c=null;"circle-stroke-width"in n&&(c=te(r,n["circle-stroke-width"],Te),l=`(${l} + ${c} * 0.5)`);const u=`circleDistanceField(${s}, ${l})`,h=Jm(u,o,a,c,i);e.setSymbolColorExpression(h)}function pv(n,e,t,r){r.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,r.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,r.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,vh(n,e,r,"shape-");let i=null;"shape-opacity"in n&&(i=te(r,n["shape-opacity"],Te));let s="coordsPx";"shape-scale"in n&&(s=`coordsPx / ${te(r,n["shape-scale"],Ri)}`);let o=null;"shape-fill-color"in n&&(o=te(r,n["shape-fill-color"],Zt));let a=null;"shape-stroke-color"in n&&(a=te(r,n["shape-stroke-color"],Zt));let l=null;"shape-stroke-width"in n&&(l=te(r,n["shape-stroke-width"],Te));const c=te(r,n["shape-points"],Te);let u="0.";"shape-angle"in n&&(u=te(r,n["shape-angle"],Te));let h,d=te(r,n["shape-radius"],Te);if(l!==null&&(d=`${d} + ${l} * 0.5`),"shape-radius2"in n){let p=te(r,n["shape-radius2"],Te);l!==null&&(p=`${p} + ${l} * 0.5`),h=`starDistanceField(${s}, ${c}, ${d}, ${p}, ${u})`}else h=`regularDistanceField(${s}, ${c}, ${d}, ${u})`;const f=Jm(h,o,a,l,i);e.setSymbolColorExpression(f)}function gv(n,e,t,r){let i="vec4(1.0)";"icon-color"in n&&(i=te(r,n["icon-color"],Zt)),"icon-opacity"in n&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${te(r,n["icon-opacity"],Te)})`);const s=Oa(n["icon-src"]),o=Rh(n,e,t,"icon-",s);if(e.setSymbolColorExpression(`${i} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in n&&"icon-height"in n&&e.setSymbolSizeExpression(`vec2(${te(r,n["icon-width"],Te)}, ${te(r,n["icon-height"],Te)})`),"icon-offset"in n&&"icon-size"in n){const a=te(r,n["icon-size"],xi),l=e.getSymbolSizeExpression();e.setSymbolSizeExpression(a);const c=Ch(n,"icon-",r,"v_quadSizePx",a);e.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(vh(n,e,r,"icon-"),"icon-anchor"in n){const a=te(r,n["icon-anchor"],xi);let l="1.0";"icon-scale"in n&&(l=te(r,n["icon-scale"],Ri));let c;n["icon-anchor-x-units"]==="pixels"&&n["icon-anchor-y-units"]==="pixels"?c=`${a} * ${l}`:n["icon-anchor-x-units"]==="pixels"?c=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:n["icon-anchor-y-units"]==="pixels"?c=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:c=`${a} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in n)switch(n["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${u}`)}}function mv(n,e,t,r){if("stroke-color"in n&&e.setStrokeColorExpression(te(r,n["stroke-color"],Zt)),"stroke-pattern-src"in n){const i=Oa(n["stroke-pattern-src"]),s=Rh(n,e,t,"stroke-pattern-",i);let o=s,a="vec2(0.)";"stroke-pattern-offset"in n&&"stroke-pattern-size"in n&&(o=te(r,n["stroke-pattern-size"],xi),a=Ch(n,"stroke-pattern-",r,s,o));let l="0.";"stroke-pattern-spacing"in n&&(l=te(r,n["stroke-pattern-spacing"],Te));let c="0.";"stroke-pattern-start-offset"in n&&(c=te(r,n["stroke-pattern-start-offset"],Te)),r.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;const u=`u_texture${i}`;let h="1.";"stroke-color"in n&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${u}, ${s}, ${a}, ${o}, ${l}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`),r.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,e.setStrokePatternLengthExpression(`computeStrokePatternLength(${o}, ${l}, v_width)`)}if("stroke-width"in n&&e.setStrokeWidthExpression(te(r,n["stroke-width"],Te)),"stroke-offset"in n&&e.setStrokeOffsetExpression(te(r,n["stroke-offset"],Te)),"stroke-line-cap"in n&&e.setStrokeCapExpression(te(r,n["stroke-line-cap"],Zs)),"stroke-line-join"in n&&e.setStrokeJoinExpression(te(r,n["stroke-line-join"],Zs)),"stroke-miter-limit"in n&&e.setStrokeMiterLimitExpression(te(r,n["stroke-miter-limit"],Te)),"stroke-line-dash"in n){r.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${dn("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${dn("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=n["stroke-line-dash"].map(p=>te(r,p,Te));i.length%2===1&&(i=[...i,...i]);let s="0.";"stroke-line-dash-offset"in n&&(s=te(r,n["stroke-line-dash-offset"],Te));const a=`dashDistanceField_${Oa(n["stroke-line-dash"])}`,l=i.map((p,g)=>`float dashLength${g}`).join(", "),c=i.map((p,g)=>`dashLength${g}`).join(" + ");let u="0.",h=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType, lineWidth)`;for(let p=2;p<i.length;p+=2)u=`${u} + dashLength${p-2} + dashLength${p-1}`,h=`min(${h}, getSingleDashDistance(distance, radius, ${u}, dashLength${p}, totalDashLength, capType, lineWidth))`;r.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${c};
  return ${h};
}`;const d=i.map((p,g)=>`${p}`).join(", ");e.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width, ${d})`);let f=i.join(" + ");e.getStrokePatternLengthExpression()&&(r.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,f=`combinePatternLengths(${e.getStrokePatternLengthExpression()}, ${f})`),e.setStrokePatternLengthExpression(f)}}function yv(n,e,t,r){if("fill-color"in n&&e.setFillColorExpression(te(r,n["fill-color"],Zt)),"fill-pattern-src"in n){const i=Oa(n["fill-pattern-src"]),s=Rh(n,e,t,"fill-pattern-",i);let o=s,a="vec2(0.)";"fill-pattern-offset"in n&&"fill-pattern-size"in n&&(o=te(r,n["fill-pattern-size"],xi),a=Ch(n,"fill-pattern-",r,s,o)),r.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${i}`;let c="1.";"fill-color"in n&&(c=e.getFillColorExpression()),e.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${s}, ${a}, ${o}, pxOrigin, pxPos)`)}}function iu(n,e,t){const r=Eh(),i=new Ym,s={};if("icon-src"in n?gv(n,i,s,r):"shape-points"in n?pv(n,i,s,r):"circle-radius"in n&&fv(n,i,s,r),mv(n,i,s,r),yv(n,i,s,r),t){const l=te(r,t,Ws);i.setFragmentDiscardExpression(`!${l}`)}const o={};function a(l,c,u,h){if(!r[l])return;const d=nu(u),f=wh(u);i.addAttribute(`a_${c}`,d),o[c]={size:f,callback:h}}return a("geometryType",Xm,Zs,l=>os(rx(l.getGeometry()))),a("featureId",jm,Zs|Te,l=>{const c=l.getId()??null;return typeof c=="string"?os(c):c}),Vm(i,r),{builder:i,attributes:{...o,...Zm(r)},uniforms:{...s,...Wm(r,e)}}}const _v=[];let nc;function xv(){return nc||(nc=Hm()),nc}let bv=0;const fr={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"};class Ev{constructor(e,t,r,i){this.helper_,this.hitDetectionEnabled_=!!i,this.styleShaders=Tv(e,t),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return qm(this.ref,_v)},size:2});for(const s of this.styleShaders){for(const o in s.attributes)o in this.customAttributes_||(this.customAttributes_[o]=s.attributes[o]);for(const o in s.uniforms)o in this.uniforms_||(this.uniforms_[o]=s.uniforms[o])}this.renderPasses_=this.styleShaders.map(s=>{const o={},a=Object.entries(this.customAttributes_).map(([l,c])=>({name:l in s.attributes||l==="hitColor"?`a_${l}`:null,size:c.size||1,type:rt.FLOAT}));return s.builder.getFillVertexShader()&&(o.fillRenderPass={vertexShader:s.builder.getFillVertexShader(),fragmentShader:s.builder.getFillFragmentShader(),attributesDesc:[{name:fr.POSITION,size:2,type:rt.FLOAT},...a],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),s.builder.getStrokeVertexShader()&&(o.strokeRenderPass={vertexShader:s.builder.getStrokeVertexShader(),fragmentShader:s.builder.getStrokeFragmentShader(),attributesDesc:[{name:fr.LOCAL_POSITION,size:2,type:rt.FLOAT}],instancedAttributesDesc:[{name:fr.SEGMENT_START,size:2,type:rt.FLOAT},{name:fr.MEASURE_START,size:1,type:rt.FLOAT},{name:fr.SEGMENT_END,size:2,type:rt.FLOAT},{name:fr.MEASURE_END,size:1,type:rt.FLOAT},{name:fr.JOIN_ANGLES,size:2,type:rt.FLOAT},{name:fr.DISTANCE_LOW,size:1,type:rt.FLOAT},{name:fr.DISTANCE_HIGH,size:1,type:rt.FLOAT},{name:fr.ANGLE_TANGENT_SUM,size:1,type:rt.FLOAT},...a],instancePrimitiveVertexCount:6}),s.builder.getSymbolVertexShader()&&(o.symbolRenderPass={vertexShader:s.builder.getSymbolVertexShader(),fragmentShader:s.builder.getSymbolFragmentShader(),attributesDesc:[{name:fr.LOCAL_POSITION,size:2,type:rt.FLOAT}],instancedAttributesDesc:[{name:fr.POSITION,size:2,type:rt.FLOAT},...a],instancePrimitiveVertexCount:6}),o}),this.hasFill_=this.renderPasses_.some(s=>s.fillRenderPass),this.hasStroke_=this.renderPasses_.some(s=>s.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(s=>s.symbolRenderPass),this.setHelper(r)}async generateBuffers(e,t){if(e.isEmpty())return null;const r=this.generateRenderInstructions_(e,t),[i,s,o]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",t),this.generateBuffersForType_(r.lineStringInstructions,"LineString",t),this.generateBuffersForType_(r.pointInstructions,"Point",t)]),a=Ys(Ct(),t);return{polygonBuffers:i,lineStringBuffers:s,pointBuffers:o,invertVerticesTransform:a}}generateRenderInstructions_(e,t){const r=this.hasFill_?dv(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?hv(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?uv(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:r,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,r){if(e===null)return null;const i=bv++;let s;switch(t){case"Polygon":s=Gs.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Gs.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Gs.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:r,customAttributesSize:El(this.customAttributes_)},a=xv();return a.postMessage(o,[e.buffer]),e=null,new Promise(l=>{const c=u=>{const h=u.data;if(h.id!==i||(a.removeEventListener("message",c),!this.helper_.getGL()))return;const d=new $n(Ro,qi).fromArrayBuffer(h.indicesBuffer),f=new $n(wi,qi).fromArrayBuffer(h.vertexAttributesBuffer),p=new $n(wi,qi).fromArrayBuffer(h.instanceAttributesBuffer);this.helper_.flushBufferData(d),this.helper_.flushBufferData(f),this.helper_.flushBufferData(p),l([d,f,p])};a.addEventListener("message",c)})}render(e,t,r){for(const i of this.renderPasses_)i.fillRenderPass&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],e.polygonBuffers[2],i.fillRenderPass,t,r),i.strokeRenderPass&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],e.lineStringBuffers[2],i.strokeRenderPass,t,r),i.symbolRenderPass&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],e.pointBuffers[2],i.symbolRenderPass,t,r)}renderInternal_(e,t,r,i,s,o){const a=e.getSize();if(a===0)return;const l=i.instancedAttributesDesc.length;if(this.helper_.useProgram(i.program,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i.attributesDesc),this.helper_.bindBuffer(r),this.helper_.enableAttributesInstanced(i.instancedAttributesDesc),o(),l){const c=i.instancedAttributesDesc.reduce((h,d)=>h+(d.size||1),0),u=r.getSize()/c;this.helper_.drawElementsInstanced(0,a,u)}else this.helper_.drawElements(0,a)}setHelper(e,t=null){this.helper_=e;for(const r of this.renderPasses_)r.fillRenderPass&&(r.fillRenderPass.program=this.helper_.getProgram(r.fillRenderPass.fragmentShader,r.fillRenderPass.vertexShader)),r.strokeRenderPass&&(r.strokeRenderPass.program=this.helper_.getProgram(r.strokeRenderPass.fragmentShader,r.strokeRenderPass.vertexShader)),r.symbolRenderPass&&(r.symbolRenderPass.program=this.helper_.getProgram(r.symbolRenderPass.fragmentShader,r.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1]),this.helper_.flushBufferData(t.polygonBuffers[2])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1]),this.helper_.flushBufferData(t.lineStringBuffers[2])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1]),this.helper_.flushBufferData(t.pointBuffers[2])))}}function Tv(n,e){const t=Array.isArray(n)?n:[n];if("style"in t[0]){const r=[],i=t,s=[];for(const o of i){const a=Array.isArray(o.style)?o.style:[o.style];let l=o.filter;o.else&&s.length&&(l=["all",...s.map(u=>["!",u])],o.filter&&l.push(o.filter),l.length<3&&(l=l[1])),o.filter&&s.push(o.filter);const c=a.map(u=>iu(u,e,l));r.push(...c)}return r}return"builder"in t[0]?t:t.map(r=>iu(r,e,null))}const Gr=new Uint8Array(4);class Qm{constructor(e,t){this.helper_=e;const r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){nx(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Gr[0]=0,Gr[1]=0,Gr[2]=0,Gr[3]=0,Gr;this.readAll();const r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Gr[0]=this.data_[r*4],Gr[1]=this.data_[r*4+1],Gr[2]=this.data_[r*4+2],Gr[3]=this.data_[r*4+3],Gr}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}function ey(n,e){const t=n.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=n.extent,a=i?Pt(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}const Li={...zr,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class ty extends Co{constructor(e,t){const r={[Li.RENDER_EXTENT]:[0,0,0,0],[Li.PATTERN_ORIGIN]:[0,0],[Li.GLOBAL_ALPHA]:1};super(e,{uniforms:r,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=go(),this.currentTransform_=Ct(),this.tmpCoords_=[0,0],this.tmpTransform_=Ct(),this.tmpMat4_=Pi(),this.currentFrameStateTransform_=Ct(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(t),this.batch_=new Ma,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let r;this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[fn(t,Nn.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),fn(t,Nn.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,r),this),fn(t,Nn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),fn(t,Nn.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.style_=e.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new Ev(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Qm(this.helper))}handleSourceFeatureAdded_(e,t){const r=t.feature;this.batch_.addFeature(r,e)}handleSourceFeatureChanged_(e,t){const r=t.feature;this.batch_.changeFeature(r,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){ix(this.tmpTransform_,this.currentFrameStateTransform_),Xs(this.tmpTransform_,e),this.helper.setUniformMatrixValue(Li.PROJECTION_MATRIX,La(this.tmpMat4_,this.tmpTransform_)),Ys(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Li.SCREEN_TO_WORLD_MATRIX,La(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Ys(this.tmpTransform_,e),bn(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Li.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=ey(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[Wn.ANIMATING]&&!e.viewHints[Wn.INTERACTING],o=!Vs(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,c=i.resolution,u=t instanceof al?t.getRenderBuffer():0,h=Vu(e.extent,u*c);r.loadFeatures(h,c,l),this.ready=!1;const d=this.helper.makeProjectionTransform(e,Ct());this.styleRenderer_.generateBuffers(this.batch_,d).then(f=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=f,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,r,i,s){let o=r;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),Xu(this.currentFrameStateTransform_,o*s,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,e,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)});while(++o<i)}forEachFeatureAtCoordinate(e,t,r,i,s){if(cr(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;const o=bn(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=Km(l),u=this.batch_.getFeatureFromRef(c);if(u)return i(u,this.getLayer(),null)}disposeBuffers(e){const t=r=>{for(const i of r)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){ga(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const ln={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},wv=["#00f","#0ff","#0f0","#ff0","#f00"];class Sv extends al{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(ln.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:wv),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const r=e.weight?e.weight:"weight";this.weight_=r,this.setRenderOrder(null)}getBlur(){return this.get(ln.BLUR)}getGradient(){return this.get(ln.GRADIENT)}getRadius(){return this.get(ln.RADIUS)}handleGradientChanged_(){this.gradient_=vv(this.getGradient())}setBlur(e){const t=this.get(ln.BLUR);if(this.set(ln.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(ln.GRADIENT,e)}setRadius(e){const t=this.get(ln.RADIUS);if(this.set(ln.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new Ym,t=Eh(),r=te(t,this.filter_,Ws);let i=te(t,this.getRadius(),Te),s=te(t,this.getBlur(),Te);const o={};typeof this.getBlur()=="number"&&(s="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const a={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const h=typeof this.weight_=="string"?d=>d.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:d=>{const f=h(d);return f!==void 0?Qe(f,0,1):1}},l="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const h=["clamp",this.weight_,0,1];l=te(t,h,Te)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${s});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${s}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${s}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${r}`),Vm(e,t);const c=Zm(t),u=Wm(t,this.styleVariables_);return new ty(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...c,...a},uniforms:{...u,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function vv(n){const r=Vn(1,256),i=r.createLinearGradient(0,0,1,256),s=1/(n.length-1);for(let o=0,a=n.length;o<a;++o)i.addColorStop(o*s,n[o]);return r.fillStyle=i,r.fillRect(0,0,1,256),r.canvas}let Ph=class extends Lg{constructor(e,t,r,i,s){const o=s!==void 0?si.IDLE:si.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=si.ERROR):this.state=si.LOADED,this.changed()}load(){this.state==si.IDLE&&(this.state=si.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}};class Rv extends sx{constructor(e){super(e),this.vectorRenderer_=new ox(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=Ct(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=bn(this.coordinateToVectorPixelTransform_,bn(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){var u;const t=e.pixelRatio,r=e.viewState,i=r.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),Fg(a,this.layerImageRatio_));const l=Pt(a)/i,c=Lr(a)/i;if(!s[Wn.ANIMATING]&&!s[Wn.INTERACTING]&&!Bu(a)){o.useContainer(null,null);const h=o.context,d=e.layerStatesArray[e.layerIndex],f=Object.assign({},d,{opacity:1}),p=Object.assign({},e,{extent:a,size:[l,c],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),g=this.getLayer().getDeclutter();g&&(p.declutter={[g]:new kg(9)});const m=new Ph(a,i,t,h.canvas,function(y){o.prepareFrame(p)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(p,null),o.renderDeclutter(p),o.renderDeferred(p),y())});m.addEventListener(Vt.CHANGE,()=>{if(m.getState()!==si.LOADED)return;this.image=m;const y=m.getPixelRatio(),_=ax(m.getResolution())*t/y;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=zu(this.coordinateToVectorPixelTransform_,l/2,c/2,1/_,-1/_,0,-r.center[0],-r.center[1])}),m.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!((u=this.getLayer().getSource())!=null&&u.loading)&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,r,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,i,s):super.forEachFeatureAtCoordinate(e,t,r,i,s)}}class Cv extends al{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Rv(this)}}class Pv extends Co{constructor(e,t){const r=t.uniforms||{},i=Ct();r[zr.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new $n(wi,qi),this.instanceAttributesBuffer_=new $n(wi,qi),this.indicesBuffer_=new $n(Ro,qi),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:rt.FLOAT}}):[];this.attributes=[{name:"a_localPosition",size:2,type:rt.FLOAT}],this.instanceAttributes=[{name:"a_position",size:2,type:rt.FLOAT}],this.hitDetectionEnabled_&&(this.instanceAttributes.push({name:"a_hitColor",size:2,type:rt.FLOAT}),this.instanceAttributes.push({name:"a_featureUid",size:1,type:rt.FLOAT})),this.instanceAttributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=go(),this.currentTransform_=i,this.renderTransform_=Ct(),this.invertRenderTransform_=Ct(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=Hm(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Gs.GENERATE_POINT_BUFFERS){const c=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexAttributesBuffer),this.instanceAttributesBuffer_.fromArrayBuffer(l.instanceAttributesBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.helper.flushBufferData(this.instanceAttributesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indicesBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=c,Ys(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[fn(o,Nn.ADDFEATURE,this.handleSourceFeatureAdded_,this),fn(o,Nn.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),fn(o,Nn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),fn(o,Nn.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{const l=a.getGeometry();l&&l.getType()==="Point"&&(this.featureCache_[Ie(a)]={feature:a,properties:a.getProperties(),flatCoordinates:l.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Qm(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,r=t.getGeometry();r&&r.getType()==="Point"&&(this.featureCache_[Ie(t)]={feature:t,properties:t.getProperties(),flatCoordinates:r.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,r=Ie(t),i=this.featureCache_[r],s=t.getGeometry();i?s&&s.getType()==="Point"?(i.properties=t.getProperties(),i.flatCoordinates=s.getFlatCoordinates()):(delete this.featureCache_[r],this.featureCount_--):s&&s.getType()==="Point"&&(this.featureCache_[r]={feature:t,properties:t.getProperties(),flatCoordinates:s.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,r=Ie(t);r in this.featureCache_&&(delete this.featureCache_[r],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=ey(e,this.getLayer());return this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[Wn.ANIMATING]&&!e.viewHints[Wn.INTERACTING],o=!Vs(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,c=i.resolution,u=t instanceof al?t.getRenderBuffer():0,h=Vu(e.extent,u*c);r.loadFeatures(h,c,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),!0}rebuildBuffers_(e){const t=Ct();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?5:2)+this.customAttributes.length,s=i*this.featureCount_,o=this.renderInstructions_&&this.renderInstructions_.length===s?this.renderInstructions_:new Float32Array(s);this.renderInstructions_=null;let a=[];const l=[];let c=-1;e.viewState.projection;for(const h in this.featureCache_){const d=this.featureCache_[h];if(a[0]=d.flatCoordinates[0],a[1]=d.flatCoordinates[1],bn(t,a),o[++c]=a[0],o[++c]=a[1],this.hitDetectionEnabled_){const f=qm(c+3,l);o[++c]=f[0],o[++c]=f[1],o[++c]=Number(h)}for(let f=0;f<this.customAttributes.length;f++){const p=this.customAttributes[f].callback(d.feature,d.properties);o[++c]=p}}const u={id:++this.lastSentId,type:Gs.GENERATE_POINT_BUFFERS,renderInstructions:o.buffer,customAttributesSize:i-2};u.projectionTransform=t,this.ready=!1,this.worker_.postMessage(u,[o.buffer])}forEachFeatureAtCoordinate(e,t,r,i,s){if(cr(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=bn(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=Km(l),u=this.renderInstructions_[c],h=Math.floor(u).toString(),f=this.getLayer().getSource().getFeatureByUid(h);if(f)return i(f,this.getLayer(),null)}renderWorlds(e,t,r,i,s){let o=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));const a=this.instanceAttributes.reduce((c,u)=>c+(u.size||1),0),l=this.instanceAttributesBuffer_.getSize()/a;do{this.helper.bindBuffer(this.indicesBuffer_),this.helper.bindBuffer(this.verticesBuffer_),this.helper.enableAttributes(this.attributes),this.helper.bindBuffer(this.instanceAttributesBuffer_),this.helper.enableAttributesInstanced(this.instanceAttributes),this.helper.makeProjectionTransform(e,this.currentTransform_),Xu(this.currentTransform_,o*s,0),Xs(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const c=this.indicesBuffer_.getSize();this.helper.drawElementsInstanced(0,c,l)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){ga(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class Iv extends Wu{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=iu(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new Pv(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function Hf(n,e){const t=`
    attribute vec2 ${ia.TEXTURE_COORD};
    uniform mat4 ${ne.TILE_TRANSFORM};
    uniform float ${ne.TEXTURE_PIXEL_WIDTH};
    uniform float ${ne.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ne.TEXTURE_RESOLUTION};
    uniform float ${ne.TEXTURE_ORIGIN_X};
    uniform float ${ne.TEXTURE_ORIGIN_Y};
    uniform float ${ne.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${ia.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${ne.TEXTURE_ORIGIN_X} + ${ne.TEXTURE_RESOLUTION} * ${ne.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${ne.TEXTURE_ORIGIN_Y} - ${ne.TEXTURE_RESOLUTION} * ${ne.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${ne.TILE_TRANSFORM} * vec4(${ia.TEXTURE_COORD}, ${ne.DEPTH}, 1.0);
    }
  `,r={...Eh(),bandCount:e},i=[];if(n.color!==void 0){const h=te(r,n.color,Zt);i.push(`color = ${h};`)}if(n.contrast!==void 0){const h=te(r,n.contrast,Te);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb - (${h} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const h=te(r,n.exposure,Te);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const h=te(r,n.saturation,Te);i.push(`
      float saturation = ${h} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const h=te(r,n.gamma,Te);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${h}));`)}if(n.brightness!==void 0){const h=te(r,n.brightness,Te);i.push(`color.rgb = clamp(color.rgb + ${h}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(r.variables).length;if(o>1&&!n.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let h=0;h<o;++h){const d=r.variables[Object.keys(r.variables)[h]];if(!(d.name in n.variables))throw new Error(`Missing '${d.name}' in style variables`);const f=bl(d.name);s[f]=function(){let p=n.variables[d.name];return typeof p=="string"&&(p=os(p)),p!==void 0?p:-9999999}}const a=Object.keys(s).map(function(h){return`uniform float ${h};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${ne.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${$m}[${r.paletteTextures.length}];`);const c=Object.keys(r.functions).map(function(h){return r.functions[h]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${ne.RENDER_EXTENT};
    uniform float ${ne.TRANSITION_ALPHA};
    uniform float ${ne.TEXTURE_PIXEL_WIDTH};
    uniform float ${ne.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ne.RESOLUTION};
    uniform float ${ne.ZOOM};

    ${a.join(`
`)}

    ${c.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${ne.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${ne.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${ne.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${ne.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${ne.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${ne.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:u,uniforms:s,paletteTextures:r.paletteTextures}}class ry extends lx{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(kc.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Hf(this.style_,this.getSourceBandCount_());return new J1(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],r.prepareFrame(e)&&(i=r.renderFrame(e));return i}render(e,t){this.rendered=!0;const r=e.viewState,i=this.getSources(e.extent,r.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const c=i[a],u=c.getState();if(u=="loading"){const h=()=>{c.getState()=="ready"&&(c.removeEventListener("change",h),this.changed())};c.addEventListener("change",h)}s=s&&u=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=r.resolution,o;if(this.renderedResolution_>.5*r.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=Hf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}ry.prototype.dispose;class Av extends Wu{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new ty(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}let ny=class iy extends Kx{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new iy(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const r=this.getStyle();return r&&e.setStyle(r),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(qs(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=Ks(e,Qr.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Lv(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function Lv(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(Ds(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}function sy(n,e,t,r){const i=[];let s=bi();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=Ug(n,e,l[0],r),i.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return i}function Na(n,e,t,r,i,s,o){let a,l;const c=(t-e)/r;if(c===1)a=e;else if(c===2)a=e,l=i;else if(c!==0){let u=n[e],h=n[e+1],d=0;const f=[0];for(let m=e+r;m<t;m+=r){const y=n[m],_=n[m+1];d+=Math.sqrt((y-u)*(y-u)+(_-h)*(_-h)),f.push(d),u=y,h=_}const p=i*d,g=Jx(f,p);g<0?(l=(p-f[-g-2])/(f[-g-1]-f[-g-2]),a=e+(-g-2)*r):a=e+g*r}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?n[a+u]:_r(n[a+u],n[a+r+u],l);return s}function su(n,e,t,r,i,s){if(t==e)return null;let o;if(i<n[e+r-1])return s?(o=n.slice(e,e+r),o[r-1]=i,o):null;if(n[t-1]<i)return s?(o=n.slice(t-r,t),o[r-1]=i,o):null;if(i==n[e+r-1])return n.slice(e,e+r);let a=e/r,l=t/r;for(;a<l;){const d=a+l>>1;i<n[(d+1)*r-1]?l=d:a=d+1}const c=n[a*r-1];if(i==c)return n.slice((a-1)*r,(a-1)*r+r);const u=n[(a+1)*r-1],h=(i-c)/(u-c);o=[];for(let d=0;d<r-1;++d)o.push(_r(n[(a-1)*r+d],n[a*r+d],h));return o.push(i),o}function Fv(n,e,t,r,i,s,o){if(o)return su(n,e,t[t.length-1],r,i,s);let a;if(i<n[r-1])return s?(a=n.slice(0,r),a[r-1]=i,a):null;if(n[n.length-1]<i)return s?(a=n.slice(n.length-r),a[r-1]=i,a):null;for(let l=0,c=t.length;l<c;++l){const u=t[l];if(e!=u){if(i<n[e+r-1])return null;if(i<=n[u-1])return su(n,e,u,r,i,!1);e=u}}return null}class Da extends Rb{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(qs),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,r=e.length;t<r;++t)this.changeEventsKeys_.push(Ks(e[t],Qr.CHANGE,this.changed,this))}clone(){const e=new Da(ic(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,r,i){if(i<_o(this.getExtent(),e,t))return i;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)i=s[o].closestPointXY(e,t,r,i);return i}containsXY(e,t){const r=this.geometries_;for(let i=0,s=r.length;i<s;++i)if(r[i].containsXY(e,t))return!0;return!1}computeExtent(e){Qx(e);const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)eb(e,t[r].getExtent());return e}getGeometries(){return ic(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)t[r].getType()===this.getType()?e=e.concat(t[r].getGeometriesArrayRecursive()):e.push(t[r]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],r=this.geometries_;let i=!1;for(let s=0,o=r.length;s<o;++s){const a=r[s],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(i=!0)}return i?new Da(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)if(t[r].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const r=this.geometries_;for(let i=0,s=r.length;i<s;++i)r[i].rotate(e,t);this.changed()}scale(e,t,r){r||(r=qn(this.getExtent()));const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].scale(e,t,r);this.changed()}setGeometries(e){this.setGeometriesArray(ic(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let r=0,i=t.length;r<i;++r)t[r].applyTransform(e);this.changed()}translate(e,t){const r=this.geometries_;for(let i=0,s=r.length;i<s;++i)r[i].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ic(n){return n.map(e=>e.clone())}function Ih(n,e,t,r){let i=n[e],s=n[e+1],o=0;for(let a=e+r;a<t;a+=r){const l=n[a],c=n[a+1];o+=Math.sqrt((l-i)*(l-i)+(c-s)*(c-s)),i=l,s=c}return o}class Si extends dl{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){gn(this.flatCoordinates,e),this.changed()}clone(){const e=new Si(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,i){return i<_o(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Cb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,r,i))}forEachSegment(e){return Ib(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,su(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return ji(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Na(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=$g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Si(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Ab(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jg(this.flatCoordinates,0,e,this.stride),this.changed()}}class eo extends dl{constructor(e,t,r){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&r)this.setFlatCoordinates(t,e),this.ends_=r;else{const i=e,s=[],o=[];for(let l=0,c=i.length;l<c;++l){const u=i[l];gn(s,u.getFlatCoordinates()),o.push(s.length)}const a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(e){gn(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new eo(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,r,i){return i<_o(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Lb(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Fb(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,r,i))}getCoordinateAtM(e,t,r){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,r=r!==void 0?r:!1,Fv(this.flatCoordinates,0,this.ends_,this.stride,e,t,r))}getCoordinates(){return Xc(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Si(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,r=this.layout,i=[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],c=new Si(e.slice(s,l),r);i.push(c),s=l}return i}getLength(){const e=this.ends_;let t=0,r=0;for(let i=0,s=e.length;i<s;++i)r+=Ih(this.flatCoordinates,t,e[i],this.stride),t=e[i];return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let r=0;const i=this.ends_,s=this.stride;for(let o=0,a=i.length;o<a;++o){const l=i[o],c=Na(t,r,l,s,.5);gn(e,c),r=l}return e}getSimplifiedGeometryInternal(e){const t=[],r=[];return t.length=Xg(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,r),new eo(t,"XY",r)}getType(){return"MultiLineString"}intersectsExtent(e){return Mb(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=Qu(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}class Po extends dl{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){gn(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Po(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,i){if(i<_o(this.getExtent(),e,t))return i;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const c=tb(e,t,s[a],s[a+1]);if(c<i){i=c;for(let u=0;u<o;++u)r[u]=s[a+u];r.length=o}}return i}getCoordinates(){return ji(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new _a(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,r=this.stride,i=[];for(let s=0,o=e.length;s<o;s+=r){const a=new _a(e.slice(s,s+r),t);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,r=this.stride;for(let i=0,s=t.length;i<s;i+=r){const o=t[i],a=t[i+1];if(rb(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jg(this.flatCoordinates,0,e,this.stride),this.changed()}}class to extends dl{constructor(e,t,r){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){const i=e,s=[],o=[];for(let a=0,l=i.length;a<l;++a){const c=i[a],u=s.length,h=c.getEnds();for(let d=0,f=h.length;d<f;++d)h[d]+=u;gn(s,c.getFlatCoordinates()),o.push(h)}t=i.length===0?this.getLayout():i[0].getLayout(),e=s,r=o}t!==void 0&&r?(this.setFlatCoordinates(t,e),this.endss_=r):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const r=this.flatCoordinates.length;gn(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let i=0,s=t.length;i<s;++i)t[i]+=r}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=this.endss_[i].slice();const r=new to(this.flatCoordinates.slice(),this.layout,t);return r.applyProperties(this),r}closestPointXY(e,t,r,i){return i<_o(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ob(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nb(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,r,i))}containsXY(e,t){return Db(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Gb(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Vc(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Wc(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=sy(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Vg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Po(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Wg(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Vc(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],r=[];return t.length=kb(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,r),new to(t,"XY",r)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const r=this.endss_[e].slice(),i=r[r.length-1];if(t!==0)for(let s=0,o=r.length;s<o;++s)r[s]-=t;return new xa(this.flatCoordinates.slice(t,i),this.layout,r)}getPolygons(){const e=this.layout,t=this.flatCoordinates,r=this.endss_,i=[];let s=0;for(let o=0,a=r.length;o<a;++o){const l=r[o].slice(),c=l[l.length-1];if(s!==0)for(let h=0,d=l.length;h<d;++h)l[h]-=s;const u=new xa(t.slice(s,c),e,l);i.push(u),s=c}return i}getType(){return"MultiPolygon"}intersectsExtent(e){return Ub(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const r=Zg(this.flatCoordinates,0,e,this.stride,this.endss_);if(r.length===0)this.flatCoordinates.length=0;else{const i=r[r.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}}const qf=Tr();class Ot{constructor(e,t,r,i,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r||null,this.properties_=s,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?nb(this.flatCoordinates_):Ug(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=qn(this.getExtent());this.flatInteriorPoints_=Bb(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Yg(this.flatCoordinates_,this.ends_),t=sy(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Vg(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Na(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const r=this.ends_;for(let i=0,s=r.length;i<s;++i){const o=r[i],a=Na(e,t,o,2,.5);gn(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=$e(e);const t=e.getExtent(),r=e.getWorldExtent();if(t&&r){const i=Fr(r)/Fr(t);Yn(qf,r[0],r[3],i,-i,0,0,0),Hi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,qf,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new Ot(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ib((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const r=this.simplifiedGeometry_.getFlatCoordinates();let i;switch(this.type_){case"LineString":r.length=$g(r,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,r,0),i=[r.length];break;case"MultiLineString":i=[],r.length=Xg(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,r,0,i);break;case"Polygon":i=[],r.length=zb(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),r,0,i);break}return i&&(this.simplifiedGeometry_=new Ot(this.type_,r,i,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Ot.prototype.getFlatCoordinates=Ot.prototype.getOrientedFlatCoordinates;class oy{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=ny,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let r=t.dataProjection?$e(t.dataProjection):this.readProjection(e);t.extent&&r&&r.getUnits()==="tile-pixels"&&(r=$e(r),r.setWorldExtent(t.extent)),t={dataProjection:r,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return Lt()}readFeature(e,t){return Lt()}readFeatures(e,t){return Lt()}readGeometry(e,t){return Lt()}readProjection(e){return Lt()}writeFeature(e,t){return Lt()}writeFeatures(e,t){return Lt()}writeGeometry(e,t){return Lt()}}function Tl(n,e,t){const r=t?$e(t.featureProjection):null,i=t?$e(t.dataProjection):null;let s=n;if(r&&i&&!Mt(r,i)){e&&(s=n.clone());const o=e?r:i,a=e?i:r;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(Hg(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let c=0,u=l.length;c<u;++c)l[c]=Math.round(l[c]*o)/o;return l};s===n&&(s=n.clone()),s.applyTransform(a)}return s}const Mv={Point:_a,LineString:Si,Polygon:xa,MultiPoint:Po,MultiLineString:eo,MultiPolygon:to};function Ov(n,e,t){return Array.isArray(e[0])?(Wg(n,0,e,t)||(n=n.slice(),Vc(n,0,e,t)),n):($b(n,0,e,t)||(n=n.slice(),jb(n,0,e,t)),n)}function ay(n,e){var s;const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>ay({...n,geometry:o})).flat();const r=t.type==="MultiPolygon"?"Polygon":t.type;if(r==="GeometryCollection"||r==="Circle")throw new Error("Unsupported geometry type: "+r);const i=t.layout.length;return Tl(new Ot(r,r==="Polygon"?Ov(t.flatCoordinates,t.ends,i):t.flatCoordinates,(s=t.ends)==null?void 0:s.flat(),i,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function Ah(n,e){if(!n)return null;if(Array.isArray(n)){const r=n.map(i=>Ah(i,e));return new Da(r)}const t=Mv[n.type];return Tl(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class Nv extends oy{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Zo(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Zo(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Lt()}readFeaturesFromObject(e,t){return Lt()}readGeometry(e,t){return this.readGeometryFromObject(Zo(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Lt()}readProjection(e){return this.readProjectionFromObject(Zo(e))}readProjectionFromObject(e){return Lt()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Lt()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Lt()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Lt()}}function Zo(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class ou extends Nv{constructor(e){e=e||{},super(),this.dataProjection=$e(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=$e(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let r=null;e.type==="Feature"?r=e:r={type:"Feature",geometry:e,properties:null};const i=Lh(r.geometry);if(this.featureClass===Ot)return ay({geometry:i,id:r.id,properties:r.properties},t);const s=new ny;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&r.geometry_name&&s.setGeometryName(r.geometry_name),s.setGeometry(Ah(i,t)),"id"in r&&s.setId(r.id),r.properties&&s.setProperties(r.properties,!0),s}readFeaturesFromObject(e,t){const r=e;let i=null;if(r.type==="FeatureCollection"){const s=e;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const c=this.readFeatureFromObject(o[a],t);c&&i.push(c)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return Dv(e,t)}readProjectionFromObject(e){const t=e.crs;let r;if(t)if(t.type=="name")r=$e(t.properties.name);else if(t.type==="EPSG")r=$e("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else r=this.dataProjection;return r}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(r.id=i),!e.hasProperties())return r;const s=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=au(o,t),delete s[e.getGeometryName()]),is(s)||(r.properties=s),r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:r}}writeGeometryObject(e,t){return au(e,this.adaptOptions(t))}}function Lh(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=kv(n);break}case"LineString":{t=Uv(n);break}case"Polygon":{t=jv(n);break}case"MultiPoint":{t=zv(n);break}case"MultiLineString":{t=Bv(n);break}case"MultiPolygon":{t=$v(n);break}case"GeometryCollection":{t=Gv(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function Dv(n,e){const t=Lh(n);return Ah(t,e)}function Gv(n,e){return n.geometries.map(function(r){return Lh(r)})}function kv(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:gs(e.length)}}function Uv(n){var r;const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:gs(((r=e[0])==null?void 0:r.length)||2)}}function Bv(n){var s,o;const e=n.coordinates,t=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length)||2,r=[],i=Qu(r,0,e,t);return{type:"MultiLineString",flatCoordinates:r,ends:i,layout:gs(t)}}function zv(n){var t;const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:gs(((t=e[0])==null?void 0:t.length)||2)}}function $v(n){var s,o;const e=n.coordinates,t=[],r=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,i=Zg(t,0,e,r);return{type:"MultiPolygon",flatCoordinates:t,ends:i,layout:gs(r)}}function jv(n){var s,o;const e=n.coordinates,t=[],r=(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length,i=Qu(t,0,e,r);return{type:"Polygon",flatCoordinates:t,ends:i,layout:gs(r)}}function au(n,e){n=Tl(n,!0,e);const t=n.getType();let r;switch(t){case"Point":{r=Hv(n);break}case"LineString":{r=Vv(n);break}case"Polygon":{r=qv(n,e);break}case"MultiPoint":{r=Zv(n);break}case"MultiLineString":{r=Wv(n);break}case"MultiPolygon":{r=Yv(n,e);break}case"GeometryCollection":{r=Xv(n,e);break}case"Circle":{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return r}function Xv(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(r){return au(r,e)})}}function Vv(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function Wv(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Zv(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Yv(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Hv(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function qv(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}function Fh(n,e){return ly(n,e,[]).join("")}function ly(n,e,t){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t.push(n.nodeValue);else{let r;for(r=n.firstChild;r;r=r.nextSibling)ly(r,e,t)}return t}function Kv(n){return"documentElement"in n}function Jv(n){return new DOMParser().parseFromString(n,"application/xml")}function lu(n,e){return function(t,r){const i=n.call(this,t,r);i!==void 0&&r[r.length-1].push(i)}}function Xt(n,e,t){return function(r,i){const s=n.call(this,r,i);if(s!==void 0){const o=i[i.length-1],a=r.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function J(n,e,t){return function(r,i){const s=n.call(this,r,i);if(s!==void 0){const o=i[i.length-1],a=r.localName;o[a]=s}}}function De(n,e,t){t=t!==void 0?t:{};let r,i;for(r=0,i=n.length;r<i;++r)t[n[r]]=e;return t}function Qv(n,e,t,r){let i;for(i=e.firstElementChild;i;i=i.nextElementSibling){const s=n[i.namespaceURI];if(s!==void 0){const o=s[i.localName];o!==void 0&&o.call(r,i,t)}}}function je(n,e,t,r,i){return r.push(n),Qv(e,t,r,i),r.pop()}class cy{read(e){if(!e)return null;if(typeof e=="string"){const t=Jv(e);return this.readFromDocument(t)}return Kv(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Lt()}}const eR="http://www.w3.org/1999/xlink";function Mh(n){return n.getAttributeNS(eR,"href")}function tR(n){const e=Fh(n,!1);return rR(e)}function rR(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function Gn(n){const e=Fh(n,!1);return nR(e)}function nR(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function we(n){return Fh(n,!1).trim()}const Ht=[null,"http://www.opengis.net/ows/1.1"],iR=De(Ht,{ServiceIdentification:J(IR),ServiceProvider:J(LR),OperationsMetadata:J(CR)});class sR extends cy{constructor(){super()}readFromNode(e){const t=je({},iR,e,[]);return t||null}}const oR=De(Ht,{DeliveryPoint:J(we),City:J(we),AdministrativeArea:J(we),PostalCode:J(we),Country:J(we),ElectronicMailAddress:J(we)}),aR=De(Ht,{Value:Xt(FR)}),lR=De(Ht,{AllowedValues:J(bR)}),cR=De(Ht,{Phone:J(PR),Address:J(xR)}),uR=De(Ht,{HTTP:J(vR)}),hR=De(Ht,{Get:Xt(SR),Post:void 0}),dR=De(Ht,{DCP:J(wR)}),fR=De(Ht,{Operation:RR}),pR=De(Ht,{Voice:J(we),Facsimile:J(we)}),gR=De(Ht,{Constraint:Xt(ER)}),mR=De(Ht,{IndividualName:J(we),PositionName:J(we),ContactInfo:J(TR)}),yR=De(Ht,{Abstract:J(we),AccessConstraints:J(we),Fees:J(we),Title:J(we),ServiceTypeVersion:J(we),ServiceType:J(we)}),_R=De(Ht,{ProviderName:J(we),ProviderSite:J(Mh),ServiceContact:J(AR)});function xR(n,e){return je({},oR,n,e)}function bR(n,e){return je({},aR,n,e)}function ER(n,e){const t=n.getAttribute("name");if(t)return je({name:t},lR,n,e)}function TR(n,e){return je({},cR,n,e)}function wR(n,e){return je({},uR,n,e)}function SR(n,e){const t=Mh(n);if(t)return je({href:t},gR,n,e)}function vR(n,e){return je({},hR,n,e)}function RR(n,e){const t=n.getAttribute("name"),r=je({},dR,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function CR(n,e){return je({},fR,n,e)}function PR(n,e){return je({},pR,n,e)}function IR(n,e){return je({},yR,n,e)}function AR(n,e){return je({},mR,n,e)}function LR(n,e){return je({},_R,n,e)}function FR(n,e){return we(n)}const tn=[null,"http://www.opengis.net/wmts/1.0"],bs=[null,"http://www.opengis.net/ows/1.1"],MR=De(tn,{Contents:J(XR)});let OR=class extends cy{constructor(){super(),this.owsParser_=new sR}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=je(r,MR,e,[]),r||null):null}};const NR=De(tn,{Layer:Xt(VR),TileMatrixSet:Xt(WR)}),DR=De(tn,{Style:Xt(ZR),Format:Xt(we),TileMatrixSetLink:Xt(YR),Dimension:Xt(HR),ResourceURL:Xt(qR)},De(bs,{Title:J(we),Abstract:J(we),WGS84BoundingBox:J(hy),BoundingBox:Xt(KR),Identifier:J(we)})),GR=De(tn,{LegendURL:Xt(JR)},De(bs,{Title:J(we),Identifier:J(we)})),kR=De(tn,{TileMatrixSet:J(we),TileMatrixSetLimits:J(eC)}),UR=De(tn,{TileMatrixLimits:lu(tC)}),BR=De(tn,{TileMatrix:J(we),MinTileRow:J(Gn),MaxTileRow:J(Gn),MinTileCol:J(Gn),MaxTileCol:J(Gn)}),zR=De(tn,{Default:J(we),Value:Xt(we)},De(bs,{Identifier:J(we)})),uy=De(bs,{LowerCorner:lu(cu),UpperCorner:lu(cu)}),$R=De(tn,{WellKnownScaleSet:J(we),TileMatrix:Xt(QR)},De(bs,{SupportedCRS:J(we),Identifier:J(we),BoundingBox:J(hy)})),jR=De(tn,{TopLeftCorner:J(cu),ScaleDenominator:J(tR),TileWidth:J(Gn),TileHeight:J(Gn),MatrixWidth:J(Gn),MatrixHeight:J(Gn)},De(bs,{Identifier:J(we)}));function XR(n,e){return je({},NR,n,e)}function VR(n,e){return je({},DR,n,e)}function WR(n,e){return je({},$R,n,e)}function ZR(n,e){const t=je({},GR,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function YR(n,e){return je({},kR,n,e)}function HR(n,e){return je({},zR,n,e)}function qR(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function hy(n,e){const t=je([],uy,n,e);if(t.length==2)return Ju(t)}function KR(n,e){const t=n.getAttribute("crs"),r=je([],uy,n,e);if(r.length==2)return{extent:Ju(r),crs:t}}function JR(n,e){const t={};return t.format=n.getAttribute("format"),t.href=Mh(n),t}function cu(n,e){const t=we(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function QR(n,e){return je({},jR,n,e)}function eC(n,e){return je([],UR,n,e)}function tC(n,e){return je({},BR,n,e)}class Oh{constructor(){ye(this,"pushMethodArgs_",(...e)=>(this.push_(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Qd(),{get:(e,t)=>{if(typeof Qd()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,r)=>(this.push_(t,r),!0)})}push_(...e){const t=this.instructions_,r=this.zIndex+this.offset_;t[r]||(t[r]=[]),t[r].push(...e)}pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let r=0,i=t.length;r<i;++r){const s=t[r];if(typeof s=="function"){s(e);continue}const o=t[++r];if(typeof e[s]=="function")e[s](...o);else{if(typeof o=="function"){e[s]=o(e);continue}e[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Kf=[];let Gi=null;function rC(){Gi=Mr(1,1,void 0,{willReadFrequently:!0})}class Nh extends Xb{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Tr(),this.pixelTransform=Tr(),this.inversePixelTransform=Tr(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,r){Gi||rC(),Gi.clearRect(0,0,1,1);let i;try{Gi.drawImage(e,t,r,1,1,0,0,1,1),i=Gi.getImageData(0,0,1,1).data}catch{return Gi=null,null}return i}getBackground(e){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(e.viewState.resolution)),r||void 0}useContainer(e,t,r){const i=this.getLayer().getClassName();let s,o;if(e&&e.className===i&&(!r||e&&e.style.backgroundColor&&xo(ef(e.style.backgroundColor),ef(r)))){const a=e.firstElementChild;Vb(a)&&(o=a.getContext("2d"))}if(o&&Wb(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=bo?Zb():document.createElement("div"),s.className=i;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=Mr();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const i=cl(r),s=sb(r),o=ob(r),a=ab(r);Tt(t.coordinateToPixelTransform,i),Tt(t.coordinateToPixelTransform,s),Tt(t.coordinateToPixelTransform,o),Tt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Tt(l,i),Tt(l,s),Tt(l,o),Tt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const r=e.extent,i=e.viewState.resolution,s=e.viewState.rotation,o=e.pixelRatio,a=Math.round(er(r)/i*o),l=Math.round(Fr(r)/i*o);Yn(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,s,-a/2,-l/2),qg(this.inversePixelTransform,this.pixelTransform);const c=Yb(this.pixelTransform);if(this.useContainer(t,c,this.getBackground(e)),!this.containerReused){const u=this.context.canvas;u.width!=a||u.height!=l?(u.width=a,u.height=l):this.context.clearRect(0,0,a,l),c!==u.style.transform&&(u.style.transform=c)}}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){const s=new Hb(e,this.inversePixelTransform,r,t);i.dispatchEvent(s)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(Xi.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(Xi.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new Oh),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(Xi.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(Xi.POSTRENDER,this.context,e))}getRenderTransform(e,t,r,i,s,o,a){const l=s/2,c=o/2,u=i/t,h=-u,d=-e[0]+a,f=-e[1];return Yn(this.tempTransform,l,c,u,h,-r,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class nC extends Nh{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,s=i.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Zn(l,ss(t.extent,i.projection))),!a[xr.ANIMATING]&&!a[xr.INTERACTING]&&!ul(l))if(o){const c=i.projection,u=o.getImage(l,s,r,c);u&&(this.loadImage(u)?this.image=u:u.getState()===We.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=Tt(t.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!Js(s,i))return null;const o=this.image.getExtent(),a=this.image.getImage(),l=er(o),c=Math.floor(a.width*((i[0]-o[0])/l));if(c<0||c>=a.width)return null;const u=Fr(o),h=Math.floor(a.height*((o[3]-i[1])/u));return h<0||h>=a.height?null:this.getImageData(a,c,h)}renderFrame(e,t){const r=this.image,i=r.getExtent(),s=r.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=r.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,h=e.viewState,d=h.center,f=h.resolution,p=u*o/(f*l),g=u*a/(f*l);this.prepareContainer(e,t);const m=this.context.canvas.width,y=this.context.canvas.height,_=this.getRenderContext(e);let x=!1,E=!0;if(c.extent){const S=ss(c.extent,h.projection);E=xt(S,e.extent),x=E&&!Vr(S,e.extent),x&&this.clipUnrotated(_,e,S)}const b=r.getImage(),T=Yn(this.tempTransform,m/2,y/2,p,g,0,l*(i[0]-d[0])/o,l*(d[1]-i[3])/a);this.renderedResolution=a*u/l;const w=b.width*T[0],v=b.height*T[3];if(this.getLayer().getSource().getInterpolate()||(_.imageSmoothingEnabled=!1),this.preRender(_,e),E&&w>=.5&&v>=.5){const S=T[4],C=T[5],P=c.opacity;P!==1&&(_.save(),_.globalAlpha=P),_.drawImage(b,0,0,+b.width,+b.height,S,C,w,v),P!==1&&_.restore()}return this.postRender(this.context,e),x&&_.restore(),_.imageSmoothingEnabled=!0,this.container}}class iC extends Kg{constructor(e){e=e||{},super(e)}}class Dh extends iC{constructor(e){super(e)}createRenderer(){return new nC(this)}getData(e){return super.getData(e)}}function sc(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const r=n[t],i=r.has(e);return i||r.add(e),!i}function sC(n,e,t){const r=n[t];return r?r.delete(e):!1}function Jf(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Zn(e,ss(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=Zn(e,i))}return e}class dy extends Nh{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=bi(),this.tempTileRange_=new qb(0,0,0,0),this.tempTileCoord_=tf(0,0,0);const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new rf(r),this.sourceTileCache_=null,this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new rf(512)),this.sourceTileCache_}getOrCreateTile(e,t,r,i){const s=this.tileCache_,a=this.getLayer().getSource(),l=Kl(a,a.getKey(),e,t,r);let c;if(s.containsKey(l))c=s.get(l);else{const u=i.viewState.projection,h=a.getProjection();if(c=a.getTile(e,t,r,i.pixelRatio,u,!h||Mt(h,u)?void 0:this.getSourceTileCache()),!c)return null;s.set(l,c)}return c}getTile(e,t,r,i){const s=this.getOrCreateTile(e,t,r,i);return s||null}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=Tt(t.pixelToCoordinateTransform,e.slice()),s=r.getExtent();if(s&&!Js(s,i))return null;const o=t.viewState,a=r.getRenderSource(),l=a.getTileGridForProjection(o.projection),c=a.getTilePixelRatio(t.pixelRatio);for(let u=l.getZForResolution(o.resolution);u>=l.getMinZoom();--u){const h=l.getTileCoordForCoordAndZ(i,u),d=this.getTile(u,h[1],h[2],t);if(!d||d.getState()!==de.LOADED)continue;const f=l.getOrigin(u),p=eh(l.getTileSize(u)),g=l.getResolution(u);let m;if(d instanceof Kb||d instanceof Jb)m=d.getImage();else if(d instanceof nf){if(m=sf(d.getData()),!m)continue}else continue;const y=Math.floor(c*((i[0]-f[0])/g-h[1]*p[0])),_=Math.floor(c*((f[1]-i[1])/g-h[2]*p[1])),x=Math.round(c*a.getGutterForProjection(o.projection));return this.getImageData(m,y+x,_+x)}return null}prepareFrame(e){var i;this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const r=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==r&&(this.renderedSourceRevision_=r,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),(i=this.sourceTileCache_)==null||i.clear())):this.renderedSourceRevision_=r,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),u=ve(l);u in e.wantedTiles||(e.wantedTiles[u]={});const h=e.wantedTiles[u],d=a.getMapInternal(),f=Math.max(r-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),p=o.rotation,g=p?lb(o.center,o.resolution,p,e.size):void 0;for(let m=r;m>=f;--m){const y=c.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),_=c.getResolution(m);for(let x=y.minX;x<=y.maxX;++x)for(let E=y.minY;E<=y.maxY;++E){if(p&&!c.tileCoordIntersectsViewport([m,x,E],g))continue;const b=this.getTile(m,x,E,e);if(!b||!sc(i,b,m))continue;const w=b.getKey();if(h[w]=!0,b.getState()===de.IDLE&&!e.tileQueue.isKeyQueued(w)){const v=tf(m,x,E,this.tempTileCoord_);e.tileQueue.enqueue([b,u,c.getTileCoordCenter(v),_])}}}}findStaleTile_(e,t){const r=this.tileCache_,i=e[0],s=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const c=Kl(this.getLayer().getSource(),a[l],i,s,o);if(r.containsKey(c)){const u=r.peek(c);if(u.getState()===de.LOADED)return u.endTransition(ve(this)),sc(t,u,i),!0}}return!1}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let u=s.minX;u<=s.maxX;++u)for(let h=s.minY;h<=s.maxY;++h){const d=Kl(l,c,r,u,h);let f=!1;if(a.containsKey(d)){const p=a.peek(d);p.getState()===de.LOADED&&(sc(i,p,r),f=!0)}f||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],i=e.viewState,s=i.projection,o=i.resolution,a=i.center,l=e.pixelRatio,c=this.getLayer(),u=c.getSource(),h=u.getTileGridForProjection(s),d=h.getZForResolution(o,u.zDirection),f=h.getResolution(d),p=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==p&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=p):this.renderedSourceKey_=p;let g=e.extent;const m=u.getTilePixelRatio(l);this.prepareContainer(e,t);const y=this.context.canvas.width,_=this.context.canvas.height,x=r.extent&&ss(r.extent);x&&(g=Zn(g,ss(r.extent)));const E=f*y/2/m,b=f*_/2/m,T=[a[0]-E,a[1]-b,a[0]+E,a[1]+b],w={};this.renderedTiles.length=0;const v=c.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const U=h.getZForResolution(i.nextResolution,u.zDirection),B=Jf(e,e.nextExtent);this.enqueueTiles(e,B,U,w,v)}const S=Jf(e,g);if(this.enqueueTiles(e,S,d,w,0),v>0&&setTimeout(()=>{this.enqueueTiles(e,S,d-1,w,v-1)},0),!(d in w))return this.container;const C=ve(this),P=e.time;for(const U of w[d]){const B=U.getState();if(B===de.EMPTY)continue;const V=U.tileCoord;if(B===de.LOADED&&U.getAlpha(C,P)===1){U.endTransition(C);continue}if(B!==de.ERROR&&(this.renderComplete=!1),this.findStaleTile_(V,w)){sC(w,U,d),e.animate=!0;continue}if(this.findAltTiles_(h,V,d+1,w))continue;const K=h.getMinZoom();for(let k=d-1;k>=K&&!this.findAltTiles_(h,V,k,w);--k);}const A=f/o*l/m,N=this.getRenderContext(e);Yn(this.tempTransform,y/2,_/2,A,A,0,-y/2,-_/2),r.extent&&this.clipUnrotated(N,e,x),u.getInterpolate()||(N.imageSmoothingEnabled=!1),this.preRender(N,e);const D=Object.keys(w).map(Number);D.sort(Yi);let R;const M=[],O=[];for(let U=D.length-1;U>=0;--U){const B=D[U],V=u.getTilePixelSize(B,l,s),G=h.getResolution(B)/f,K=V[0]*G*A,k=V[1]*G*A,le=h.getTileCoordForCoordAndZ(cl(T),B),xe=h.getTileCoordExtent(le),be=Tt(this.tempTransform,[m*(xe[0]-T[0])/f,m*(T[3]-xe[3])/f]),at=m*u.getGutterForProjection(s);for(const Re of w[B]){if(Re.getState()!==de.LOADED)continue;const qe=Re.tileCoord,Bt=le[1]-qe[1],mt=Math.round(be[0]-(Bt-1)*K),ft=le[2]-qe[2],W=Math.round(be[1]-(ft-1)*k),lt=Math.round(be[0]-Bt*K),vt=Math.round(be[1]-ft*k),pe=mt-lt,rn=W-vt,ur=D.length===1;let tt=!1;R=[lt,vt,lt+pe,vt,lt+pe,vt+rn,lt,vt+rn];for(let Nr=0,Ke=M.length;Nr<Ke;++Nr)if(!ur&&B<O[Nr]){const Je=M[Nr];xt([lt,vt,lt+pe,vt+rn],[Je[0],Je[3],Je[4],Je[7]])&&(tt||(N.save(),tt=!0),N.beginPath(),N.moveTo(R[0],R[1]),N.lineTo(R[2],R[3]),N.lineTo(R[4],R[5]),N.lineTo(R[6],R[7]),N.moveTo(Je[6],Je[7]),N.lineTo(Je[4],Je[5]),N.lineTo(Je[2],Je[3]),N.lineTo(Je[0],Je[1]),N.clip())}M.push(R),O.push(B),this.drawTile(Re,e,lt,vt,pe,rn,at,ur),tt&&N.restore(),this.renderedTiles.unshift(Re),this.updateUsedTiles(e.usedTiles,u,Re)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Ei(this.renderedExtent_,T),this.renderedExtent_=T,this.renderedPixelRatio=l,this.postRender(this.context,e),r.extent&&N.restore(),N.imageSmoothingEnabled=!0,this.renderComplete){const U=(B,V)=>{var k;const Y=ve(u),G=V.wantedTiles[Y],K=G?Object.keys(G).length:0;this.updateCacheSize(K),this.tileCache_.expireCache(),(k=this.sourceTileCache_)==null||k.expireCache()};e.postRenderFunctions.push(U)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,r,i,s,o,a,l){let c;if(e instanceof nf){if(c=sf(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const u=this.getRenderContext(t),h=ve(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(h,t.time):1),p=f!==u.globalAlpha;p&&(u.save(),u.globalAlpha=f),u.drawImage(c,a,a,c.width-2*a,c.height-2*a,r,i,s,o),p&&u.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,r){const i=ve(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}}class Ga extends Qb{constructor(e){super(e)}createRenderer(){return new dy(this,{cacheSize:this.getCacheSize()})}}class fy{drawCustom(e,t,r,i,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,r){}drawFeature(e,t,r){}drawGeometryCollection(e,t,r){}drawLineString(e,t,r){}drawMultiLineString(e,t,r){}drawMultiPoint(e,t,r){}drawMultiPolygon(e,t,r){}drawPoint(e,t,r){}drawPolygon(e,t,r){}drawText(e,t,r){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const ee={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Yo=[ee.FILL],kn=[ee.STROKE],ui=[ee.BEGIN_PATH],Qf=[ee.CLOSE_PATH];class Io extends fy{constructor(e,t,r,i){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(r){return r*t})}appendFlatPointCoordinates(e,t){const r=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)i[0]=e[a],i[1]=e[a+1],Js(r,i)&&(s[o++]=i[0],s[o++]=i[1]);return o}appendFlatLineCoordinates(e,t,r,i,s,o){const a=this.coordinates;let l=a.length;const c=this.getBufferedMaxExtent();o&&(t+=i);let u=e[t],h=e[t+1];const d=this.tmpCoordinate_;let f=!0,p,g,m;for(p=t+i;p<r;p+=i)d[0]=e[p],d[1]=e[p+1],m=cb(c,d),m!==g?(f&&(a[l++]=u,a[l++]=h,f=!1),a[l++]=d[0],a[l++]=d[1]):m===ub.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,u=d[0],h=d[1],g=m;return(s&&f||p===t+i)&&(a[l++]=u,a[l++]=h),l}drawCustomCoordinates_(e,t,r,i,s){for(let o=0,a=r.length;o<a;++o){const l=r[o],c=this.appendFlatLineCoordinates(e,t,l,i,!1,!1);s.push(c),t=l}return t}drawCustom(e,t,r,i,s){this.beginGeometry(e,t,s);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let c,u,h,d,f;switch(o){case"MultiPolygon":c=e.getOrientedFlatCoordinates(),d=[];const p=e.getEndss();f=0;for(let g=0,m=p.length;g<m;++g){const y=[];f=this.drawCustomCoordinates_(c,f,p[g],a,y),d.push(y)}this.instructions.push([ee.CUSTOM,l,d,e,r,Wc,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,d,e,i||r,Wc,s]);break;case"Polygon":case"MultiLineString":h=[],c=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(c,0,e.getEnds(),a,h),this.instructions.push([ee.CUSTOM,l,h,e,r,Xc,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,h,e,i||r,Xc,s]);break;case"LineString":case"Circle":c=e.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([ee.CUSTOM,l,u,e,r,ji,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,u,e,i||r,ji,s]);break;case"MultiPoint":c=e.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>l&&(this.instructions.push([ee.CUSTOM,l,u,e,r,ji,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,u,e,i||r,ji,s]));break;case"Point":c=e.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([ee.CUSTOM,l,u,e,r,void 0,s]),this.hitDetectionInstructions.push([ee.CUSTOM,l,u,e,i||r,void 0,s]);break}this.endGeometry(t)}beginGeometry(e,t,r){this.beginGeometryInstruction1_=[ee.BEGIN_GEOMETRY,t,0,e,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ee.BEGIN_GEOMETRY,t,0,e,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const r=e.length;let i,s,o=-1;for(t=0;t<r;++t)i=e[t],s=i[0],s==ee.END_GEOMETRY?o=t:s==ee.BEGIN_GEOMETRY&&(i[2]=t,hb(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const r=e.getColor();t.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,t.fillStyle=Dn(r||br)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const r=e.getColor();t.strokeStyle=Dn(r||ba);const i=e.getLineCap();t.lineCap=i!==void 0?i:Ea;const s=e.getLineDash();t.lineDash=s?s.slice():mn;const o=e.getLineDashOffset();t.lineDashOffset=o||yn;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:Ta;const l=e.getWidth();t.lineWidth=l!==void 0?l:wa;const c=e.getMiterLimit();t.miterLimit=c!==void 0?c:Sa,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const r=this.state;this.fillStyleToState(e,r),this.strokeStyleToState(t,r)}createFill(e){const t=e.fillStyle,r=[ee.SET_FILL_STYLE,t];return typeof t!="string"&&r.push(e.fillPatternScale),r}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[ee.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const r=e.fillStyle;(typeof r!="string"||e.currentFillStyle!=r)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=r)}updateStrokeStyle(e,t){const r=e.strokeStyle,i=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,c=e.miterLimit;(e.currentStrokeStyle!=r||e.currentLineCap!=i||s!=e.currentLineDash&&!xo(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=c)&&(t.call(this,e),e.currentStrokeStyle=r,e.currentLineCap=i,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=c)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[ee.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=db(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Wr(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class oC extends Io{constructor(e,t,r,i){super(e,t,r,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,r){if(!this.image_||this.maxExtent&&!Js(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,r);const i=e.getFlatCoordinates(),s=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(i,s);this.instructions.push([ee.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,r){if(!this.image_)return;this.beginGeometry(e,t,r);const i=e.getFlatCoordinates(),s=[];for(let l=0,c=i.length;l<c;l+=e.getStride())(!this.maxExtent||Js(this.maxExtent,i.slice(l,l+2)))&&s.push(i[l],i[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([ee.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const r=e.getAnchor(),i=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=i[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class aC extends Io{constructor(e,t,r,i){super(e,t,r,i)}drawFlatCoordinates_(e,t,r,i){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,r,i,!1,!1),a=[ee.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}drawLineString(e,t,r){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t,r),this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,mn,yn],ui);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(kn),this.endGeometry(t)}drawMultiLineString(e,t,r){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t,r),this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,mn,yn],ui);const a=e.getEnds(),l=e.getFlatCoordinates(),c=e.getStride();let u=0;for(let h=0,d=a.length;h<d;++h)u=this.drawFlatCoordinates_(l,u,a[h],c);this.hitDetectionInstructions.push(kn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(kn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(kn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(ui)}}class ep extends Io{constructor(e,t,r,i){super(e,t,r,i)}drawFlatCoordinatess_(e,t,r,i){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=r.length;this.instructions.push(ui),this.hitDetectionInstructions.push(ui);for(let c=0;c<l;++c){const u=r[c],h=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,u,i,!0,!a),f=[ee.MOVE_TO_LINE_TO,h,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Qf),this.hitDetectionInstructions.push(Qf)),t=u}return o&&(this.instructions.push(Yo),this.hitDetectionInstructions.push(Yo)),a&&(this.instructions.push(kn),this.hitDetectionInstructions.push(kn)),t}drawCircle(e,t,r){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,br]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,mn,yn]);const a=e.getFlatCoordinates(),l=e.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const u=[ee.CIRCLE,c];this.instructions.push(ui,u),this.hitDetectionInstructions.push(ui,u),i.fillStyle!==void 0&&(this.instructions.push(Yo),this.hitDetectionInstructions.push(Yo)),i.strokeStyle!==void 0&&(this.instructions.push(kn),this.hitDetectionInstructions.push(kn)),this.endGeometry(t)}drawPolygon(e,t,r){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,br]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,mn,yn]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),c=e.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(t)}drawMultiPolygon(e,t,r){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_FILL_STYLE,br]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ee.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,mn,yn]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),c=e.getStride();let u=0;for(let h=0,d=a.length;h<d;++h)u=this.drawFlatCoordinatess_(l,u,a[h],c);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let r=0,i=t.length;r<i;++r)t[r]=eE(t[r],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function lC(n,e,t,r,i){const s=[];let o=t,a=0,l=e.slice(t,2);for(;a<n&&o+i<r;){const[c,u]=l.slice(-2),h=e[o+i],d=e[o+i+1],f=Math.sqrt((h-c)*(h-c)+(d-u)*(d-u));if(a+=f,a>=n){const p=(n-a+f)/f,g=_r(c,h,p),m=_r(u,d,p);l.push(g,m),s.push(l),l=[g,m],a==n&&(o+=i),a=0}else if(a<n)l.push(e[o+i],e[o+i+1]),o+=i;else{const p=f-a,g=_r(c,h,p/f),m=_r(u,d,p/f);l.push(g,m),s.push(l),l=[g,m],a=0,o+=i}}return a>0&&s.push(l),s}function cC(n,e,t,r,i){let s=t,o=t,a=0,l=0,c=t,u,h,d,f,p,g,m,y,_,x;for(h=t;h<r;h+=i){const E=e[h],b=e[h+1];p!==void 0&&(_=E-p,x=b-g,f=Math.sqrt(_*_+x*x),m!==void 0&&(l+=d,u=Math.acos((m*_+y*x)/(d*f)),u>n&&(l>a&&(a=l,s=c,o=h),l=0,c=h-i)),d=f,m=_,y=x),p=E,g=b}return l+=f,l>a?[c,h]:[s,o]}const ka={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class uC extends Io{constructor(e,t,r,i){super(e,t,r,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[br]={fillStyle:br},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,r){const i=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!i&&!s)return;const a=this.coordinates;let l=a.length;const c=e.getType();let u=null,h=e.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!xt(this.maxExtent,e.getExtent()))return;let d;if(u=e.getFlatCoordinates(),c=="LineString")d=[u.length];else if(c=="MultiLineString")d=e.getEnds();else if(c=="Polygon")d=e.getEnds().slice(0,1);else if(c=="MultiPolygon"){const m=e.getEndss();d=[];for(let y=0,_=m.length;y<_;++y)d.push(m[y][0])}this.beginGeometry(e,t,r);const f=o.repeat,p=f?void 0:o.textAlign;let g=0;for(let m=0,y=d.length;m<y;++m){let _;f?_=lC(f*this.resolution,u,g,d[m],h):_=[u.slice(g,d[m])];for(let x=0,E=_.length;x<E;++x){const b=_[x];let T=0,w=b.length;if(p==null){const S=cC(o.maxAngle,b,0,b.length,2);T=S[0],w=S[1]}for(let S=T;S<w;S+=h)a.push(b[S],b[S+1]);const v=a.length;g=d[m],this.drawChars_(l,v),l=v}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=e.getFlatCoordinates();break;case"LineString":u=e.getFlatMidpoint();break;case"Circle":u=e.getCenter();break;case"MultiLineString":u=e.getFlatMidpoints(),h=2;break;case"Polygon":u=e.getFlatInteriorPoint(),o.overflow||d.push(u[2]/this.resolution),h=3;break;case"MultiPolygon":const E=e.getFlatInteriorPoints();u=[];for(let b=0,T=E.length;b<T;b+=3)o.overflow||d.push(E[b+2]/this.resolution),u.push(E[b],E[b+1]);if(u.length===0)return;h=2;break}const f=this.appendFlatPointCoordinates(u,h);if(f===l)return;if(d&&(f-l)/2!==u.length/h){let E=l/2;d=d.filter((b,T)=>{const w=a[(E+T)*2]===u[T*h]&&a[(E+T)*2+1]===u[T*h+1];return w||--E,w})}this.saveTextStates_();const p=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,g=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,r);let m=o.padding;if(m!=ci&&(o.scale[0]<0||o.scale[1]<0)){let E=o.padding[0],b=o.padding[1],T=o.padding[2],w=o.padding[3];o.scale[0]<0&&(b=-b,w=-w),o.scale[1]<0&&(E=-E,T=-T),m=[E,b,T,w]}const y=this.pixelRatio;this.instructions.push([ee.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==ci?ci:m.map(function(E){return E*y}),p,g,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const _=1/y,x=p?p.slice(0):null;x&&(x[1]=br),this.hitDetectionInstructions.push([ee.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,this.declutterMode_,this.declutterImageWithText_,m,x,g,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?br:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,r=this.textFillState_,i=this.strokeKey_;e&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||Qs,justify:t.justify,textBaseline:t.textBaseline||va,scale:t.scale});const o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))}drawChars_(e,t){const r=this.textStrokeState_,i=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,c=ka[i.textBaseline],u=this.textOffsetY_*l,h=this.text_,d=r?r.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([ee.DRAW_CHARS,e,t,c,i.overflow,a,i.maxAngle,l,u,s,d*l,h,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([ee.DRAW_CHARS,e,t,c,i.overflow,a&&br,i.maxAngle,l,u,s,d*l,h,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let r,i,s;if(!e)this.text_="";else{const o=e.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=Dn(o.getColor()||br)):(i=null,this.textFillState_=i);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const g=a.getLineDash(),m=a.getLineDashOffset(),y=a.getWidth(),_=a.getMiterLimit();s.lineCap=a.getLineCap()||Ea,s.lineDash=g?g.slice():mn,s.lineDashOffset=m===void 0?yn:m,s.lineJoin=a.getLineJoin()||Ta,s.lineWidth=y===void 0?wa:y,s.miterLimit=_===void 0?Sa:_,s.strokeStyle=Dn(a.getColor()||ba)}r=this.textState_;const l=e.getFont()||Jg;tE(l);const c=e.getScaleArray();r.overflow=e.getOverflow(),r.font=l,r.maxAngle=e.getMaxAngle(),r.placement=e.getPlacement(),r.textAlign=e.getTextAlign(),r.repeat=e.getRepeat(),r.justify=e.getJustify(),r.textBaseline=e.getTextBaseline()||va,r.backgroundFill=e.getBackgroundFill(),r.backgroundStroke=e.getBackgroundStroke(),r.padding=e.getPadding()||ci,r.scale=c===void 0?[1,1]:c;const u=e.getOffsetX(),h=e.getOffsetY(),d=e.getRotateWithView(),f=e.getKeepUpright(),p=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=h===void 0?0:h,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=p===void 0?0:p,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:ve(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+ve(i.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const hC={Circle:ep,Default:Io,Image:oC,LineString:aC,Polygon:ep,Text:uC};class py{constructor(e,t,r,i){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=i,this.resolution_=r,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const r=this.buildersByZIndex_[t];for(const i in r){const s=r[i].finish();e[t][i]=s}}return e}getBuilder(e,t){const r=e!==void 0?e.toString():"0";let i=this.buildersByZIndex_[r];i===void 0&&(i={},this.buildersByZIndex_[r]=i);let s=i[t];if(s===void 0){const o=hC[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[t]=s}return s}}function dC(n,e,t,r,i,s,o,a,l,c,u,h,d=!0){let f=n[e],p=n[e+1],g=0,m=0,y=0,_=0;function x(){g=f,m=p,e+=r,f=n[e],p=n[e+1],_+=y,y=Math.sqrt((f-g)*(f-g)+(p-m)*(p-m))}do x();while(e<t-r&&_+y<s);let E=y===0?0:(s-_)/y;const b=_r(g,f,E),T=_r(m,p,E),w=e-r,v=_,S=s+a*l(c,i,u);for(;e<t-r&&_+y<S;)x();E=y===0?0:(S-_)/y;const C=_r(g,f,E),P=_r(m,p,E);let A=!1;if(d)if(h){const O=[b,T,C,P];rE(O,0,4,2,h,O,O),A=O[0]>O[2]}else A=b>C;const N=Math.PI,D=[],R=w+r===e;e=w,y=0,_=v,f=n[e],p=n[e+1];let M;if(R){x(),M=Math.atan2(p-m,f-g),A&&(M+=M>0?-N:N);const O=(C+b)/2,U=(P+T)/2;return D[0]=[O,U,(S-s)/2,M,i],D}i=i.replace(/\n/g," ");for(let O=0,U=i.length;O<U;){x();let B=Math.atan2(p-m,f-g);if(A&&(B+=B>0?-N:N),M!==void 0){let le=B-M;if(le+=le>N?-2*N:le<-N?2*N:0,Math.abs(le)>o)return null}M=B;const V=O;let Y=0;for(;O<U;++O){const le=A?U-O-1:O,xe=a*l(c,i[le],u);if(e+r<t&&_+y<s+Y+xe/2)break;Y+=xe}if(O===V)continue;const G=A?i.substring(U-V,U-O):i.substring(V,O);E=y===0?0:(s+Y/2-_)/y;const K=_r(g,f,E),k=_r(m,p,E);D.push([K,k,Y/2,B,G]),s+=Y}return D}const Fi=bi(),Rn=[],cn=[],un=[],Cn=[];function tp(n){return n[3].declutterBox}const rp=new RegExp("[-----]");function oc(n,e){return e==="start"?e=rp.test(n)?"right":"left":e==="end"&&(e=rp.test(n)?"left":"right"),ka[e]}function fC(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function pC(n,e,t){return t%2===0&&(n+=e),n}class gC{constructor(e,t,r,i,s){this.overlaps=r,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=Tr(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new Oh:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,r,i){const s=e+t+r+i;if(this.labels_[s])return this.labels_[s];const o=i?this.strokeStates[i]:null,a=r?this.fillStates[r]:null,l=this.textStates[t],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],h=l.justify?ka[l.justify]:oc(Array.isArray(e)?e[0]:e,l.textAlign||Qs),d=i&&o.lineWidth?o.lineWidth:0,f=Array.isArray(e)?e:String(e).split(`
`).reduce(fC,[]),{width:p,height:g,widths:m,heights:y,lineWidths:_}=nE(l,f),x=p+d,E=[],b=(x+2)*u[0],T=(g+d)*u[1],w={width:b<0?Math.floor(b):Math.ceil(b),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:E};(u[0]!=1||u[1]!=1)&&E.push("scale",u),i&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",d),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),r&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const v=.5-h;let S=h*x+v*d;const C=[],P=[];let A=0,N=0,D=0,R=0,M;for(let O=0,U=f.length;O<U;O+=2){const B=f[O];if(B===`
`){N+=A,A=0,S=h*x+v*d,++R;continue}const V=f[O+1]||l.font;V!==M&&(i&&C.push("font",V),r&&P.push("font",V),M=V),A=Math.max(A,y[D]);const Y=[B,S+v*m[D]+h*(m[D]-_[R]),.5*(d+A)+N];S+=m[D],i&&C.push("strokeText",Y),r&&P.push("fillText",Y),++D}return Array.prototype.push.apply(E,C),Array.prototype.push.apply(E,P),this.labels_[s]=w,w}replayTextBackground_(e,t,r,i,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,r),e.lineTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,r,i,s,o,a,l,c,u,h,d,f,p,g,m){a*=d[0],l*=d[1];let y=r-a,_=i-l;const x=s+c>e?e-c:s,E=o+u>t?t-u:o,b=p[3]+x*d[0]+p[1],T=p[0]+E*d[1]+p[2],w=y-p[3],v=_-p[0];(g||h!==0)&&(Rn[0]=w,Cn[0]=w,Rn[1]=v,cn[1]=v,cn[0]=w+b,un[0]=cn[0],un[1]=v+T,Cn[1]=un[1]);let S;return h!==0?(S=Yn(Tr(),r,i,1,1,h,-r,-i),Tt(S,Rn),Tt(S,cn),Tt(S,un),Tt(S,Cn),$c(Math.min(Rn[0],cn[0],un[0],Cn[0]),Math.min(Rn[1],cn[1],un[1],Cn[1]),Math.max(Rn[0],cn[0],un[0],Cn[0]),Math.max(Rn[1],cn[1],un[1],Cn[1]),Fi)):$c(Math.min(w,w+b),Math.min(v,v+T),Math.max(w,w+b),Math.max(v,v+T),Fi),f&&(y=Math.round(y),_=Math.round(_)),{drawImageX:y,drawImageY:_,drawImageW:x,drawImageH:E,originX:c,originY:u,declutterBox:{minX:Fi[0],minY:Fi[1],maxX:Fi[2],maxY:Fi[3],value:m},canvasTransform:S,scale:d}}replayImageOrLabel_(e,t,r,i,s,o,a){const l=!!(o||a),c=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=t[0]&&c.maxX+u>=0&&c.minY-u<=t[1]&&c.maxY+u>=0&&(l&&this.replayTextBackground_(e,Rn,cn,un,Cn,o,a),iE(e,i.canvasTransform,s,r,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const r=Tt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(r[0]%i,r[1]%i),t!==1&&e.scale(t,t)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,r,i){const s=this.textStates[t],o=this.createLabel(e,t,i,r),a=this.strokeStates[r],l=this.pixelRatio,c=oc(Array.isArray(e)?e[0]:e,s.textAlign||Qs),u=ka[s.textBaseline||va],h=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*s.scale[0],f=c*d+2*(.5-c)*h,p=u*o.height/l+2*(.5-u)*h;return{label:o,anchorX:f,anchorY:p}}execute_(e,t,r,i,s,o,a,l){const c=this.zIndexContext_;let u;this.pixelCoordinates_&&xo(r,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=Hi(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),sE(this.renderedTransform_,r));let h=0;const d=i.length;let f=0,p,g,m,y,_,x,E,b,T,w,v,S,C,P=0,A=0;const N=this.coordinateCache_,D=this.viewRotation_,R=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,M={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},O=this.instructions!=i||this.overlaps?0:200;let U,B,V,Y;for(;h<d;){const G=i[h];switch(G[0]){case ee.BEGIN_GEOMETRY:U=G[1],Y=G[3],U.getGeometry()?a!==void 0&&!xt(a,Y.getExtent())?h=G[2]+1:++h:h=G[2],c&&(c.zIndex=G[4]);break;case ee.BEGIN_PATH:P>O&&(this.fill_(e),P=0),A>O&&(e.stroke(),A=0),!P&&!A&&(e.beginPath(),_=NaN,x=NaN),++h;break;case ee.CIRCLE:f=G[1];const k=u[f],le=u[f+1],xe=u[f+2],be=u[f+3],at=xe-k,Re=be-le,qe=Math.sqrt(at*at+Re*Re);e.moveTo(k+qe,le),e.arc(k,le,qe,0,2*Math.PI,!0),++h;break;case ee.CLOSE_PATH:e.closePath(),++h;break;case ee.CUSTOM:f=G[1],p=G[2];const Bt=G[3],mt=G[4],ft=G[5];M.geometry=Bt,M.feature=U,h in N||(N[h]=[]);const W=N[h];ft?ft(u,f,p,2,W):(W[0]=u[f],W[1]=u[f+1],W.length=2),c&&(c.zIndex=G[6]),mt(W,M),++h;break;case ee.DRAW_IMAGE:f=G[1],p=G[2],T=G[3],g=G[4],m=G[5];let lt=G[6];const vt=G[7],pe=G[8],rn=G[9],ur=G[10];let tt=G[11];const Nr=G[12];let Ke=G[13];y=G[14]||"declutter";const Je=G[15];if(!T&&G.length>=20){w=G[19],v=G[20],S=G[21],C=G[22];const dt=this.drawLabelWithPointPlacement_(w,v,S,C);T=dt.label,G[3]=T;const sn=G[23];g=(dt.anchorX-sn)*this.pixelRatio,G[4]=g;const zt=G[24];m=(dt.anchorY-zt)*this.pixelRatio,G[5]=m,lt=T.height,G[6]=lt,Ke=T.width,G[13]=Ke}let nn;G.length>25&&(nn=G[25]);let hr,Dr,vn;G.length>17?(hr=G[16],Dr=G[17],vn=G[18]):(hr=ci,Dr=null,vn=null),ur&&R?tt+=D:!ur&&!R&&(tt-=D);let Xe=0;for(;f<p;f+=2){if(nn&&nn[Xe++]<Ke/this.pixelRatio)continue;const dt=this.calculateImageOrLabelDimensions_(T.width,T.height,u[f],u[f+1],Ke,lt,g,m,pe,rn,tt,Nr,s,hr,!!Dr||!!vn,U),sn=[e,t,T,dt,vt,Dr,vn];if(l){let zt,$t,jt;if(Je){const st=p-f;if(!Je[st]){Je[st]={args:sn,declutterMode:y};continue}const Dt=Je[st];zt=Dt.args,$t=Dt.declutterMode,delete Je[st],jt=tp(zt)}let wr,on;if(zt&&($t!=="declutter"||!l.collides(jt))&&(wr=!0),(y!=="declutter"||!l.collides(dt.declutterBox))&&(on=!0),$t==="declutter"&&y==="declutter"){const st=wr&&on;wr=st,on=st}wr&&($t!=="none"&&l.insert(jt),this.replayImageOrLabel_.apply(this,zt)),on&&(y!=="none"&&l.insert(dt.declutterBox),this.replayImageOrLabel_.apply(this,sn))}else this.replayImageOrLabel_.apply(this,sn)}++h;break;case ee.DRAW_CHARS:const ze=G[1],Ge=G[2],Ce=G[3],ct=G[4];C=G[5];const ge=G[6],Ee=G[7],ut=G[8];S=G[9];const ht=G[10];w=G[11],Array.isArray(w)&&(w=w.reduce(pC,"")),v=G[12];const qt=[G[13],G[13]];y=G[14]||"declutter";const Kt=G[15],yt=this.textStates[v],_t=yt.font,ke=[yt.scale[0]*Ee,yt.scale[1]*Ee];let it;_t in this.widths_?it=this.widths_[_t]:(it={},this.widths_[_t]=it);const Nt=Ih(u,ze,Ge,2),Ve=Math.abs(ke[0])*of(_t,w,it);if(ct||Ve<=Nt){const dt=this.textStates[v].textAlign,sn=(Nt-Ve)*oc(w,dt),zt=dC(u,ze,Ge,2,w,sn,ge,Math.abs(ke[0]),of,_t,it,R?0:this.viewRotation_,Kt);e:if(zt){const $t=[];let jt,wr,on,st,Dt;if(S)for(jt=0,wr=zt.length;jt<wr;++jt){Dt=zt[jt],on=Dt[4],st=this.createLabel(on,v,"",S),g=Dt[2]+(ke[0]<0?-ht:ht),m=Ce*st.height+(.5-Ce)*2*ht*ke[1]/ke[0]-ut;const an=this.calculateImageOrLabelDimensions_(st.width,st.height,Dt[0],Dt[1],st.width,st.height,g,m,0,0,Dt[3],qt,!1,ci,!1,U);if(l&&y==="declutter"&&l.collides(an.declutterBox))break e;$t.push([e,t,st,an,1,null,null])}if(C)for(jt=0,wr=zt.length;jt<wr;++jt){Dt=zt[jt],on=Dt[4],st=this.createLabel(on,v,C,""),g=Dt[2],m=Ce*st.height-ut;const an=this.calculateImageOrLabelDimensions_(st.width,st.height,Dt[0],Dt[1],st.width,st.height,g,m,0,0,Dt[3],qt,!1,ci,!1,U);if(l&&y==="declutter"&&l.collides(an.declutterBox))break e;$t.push([e,t,st,an,1,null,null])}l&&y!=="none"&&l.load($t.map(tp));for(let an=0,x0=$t.length;an<x0;++an)this.replayImageOrLabel_.apply(this,$t[an])}}++h;break;case ee.END_GEOMETRY:if(o!==void 0){U=G[1];const dt=o(U,Y,y);if(dt)return dt}++h;break;case ee.FILL:O?P++:this.fill_(e),++h;break;case ee.MOVE_TO_LINE_TO:for(f=G[1],p=G[2],B=u[f],V=u[f+1],e.moveTo(B,V),_=B+.5|0,x=V+.5|0,f+=2;f<p;f+=2)B=u[f],V=u[f+1],E=B+.5|0,b=V+.5|0,(f==p-2||E!==_||b!==x)&&(e.lineTo(B,V),_=E,x=b);++h;break;case ee.SET_FILL_STYLE:this.alignAndScaleFill_=G[2],P&&(this.fill_(e),P=0,A&&(e.stroke(),A=0)),e.fillStyle=G[1],++h;break;case ee.SET_STROKE_STYLE:A&&(e.stroke(),A=0),this.setStrokeStyle_(e,G),++h;break;case ee.STROKE:O?A++:e.stroke(),++h;break;default:++h;break}}P&&this.fill_(e),A&&e.stroke()}execute(e,t,r,i,s,o){this.viewRotation_=i,this.execute_(e,t,r,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,r,i,s){return this.viewRotation_=r,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,i,s)}}const ai=["Polygon","Circle","LineString","Image","Text","Default"],Ua=["Image","Text"],mC=ai.filter(n=>!Ua.includes(n));let gy=!1,my=!1;function yC(){let n=0;const e=r=>{const i=Mr(1,1,null,{willReadFrequently:r});let s=0;const o=performance.now();for(;performance.now()-o<50;++s)i.fillStyle=`rgba(255,0,${s%256},1)`,i.fillRect(0,0,1,1),i.getImageData(0,0,1,1);return n=s>n?s:n,s};gy={[e(!0)]:!0,[e(!1)]:!1,[e(void 0)]:void 0}[n],my=!0}class yy{constructor(e,t,r,i,s,o,a){this.maxExtent_=e,this.overlaps_=i,this.pixelRatio_=r,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Tr(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(e,t){const r=this.getClipCoords(t);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()}createExecutors_(e,t){for(const r in e){let i=this.executorsByZIndex_[r];i===void 0&&(i={},this.executorsByZIndex_[r]=i);const s=e[r];for(const o in s){const a=s[o];i[o]=new gC(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const r=this.executorsByZIndex_[t];for(let i=0,s=e.length;i<s;++i)if(e[i]in r)return!0}return!1}forEachFeatureAtCoordinate(e,t,r,i,s,o){my===!1&&yC(),i=Math.round(i);const a=i*2+1,l=Yn(this.hitDetectionTransform_,i+.5,i+.5,1/t,-1/t,-r,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Mr(a,a,null,{willReadFrequently:gy}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let h;this.renderBuffer_!==void 0&&(h=bi(),fb(h,e),Wr(h,t*(this.renderBuffer_+i),h));const d=_C(i);let f;function p(b,T,w){const v=u.getImageData(0,0,a,a).data;for(let S=0,C=d.length;S<C;S++)if(v[d[S]]>0){if(!o||w==="none"||f!=="Image"&&f!=="Text"||o.includes(b)){const P=(d[S]-3)/4,A=i-P%a,N=i-(P/a|0),D=s(b,T,A*A+N*N);if(D)return D}u.clearRect(0,0,a,a);break}}const g=Object.keys(this.executorsByZIndex_).map(Number);g.sort(Yi);let m,y,_,x,E;for(m=g.length-1;m>=0;--m){const b=g[m].toString();for(_=this.executorsByZIndex_[b],y=ai.length-1;y>=0;--y)if(f=ai[y],x=_[f],x!==void 0&&(E=x.executeHitDetection(u,l,r,p,h),E))return E}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const r=t[0],i=t[1],s=t[2],o=t[3],a=[r,i,r,o,s,o,s,i];return Hi(a,0,8,2,e,a),a}isEmpty(){return is(this.executorsByZIndex_)}execute(e,t,r,i,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?pb:Yi),o=o||ai;const c=ai.length;for(let u=0,h=l.length;u<h;++u){const d=l[u].toString(),f=this.executorsByZIndex_[d];for(let p=0,g=o.length;p<g;++p){const m=o[p],y=f[m];if(y!==void 0){const _=a===null?void 0:y.getZIndexContext(),x=_?_.getContext():e,E=this.maxExtent_&&m!=="Image"&&m!=="Text";if(E&&(x.save(),this.clip(x,r)),!_||m==="Text"||m==="Image"?y.execute(x,t,r,i,s,a):_.pushFunction(b=>y.execute(b,t,r,i,s,a)),E&&x.restore(),_){_.offset();const b=l[u]*c+ai.indexOf(m);this.deferredZIndexContexts_[b]||(this.deferredZIndexContexts_[b]=[]),this.deferredZIndexContexts_[b].push(_)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Yi);for(let r=0,i=t.length;r<i;++r)e[t[r]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),e[t[r]].length=0}}const ac={};function _C(n){if(ac[n]!==void 0)return ac[n];const e=n*2+1,t=n*n,r=new Array(t+1);for(let s=0;s<=n;++s)for(let o=0;o<=n;++o){const a=s*s+o*o;if(a>t)break;let l=r[a];l||(l=[],r[a]=l),l.push(((n+s)*e+(n+o))*4+3),s>0&&l.push(((n-s)*e+(n+o))*4+3),o>0&&(l.push(((n+s)*e+(n-o))*4+3),s>0&&l.push(((n-s)*e+(n-o))*4+3))}const i=[];for(let s=0,o=r.length;s<o;++s)r[s]&&i.push(...r[s]);return ac[n]=i,i}class xC extends fy{constructor(e,t,r,i,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=r,this.transform_=i,this.transformRotation_=i?gb(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Tr()}drawImages_(e,t,r,i){if(!this.image_)return;const s=Hi(e,t,r,i,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,h=s.length;u<h;u+=2){const d=s[u]-this.imageAnchorX_,f=s[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,g=f+this.imageAnchorY_;Yn(a,p,g,1,1,c,-p,-g),o.save(),o.transform.apply(o,a),o.translate(p,g),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,r,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Hi(e,t,r,i,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<r;t+=i){const l=s[t]+this.textOffsetX_,c=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(e,t,r,i,s){const o=this.context_,a=Hi(e,t,r,i,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return s&&o.closePath(),r}drawRings_(e,t,r,i){for(let s=0,o=r.length;s<o;++s)t=this.moveToLineTo_(e,t,r[s],i,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!xt(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=oE(e,this.transform_,this.pixelCoordinates_),r=t[2]-t[0],i=t[3]-t[1],s=Math.sqrt(r*r+i*i),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const r=t.getGeometryFunction()(e);r&&(this.setStyle(t),this.drawGeometry(r))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let r=0,i=t.length;r<i;++r)this.drawGeometry(t[r])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),this.text_!==""&&this.drawText_(t,0,t.length,r)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),this.text_!==""&&this.drawText_(t,0,t.length,r)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!xt(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,r=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(r,0,r.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(xt(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const r=this.context_,i=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();r.beginPath();for(let l=0,c=o.length;l<c;++l)s=this.moveToLineTo_(i,s,o[l],a,!1);r.stroke()}if(this.text_!==""){const r=e.getFlatMidpoints();this.drawText_(r,0,r.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!xt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!xt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,r=e.getOrientedFlatCoordinates();let i=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const c=s[a];i=this.drawRings_(r,i,c,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,r=this.contextFillState_;r?r.fillStyle!=e.fillStyle&&(r.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=e.lineCap&&(r.lineCap=e.lineCap,t.lineCap=e.lineCap),xo(r.lineDash,e.lineDash)||t.setLineDash(r.lineDash=e.lineDash),r.lineDashOffset!=e.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),r.lineJoin!=e.lineJoin&&(r.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),r.lineWidth!=e.lineWidth&&(r.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),r.miterLimit!=e.miterLimit&&(r.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),r.strokeStyle!=e.strokeStyle&&(r.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,r=this.contextTextState_,i=e.textAlign?e.textAlign:Qs;r?(r.font!=e.font&&(r.font=e.font,t.font=e.font),r.textAlign!=i&&(r.textAlign=i,t.textAlign=i),r.textBaseline!=e.textBaseline&&(r.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=i,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:i,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const r=e.getColor();this.fillState_={fillStyle:Dn(r||br)}}if(!t)this.strokeState_=null;else{const r=t.getColor(),i=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),c=t.getMiterLimit(),u=s||mn;this.strokeState_={lineCap:i!==void 0?i:Ea,lineDash:this.pixelRatio_===1?u:u.map(h=>h*this.pixelRatio_),lineDashOffset:(o||yn)*this.pixelRatio_,lineJoin:a!==void 0?a:Ta,lineWidth:(l!==void 0?l:wa)*this.pixelRatio_,miterLimit:c!==void 0?c:Sa,strokeStyle:Dn(r||ba)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const r=e.getPixelRatio(this.pixelRatio_),i=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*r,this.imageAnchorY_=i[1]*r,this.imageHeight_=t[1]*r,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/r,o[1]*this.pixelRatio_/r],this.imageWidth_=t[0]*r}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:Dn(f||br)}}const r=e.getStroke();if(!r)this.textStrokeState_=null;else{const f=r.getColor(),p=r.getLineCap(),g=r.getLineDash(),m=r.getLineDashOffset(),y=r.getLineJoin(),_=r.getWidth(),x=r.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Ea,lineDash:g||mn,lineDashOffset:m||yn,lineJoin:y!==void 0?y:Ta,lineWidth:_!==void 0?_:wa,miterLimit:x!==void 0?x:Sa,strokeStyle:Dn(f||ba)}}const i=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),c=e.getScaleArray(),u=e.getText(),h=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:i!==void 0?i:Jg,textAlign:h!==void 0?h:Qs,textBaseline:d!==void 0?d:va},this.text_=u!==void 0?Array.isArray(u)?u.reduce((f,p,g)=>f+=g%2?" ":p,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const tr=.5;function _y(n,e,t,r,i,s,o,a,l){const c=l?th(i):i,u=n[0]*tr,h=n[1]*tr,d=Mr(u,h);d.imageSmoothingEnabled=!1;const f=d.canvas,p=new xC(d,tr,i,null,o,a,l?Qg(aE(),l):null),g=t.length,m=Math.floor((256*256*256-1)/g),y={};for(let x=1;x<=g;++x){const E=t[x-1],b=E.getStyleFunction()||r;if(!b)continue;let T=b(E,s);if(!T)continue;Array.isArray(T)||(T=[T]);const v=(x*m).toString(16).padStart(7,"#00000");for(let S=0,C=T.length;S<C;++S){const P=T[S],A=P.getGeometryFunction()(E);if(!A||!xt(c,A.getExtent()))continue;const N=P.clone(),D=N.getFill();D&&D.setColor(v);const R=N.getStroke();R&&(R.setColor(v),R.setLineDash(null)),N.setText(void 0);const M=P.getImage();if(M){const V=M.getImageSize();if(!V)continue;const Y=Mr(V[0],V[1],void 0,{alpha:!1}),G=Y.canvas;Y.fillStyle=v,Y.fillRect(0,0,G.width,G.height),N.setImage(new Zc({img:G,anchor:M.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:M.getOrigin(),opacity:1,size:M.getSize(),scale:M.getScale(),rotation:M.getRotation(),rotateWithView:M.getRotateWithView()}))}const O=N.getZIndex()||0;let U=y[O];U||(U={},y[O]=U,U.Polygon=[],U.Circle=[],U.LineString=[],U.Point=[]);const B=A.getType();if(B==="GeometryCollection"){const V=A.getGeometriesArrayRecursive();for(let Y=0,G=V.length;Y<G;++Y){const K=V[Y];U[K.getType().replace("Multi","")].push(K,N)}}else U[B.replace("Multi","")].push(A,N)}}const _=Object.keys(y).map(Number).sort(Yi);for(let x=0,E=_.length;x<E;++x){const b=y[_[x]];for(const T in b){const w=b[T];for(let v=0,S=w.length;v<S;v+=2){p.setStyle(w[v+1]);for(let C=0,P=e.length;C<P;++C)p.setTransform(e[C]),p.drawGeometry(w[v])}}}return d.getImageData(0,0,f.width,f.height)}function xy(n,e,t){const r=[];if(t){const i=Math.floor(Math.round(n[0])*tr),s=Math.floor(Math.round(n[1])*tr),o=(jc(i,0,t.width-1)+jc(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],u=t.data[o+2]+256*(l+256*a),h=Math.floor((256*256*256-1)/e.length);u&&u%h===0&&r.push(e[u/h-1])}return r}const bC=.5,by={Point:PC,LineString:vC,Polygon:AC,MultiPoint:IC,MultiLineString:RC,MultiPolygon:CC,GeometryCollection:SC,Circle:TC};function EC(n,e){return parseInt(ve(n),10)-parseInt(ve(e),10)}function uu(n,e){const t=Ey(n,e);return t*t}function Ey(n,e){return bC*n/e}function TC(n,e,t,r,i){const s=t.getFill(),o=t.getStroke();if(s||o){const l=n.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(e,r,i)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,r)}}function Ba(n,e,t,r,i,s,o,a){const l=[],c=t.getImage();if(c){let d=!0;const f=c.getImageState();f==We.LOADED||f==We.ERROR?d=!1:f==We.IDLE&&c.load(),d&&l.push(c.ready())}const u=t.getFill();u&&u.loading()&&l.push(u.ready());const h=l.length>0;return h&&Promise.all(l).then(()=>i(null)),wC(n,e,t,r,s,o,a),h}function wC(n,e,t,r,i,s,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(r,i);if(t.getRenderer())Ty(n,l,t,e,o);else{const u=by[l.getType()];u(n,l,t,e,o,s)}}function Ty(n,e,t,r,i){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)Ty(n,o[a],t,r,i);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,r,t.getRenderer(),t.getHitDetectionRenderer(),i)}function SC(n,e,t,r,i,s){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const c=by[o[a].getType()];c(n,o[a],t,r,i,s)}}function vC(n,e,t,r,i){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,r,i)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,r,i)}}function RC(n,e,t,r,i){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,r,i)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,r,i)}}function CC(n,e,t,r,i){const s=t.getFill(),o=t.getStroke();if(o||s){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,r,i)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,r,i)}}function PC(n,e,t,r,i,s){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),c=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=We.LOADED)return;const u=n.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,c),u.drawPoint(e,r,i)}if(l){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(e,r,i)}}function IC(n,e,t,r,i,s){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),c=l&&l.getText(),u=s&&a&&c?{}:void 0;if(a){if(o.getImageState()!=We.LOADED)return;const h=n.getBuilder(t.getZIndex(),"Image");h.setImageStyle(o,u),h.drawMultiPoint(e,r,i)}if(c){const h=n.getBuilder(t.getZIndex(),"Text");h.setTextStyle(l,u),h.drawText(e,r,i)}}function AC(n,e,t,r,i){const s=t.getFill(),o=t.getStroke();if(s||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,r,i)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,r,i)}}class LC extends Nh{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.extendX_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=bi(),this.wrappedRenderedExtent_=bi(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,s=t.viewState,o=s.center,a=s.resolution,l=s.projection,c=s.rotation,u=l.getExtent(),h=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,p=t.viewHints,g=!(p[xr.ANIMATING]||p[xr.INTERACTING]),m=this.context,y=Math.round(er(i)/a*f),_=Math.round(Fr(i)/a*f),x=h.getWrapX()&&l.canWrapX(),E=x?er(u):null,b=x?Math.ceil((i[2]-u[2])/E)+(this.extendX_?2:1):1;let T=x?Math.floor((i[0]-u[0])/E)-(this.extendX_?1:0):0;do{let w=this.getRenderTransform(o,a,0,f,y,_,T*E);t.declutter&&(w=w.slice(0)),e.execute(m,[m.canvas.width,m.canvas.height],w,c,g,r===void 0?ai:r?Ua:mC,r?d&&t.declutter[d]:void 0)}while(++T<b)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Mr(this.context.canvas.width,this.context.canvas.height,Kf))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,em(this.context),Kf.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;const i=e.viewState;this.prepareContainer(e,t);const s=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Xi.PRERENDER)||this.getLayer().hasListener(Xi.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(s,e),i.projection,this.clipped_=!1,a&&r.extent&&this.clipping){const l=ss(r.extent);a=xt(l,e.extent),this.clipped_=a&&!Vr(l,e.extent),this.clipped_&&this.clipUnrotated(s,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&s.restore(),this.postRender(s,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const r=this.frameState.size.slice(),i=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],h=r[0]*tr,d=r[1]*tr;u.push(this.getRenderTransform(i,s,o,tr,h,d,0).slice());const f=c.getSource(),p=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!Vr(p,l)){let g=l[0];const m=er(p);let y=0,_;for(;g<p[0];)--y,_=m*y,u.push(this.getRenderTransform(i,s,o,tr,h,d,_).slice()),g+=m;for(y=0,g=l[2];g>p[2];)++y,_=m*y,u.push(this.getRenderTransform(i,s,o,tr,h,d,_).slice()),g-=m}this.hitDetectionImageData_=_y(r,u,this.renderedFeatures_,c.getStyleFunction(),l,s,o,uu(s,this.renderedPixelRatio_),null)}t(xy(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,r,i,s){var d,f;if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),c={},u=function(p,g,m){const y=ve(p),_=c[y];if(_){if(_!==!0&&m<_.distanceSq){if(m===0)return c[y]=!0,s.splice(s.lastIndexOf(_),1),i(p,l,g);_.geometry=g,_.distanceSq=m}}else{if(m===0)return c[y]=!0,i(p,l,g);s.push(c[y]={feature:p,layer:l,geometry:g,distanceSq:m,callback:i})}},h=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,r,u,h?(f=(d=t.declutter)==null?void 0:d[h])==null?void 0:f.all().map(p=>p.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const i=e.viewHints[xr.ANIMATING],s=e.viewHints[xr.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,c=e.viewState,u=c.projection,h=c.resolution,d=e.pixelRatio,f=t.getRevision(),p=t.getRenderBuffer();let g=t.getRenderOrder();g===void 0&&(g=EC);const m=c.center.slice(),y=Wr(l,p*h),_=y.slice(),x=[y.slice()],E=u.getExtent(),b=r.getWrapX()&&u.canWrapX();if(this.extendX_=!1,b){const R=r.getExtent();R&&!ul(R)&&(this.extendX_=R[0]<E[0]||R[2]>E[2])}if(b&&(!Vr(E,e.extent)||this.extendX_)){const R=er(E),M=Math.max(er(y)/2,R);let O=E[0],U=E[2];this.extendX_&&(O-=R,U+=R),y[0]=O-M,y[2]=U+M,tm(m,u);const B=mb(x[0],u);B[0]<E[0]&&B[2]<E[2]?x.push([B[0]+R,B[1],B[2]+R,B[3]]):B[0]>E[0]&&B[2]>E[2]&&x.push([B[0]-R,B[1],B[2]-R,B[3]])}if(this.ready&&this.renderedResolution_==h&&this.renderedPixelRatio_===d&&this.renderedRevision_==f&&this.renderedRenderOrder_==g&&this.renderedFrameDeclutter_===!!e.declutter&&Vr(this.wrappedRenderedExtent_,y))return xo(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new py(Ey(h,d),y,h,d);let w;for(let R=0,M=x.length;R<M;++R)r.loadFeatures(x[R],h,u);const v=uu(h,d);let S=!0;const C=(R,M)=>{let O;const U=R.getStyleFunction()||t.getStyleFunction();if(U&&(O=U(R,h)),O){const B=this.renderFeature(R,v,O,T,w,this.getLayer().getDeclutter(),M);S=S&&!B}},P=th(y),A=r.getFeaturesInExtent(P);g&&A.sort(g);for(let R=0,M=A.length;R<M;++R)C(A[R],R);this.renderedFeatures_=A,this.ready=S;const N=T.finish(),D=new yy(y,h,d,r.getOverlaps(),N,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=h,this.renderedRevision_=f,this.renderedRenderOrder_=g,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=_,this.wrappedRenderedExtent_=y,this.renderedCenter_=m,this.renderedProjection_=u,this.renderedPixelRatio_=d,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,s,o,a){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let c=0,u=r.length;c<u;++c)l=Ba(i,e,r[c],t,this.boundHandleStyleImageChange_,s,o,a)||l;else l=Ba(i,e,r,t,this.boundHandleStyleImageChange_,s,o,a);return l}}class wl extends rm{constructor(e){super(e)}createRenderer(){return new LC(this)}}const FC={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},np={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class MC extends dy{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Tr(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,r,i,s,o,a,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,s,o,a,l)}getTile(e,t,r,i){const s=this.getOrCreateTile(e,t,r,i);if(!s)return null;const o=i.viewState,a=o.resolution,l=i.viewHints,c=this.getLayer().getSource(),u=c.getTileGridForProjection(o.projection),h=!(l[xr.ANIMATING]||l[xr.INTERACTING]),d=u.getZForResolution(a,c.zDirection)===e;return h&&d?s.wantedResolution=a:s.wantedResolution||(s.wantedResolution=u.getResolution(e)),s}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const i=this.getLayer(),s=i.getRevision(),o=i.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedPixelRatio===t&&l.renderedRenderOrder==o)return;const c=i.getSource(),u=!!i.getDeclutter(),h=c.getTileGrid(),f=c.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),p=c.getSourceTiles(t,r,e),g=ve(i);delete e.hitDetectionImageData[g],e.executorGroups[g]=[],l.dirty=!1;for(let m=0,y=p.length;m<y;++m){const _=p[m];if(_.getState()!=de.LOADED)continue;const x=c.getProjection(),E=_.tileCoord;let b=h.getTileCoordExtent(E);r&&x&&!Mt(r,x)&&(b=di(b,x,r,32));const T=Zn(f,b),w=Wr(T,i.getRenderBuffer()*a,this.tempExtent),v=Ei(b,T)?null:w,S=new py(0,T,a,t),C=uu(a,t),P=function(M,O){let U;const B=M.getStyleFunction()||i.getStyleFunction();if(B&&(U=B(M,a)),U){const V=this.renderFeature(M,C,U,S,u,O);l.dirty=l.dirty||V}},A=_.getFeatures();o&&o!==l.renderedRenderOrder&&A.sort(o);for(let M=0,O=A.length;M<O;++M){let U=A[M];r&&_.projection&&!Mt(r,_.projection)&&(U=U.clone(),U.getGeometry().applyTransform(Hg(_.projection,r))),(!v||xt(v,U.getGeometry().getExtent()))&&P.call(this,U,M)}const N=S.finish(),D=i.getRenderMode()!=="vector"&&u&&p.length===1?null:T,R=new yy(D,a,t,c.getOverlaps(),N,i.getRenderBuffer(),!0);e.executorGroups[g].push(R)}l.renderedRevision=s,l.renderedPixelRatio=t,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,r,i,s){var x,E;const o=t.viewState.resolution,a=t.viewState.rotation;r=r??0;const l=this.getLayer(),u=l.getSource().getTileGridForProjection(t.viewState.projection),h=Ju([e]);Wr(h,o*r,h);const d={},f=function(b,T,w){let v=b.getId();v===void 0&&(v=ve(b));const S=d[v];if(S){if(S!==!0&&w<S.distanceSq){if(w===0)return d[v]=!0,s.splice(s.lastIndexOf(S),1),i(b,l,T);S.geometry=T,S.distanceSq=w}}else{if(w===0)return d[v]=!0,i(b,l,T);s.push(d[v]={feature:b,layer:l,geometry:T,distanceSq:w,callback:i})}},p=this.renderedTiles,g=ve(l),m=l.getDeclutter(),y=m?(E=(x=t.declutter)==null?void 0:x[m])==null?void 0:E.all().map(b=>b.value):null;let _;e:for(let b=0,T=p.length;b<T;++b){const w=p[b],v=u.getTileCoordExtent(w.wrappedTileCoord);if(!xt(v,h))continue;const S=w.executorGroups[g];for(let C=0,P=S.length;C<P;++C)if(_=S[C].forEachFeatureAtCoordinate(e,o,a,r,f,y),_)break e}return _}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,r)=>{const i=this.getLayer(),s=i.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,c=s.getTileGridForProjection(o),u=Tt(this.renderedPixelToCoordinateTransform_,e.slice()),h=c.getTileCoordForCoordAndResolution(u,l).toString(),d=this.renderedTiles.find(x=>x.tileCoord.toString()===h&&x.getState()===de.LOADED);if(!d||d.loadingSourceTiles>0){t([]);return}s.getWrapX()&&o.canWrapX()&&!Vr(a,c.getTileCoordExtent(d.tileCoord))&&tm(u,o);const f=ve(i),p=c.getTileCoordExtent(d.wrappedTileCoord),g=cl(p),m=[(u[0]-g[0])/l,(g[1]-u[1])/l],y=d.getSourceTiles().reduce((x,E)=>x.concat(E.getFeatures()),[]);let _=d.hitDetectionImageData[f];if(!_){const x=eh(c.getTileSize(c.getZForResolution(l,s.zDirection))),E=this.renderedRotation_,b=[this.getRenderTransform(c.getTileCoordCenter(d.wrappedTileCoord),l,0,tr,x[0]*tr,x[1]*tr,0)];_=_y(x,b,y,i.getStyleFunction(),c.getTileCoordExtent(d.wrappedTileCoord),d.getReplayState(i).renderedResolution,E),d.hitDetectionImageData[f]=_}t(xy(m,y,_))})}getFeaturesInExtent(e){const t=[],r=this.getTileCache();if(r.getCount()===0)return t;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=s.getZForResolution(this.renderedResolution),a={};return r.forEach(l=>{if(l.tileCoord[0]!==o||l.getState()!==de.LOADED)return;const c=l.getSourceTiles();for(let u=0,h=c.length;u<h;++u){const d=c[u],f=d.getKey();if(f in a)continue;a[f]=!0;const p=d.tileCoord;if(xt(e,s.getTileCoordExtent(p))){const g=d.getFeatures();if(g)for(let m=0,y=g.length;m<y;++m){const _=g[m],x=_.getGeometry();xt(e,x.getExtent())&&t.push(_)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){var d;const r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[xr.ANIMATING]||s[xr.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?(d=e.declutter)==null?void 0:d[l]:void 0,u=ve(this.getLayer()),h=this.renderedTiles;for(let f=0,p=h.length;f<p;++f){const g=h[f],m=g.executorGroups[u];if(m)for(let y=m.length-1;y>=0;--y)m[y].execute(this.context,a,this.getTileRenderTransform(g,e),e.viewState.rotation,o,Ua,c)}r.globalAlpha=i}renderDeferredInternal(e){const t=this.renderedTiles,r=ve(this.getLayer()),i=t.reduce((l,c,u)=>(c.executorGroups[r].forEach(h=>l.push({executorGroup:h,index:u})),l),[]),s=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),o={};for(let l=0,c=i.length;l<c;++l){const u=i[l].executorGroup.getDeferredZIndexContexts();for(const h in u)o[h]=!0}Object.keys(o).map(Number).sort(Yi).forEach(l=>{s.forEach((c,u)=>{c[l]&&(c[l].forEach(h=>{const{executorGroup:d,index:f}=i[u],p=d.getRenderedContext(),g=p.globalAlpha;p.globalAlpha=this.renderedOpacity_;const m=this.tileClipContexts_[f];m&&m.draw(p),h.draw(p),m&&p.restore(),p.globalAlpha=g,h.clear()}),c[l].length=0)})})}getTileRenderTransform(e,t){const r=t.pixelRatio,i=t.viewState,s=i.center,o=i.resolution,a=i.rotation,l=t.size,c=Math.round(l[0]*r),u=Math.round(l[1]*r),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,p=d.getTileCoordExtent(e.wrappedTileCoord),g=d.getTileCoordExtent(f,this.tempExtent)[0]-p[0];return Yc(Jl(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(s,o,a,r,c,u,g))}postRender(e,t){var b;const r=t.viewHints,i=!(r[xr.ANIMATING]||r[xr.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),c=l?np[o].filter(T=>!Ua.includes(T)):np[o],u=t.viewState,h=u.rotation,d=s.getSource(),p=d.getTileGridForProjection(u.projection).getZForResolution(u.resolution,d.zDirection),g=this.renderedTiles,m=[],y=[],_=[],x=ve(s);let E=!0;for(let T=g.length-1;T>=0;--T){const w=g[T];E=E&&!w.getReplayState(s).dirty;const v=w.executorGroups[x].filter(R=>R.hasExecutors(c));if(v.length===0)continue;const S=this.getTileRenderTransform(w,t),C=w.tileCoord[0];let P=!1;const A=v[0].getClipCoords(S);let N=e,D;if(A){D=new Oh,N=D.getContext();for(let R=0,M=m.length;R<M;++R)if(p!==C&&C<y[R]){const O=m[R];xt([A[0],A[3],A[4],A[7]],[O[0],O[3],O[4],O[7]])&&(P||(N.save(),P=!0),N.beginPath(),N.moveTo(A[0],A[1]),N.lineTo(A[2],A[3]),N.lineTo(A[4],A[5]),N.lineTo(A[6],A[7]),N.moveTo(O[6],O[7]),N.lineTo(O[4],O[5]),N.lineTo(O[2],O[3]),N.lineTo(O[0],O[1]),N.clip())}m.push(A),y.push(C)}for(let R=0,M=v.length;R<M;++R)v[R].execute(e,[e.canvas.width,e.canvas.height],S,h,i,c,(b=t.declutter)==null?void 0:b[l]);P&&(N===e?N.restore():_[T]=D)}e.globalAlpha=a,this.ready=E,this.tileClipContexts_=_,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,s,o){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,c=r.length;l<c;++l)a=Ba(i,e,r[l],t,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=Ba(i,e,r,t,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const r=e.getReplayState(t),i=t.getRevision(),s=e.wantedResolution;return r.renderedTileResolution!==s||r.renderedTileRevision!==i}renderTileImage_(e,t){const r=this.getLayer(),i=e.getReplayState(r),s=r.getRevision(),o=e.executorGroups[ve(r)];i.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],c=r.getSource();let u=t.pixelRatio;const d=t.viewState.projection,f=c.getTileGridForProjection(d),p=f.getResolution(e.tileCoord[0]),g=t.pixelRatio/e.wantedResolution*p,m=f.getResolution(l),y=e.getContext();u=Math.round(Math.max(u,g/u));const _=c.getTilePixelSize(l,u,d);y.canvas.width=_[0],y.canvas.height=_[1];const x=u/g;if(x!==1){const w=af(this.tmpTransform_);Jl(w,x,x),y.setTransform.apply(y,w)}const E=f.getTileCoordExtent(a,this.tempExtent),b=g/m,T=af(this.tmpTransform_);Jl(T,b,-b),lE(T,-E[0],-E[3]);for(let w=0,v=o.length;w<v;++w)o[w].execute(y,[y.canvas.width*x,y.canvas.height*x],T,0,!0,FC[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}}class Ki extends rm{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const r=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;const i=e.renderMode||"hybrid";Ds(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new MC(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Uo.PRELOAD)}getUseInterimTilesOnError(){return this.get(Uo.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(Uo.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(Uo.USE_INTERIM_TILES_ON_ERROR,e)}}function hu(n){return Array.isArray(n)?Math.min(...n):n}class OC extends fl{constructor(e,t,r,i,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let c=t.getExtent();c&&t.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);const u=c?Zn(r,c):r,h=qn(u),d=nm(e,t,h,i),f=hE,p=new cE(e,t,u,l,d*f,i),g=p.calculateSourceExtent(),m=ul(g)?null:o(g,d,s),y=m?We.IDLE:We.EMPTY,_=m?m.getPixelRatio():1;super(r,i,_,y),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=p,this.targetResolution_=i,this.targetExtent_=r,this.sourceImage_=m,this.sourcePixelRatio_=_,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==We.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==We.LOADED){const t=er(this.targetExtent_)/this.targetResolution_,r=Fr(this.targetExtent_)/this.targetResolution_;this.canvas_=uE(t,r,this.sourcePixelRatio_,hu(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==We.IDLE){this.state=We.LOADING,this.changed();const e=this.sourceImage_.getState();e==We.LOADED||e==We.ERROR?this.reproject_():(this.sourceListenerKey_=Ks(this.sourceImage_,Qr.CHANGE,t=>{const r=this.sourceImage_.getState();(r==We.LOADED||r==We.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){qs(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Wi=4,lc={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class NC extends hl{constructor(e,t){super(e),this.image=t}}class Gh extends Eo{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const r=yb(t,e,0);e=t[r]}return e}getImage(e,t,r,i){const s=this.getProjection();if(!s||!i||Mt(s,i))return s&&(i=s),this.getImageInternal(e,t,r,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Mt(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==t&&Ei(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new OC(s,i,e,t,r,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,r,i){if(this.loader){const s=GC(e,t,r,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&Vr(this.wantedExtent_,s)||Vr(this.image.getExtent(),s))&&(this.wantedResolution_&&hu(this.wantedResolution_)===o||hu(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new fl(s,o,r,this.loader),this.image.addEventListener(Qr.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let r;switch(t.getState()){case We.LOADING:this.loading=!0,r=lc.IMAGELOADSTART;break;case We.LOADED:this.loading=!1,r=lc.IMAGELOADEND;break;case We.ERROR:this.loading=!1,r=lc.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new NC(r,t))}}function DC(n,e){n.getImage().src=e}function GC(n,e,t,r){const i=e/t,s=qn(n),o=ko(er(n)/i,Wi),a=ko(Fr(n)/i,Wi),l=ko((r-1)*o/2,Wi),c=o+2*l,u=ko((r-1)*a/2,Wi),h=a+2*u;return _b(s,i,0,[c,h])}function kC(n){const e=n.load||im,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=er(t)/s.width,a=Fr(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}let UC=class extends Gh{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:DC;super({attributions:e.attributions,interpolate:e.interpolate,projection:$e(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new fl(this.imageExtent_,void 0,1,kC({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),im(i))})),this.image.addEventListener(Qr.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return xt(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}},kh=class extends rh{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:$e("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)DE(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=$e("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const c=Qg(t,r);i=Bg(e.bounds,c)}const s=pl(r),o=e.minzoom||0,a=e.maxzoom||22,l=To({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=dE(e.tiles,l),e.attribution&&!this.getAttributions()){const c=i!==void 0?i:s;this.setAttributions(function(u){return xt(c,u.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}};const du="1.3.0";function BC(n,e,t,r,i){i.WIDTH=t[0],i.HEIGHT=t[1];const s=r.getAxisOrientation(),o=hm(i.VERSION,"1.3")>=0;i[o?"CRS":"SRS"]=r.getCode();const a=o&&s.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return i.BBOX=a.join(","),Ra(n,i)}function zC(n,e,t,r,i,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=e/t,l=[Kd(er(n)/a,Wi),Kd(Fr(n)/a,Wi)];if(t!=1)switch(o){case"geoserver":const u=90*t+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+u:s.FORMAT_OPTIONS="dpi:"+u;break;case"mapserver":s.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":s.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return BC(i,n,l,r,s)}function ip(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:du,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}class $C extends rh{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=bi(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,r,i){const s=$e(r),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=fE(e,s,o),c=nm(o,s,e,t),u=a.getZForResolution(c,this.zDirection),h=a.getResolution(u),d=a.getTileCoordForCoordAndZ(l,u);if(a.getResolutions().length<=d[0])return;let f=a.getTileCoordExtent(d,this.tmpExtent_);const p=this.gutter_;p!==0&&(f=Wr(f,h*p,f));const g={QUERY_LAYERS:this.params_.LAYERS};Object.assign(g,ip(this.params_,"GetFeatureInfo"),i);const m=Math.floor((l[0]-f[0])/h),y=Math.floor((f[3]-l[1])/h);return g[this.v13_?"I":"X"]=m,g[this.v13_?"J":"Y"]=y,this.getRequestUrl_(d,f,1,o||s,g)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const r={SERVICE:"WMS",VERSION:du,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;r.LAYER=i}if(e!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;r.SCALE=e*i/s}return Object.assign(r,t),Ra(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=xb(pE(e),o.length);a=o[l]}return zC(t,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(e[0]),r,i,a,s,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||du;this.v13_=hm(e,"1.3")>=0}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const s=i.getResolution(e[0]);let o=i.getTileCoordExtent(e,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Wr(o,s*a,o));const l=Object.assign({},ip(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,r,l)}}let jC=!1;function wy(n,e,t,r,i,s,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,r,i):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=jC,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();try{let u;c=="text"||c=="json"?u=a.responseText:c=="xml"?u=a.responseXML||a.responseText:c=="arraybuffer"&&(u=a.response),u?s(e.readFeatures(u,{extent:t,featureProjection:i}),e.readProjection(u)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function sp(n,e){return function(t,r,i,s,o){wy(n,e,t,r,i,(a,l)=>{this.addFeatures(a),s!==void 0&&s(a)},()=>{this.changed(),o!==void 0&&o()})}}function XC(n,e){return[[-1/0,-1/0,1/0,1/0]]}function VC(n,e){return[n]}class op{constructor(e){this.rbush_=new kg(e),this.items_={}}insert(e,t){const r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(r),this.items_[ve(t)]=r}load(e,t){const r=new Array(t.length);for(let i=0,s=t.length;i<s;i++){const o=e[i],a=t[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};r[i]=l,this.items_[ve(a)]=l}this.rbush_.load(r)}remove(e){const t=ve(e),r=this.items_[t];return delete this.items_[t],this.rbush_.remove(r)!==null}update(e,t){const r=this.items_[ve(t)],i=[r.minX,r.minY,r.maxX,r.maxY];Ei(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let r;for(let i=0,s=e.length;i<s;i++)if(r=t(e[i]),r)return r;return r}isEmpty(){return is(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return $c(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const pr={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Pn extends hl{constructor(e,t,r){super(e),this.feature=t,this.features=r}}class ks extends Eo{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=bb,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Ds(this.format_,"`format` must be set when `url` is set"),this.loader_=sp(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:XC;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new op:null,this.loadedExtentsRtree_=new op,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,i;Array.isArray(e.features)?i=e.features:e.features&&(r=e.features,i=r.getArray()),!t&&r===void 0&&(r=new Eb(i)),i!==void 0&&this.addFeaturesInternal(i),r!==void 0&&this.bindFeaturesCollection_(r)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=ve(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const r=e.getGeometry();if(r){const i=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Pn(pr.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Ot||(this.featureChangeKeys_[e]=[Ks(t,Qr.CHANGE,this.handleFeatureChange_,this),Ks(t,Tb.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let r=!0;if(t.getId()!==void 0){const i=String(t.getId());if(!(i in this.idIndex_))this.idIndex_[i]=t;else if(t instanceof Ot){const s=this.idIndex_[i];s instanceof Ot?Array.isArray(s)?s.push(t):this.idIndex_[i]=[s,t]:r=!1}else r=!1}return r&&(Ds(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),r}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],r=[],i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s],l=ve(a);this.addToIndex_(l,a)&&r.push(a)}for(let s=0,o=r.length;s<o;s++){const a=r[s],l=ve(a);this.setupChangeEvents_(l,a);const c=a.getGeometry();if(c){const u=c.getExtent();t.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(pr.ADDFEATURE))for(let s=0,o=r.length;s<o;s++)this.dispatchEvent(new Pn(pr.ADDFEATURE,r[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(pr.ADDFEATURE,function(r){t||(t=!0,e.push(r.feature),t=!1)}),this.addEventListener(pr.REMOVEFEATURE,function(r){t||(t=!0,e.remove(r.feature),t=!1)}),e.addEventListener(Jd.ADD,r=>{t||(t=!0,this.addFeature(r.element),t=!1)}),e.addEventListener(Jd.REMOVE,r=>{t||(t=!0,this.removeFeature(r.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const r in this.featureChangeKeys_)this.featureChangeKeys_[r].forEach(qs);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(r=>{this.removeFeatureInternal(r)});for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Pn(pr.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(i){const s=i.getGeometry();if(s instanceof Ot||s.intersectsCoordinate(e))return t(i)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(r){const i=r.getGeometry();if(i instanceof Ot||i.intersectsExtent(e)){const s=t(r);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),is(this.nullGeometryFeatures_)||gn(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(r){t.push(r)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=wb(e,t);return[].concat(...i.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const r=e[0],i=e[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Sb,this.featuresRtree_.forEachInExtent(l,function(c){if(t(c)){const u=c.getGeometry(),h=a;if(a=u instanceof Ot?0:u.closestPointXY(r,i,o,a),a<h){s=c;const d=Math.sqrt(a);l[0]=r-d,l[1]=i-d,l[2]=r+d,l[3]=i+d}}}),s}getExtent(e){var t;return((t=this.featuresRtree_)==null?void 0:t.getExtent(e))??null}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,r=ve(t),i=t.getGeometry();if(!i)r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);else{const o=i.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const s=t.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new Pn(pr.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:ve(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&is(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,r){const i=this.loadedExtentsRtree_,s=this.strategy_(e,t,r);for(let o=0,a=s.length;o<a;++o){const l=s[o];i.forEachInExtent(l,function(u){return Vr(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Pn(pr.FEATURESLOADSTART)),this.loader_.call(this,l,t,r,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pn(pr.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pn(pr.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,r=t.forEachInExtent(e,function(i){if(Ei(i.extent,e))return i});r&&t.remove(r)}removeFeatures(e){let t=!1;for(let r=0,i=e.length;r<i;++r)t=this.removeFeatureInternal(e[r])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=ve(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const r=this.featureChangeKeys_[t];r==null||r.forEach(qs),delete this.featureChangeKeys_[t];const i=e.getId();if(i!==void 0){const s=i.toString(),o=this.idIndex_[s];o===e?delete this.idIndex_[s]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[s]=o[0]))}return delete this.uidIndex_[t],this.hasListener(pr.REMOVEFEATURE)&&this.dispatchEvent(new Pn(pr.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){Ds(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(sp(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}const ap=[];class WC extends sm{constructor(e,t,r,i,s){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=s,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=Mr(1,1,ap)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const t=ve(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedPixelRatio:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(em(this.context_),ap.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let Sy=class extends sm{constructor(e,t,r,i,s,o){super(e,t,o),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==de.IDLE&&(this.setState(de.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(de.ERROR)}setFeatures(e){this.features_=e,this.setState(de.LOADED)}setLoader(e){this.loader_=e}};class Ao extends gE{constructor(e){const t=e.projection||"EPSG:3857",r=e.extent||pl(t),i=e.tileGrid||To({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:i,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:vy,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Sy,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,r){if(r.getState()===de.IDLE){r.setState(de.LOADING);const i=r.wrappedTileCoord,s=this.getTileGridForProjection(t);let o=s.getTileCoordExtent(i);const a=i[0],l=s.getResolution(a);Wr(o,-l,o);const c=this.projection;t&&this.projection&&!Mt(t,c)&&(o=di(o,t,c));const u=this.tileGrid,h=u.getExtent();h&&Zn(o,h,o);let d=l;t&&c&&!Mt(t,c)&&(d=l/c.getMetersPerUnit()/t.getMetersPerUnit());const f=u.getZForResolution(d,this.zDirection);u.forEachTileCoord(o,f,p=>{const g=this.tileUrlFunction(p,e,t);this.sourceTiles_[g]||(this.sourceTiles_[g]=new this.tileClass(p,g?de.IDLE:de.EMPTY,g,this.format_,this.tileLoadFunction));const m=this.sourceTiles_[g];r.sourceTiles.push(m),this.tileKeysBySourceTileUrl_[g]||(this.tileKeysBySourceTileUrl_[g]=[]),this.tileKeysBySourceTileUrl_[g].push(r.getKey());const y=m.getState();if(y<de.LOADED){const _=x=>{this.handleTileChange(x);const E=m.getState();if(E===de.LOADED||E===de.ERROR){const b=m.getKey();b in r.errorTileKeys?m.getState()===de.LOADED&&delete r.errorTileKeys[b]:r.loadingSourceTiles--,E===de.ERROR?r.errorTileKeys[b]=!0:m.removeEventListener(Qr.CHANGE,_),r.loadingSourceTiles===0&&r.setState(is(r.errorTileKeys)?de.LOADED:de.ERROR)}};m.addEventListener(Qr.CHANGE,_),r.loadingSourceTiles++}y===de.IDLE&&(m.extent=u.getTileCoordExtent(p),m.projection=this.projection,m.resolution=u.getResolution(p[0]),m.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(p=>p.getState()===de.ERROR)?de.ERROR:de.LOADED)}return r.sourceTiles}removeSourceTiles(e){const t=e.getKey(),r=e.sourceTiles;for(let i=0,s=r.length;i<s;++i){const o=r[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[o])return;const a=this.tileKeysBySourceTileUrl_[o].indexOf(t);a!==-1&&(this.tileKeysBySourceTileUrl_[o].splice(a,1),this.tileKeysBySourceTileUrl_[o].length===0&&(delete this.tileKeysBySourceTileUrl_[o],delete this.sourceTiles_[o]))}}getTile(e,t,r,i,s){const o=[e,t,r];let a=this.getTileCoordForTileUrlFunction(o,s);const l=this.getTileGrid().getExtent(),c=this.projection,u=this.getTileGridForProjection(s);if(a&&l){const f=u.getTileCoordExtent(a);Wr(f,-u.getResolution(e),f),xt(l,!s||!c||Mt(s,c)?f:di(f,s,c))||(a=null)}let h=!0;if(a!==null){const f=this.tileGrid,p=u.getResolution(e);let g=p;s&&c&&!Mt(s,c)&&(g=p/c.getMetersPerUnit()/s.getMetersPerUnit());const m=f.getZForResolution(g,1),y=u.getTileCoordExtent(a);Wr(y,-p,y),f.forEachTileCoord(!s||!c||Mt(s,c)?y:di(y,s,c),m,_=>{h=h&&!this.tileUrlFunction(_,i,c)})}const d=new WC(o,h?de.EMPTY:de.IDLE,a,this.getSourceTiles.bind(this,i,s),this.removeSourceTiles.bind(this));return d.key=this.getKey(),d}getTileGridForProjection(e){const t=e.getCode();let r=this.tileGrids_[t];if(!r){const i=this.projection;if(i!==null&&!Mt(i,e))return mE(e);const s=this.tileGrid,o=s.getResolutions().slice(),a=o.map(function(u,h){return s.getOrigin(h)}),l=o.map(function(u,h){return s.getTileSize(h)}),c=yE+1;for(let u=o.length;u<c;++u)o.push(o[u-1]/2),a.push(a[u-1]),l.push(l[u-1]);r=new nh({extent:s.getExtent(),origins:a,resolutions:o,tileSizes:l}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){const i=this.getTileGridForProjection(r),s=eh(i.getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function vy(n,e){n.setLoader(function(t,r,i){wy(e,n.getFormat(),t,r,i,n.onLoad.bind(n),n.onError.bind(n))})}class ZC extends rh{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",r=e.tileGrid;let i=e.urls;i===void 0&&e.url!==void 0&&(i=xE(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:i,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=lf(i.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(lf(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?Ra(e,r):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in r?r[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const c={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(c,s);let u=e;return t=="KVP"?u=Ra(u,c):u=u.replace(/\{(\w+?)\}/g,function(h,d){return encodeURIComponent(c[d])}),u}}}function YC(n,e){var N;const t=n.Contents.Layer,r=t==null?void 0:t.find(function(D){return D.Identifier==e.layer});if(!r)return null;const i=n.Contents.TileMatrixSet;let s;r.TileMatrixSetLink.length>1?"projection"in e?s=r.TileMatrixSetLink.findIndex(function(D){const M=i.find(function(B){return B.Identifier==D.TileMatrixSet}).SupportedCRS,O=$e(M),U=$e(e.projection);return O&&U?Mt(O,U):M==e.projection}):s=r.TileMatrixSetLink.findIndex(function(D){return D.TileMatrixSet==e.matrixSet}):s=0,s<0&&(s=0);const o=r.TileMatrixSetLink[s].TileMatrixSet,a=r.TileMatrixSetLink[s].TileMatrixSetLimits;let l=r.Format[0];"format"in e&&(l=e.format),s=r.Style.findIndex(function(D){return"style"in e?D.Title==e.style:D.isDefault}),s<0&&(s=0);const c=r.Style[s].Identifier,u={};"Dimension"in r&&r.Dimension.forEach(function(D,R,M){const O=D.Identifier;let U=D.Default;U===void 0&&(U=D.Value[0]),u[O]=U});const d=n.Contents.TileMatrixSet.find(function(D){return D.Identifier==o});let f;const p=d.SupportedCRS;if(p&&(f=$e(p)),"projection"in e){const D=$e(e.projection);D&&(!f||Mt(D,f))&&(f=D)}let g=!1;const m=f.getAxisOrientation().startsWith("ne");let y=d.TileMatrix[0],_={MinTileCol:0,MinTileRow:0,MaxTileCol:y.MatrixWidth-1,MaxTileRow:y.MatrixHeight-1};if(a){_=a[a.length-1];const D=d.TileMatrix.find(R=>R.Identifier===_.TileMatrix||d.Identifier+":"+R.Identifier===_.TileMatrix);D&&(y=D)}const x=(N=r.BoundingBox)==null?void 0:N.find(D=>$e(D.crs)&&Mt($e(D.crs),f)),E=y.ScaleDenominator*28e-5/f.getMetersPerUnit(),b=m?[y.TopLeftCorner[1],y.TopLeftCorner[0]]:y.TopLeftCorner,T=y.TileWidth*E,w=y.TileHeight*E;let v=(x==null?void 0:x.extent)??d.BoundingBox;v&&m&&(v=[v[1],v[0],v[3],v[2]]);let S=[b[0]+T*_.MinTileCol,b[1]-w*(1+_.MaxTileRow),b[0]+T*(1+_.MaxTileCol),b[1]-w*_.MinTileRow];if(v!==void 0&&!Vr(v,S)){const D=r.WGS84BoundingBox,R=$e("EPSG:4326").getExtent();if(S=v,D)g=D[0]===R[0]&&D[2]===R[2];else{const M=di(v,d.SupportedCRS,"EPSG:4326");g=M[0]-1e-10<=R[0]&&M[2]+1e-10>=R[2]}}const C=_E(d,S,a),P=[];let A=e.requestEncoding;if(A=A!==void 0?A:"","OperationsMetadata"in n&&"GetTile"in n.OperationsMetadata){const D=n.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let R=0,M=D.length;R<M;++R)if(D[R].Constraint){const U=D[R].Constraint.find(function(B){return B.name=="GetEncoding"}).AllowedValues.Value;if(A===""&&(A=U[0]),A==="KVP")U.includes("KVP")&&P.push(D[R].href);else break}else D[R].href&&(A="KVP",P.push(D[R].href))}return P.length===0&&(A="REST",r.ResourceURL.forEach(function(D){D.resourceType==="tile"&&(l=D.format,P.push(D.template))})),{urls:P,layer:e.layer,matrixSet:o,format:l,projection:f,requestEncoding:A,tileGrid:C,style:c,dimensions:u,wrapX:g,crossOrigin:e.crossOrigin}}class Uh extends oy{constructor(e){super(),e=e||{},this.dataProjection=new om({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:Ot,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,i){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,c=0,u=0,h=0;for(;e.pos<s;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),c+=e.readSVarint(),o===1&&u>h&&(i.push(u),h=u),r.push(l,c),u+=2;else if(o===7)u>h&&(r.push(r[h],r[h+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>h&&(i.push(u),h=u)}createFeature_(e,t,r){const i=t.type;if(i===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],c=[];this.readRawGeometry_(e,t,l,c);const u=QC(i,c.length);if(this.featureClass===Ot)s=new this.featureClass(u,l,c,2,o,a),s.transform(r.dataProjection);else{let h;if(u=="Polygon"){const p=Yg(l,c);h=p.length>1?new to(l,"XY",p):new xa(l,"XY",c)}else h=u==="Point"?new _a(l,"XY"):u==="LineString"?new Si(l,"XY"):u==="MultiPoint"?new Po(l,"XY"):u==="MultiLineString"?new eo(l,"XY",c):null;const d=this.featureClass;s=new d,this.geometryName_&&s.setGeometryName(this.geometryName_);const f=Tl(h,!1,r);s.setGeometry(f),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const r=this.layers_;t=this.adaptOptions(t);const i=$e(t.dataProjection);i.setWorldExtent(t.extent),t.dataProjection=i;const s=new cx(e),o=s.readFields(HC,{}),a=[];for(const l in o){if(r&&!r.includes(l))continue;const c=o[l],u=c?[0,0,c.extent,c.extent]:null;i.setExtent(u);for(let h=0,d=c.length;h<d;++h){const f=JC(s,c,h),p=this.createFeature_(s,f,t);p!==null&&a.push(p)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function HC(n,e,t){if(n===3){const r={keys:[],values:[],features:[]},i=t.readVarint()+t.pos;t.readFields(qC,r,i),r.length=r.features.length,r.length&&(e[r.name]=r)}}function qC(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let r=null;const i=t.readVarint()+t.pos;for(;t.pos<i;)n=t.readVarint()>>3,r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(r)}}function KC(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[i]=s}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function JC(n,e,t){n.pos=e.features[t];const r=n.readVarint()+n.pos,i={layer:e,type:0,properties:{}};return n.readFields(KC,i,r),i}function QC(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}var rr=Uint8Array,Zi=Uint16Array,eP=Int32Array,Ry=new rr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cy=new rr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tP=new rr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Py=function(n,e){for(var t=new Zi(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new eP(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},Iy=Py(Ry,2),Ay=Iy.b,rP=Iy.r;Ay[28]=258,rP[258]=28;var nP=Py(Cy,0),iP=nP.b,fu=new Zi(32768);for(var Ye=0;Ye<32768;++Ye){var In=(Ye&43690)>>1|(Ye&21845)<<1;In=(In&52428)>>2|(In&13107)<<2,In=(In&61680)>>4|(In&3855)<<4,fu[Ye]=((In&65280)>>8|(In&255)<<8)>>1}var Us=function(n,e,t){for(var r=n.length,i=0,s=new Zi(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new Zi(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new Zi(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],u=e-n[i],h=o[n[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[fu[h]>>l]=c}else for(a=new Zi(r),i=0;i<r;++i)n[i]&&(a[i]=fu[o[n[i]-1]++]>>15-n[i]);return a},Lo=new rr(288);for(var Ye=0;Ye<144;++Ye)Lo[Ye]=8;for(var Ye=144;Ye<256;++Ye)Lo[Ye]=9;for(var Ye=256;Ye<280;++Ye)Lo[Ye]=7;for(var Ye=280;Ye<288;++Ye)Lo[Ye]=8;var Ly=new rr(32);for(var Ye=0;Ye<32;++Ye)Ly[Ye]=5;var sP=Us(Lo,9,1),oP=Us(Ly,5,1),cc=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Sr=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},uc=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},aP=function(n){return(n+7)/8|0},lP=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new rr(n.subarray(e,t))},cP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Jt=function(n,e,t){var r=new Error(e||cP[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Jt),!t)throw r;return r},Bh=function(n,e,t,r){var i=n.length,s=0;if(!i||e.f&&!e.l)return t||new rr(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new rr(i*3));var c=function(Bt){var mt=t.length;if(Bt>mt){var ft=new rr(Math.max(mt*2,Bt));ft.set(t),t=ft}},u=e.f||0,h=e.p||0,d=e.b||0,f=e.l,p=e.d,g=e.m,m=e.n,y=i*8;do{if(!f){u=Sr(n,h,1);var _=Sr(n,h+1,3);if(h+=3,_)if(_==1)f=sP,p=oP,g=9,m=5;else if(_==2){var T=Sr(n,h,31)+257,w=Sr(n,h+10,15)+4,v=T+Sr(n,h+5,31)+1;h+=14;for(var S=new rr(v),C=new rr(19),P=0;P<w;++P)C[tP[P]]=Sr(n,h+P*3,7);h+=w*3;for(var A=cc(C),N=(1<<A)-1,D=Us(C,A,1),P=0;P<v;){var R=D[Sr(n,h,N)];h+=R&15;var x=R>>4;if(x<16)S[P++]=x;else{var M=0,O=0;for(x==16?(O=3+Sr(n,h,3),h+=2,M=S[P-1]):x==17?(O=3+Sr(n,h,7),h+=3):x==18&&(O=11+Sr(n,h,127),h+=7);O--;)S[P++]=M}}var U=S.subarray(0,T),B=S.subarray(T);g=cc(U),m=cc(B),f=Us(U,g,1),p=Us(B,m,1)}else Jt(1);else{var x=aP(h)+4,E=n[x-4]|n[x-3]<<8,b=x+E;if(b>i){l&&Jt(0);break}a&&c(d+E),t.set(n.subarray(x,b),d),e.b=d+=E,e.p=h=b*8,e.f=u;continue}if(h>y){l&&Jt(0);break}}a&&c(d+131072);for(var V=(1<<g)-1,Y=(1<<m)-1,G=h;;G=h){var M=f[uc(n,h)&V],K=M>>4;if(h+=M&15,h>y){l&&Jt(0);break}if(M||Jt(2),K<256)t[d++]=K;else if(K==256){G=h,f=null;break}else{var k=K-254;if(K>264){var P=K-257,le=Ry[P];k=Sr(n,h,(1<<le)-1)+Ay[P],h+=le}var xe=p[uc(n,h)&Y],be=xe>>4;xe||Jt(3),h+=xe&15;var B=iP[be];if(be>3){var le=Cy[be];B+=uc(n,h)&(1<<le)-1,h+=le}if(h>y){l&&Jt(0);break}a&&c(d+131072);var at=d+k;if(d<B){var Re=s-B,qe=Math.min(B,at);for(Re+d<0&&Jt(3);d<qe;++d)t[d]=r[Re+d]}for(;d<at;++d)t[d]=t[d-B]}}e.l=f,e.p=G,e.b=d,e.f=u,f&&(u=1,e.m=g,e.d=p,e.n=m)}while(!u);return d!=t.length&&o?lP(t,0,d):t.subarray(0,d)},uP=new rr(0),hP=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Jt(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},dP=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},fP=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Jt(6,"invalid zlib data"),(n[1]>>5&1)==1&&Jt(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function pP(n,e){return Bh(n,{i:2},e,e)}function gP(n,e){var t=hP(n);return t+8>n.length&&Jt(6,"invalid gzip data"),Bh(n.subarray(t,-8),{i:2},new rr(dP(n)),e)}function mP(n,e){return Bh(n.subarray(fP(n),-4),{i:2},e,e)}function yP(n,e){return n[0]==31&&n[1]==139&&n[2]==8?gP(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?pP(n,e):mP(n,e)}var _P=typeof TextDecoder<"u"&&new TextDecoder,xP=0;try{_P.decode(uP,{stream:!0}),xP=1}catch{}var bP=Object.defineProperty,EP=Math.pow,Be=(n,e)=>bP(n,"name",{value:e,configurable:!0}),wt=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(c){i(c)}},o=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())});Be((n,e)=>{let t=!1,r="",i=L.GridLayer.extend({createTile:Be((s,o)=>{let a=document.createElement("img"),l=new AbortController,c=l.signal;return a.cancel=()=>{l.abort()},t||(n.getHeader().then(u=>{u.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):u.tileType===2?r="image/png":u.tileType===3?r="image/jpeg":u.tileType===4?r="image/webp":u.tileType===5&&(r="image/avif")}),t=!0),n.getZxy(s.z,s.x,s.y,c).then(u=>{if(u){let h=new Blob([u.data],{type:r}),d=window.URL.createObjectURL(h);a.src=d}else a.style.display="none";a.cancel=void 0,o(void 0,a)}).catch(u=>{if(u.name!=="AbortError")throw u}),a},"createTile"),_removeTile:Be(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var TP=Be(n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);let r=new AbortController;return n(e,r).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:Be(()=>r.abort(),"cancel")}},"v3compat"),wP=class{constructor(e){this.tilev4=Be((t,r)=>wt(this,null,function*(){if(t.type==="json"){let f=t.url.substr(10),p=this.tiles.get(f);if(p||(p=new ro(f),this.tiles.set(f,p)),this.metadata){let m=yield p.getTileJson(t.url);return r.signal.throwIfAborted(),{data:m}}let g=yield p.getHeader();return r.signal.throwIfAborted(),(g.minLon>=g.maxLon||g.minLat>=g.maxLat)&&console.error(`Bounds of PMTiles archive ${g.minLon},${g.minLat},${g.maxLon},${g.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:g.minZoom,maxzoom:g.maxZoom,bounds:[g.minLon,g.minLat,g.maxLon,g.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new ro(o),this.tiles.set(o,a));let l=s[2],c=s[3],u=s[4],h=yield a.getHeader(),d=yield a==null?void 0:a.getZxy(+l,+c,+u,r.signal);if(r.signal.throwIfAborted(),d)return{data:new Uint8Array(d.data),cacheControl:d.cacheControl,expires:d.expires};if(h.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=TP(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};Be(wP,"Protocol");function Fy(n,e){return(e>>>0)*4294967296+(n>>>0)}Be(Fy,"toNum");function My(n,e){let t=e.buf,r=t[e.pos++],i=(r&112)>>4;if(r<128||(r=t[e.pos++],i|=(r&127)<<3,r<128)||(r=t[e.pos++],i|=(r&127)<<10,r<128)||(r=t[e.pos++],i|=(r&127)<<17,r<128)||(r=t[e.pos++],i|=(r&127)<<24,r<128)||(r=t[e.pos++],i|=(r&1)<<31,r<128))return Fy(n,i);throw new Error("Expected varint not more than 10 bytes")}Be(My,"readVarintRemainder");function ki(n){let e=n.buf,t=e[n.pos++],r=t&127;return t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,My(r,n))}Be(ki,"readVarint");function zh(n,e,t,r,i){return i===0?r!==0?[n-1-t,n-1-e]:[t,e]:[e,t]}Be(zh,"rotate");function Oy(n,e,t){if(n>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<n||t>=1<<n)throw new Error("tile x/y outside zoom level bounds");let r=((1<<n)*(1<<n)-1)/3,i=n-1,[s,o]=[e,t];for(let a=1<<i;a>0;a>>=1){let l=s&a,c=o&a;r+=(3*l^c)*(1<<i),[s,o]=zh(a,s,o,l,c),i--}return r}Be(Oy,"zxyToTileId");function Ny(n){let e=3*n+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}Be(Ny,"tileIdToZ");function SP(n){let e=Ny(n)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,r=n-t,i=0,s=0,o=1<<e;for(let a=1;a<o;a<<=1){let l=a&r/2,c=a&(r^l);[i,s]=zh(a,i,s,l,c),r=r/2,i+=l,s+=c}return[e,i,s]}Be(SP,"tileIdToZxy");var vP=(n=>(n[n.Unknown=0]="Unknown",n[n.None=1]="None",n[n.Gzip=2]="Gzip",n[n.Brotli=3]="Brotli",n[n.Zstd=4]="Zstd",n))(vP||{});function Sl(n,e){return wt(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return yP(new Uint8Array(n));let t=new Response(n).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}Be(Sl,"defaultDecompress");var Ui=(n=>(n[n.Unknown=0]="Unknown",n[n.Mvt=1]="Mvt",n[n.Png=2]="Png",n[n.Jpeg=3]="Jpeg",n[n.Webp=4]="Webp",n[n.Avif=5]="Avif",n))(Ui||{});function Dy(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}Be(Dy,"tileTypeExt");var RP=127;function Gy(n,e){let t=0,r=n.length-1;for(;t<=r;){let i=r+t>>1,s=e-n[i].tileId;if(s>0)t=i+1;else if(s<0)r=i-1;else return n[i]}return r>=0&&(n[r].runLength===0||e-n[r].tileId<n[r].runLength)?n[r]:null}Be(Gy,"findTile");var CP=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return wt(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};Be(CP,"FileSource");var ky=class{constructor(e,t=new Headers){var r,i;this.url=e,this.customHeaders=t,this.mustReload=!1;let s="";"navigator"in globalThis&&(s=(i=(r=globalThis.navigator)==null?void 0:r.userAgent)!=null?i:"");let o=s.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(s);this.chromeWindowsNoCache=!1,o&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,i){return wt(this,null,function*(){let s,o;r?o=r:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let c=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&c.status===416){let d=c.headers.get("Content-Range");if(!d||!d.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let f=+d.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${f-1}`}})}let u=c.headers.get("Etag");if(u!=null&&u.startsWith("W/")&&(u=null),c.status===416||i&&u&&u!==i)throw this.mustReload=!0,new pu(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw new Error(`Bad response code: ${c.status}`);let h=c.headers.get("Content-Length");if(c.status===200&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:u||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};Be(ky,"FetchSource");var PP=ky;function gr(n,e){let t=n.getUint32(e+4,!0),r=n.getUint32(e+0,!0);return t*EP(2,32)+r}Be(gr,"getUint64");function Uy(n,e){let t=new DataView(n),r=t.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:gr(t,8),rootDirectoryLength:gr(t,16),jsonMetadataOffset:gr(t,24),jsonMetadataLength:gr(t,32),leafDirectoryOffset:gr(t,40),leafDirectoryLength:gr(t,48),tileDataOffset:gr(t,56),tileDataLength:gr(t,64),numAddressedTiles:gr(t,72),numTileEntries:gr(t,80),numTileContents:gr(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}Be(Uy,"bytesToHeader");function $h(n){let e={buf:new Uint8Array(n),pos:0},t=ki(e),r=[],i=0;for(let s=0;s<t;s++){let o=ki(e);r.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)r[s].runLength=ki(e);for(let s=0;s<t;s++)r[s].length=ki(e);for(let s=0;s<t;s++){let o=ki(e);o===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=o-1}return r}Be($h,"deserializeIndex");var By=class extends Error{};Be(By,"EtagMismatch");var pu=By;function jh(n,e){return wt(this,null,function*(){let t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let r=t.data.slice(0,RP),i=Uy(r,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${n.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=$h(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}Be(jh,"getHeaderAndRoot");function Xh(n,e,t,r,i){return wt(this,null,function*(){let s=yield n.getBytes(t,r,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=$h(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}Be(Xh,"getDirectory");var IP=class{constructor(e=100,t=!0,r=Sl){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return wt(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let i=yield jh(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,r,i){return wt(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield Xh(e,this.decompress,t,r,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return wt(this,null,function*(){this.cache.delete(e.getKey())})}};Be(IP,"ResolvedValueCache");var zy=class{constructor(e=100,t=!0,r=Sl){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return wt(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((s,o)=>{jh(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,r,i){return wt(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,c)=>{Xh(e,this.decompress,t,r,i).then(u=>{l(u),this.prune()}).catch(u=>{c(u)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return wt(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,r)})}};Be(zy,"SharedPromiseCache");var AP=zy,$y=class{constructor(e,t,r){typeof e=="string"?this.source=new PP(e):this.source=e,r?this.decompress=r:this.decompress=Sl,t?this.cache=t:this.cache=new AP}getHeader(){return wt(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,i){return wt(this,null,function*(){let s=Oy(e,t,r),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let c=0;c<=3;c++){let u=yield this.cache.getDirectory(this.source,a,l,o),h=Gy(u,s);if(h){if(h.runLength>0){let d=yield this.source.getBytes(o.tileDataOffset+h.offset,h.length,i,o.etag);return{data:yield this.decompress(d.data,o.tileCompression),cacheControl:d.cacheControl,expires:d.expires}}a=o.leafDirectoryOffset+h.offset,l=h.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,i){return wt(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,i)}catch(s){if(s instanceof pu)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,i);throw s}})}getMetadataAttempt(){return wt(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return wt(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof pu)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return wt(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),i=Dy(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};Be($y,"PMTiles");var ro=$y,jy=Object.defineProperty,lp=Object.getOwnPropertySymbols,LP=Object.prototype.hasOwnProperty,FP=Object.prototype.propertyIsEnumerable,cp=(n,e,t)=>e in n?jy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,za=(n,e)=>{for(var t in e||(e={}))LP.call(e,t)&&cp(n,t,e[t]);if(lp)for(var t of lp(e))FP.call(e,t)&&cp(n,t,e[t]);return n},vl=(n,e)=>jy(n,"name",{value:e,configurable:!0}),MP=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(c){i(c)}},o=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),Xy=class extends am{constructor(e){super(za(za({},e),{state:"loading"})),this.loadImage=vl(r=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=r}),"loadImage");const t=new ro(e.url);t.getHeader().then(r=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||To({extent:pl(i),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((s,o,a)=>MP(this,null,function*(){const l=yield t.getZxy(s,o,a);if(!l)return new Uint8Array;const c=URL.createObjectURL(new Blob([l.data])),u=yield this.loadImage(c);return URL.revokeObjectURL(c),u})),this.setState("ready")})}};vl(Xy,"PMTilesRasterSource");var up=Xy,Vy=class extends Ao{constructor(e){super(za(za({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new Uh})),this.tileLoadFunction=vl((t,r)=>{const i=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),o=r.match(s);if(!(o&&o.length>=4))throw Error("Could not parse tile URL");const a=+o[1],l=+o[2],c=+o[3];i.setLoader((u,h,d)=>{this.pmtiles_.getZxy(a,l,c).then(f=>{if(f){const p=i.getFormat();i.setFeatures(p.readFeatures(f.data,{extent:u,featureProjection:d})),i.setState(de.LOADED)}else i.setFeatures([]),i.setState(de.EMPTY)}).catch(f=>{i.setFeatures([]),i.setState(de.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new ro(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",i=e.extent||pl(r);this.tileGrid=e.tileGrid||To({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};vl(Vy,"PMTilesVectorSource");var OP=Vy;class NP extends hl{constructor(e){super(Qr.ERROR),this.error=e}}function It(n){return(e,...t)=>DP(n,e,t)}function Es(n,e){return It(Wy(n,e).get)}const{apply:DP,getOwnPropertyDescriptor:Wy,getPrototypeOf:Vh,ownKeys:GP}=Reflect,{iterator:Fo,toStringTag:kP}=Symbol,UP=Object,{create:Wh,defineProperty:BP}=UP,zP=Array,$P=zP.prototype,Zy=$P[Fo],jP=It(Zy),Yy=ArrayBuffer,XP=Yy.prototype;Es(XP,"byteLength");const hp=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;hp&&Es(hp.prototype,"byteLength");const Hy=Vh(Uint8Array);Hy.from;const Ut=Hy.prototype;Ut[Fo];It(Ut.keys);It(Ut.values);It(Ut.entries);It(Ut.set);It(Ut.reverse);It(Ut.fill);It(Ut.copyWithin);It(Ut.sort);It(Ut.slice);It(Ut.subarray);Es(Ut,"buffer");Es(Ut,"byteOffset");Es(Ut,"length");Es(Ut,kP);const VP=Uint8Array,qy=Uint16Array,Zh=Uint32Array,WP=Float32Array,no=Vh([][Fo]()),Ky=It(no.next),ZP=It(function*(){}().next),YP=Vh(no),HP=DataView.prototype,qP=It(HP.getUint16),Yh=WeakMap,Jy=Yh.prototype,Qy=It(Jy.get),KP=It(Jy.set),e_=new Yh,JP=Wh(null,{next:{value:function(){const e=Qy(e_,this);return Ky(e)}},[Fo]:{value:function(){return this}}});function QP(n){if(n[Fo]===Zy&&no.next===Ky)return n;const e=Wh(JP);return KP(e_,e,jP(n)),e}const eI=new Yh,tI=Wh(YP,{next:{value:function(){const e=Qy(eI,this);return ZP(e)},writable:!0,configurable:!0}});for(const n of GP(no))n!=="next"&&BP(tI,n,Wy(no,n));const t_=new Yy(4),rI=new WP(t_),nI=new Zh(t_),kr=new qy(512),Ur=new VP(512);for(let n=0;n<256;++n){const e=n-127;e<-24?(kr[n]=0,kr[n|256]=32768,Ur[n]=24,Ur[n|256]=24):e<-14?(kr[n]=1024>>-e-14,kr[n|256]=1024>>-e-14|32768,Ur[n]=-e-1,Ur[n|256]=-e-1):e<=15?(kr[n]=e+15<<10,kr[n|256]=e+15<<10|32768,Ur[n]=13,Ur[n|256]=13):e<128?(kr[n]=31744,kr[n|256]=64512,Ur[n]=24,Ur[n|256]=24):(kr[n]=31744,kr[n|256]=64512,Ur[n]=13,Ur[n|256]=13)}const Hh=new Zh(2048);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Hh[n]=e|t}for(let n=1024;n<2048;++n)Hh[n]=939524096+(n-1024<<13);const Ts=new Zh(64);for(let n=1;n<31;++n)Ts[n]=n<<23;Ts[31]=1199570944;Ts[32]=2147483648;for(let n=33;n<63;++n)Ts[n]=2147483648+(n-32<<23);Ts[63]=3347054592;const r_=new qy(64);for(let n=1;n<64;++n)n!==32&&(r_[n]=1024);function iI(n){const e=n>>10;return nI[0]=Hh[r_[e]+(n&1023)]+Ts[e],rI[0]}function n_(n,e,...t){return iI(qP(n,e,...QP(t)))}var qh={exports:{}};function i_(n,e,t){const r=t&&t.debug||!1;r&&console.log("[xml-utils] getting "+e+" in "+n);const i=typeof n=="object"?n.outer:n,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],c=e+"\\="+l+"([^"+l+"]*)"+l;r&&console.log("[xml-utils] pattern:",c);const h=new RegExp(c).exec(s);if(r&&console.log("[xml-utils] match:",h),h)return h[1]}}qh.exports=i_;qh.exports.default=i_;var sI=qh.exports;const hc=um(sI);var Kh={exports:{}},Jh={exports:{}},Qh={exports:{}};function s_(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index:-1}Qh.exports=s_;Qh.exports.default=s_;var oI=Qh.exports,ed={exports:{}};function o_(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index+i[0].length-1:-1}ed.exports=o_;ed.exports.default=o_;var aI=ed.exports,td={exports:{}};function a_(n,e){const t=new RegExp(e,"g"),r=n.match(t);return r?r.length:0}td.exports=a_;td.exports.default=a_;var lI=td.exports;const cI=oI,dc=aI,dp=lI;function l_(n,e,t){const r=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;r&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=cI(n,`<${e}[ 
>/]`,s);if(r&&console.log("[xml-utils] start:",o),o===-1)return;const a=n.slice(o+e.length);let l=dc(a,"^[^<]*[ /]>",0);const c=l!==-1&&a[l-1]==="/";if(r&&console.log("[xml-utils] selfClosing:",c),c===!1)if(i){let f=0,p=1,g=0;for(;(l=dc(a,"[ /]"+e+">",f))!==-1;){const m=a.substring(f,l+1);if(p+=dp(m,"<"+e+`[ 
	>]`),g+=dp(m,"</"+e+">"),g>=p)break;f=l}}else l=dc(a,"[ /]"+e+">",0);const u=o+e.length+l+1;if(r&&console.log("[xml-utils] end:",u),u===-1)return;const h=n.slice(o,u);let d;return c?d=null:d=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:d,outer:h,start:o,end:u}}Jh.exports=l_;Jh.exports.default=l_;var uI=Jh.exports;const hI=uI;function c_(n,e,t){const r=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=hI(n,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,r.push(a);return i&&console.log("findTagsByName found",r.length,"tags"),r}Kh.exports=c_;Kh.exports.default=c_;var dI=Kh.exports;const fI=um(dI),Bs={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Br={};for(const n in Bs)Bs.hasOwnProperty(n)&&(Br[Bs[n]]=parseInt(n,10));const pI=[Br.BitsPerSample,Br.ExtraSamples,Br.SampleFormat,Br.StripByteCounts,Br.StripOffsets,Br.StripRowCounts,Br.TileByteCounts,Br.TileOffsets,Br.SubIFDs],fc={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ce={};for(const n in fc)fc.hasOwnProperty(n)&&(ce[fc[n]]=parseInt(n,10));const Gt={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},gI={Unspecified:0},zO={AddCompression:1},$O={None:0,Deflate:1,Zstandard:2},mI={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function yI(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=256-n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function _I(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function xI(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<n.length;++a,l+=3){const c=n[a];i[l]=e[c]/65536*256,i[l+1]=e[c+s]/65536*256,i[l+2]=e[c+o]/65536*256}return i}function bI(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=4,s+=3){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3];r[s]=255*((255-o)/256)*((255-c)/256),r[s+1]=255*((255-a)/256)*((255-c)/256),r[s+2]=255*((255-l)/256)*((255-c)/256)}return r}function EI(n){const{width:e,height:t}=n,r=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i],a=n[i+1],l=n[i+2];r[s]=o+1.402*(l-128),r[s+1]=o-.34414*(a-128)-.71414*(l-128),r[s+2]=o+1.772*(a-128)}return r}const TI=.95047,wI=1,SI=1.08883;function vI(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i+0],a=n[i+1]<<24>>24,l=n[i+2]<<24>>24;let c=(o+16)/116,u=a/500+c,h=c-l/200,d,f,p;u=TI*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=wI*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=SI*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),d=u*3.2406+c*-1.5372+h*-.4986,f=u*-.9689+c*1.8758+h*.0415,p=u*.0557+c*-.204+h*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,r[s]=Math.max(0,Math.min(1,d))*255,r[s+1]=Math.max(0,Math.min(1,f))*255,r[s+2]=Math.max(0,Math.min(1,p))*255}return r}const u_=new Map;function Kn(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>u_.set(t,e))}async function h_(n){const e=u_.get(n.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const t=await e();return new t(n)}Kn([void 0,1],()=>Sn(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(n=>n.default));Kn(5,()=>Sn(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(n=>n.default));Kn(6,()=>{throw new Error("old style JPEG compression is not supported.")});Kn(7,()=>Sn(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(n=>n.default));Kn([8,32946],()=>Sn(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(n=>n.default));Kn(32773,()=>Sn(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(n=>n.default));Kn(34887,()=>Sn(()=>import("./lerc.BjRHki-8.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15])).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));Kn(50001,()=>Sn(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([16,1])).then(n=>n.default));function Rl(n,e,t,r=1){return new(Object.getPrototypeOf(n)).constructor(e*t*r)}function RI(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=Rl(a,r,i);for(let c=0;c<i;++c){const u=Math.min(Math.round(o*c),t-1);for(let h=0;h<r;++h){const d=Math.min(Math.round(s*h),e-1),f=a[u*e+d];l[c*r+h]=f}}return l})}function Ji(n,e,t){return(1-t)*n+t*e}function CI(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=Rl(a,r,i);for(let c=0;c<i;++c){const u=o*c,h=Math.floor(u),d=Math.min(Math.ceil(u),t-1);for(let f=0;f<r;++f){const p=s*f,g=p%1,m=Math.floor(p),y=Math.min(Math.ceil(p),e-1),_=a[h*e+m],x=a[h*e+y],E=a[d*e+m],b=a[d*e+y],T=Ji(Ji(_,x,g),Ji(E,b,g),u%1);l[c*r+f]=T}}return l})}function PI(n,e,t,r,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return RI(n,e,t,r,i);case"bilinear":case"linear":return CI(n,e,t,r,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function II(n,e,t,r,i,s){const o=e/r,a=t/i,l=Rl(n,r,i,s);for(let c=0;c<i;++c){const u=Math.min(Math.round(a*c),t-1);for(let h=0;h<r;++h){const d=Math.min(Math.round(o*h),e-1);for(let f=0;f<s;++f){const p=n[u*e*s+d*s+f];l[c*r*s+h*s+f]=p}}}return l}function AI(n,e,t,r,i,s){const o=e/r,a=t/i,l=Rl(n,r,i,s);for(let c=0;c<i;++c){const u=a*c,h=Math.floor(u),d=Math.min(Math.ceil(u),t-1);for(let f=0;f<r;++f){const p=o*f,g=p%1,m=Math.floor(p),y=Math.min(Math.ceil(p),e-1);for(let _=0;_<s;++_){const x=n[h*e*s+m*s+_],E=n[h*e*s+y*s+_],b=n[d*e*s+m*s+_],T=n[d*e*s+y*s+_],w=Ji(Ji(x,E,g),Ji(b,T,g),u%1);l[c*r*s+f*s+_]=w}}}return l}function LI(n,e,t,r,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return II(n,e,t,r,i,s);case"bilinear":case"linear":return AI(n,e,t,r,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function FI(n,e,t){let r=0;for(let i=e;i<t;++i)r+=n[i];return r}function gu(n,e,t){switch(n){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function MI(n,e){return(n===1||n===2)&&e<=32&&e%8===0?!1:!(n===3&&(e===16||e===32||e===64))}function OI(n,e,t,r,i,s,o){const a=new DataView(n),l=t===2?o*s:o*s*r,c=t===2?1:r,u=gu(e,i,l),h=parseInt("1".repeat(i),2);if(e===1){let d;t===1?d=r*i:d=i;let f=s*d;f&7&&(f=f+7&-8);for(let p=0;p<o;++p){const g=p*f;for(let m=0;m<s;++m){const y=g+m*c*i;for(let _=0;_<c;++_){const x=y+_*i,E=(p*s+m)*c+_,b=Math.floor(x/8),T=x%8;if(T+i<=8)u[E]=a.getUint8(b)>>8-i-T&h;else if(T+i<=16)u[E]=a.getUint16(b)>>16-i-T&h;else if(T+i<=24){const w=a.getUint16(b)<<8|a.getUint8(b+2);u[E]=w>>24-i-T&h}else u[E]=a.getUint32(b)>>32-i-T&h}}}}return u.buffer}class d_{constructor(e,t,r,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(i,s){return n_(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return gu(r,i,t)}async getTileOrStrip(e,t,r,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=r*o*a+t*o+e);let u,h;this.isTiled?(u=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:u,length:h}],s))[0];let f;return c===null||!c[l]?(f=(async()=>{let p=await i.decode(this.fileDirectory,d);const g=this.getSampleFormat(),m=this.getBitsPerSample();return MI(g,m)&&(p=OI(p,g,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),p})(),c!==null&&(c[l]=f)):f=c[l],{x:e,y:t,sample:r,data:await f}}async _readRaster(e,t,r,i,s,o,a,l,c){const u=this.getTileWidth(),h=this.getTileHeight(),d=this.getWidth(),f=this.getHeight(),p=Math.max(Math.floor(e[0]/u),0),g=Math.min(Math.ceil(e[2]/u),Math.ceil(d/u)),m=Math.max(Math.floor(e[1]/h),0),y=Math.min(Math.ceil(e[3]/h),Math.ceil(f/h)),_=e[2]-e[0];let x=this.getBytesPerPixel();const E=[],b=[];for(let v=0;v<t.length;++v)this.planarConfiguration===1?E.push(FI(this.fileDirectory.BitsPerSample,0,t[v])/8):E.push(0),b.push(this.getReaderForSample(t[v]));const T=[],{littleEndian:w}=this;for(let v=m;v<y;++v)for(let S=p;S<g;++S){let C;this.planarConfiguration===1&&(C=this.getTileOrStrip(S,v,0,s,c));for(let P=0;P<t.length;++P){const A=P,N=t[P];this.planarConfiguration===2&&(x=this.getSampleByteSize(N),C=this.getTileOrStrip(S,v,N,s,c));const D=C.then(R=>{const M=R.data,O=new DataView(M),U=this.getBlockHeight(R.y),B=R.y*h,V=R.x*u,Y=B+U,G=(R.x+1)*u,K=b[A],k=Math.min(U,U-(Y-e[3]),f-B),le=Math.min(u,u-(G-e[2]),d-V);for(let xe=Math.max(0,e[1]-B);xe<k;++xe)for(let be=Math.max(0,e[0]-V);be<le;++be){const at=(xe*u+be)*x,Re=K.call(O,at+E[A],w);let qe;i?(qe=(xe+B-e[1])*_*t.length+(be+V-e[0])*t.length+A,r[qe]=Re):(qe=(xe+B-e[1])*_+be+V-e[0],r[A][qe]=Re)}});T.push(D)}}if(await Promise.all(T),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let v;return i?v=LI(r,e[2]-e[0],e[3]-e[1],o,a,t.length,l):v=PI(r,e[2]-e[0],e[3]-e[1],o,a,l),v.width=o,v.height=a,v}return r.width=o||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:c}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=u[2]-u[0],d=u[3]-u[1],f=h*d,p=this.getSamplesPerPixel();if(!t||!t.length)for(let _=0;_<p;++_)t.push(_);else for(let _=0;_<t.length;++_)if(t[_]>=p)return Promise.reject(new RangeError(`Invalid sample index '${t[_]}'.`));let g;if(r){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,x=Math.max.apply(null,this.fileDirectory.BitsPerSample);g=gu(_,x,f*t.length),l&&g.fill(l)}else{g=[];for(let _=0;_<t.length;++_){const x=this.getArrayForSample(t[_],f);Array.isArray(l)&&_<l.length?x.fill(l[_]):l&&!Array.isArray(l)&&x.fill(l),g.push(x)}}const m=i||await h_(this.fileDirectory);return await this._readRaster(u,t,g,r,m,s,o,a,c)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===Gt.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==gI.Unspecified&&a){y=[];for(let _=0;_<this.fileDirectory.BitsPerSample.length;_+=1)y.push(_)}return this.readRasters({window:e,interleave:t,samples:y,pool:r,width:i,height:s,resampleMethod:o,signal:l})}let h;switch(u){case Gt.WhiteIsZero:case Gt.BlackIsZero:case Gt.Palette:h=[0];break;case Gt.CMYK:h=[0,1,2,3];break;case Gt.YCbCr:case Gt.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:c,interleave:!0,samples:h,pool:r,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:f}=this,p=await this.readRasters(d),g=2**this.fileDirectory.BitsPerSample[0];let m;switch(u){case Gt.WhiteIsZero:m=yI(p,g);break;case Gt.BlackIsZero:m=_I(p,g);break;case Gt.Palette:m=xI(p,f.ColorMap);break;case Gt.CMYK:m=bI(p);break;case Gt.YCbCr:m=EI(p);break;case Gt.CIELab:m=vI(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),_=new Uint8Array(m.length/3),x=new Uint8Array(m.length/3);for(let E=0,b=0;E<m.length;E+=3,++b)y[b]=m[E],_[b]=m[E+1],x[b]=m[E+2];m=[y,_,x]}return m.width=p.width,m.height=p.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=fI(r,"Item");e===null?i=i.filter(s=>hc(s,"sample")===void 0):i=i.filter(s=>Number(hc(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[hc(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return r[1]===0&&r[4]===0?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,c,u,h]=this.fileDirectory.ModelTransformation,f=[[0,0],[0,t],[r,0],[r,t]].map(([m,y])=>[a+i*m+s*y,h+l*m+c*y]),p=f.map(m=>m[0]),g=f.map(m=>m[1]);return[Math.min(...p),Math.min(...g),Math.max(...p),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*r,c=a+s[1]*t;return[Math.min(o,l),Math.min(a,c),Math.max(o,l),Math.max(a,c)]}}}class NI{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let r=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return n_(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class DI{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const GI=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class f_{constructor(e=GI,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(r=>{Sn(()=>import("./decoder.tqM1uIvc.js"),[]).then(i=>{r(i.create)})}),this._awaitingDecoder.then(r=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:r(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?h_(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,r(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const fp=`\r
\r
`;function p_(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const e={};for(const[t,r]of n)e[t.toLowerCase()]=r;return e}function kI(n){const e=n.split(`\r
`).map(t=>{const r=t.split(":").map(i=>i.trim());return r[0]=r[0].toLowerCase(),r});return p_(e)}function UI(n){const[e,...t]=n.split(";").map(i=>i.trim()),r=t.map(i=>i.split("="));return{type:e,params:p_(r)}}function mu(n){let e,t,r;return n&&([,e,t,r]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),r=parseInt(r,10)),{start:e,end:t,total:r}}function BI(n,e){let t=null;const r=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)r.decode(new Uint8Array(n,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<n.byteLength;){const a=r.decode(new Uint8Array(n,t,Math.min(s.length+1024,n.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const c=l.indexOf(fp),u=kI(l.substr(0,c)),{start:h,end:d,total:f}=mu(u["content-range"]),p=t+s.length+c+fp.length,g=parseInt(d,10)+1-parseInt(h,10);i.push({headers:u,data:n.slice(p,p+g),offset:h,length:g,fileSize:f}),t=p+g+4}return i}class rd{async fetch(e,t=void 0){return Promise.all(e.map(r=>this.fetchSlice(r,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class zI extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield e)}for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function $I(n){return new Promise(e=>setTimeout(e,n))}function jI(n,e){const t=Array.isArray(n)?n:Array.from(n),r=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,r[s]])}class as extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,as),this.name="AbortError"}}class XI extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const VI=XI;class WI{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class pp{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class ZI extends rd{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new zI({maxSize:r,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:d,length:f}of e){let p=d+f;const{fileSize:g}=this;g!==null&&(p=Math.min(p,g));const m=Math.floor(d/this.blockSize)*this.blockSize;for(let y=m;y<p;y+=this.blockSize){const _=Math.floor(y/this.blockSize);!this.blockCache.has(_)&&!this.blockRequests.has(_)&&(this.blockIdsToFetch.add(_),i.push(_)),this.blockRequests.has(_)&&r.push(this.blockRequests.get(_)),s.push(_)}}await $I(),this.fetchBlocks(t);const o=[];for(const d of i)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(r),await Promise.allSettled(o);const a=[],l=s.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const f=this.blockRequests.get(d);if(!f)throw new Error(`Block ${d} is not in the block requests`);a.push(f)}await Promise.allSettled(a)}if(t&&t.aborted)throw new as("Request was aborted");const c=s.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),u=c.filter(d=>!d);if(u.length)throw new VI(u,"Request failed");const h=new Map(jI(s,c));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await r)[i],l=o*this.blockSize,c=l-a.offset,u=Math.min(c+this.blockSize,a.data.byteLength),h=a.data.slice(c,u),d=new WI(l,h.byteLength,h,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let r=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(r.push(o),i=o):(s.push(new pp(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[o],i=o);return s.push(new pp(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(r=>{let i=r.offset+r.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(r.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(r.length),l=new Uint8Array(a);for(let c=s;c<=o;++c){const u=t.get(c),h=u.offset-r.offset,d=u.top-i;let f=0,p=0,g;h<0?f=-h:h>0&&(p=h),d<0?g=u.length-f:g=i-u.offset-f;const m=new Uint8Array(u.data,f,g);l.set(m,p)}return a})}}class nd{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class id{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class YI extends nd{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class HI extends id{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new YI(r)}}class qI extends nd{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class KI extends id{constructRequest(e,t){return new Promise((r,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;r(new qI(s,o))},s.onerror=i,s.onabort=()=>i(new as("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const pc={};class JI extends nd{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class QI extends id{constructor(e){super(e),this.parsedUrl=pc.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",pc)}constructRequest(e,t){return new Promise((r,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const c=[];o.on("data",u=>{c.push(u)}),o.on("end",()=>{const u=Buffer.concat(c).buffer;l(u)}),o.on("error",i)});r(new JI(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new as("Request aborted")),t.addEventListener("abort",()=>s.destroy(new as("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class sd extends rd{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(r=>this.fetchSlice(r,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(r.ok)if(r.status===206){const{type:i,params:s}=UI(r.getHeader("content-type"));if(i==="multipart/byteranges"){const h=BI(await r.getData(),s.boundary);return this._fileSize=h[0].fileSize||null,h}const o=await r.getData(),{start:a,end:l,total:c}=mu(r.getHeader("content-range"));this._fileSize=c||null;const u=[{data:o,offset:a,length:l-a}];if(e.length>1){const h=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return u.concat(h)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await r.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=mu(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:r,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function od(n,{blockSize:e,cacheSize:t}){return e===null?n:new ZI(n,{blockSize:e,cacheSize:t})}function eA(n,{headers:e={},credentials:t,maxRanges:r=0,allowFullFile:i=!1,...s}={}){const o=new HI(n,t),a=new sd(o,e,r,i);return od(a,s)}function tA(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new KI(n),o=new sd(s,e,t,r);return od(o,i)}function rA(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new QI(n),o=new sd(s,e,t,r);return od(o,i)}function yu(n,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?eA(n,t):typeof XMLHttpRequest<"u"?tA(n,t):rA(n,t)}class nA extends rd{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>r(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function iA(n){return new nA(n)}function _u(n){switch(n){case ce.BYTE:case ce.ASCII:case ce.SBYTE:case ce.UNDEFINED:return 1;case ce.SHORT:case ce.SSHORT:return 2;case ce.LONG:case ce.SLONG:case ce.FLOAT:case ce.IFD:return 4;case ce.RATIONAL:case ce.SRATIONAL:case ce.DOUBLE:case ce.LONG8:case ce.SLONG8:case ce.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function sA(n){const e=n.GeoKeyDirectory;if(!e)return null;const t={};for(let r=4;r<=e[3]*4;r+=4){const i=mI[e[r]],s=e[r+1]?Bs[e[r+1]]:null,o=e[r+2],a=e[r+3];let l=null;if(!s)l=a;else{if(l=n[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Mi(n,e,t,r){let i=null,s=null;const o=_u(e);switch(e){case ce.BYTE:case ce.ASCII:case ce.UNDEFINED:i=new Uint8Array(t),s=n.readUint8;break;case ce.SBYTE:i=new Int8Array(t),s=n.readInt8;break;case ce.SHORT:i=new Uint16Array(t),s=n.readUint16;break;case ce.SSHORT:i=new Int16Array(t),s=n.readInt16;break;case ce.LONG:case ce.IFD:i=new Uint32Array(t),s=n.readUint32;break;case ce.SLONG:i=new Int32Array(t),s=n.readInt32;break;case ce.LONG8:case ce.IFD8:i=new Array(t),s=n.readUint64;break;case ce.SLONG8:i=new Array(t),s=n.readInt64;break;case ce.RATIONAL:i=new Uint32Array(t*2),s=n.readUint32;break;case ce.SRATIONAL:i=new Int32Array(t*2),s=n.readInt32;break;case ce.FLOAT:i=new Float32Array(t),s=n.readFloat32;break;case ce.DOUBLE:i=new Float64Array(t),s=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ce.RATIONAL||e===ce.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(n,r+a*o),i[a+1]=s.call(n,r+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(n,r+a*o);return e===ce.ASCII?new TextDecoder("utf-8").decode(i):i}class oA{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class Ho extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class g_{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let c=l;const u=await this.getImageCount(),h=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[p,g]=l.getOrigin(),[m,y]=l.getResolution();a=[p+t[0]*m,g+t[1]*y,p+t[2]*m,g+t[3]*y]}const f=a||h;if(r){if(s)throw new Error("Both width and resX passed");s=(f[2]-f[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(f[3]-f[1])/i}}if(s||o){const f=[];for(let p=0;p<u;++p){const g=await this.getImage(p),{SubfileType:m,NewSubfileType:y}=g.fileDirectory;(p===0||m===2||y&1)&&f.push(g)}f.sort((p,g)=>p.getWidth()-g.getWidth());for(let p=0;p<f.length;++p){const g=f[p],m=(h[2]-h[0])/g.getWidth(),y=(h[3]-h[1])/g.getHeight();if(c=g,s&&s>m||o&&o>y)break}}let d=t;if(a){const[f,p]=l.getOrigin(),[g,m]=c.getResolution(l);d=[Math.round((a[0]-f)/g),Math.round((a[1]-p)/m),Math.round((a[2]-f)/g),Math.round((a[3]-p)/m)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return c.readRasters({...e,window:d})}}class ls extends g_{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new DI((await this.source.fetch([{offset:e,length:typeof t<"u"?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let h=0;h<s;l+=t,++h){const d=i.readUint16(l),f=i.readUint16(l+2),p=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let g,m;const y=_u(f),_=l+(this.bigTiff?12:8);if(y*p<=(this.bigTiff?8:4))g=Mi(i,f,p,_);else{const x=i.readOffset(_),E=_u(f)*p;if(i.covers(x,E))g=Mi(i,f,p,x);else{const b=await this.getSlice(x,E);g=Mi(b,f,p,x)}}p===1&&pI.indexOf(d)===-1&&!(f===ce.RATIONAL||f===ce.SRATIONAL)?m=g[0]:m=g,a[Bs[d]]=m}const c=sA(a),u=i.readOffset(e+r+t*s);return new oA(a,c,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Ho?new Ho(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Ho(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new d_(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(r instanceof Ho)t=!1;else throw r}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===Mi(i,ce.ASCII,t.length,e)){const o=Mi(i,ce.ASCII,r,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>r&&(i=await this.getSlice(e,a));const l=Mi(i,ce.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,u])=>{this.ghostValues[c]=u})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],s=new NI(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=c?s.getUint64(8,a):s.getUint32(4,a);return new ls(e,a,c,u,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class aA extends g_{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(r);return new d_(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,r)=>t+r,0),this.imageCount}}async function m_(n,e={},t){return ls.fromSource(yu(n,e),t)}async function y_(n,e){return ls.fromSource(iA(n),e)}async function __(n,e=[],t={},r){const i=await ls.fromSource(yu(n,t),r),s=await Promise.all(e.map(o=>ls.fromSource(yu(o,t))));return new aA(i,s)}const lA="https://stac-extensions.github.io/label/v1.*/schema.json",x_=new Vi({color:"rgba(0,0,0,0)"});function b_(n,e,t="rgba(255,255,255,0.4)",r=5){let i=x_;t&&(i=new Vi({color:t}));const s=new Fs({color:n,width:e});return new oi({image:new lm({fill:i,stroke:s,radius:r}),fill:i,stroke:s})}const cA=b_("#3399CC",3),gp=b_("#ff9933",2,null);function uA(n,e){const t={url:n.getAbsoluteUrl()};let r=n,i=n.getBands();i.length===1&&(r=i[0],i=[]);const{minimum:s,maximum:o}=r.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof o=="number"&&(t.max=o),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:c,maximum:u}=l.getMinMaxValues();typeof c=="number"&&(typeof t.min>"u"||c<t.min)&&(t.min=c),typeof u=="number"&&(typeof t.max>"u"||u>t.max)&&(t.max=u)}const a=r.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const c of i){const u=c.getNoDataValues();if(u.length>0){if(typeof l>"u")l=u[0];else if(l!==u[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=n.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function hA(n){try{const{fromProjectionCode:e,fromEPSGCode:t}=await Sn(async()=>{const{fromProjectionCode:r,fromEPSGCode:i}=await import("./proj4.C_WYg9Q4.js");return{fromProjectionCode:r,fromEPSGCode:i}},__vite__mapDeps([17,12,11,10]));return typeof e=="function"?await e(n):await t(n)}catch{return null}}async function mp(n,e=void 0){return void 0||e}function yp(n,e){const t=n.clone();return e.hasOnlyBounds()||t.setFill(x_),t}function dA(n){let e=n.href;if(e.includes("{s}"))if(Array.isArray(n["href:servers"])&&n["href:servers"].length>0){const t=Math.random()*n["href:servers"].length|0;e=e.replace("{s}",n["href:servers"][t])}else return null;return e}function _p(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"}function fA(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function pA(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=Gt;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const xp="STATISTICS_MAXIMUM",bp="STATISTICS_MINIMUM",gc=256;let mc;function gA(){return mc||(mc=new f_),mc}function mA(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function yA(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function _A(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}async function Ep(n,e,t,r){const i=n[e];if(i&&i!==32767){const s="EPSG:"+i;let o=$e(s);if(!o&&r&&(o=await hA(s)),!o){const a=EE(n[t]);a&&(o=new om({code:s,units:a}))}return o||null}}async function xA(n,e){const t=n.geoKeys;if(!t)return null;const r=await Ep(t,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",e);return r||await Ep(t,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",e)}function bA(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function EA(n,e){let t;return n.blob?t=y_(n.blob):n.overviews?t=__(n.url,n.overviews,e):t=m_(n.url,e),t.then(bA)}function Ms(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)Ms(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function TA(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function wA(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}let E_=class extends am{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=EA(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){return r.configure_(s)}).catch(function(s){cf(s),r.error_=s,r.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=await xA(i,this.loadMissingProjection_);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,c,u,h,d,f]=s,p=Yc(Yc([1/Math.sqrt(o*o+u*u),0,0,-1/Math.sqrt(a*a+h*h),c,f],[o,u,a,h,0,0]),[1,0,0,1,-c,-f]);this.transformMatrix=p,this.addAlpha_=!0;break}}}async configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),c=new Array(e.length);let u=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(S=>{fA(S)?_.push(S):y.push(S)});const x=y.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let E,b;const T=new Array(x),w=new Array(x),v=new Array(x);l[m]=new Array(x),c[m]=new Array(x);for(let S=0;S<x;++S){const C=y[S],P=C.getGDALNoData();c[m][S]=C.getGDALMetadata(0),l[m][S]=P;const A=this.sourceInfo_[m].bands;a[m]=A?A.length:C.getSamplesPerPixel();const N=x-(S+1);E||(E=mA(C)),b||(b=yA(C));const D=_A(C,y[0]);v[N]=D[0];const R=[C.getTileWidth(),C.getTileHeight()];R[0]!==R[1]&&R[1]<gc&&(R[0]=gc,R[1]=gc),T[N]=R;const M=D[0]/Math.abs(D[1]);w[N]=[R[0],R[1]/M]}if(t?Zn(t,E,t):t=E,!r)r=b;else{const S=`Origin mismatch for source ${m}, got [${b}] but expected [${r}]`;Ms(r,b,0,S,this.viewRejector)}if(!o)o=v,this.resolutionFactors_[m]=1;else{o.length-u>v.length&&(u=o.length-v.length);const S=o[o.length-1]/v[v.length-1];this.resolutionFactors_[m]=S;const C=v.map(A=>A*=S),P=`Resolution mismatch for source ${m}, got [${C}] but expected [${o}]`;Ms(o.slice(u,o.length),C,.02,P,this.viewRejector)}i?Ms(i.slice(u,i.length),w,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=w,s?Ms(s.slice(u,s.length),T,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=T,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=c;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let x=0;x<_.length;++x)if(y[_[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let m=0;m<h;++m)d+=a[m];this.bandCount=d;const f=new nh({extent:t,minZoom:u,origin:r,resolutions:o,tileSizes:i});this.tileGrid=f,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=qg(Tr(),this.transformMatrix.slice()),y=TE(_=>Tt(m,_));g=Bg(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:bE(qn(g),this.projection),extent:th(g,this.projection),zoom:p})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,c=this.sourceInfo_,u=gA();for(let h=0;h<o;++h){const d=c[h],f=this.resolutionFactors_[h],p=[Math.round(t*(s[0]*f)),Math.round(r*(s[1]*f)),Math.round((t+1)*(s[0]*f)),Math.round((r+1)*(s[1]*f))],g=this.sourceImagery_[h][e];let m;d.bands&&(m=d.bands.map(function(b){return b-1}));let y;"nodata"in d&&d.nodata!==null?y=d.nodata:m?y=m.map(function(b){return l[h][b]}):y=l[h];const _={window:p,width:s[0],height:s[1],samples:m,fillValue:y,pool:u,interleave:!1,signal:i.signal};pA(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const x=o+h,E=this.sourceMasks_[h][e];if(!E){a[x]=Promise.resolve(null);continue}a[x]=E.readRasters({window:p,width:s[0],height:s[1],samples:[0],pool:u,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw cf(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,c=this.normalize_,u=this.addAlpha_,h=e[0]*e[1],d=h*o;let f;c?f=new Uint8Array(d):f=new Float32Array(d);let p=0;for(let g=0;g<h;++g){let m=u;for(let y=0;y<s;++y){const _=i[y];let x=_.min,E=_.max,b,T;if(c){const w=r[y][0];x===void 0&&(w&&bp in w?x=parseFloat(w[bp]):x=TA(t[y][0])),E===void 0&&(w&&xp in w?E=parseFloat(w[xp]):E=wA(t[y][0])),b=255/(E-x),T=-x*b}for(let w=0;w<a[y];++w){const v=t[y][w][g];let S;if(c?S=jc(b*v+T,0,255):S=v,!u)f[p]=S;else{let C=_.nodata;if(C===void 0){let A;_.bands?A=_.bands[w]-1:A=w,C=l[y][A]}const P=isNaN(C);(!P&&v!==C||P&&!isNaN(v))&&(m=!1,f[p]=S)}p++}if(!m){const w=s+y,v=t[w];v&&!v[0][g]&&(m=!0)}}u&&(m||(f[p]=255),p++)}return f}};E_.prototype.getView;class Ze{constructor(e){this.name=e}toString(){return this.name}}Ze.GeoTIFF=new Ze("GeoTIFF");Ze.ImageStatic=new Ze("ImageStatic");Ze.PMTilesRaster=new Ze("PMTilesRaster");Ze.PMTilesVector=new Ze("PMTilesVector");Ze.TileJSON=new Ze("TileJSON");Ze.TileWMS=new Ze("TileWMS");Ze.WMTS=new Ze("WMTS");Ze.XYZ=new Ze("XYZ");class ad extends zg{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||cA,this.collectionStyle_=e.collectionStyle||gp,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(r=>this.configure_(r,e.url,e.children,e.assets,e.bands)).catch(r=>this.handleError_(r))}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return t==="json"?await r.json():t==="text"?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const r=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!r||ul(r)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new NP(e))}configure_(e,t=null,r=null,i=null,s=[]){let o;e instanceof Bo||e instanceof Rs?o=e:(o=zo(e,!this.disableMigration_),t&&t.includes("://")&&o.setAbsoluteUrl(t)),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(yp(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=u=>this.handleError_(u),c=[];r&&c.push(this.setChildren(r,null,!1).catch(l)),i&&c.push(this.setAssets(i,!1).catch(l)),Promise.all(c).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new ad(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(r)}async addPreviewImage_(e){const t=await mp(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(r.length!==1)return;const i=r[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:di(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(Ze.ImageStatic,s,e));const o=new Dh({source:new UC(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=dA(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new ro(r.url).getHeader();let l;switch(a.tileType){case Ui.Mvt:l=new OP(await i(Ze.PMTilesVector,r));break;case Ui.Avif:case Ui.Jpeg:case Ui.Png:case Ui.Webp:l=new up(await i(Ze.PMTilesRaster,r));break;default:return}s.push(l);break;case"tilejson":s.push(new kh(await i(Ze.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const h in e["wms:layers"]){const d=e["wms:layers"][h]||"";let f="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][h]=="string"&&(f=e["wms:styles"][h]);const p=Object.assign({LAYERS:d,STYLES:f},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(p.FORMAT=e.type);const g=await i(Ze.TileWMS,Object.assign({},r,{params:p}));s.push(new $C(g))}break;case"wmts":const c=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!c)return;let u=[];Array.isArray(e["wmts:layer"])?u=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(u=[e["wmts:layer"]]);for(const h of u){let d=Object.assign({},r,{layer:h,requestEncoding:e["wmts:encoding"]==="rest"?"REST":"KVP"});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await i(Ze.WMTS,d);const f=YC(c,d);if(f!==null){if(typeof e.uriTemplate=="string"){let p=e.uriTemplate;const g=Ql(e.variables)?e.variables:{};for(const m in g){const y=g[m];let _;if(_p(y.const)?_=y.const:_p(y.default)?_=y.default:Array.isArray(y.enum)&&y.enum.length>0&&(_=y.enum[0]),typeof _<"u")p=p.replaceAll(`{${m}}`,String(_));else continue}delete f.urls,f.url=p}s.push(new ZC(f))}}break;case"xyz":s.push(new uf(await i(Ze.XYZ,r)));break;default:return}return s.map(o=>{let a;return o instanceof Ao?a=new Ki({source:o,declutter:!0}):o instanceof up?a=new hf({source:o}):a=new Ga({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let r={sources:[uA(e,this.bands_)],convertToRGB:"auto",loadMissingProjection:!0};const i=await mp();i&&(r.projection=i),this.getSourceOptions_&&(r=await this.getSourceOptions_(Ze.GeoTIFF,r,e));const s=new E_(r),o=new Promise((a,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):a()})});try{await o;const a=new hf({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(Ze.XYZ,r,e));const i=new Ga({source:new uf(r)});return this.addLayer_(i,e),i}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=ME(t.getBoundingBox()):e=t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,yp(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const i=new ou,s=new ks({format:i,loader:(o,a,l)=>{e=OE(e);const c=i.readFeatures(e,{featureProjection:l});s.addFeatures(c)}});return t||(t=gp),new wl({source:s,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Pa))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),r;t.length>1&&(r=t.find(s=>s.roles.includes("labels-vector"))),r||(r=e.getAsset("vector_labels")),r||(t=e.getAssets().filter(s=>s.type===df&&!s.roles),t.length===1&&(r=t[0]));const i=e.getLinksWithRels(["source"]);if(r&&i.length>0){const s=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return zo(l)}catch(l){return this.handleError_(l),null}}),o=(await Promise.all(s)).filter(a=>a instanceof Rs);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(r)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const o=t.item(s);o.get("stac")&&!o.get("bounds")&&t.removeAt(s)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async o=>await this.addLayerForLink(o));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const s=i.map(async o=>{if(o){if(o.type===df)return await this.addGeoJson_(o);if(o.isGeoTIFF())return await this.addGeoTiff_(o);if(o.canBrowserDisplayImage())return await this.addPreviewImage_(o)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(r instanceof sh)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof Rs){if(r.isItem()&&r.supportsExtension(lA)&&r.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const o=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(o&&this.displayOverview_&&(a=await this.addGeoTiff_(o)),this.displayPreview_&&(!o||!a)){const l=r.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(r=>r!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof Bo)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=r.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):r.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const r=this.getData();this.assets_=e.map(i=>r instanceof Rs&&typeof i=="string"?r.getAsset(i):i instanceof Bo?i:new Bo(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof fm?this.children_=e.getAll():e instanceof dm?this.children_=e.getAll():Ql(e)&&e.type==="FeatureCollection"?this.children_=zo(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof Rs?i:zo(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&Ql(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const i=this.getChildren();if(i){const s=i.map(o=>o.getBoundingBox());t=ih(s)}if(t)return di(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const r=t.getMetadata("attribution");r&&r.push(r)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const r=new URL(e);t!=="rest"&&(r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities"));const i=await this.fetch_(r.toString(),"text");return new OR().read(i)}catch{return null}}}var SA=8,vA={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},RA={"*":{type:"source"}},CA=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],PA={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},IA={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},AA={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},LA={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},FA={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},MA={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},OA={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},NA=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],DA={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},GA={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},kA={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},UA={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},BA={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},zA={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$A={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jA={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},XA={type:"array",value:"*"},VA={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},WA={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},ZA={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},YA={type:"array",value:"*",minimum:1},HA={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},qA={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},KA={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},JA={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},QA=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],eL={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},tL={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},rL={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},nL={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},iL={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},sL={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},oL={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},aL={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},lL={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},cL={"*":{type:"string"}},uL={$version:SA,$root:vA,sources:RA,source:CA,source_vector:PA,source_raster:IA,source_raster_dem:AA,source_geojson:LA,source_video:FA,source_image:MA,layer:OA,layout:NA,layout_background:DA,layout_fill:GA,layout_circle:kA,layout_heatmap:UA,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:BA,layout_symbol:zA,layout_raster:$A,layout_hillshade:jA,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:XA,filter_operator:VA,geometry_type:WA,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:ZA,expression:YA,light:HA,sky:qA,terrain:KA,projection:JA,paint:QA,paint_fill:eL,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:tL,paint_circle:rL,paint_heatmap:nL,paint_symbol:iL,paint_raster:sL,paint_hillshade:oL,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:aL,transition:lL,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:cL};const hL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dL(n,e){const t={};for(const r in n)r!=="ref"&&(t[r]=n[r]);return hL.forEach(r=>{r in e&&(t[r]=e[r])}),t}function T_(n){n=n.slice();const e=Object.create(null);for(let t=0;t<n.length;t++)e[n[t].id]=n[t];for(let t=0;t<n.length;t++)"ref"in n[t]&&(n[t]=dL(n[t],e[n[t].ref]));return n}class jr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ld{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,i]of t)this.bindings[r]=i}concat(e){return new ld(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const Cl={kind:"null"},j={kind:"number"},ue={kind:"string"},ae={kind:"boolean"},Zr={kind:"color"},Pl={kind:"projectionDefinition"},fi={kind:"object"},ie={kind:"value"},fL={kind:"error"},Il={kind:"collator"},Al={kind:"formatted"},Ll={kind:"padding"},io={kind:"colorArray"},Fl={kind:"numberArray"},Mo={kind:"resolvedImage"},Ml={kind:"variableAnchorOffsetCollection"};function nr(n,e){return{kind:"array",itemType:n,N:e}}function et(n){if(n.kind==="array"){const e=et(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const pL=[Cl,j,ue,ae,Zr,Pl,Al,fi,nr(ie),Ll,Fl,io,Mo,Ml];function so(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!so(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of pL)if(!so(t,e))return null}}return`Expected ${et(n)} but found ${et(e)} instead.`}function cd(n,e){return e.some(t=>t.kind===n.kind)}function pi(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}function An(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const w_=.96422,S_=1,v_=.82521,R_=4/29,Qi=6/29,C_=3*Qi*Qi,gL=Qi*Qi*Qi,mL=Math.PI/180,yL=180/Math.PI;function P_(n){return n=n%360,n<0&&(n+=360),n}function I_([n,e,t,r]){n=yc(n),e=yc(e),t=yc(t);let i,s;const o=_c((.2225045*n+.7168786*e+.0606169*t)/S_);n===e&&e===t?i=s=o:(i=_c((.4360747*n+.3850649*e+.1430804*t)/w_),s=_c((.0139322*n+.0971045*e+.7141733*t)/v_));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),r]}function yc(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function _c(n){return n>gL?Math.pow(n,1/3):n/C_+R_}function A_([n,e,t,r]){let i=(n+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=S_*bc(i),s=w_*bc(s),o=v_*bc(o),[xc(3.1338561*s-1.6168667*i-.4906146*o),xc(-.9787684*s+1.9161415*i+.033454*o),xc(.0719453*s-.2289914*i+1.4052427*o),r]}function xc(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function bc(n){return n>Qi?n*n*n:C_*(n-R_)}function _L(n){const[e,t,r,i]=I_(n),s=Math.sqrt(t*t+r*r);return[Math.round(s*1e4)?P_(Math.atan2(r,t)*yL):NaN,s,e,i]}function xL([n,e,t,r]){return n=isNaN(n)?0:n*mL,A_([t,Math.cos(n)*e,Math.sin(n)*e,r])}function bL([n,e,t,r]){n=P_(n),e/=100,t/=100;function i(s){const o=(s+n/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),r]}const EL=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function L_(n,e){return EL(n,e)?n[e]:void 0}function TL(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const e=L_(wL,n);if(e){const[i,s,o]=e;return[i/255,s/255,o/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const s=n.length<6?1:2;let o=1;return[qo(n.slice(o,o+=s)),qo(n.slice(o,o+=s)),qo(n.slice(o,o+=s)),qo(n.slice(o,o+s)||"ff")]}if(n.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=n.match(i);if(s){const[o,a,l,c,u,h,d,f,p,g,m,y]=s,_=[c||" ",d||" ",g].join("");if(_==="  "||_==="  /"||_===",,"||_===",,,"){const x=[l,h,p].join(""),E=x==="%%%"?100:x===""?255:0;if(E){const b=[Bi(+a/E,0,1),Bi(+u/E,0,1),Bi(+f/E,0,1),m?Tp(+m,y):1];if(wp(b))return b}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=n.match(t);if(r){const[i,s,o,a,l,c,u,h,d]=r,f=[o||" ",l||" ",u].join("");if(f==="  "||f==="  /"||f===",,"||f===",,,"){const p=[+s,Bi(+a,0,100),Bi(+c,0,100),h?Tp(+h,d):1];if(wp(p))return bL(p)}}}function qo(n){return parseInt(n.padEnd(2,n),16)/255}function Tp(n,e){return Bi(e?n/100:n,0,1)}function Bi(n,e,t){return Math.min(Math.max(e,n),t)}function wp(n){return!n.some(Number.isNaN)}const wL={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function gi(n,e,t){return n+t*(e-n)}function oo(n,e,t){return n.map((r,i)=>gi(r,e[i],t))}class Ne{constructor(e,t,r,i=1,s=!0){this.r=e,this.g=t,this.b=r,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,r,i]))}static parse(e){if(e instanceof Ne)return e;if(typeof e!="string")return;const t=TL(e);if(t)return new Ne(...t,!1)}get rgb(){const{r:e,g:t,b:r,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,r/s,i])}get hcl(){return this.overwriteGetter("hcl",_L(this.rgb))}get lab(){return this.overwriteGetter("lab",I_(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,i]=this.rgb;return`rgba(${[e,t,r].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(e,t,r,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=oo(e.rgb,t.rgb,r);return new Ne(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=e.hcl,[c,u,h,d]=t.hcl;let f,p;if(!isNaN(s)&&!isNaN(c)){let x=c-s;c>s&&x>180?x-=360:c<s&&s-c>180&&(x+=360),f=s+r*x}else isNaN(s)?isNaN(c)?f=NaN:(f=c,(a===1||a===0)&&(p=u)):(f=s,(h===1||h===0)&&(p=o));const[g,m,y,_]=xL([f,p??gi(o,u,r),gi(a,h,r),gi(l,d,r)]);return new Ne(g,m,y,_,!1)}case"lab":{const[s,o,a,l]=A_(oo(e.lab,t.lab,r));return new Ne(s,o,a,l,!1)}}}}Ne.black=new Ne(0,0,0,1);Ne.white=new Ne(1,1,1,1);Ne.transparent=new Ne(0,0,0,0);Ne.red=new Ne(1,0,0,1);class ud{constructor(e,t,r){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const SL=["bottom","center","top"];class xu{constructor(e,t,r,i,s,o){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=s,this.verticalAlign=o}}class xn{constructor(e){this.sections=e}static fromString(e){return new xn([new xu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof xn?e:xn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Pr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Pr)return e;if(typeof e=="number")return new Pr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Pr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new Pr(oo(e.values,t.values,r))}}class Ir{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ir)return e;if(typeof e=="number")return new Ir([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new Ir(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new Ir(oo(e.values,t.values,r))}}class ir{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ir)return e;if(typeof e=="string"){const r=Ne.parse(e);return r?new ir([r]):void 0}if(!Array.isArray(e))return;const t=[];for(const r of e){if(typeof r!="string")return;const i=Ne.parse(r);if(!i)return;t.push(i)}return new ir(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r,i="rgb"){const s=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)s.push(Ne.interpolate(e.values[o],t.values[o],r,i));return new ir(s)}}class nt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const vL=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Yr)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const r=e[t],i=e[t+1];if(typeof r!="string"||!vL.has(r)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new Yr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){const i=e.values,s=t.values;if(i.length!==s.length)throw new nt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new nt(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,c]=i[a+1],[u,h]=s[a+1];o.push([gi(l,u,r),gi(c,h,r)])}return new Yr(o)}}class Jn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Jn({name:e,available:!1}):null}}class vr{constructor(e,t,r){this.from=e,this.to=t,this.transition=r}static interpolate(e,t,r){return new vr(e,t,r)}static parse(e){if(e instanceof vr)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new vr(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new vr(e.from,e.to,e.transition);if(typeof e=="string")return new vr(e,e,1)}}function F_(n,e,t,r){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[n,e,t,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[n,e,t,r]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ao(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof vr||n instanceof Ne||n instanceof ud||n instanceof xn||n instanceof Pr||n instanceof Ir||n instanceof ir||n instanceof Yr||n instanceof Jn)return!0;if(Array.isArray(n)){for(const e of n)if(!ao(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!ao(n[e]))return!1;return!0}else return!1}function gt(n){if(n===null)return Cl;if(typeof n=="string")return ue;if(typeof n=="boolean")return ae;if(typeof n=="number")return j;if(n instanceof Ne)return Zr;if(n instanceof vr)return Pl;if(n instanceof ud)return Il;if(n instanceof xn)return Al;if(n instanceof Pr)return Ll;if(n instanceof Ir)return Fl;if(n instanceof ir)return io;if(n instanceof Yr)return Ml;if(n instanceof Jn)return Mo;if(Array.isArray(n)){const e=n.length;let t;for(const r of n){const i=gt(r);if(!t)t=i;else{if(t===i)continue;t=ie;break}}return nr(t||ie,e)}else return fi}function zs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ne||n instanceof vr||n instanceof xn||n instanceof Pr||n instanceof Ir||n instanceof ir||n instanceof Yr||n instanceof Jn?n.toString():JSON.stringify(n)}class cs{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ao(e[1]))return t.error("invalid value");const r=e[1];let i=gt(r);const s=t.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new cs(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ko={string:ue,number:j,boolean:ae,object:fi};class Rr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=1,i;const s=e[0];if(s==="array"){let a;if(e.length>2){const c=e[1];if(typeof c!="string"||!(c in Ko)||c==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=Ko[c],r++}else a=ie;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],r++}i=nr(a,l)}else{if(!Ko[s])throw new Error(`Types doesn't contain name = ${s}`);i=Ko[s]}const o=[];for(;r<e.length;r++){const a=t.parse(e[r],r,ie);if(!a)return null;o.push(a)}return new Rr(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(so(this.type,gt(r))){if(t===this.args.length-1)throw new nt(`Expected value to be of type ${et(this.type)}, but found ${et(gt(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Sp={"to-boolean":ae,"to-color":Zr,"to-number":j,"to-string":ue};class Un{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(!Sp[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Sp[r],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,ie);if(!a)return null;s.push(a)}return new Un(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,r;for(const i of this.args){if(t=i.evaluate(e),r=null,t instanceof Ne)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?r=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:r=F_(t[0],t[1],t[2],t[3]),!r))return new Ne(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new nt(r||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const r of this.args){t=r.evaluate(e);const i=Pr.parse(t);if(i)return i}throw new nt(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=Ir.parse(t);if(i)return i}throw new nt(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=ir.parse(t);if(i)return i}throw new nt(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const r of this.args){t=r.evaluate(e);const i=Yr.parse(t);if(i)return i}throw new nt(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const r of this.args){if(t=r.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new nt(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return xn.fromString(zs(this.args[0].evaluate(e)));case"resolvedImage":return Jn.fromString(zs(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return zs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const RL=["Unknown","Point","LineString","Polygon"];class M_{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?RL[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Ne.parse(e),this._parseColorCache.set(e,t)),t}}class Ol{constructor(e,t,r=[],i,s=new ld,o=[]){this.registry=e,this.path=r,this.key=r.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,r,i,s={}){return t?this.concat(t,r,i)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(i,s,o){return o==="assert"?new Rr(s,[i]):o==="coerce"?new Un(s,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=r(o,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=r(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof cs)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new M_;try{o=new cs(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const i=typeof e=="number"?this.path.concat(e):this.path,s=r?this.scope.concat(r):this.scope;return new Ol(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const r=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new jr(r,e))}checkSubtype(e,t){const r=so(e,t);return r&&this.error(r),r}}class Nl{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;r.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return i?new Nl(r,i):null}outputDefined(){return this.result.outputDefined()}}class Dl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Dl(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class hd{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,j),i=t.parse(e[2],2,nr(t.expectedType||ie));if(!r||!i)return null;const s=i.type;return new hd(s.itemType,r,i)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new nt(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new nt(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new nt(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class dd{constructor(e,t){this.type=ae,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,ie),i=t.parse(e[2],2,ie);return!r||!i?null:cd(r.type,[ae,ue,j,Cl,ie])?new dd(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${et(r.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!pi(t,["boolean","string","number","null"]))throw new nt(`Expected first argument to be of type boolean, string, number or null, but found ${et(gt(t))} instead.`);if(!pi(r,["string","array"]))throw new nt(`Expected second argument to be of type array or string, but found ${et(gt(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class $a{constructor(e,t,r){this.type=j,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,ie),i=t.parse(e[2],2,ie);if(!r||!i)return null;if(!cd(r.type,[ae,ue,j,Cl,ie]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${et(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,j);return s?new $a(r,i,s):null}else return new $a(r,i)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!pi(t,["boolean","string","number","null"]))throw new nt(`Expected first argument to be of type boolean, string, number or null, but found ${et(gt(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),pi(r,["string"])){const s=r.indexOf(t,i);return s===-1?-1:[...r.slice(0,s)].length}else{if(pi(r,["array"]))return r.indexOf(t,i);throw new nt(`Expected second argument to be of type array or string, but found ${et(gt(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class fd{constructor(e,t,r,i,s,o){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let r,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let c=2;c<e.length-1;c+=2){let u=e[c];const h=e[c+1];Array.isArray(u)||(u=[u]);const d=t.concat(c);if(u.length===0)return d.error("Expected at least one branch label.");for(const p of u){if(typeof p!="number"&&typeof p!="string")return d.error("Branch labels must be numbers or strings.");if(typeof p=="number"&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof p=="number"&&Math.floor(p)!==p)return d.error("Numeric branch labels must be integer values.");if(!r)r=gt(p);else if(d.checkSubtype(r,gt(p)))return null;if(typeof s[String(p)]<"u")return d.error("Branch labels must be unique.");s[String(p)]=o.length}const f=t.parse(h,c,i);if(!f)return null;i=i||f.type,o.push(f)}const a=t.parse(e[1],1,ie);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(r,a.type)?null:new fd(r,i,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(gt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class pd{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,ae);if(!a)return null;const l=t.parse(e[o+1],o+1,r);if(!l)return null;i.push([a,l]),r=r||l.type}const s=t.parse(e[e.length-1],e.length-1,r);if(!s)return null;if(!r)throw new Error("Can't infer output type");return new pd(r,i,s)}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class ja{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,ie),i=t.parse(e[2],2,j);if(!r||!i)return null;if(!cd(r.type,[nr(ie),ue,ie]))return t.error(`Expected first argument to be of type array or string, but found ${et(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,j);return s?new ja(r.type,r,i,s):null}else return new ja(r.type,r,i)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),pi(t,["string"]))return[...t].slice(r,i).join("");if(pi(t,["array"]))return t.slice(r,i);throw new nt(`Expected first argument to be of type array or string, but found ${et(gt(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function O_(n,e){const t=n.length-1;let r=0,i=t,s=0,o,a;for(;r<=i;)if(s=Math.floor((r+i)/2),o=n[s],a=n[s+1],o<=e){if(s===t||e<a)return s;r=s+1}else if(o>e)i=s-1;else throw new nt("Input is not a number.");return 0}class Gl{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of r)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,j);if(!r)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],c=o,u=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',c);const h=t.parse(l,u,s);if(!h)return null;s=s||h.type,i.push([a,h])}return new Gl(s,r,i)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=O_(t,i);return r[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function CL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ec,vp;function PL(){if(vp)return Ec;vp=1,Ec=n;function n(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var s=this.sampleCurveX(r)-e;if(Math.abs(s)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r=r-s/o}var a=0,l=1;for(r=e,i=0;i<20&&(s=this.sampleCurveX(r),!(Math.abs(s-e)<t));i++)e>s?a=r:l=r,r=(l-a)*.5+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},Ec}var IL=PL(),AL=CL(IL);class Hr{constructor(e,t,r,i,s){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,r,i){let s=0;if(e.name==="exponential")s=Tc(t,e.base,r,i);else if(e.name==="linear")s=Tc(t,1,r,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new AL(o[0],o[1],o[2],o[3]).solve(Tc(t,1,r,i))}return s}static parse(e,t){let[r,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const c=i[1];if(typeof c!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:c}}else if(i[0]==="cubic-bezier"){const c=i.slice(1);if(c.length!==4||c.some(u=>typeof u!="number"||u<0||u>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:c}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,j),!s)return null;const a=[];let l=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&t.expectedType!=io?l=Zr:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let c=0;c<o.length;c+=2){const u=o[c],h=o[c+1],d=c+3,f=c+4;if(typeof u!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(a.length&&a[a.length-1][0]>=u)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const p=t.parse(h,f,l);if(!p)return null;l=l||p.type,a.push([u,p])}return!An(l,j)&&!An(l,Pl)&&!An(l,Zr)&&!An(l,Ll)&&!An(l,Fl)&&!An(l,io)&&!An(l,Ml)&&!An(l,nr(j))?t.error(`Type ${et(l)} is not interpolatable.`):new Hr(l,r,i,s,a)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=O_(t,i),a=t[o],l=t[o+1],c=Hr.interpolationFactor(this.interpolation,i,a,l),u=r[o].evaluate(e),h=r[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return gi(u,h,c);case"color":return Ne.interpolate(u,h,c);case"padding":return Pr.interpolate(u,h,c);case"colorArray":return ir.interpolate(u,h,c);case"numberArray":return Ir.interpolate(u,h,c);case"variableAnchorOffsetCollection":return Yr.interpolate(u,h,c);case"array":return oo(u,h,c);case"projectionDefinition":return vr.interpolate(u,h,c)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ne.interpolate(u,h,c,"hcl");case"colorArray":return ir.interpolate(u,h,c,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ne.interpolate(u,h,c,"lab");case"colorArray":return ir.interpolate(u,h,c,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Tc(n,e,t,r){const i=r-t,s=n-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class lo{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=null;const i=t.expectedType;i&&i.kind!=="value"&&(r=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,s.push(l)}if(!r)throw new Error("No output type");return i&&s.some(a=>so(i,a.type))?new lo(ie,s):new lo(r,s)}evaluate(e){let t=null,r=0,i;for(const s of this.args)if(r++,t=s.evaluate(e),t&&t instanceof Jn&&!t.available&&(i||(i=t.name),t=null,r===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Rp(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function LL(n,e,t){return e===t}function FL(n,e,t){return e!==t}function ML(n,e,t){return e<t}function OL(n,e,t){return e>t}function NL(n,e,t){return e<=t}function DL(n,e,t){return e>=t}function N_(n,e,t,r){return r.compare(e,t)===0}function GL(n,e,t,r){return!N_(n,e,t,r)}function kL(n,e,t,r){return r.compare(e,t)<0}function UL(n,e,t,r){return r.compare(e,t)>0}function BL(n,e,t,r){return r.compare(e,t)<=0}function zL(n,e,t,r){return r.compare(e,t)>=0}function ws(n,e,t){const r=n!=="=="&&n!=="!=";return class D_{constructor(s,o,a){this.type=ae,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,ie);if(!l)return null;if(!Rp(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${et(l.type)}'.`);let c=o.parse(s[2],2,ie);if(!c)return null;if(!Rp(a,c.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${et(c.type)}'.`);if(l.type.kind!==c.type.kind&&l.type.kind!=="value"&&c.type.kind!=="value")return o.error(`Cannot compare types '${et(l.type)}' and '${et(c.type)}'.`);r&&(l.type.kind==="value"&&c.type.kind!=="value"?l=new Rr(c.type,[l]):l.type.kind!=="value"&&c.type.kind==="value"&&(c=new Rr(l.type,[c])));let u=null;if(s.length===4){if(l.type.kind!=="string"&&c.type.kind!=="string"&&l.type.kind!=="value"&&c.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(u=o.parse(s[3],3,Il),!u)return null}return new D_(l,c,u)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const l=gt(o),c=gt(a);if(l.kind!==c.kind||!(l.kind==="string"||l.kind==="number"))throw new nt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${c.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=gt(o),c=gt(a);if(l.kind!=="string"||c.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const $L=ws("==",LL,N_),jL=ws("!=",FL,GL),XL=ws("<",ML,kL),VL=ws(">",OL,UL),WL=ws("<=",NL,BL),ZL=ws(">=",DL,zL);class kl{constructor(e,t,r){this.type=Il,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");const i=t.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,ae);if(!i)return null;const s=t.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,ae);if(!s)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,ue),!o)?null:new kl(i,s,o)}evaluate(e){return new ud(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class gd{constructor(e,t,r,i,s){this.type=ue,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const r=t.parse(e[1],1,j);if(!r)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,ue),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,ue),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,j),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,j),!l)?null:new gd(r,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class md{constructor(e){this.type=Al,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,j),!l))return null;let c=null;if(a["text-font"]&&(c=t.parse(a["text-font"],1,nr(ue)),!c))return null;let u=null;if(a["text-color"]&&(u=t.parse(a["text-color"],1,Zr),!u))return null;let h=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!SL.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(h=t.parse(a["vertical-align"],1,ue),!h)return null}const d=i[i.length-1];d.scale=l,d.font=c,d.textColor=u,d.verticalAlign=h}else{const l=t.parse(e[o],1,ie);if(!l)return null;const c=l.type.kind;if(c!=="string"&&c!=="value"&&c!=="null"&&c!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new md(i)}evaluate(e){const t=r=>{const i=r.content.evaluate(e);return gt(i)===Mo?new xu("",i,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new xu(zs(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)};return new xn(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class yd{constructor(e){this.type=Mo,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const r=t.parse(e[1],1,ue);return r?new yd(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Jn.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class _d{constructor(e){this.type=j,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${et(r.type)} instead.`):new _d(r):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new nt(`Expected value to be of type string or array, but found ${et(gt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const qr=8192;function YL(n,e){const t=HL(n[0]),r=KL(n[1]),i=Math.pow(2,e.z);return[Math.round(t*i*qr),Math.round(r*i*qr)]}function xd(n,e){const t=Math.pow(2,e.z),r=(n[0]/qr+e.x)/t,i=(n[1]/qr+e.y)/t;return[qL(r),JL(i)]}function HL(n){return(180+n)/360}function qL(n){return n*360-180}function KL(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function JL(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function Oo(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function co(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function QL(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function e2(n,e,t){const r=n[0]-e[0],i=n[1]-e[1],s=n[0]-t[0],o=n[1]-t[1];return r*o-s*i===0&&r*s<=0&&i*o<=0}function Ul(n,e,t,r){const i=[e[0]-n[0],e[1]-n[1]],s=[r[0]-t[0],r[1]-t[1]];return i2(s,i)===0?!1:!!(Cp(n,e,t,r)&&Cp(t,r,n,e))}function t2(n,e,t){for(const r of t)for(let i=0;i<r.length-1;++i)if(Ul(n,e,r[i],r[i+1]))return!0;return!1}function Ss(n,e,t=!1){let r=!1;for(const i of e)for(let s=0;s<i.length-1;s++){if(e2(n,i[s],i[s+1]))return t;QL(n,i[s],i[s+1])&&(r=!r)}return r}function r2(n,e){for(const t of e)if(Ss(n,t))return!0;return!1}function G_(n,e){for(const t of n)if(!Ss(t,e))return!1;for(let t=0;t<n.length-1;++t)if(t2(n[t],n[t+1],e))return!1;return!0}function n2(n,e){for(const t of e)if(G_(n,t))return!0;return!1}function i2(n,e){return n[0]*e[1]-n[1]*e[0]}function Cp(n,e,t,r){const i=n[0]-t[0],s=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=r[0]-t[0],c=r[1]-t[1],u=i*c-l*s,h=o*c-l*a;return u>0&&h<0||u<0&&h>0}function bd(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=[];for(let o=0;o<n[i].length;o++){const a=YL(n[i][o],t);Oo(e,a),s.push(a)}r.push(s)}return r}function k_(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=bd(n[i],e,t);r.push(s)}return r}function U_(n,e,t,r){if(n[0]<t[0]||n[0]>t[2]){const i=r*.5;let s=n[0]-t[0]>i?-r:t[0]-n[0]>i?r:0;s===0&&(s=n[0]-t[2]>i?-r:t[2]-n[0]>i?r:0),n[0]+=s}Oo(e,n)}function s2(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function Pp(n,e,t,r){const i=Math.pow(2,r.z)*qr,s=[r.x*qr,r.y*qr],o=[];for(const a of n)for(const l of a){const c=[l.x+s[0],l.y+s[1]];U_(c,e,t,i),o.push(c)}return o}function Ip(n,e,t,r){const i=Math.pow(2,r.z)*qr,s=[r.x*qr,r.y*qr],o=[];for(const a of n){const l=[];for(const c of a){const u=[c.x+s[0],c.y+s[1]];Oo(e,u),l.push(u)}o.push(l)}if(e[2]-e[0]<=i/2){s2(e);for(const a of o)for(const l of a)U_(l,e,t,i)}return o}function o2(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=bd(e.coordinates,r,i),o=Pp(n.geometry(),t,r,i);if(!co(t,r))return!1;for(const a of o)if(!Ss(a,s))return!1}if(e.type==="MultiPolygon"){const s=k_(e.coordinates,r,i),o=Pp(n.geometry(),t,r,i);if(!co(t,r))return!1;for(const a of o)if(!r2(a,s))return!1}return!0}function a2(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=bd(e.coordinates,r,i),o=Ip(n.geometry(),t,r,i);if(!co(t,r))return!1;for(const a of o)if(!G_(a,s))return!1}if(e.type==="MultiPolygon"){const s=k_(e.coordinates,r,i),o=Ip(n.geometry(),t,r,i);if(!co(t,r))return!1;for(const a of o)if(!n2(a,s))return!1}return!0}class mi{constructor(e,t){this.type=ae,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ao(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const i=[];for(const s of r.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new mi(r,s)}}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new mi(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new mi(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return o2(e,this.geometries);if(e.geometryType()==="LineString")return a2(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class B_{constructor(e=[],t=(r,i)=>r<i?-1:r>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(r(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=(e<<1)+1;const a=o+1;if(a<this.length&&r(t[a],t[o])<0&&(o=a),r(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function l2(n,e){if(n.length<=1)return[n];const r=[];let i,s;for(const o of n){const a=c2(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&r.push(i),i=[o]):i.push(o))}return i&&r.push(i),r}function c2(n){let e=0;for(let t=0,r=n.length,i=r-1,s,o;t<r;i=t++)s=n[t],o=n[i],e+=(o.x-s.x)*(s.y+o.y);return e}const u2=6378.137,Ap=1/298.257223563,Lp=Ap*(2-Ap),Fp=Math.PI/180;class Ed{constructor(e){const t=Fp*u2*1e3,r=Math.cos(e*Fp),i=1/(1-Lp*(1-r*r)),s=Math.sqrt(i);this.kx=t*s*r,this.ky=t*s*i*(1-Lp)}distance(e,t){const r=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+i*i)}pointOnLine(e,t){let r=1/0,i,s,o,a;for(let l=0;l<e.length-1;l++){let c=e[l][0],u=e[l][1],h=this.wrap(e[l+1][0]-c)*this.kx,d=(e[l+1][1]-u)*this.ky,f=0;(h!==0||d!==0)&&(f=(this.wrap(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d),f>1?(c=e[l+1][0],u=e[l+1][1]):f>0&&(c+=h/this.kx*f,u+=d/this.ky*f)),h=this.wrap(t[0]-c)*this.kx,d=(t[1]-u)*this.ky;const p=h*h+d*d;p<r&&(r=p,i=c,s=u,o=l,a=f)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const bu=100,Eu=50;function z_(n,e){return e[0]-n[0]}function Xa(n){return n[1]-n[0]+1}function Tn(n,e){return n[1]>=n[0]&&n[1]<e}function Tu(n,e){if(n[0]>n[1])return[null,null];const t=Xa(n);if(e){if(t===2)return[n,null];const i=Math.floor(t/2);return[[n[0],n[0]+i],[n[0]+i,n[1]]]}if(t===1)return[n,null];const r=Math.floor(t/2)-1;return[[n[0],n[0]+r],[n[0]+r+1,n[1]]]}function wu(n,e){if(!Tn(e,n.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)Oo(t,n[r]);return t}function Su(n){const e=[1/0,1/0,-1/0,-1/0];for(const t of n)for(const r of t)Oo(e,r);return e}function Mp(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Td(n,e,t){if(!Mp(n)||!Mp(e))return NaN;let r=0,i=0;return n[2]<e[0]&&(r=e[0]-n[2]),n[0]>e[2]&&(r=n[0]-e[2]),n[1]>e[3]&&(i=n[1]-e[3]),n[3]<e[1]&&(i=e[1]-n[3]),t.distance([0,0],[r,i])}function hi(n,e,t){const r=t.pointOnLine(e,n);return t.distance(n,r.point)}function wd(n,e,t,r,i){const s=Math.min(hi(n,[t,r],i),hi(e,[t,r],i)),o=Math.min(hi(t,[n,e],i),hi(r,[n,e],i));return Math.min(s,o)}function h2(n,e,t,r,i){if(!(Tn(e,n.length)&&Tn(r,t.length)))return 1/0;let o=1/0;for(let a=e[0];a<e[1];++a){const l=n[a],c=n[a+1];for(let u=r[0];u<r[1];++u){const h=t[u],d=t[u+1];if(Ul(l,c,h,d))return 0;o=Math.min(o,wd(l,c,h,d,i))}}return o}function d2(n,e,t,r,i){if(!(Tn(e,n.length)&&Tn(r,t.length)))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let l=r[0];l<=r[1];++l)if(o=Math.min(o,i.distance(n[a],t[l])),o===0)return o;return o}function f2(n,e,t){if(Ss(n,e,!0))return 0;let r=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(r=Math.min(r,hi(n,[o,s],t)),r===0))return r;const a=t.pointOnLine(i,n);if(r=Math.min(r,t.distance(n,a.point)),r===0)return r}return r}function p2(n,e,t,r){if(!Tn(e,n.length))return NaN;for(let s=e[0];s<=e[1];++s)if(Ss(n[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=n[s],a=n[s+1];for(const l of t)for(let c=0,u=l.length,h=u-1;c<u;h=c++){const d=l[h],f=l[c];if(Ul(o,a,d,f))return 0;i=Math.min(i,wd(o,a,d,f,r))}}return i}function Op(n,e){for(const t of n)for(const r of t)if(Ss(r,e,!0))return!0;return!1}function g2(n,e,t,r=1/0){const i=Su(n),s=Su(e);if(r!==1/0&&Td(i,s,t)>=r)return r;if(co(i,s)){if(Op(n,e))return 0}else if(Op(e,n))return 0;let o=1/0;for(const a of n)for(let l=0,c=a.length,u=c-1;l<c;u=l++){const h=a[u],d=a[l];for(const f of e)for(let p=0,g=f.length,m=g-1;p<g;m=p++){const y=f[m],_=f[p];if(Ul(h,d,y,_))return 0;o=Math.min(o,wd(h,d,y,_,t))}}return o}function Np(n,e,t,r,i,s){if(!s)return;const o=Td(wu(r,s),i,t);o<e&&n.push([o,s,[0,0]])}function Jo(n,e,t,r,i,s,o){if(!s||!o)return;const a=Td(wu(r,s),wu(i,o),t);a<e&&n.push([a,s,o])}function Va(n,e,t,r,i=1/0){let s=Math.min(r.distance(n[0],t[0][0]),i);if(s===0)return s;const o=new B_([[0,[0,n.length-1],[0,0]]],z_),a=Su(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const c=l[1],u=e?Eu:bu;if(Xa(c)<=u){if(!Tn(c,n.length))return NaN;if(e){const h=p2(n,c,t,r);if(isNaN(h)||h===0)return h;s=Math.min(s,h)}else for(let h=c[0];h<=c[1];++h){const d=f2(n[h],t,r);if(s=Math.min(s,d),s===0)return 0}}else{const h=Tu(c,e);Np(o,s,r,n,a,h[0]),Np(o,s,r,n,a,h[1])}}return s}function Wa(n,e,t,r,i,s=1/0){let o=Math.min(s,i.distance(n[0],t[0]));if(o===0)return o;const a=new B_([[0,[0,n.length-1],[0,t.length-1]]],z_);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const c=l[1],u=l[2],h=e?Eu:bu,d=r?Eu:bu;if(Xa(c)<=h&&Xa(u)<=d){if(!Tn(c,n.length)&&Tn(u,t.length))return NaN;let f;if(e&&r)f=h2(n,c,t,u,i),o=Math.min(o,f);else if(e&&!r){const p=n.slice(c[0],c[1]+1);for(let g=u[0];g<=u[1];++g)if(f=hi(t[g],p,i),o=Math.min(o,f),o===0)return o}else if(!e&&r){const p=t.slice(u[0],u[1]+1);for(let g=c[0];g<=c[1];++g)if(f=hi(n[g],p,i),o=Math.min(o,f),o===0)return o}else f=d2(n,c,t,u,i),o=Math.min(o,f)}else{const f=Tu(c,e),p=Tu(u,r);Jo(a,o,i,n,t,f[0],p[0]),Jo(a,o,i,n,t,f[0],p[1]),Jo(a,o,i,n,t,f[1],p[0]),Jo(a,o,i,n,t,f[1],p[1])}}return o}function m2(n,e){const t=n.geometry(),r=t.flat().map(o=>xd([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Ed(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Wa(r,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Wa(r,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Va(r,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function y2(n,e){const t=n.geometry(),r=t.flat().map(o=>xd([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Ed(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Wa(r,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Wa(r,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Va(r,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function _2(n,e){const t=n.geometry();if(t.length===0||t[0].length===0)return NaN;const r=l2(t).map(o=>o.map(a=>a.map(l=>xd([l.x,l.y],n.canonical)))),i=new Ed(r[0][0][0][1]);let s=1/0;for(const o of e)for(const a of r){switch(o.type){case"Point":s=Math.min(s,Va([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,Va(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,g2(a,o.coordinates,i,s));break}if(s===0)return s}return s}function wc(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class yi{constructor(e,t){this.type=j,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ao(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new yi(r,r.features.map(i=>wc(i.geometry)).flat());if(r.type==="Feature")return new yi(r,wc(r.geometry));if("type"in r&&"coordinates"in r)return new yi(r,wc(r))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return m2(e,this.geometries);if(e.geometryType()==="LineString")return y2(e,this.geometries);if(e.geometryType()==="Polygon")return _2(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class No{constructor(e){this.type=ie,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=e[1];return r==null?t.error("Global state property must be defined."):typeof r!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new No(r)}evaluate(e){var t;const r=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!r||Object.keys(r).length===0?null:L_(r,this.key)}eachChild(){}outputDefined(){return!1}}const Bl={"==":$L,"!=":jL,">":VL,"<":XL,">=":ZL,"<=":WL,array:Rr,at:hd,boolean:Rr,case:pd,coalesce:lo,collator:kl,format:md,image:yd,in:dd,"index-of":$a,interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:_d,let:Nl,literal:cs,match:fd,number:Rr,"number-format":gd,object:Rr,slice:ja,step:Gl,string:Rr,"to-boolean":Un,"to-color":Un,"to-number":Un,"to-string":Un,var:Dl,within:mi,distance:yi,"global-state":No};class sr{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const r=e[0],i=sr.definitions[r];if(!i)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([c])=>!Array.isArray(c)||c.length===e.length-1);let l=null;for(const[c,u]of a){l=new Ol(t.registry,Za,t.path,null,t.scope);const h=[];let d=!1;for(let f=1;f<e.length;f++){const p=e[f],g=Array.isArray(c)?c[f-1]:c.type,m=l.parse(p,1+h.length,g);if(!m){d=!0;break}h.push(m)}if(!d){if(Array.isArray(c)&&c.length!==h.length){l.error(`Expected ${c.length} arguments, but found ${h.length} instead.`);continue}for(let f=0;f<h.length;f++){const p=Array.isArray(c)?c[f]:c.type,g=h[f];l.concat(f+1).checkSubtype(p,g.type)}if(l.errors.length===0)return new sr(r,s,u,h)}}if(a.length===1)t.errors.push(...l.errors);else{const u=(a.length?a:o).map(([d])=>b2(d)).join(" | "),h=[];for(let d=1;d<e.length;d++){const f=t.parse(e[d],1+h.length);if(!f)return null;h.push(et(f.type))}t.error(`Expected arguments of type ${u}, but found (${h.join(", ")}) instead.`)}return null}static register(e,t){sr.definitions=t;for(const r in t)e[r]=sr}}function Dp(n,[e,t,r,i]){e=e.evaluate(n),t=t.evaluate(n),r=r.evaluate(n);const s=i?i.evaluate(n):1,o=F_(e,t,r,s);if(o)throw new nt(o);return new Ne(e/255,t/255,r/255,s,!1)}function Gp(n,e){return n in e}function Sc(n,e){const t=e[n];return typeof t>"u"?null:t}function x2(n,e,t,r){for(;t<=r;){const i=t+r>>1;if(e[i]===n)return!0;e[i]>n?r=i-1:t=i+1}return!1}function ei(n){return{type:n}}sr.register(Bl,{error:[fL,[ue],(n,[e])=>{throw new nt(e.evaluate(n))}],typeof:[ue,[ie],(n,[e])=>et(gt(e.evaluate(n)))],"to-rgba":[nr(j,4),[Zr],(n,[e])=>{const[t,r,i,s]=e.evaluate(n).rgb;return[t*255,r*255,i*255,s]}],rgb:[Zr,[j,j,j],Dp],rgba:[Zr,[j,j,j,j],Dp],has:{type:ae,overloads:[[[ue],(n,[e])=>Gp(e.evaluate(n),n.properties())],[[ue,fi],(n,[e,t])=>Gp(e.evaluate(n),t.evaluate(n))]]},get:{type:ie,overloads:[[[ue],(n,[e])=>Sc(e.evaluate(n),n.properties())],[[ue,fi],(n,[e,t])=>Sc(e.evaluate(n),t.evaluate(n))]]},"feature-state":[ie,[ue],(n,[e])=>Sc(e.evaluate(n),n.featureState||{})],properties:[fi,[],n=>n.properties()],"geometry-type":[ue,[],n=>n.geometryType()],id:[ie,[],n=>n.id()],zoom:[j,[],n=>n.globals.zoom],"heatmap-density":[j,[],n=>n.globals.heatmapDensity||0],elevation:[j,[],n=>n.globals.elevation||0],"line-progress":[j,[],n=>n.globals.lineProgress||0],accumulated:[ie,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[j,ei(j),(n,e)=>{let t=0;for(const r of e)t+=r.evaluate(n);return t}],"*":[j,ei(j),(n,e)=>{let t=1;for(const r of e)t*=r.evaluate(n);return t}],"-":{type:j,overloads:[[[j,j],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[j],(n,[e])=>-e.evaluate(n)]]},"/":[j,[j,j],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[j,[j,j],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[j,[],()=>Math.LN2],pi:[j,[],()=>Math.PI],e:[j,[],()=>Math.E],"^":[j,[j,j],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[j,[j],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[j,[j],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[j,[j],(n,[e])=>Math.log(e.evaluate(n))],log2:[j,[j],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[j,[j],(n,[e])=>Math.sin(e.evaluate(n))],cos:[j,[j],(n,[e])=>Math.cos(e.evaluate(n))],tan:[j,[j],(n,[e])=>Math.tan(e.evaluate(n))],asin:[j,[j],(n,[e])=>Math.asin(e.evaluate(n))],acos:[j,[j],(n,[e])=>Math.acos(e.evaluate(n))],atan:[j,[j],(n,[e])=>Math.atan(e.evaluate(n))],min:[j,ei(j),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[j,ei(j),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[j,[j],(n,[e])=>Math.abs(e.evaluate(n))],round:[j,[j],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[j,[j],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[j,[j],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ae,[ue,ie],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[ae,[ie],(n,[e])=>n.id()===e.value],"filter-type-==":[ae,[ue],(n,[e])=>n.geometryType()===e.value],"filter-<":[ae,[ue,ie],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<i}],"filter-id-<":[ae,[ie],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<r}],"filter->":[ae,[ue,ie],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>i}],"filter-id->":[ae,[ie],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>r}],"filter-<=":[ae,[ue,ie],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[ae,[ie],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<=r}],"filter->=":[ae,[ue,ie],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[ae,[ie],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>=r}],"filter-has":[ae,[ie],(n,[e])=>e.value in n.properties()],"filter-has-id":[ae,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ae,[nr(ue)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ae,[nr(ie)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ae,[ue,nr(ie)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ae,[ue,nr(ie)],(n,[e,t])=>x2(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ae,overloads:[[[ae,ae],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[ei(ae),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:ae,overloads:[[[ae,ae],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[ei(ae),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[ae,[ae],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ae,[ue],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[ue,[ue],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ue,[ue],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ue,ei(ie),(n,e)=>e.map(t=>zs(t.evaluate(n))).join("")],"resolved-locale":[ue,[Il],(n,[e])=>e.evaluate(n).resolvedLocale()]});function b2(n){return Array.isArray(n)?`(${n.map(et).join(", ")})`:`(${et(n.type)}...)`}function Za(n){if(n instanceof Dl)return Za(n.boundExpression);if(n instanceof sr&&n.name==="error")return!1;if(n instanceof kl)return!1;if(n instanceof mi)return!1;if(n instanceof yi)return!1;if(n instanceof No)return!1;const e=n instanceof Un||n instanceof Rr;let t=!0;return n.eachChild(r=>{e?t=t&&Za(r):t=t&&r instanceof cs}),t?Sd(n)&&Rd(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Sd(n){if(n instanceof sr){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof mi||n instanceof yi)return!1;let e=!0;return n.eachChild(t=>{e&&!Sd(t)&&(e=!1)}),e}function vd(n){if(n instanceof sr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!vd(t)&&(e=!1)}),e}function Rd(n,e){if(n instanceof sr&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(r=>{t&&!Rd(r,e)&&(t=!1)}),t}function vu(n){return{result:"success",value:n}}function zi(n){return{result:"error",value:n}}function E2(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function T2(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function w2(n){return!!n.expression&&n.expression.interpolated}function $_(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&gt(n)===fi}class S2{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new M_,this._defaultValue=t?P2(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new nt(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function v2(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Bl}function j_(n,e){const t=new Ol(Bl,Za,[],e?C2(e):void 0),r=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?vu(new S2(r,e)):zi(t.errors)}class kp{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!vd(t.expression),this.globalStateRefs=zl(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}}class Up{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!vd(t.expression),this.globalStateRefs=zl(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}interpolationFactor(e,t,r){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,e,t,r):0}}function R2(n,e){const t=j_(n,e);if(t.result==="error")return t;const r=t.value.expression,i=Sd(r);if(!i&&!E2(e))return zi([new jr("","data expressions not supported")]);const s=Rd(r,["zoom"]);if(!s&&!T2(e))return zi([new jr("","zoom expressions not supported")]);const o=oa(r);if(!o&&!s)return zi([new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof jr)return zi([o]);if(o instanceof Hr&&!w2(e))return zi([new jr("",'"interpolate" expressions cannot be used with this property')]);if(!o)return vu(i?new kp("constant",t.value):new kp("source",t.value));const a=o instanceof Hr?o.interpolation:void 0;return vu(i?new Up("camera",t.value,o.labels,a):new Up("composite",t.value,o.labels,a))}function oa(n){let e=null;if(n instanceof Nl)e=oa(n.result);else if(n instanceof lo){for(const t of n.args)if(e=oa(t),e)break}else(n instanceof Gl||n instanceof Hr)&&n.input instanceof sr&&n.input.name==="zoom"&&(e=n);return e instanceof jr||n.eachChild(t=>{const r=oa(t);r instanceof jr?e=r:!e&&r?e=new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function zl(n,e=new Set){return n instanceof No&&e.add(n.key),n.eachChild(t=>{zl(t,e)}),e}function C2(n){const e={color:Zr,string:ue,number:j,enum:ue,boolean:ae,formatted:Al,padding:Ll,numberArray:Fl,colorArray:io,projectionDefinition:Pl,resolvedImage:Mo,variableAnchorOffsetCollection:Ml};return n.type==="array"?nr(e[n.value]||ie,n.length):e[n.type]}function P2(n){if(n.type==="color"&&$_(n.default))return new Ne(0,0,0,0);switch(n.type){case"color":return Ne.parse(n.default)||null;case"padding":return Pr.parse(n.default)||null;case"numberArray":return Ir.parse(n.default)||null;case"colorArray":return ir.parse(n.default)||null;case"variableAnchorOffsetCollection":return Yr.parse(n.default)||null;case"projectionDefinition":return vr.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function X_(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!X_(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const I2={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function A2(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};X_(n)||(n=Ya(n));const e=j_(n,I2);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=V_(n);return{filter:(r,i,s)=>e.value.evaluate(r,i,{},s),needGeometry:t,getGlobalStateRefs:()=>zl(e.value.expression)}}}function L2(n,e){return n<e?-1:n>e?1:0}function V_(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(V_(n[e]))return!0;return!1}function Ya(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?vc(n[1],n[2],"=="):e==="!="?Qo(vc(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?vc(n[1],n[2],e):e==="any"?F2(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(Ya)):e==="none"?["all"].concat(n.slice(1).map(Ya).map(Qo)):e==="in"?Bp(n[1],n.slice(2)):e==="!in"?Qo(Bp(n[1],n.slice(2))):e==="has"?zp(n[1]):e==="!has"?Qo(zp(n[1])):!0}function vc(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function F2(n){return["any"].concat(n.map(Ya))}function Bp(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(L2)]]:["filter-in-small",n,["literal",e]]}}function zp(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Qo(n){return["!",n]}function uo(n){return typeof n=="object"?["literal",n]:n}function M2(n,e){let t=n.stops;if(!t)return O2(n,e);const r=t&&typeof t[0][0]=="object",i=r||n.property!==void 0,s=r||!i;return t=t.map(o=>!i&&e.tokens&&typeof o[1]=="string"?[o[0],k2(o[1])]:[o[0],uo(o[1])]),r?N2(n,e,t):s?G2(n,e,t):Ru(n,e,t)}function O2(n,e){const t=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,n.default];{const r=[e.type==="color"?"to-color":e.type,t,uo(n.default)];return e.type==="array"&&r.splice(1,0,e.value,e.length||null),r}}function Cd(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function N2(n,e,t){const r={},i={},s=[];for(let a=0;a<t.length;a++){const l=t[a],c=l[0].zoom;r[c]===void 0&&(r[c]={zoom:c,type:n.type,property:n.property,default:n.default},i[c]=[],s.push(c)),i[c].push([l[0].value,l[1]])}if(Id({},e)==="exponential"){const a=[Cd(n),["linear"],["zoom"]];for(const l of s){const c=Ru(r[l],e,i[l]);es(a,l,c,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const c=Ru(r[l],e,i[l]);es(a,l,c,!0)}return Pd(a),a}}function D2(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function $p(n,e){const t=uo(D2(n.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function Ru(n,e,t){const r=Id(n,e),i=["get",n.property];if(r==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",i,o[0]],o[1]);return s.push($p(n,e)),s}else if(r==="categorical"){const s=["match",i];for(const o of t)es(s,o[0],o[1],!1);return s.push($p(n,e)),s}else if(r==="interval"){const s=["step",["number",i]];for(const o of t)es(s,o[0],o[1],!0);return Pd(s),n.default===void 0?s:["case",["==",["typeof",i],"number"],s,uo(n.default)]}else if(r==="exponential"){const s=n.base!==void 0?n.base:1,o=[Cd(n),s===1?["linear"]:["exponential",s],["number",i]];for(const a of t)es(o,a[0],a[1],!1);return n.default===void 0?o:["case",["==",["typeof",i],"number"],o,uo(n.default)]}else throw new Error(`Unknown property function type ${r}`)}function G2(n,e,t,r=["zoom"]){const i=Id(n,e);let s,o=!1;if(i==="interval")s=["step",r],o=!0;else if(i==="exponential"){const a=n.base!==void 0?n.base:1;s=[Cd(n),a===1?["linear"]:["exponential",a],r]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)es(s,a[0],a[1],o);return Pd(s),s}function Pd(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function es(n,e,t,r){n.length>3&&e===n[n.length-2]||(r&&n.length===2||n.push(e),n.push(t))}function Id(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function k2(n){const e=["concat"],t=/{([^{}]+)}/g;let r=0;for(let i=t.exec(n);i!==null;i=t.exec(n)){const s=n.slice(r,t.lastIndex-i[0].length);r=t.lastIndex,s.length>0&&e.push(s),e.push(["get",i[1]])}if(e.length===1)return n;if(r<n.length)e.push(n.slice(r));else if(e.length===2)return["to-string",e[1]];return e}const U2=uL;var jp={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Ps=" ",Xp=/(italic|oblique)$/i,Vp={};function Cu(n,e,t){var r=Vp[n];if(!r){Array.isArray(n)||(n=[n]);for(var i=400,s="normal",o=[],a,l,c=0,u=n.length;c<u;++c){var h=n[c],d=h.split(" "),f=d[d.length-1].toLowerCase();f=="normal"||f=="italic"||f=="oblique"?(s=l?s:f,l=!0,d.pop(),f=d[d.length-1].toLowerCase()):Xp.test(f)&&(f=f.replace(Xp,""),s=l?s:d[d.length-1].replace(f,""),l=!0);for(var p in jp){var g=d.length>1?d[d.length-2].toLowerCase():"";if(f==p||f==p.replace("-","")||g+"-"+f==p){i=a?i:jp[p],d.pop(),g&&p.startsWith(g)&&d.pop();break}}!a&&typeof f=="number"&&(i=f,a=!0);var m=d.join(Ps).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");m.indexOf(Ps)!==-1&&(m='"'+m+'"'),o.push(m)}r=Vp[n]=[s,i,o]}return r[0]+Ps+r[1]+Ps+e+"px"+(t?"/"+t:"")+Ps+r[2]}class B2 extends fl{constructor(e,t,r,i,s){const o=s!==void 0?We.IDLE:We.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=We.ERROR):this.state=We.LOADED,this.changed()}load(){this.state==We.IDLE&&(this.state=We.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const W_="https://api.mapbox.com";function Ad(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function z2(n,e,t){if(typeof n=="string")return[{id:"default",url:Wp(n,e,t)}];for(const r of n)r.url=Wp(r.url,e,t);return n}function Wp(n,e,t){const r=Ad(n);if(!r)return decodeURI(new URL(n,t).href);const i="sprites/";if(r.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${n}`);const s=r.slice(i.length);return`${W_}/styles/v1/${s}/sprite?access_token=${e}`}function Ha(n,e){const t=Ad(n);if(!t)return decodeURI(new URL(n,location.href).href);const r="styles/";if(t.indexOf(r)!==0)throw new Error(`unexpected style url: ${n}`);const i=t.slice(r.length);return`${W_}/styles/v1/${i}?&access_token=${e}`}const $2=["a","b","c","d"];function aa(n,e,t,r){const i=new URL(n,r||location.href),s=Ad(n);if(!s)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`]}return $2.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const Cr=Object.freeze({}),Zp={},Yp={};let j2=0;function Ld(n){return n.id||(n.id=j2++),n.id}function X2(n,e){return Ld(n)+"."+ve(e)}function Z_(n){let e=Zp[n.id];return e||(e={},Zp[Ld(n)]=e),e}function V2(n){let e=Yp[n.id];return e||(e={},Yp[Ld(n)]=e),e}function Rc(n){return n*Math.PI/180}const Kr=function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n}();function $l(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const t=document.createElement("canvas");return t.width=n,t.height=e,t}function Fd(n,e){let t=0;const r=e.length;for(;t<r;++t)if(e[t]<n&&t+1<r){const s=e[t]/e[t+1];return t+Math.log(e[t]/n)/Math.log(s)}return r-1}function Os(n,e){const t=Math.floor(n),r=Math.pow(2,n-t);return e[t]/r}const Oi={};function us(n,e,t={},r){if(e in Oi)return r&&(r.url=Oi[e][0].url),Oi[e][1];const i=t.transformRequest&&t.transformRequest(e,n)||e,s=function(l){return delete Oi[e],Promise.reject(new Error("Error fetching source "+e))},o=function(l){return delete Oi[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=ya(()=>i).then(l=>l instanceof Response?(r&&(r.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),r&&(r.url=l.url),fetch(l).then(o).catch(s))).catch(s);return Oi[e]=[i,a],a}function Y_(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const t=JSON.parse(n);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return n=Ha(n,e.accessToken),us("Style",n,e);else return Promise.resolve(n)}const Hp={};function H_(n,e,t={}){const r=[e,JSON.stringify(n)].toString();let i=Hp[r];if(!i||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const c=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof Sy)a.setLoader((u,h,d)=>{const f=function(p){p.arrayBuffer().then(g=>{const y=a.getFormat().readFeatures(g,{extent:u,featureProjection:d});a.setFeatures(y)})};ya(()=>c).then(p=>{if(p instanceof Response)return f(p);fetch(p).then(f).catch(g=>a.setState(de.ERROR))}).catch(p=>a.setState(de.ERROR))});else{const u=a.getImage();ya(()=>c).then(h=>{if(typeof h=="string"){u.src=h;return}const d=f=>f.blob().then(p=>{const g=URL.createObjectURL(p);u.addEventListener("load",()=>URL.revokeObjectURL(g)),u.addEventListener("error",()=>URL.revokeObjectURL(g)),u.src=g});if(h instanceof Response)return d(h);fetch(h).then(d).catch(f=>a.setState(de.ERROR))}).catch(h=>a.setState(de.ERROR))}});const o=n.url;if(o&&!n.tiles){const a=aa(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:a}),tileLoadFunction:s});else{const l={};i=us("Source",a[0],t,l).then(function(c){return c.tiles=c.tiles.map(function(u){return c.scheme==="tms"&&(u=u.replace("{y}","{-y}")),aa(u,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:c,tileLoadFunction:s})})}}else n.tiles?(n=Object.assign({},n,{tiles:n.tiles.map(function(a){return n.scheme==="tms"&&(a=a.replace("{y}","{-y}")),aa(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:s})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));Hp[r]=i}return i}function qp(n,e,t,r){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],s=$l(i[0],i[1]),o=s.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,i[0],i[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${r.r*255},${r.g*255},${r.b*255},${r.a})`;const l=a.data;for(let c=0,u=a.width;c<u;++c)for(let h=0,d=a.height;h<d;++h){const f=(h*u+c)*4;l[f+3]>0&&o.arc(c,h,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function W2(n,e,t){const r=Math.max(0,Math.min(1,(t-n)/(e-n)));return r*r*(3-2*r)}function Kp(n,e,t){const r=$l(e.width,e.height),i=r.getContext("2d");i.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let c=0,u=s.height;c<u;++c){const h=(c*l+a)*4,d=o[h+3]/255,f=.75,p=.1,g=W2(f-p,f+p,d);g>0?(o[h+0]=Math.round(255*t.r*g),o[h+1]=Math.round(255*t.g*g),o[h+2]=Math.round(255*t.b*g),o[h+3]=Math.round(255*g)):o[h+3]=0}return i.putImageData(s,0,0),r}const Z2=Array(256).join("");function Pu(n,e){if(e>=.05){let t="";const r=n.split(`
`),i=Z2.slice(0,Math.round(e/.1));for(let s=0,o=r.length;s<o;++s)s>0&&(t+=`
`),t+=r[s].split("").join(i);return t}return n}let Cc;function q_(){return Cc||(Cc=$l(1,1).getContext("2d")),Cc}function ti(n,e){return q_().measureText(n).width+(n.length-1)*e}const qa={};wE.on("propertychange",()=>{for(const n in qa)delete qa[n]});function Iu(n,e,t,r){if(n.indexOf(`
`)!==-1){const o=n.split(`
`),a=[];for(let l=0,c=o.length;l<c;++l)a.push(Iu(o[l],e,t,r));return a.join(`
`)}const i=t+","+e+","+n+","+r;let s=qa[i];if(!s){const o=n.split(" ");if(o.length>1){const a=q_();a.font=e;const c=a.measureText("M").width*t;let u="";const h=[];for(let d=0,f=o.length;d<f;++d){const p=o[d],g=u+(u?" ":"")+p;ti(g,r)<=c?u=g:(u&&h.push(u),u=p)}u&&h.push(u);for(let d=0,f=h.length;d<f&&f>1;++d){const p=h[d];if(ti(p,r)<c*.35){const g=d>0?ti(h[d-1],r):1/0,m=d<f-1?ti(h[d+1],r):1/0;h.splice(d,1),f-=1,g<m?(h[d-1]+=" "+p,d-=1):h[d]=p+" "+h[d]}}for(let d=0,f=h.length-1;d<f;++d){const p=h[d],g=h[d+1];if(ti(p,r)>c*.7&&ti(g,r)<c*.6){const m=p.split(" "),y=m.pop();ti(y,r)<c*.2&&(h[d]=m.join(" "),h[d+1]=y+" "+g),f-=1}}s=h.join(`
`)}else s=n;s=Pu(s,r),qa[i]=s}return s}const Y2=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],Jp={};function H2(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(bo)return n;let t;for(let r=0,i=n.length;r<i;++r){const s=n[r];if(s in Jp)continue;Jp[s]=!0;const a=Cu(s,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let r=0,i=t.length;r<i;++r){const s=t[r],o=s[0];if(Y2.includes(o))continue;const a=s[1],l=s[2];if(!(await document.fonts.load(`${l} ${a} 16px "${o}"`)).some(u=>u.family.replace(/^['"]|['"]$/g,"").toLowerCase()===o.toLowerCase()&&u.weight==a&&u.style===l)){const u=e.replace("{font-family}",o.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",o.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+u+'"]')){const h=document.createElement("link");h.href=u,h.rel="stylesheet",document.head.appendChild(h)}}}})(),n}const q2={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},K2={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},J2=function(n,e){const t=R2(n,e);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return t.value},lr={zoom:0,distanceFromCenter:0};sr.register(Bl,{...sr.definitions,pitch:[{kind:"number"},[],n=>lr.pitch||90],"distance-from-center":[{kind:"number"},[],n=>lr.distanceFromCenter||0]});let ea,Pc;function q(n,e,t,r,i,s){const o=n.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[o]||(i[o]={});const a=i[o];if(!a[t]){let l=(n[e]||Cr)[t];const c=U2[`${e}_${n.type}`][t];l===void 0&&(l=c.default);let u=v2(l);if(!u&&$_(l)&&(l=M2(l,c),u=!0),u){const h=J2(l,c);a[t]=h.evaluate.bind(h)}else c.type=="color"&&(l=Ne.parse(l)),a[t]=function(){return l}}return a[t](lr,r,s)}function Qp(n,e,t,r){return q(n,"layout",`${t}-allow-overlap`,e,r)?q(n,"layout",`${t}-ignore-placement`,e,r)?"none":"obstacle":"declutter"}function Q2(n,e,t,r){if(r||console.warn("No filterCache provided to evaluateFilter()"),!(n in r))try{r[n]=A2(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),r[n]=function(){return!1}}return r[n](lr,t)}function Fn(n,e){if(n){if(n.a===0||e===0)return;const t=n.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(n.r*255/t)+","+Math.round(n.g*255/t)+","+Math.round(n.b*255/t)+","+t*e+")"}return n}const eF=/\{[^{}}]*\}/g;function Ic(n,e){return n.replace(eF,function(t){return e[t.slice(1,-1)]||""})}function eg(n,e){let t=n.split(":")[0];return t===n&&(t="default"),e[t]}const tF={};function rF(n,e,t,r=Kr,i=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");tF[X2(e,n)]=Array.from(arguments);const l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(const b in s){const T=s[b];ya(()=>T).then(async w=>{let v;if(typeof Image<"u"){const S=new Image;if(typeof w=="string")S.crossOrigin="anonymous",S.src=w;else{let C;w instanceof Request?C=await fetch(w):w instanceof Response&&(C=w);const P=await C.blob();v=URL.createObjectURL(P),S.src=v}S.addEventListener("load",function C(){S.removeEventListener("load",C),l[b]={image:S,size:[S.width,S.height]},n.changed(),v&&URL.revokeObjectURL(v)}),S.addEventListener("error",function C(){URL.revokeObjectURL(v),S.removeEventListener("error",C)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const S=self;S.postMessage({action:"loadImage",src:w}),S.addEventListener("message",function(P){P.data.action==="imageLoaded"&&P.data.src===w&&(l[b]={image:P.data.image,size:[P.data.image.width,P.data.image.height]})})}})}const c=T_(e.layers),u={},h=[],d={},f={},p=Z_(e),g=V2(e);let m;for(let b=0,T=c.length;b<T;++b){const w=c[b],v=w.id;if(typeof t=="string"&&w.source==t||Array.isArray(t)&&t.indexOf(v)!==-1){const S=w["source-layer"];if(m){if(w.source!==m)throw new Error(`Layer "${v}" does not use source "${m}`)}else{m=w.source;const P=e.sources[m];if(!P)throw new Error(`Source "${m}" is not defined`);const A=P.type;if(A!=="vector"&&A!=="geojson")throw new Error(`Source "${m}" is not of type "vector" or "geojson", but "${A}"`)}let C=u[S];C||(C=[],u[S]=C),C.push({layer:w,index:b}),h.push(v)}}const y=new Fs,_=new Vi,x=[],E=function(b,T,w){var U,B,V;const v=((V=(B=(U=n.getSource)==null?void 0:U.call(n))==null?void 0:B.format_)==null?void 0:V.layerName_)??"mvt:layer",S=b.getProperties(),C=u[S[v]];if(!C)return;let P=r.indexOf(T);P==-1&&(P=Fd(T,r)),lr.zoom=P,lr.distanceFromCenter=0;const A=b.getGeometry(),N=q2[A.getType()],D=n.get("map");if(D&&D instanceof Ca&&N===1){const Y=D.getSize();if(Y){const G=D.getView().getCenter(),K=qn(A.getExtent());lr.distanceFromCenter=SE(G,K)/T/Y[1]}}const R={id:b.getId(),properties:S,type:N},M=n.get("mapbox-featurestate")[b.getId()];let O=-1;for(let Y=0,G=C.length;Y<G;++Y){const K=C[Y],k=K.layer,le=k.id;if(w!==void 0&&w!==le)continue;const xe=k.layout||Cr,be=k.paint||Cr;if(xe.visibility==="none"||"minzoom"in k&&P<k.minzoom||"maxzoom"in k&&P>=k.maxzoom)continue;const at=k.filter;if(!at||Q2(le,at,R,g)){let Re,qe,Bt,mt,ft,W;const lt=K.index;if(N==3&&(k.type=="fill"||k.type=="fill-extrusion"))if(qe=q(k,"paint",k.type+"-opacity",R,p,M),k.type+"-pattern"in be){const Xe=q(k,"paint",k.type+"-pattern",R,p,M);if(Xe){const ze=typeof Xe=="string"?Ic(Xe,S):Xe.toString(),Ge=eg(ze,l);if(i&&i[ze]&&Ge){++O,W=x[O],(!W||!W.getFill()||W.getStroke()||W.getText())&&(W=new oi({fill:new Vi}),x[O]=W),Bt=W.getFill(),W.setZIndex(lt);const Ce=ze+"."+qe;let ct=f[Ce];if(!ct){const ge=i[ze],Ee=$l(ge.width,ge.height),ut=Ee.getContext("2d");ut.globalAlpha=qe,ut.drawImage(Ge.image,ge.x,ge.y,ge.width,ge.height,0,0,ge.width,ge.height),ct=ut.createPattern(Ee,"repeat"),f[Ce]=ct}Bt.setColor(ct)}}}else Re=Fn(q(k,"paint",k.type+"-color",R,p,M),qe),k.type+"-outline-color"in be&&(ft=Fn(q(k,"paint",k.type+"-outline-color",R,p,M),qe)),ft||(ft=Re),(Re||ft)&&(++O,W=x[O],(!W||Re&&!W.getFill()||!Re&&W.getFill()||ft&&!W.getStroke()||!ft&&W.getStroke()||W.getText())&&(W=new oi({fill:Re?new Vi:void 0,stroke:ft?new Fs:void 0}),x[O]=W),Re&&(Bt=W.getFill(),Bt.setColor(Re)),ft&&(mt=W.getStroke(),mt.setColor(ft),mt.setWidth(.5)),W.setZIndex(lt));if(N!=1&&k.type=="line"){"line-pattern"in be?Re=void 0:Re=Fn(q(k,"paint","line-color",R,p,M),q(k,"paint","line-opacity",R,p,M));const Xe=q(k,"paint","line-width",R,p,M);Re&&Xe>0&&(++O,W=x[O],(!W||!W.getStroke()||W.getFill()||W.getText())&&(W=new oi({stroke:new Fs}),x[O]=W),mt=W.getStroke(),mt.setLineCap(q(k,"layout","line-cap",R,p,M)),mt.setLineJoin(q(k,"layout","line-join",R,p,M)),mt.setMiterLimit(q(k,"layout","line-miter-limit",R,p,M)),mt.setColor(Re),mt.setWidth(Xe),mt.setLineDash(be["line-dasharray"]?q(k,"paint","line-dasharray",R,p,M).map(function(ze){return ze*Xe}):null),W.setZIndex(lt))}let vt=!1,pe=null,rn=0,ur,tt,Nr;if((N==1||N==2)&&"icon-image"in xe){const Xe=q(k,"layout","icon-image",R,p,M);if(Xe){ur=typeof Xe=="string"?Ic(Xe,S):Xe.toString();let ze;const Ge=a?a(n,ur):void 0,Ce=eg(ur,l);if(i&&i[ur]&&Ce||Ge){const ct=q(k,"layout","icon-rotation-alignment",R,p,M);if(N==2){const ge=b.getGeometry();if(ge.getFlatMidpoint||ge.getFlatMidpoints){const Ee=ge.getExtent();if(Math.sqrt(Math.max(Math.pow((Ee[2]-Ee[0])/T,2),Math.pow((Ee[3]-Ee[1])/T,2)))>150){const ht=ge.getType()==="MultiLineString"?ge.getFlatMidpoints():ge.getFlatMidpoint();if(Pc||(ea=[NaN,NaN],Pc=new Ot("Point",ea,[],2,{},void 0)),ze=Pc,ea[0]=ht[0],ea[1]=ht[1],q(k,"layout","symbol-placement",R,p,M)==="line"&&ct==="map"){const Kt=ge.getStride(),yt=ge.getFlatCoordinates();for(let _t=0,ke=yt.length-Kt;_t<ke;_t+=Kt){const it=yt[_t],Nt=yt[_t+1],Ve=yt[_t+Kt],dt=yt[_t+Kt+1],sn=Math.min(it,Ve),zt=Math.max(it,Ve),$t=ht[0],jt=ht[1],wr=(dt-Nt)*($t-it)-(Ve-it)*(jt-Nt);if(Math.abs(wr)<.001&&$t<=zt&&$t>=sn){rn=Math.atan2(Nt-dt,Ve-it);break}}}}}}if(N!==2||ze){const ge=q(k,"layout","icon-size",R,p,M),Ee=be["icon-color"]!==void 0?q(k,"paint","icon-color",R,p,M):null;if(!Ee||Ee.a!==0){const ut=q(k,"paint","icon-halo-color",R,p,M),ht=q(k,"paint","icon-halo-width",R,p,M);let qt=`${ur}.${ge}.${ht}.${ut}`;if(Ee!==null&&(qt+=`.${Ee}`),tt=d[qt],!tt){const Kt=Qp(k,R,"icon",p);let yt;"icon-offset"in xe&&(yt=q(k,"layout","icon-offset",R,p,M).slice(0),yt[0]*=ge,yt[1]*=-ge);let _t=Ee?[Ee.r*255,Ee.g*255,Ee.b*255,Ee.a]:void 0;if(Ge){const ke={color:_t,rotateWithView:ct==="map",displacement:yt,declutterMode:Kt,scale:ge};typeof Ge=="string"?ke.src=Ge:(ke.img=Ge,ke.imgSize=[Ge.width,Ge.height]),tt=new Zc(ke)}else{const ke=i[ur];let it,Nt,Ve;if(ht)ke.sdf?(it=qp(Kp(Ce.image,ke,Ee||[0,0,0,1]),{x:0,y:0,width:ke.width,height:ke.height,pixelRatio:ke.pixelRatio},ht,ut),_t=void 0):it=qp(Ce.image,ke,ht,ut);else{if(ke.sdf&&!Ce.unSDFed){const dt=Kp(Ce.image,{x:0,y:0,width:Ce.size[0],height:Ce.size[1]},{r:1,g:1,b:1});Ce.image=dt,Ce.unSDFed=!0}it=Ce.image,Nt=[ke.width,ke.height],Ve=[ke.x,ke.y]}tt=new Zc({color:_t,img:it,imgSize:Ce.size,size:Nt,offset:Ve,rotateWithView:ct==="map",scale:ge/ke.pixelRatio,displacement:yt,declutterMode:Kt})}d[qt]=tt}}tt&&(++O,W=x[O],(!W||!W.getImage()||W.getFill()||W.getStroke())&&(W=new oi,x[O]=W),W.setGeometry(ze),tt.setRotation(rn+Rc(q(k,"layout","icon-rotate",R,p,M))),tt.setOpacity(q(k,"paint","icon-opacity",R,p,M)),tt.setAnchor(K2[q(k,"layout","icon-anchor",R,p,M)]),W.setImage(tt),pe=W.getText(),W.setText(void 0),W.setZIndex(lt),vt=!0,Nr=!1)}else Nr=!0}}}if(N==1&&k.type==="circle"){++O,W=x[O],(!W||!W.getImage()||W.getFill()||W.getStroke())&&(W=new oi,x[O]=W);const Xe="circle-radius"in be?q(k,"paint","circle-radius",R,p,M):5,ze=Fn(q(k,"paint","circle-stroke-color",R,p,M),q(k,"paint","circle-stroke-opacity",R,p,M)),Ge=q(k,"paint","circle-translate",R,p,M),Ce=Fn(q(k,"paint","circle-color",R,p,M),q(k,"paint","circle-opacity",R,p,M)),ct=q(k,"paint","circle-stroke-width",R,p,M),ge=Xe+"."+ze+"."+Ce+"."+ct+"."+Ge[0]+"."+Ge[1];tt=d[ge],tt||(tt=new lm({radius:Xe,displacement:[Ge[0],-Ge[1]],stroke:ze&&ct>0?new Fs({width:ct,color:ze}):void 0,fill:Ce?new Vi({color:Ce}):void 0,declutterMode:"none"}),d[ge]=tt),W.setImage(tt),pe=W.getText(),W.setText(void 0),W.setGeometry(void 0),W.setZIndex(lt),vt=!0}let Ke,Je,nn,hr,Dr,vn;if("text-field"in xe){hr=Math.round(q(k,"layout","text-size",R,p,M));const Xe=q(k,"layout","text-font",R,p,M);nn=q(k,"layout","text-line-height",R,p,M),Je=Cu(o?o(Xe,e.metadata?e.metadata["ol:webfonts"]:void 0):Xe,hr,nn),Je.includes("sans-serif")||(Je+=",sans-serif"),Dr=q(k,"layout","text-letter-spacing",R,p,M),vn=q(k,"layout","text-max-width",R,p,M);const ze=q(k,"layout","text-field",R,p,M);typeof ze=="object"&&ze.sections?ze.sections.length===1?Ke=ze.toString():Ke=ze.sections.reduce((Ge,Ce,ct)=>{const ge=Ce.fontStack?Ce.fontStack.split(","):Xe,Ee=Cu(o?o(ge):ge,hr*(Ce.scale||1),nn);let ut=Ce.text;if(ut===`
`)return Ge.push(`
`,""),Ge;if(N==2)return Ge.push(Pu(ut,Dr),Ee),Ge;ut=Iu(ut,Ee,vn,Dr).split(`
`);for(let ht=0,qt=ut.length;ht<qt;++ht)ht>0&&Ge.push(`
`,""),Ge.push(ut[ht],Ee);return Ge},[]):Ke=Ic(ze,S).trim(),qe=q(k,"paint","text-opacity",R,p,M)}if(Ke&&qe&&!Nr){vt||(++O,W=x[O],(!W||!W.getText()||W.getFill()||W.getStroke())&&(W=new oi,x[O]=W),W.setImage(void 0),W.setGeometry(void 0));const Xe=Qp(k,R,"text",p);W.getText()||W.setText(pe),pe=W.getText(),(!pe||"getDeclutterMode"in pe&&pe.getDeclutterMode()!==Xe)&&(pe=new vE({padding:[2,2,2,2],declutterMode:Xe}),W.setText(pe));const ze=q(k,"layout","text-transform",R,p,M);ze=="uppercase"?Ke=Array.isArray(Ke)?Ke.map((Ve,dt)=>dt%2?Ve:Ve.toUpperCase()):Ke.toUpperCase():ze=="lowercase"&&(Ke=Array.isArray(Ke)?Ke.map((Ve,dt)=>dt%2?Ve:Ve.toLowerCase()):Ke.toLowerCase());const Ge=Array.isArray(Ke)?Ke:N==2?Pu(Ke,Dr):Iu(Ke,Je,vn,Dr);if(pe.setText(Ge),pe.setFont(Je),pe.setRotation(Rc(q(k,"layout","text-rotate",R,p,M))),typeof pe.setKeepUpright=="function"){const Ve=q(k,"layout","text-keep-upright",R,p,M);pe.setKeepUpright(Ve)}const Ce=q(k,"layout","text-anchor",R,p,M),ct=vt||N==1?"point":q(k,"layout","symbol-placement",R,p,M);let ge;if(ct==="line-center"?(pe.setPlacement("line"),ge="center"):pe.setPlacement(ct),ct==="line"&&typeof pe.setRepeat=="function"){const Ve=q(k,"layout","symbol-spacing",R,p,M);pe.setRepeat(Ve*2)}pe.setOverflow(ct==="point");let Ee=q(k,"paint","text-halo-width",R,p,M);const ut=q(k,"layout","text-offset",R,p,M),ht=q(k,"paint","text-translate",R,p,M);let qt=0,Kt=0;if(ct=="point"){ge="center",Ce.indexOf("left")!==-1?(ge="left",Kt=Ee):Ce.indexOf("right")!==-1&&(ge="right",Kt=-Ee);const Ve=q(k,"layout","text-rotation-alignment",R,p,M);pe.setRotateWithView(Ve=="map")}else pe.setMaxAngle(Rc(q(k,"layout","text-max-angle",R,p,M))*Ke.length/Ge.length),pe.setRotateWithView(!1);pe.setTextAlign(ge);let yt="middle";Ce.indexOf("bottom")==0?(yt="bottom",qt=-Ee-.5*(nn-1)*hr):Ce.indexOf("top")==0&&(yt="top",qt=Ee+.5*(nn-1)*hr),pe.setTextBaseline(yt);const _t=q(k,"layout","text-justify",R,p,M);pe.setJustify(_t==="auto"?void 0:_t),pe.setOffsetX(ut[0]*hr+Kt+ht[0]),pe.setOffsetY(ut[1]*hr+qt+ht[1]),_.setColor(Fn(q(k,"paint","text-color",R,p,M),qe)),pe.setFill(_);const ke=Fn(q(k,"paint","text-halo-color",R,p,M),qe);if(ke&&Ee>0){y.setColor(ke),Ee*=2;const Ve=.5*hr;y.setWidth(Ee<=Ve?Ee:Ve),pe.setStroke(y)}else pe.setStroke(void 0);const it=q(k,"layout","text-padding",R,p,M),Nt=pe.getPadding();it!==Nt[0]&&(Nt[0]=it,Nt[1]=it,Nt[2]=it,Nt[3]=it),W.setZIndex(lt)}}}if(O>-1)return x.length=O+1,x};return n.setStyle(E),n.set("mapbox-layers",h),n.set("mapbox-source",m),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),E}function K_(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const d=new Array(a);for(let p=0;p<a;++p)d[p]=new ImageData(new Uint8ClampedArray(t[p]),s,o);return n(d,r).data.buffer}const c=new Uint8ClampedArray(l),u=new Array(a),h=new Array(a);for(let d=0;d<a;++d)u[d]=new Uint8ClampedArray(t[d]),h[d]=[0,0,0,0];for(let d=0;d<l;d+=4){for(let p=0;p<a;++p){const g=u[p];h[p][0]=g[d],h[p][1]=g[d+1],h[p][2]=g[d+2],h[p][3]=g[d+3]}const f=n(h,r);c[d]=f[0],c[d+1]=f[1],c[d+2]=f[2],c[d+3]=f[3]}return c.buffer}}function nF(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+K_.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function iF(n,e){const t=K_(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}let sF=class extends vb{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=nF(e,this.onWorkerMessage_.bind(this,i));else r[0]=iF(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const c=l*a,u=[];for(let h=0,d=i.length;h<d;++h)u.push(i[h].slice(c,c+a));this.workers_[l].postMessage({buffers:u,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},u)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,c=a*o;r.set(new Uint8ClampedArray(l),c),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}};const tg={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};let rg=class extends hl{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}},J_=class extends Gh{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=lF(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(Qr.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new RE(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Tr(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:aF(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Tr(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ve(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],c=l instanceof Eo?l:l.getSource();if(!c)continue;const u=(s=c.getAttributions())==null?void 0:s(r);typeof u=="string"?i.push(u):u!==void 0&&i.push(...u)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new sF({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=qn(e);i.size[0]=Math.ceil(er(e)/t),i.size[1]=Math.ceil(Fr(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Ei(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=oF(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new rg(tg.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Ei(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(er(s)/o),c=Math.round(Fr(s)/o);a=Mr(l,c),this.renderedImageCanvas_=new B2(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new rg(tg.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}};J_.prototype.dispose;let ri=null;function oF(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!ri)ri=Mr(r,i,void 0,{willReadFrequently:!0});else{const a=ri.canvas;a.width!==r||a.height!==i?ri=Mr(r,i,void 0,{willReadFrequently:!0}):ri.clearRect(0,0,r,i)}return ri.drawImage(o,0,0,r,i),ri.getImageData(0,0,r,i)}function aF(n){return n.map(function(e){return e.getLayerState()})}function lF(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=cF(n[r]);return t}function cF(n){let e;return n instanceof Eo?n instanceof CE?e=new Ga({source:n}):n instanceof Gh&&(e=new Dh({source:n})):e=n,e}function uF(n,e){const t=n[0],r=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=r-1,c=i-1,u=[0,0,0,0],h=2*Math.PI,d=Math.PI/2,f=Math.PI*e.sunEl/180,p=Math.PI*e.sunAz/180,g=Math.cos(f),m=Math.sin(f),y=e.highlightColor,_=e.shadowColor,x=e.accentColor,E=e.encoding;let b,T,w,v,S,C,P,A,N,D,R,M,O,U,B,V,Y,G,K,k,le,xe;function be(at,Re="mapbox"){if(Re==="mapbox")return(at[0]*256*256+at[1]*256+at[2])*.1-1e4;if(Re==="terrarium")return at[0]*256+at[1]+at[2]/256-32768}for(T=0;T<=c;++T)for(S=T===0?0:T-1,C=T===c?c:T+1,b=0;b<=l;++b)w=b===0?0:b-1,v=b===l?l:b+1,P=(T*r+w)*4,u[0]=s[P],u[1]=s[P+1],u[2]=s[P+2],u[3]=s[P+3],A=e.vert*be(u,E),P=(T*r+v)*4,u[0]=s[P],u[1]=s[P+1],u[2]=s[P+2],u[3]=s[P+3],N=e.vert*be(u,E),D=(N-A)/a,P=(S*r+b)*4,u[0]=s[P],u[1]=s[P+1],u[2]=s[P+2],u[3]=s[P+3],A=e.vert*be(u,E),P=(C*r+b)*4,u[0]=s[P],u[1]=s[P+1],u[2]=s[P+2],u[3]=s[P+3],N=e.vert*be(u,E),R=(N-A)/a,O=Math.atan2(R,-D),O<0?O=d-O:O>d?O=h-O+d:O=d-O,M=Math.atan(Math.sqrt(D*D+R*R)),xe=m*Math.cos(M)+g*Math.sin(M)*Math.cos(p-O),U=Math.cos(M),B=255*xe,K=Math.min(Math.max(2*e.sunEl,0),1),k=1.875-e.opacity*1.75,le=e.opacity!==.5?d*((Math.pow(k,M)-1)/(Math.pow(k,d)-1)):M,Y={r:(1-U)*x.r*K*255,g:(1-U)*x.g*K*255,b:(1-U)*x.b*K*255,a:(1-U)*x.a*K*255},V=Math.abs(((O+p)/Math.PI+.5)%2-1),G={r:(y.r*(1-V)+_.r*V)*B,g:(y.g*(1-V)+_.g*V)*B,b:(y.b*(1-V)+_.b*V)*B,a:(y.a*(1-V)+_.a*V)*B},P=(T*r+b)*4,o[P]=Y.r*(1-V)+G.r,o[P+1]=Y.g*(1-V)+G.g,o[P+2]=Y.b*(1-V)+G.b,o[P+3]=s[P+3]*e.opacity*K*Math.sin(le);return new ImageData(o,r,i)}function hF(n,e=512){return n.getExtent()?To({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():Kr}function Q_(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((r,i)=>{e.accessToken=r,e.accessTokenParam=i})),e}function dF(n,e,t="",r={},i=void 0){let s,o,a,l,c=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,r=a):l=t,typeof r=="string"?(s=r,a={}):(s=r.styleUrl,a=r),a.updateSource===!1&&(c=!1),i||(i=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:Ha(s,a.accessToken),a=Q_(s,a)),new Promise(function(u,h){Y_(e,a).then(function(d){if(d.version!=8)return h(new Error("glStyle version 8 required."));if(!(n instanceof wl||n instanceof Ki))return h(new Error("Can only apply to VectorLayer or VectorTileLayer"));const f=n instanceof Ki?"vector":"geojson";if(l?Array.isArray(l)?o=d.layers.find(function(E){return E.id===l[0]}).source:o=l:(o=d.layers.find(function(E){return E.source&&d.sources[E.source].type===f}).source,l=o),!o)return h(new Error(`No ${f} source found in the glStyle.`));function p(){if(!c)return Promise.resolve();if(n instanceof Ki)return r0(d.sources[o],s,a).then(function(w){const v=n.getSource();v?w!==v&&(v.setTileUrlFunction(w.getTileUrlFunction()),typeof v.setUrls=="function"&&typeof w.getUrls=="function"&&v.setUrls(w.getUrls()),v.format_||(v.format_=w.format_),v.getAttributions()||v.setAttributions(w.getAttributions()),v.getTileLoadFunction()===vy&&v.setTileLoadFunction(w.getTileLoadFunction()),Mt(v.getProjection(),w.getProjection())&&(v.tileGrid=w.getTileGrid())):n.setSource(w);const S=n.getSource().getTileGrid();!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())&&S.getMinZoom()>0&&n.setMaxResolution(Os(Math.max(0,S.getMinZoom()-1e-12),S.getResolutions()))});const E=d.sources[o];let b=n.getSource();(!b||b.get("mapbox-source")!==E)&&(b=s0(E,s,a));const T=n.getSource();return T?b!==T&&(T.getAttributions()||T.setAttributions(b.getAttributions()),T.format_||(T.format_=b.getFormat()),T.url_=b.getUrl()):n.setSource(b),Promise.resolve()}let g,m;const y={},_={};function x(){if(!m&&(!d.sprite||y)){if(a.projection&&!i){const w=$e(a.projection).getUnits();w!=="m"&&(i=Kr.map(v=>v/Hc[w]))}let E;const b=n.getSource();b instanceof Ao&&b.format_ instanceof Uh&&(E=b.format_.layerName_),m=rF(n,d,l,i,y,_,(T,w=a.webfonts)=>H2(T,w),a.getImage,E),n.getStyle()?p().then(u).catch(h):h(new Error(`Nothing to show for source [${o}]`))}else m?(n.setStyle(m),p().then(u).catch(h)):h(new Error("Something went wrong trying to apply style."))}if(d.sprite){const E=z2(d.sprite,a.accessToken,s||location.href);g=bo?1:window.devicePixelRatio>=1.5?.5:1;const b=g==.5?"@2x":"";Promise.all(E.map(function(T){const w=new URL(T.url);let v=w.origin+w.pathname+b+".json"+w.search;return new Promise(function(S,C){us("Sprite",v,a).then(S).catch(function(P){v=w.origin+w.pathname+".json"+w.search,us("Sprite",v,a).then(S).catch(C)})}).then(function(S){S===void 0&&h(new Error("No sprites found."));let C;if(C=w.origin+w.pathname+b+".png"+w.search,a.transformRequest){const P=a.transformRequest(C,"SpriteImage")||C;(P instanceof Request||P instanceof Promise)&&(C=P)}_[T.id]=C;for(const P in S){const A=T.id=="default"?P:`${T.id}:${P}`;y[A]=S[P]}}).catch(function(S){h(new Error(`Sprites cannot be loaded: ${v}: ${S.message}`))})})).then(x).catch(h)}else x()}).catch(h)})}function e0(n,e){let t;return n.some(function(r){if(r.id==e)return t=r.source,!0}),t}function fF(n,e){const t=n.bounds;if(t){const r=qc([t[0],t[1]],e),i=qc([t[2],t[3]],e);return[r[0],r[1],i[0],i[1]]}return $e(e).getExtent()}function t0(n,e,t){const r=new kh({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),i=r.getTileJSON(),s=r.getTileGrid(),o=$e(t.projection||"EPSG:3857"),a=fF(i,o),l=o.getExtent(),c=i.minzoom||0,u=i.maxzoom||22,h={attributions:r.getAttributions(),projection:o,tileGrid:new nh({origin:l?cl(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:c,resolutions:hF(o,e.tileSize).slice(0,u+1),tileSize:s.getTileSize(0)})};return Array.isArray(i.tiles)?h.urls=i.tiles:h.url=i.tiles,h}function pF(n,e,t,r){const i={id:n.id,type:n.type},s=n.layout||{},o=n.paint||{};i.paint=o,lr.zoom=Fd(e,t.resolutions||Kr),lr.distanceFromCenter=0;let a;const l=q(i,"paint","background-color",Cr,r);return o["background-opacity"]!==void 0&&(a=q(i,"paint","background-opacity",Cr,r)),s.visibility=="none"?void 0:Fn(l,a)}function gF(n,e,t){const r=bo?{style:{}}:document.createElement("div");return r.className="ol-mapbox-style-background",r.style.position="absolute",r.style.width="100%",r.style.height="100%",new Kg({source:new Eo({}),render(i){const s=pF(n,i.viewState.resolution,e,t);return r.style.backgroundColor=s,r}})}function r0(n,e,t){return new Promise(function(r,i){H_(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=t0(n,s,t);a.tileLoadFunction=o,a.format=new Uh({layerName:"mvt:layer"});const l=new Ao(a);l.set("mapbox-source",n),r(l)}).catch(i)})}function mF(n,e,t){const r=new Ki({declutter:!0,visible:!1});return r0(n,e,t).then(function(i){r.setSource(i)}).catch(function(i){r.setSource(void 0)}),r}function n0(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function yF(n,e,t){return new Promise(function(r,i){H_(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new kh({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=t0(n,s,t).tileGrid,t.projection&&(a.projection=$e(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(c,u,h){const d=n0(h);let f=l(c,u,h);if(f.indexOf(d)!=-1){const p=a.getTileGrid().getTileCoordExtent(c);f=f.replace(d,p.toString())}return f}),a.set("mapbox-source",n),r(a)}).catch(function(s){i(s)})})}function i0(n,e,t){const r=new Ga;return yF(n,e,t).then(function(i){r.setSource(i)}).catch(function(){r.setSource(void 0)}),r}function _F(n,e,t){const r=i0(n,e,t);return new Dh({source:new J_({operationType:"image",operation:uF,sources:[r]})})}function s0(n,e,t){const r=t.projection?new ou({dataProjection:t.projection}):new ou,i=n.data,s={};if(typeof i=="string"){const[a]=aa(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const c=(h,d,f)=>{const p=n0(f);return a.replace(p,`${h.join(",")}`)},u=new ks({attributions:n.attribution,format:r,loader:(h,d,f,p,g)=>{const m=typeof c=="function"?c(h,d,f):c;us("GeoJSON",m,t).then(y=>{const _=u.getFormat().readFeatures(y,{featureProjection:f});u.addFeatures(_),p(_)}).catch(y=>{u.removeLoadedExtent(h),g()})},strategy:VC});return u.set("mapbox-source",n),u}const l=new ks({attributions:n.attribution,format:r,url:a,loader:(c,u,h,d,f)=>{us("GeoJSON",a,t).then(p=>{const g=l.getFormat().readFeatures(p,{featureProjection:h});l.addFeatures(g),d(g)}).catch(p=>{l.removeLoadedExtent(c),f()})}});return l}s.features=r.readFeatures(i,{featureProjection:"EPSG:3857"});const o=new ks(Object.assign({attributions:n.attribution,format:r},s));return o.set("mapbox-source",n),o}function xF(n,e,t){return new wl({declutter:!0,source:s0(n,e,t),visible:!1})}function bF(n,e,t){let r=null;return function(i){n.paint&&"raster-opacity"in n.paint&&i.frameState.viewState.zoom!==r&&(r=i.frameState.viewState.zoom,delete t[n.id],EF(n,e,r,t))}}function EF(n,e,t,r){lr.zoom=t,lr.distanceFromCenter=0;const i=q(n,"paint","raster-opacity",Cr,r);e.setOpacity(i)}function TF(n,e){function t(){const r=e.get("mapbox-style");if(!r)return;const i=T_(r.layers),s=n.get("mapbox-layers"),o=i.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});n.get("visible")!==o&&n.setVisible(o)}n.on("change",t),t()}function wF(n,e,t,r){const i=Z_(n),s=n.layers,o=t.type,a=t.source||e0(s,t.ref),l=n.sources[a];let c;if(o=="background")c=gF(t,r,i);else if(l.type=="vector")c=mF(l,e,r);else if(l.type=="raster")c=i0(l,e,r),c.setVisible(t.layout?t.layout.visibility!=="none":!0),c.on("prerender",bF(t,c,i));else if(l.type=="geojson")c=xF(l,e,r);else if(l.type=="raster-dem"&&t.type=="hillshade"){const h=_F(l,e,r);c=h,h.getSource().on("beforeoperations",function(d){const f=d.data;f.resolution=IE(r.projection||"EPSG:3857",d.resolution,qn(d.extent),"m"),lr.zoom=Fd(d.resolution,r.resolutions||Kr),lr.distanceFromCenter=0,f.encoding=l.encoding,f.vert=5*q(t,"paint","hillshade-exaggeration",Cr,i),f.sunAz=q(t,"paint","hillshade-illumination-direction",Cr,i),f.sunEl=35,f.opacity=.3,f.highlightColor=q(t,"paint","hillshade-highlight-color",Cr,i),f.shadowColor=q(t,"paint","hillshade-shadow-color",Cr,i),f.accentColor=q(t,"paint","hillshade-accent-color",Cr,i)}),c.setVisible(t.layout?t.layout.visibility!=="none":!0)}const u=a;return c&&c.set("mapbox-source",u),c}function ng(n,e,t,r){const i=[];let s=null;if(e instanceof Ca){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const h=r.projection?$e(r.projection):s.getProjection();s=new PE(Object.assign(s.getProperties(),{maxResolution:Kr[0]/Hc[h.getUnits()],projection:r.projection||s.getProjection()})),e.setView(s)}"center"in n&&!s.getCenter()&&s.setCenter(qc(n.center,s.getProjection())),"zoom"in n&&s.getZoom()===void 0&&s.setResolution(Kr[0]/Hc[s.getProjection().getUnits()]/Math.pow(2,n.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",n),e.set("mapbox-metadata",{styleUrl:t,options:r});const o=n.layers;let a=[],l,c,u;for(let h=0,d=o.length;h<d;++h){const f=o[h],p=f.type;if(p=="heatmap"){console.debug(`layers[${h}].type "${p}" not supported`);continue}else u=f.source||e0(o,f.ref),(!u||u!=c)&&(a.length&&(i.push(ig(l,a,n,t,e,r)),a=[]),l=wF(n,t,f,r),l instanceof wl||l instanceof Ki||(a=[]),c=l.get("mapbox-source")),a.push(f.id)}return i.push(ig(l,a,n,t,e,r)),Promise.all(i)}function SF(n,e,t={}){let r,i;if(bo){if(!(n instanceof Ca)&&!(n instanceof zg))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=n}else typeof n=="string"||n instanceof HTMLElement?i=new Ca({target:n}):i=n;if(typeof e=="string"){const s=e.startsWith("data:")?location.href:Ha(e,t.accessToken);t=Q_(s,t),r=new Promise(function(o,a){Y_(e,t).then(function(l){ng(l,i,s,t).then(function(){o(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else r=new Promise(function(s,o){ng(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:Ha(t.styleUrl,t.accessToken),t).then(function(){s(i)}).catch(o)});return r}function ig(n,e,t,r,i,s={}){let o=24,a=0;const l=t.layers;for(let c=0,u=l.length;c<u;++c){const h=l[c];e.indexOf(h.id)!==-1&&(o=Math.min("minzoom"in h?h.minzoom:0,o),a=Math.max("maxzoom"in h?h.maxzoom:24,a))}return new Promise(function(c,u){const h=function(){const f=n.getSource();if(!f||f.getState()==="error"){u(new Error("Error accessing data for source "+n.get("mapbox-source")));return}if("getTileGrid"in f){const p=f.getTileGrid();if(p){const g=p.getMinZoom();(o>0||g>0)&&n.setMaxResolution(Math.min(Os(Math.max(0,o-1e-12),Kr),Os(Math.max(0,g-1e-12),p.getResolutions()))),a<24&&n.setMinResolution(Os(a,Kr))}}else o>0&&n.setMaxResolution(Os(Math.max(0,o-1e-12),Kr));f instanceof ks||f instanceof Ao?dF(n,t,e,Object.assign({styleUrl:r},s)).then(function(){TF(n,i),c()}).catch(u):c()};n.set("mapbox-layers",e);const d=i.getLayers();d.getArray().indexOf(n)===-1&&d.push(n),n.getSource()?h():n.once("change:source",h)})}class vF extends ux{constructor(e={}){const{mapboxStyle:t,applyOptions:r,...i}=e;super(i),t&&this.applyMapboxStyle(t,r)}applyMapboxStyle(e,t){return SF(this,e,t)}}hx(NE);window.eoxMapAdvancedOlLayers={Graticule:I1,Heatmap:Sv,Layer:Wu,VectorImage:Cv,WebGLPoints:Iv,WebGLTile:ry,WebGLVector:Av,STAC:ad,MapboxStyle:vF};function RF(n){const e=n[0],t=new Array(e);let r=1<<e-1,i,s;for(i=0;i<e;++i)s=48,n[1]&r&&(s+=1),n[2]&r&&(s+=2),t[i]=String.fromCharCode(s),r>>=1;return t.join("")}const CF='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class PF extends wn{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:Ae("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r=(e.url||"https://dev.virtualearth.net/REST/v1/Imagery/Metadata/")+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=mo(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=yo({extent:s,minZoom:t.zoomMin,maxZoom:r,tileSize:a});this.tileGrid=l;const c=this.culture_,u=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=Zu(t.imageUrlSubdomains.map(function(d){const f=[0,0,0],p=t.imageUrl.replace("{subdomain}",d).replace("{culture}",c);return function(g,m,y){if(!g)return;Uc(g[0],g[1],g[2],f);const _=new URL(p.replace("{quadkey}",RF(f))),x=_.searchParams;return u&&(x.set("dpi","d1"),x.set("device","mobile")),h===!0?x.delete("n"):h===!1&&x.set("n","z"),_.toString()}})),t.imageryProviders){const d=Yu(Ae("EPSG:4326"),this.getProjection());this.setAttributions(f=>{const p=[],g=f.viewState,m=this.getTileGrid(),y=m.getZForResolution(g.resolution,this.zDirection),x=m.getTileCoordForCoordAndZ(g.center,y)[0];return t.imageryProviders.map(function(E){let b=!1;const T=E.coverageAreas;for(let w=0,v=T.length;w<v;++w){const S=T[w];if(x>=S.zoomMin&&x<=S.zoomMax){const C=S.bbox,P=[C[1],C[0],C[3],C[2]],A=ns(P,d);if(rs(A,f.extent)){b=!0;break}}}b&&p.push(E.attribution)}),p.push(CF),p})}this.setState("ready")}}class IF extends Mg{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const r=new XMLHttpRequest;r.addEventListener("load",this.handleInitResponse_.bind(this,e)),r.addEventListener("error",this.handleInitError_.bind(this)),r.open("POST",t),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const r=t.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const AF=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,LF=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class FF{constructor(e){this.gl_=e,this.program_=Au(e,LF,AF),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,r,i,s,o,a,l,c,u,h,d,f){const p=this.gl_;l===void 0&&(l=i),c===void 0&&(c=s),o===void 0&&(o=t),a===void 0&&(a=r),u===void 0&&(u=o),h===void 0&&(h=a),d===void 0&&(d=p.canvas.width),f===void 0&&(f=p.canvas.height),p.bindTexture(p.TEXTURE_2D,e),p.useProgram(this.program_),p.bindBuffer(p.ARRAY_BUFFER,this.positionBuffer),p.enableVertexAttribArray(this.positionLocation),p.vertexAttribPointer(this.positionLocation,2,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,this.texcoordBuffer),p.enableVertexAttribArray(this.texcoordLocation),p.vertexAttribPointer(this.texcoordLocation,2,p.FLOAT,!1,0,0);let g=eu(0,d,0,f,-1,1);g=A1(g,l,c,0),g=Uf(g,u,h,1),p.uniformMatrix4fv(this.matrixLocation,!1,g);let m=L1(i/t,s/r,0);m=Uf(m,o/t,a/r,1),p.uniformMatrix4fv(this.textureMatrixLocation,!1,m),p.uniform1i(this.textureLocation,0),p.drawArrays(p.TRIANGLES,0,this.positions.length/2)}}function sg(n,e,t){const r=n.createShader(e);if(r===null)throw new Error("Shader compilation failed");if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){const i=n.getShaderInfoLog(r);throw i===null?new Error("Shader info log creation failed"):new Error(i)}return r}function Au(n,e,t){const r=n.createProgram(),i=sg(n,n.VERTEX_SHADER,t),s=sg(n,n.FRAGMENT_SHADER,e);if(r===null)throw new Error("Program creation failed");if(n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r)===null?new Error("Program info log creation failed"):new Error;return r}const MF=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,OF=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,NF=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,DF=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function GF(n,e,t,r){let i;return t&&t.length?i=t.shift():dx?i=new OffscreenCanvas(n||300,e||300):i=document.createElement("canvas"),n&&(i.width=n),e&&(i.height=e),i.getContext("webgl",r)}function kF(n){const e=n.canvas;e.width=1,e.height=1,n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)}const og=[];function UF(n,e,t,r,i,s,o,a,l,c,u,h,d,f){const p=Math.round(r*e),g=Math.round(r*t);n.canvas.width=p,n.canvas.height=g;let m,y;if(y=n.createTexture(),n.bindTexture(n.TEXTURE_2D,y),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),d?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,p,g,0,n.RGBA,u,null),m=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,m),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,y,0),m===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(l.length===0)return{width:p,height:g,framebuffer:m,texture:y};const _=go();l.forEach(function(C,P,A){fx(_,C.extent)});let x,E,b;const T=1/i;{if(x=n.createTexture(),y===null)throw new Error("Could not create texture");E=Math.round(Pt(_)*T),b=Math.round(Lr(_)*T);const C=n.getParameter(n.MAX_TEXTURE_SIZE),P=Math.max(E,b),A=P>C?C/P:1,N=Math.round(E*A),D=Math.round(b*A);n.bindTexture(n.TEXTURE_2D,x),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),d?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,N,D,0,n.RGBA,u,null);const R=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,R),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,x,0);const M=new FF(n);l.forEach(function(O,U,B){const V=(O.extent[0]-_[0])*T*A,Y=-(O.extent[3]-_[3])*T*A,G=Pt(O.extent)*T*A,K=Lr(O.extent)*T*A;if(n.bindFramebuffer(n.FRAMEBUFFER,R),n.viewport(0,0,N,D),O.clipExtent){const k=(O.clipExtent[0]-_[0])*T*A,le=-(O.clipExtent[3]-_[3])*T*A,xe=Pt(O.clipExtent)*T*A,be=Lr(O.clipExtent)*T*A;n.enable(n.SCISSOR_TEST),n.scissor(d?k:Math.round(k),d?le:Math.round(le),d?xe:Math.round(k+xe)-Math.round(k),d?be:Math.round(le+be)-Math.round(le))}M.drawImage(O.texture,O.width,O.height,c,c,O.width-2*c,O.height-2*c,d?V:Math.round(V),d?Y:Math.round(Y),d?G:Math.round(V+G)-Math.round(V),d?K:Math.round(Y+K)-Math.round(Y),N,D),n.disable(n.SCISSOR_TEST)}),n.deleteFramebuffer(R)}const w=Bc(o),v=Bc(_),S=C=>{const P=(C[0][0]-w[0])/s*r,A=-(C[0][1]-w[1])/s*r,N=(C[1][0]-w[0])/s*r,D=-(C[1][1]-w[1])/s*r,R=(C[2][0]-w[0])/s*r,M=-(C[2][1]-w[1])/s*r;return{u1:N,v1:D,u0:P,v0:A,u2:R,v2:M}};n.bindFramebuffer(n.FRAMEBUFFER,m),n.viewport(0,0,p,g);{const C=[],P=[],A=Au(n,DF,NF);n.useProgram(A);const N=n.getUniformLocation(A,"u_texture");n.bindTexture(n.TEXTURE_2D,x),n.uniform1i(N,0),a.getTriangles().forEach(function(V,Y,G){const K=V.source,k=V.target,{u1:le,v1:xe,u0:be,v0:at,u2:Re,v2:qe}=S(k),Bt=(K[0][0]-v[0])/i/E,mt=-(K[0][1]-v[1])/i/b,ft=(K[1][0]-v[0])/i/E,W=-(K[1][1]-v[1])/i/b,lt=(K[2][0]-v[0])/i/E,vt=-(K[2][1]-v[1])/i/b;C.push(le,xe,be,at,Re,qe),P.push(ft,W,Bt,mt,lt,vt)});const D=eu(0,p,g,0,-1,1),R=n.getUniformLocation(A,"u_matrix");n.uniformMatrix4fv(R,!1,D);const M=n.getAttribLocation(A,"a_position"),O=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,O),n.bufferData(n.ARRAY_BUFFER,new Float32Array(C),n.STATIC_DRAW),n.vertexAttribPointer(M,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(M);const U=n.getAttribLocation(A,"a_texcoord"),B=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,B),n.bufferData(n.ARRAY_BUFFER,new Float32Array(P),n.STATIC_DRAW),n.vertexAttribPointer(U,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(U),n.drawArrays(n.TRIANGLES,0,C.length/2)}if(h){const C=Au(n,OF,MF);n.useProgram(C);const P=eu(0,p,g,0,-1,1),A=n.getUniformLocation(C,"u_matrix");n.uniformMatrix4fv(A,!1,P);const N=Array.isArray(h)?h:[0,0,0,255],D=n.getUniformLocation(C,"u_val");n.uniform4fv(D,N);const R=n.getAttribLocation(C,"a_position"),M=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,M),n.vertexAttribPointer(R,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(R);const O=a.getTriangles().reduce(function(U,B){const V=B.target,{u1:Y,v1:G,u0:K,v0:k,u2:le,v2:xe}=S(V);return U.concat([Y,G,K,k,K,k,le,xe,le,xe,Y,G])},[]);n.bufferData(n.ARRAY_BUFFER,new Float32Array(O),n.STATIC_DRAW),n.drawArrays(n.LINES,0,O.length/2)}return{width:p,height:g,framebuffer:m,texture:y}}class BF extends ju{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,r=t.getExtent(),i=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?i?Xr(r,i):r:i;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?Xr(s,o):s;if(Vd(l)===0){this.state=_e.EMPTY;return}r&&(a?a=Xr(a,r):a=r);const c=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,h=px(t,u,l,c);if(!isFinite(h)||h<=0){this.state=_e.EMPTY;return}const d=e.errorThreshold!==void 0?e.errorThreshold:gx;if(this.triangulation_=new mx(t,u,l,a,h*d,c,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=_e.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let f=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(f[1]=Qe(f[1],a[1],a[3]),f[3]=Qe(f[3],a[1],a[3])):f=Xr(f,a)),!Vd(f))this.state=_e.EMPTY;else{let p=0,g=0;t.canWrapX()&&(p=Pt(r),g=Math.floor((f[0]-r[0])/p)),yx(f.slice(),t,!0).forEach(y=>{const _=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),x=e.getTileFunction;for(let E=_.minX;E<=_.maxX;E++)for(let b=_.minY;b<=_.maxY;b++){const T=x(this.sourceZ_,E,b,this.pixelRatio_);if(T){const w=g*p;this.sourceTiles_.push({tile:T,offset:w})}}++g}),this.sourceTiles_.length===0&&(this.state=_e.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(E=>{var Y;const b=E.tile;if(!b||b.getState()!==_e.LOADED)return;const T=b.getSize(),w=this.gutter_;let v;const S=Dc(b.getData());S?v=S:(t=!0,v=_x(Gc(b.getData())));const C=[T[0]+2*w,T[1]+2*w],P=v instanceof Float32Array,A=C[0]*C[1],N=P?Float32Array:Uint8ClampedArray,D=new N(v.buffer),R=N.BYTES_PER_ELEMENT,M=R*D.length/A,O=D.byteLength/C[1],U=Math.floor(O/R/C[0]),B=this.sourceTileGrid_.getTileCoordExtent(b.tileCoord);B[0]+=E.offset,B[2]+=E.offset;const V=(Y=this.clipExtent_)==null?void 0:Y.slice();V&&(V[0]+=E.offset,V[2]+=E.offset),e.push({extent:B,clipExtent:V,data:D,dataType:N,bytesPerPixel:M,pixelSize:C,bandCount:U})}),this.sourceTiles_.length=0,e.length===0){this.state=_e.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(r),s=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],a=Math.round(s*this.pixelRatio_),l=Math.round(o*this.pixelRatio_),c=this.targetTileGrid_.getResolution(r),u=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),d=e[0].bandCount,f=new e[0].dataType(d*a*l),p=GF(a,l,og,{premultipliedAlpha:!1,antialias:!1});let g;const m=p.RGBA;let y;e[0].dataType==Float32Array?(y=p.FLOAT,p.getExtension("WEBGL_color_buffer_float"),p.getExtension("OES_texture_float"),p.getExtension("EXT_float_blend"),g=p.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=p.UNSIGNED_BYTE,g=this.interpolate);const _=4,x=Math.ceil(d/_);for(let E=x-1;E>=0;--E){const b=[];for(let N=0,D=e.length;N<D;++N){const R=e[N],M=R.pixelSize,O=M[0],U=M[1],B=new R.dataType(_*O*U),V=R.data;let Y=E*_;for(let K=0,k=B.length;K<k;K+=_)B[K]=V[Y],B[K+1]=V[Y+1],B[K+2]=V[Y+2],B[K+3]=V[Y+3],Y+=d;const G=p.createTexture();p.bindTexture(p.TEXTURE_2D,G),g?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR)):(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,m,O,U,0,m,y,B),b.push({extent:R.extent,clipExtent:R.clipExtent,texture:G,width:O,height:U})}const{framebuffer:T,width:w,height:v}=UF(p,s,o,this.pixelRatio_,u,c,h,this.triangulation_,b,this.gutter_,y,this.renderEdges_,g),S=w,C=v*_,P=new e[0].dataType(S*C);p.bindFramebuffer(p.FRAMEBUFFER,T),p.readPixels(0,0,w,v,p.RGBA,y,P);let A=E*_;for(let N=0,D=P.length;N<D;N+=_){const R=(S-1-(N/C|0))*C+N%C;f[A]=P[R],f[A+1]=P[R+1],f[A+2]=P[R+2],f[A+3]=P[R+3],A+=d}}if(kF(p),og.push(p.canvas),t){const E=Vn(s,o),b=new ImageData(f,s);E.putImageData(b,0,0),this.reprojData_=E.canvas}else this.reprojData_=f;this.reprojSize_=[a,l],this.state=_e.LOADED,this.changed()}load(){if(this.state!==_e.IDLE&&this.state!==_e.ERROR)return;this.state=_e.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const r=t.getState();if(r!==_e.IDLE&&r!==_e.LOADING)return;e++;const i=fn(t,Vt.CHANGE,()=>{const s=t.getState();(s==_e.LOADED||s==_e.ERROR||s==_e.EMPTY)&&(ga(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==_e.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(ga),this.sourcesListenerKeys_=null}}class jl extends Hu{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let r=e.tileGrid;r===void 0&&t&&(r=yo({extent:mo(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:r,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ar(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Ar(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||na(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,r,i,s,o){const a=this.tileGrid||this.getTileGridForProjection(s||i),l=Math.max.apply(null,a.getResolutions().map((p,g)=>{const m=Ar(a.getTileSize(g)),y=this.getTileSize(g);return Math.max(y[0]/m[0],y[1]/m[1])})),c=this.getTileGridForProjection(i),u=[e,t,r],h=this.getTileCoordForTileUrlFunction(u,i),d=Object.assign({sourceProj:s||i,sourceTileGrid:a,targetProj:i,targetTileGrid:c,tileCoord:u,wrappedTileCoord:h,pixelRatio:l,gutter:this.gutter_,getTileFunction:(p,g,m,y)=>this.getTile(p,g,m,y,void 0,o),transformMatrix:this.transformMatrix},this.tileOptions),f=new BF(d);return f.key=this.getKey(),f}getTile(e,t,r,i,s,o){var T;const a=this.getProjection();if(s&&(a&&!na(a,s)||this.transformMatrix))return this.getReprojTile_(e,t,r,s,a,o);const l=this.getTileSize(e),c=this.loader_,u=new AbortController,h={signal:u.signal,crossOrigin:this.crossOrigin_},d=this.getTileCoordForTileUrlFunction([e,t,r]);if(!d)return null;const f=this.getKey(),p=xx(this,f,e,t,r);if(o&&o.containsKey(p))return o.get(p);const g=d[0],m=d[1],y=d[2],_=(T=this.getTileGrid())==null?void 0:T.getFullTileRange(g);_&&(h.maxY=_.getHeight()-1);function x(){return Tx(function(){return c(g,m,y,h)})}const E=Object.assign({tileCoord:[e,t,r],loader:x,size:l,controller:u},this.tileOptions),b=new ju(E);return b.key=this.getKey(),b.addEventListener(Vt.CHANGE,this.handleTileChange_),o==null||o.set(p,b),b}handleTileChange_(e){const t=e.target,r=Ie(t),i=t.getState();let s;i==_e.LOADING?(this.tileLoadingKeys_[r]=!0,s=ql.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=i==_e.ERROR?ql.TILELOADERROR:i==_e.LOADED?ql.TILELOADEND:void 0),s&&this.dispatchEvent(new bx(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||na(t,e))&&!this.transformMatrix)return this.tileGrid;const r=Ie(e);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=Ex(e)),this.tileGridForProjection_[r]}setTileGridForProjection(e,t){const r=Ae(e);if(r){const i=Ie(r);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function zF(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function $F(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=Gt;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const ag="STATISTICS_MAXIMUM",lg="STATISTICS_MINIMUM",Ac=256;let Lc;function jF(){return Lc||(Lc=new f_),Lc}function XF(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function VF(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function WF(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}function ZF(n){const e=n.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let r=Ae(t);if(!r){const i=Wd(e.ProjLinearUnitsGeoKey);i&&(r=new Zd({code:t,units:i}))}return r}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let r=Ae(t);if(!r){const i=Wd(e.GeogAngularUnitsGeoKey);i&&(r=new Zd({code:t,units:i}))}return r}return null}function YF(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function HF(n,e){let t;return n.blob?t=y_(n.blob):n.overviews?t=__(n.url,n.overviews,e):t=m_(n.url,e),t.then(YF)}function Ns(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)Ns(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function qF(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function KF(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class o0 extends jl{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=HF(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){r.configure_(s)}).catch(function(s){Hs(s),r.error_=s,r.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=ZF(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,c,u,h,d,f]=s,p=Xs(Xs([1/Math.sqrt(o*o+u*u),0,0,-1/Math.sqrt(a*a+h*h),c,f],[o,u,a,h,0,0]),[1,0,0,1,-c,-f]);this.transformMatrix=p,this.addAlpha_=!0;break}}}configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),c=new Array(e.length);let u=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(S=>{zF(S)?_.push(S):y.push(S)});const x=y.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let E,b;const T=new Array(x),w=new Array(x),v=new Array(x);l[m]=new Array(x),c[m]=new Array(x);for(let S=0;S<x;++S){const C=y[S],P=C.getGDALNoData();c[m][S]=C.getGDALMetadata(0),l[m][S]=P;const A=this.sourceInfo_[m].bands;a[m]=A?A.length:C.getSamplesPerPixel();const N=x-(S+1);E||(E=XF(C)),b||(b=VF(C));const D=WF(C,y[0]);v[N]=D[0];const R=[C.getTileWidth(),C.getTileHeight()];R[0]!==R[1]&&R[1]<Ac&&(R[0]=Ac,R[1]=Ac),T[N]=R;const M=D[0]/Math.abs(D[1]);w[N]=[R[0],R[1]/M]}if(t?Xr(t,E,t):t=E,!r)r=b;else{const S=`Origin mismatch for source ${m}, got [${b}] but expected [${r}]`;Ns(r,b,0,S,this.viewRejector)}if(!o)o=v,this.resolutionFactors_[m]=1;else{o.length-u>v.length&&(u=o.length-v.length);const S=o[o.length-1]/v[v.length-1];this.resolutionFactors_[m]=S;const C=v.map(A=>A*=S),P=`Resolution mismatch for source ${m}, got [${C}] but expected [${o}]`;Ns(o.slice(u,o.length),C,.02,P,this.viewRejector)}i?Ns(i.slice(u,i.length),w,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=w,s?Ns(s.slice(u,s.length),T,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=T,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=c;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let x=0;x<_.length;++x)if(y[_[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let m=0;m<h;++m)d+=a[m];this.bandCount=d;const f=new ll({extent:t,minZoom:u,origin:r,resolutions:o,tileSizes:i});this.tileGrid=f,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=Ys(Ct(),this.transformMatrix.slice()),y=wx(_=>bn(m,_));g=ns(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:vx(zn(g),this.projection),extent:Sx(g,this.projection),zoom:p})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,c=this.sourceInfo_,u=jF();for(let h=0;h<o;++h){const d=c[h],f=this.resolutionFactors_[h],p=[Math.round(t*(s[0]*f)),Math.round(r*(s[1]*f)),Math.round((t+1)*(s[0]*f)),Math.round((r+1)*(s[1]*f))],g=this.sourceImagery_[h][e];let m;d.bands&&(m=d.bands.map(function(b){return b-1}));let y;"nodata"in d&&d.nodata!==null?y=d.nodata:m?y=m.map(function(b){return l[h][b]}):y=l[h];const _={window:p,width:s[0],height:s[1],samples:m,fillValue:y,pool:u,interleave:!1,signal:i.signal};$F(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const x=o+h,E=this.sourceMasks_[h][e];if(!E){a[x]=Promise.resolve(null);continue}a[x]=E.readRasters({window:p,width:s[0],height:s[1],samples:[0],pool:u,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw Hs(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,c=this.normalize_,u=this.addAlpha_,h=e[0]*e[1],d=h*o;let f;c?f=new Uint8Array(d):f=new Float32Array(d);let p=0;for(let g=0;g<h;++g){let m=u;for(let y=0;y<s;++y){const _=i[y];let x=_.min,E=_.max,b,T;if(c){const w=r[y][0];x===void 0&&(w&&lg in w?x=parseFloat(w[lg]):x=qF(t[y][0])),E===void 0&&(w&&ag in w?E=parseFloat(w[ag]):E=KF(t[y][0])),b=255/(E-x),T=-x*b}for(let w=0;w<a[y];++w){const v=t[y][w][g];let S;if(c?S=Qe(b*v+T,0,255):S=v,!u)f[p]=S;else{let C=_.nodata;if(C===void 0){let A;_.bands?A=_.bands[w]-1:A=w,C=l[y][A]}const P=isNaN(C);(!P&&v!==C||P&&!isNaN(v))&&(m=!1,f[p]=S)}p++}if(!m){const w=s+y,v=t[w];v&&!v[0][g]&&(m=!0)}}u&&(m||(f[p]=255),p++)}return f}}o0.prototype.getView;const JF=22;class QF extends wn{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const r={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(r.imageFormat=e.imageFormat),e.scale&&(r.scale=e.scale),t&&(r.highDpi=!0),e.layerTypes&&(r.layerTypes=e.layerTypes),e.styles&&(r.styles=e.styles),e.overlay===!0&&(r.overlay=!0),e.apiOptions&&(r.apiOptions=e.apiOptions),this.sessionTokenRequest_=r,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_;const i=e.url||"https://tile.googleapis.com/";this.createSessionUrl_=i+"v1/createSession",this.tileUrl_=i+"v1/2dtiles",this.attributionUrl_=i+"tile/v1/viewport",this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=this.createSessionUrl_+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},r=await this.fetchSessionToken(e,t);if(!r.ok){try{const d=await r.json();this.error_=new Error(d.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await r.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=yo({extent:mo(this.getProjection()),maxZoom:JF,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_,c=this.tileUrl_;this.tileUrlFunction=function(d,f,p){const g=d[0],m=d[1],y=d[2];return`${c}/${g}/${m}/${y}?session=${a}&key=${l}`};const u=parseInt(i.expiry,10)*1e3,h=Math.max(u-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[Wn.ANIMATING]||e.viewHints[Wn.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,r]=Yd(Rx(e.extent),e.viewState.projection),[i,s]=Yd(Cx(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${r}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const c=this.sessionTokenValue_,u=this.apiKey_,d=`${this.attributionUrl_}?session=${c}&key=${u}&${l}`;return this.previousViewportAttribution_=await fetch(d).then(f=>f.json()).then(f=>f.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let a0=class extends $u{constructor(e,t,r,i,s,o,a){super(t,r,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==_e.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const r=Vn(t[0],t[1]);return r.drawImage(e,0,0),this.zoomifyImage_=r.canvas,r.canvas}return e}};class eM extends wn{constructor(e){const t=e.size,r=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||zc;let c=l*i;switch(r){case"default":for(;s>c||o>c;)a.push([Math.ceil(s/c),Math.ceil(o/c)]),c+=c;break;case"truncated":let T=s,w=o;for(;T>c||w>c;)a.push([Math.ceil(T/c),Math.ceil(w/c)]),T>>=1,w>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const u=[i],h=[0];for(let T=1,w=a.length;T<w;T++)u.push(i<<T),h.push(a[T-1][0]*a[T-1][1]+h[T-1]);u.reverse();const d=new ll({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:u});let f=e.url;f&&!f.includes("{TileGroup}")&&!f.includes("{tileIndex}")&&(f+="{TileGroup}/{z}-{x}-{y}.jpg");const p=Og(f);let g=l*i;function m(T){return function(w,v,S){if(!w)return;const C=w[0],P=w[1],A=w[2],N=P+A*a[C][0],D=(N+h[C])/g|0,R={z:C,x:P,y:A,tileIndex:N,TileGroup:"TileGroup"+D};return T.replace(/\{(\w+?)\}/g,function(M,O){return R[O]})}}const y=Zu(p.map(m)),_=a0.bind(null,Ar(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:d,tileUrlFunction:y,transition:e.transition}),this.zDirection=e.zDirection;const x=d.getTileCoordForCoordAndResolution(zn(d.getExtent()),u[u.length-1]),E=y(x,1,null),b=new Image;b.addEventListener("error",()=>{g=l,this.changed()}),b.src=E}}function Is(n){return n.toLocaleString("en",{maximumFractionDigits:10})}class tM extends wn{constructor(e){const t=e||{};let r=t.url||"";r=r+(r.lastIndexOf("/")===r.length-1||r===""?"":"/");const i=t.version||pt.VERSION2,s=t.sizes||[],o=t.size;cr(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],c=t.tileSize,u=t.tilePixelRatio||1,h=t.format||"jpg",d=t.quality||(t.version==pt.VERSION1?"native":"default");let f=t.resolutions||[];const p=t.supports||[],g=t.extent||[0,-l,a,0],m=s!=null&&Array.isArray(s)&&s.length>0,y=c!==void 0&&(typeof c=="number"&&Number.isInteger(c)&&c>0||Array.isArray(c)&&c.length>0),_=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let x,E,b;if(f.sort(function(S,C){return C-S}),y||_)if(c!=null&&(typeof c=="number"&&Number.isInteger(c)&&c>0?(x=c,E=c):Array.isArray(c)&&c.length>0&&((c.length==1||c[1]==null&&Number.isInteger(c[0]))&&(x=c[0],E=c[0]),c.length==2&&(Number.isInteger(c[0])&&Number.isInteger(c[1])?(x=c[0],E=c[1]):c[0]==null&&Number.isInteger(c[1])&&(x=c[1],E=c[1])))),(x===void 0||E===void 0)&&(x=zc,E=zc),f.length==0){b=Math.max(Math.ceil(Math.log(a/x)/Math.LN2),Math.ceil(Math.log(l/E)/Math.LN2));for(let S=b;S>=0;S--)f.push(Math.pow(2,S))}else{const S=Math.max(...f);b=Math.round(Math.log(S)/Math.LN2)}else if(x=a,E=l,f=[],m){s.sort(function(C,P){return C[0]-P[0]}),b=-1;const S=[];for(let C=0;C<s.length;C++){const P=a/s[C][0];if(f.length>0&&f[f.length-1]==P){S.push(C);continue}f.push(P),b++}if(S.length>0)for(let C=0;C<S.length;C++)s.splice(S[C]-C,1)}else f.push(1),s.push([a,l]),b=0;const T=new ll({tileSize:[x,E],extent:g,origin:Bc(g),resolutions:f}),w=function(S,C,P){let A,N;const D=S[0];if(D>b)return;const R=S[1],M=S[2],O=f[D];if(!(R===void 0||M===void 0||O===void 0||R<0||Math.ceil(a/O/x)<=R||M<0||Math.ceil(l/O/E)<=M)){if(_||y){const U=R*x*O,B=M*E*O;let V=x*O,Y=E*O,G=x,K=E;if(U+V>a&&(V=a-U),B+Y>l&&(Y=l-B),U+x*O>a&&(G=Math.floor((a-U+O-1)/O)),B+E*O>l&&(K=Math.floor((l-B+O-1)/O)),U==0&&V==a&&B==0&&Y==l)A="full";else if(!_||p.includes("regionByPx"))A=U+","+B+","+V+","+Y;else if(p.includes("regionByPct")){const k=Is(U/a*100),le=Is(B/l*100),xe=Is(V/a*100),be=Is(Y/l*100);A="pct:"+k+","+le+","+xe+","+be}i==pt.VERSION3&&(!_||p.includes("sizeByWh"))?N=G+","+K:!_||p.includes("sizeByW")?N=G+",":p.includes("sizeByH")?N=","+K:p.includes("sizeByWh")?N=G+","+K:p.includes("sizeByPct")&&(N="pct:"+Is(100/O))}else if(A="full",m){const U=s[D][0],B=s[D][1];i==pt.VERSION3?U==a&&B==l?N="max":N=U+","+B:U==a?N="full":N=U+","}else N=i==pt.VERSION3?"max":"full";return r+A+"/"+N+"/0/"+d+"."+h}},v=a0.bind(null,Ar(c||256).map(function(S){return S*u}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:v,tileGrid:T,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:w,transition:t.transition}),this.zDirection=t.zDirection}}function l0(n,e,t,r,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/r,l=[Hd(Pt(e)/a,qd),Hd(Lr(e)/a,qd)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*r:90*r);const c=n.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return ma(c,s)}function rM(n){const e=n.load?n.load:ps,t=Ae(n.projection||"EPSG:3857"),r=n.ratio??1.5,i=n.crossOrigin??null;return function(s,o,a){a=n.hidpi?a:1;const l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,n.params),s=Ng(s,o,a,r);const c=l0(n.url,s,o,a,t,l),u=new Image;return u.crossOrigin=i,e(u,c).then(h=>{const d=Pt(s)/h.width*a;return{image:h,extent:s,resolution:d,pixelRatio:a}})}}class nM extends Ci{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:qu,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=rM({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),ps(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class iM extends Ci{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,r,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==r&&la(s.getExtent(),e))return s;e=e.slice(),Fg(e,this.ratio_);const o=Pt(e)/t,a=Lr(e)/t,l=[o*r,a*r],c=this.canvasFunction_.call(this,e,t,r,l,i);return c&&(s=new Ph(e,t,r,c)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function sM(n,e,t,r){const i=Pt(n),s=Lr(n),o=e[0],a=e[1],l=.0254/r;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function oM(n,e,t,r,i,s,o){const a=sM(t,r,s,o),l=zn(t),c={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(c,e),ma(n,c)}function aM(n){const e=n.load||ps,t=n.useOverlay??!1,r=n.metersPerUnit||1,i=n.displayDpi||96,s=n.ratio??1,o=n.crossOrigin??null;return function(a,l,c){const u=new Image;u.crossOrigin=o,a=Ng(a,l,c,s);const h=Pt(a)/l,d=Lr(a)/l,f=[h*c,d*c],p=oM(n.url,n.params,a,f,t,r,i);return e(u,p).then(g=>({image:g,extent:a,pixelRatio:c}))}}class lM extends Ci{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:qu,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=aM({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),ps(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}function cM(n){const e=n.load||ps,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=Pt(t)/s.width,a=Lr(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class uM extends Ci{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:qu;super({attributions:e.attributions,interpolate:e.interpolate,projection:Ae(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Lg(this.imageExtent_,void 0,1,cM({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),ps(i))})),this.image.addEventListener(Vt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return rs(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const hM=new Error("Image failed to load");function c0(n,e,t,r,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(hM)),a.src=Dg(n,e,t,r,i.maxY)})}function cg(n){return function(e,t,r,i){const s=Px(n,e,t,r);return c0(s,e,t,r,i)}}function dM(n){return function(e,t,r,i){const s=n(e,t,r,i);return c0(s,e,t,r,i)}}function ug(n){let e;if(Array.isArray(n))e=cg(n);else if(typeof n=="string"){const t=Og(n);e=cg(t)}else if(typeof n=="function")e=dM(n);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let hg=0;function dg(n){return Array.isArray(n)?n.join(`
`):typeof n=="string"?n:(++hg,"url-function-key-"+hg)}class u0 extends jl{constructor(e){e=e||{};let t=e.loader,r;e.url&&(t=ug(e.url),r=dg(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:r,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=ug(e);this.setLoader(t),this.setKey(dg(e)),this.getState()!=="ready"&&this.setState("ready")}}function Md(n,e,t,r){const i=document.createElement("script"),s="olc_"+Ie(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class fM extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class pM extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function h0(n){return new Promise(function(e,t){function r(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(c){const u="Error parsing response text as JSON: "+c.message;t(new Error(u));return}e(l);return}t(new fM(a))}function i(o){t(new pM(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",r),s.addEventListener("error",i),s.open("GET",n),s.setRequestHeader("Accept","application/json"),s.send()})}function d0(n,e){return e.includes("://")?e:new URL(e,n).href}const gM={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},mM={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function f0(n,e){if(!e.length)return n;const t=new URL(n,"file:/");if(t.pathname.split("/").includes("collections"))return Hs('The "collections" query parameter cannot be added to collection endpoints'),n;const r=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",r);const i=n.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function yM(n,e,t){let r,i;for(let s=0;s<n.length;++s){const o=n[s];if(o.rel==="item"){if(o.type===e){r=o.href;break}(gM[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return t&&(r=f0(r,t)),r}function _M(n,e,t,r){let i,s;const o={};for(let a=0;a<n.length;++a){const l=n[a];if(o[l.type]=l.href,l.rel==="item"){if(l.type===e){i=l.href;break}mM[l.type]&&(s=l.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const l=t[a];if(o[l]){i=o[l];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return r&&(i=f0(i,r)),i}function fg(n,e,t,r){let i=n.projection;if(!i&&(typeof e.crs=="string"?i=Ae(e.crs):"uri"in e.crs&&(i=Ae(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(T=>T.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),l=e.tileMatrices,c={};for(let T=0;T<l.length;++T){const w=l[T];c[w.id]=w}const u={},h=[];if(r)for(let T=0;T<r.length;++T){const w=r[T],v=w.tileMatrix;h.push(v),u[v]=w}else for(let T=0;T<l.length;++T){const w=l[T].id;h.push(w)}const d=h.length,f=new Array(d),p=new Array(d),g=new Array(d),m=new Array(d),y=[-1/0,-1/0,1/0,1/0];for(let T=0;T<d;++T){const w=h[T],v=c[w],S=v.pointOfOrigin;a?f[T]=[S[1],S[0]]:f[T]=S,p[T]=v.cellSize,g[T]=[v.matrixWidth,v.matrixHeight],m[T]=[v.tileWidth,v.tileHeight];const C=u[w];if(C){const P=v.cellSize*v.tileWidth,A=f[T][0]+C.minTileCol*P,N=f[T][0]+(C.maxTileCol+1)*P,D=v.cellSize*v.tileHeight,R=v.cornerOfOrigin==="bottomLeft";let M,O;R?(M=f[T][1]+C.minTileRow*D,O=f[T][1]+(C.maxTileRow+1)*D):(M=f[T][1]-(C.maxTileRow+1)*D,O=f[T][1]-C.minTileRow*D),Xr(y,[A,M,N,O],y)}}const _=new ll({origins:f,resolutions:p,sizes:g,tileSizes:m,extent:r?y:void 0}),x=n.context,E=n.url;function b(T,w,v){if(!T)return;const S=h[T[0]],C=c[S],P=C.cornerOfOrigin==="bottomLeft",A={tileMatrix:S,tileCol:T[1],tileRow:P?-T[2]-1:T[2]};if(r){const D=u[C.id];if(A.tileCol<D.minTileCol||A.tileCol>D.maxTileCol||A.tileRow<D.minTileRow||A.tileRow>D.maxTileRow)return}Object.assign(A,{z:A.tileMatrix,x:A.tileCol,y:A.tileRow},x);const N=t.replace(/\{(\w+?)\}/g,function(D,R){return A[R]});return d0(E,N)}return{grid:_,projection:i,urlTemplate:t,urlFunction:b}}function xM(n,e){const t=e.tileMatrixSetLimits;let r;if(e.dataType==="map")r=yM(e.links,n.mediaType,n.collections);else if(e.dataType==="vector")r=_M(e.links,n.mediaType,n.supportedMediaTypes,n.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return fg(n,e.tileMatrixSet,r,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=d0(n.url,s);return h0(o).then(function(a){return fg(n,a,r,t)})}function p0(n){return h0(n.url).then(function(e){return xM(n,e)})}class bM extends wn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};p0(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Hs(e),this.setState("error")}}class EM extends Ix{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};p0(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Hs(e),this.setState("error")}}function g0(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const d=new Array(a);for(let p=0;p<a;++p)d[p]=new ImageData(new Uint8ClampedArray(t[p]),s,o);return n(d,r).data.buffer}const c=new Uint8ClampedArray(l),u=new Array(a),h=new Array(a);for(let d=0;d<a;++d)u[d]=new Uint8ClampedArray(t[d]),h[d]=[0,0,0,0];for(let d=0;d<l;d+=4){for(let p=0;p<a;++p){const g=u[p];h[p][0]=g[d],h[p][1]=g[d+1],h[p][2]=g[d+2],h[p][3]=g[d+3]}const f=n(h,r);c[d]=f[0],c[d+1]=f[1],c[d+2]=f[2],c[d+3]=f[3]}return c.buffer}}function TM(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+g0.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function wM(n,e){const t=g0(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}class SM extends Cg{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=TM(e,this.onWorkerMessage_.bind(this,i));else r[0]=wM(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const c=l*a,u=[];for(let h=0,d=i.length;h<d;++h)u.push(i[h].slice(c,c+a));this.workers_[l].postMessage({buffers:u,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},u)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,c=a*o;r.set(new Uint8ClampedArray(l),c),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const pg={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class gg extends Lx{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}}class m0 extends Ci{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=CM(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(Vt.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new Ax(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Ct(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:RM(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Ct(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Ie(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],c=l instanceof Ku?l:l.getSource();if(!c)continue;const u=(s=c.getAttributions())==null?void 0:s(r);typeof u=="string"?i.push(u):u!==void 0&&i.push(...u)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new SM({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=zn(e);i.size[0]=Math.ceil(Pt(e)/t),i.size[1]=Math.ceil(Lr(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Vs(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=vM(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new gg(pg.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Vs(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(Pt(s)/o),c=Math.round(Lr(s)/o);a=Vn(l,c),this.renderedImageCanvas_=new Ph(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new gg(pg.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}m0.prototype.dispose;let ni=null;function vM(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!ni)ni=Vn(r,i,void 0,{willReadFrequently:!0});else{const a=ni.canvas;a.width!==r||a.height!==i?ni=Vn(r,i,void 0,{willReadFrequently:!0}):ni.clearRect(0,0,r,i)}return ni.drawImage(o,0,0,r,i),ni.getImageData(0,0,r,i)}function RM(n){return n.map(function(e){return e.getLayerState()})}function CM(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=PM(n[r]);return t}function PM(n){let e;return n instanceof Ku?n instanceof Hu?e=new Fx({source:n}):n instanceof Ci&&(e=new Mx({source:n})):e=n,e}const IM='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',AM='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',LM='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',FM={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_toner_dark:{extension:"png"},stamen_toner_blacklite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},MM={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_dark:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_blacklite:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class OM extends Mg{constructor(e){const t=e.layer.indexOf("-"),r=t==-1?e.layer:e.layer.slice(0,t),i=MM[r]||{minZoom:0,maxZoom:20,retina:!0},s=FM[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,c=[IM,AM,Ox];e.layer.startsWith("stamen_")&&c.splice(1,0,LM),super({attributions:c,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class NM extends wn{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=go(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const c=Nx(Dx(e),a.length);l=a[c]}return l0(l,r,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}setParams(e){this.params_=Object.assign({},e),this.setKey(this.getKeyForParams_())}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=Ar(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=Gx(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,r,a)}}class DM extends u0{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",r=e.source,i=e.color||"grey";super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:r!==void 0?r.getWrapX():void 0});const s=()=>{var a;this.projection=e.projection!==void 0?Ae(e.projection):r!==void 0?r.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:r!==void 0?r.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:r!==void 0?r.zDirection:this.zDirection,r instanceof jl&&(this.transformMatrix=((a=r.transformMatrix)==null?void 0:a.slice())||null);const o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((l,c)=>Ar(o.getTileSize(c)).map(u=>Math.max(Math.floor(u),1)))),this.setLoader((l,c,u,h)=>{const d=Dg(t,l,c,u,h.maxY),[f,p]=this.getTileSize(l),g=Vn(f,p);return g.strokeStyle=i,g.strokeRect(.5,.5,f+.5,p+.5),g.fillStyle=i,g.strokeStyle="white",g.textAlign="center",g.textBaseline="middle",g.font="24px sans-serif",g.lineWidth=4,g.strokeText(d,f/2,p/2,f),g.fillText(d,f/2,p/2,f),Promise.resolve(g.canvas)}),this.setState("ready")};if(r===void 0||r.getState()==="ready")s();else{const o=()=>{r.getState()==="ready"&&(r.removeEventListener(Vt.CHANGE,o),s())};r.addEventListener(Vt.CHANGE,o)}}}class GM extends wn{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:Ae("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Md(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=Ae("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const c=Yu(t,r);i=ns(e.bounds,c)}const s=mo(r),o=e.minzoom||0,a=e.maxzoom||22,l=yo({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=Gg(e.tiles,l),e.attribution&&!this.getAttributions()){const c=i!==void 0?i:s;this.setAttributions(function(u){return rs(c,u.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class kM extends Bx{constructor(e,t,r,i,s,o){super(e,t),this.src_=r,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),r=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-r)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,r){this.state==_e.EMPTY&&r===!0?(this.state=_e.IDLE,zx(this,Vt.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):r===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=_e.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=_e.LOADED,this.changed()}loadInternal_(){if(this.state==_e.IDLE)if(this.state=_e.LOADING,this.jsonp_)Md(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(r)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(_e.EMPTY)}}class UM extends Hu{constructor(e){if(super({projection:Ae("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=kx,this.template_=void 0,this.jsonp_=e.jsonp||!1,this.tileCache_=new Pg(512),e.url)if(this.jsonp_)Md(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,r,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s),a=this.getTile(o[0],o[1],o[2],1,this.getProjection());a.getState()==_e.IDLE&&a.load(),a.forDataAtCoordinate(e,r,i)}else i===!0?setTimeout(function(){r(null)},0):r(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=Ae("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const u=Yu(t,r);i=ns(e.bounds,u)}const s=mo(r),o=e.minzoom||0,a=e.maxzoom||22,l=yo({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const c=e.grids;if(!c){this.setState("error");return}if(this.tileUrlFunction_=Gg(c,l),e.attribution){const u=i!==void 0?i:s;this.setAttributions(function(h){return rs(u,h.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,r,i,s){const o=[e,t,r],a=this.getTileCoordForTileUrlFunction(o,s),l=this.tileUrlFunction_(a,i,s),c=`${this.getKey()},${Ux(e,t,r)}`;if(this.tileCache_.containsKey(c))return this.tileCache_.get(c);this.tileCache_.expireCache();const u=new kM(o,l!==void 0?_e.IDLE:_e.EMPTY,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache_.set(c,u),u}}class BM extends Uu{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const r=t.getGeometry();return cr(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,r){var i;(i=this.source)==null||i.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Vt.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Vt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const r=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=go(),t=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let s=0,o=r.length;s<o;s++){const a=r[s];if(!(Ie(a)in i)){const l=this.geometryFunction(a);if(l){const c=l.getCoordinates();$x(c,e),Vu(e,t,e);const u=this.source.getFeaturesInExtent(e).filter(function(h){const d=Ie(h);return d in i?!1:(i[d]=!0,!0)});this.features.push(this.createCluster(u,e))}}}}createCluster(e,t){const r=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?jx(r,l.getCoordinates()):e.splice(a,1)}Xx(r,1/e.length);const i=zn(t),s=this.interpolationRatio,o=new Er([r[0]*(1-s)+i[0]*s,r[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Wt({geometry:o,features:e})}}class Ka extends BM{constructor(e={}){super({...e,createCluster:Ka.defaultCreateCluster,geometryFunction:Ka.defaultGeometryFunction})}static defaultCreateCluster(e,t){const r=t.length===1&&t[0].getGeometry()instanceof _i?t[0].getGeometry():e,i=new Wt({geometry:r,features:t});if(t.length===1){const s=t[0];for(const o in s.getProperties())o!=="geometry"&&i.set(o,s.get(o))}return i}static defaultGeometryFunction(e){const t=e&&e.getGeometry();return t instanceof Er?t:t instanceof _i?t.getInteriorPoint():null}}class zM extends wn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new Nm().read(e),s=Vx(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Zu(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?ma(e,r):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in r?r[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t==="KVP"?l=ma(l,a):l=l.replace(/\{(\w+?)\}/g,(c,u)=>a[u]),l}}}const pn=new Uint8Array([102,103,98,3,102,103,98,0]),or=4,As=4,Ls=4,Do=4,Mn=new Int32Array(2),mg=new Float32Array(Mn.buffer),yg=new Float64Array(Mn.buffer),ta=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Lu;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(Lu||(Lu={}));class Or{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new Or(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Mn[0]=this.readInt32(e),mg[0]}readFloat64(e){return Mn[ta?0:1]=this.readInt32(e),Mn[ta?1:0]=this.readInt32(e+4),yg[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){mg[0]=t,this.writeInt32(e,Mn[0])}writeFloat64(e,t){yg[0]=t,this.writeInt32(e,Mn[ta?0:1]),this.writeInt32(e+4,Mn[ta?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+As+Ls)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Ls;t++)e+=String.fromCharCode(this.readInt8(this.position_+As+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=As;const i=this.bytes_.subarray(e,e+r);return t===Lu.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+As}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Ls)throw new Error("FlatBuffers: file identifier must be length "+Ls);for(let t=0;t<Ls;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+As+t))return!1;return!0}createScalarList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s)}return r}createObjList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s.unpack())}return r}}var Le,Rt=((Le={})[Le.Byte=0]="Byte",Le[Le.UByte=1]="UByte",Le[Le.Bool=2]="Bool",Le[Le.Short=3]="Short",Le[Le.UShort=4]="UShort",Le[Le.Int=5]="Int",Le[Le.UInt=6]="UInt",Le[Le.Long=7]="Long",Le[Le.ULong=8]="ULong",Le[Le.Float=9]="Float",Le[Le.Double=10]="Double",Le[Le.String=11]="String",Le[Le.Json=12]="Json",Le[Le.DateTime=13]="DateTime",Le[Le.Binary=14]="Binary",Le);class Et{constructor(){ye(this,"bb",null);ye(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Et).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Do),(t||new Et).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Rt.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Rt.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,i,s,o,a,l,c,u,h,d){return Et.startColumn(e),Et.addName(e,t),Et.addType(e,r),Et.addTitle(e,i),Et.addDescription(e,s),Et.addWidth(e,o),Et.addPrecision(e,a),Et.addScale(e,l),Et.addNullable(e,c),Et.addUnique(e,u),Et.addPrimaryKey(e,h),Et.addMetadata(e,d),Et.endColumn(e)}}var me,At=((me={})[me.Unknown=0]="Unknown",me[me.Point=1]="Point",me[me.LineString=2]="LineString",me[me.Polygon=3]="Polygon",me[me.MultiPoint=4]="MultiPoint",me[me.MultiLineString=5]="MultiLineString",me[me.MultiPolygon=6]="MultiPolygon",me[me.GeometryCollection=7]="GeometryCollection",me[me.CircularString=8]="CircularString",me[me.CompoundCurve=9]="CompoundCurve",me[me.CurvePolygon=10]="CurvePolygon",me[me.MultiCurve=11]="MultiCurve",me[me.MultiSurface=12]="MultiSurface",me[me.Curve=13]="Curve",me[me.Surface=14]="Surface",me[me.PolyhedralSurface=15]="PolyhedralSurface",me[me.TIN=16]="TIN",me[me.Triangle=17]="Triangle",me);class kt{constructor(){ye(this,"bb",null);ye(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new kt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Do),(t||new kt).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):At.Unknown}parts(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new kt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,At.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,i,s,o,a,l,c){return kt.startGeometry(e),kt.addEnds(e,t),kt.addXy(e,r),kt.addZ(e,i),kt.addM(e,s),kt.addT(e,o),kt.addTm(e,a),kt.addType(e,l),kt.addParts(e,c),kt.endGeometry(e)}}class yr{constructor(){ye(this,"bb",null);ye(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new yr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Do),(t||new yr).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new kt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let r=this.bb.__offset(this.bb_pos,8);return r?(t||new Et).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,i){return yr.startFeature(e),yr.addGeometry(e,t),yr.addProperties(e,r),yr.addColumns(e,i),yr.endFeature(e)}}function Fc(n,e){let t=[];for(let r=0;r<n.length;r+=2){let i=[n[r],n[r+1]];e&&i.push(e[r>>1]),t.push(i)}return t}new TextEncoder;let _g=new TextDecoder;function $M(n,e){let t={};if(!e||e.length===0)return t;let r=n.propertiesArray();if(!r)return t;let i=new DataView(r.buffer,r.byteOffset),s=n.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],c=l.name;switch(l.type){case Rt.Bool:t[c]=!!i.getUint8(o),o+=1;break;case Rt.Byte:t[c]=i.getInt8(o),o+=1;break;case Rt.UByte:t[c]=i.getUint8(o),o+=1;break;case Rt.Short:t[c]=i.getInt16(o,!0),o+=2;break;case Rt.UShort:t[c]=i.getUint16(o,!0),o+=2;break;case Rt.Int:t[c]=i.getInt32(o,!0),o+=4;break;case Rt.UInt:t[c]=i.getUint32(o,!0),o+=4;break;case Rt.Long:t[c]=Number(i.getBigInt64(o,!0)),o+=8;break;case Rt.ULong:t[c]=Number(i.getBigUint64(o,!0)),o+=8;break;case Rt.Float:t[c]=i.getFloat32(o,!0),o+=4;break;case Rt.Double:t[c]=i.getFloat64(o,!0),o+=8;break;case Rt.DateTime:case Rt.String:{let u=i.getUint32(o,!0);o+=4,t[c]=_g.decode(r.subarray(o,o+u)),o+=u;break}case Rt.Json:{let u=i.getUint32(o,!0);o+=4;let h=_g.decode(r.subarray(o,o+u));t[c]=JSON.parse(h),o+=u;break}case Rt.Binary:{let u=i.getUint32(o,!0);o+=4,t[c]=r.subarray(o,o+u),o+=u;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const Od=new Uint8Array(0);function jM(){return this._source.cancel()}function XM(n,e){if(!n.length)return e;if(!e.length)return n;var t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function VM(){var n=this,e=n._array.subarray(n._index);return n._source.read().then(function(t){return n._array=Od,n._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:XM(e,t.value)}})}function WM(n){if((n|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var r=new Uint8Array(n);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=Od,e._index=0,t>0?r.subarray(0,t):null):t+s.value.length>=n?(e._array=s.value,e._index=n-t,r.set(s.value.subarray(0,n-t),t),r):(r.set(s.value,t),t+=s.value.length,i())})}()}function ZM(n){return typeof n.slice=="function"?n:new Xl(typeof n.read=="function"?n:n.getReader())}function Xl(n){this._source=n,this._array=Od,this._index=0}Xl.prototype.read=VM;Xl.prototype.slice=WM;Xl.prototype.cancel=jM;class mr{constructor(){ye(this,"bb",null);ye(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new mr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Do),(t||new mr).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,i,s,o,a){return mr.startCrs(e),mr.addOrg(e,t),mr.addCode(e,r),mr.addName(e,i),mr.addDescription(e,s),mr.addWkt(e,o),mr.addCodeString(e,a),mr.endCrs(e)}}class Ja{constructor(){ye(this,"bb",null);ye(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new Ja).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Do),(t||new Ja).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):At.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new Et).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new mr).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,At.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function Vl(n){let e=Ja.getRootAsHeader(n),t=e.featuresCount(),r=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}const nl=class nl{constructor(){ye(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};ye(nl,"global",new nl);let Qa=nl;const YM=40,HM=16;function Wl(n,e){e=Math.min(Math.max(+e,2),65535);let t=n,r=t;do r+=t=Math.ceil(t/e);while(t!==1);return 40*r}function qM(n,e){if(e<2)throw Error("Node size must be at least 2");if(n===0)throw Error("Number of items must be greater than 0");let t=n,r=t,i=[t];do r+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=r,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*y0(n,e,t,r){class i{constructor(f,p){ye(this,"_level");ye(this,"nodes");this._level=p,this.nodes=f}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(f){this.nodes[1]=f}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,c=qM(n,e),u=c[0][0],h=[new i([0,1],c.length-1)];for(;h.length!==0;){let d=h.shift(),f=d.startNodeIdx(),p=f>=u,g=(()=>{let[,_]=c[d.level()],x=Math.min(d.endNodeIdx()+e,_);return p&&x<_?x+1:x})(),m=g-f,y=new DataView(await r(40*f,40*m));for(let _=f;_<g;_++){let x=_-f,E=40*x;if(a<y.getFloat64(E+0,!0)||l<y.getFloat64(E+8,!0)||s>y.getFloat64(E+16,!0)||o>y.getFloat64(E+24,!0))continue;let b=y.getBigUint64(E+32,!0);if(p){let S=(()=>{if(_<n-1){let P=(x+1)*40;return y.getBigUint64(P+32,!0)-b}return null})(),C=_-u;yield[Number(b),C,Number(S)];continue}let T=Qa.global.extraRequestThreshold()/40,w=h[h.length-1];if(w!==void 0&&w.level()===d.level()-1&&b<w.endNodeIdx()+T){w.extendEndNodeIdx(Number(b));continue}let v=(()=>{let S=d.level()-1;return new i([Number(b),Number(b)+1],S)})();w!==void 0&&(w.level(),v.level()),h.push(v)}}}class Nd{constructor(e,t,r,i){ye(this,"bytes");ye(this,"header");ye(this,"headerLength");ye(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=r,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((o,a)=>pn[a]===o))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(8,!0);if(t>10485760||t<8)throw Error("Invalid header size");let r=e.subarray(12,12+t),i=Vl(new Or(r)),s=Wl(i.featuresCount,i.indexNodeSize);return new Nd(e,i,t,s)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=async(i,s)=>{let o=t+i;return this.bytes.slice(o,o+s).buffer};for await(let i of y0(this.header.featuresCount,this.header.indexNodeSize,e,r)){let[s,o]=i,a=this.readFeature(s);yield{id:o,feature:a}}}lengthBeforeTree(){return pn.length+or+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),r=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+r),s=new Uint8Array(r+or);s.set(i,or);let o=new Or(s);return o.setPosition(or),yr.getRootAsFeature(o)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fu=function(n,e){return Fu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Fu(n,e)};function KM(n,e){Fu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function hs(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,[])).next())})}function Hn(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function vs(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ho(n){return this instanceof ho?(this.v=n,this):new ho(n)}function JM(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,g){s.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{l(r[d](f))}catch(p){h(s[0][3],p)}}function l(d){d.value instanceof ho?Promise.resolve(d.value.v).then(c,u):h(s[0][2],d)}function c(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}var _0=function(n){KM(e,n);function e(t){var r=n.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function n(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),n.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();function Mu(n){n!=null&&typeof n.then=="function"&&n.then(rl,rl)}var Mc=0,xg=1,vi=2,el=3,Ou=4,tl=1024,rl=function(){};function ts(n){var e=n.err,t=Promise.resolve(n.execution).then(function(r){if(e!=null)throw e;return r});return n.err=void 0,n.execution=t.then(function(){},function(){}),n.pending===void 0?t:n.pending.then(function(){return t})}function li(n,e){var t=n.state>=el;return Promise.resolve(e).then(function(r){return!t&&n.state>=Ou?ts(n).then(function(i){return{value:i,done:!0}}):{value:r,done:t}})}function Dd(n,e){var t,r;if(!(n.state>=vi))if(n.state=vi,n.onnext(),n.onstop(),n.err==null&&(n.err=e),n.pushes.length===0&&(typeof n.buffer>"u"||n.buffer.empty))$s(n);else try{for(var i=vs(n.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}function $s(n){var e,t;if(!(n.state>=el)){n.state<vi&&Dd(n),n.state=el,n.buffer=void 0;try{for(var r=vs(n.nexts),i=r.next();!i.done;i=r.next()){var s=i.value,o=n.pending===void 0?ts(n):n.pending.then(function(){return ts(n)});s.resolve(li(n,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}n.pushes=[],n.nexts=[]}}function bg(n){n.state>=Ou||(n.state<el&&$s(n),n.state=Ou)}function QM(n,e){if(Mu(e),n.pushes.length>=tl)throw new _0("No more than "+tl+" pending calls to push are allowed on a single repeater.");if(n.state>=vi)return Promise.resolve(void 0);var t=n.pending===void 0?Promise.resolve(e):n.pending.then(function(){return e});t=t.catch(function(l){n.state<vi&&(n.err=l),bg(n)});var r;if(n.nexts.length){var i=n.nexts.shift();i.resolve(li(n,t)),n.nexts.length?r=Promise.resolve(n.nexts[0].value):typeof n.buffer<"u"&&!n.buffer.full?r=Promise.resolve(void 0):r=new Promise(function(l){return n.onnext=l})}else typeof n.buffer<"u"&&!n.buffer.full?(n.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(l){return n.pushes.push({resolve:l,value:t})});var s=!0,o={},a=r.catch(function(l){if(s)throw l});return o.then=function(l,c){return s=!1,Promise.prototype.then.call(r,l,c)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(r,l)},o.finally=r.finally.bind(r),n.pending=t.then(function(){return a}).catch(function(l){n.err=l,bg(n)}),o}function eO(n){var e=Dd.bind(null,n),t=new Promise(function(r){return n.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function tO(n){if(!(n.state>=xg)){n.state=xg;var e=QM.bind(null,n),t=eO(n);n.execution=new Promise(function(r){return r(n.executor(e,t))}),n.execution.catch(function(){return Dd(n)})}}var ra=new WeakMap,Go=function(){function n(e,t){ra.set(this,{executor:e,buffer:t,err:void 0,state:Mc,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:rl,onstop:rl})}return n.prototype.next=function(e){Mu(e);var t=ra.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=tl)throw new _0("No more than "+tl+" pending calls to next are allowed on a single repeater.");if(t.state<=Mc&&tO(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=li(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return r}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,li(t,s.value)}else if(t.state>=vi)return $s(t),li(t,ts(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},n.prototype.return=function(e){Mu(e);var t=ra.get(this);if(t===void 0)throw new Error("WeakMap error");return $s(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),li(t,ts(t))},n.prototype.throw=function(e){var t=ra.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Mc||t.state>=vi||typeof t.buffer<"u"&&!t.buffer.empty?($s(t),t.err==null&&(t.err=e),li(t,ts(t))):this.next(Promise.reject(e))},n.prototype[Symbol.asyncIterator]=function(){return this},n.race=rO,n.merge=nO,n.zip=iO,n.latest=sO,n}();function Zl(n,e){var t,r,i=[],s=function(c){c!=null&&typeof c[Symbol.asyncIterator]=="function"?i.push(c[Symbol.asyncIterator]()):c!=null&&typeof c[Symbol.iterator]=="function"?i.push(c[Symbol.iterator]()):i.push(function(){return JM(this,arguments,function(){return Hn(this,function(d){switch(d.label){case 0:return e.yieldValues?[4,ho(c)]:[3,3];case 1:return[4,d.sent()];case 2:d.sent(),d.label=3;case 3:return e.returnValues?[4,ho(c)]:[3,5];case 4:return[2,d.sent()];case 5:return[2]}})})}())};try{for(var o=vs(n),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(c){t={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}function rO(n){var e=this,t=Zl(n,{returnValues:!0});return new Go(function(r,i){return hs(e,void 0,void 0,function(){var s,o,a,l,c,u;return Hn(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),l=void 0,c=0,u=function(){var d,f,p,g,m,y;return Hn(this,function(_){switch(_.label){case 0:d=c;try{for(f=(m=void 0,vs(t)),p=f.next();!p.done;p=f.next())g=p.value,Promise.resolve(g.next()).then(function(x){x.done?(i(),a===void 0&&(a=x)):c===d&&(c++,s(x))},function(x){return i(x)})}catch(x){m={error:x}}finally{try{p&&!p.done&&(y=f.return)&&y.call(f)}finally{if(m)throw m.error}}return[4,new Promise(function(x){return s=x})];case 1:return l=_.sent(),l===void 0?[3,3]:[4,r(l.value)];case 2:_.sent(),_.label=3;case 3:return[2]}})},h.label=2;case 2:return o?[3,4]:[5,u()];case 3:return h.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(d){return d.return&&d.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function nO(n){var e=this,t=Zl(n,{yieldValues:!0});return new Go(function(r,i){return hs(e,void 0,void 0,function(){var s,o,a,l=this;return Hn(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var u,h;o=!0;try{for(var d=vs(s),f=d.next();!f.done;f=d.next()){var p=f.value;p()}}catch(g){u={error:g}}finally{try{f&&!f.done&&(h=d.return)&&h.call(d)}finally{if(u)throw u.error}}}),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,Promise.all(t.map(function(u,h){return hs(l,void 0,void 0,function(){var d,f;return Hn(this,function(p){switch(p.label){case 0:p.trys.push([0,,6,9]),p.label=1;case 1:return o?[3,5]:(Promise.resolve(u.next()).then(function(g){return s[h](g)},function(g){return i(g)}),[4,new Promise(function(g){s[h]=g})]);case 2:return d=p.sent(),d===void 0?[3,4]:d.done?(a=d,[2]):[4,r(d.value)];case 3:p.sent(),p.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return f=u.return,f?[4,u.return()]:[3,8];case 7:f=p.sent(),p.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return c.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function iO(n){var e=this,t=Zl(n,{returnValues:!0});return new Go(function(r,i){return hs(e,void 0,void 0,function(){var s,o,a,l;return Hn(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),c.label=1;case 1:c.trys.push([1,,6,8]),c.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(u){return u.next()})).then(function(u){return s(u)},function(u){return i(u)}),[4,new Promise(function(u){return s=u})]);case 3:return a=c.sent(),a===void 0?[2]:(l=a.map(function(u){return u.value}),a.some(function(u){return u.done})?[2,l]:[4,r(l)]);case 4:return c.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(u){return u.return&&u.return()}))];case 7:return c.sent(),[7];case 8:return[2]}})})})}function sO(n){var e=this,t=Zl(n,{yieldValues:!0,returnValues:!0});return new Go(function(r,i){return hs(e,void 0,void 0,function(){var s,o,a,l,c,u=this;return Hn(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var d,f;s();try{for(var p=vs(o),g=p.next();!g.done;g=p.next()){var m=g.value;m()}}catch(y){d={error:y}}finally{try{g&&!g.done&&(f=p.return)&&f.call(p)}finally{if(d)throw d.error}}a=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(t.map(function(d){return d.next()})).then(function(d){return s(d)},function(d){return i(d)}),[4,new Promise(function(d){return s=d})];case 2:return l=h.sent(),l===void 0?[2]:(c=l.map(function(d){return d.value}),l.every(function(d){return d.done})?[2,c]:[4,r(c.slice())]);case 3:return h.sent(),[4,Promise.all(t.map(function(d,f){return hs(u,void 0,void 0,function(){var p;return Hn(this,function(g){switch(g.label){case 0:if(l[f].done)return[2,l[f].value];g.label=1;case 1:return a?[3,4]:(Promise.resolve(d.next()).then(function(m){return o[f](m)},function(m){return i(m)}),[4,new Promise(function(m){return o[f]=m})]);case 2:return p=g.sent(),p===void 0?[2,l[f].value]:p.done?[2,p.value]:(c[f]=p.value,[4,r(c.slice())]);case 3:return g.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(t.map(function(d){return d.return&&d.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}class Gd{constructor(e,t,r,i,s,o={}){ye(this,"headerClient");ye(this,"header");ye(this,"headerLength");ye(this,"indexLength");ye(this,"nocache");ye(this,"headers");this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=i,this.nocache=s,this.headers=o}static async open(e,t,r={}){let i,s=new Eg(e,t,r),o=2024+(()=>{let u,h=0;for(u=0;u<3;u++)h+=HM**u*YM;return h})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((u,h)=>pn[h]===u))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await s.getRange(12,i,o,"header"),l=Vl(new Or(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let c=Wl(l.featuresCount,l.indexNodeSize);return new Gd(s,l,i,c,t,r)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=this.headerClient,i=async(l,c)=>r.getRange(t+l,c,0,"index"),s=[],o=[];for await(let l of y0(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[c,u]=l,[,,h]=l;if(h||(h=4),o.length===0){o.push([c,h,u]);continue}let d=o[o.length-1];c-(d[0]+d[1])>Qa.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([c,h,u])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*Go.merge(a)}lengthBeforeTree(){return pn.length+or+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new Eg(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[r]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-r;for(let[l,,c]of e){let u=await this.readFeature(o,l,a);yield{id:c,feature:u},a=0}o.logUsage("feature")}async readFeature(e,t,r){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,r,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,r,"feature data")),a=new Uint8Array(i+or);a.set(o,or);let l=new Or(a);return l.setPosition(or),yr.getRootAsFeature(l)}}class Eg{constructor(e,t,r={}){ye(this,"httpClient");ye(this,"bytesEverUsed",0);ye(this,"bytesEverFetched",0);ye(this,"buffer",new ArrayBuffer(0));ye(this,"head",0);if(typeof e=="string")this.httpClient=new Tg(e,t,r);else if(e instanceof Tg)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,r,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,r);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Tg{constructor(e,t,r={}){ye(this,"url");ye(this,"nocache");ye(this,"headers");ye(this,"requestsEverMade",0);ye(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=r}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}async function*oO(n,e,t,r){if(!n.subarray(0,3).every((h,d)=>pn[d]===h))throw Error("Not a FlatGeobuf file");if(t){let h=Nd.open(n);for await(let d of h.selectBbox(t))yield e(d.id,d.feature,h.header);return}let i=new Or(n),s=i.readUint32(pn.length);i.setPosition(pn.length+or);let o=Vl(i),a=pn.length+or+s,{indexNodeSize:l,featuresCount:c}=o;l>0&&(a+=Wl(c,l));let u=0;for(;a<i.capacity();){let h=i.readUint32(a);i.setPosition(a+or);let d=yr.getRootAsFeature(i);yield e(u++,d,o),a+=or+h}}async function*aO(n,e,t){let r,i=ZM(n),s=async f=>await i.slice(f),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((f,p)=>pn[p]===f))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new Or(o),l=a.readUint32(0);o=new Uint8Array(await s(l));let c=Vl(a=new Or(o)),{indexNodeSize:u,featuresCount:h}=c;if(u>0){let f=Wl(h,u);await s(f)}let d=0;for(;r=await cO(s,c,e,d++);)yield r}async function*lO(n,e,t,r,i=!1,s={}){let o=await Gd.open(n,i,s);for await(let a of o.selectBbox(e))yield t(a.id,a.feature,o.header)}async function cO(n,e,t,r){let i=new Uint8Array(await n(4,"feature length"));if(i.byteLength===0)return;let s=new Or(i),o=s.readUint32(0);i=new Uint8Array(await n(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new Or(a)).setPosition(or),t(r,yr.getRootAsFeature(s),e)}function Nu(n,e){let t=e;if(t===At.Unknown&&(t=n.type()),t===At.GeometryCollection){let i=[];for(let s=0;s<n.partsLength();s++){let o=n.parts(s),a=o.type();i.push(Nu(o,a))}return{type:At[t],geometries:i}}if(t===At.MultiPolygon){let i=[];for(let s=0;s<n.partsLength();s++)i.push(Nu(n.parts(s),At.Polygon));return{type:At[t],coordinates:i.map(s=>s.coordinates)}}let r=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case At.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case At.MultiPoint:case At.LineString:return Fc(o,a);case At.MultiLineString:case At.Polygon:return function(l,c,u){let h;if(!u||u.length===0)return[Fc(l,c)];let d=0,f=Array.from(u).map(p=>l.slice(d,d=p<<1));return c&&(d=0,h=Array.from(u).map(p=>c.slice(d,d=p))),f.map((p,g)=>Fc(p,h?h[g]:void 0))}(o,a,i.endsArray())}}(n,t);return{type:At[t],coordinates:r}}function kd(n,e,t){let r=t.columns;return{type:"Feature",id:n,geometry:Nu(e.geometry(),t.geometryType),properties:$M(e,r)}}async function*uO(n,e,t){yield*oO(n,kd,e)}function hO(n,e){return aO(n,kd)}function dO(n,e,t,r=!1,i={}){return lO(n,e,kd,t,r,i)}function fO(n,e,t,r=!1,i={}){return n instanceof Uint8Array?uO(n,e):n instanceof ReadableStream?hO(n):dO(n,e,t,r,i)}class pO extends Uu{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX,strategy:Wx}),this.dataProjection=e.projection||Zx.dataProjection,this.resourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const r=Yx(e,t.getCode(),this.dataProjection);return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}}async loader(e,t,r,i,s){const o=this.fgbBoundingBox(e,r);try{if(o.minX!==-1/0){const a=[],l=fO(this.resourceURL,o),c=new Hx({featureProjection:r,dataProjection:this.dataProjection});for await(const u of l){const h=c.readFeature(u);a.push(h)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={BingMaps:PF,CartoDB:IF,Cluster:Ka,DataTile:jl,GeoTIFF:o0,Google:QF,IIIF:tM,Image:Ci,ImageArcGISRest:nM,ImageCanvas:iM,ImageMapGuide:lM,ImageStatic:uM,ImageTile:u0,OGCMapTile:bM,OGCVectorTile:EM,Raster:m0,Source:Ku,StadiaMaps:OM,TileArcGISRest:NM,TileDebug:DM,TileImage:wn,TileJSON:GM,UrlTile:qx,UTFGrid:UM,Zoomify:eM,WMTSCapabilities:zM,FlatGeoBuf:pO};const YO=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{zO as L,$O as a,YO as i};
