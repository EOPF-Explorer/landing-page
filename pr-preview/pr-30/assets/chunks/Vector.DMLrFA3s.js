var Bi=Object.defineProperty;var Xi=(c,t,e)=>t in c?Bi(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var Ke=(c,t,e)=>Xi(c,typeof t!="symbol"?t+"":t,e);import{G as Rt,H as ye,J as Ce,K as ut,L as j,N as zt,O as qt,Q as ot,R as at,T as $t,U as Qt,Y as te,Z as Yi,_ as pt,$ as ee,a0 as bt,a1 as li,a2 as Ni,r as Ki,a3 as Ue,a4 as gt,a5 as Ui,a6 as Ft,a7 as K,a8 as Hi,a9 as Tt,aa as Vi,ab as He,ac as yt,ad as Zi,ae as ji,af as Ji,z as hi,ag as zi,ah as Pt,ai as qi,aj as Ve,ak as $i,al as Qi,am as ts,C as es,an as is,ao as ss,ap as ns,aq as It,ar as Vt,as as rs,at as os,au as as,av as ls,aw as hs,S as le,ax as cs,ay as ds,az as us,aA as ci,aB as fs,aC as di,aD as gs,aE as _s,aF as ui,aG as xs,aH as ps,m as Ze,aI as ms,aJ as ys,aK as Cs,aL as Ss,aM as je,aN as fi,aO as Es,aP as Rs,P as Je,aQ as Is,aR as Ts,aS as Fs,aT as ws,x as Ls,aU as ks,aV as Ds}from"./XYZ.DipmalTG.js";import{l as Se,m as Ms,R as As,r as vs,n as Bt,o as Os,p as we,q as J,i as rt,u as N,c as Ee,v as Gt,w as Ps,x as jt,y as ie,z as bs,t as Gs,a as ze,h as Ws,e as Bs,d as Xs,g as Ys,A as St,C as se,D as Ot,G as Ns,H as Ks,I as Us,J as ne,K as re,E as Le,M as Jt,N as gi,O as Hs,P as Xt,Q as Vs,S as Zs,k as _i,U as lt,s as js,V as Js,W as zs,X as qs,Y as xi,Z as $s,_ as Qs,$ as tn,a0 as qe,a1 as en,T as sn,B as nn}from"./Group.BuEEX7y8.js";import{R as rn}from"./index.jYV8uuws.js";class pi{drawCustom(t,e,i,s,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const R={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Zt=[R.FILL],ft=[R.STROKE],mt=[R.BEGIN_PATH],$e=[R.CLOSE_PATH];class Yt extends pi{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let r=n.length;for(let o=0,a=t.length;o<a;o+=e)s[0]=t[o],s[1]=t[o+1],Se(i,s)&&(n[r++]=s[0],n[r++]=s[1]);return r}appendFlatLineCoordinates(t,e,i,s,n,r){const o=this.coordinates;let a=o.length;const h=this.getBufferedMaxExtent();r&&(e+=s);let l=t[e],d=t[e+1];const u=this.tmpCoordinate_;let f=!0,_,p,g;for(_=e+s;_<i;_+=s)u[0]=t[_],u[1]=t[_+1],g=Ms(h,u),g!==p?(f&&(o[a++]=l,o[a++]=d,f=!1),o[a++]=u[0],o[a++]=u[1]):g===As.INTERSECTING?(o[a++]=u[0],o[a++]=u[1],f=!1):f=!0,l=u[0],d=u[1],p=g;return(n&&f||_===e+s)&&(o[a++]=l,o[a++]=d),a}drawCustomCoordinates_(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const a=i[r],h=this.appendFlatLineCoordinates(t,e,a,s,!1,!1);n.push(h),e=a}return e}drawCustom(t,e,i,s,n){this.beginGeometry(t,e,n);const r=t.getType(),o=t.getStride(),a=this.coordinates.length;let h,l,d,u,f;switch(r){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),u=[];const _=t.getEndss();f=0;for(let p=0,g=_.length;p<g;++p){const x=[];f=this.drawCustomCoordinates_(h,f,_[p],o,x),u.push(x)}this.instructions.push([R.CUSTOM,a,u,t,i,Ce,n]),this.hitDetectionInstructions.push([R.CUSTOM,a,u,t,s||i,Ce,n]);break;case"Polygon":case"MultiLineString":d=[],h=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,t.getEnds(),o,d),this.instructions.push([R.CUSTOM,a,d,t,i,ye,n]),this.hitDetectionInstructions.push([R.CUSTOM,a,d,t,s||i,ye,n]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(h,0,h.length,o,!1,!1),this.instructions.push([R.CUSTOM,a,l,t,i,Rt,n]),this.hitDetectionInstructions.push([R.CUSTOM,a,l,t,s||i,Rt,n]);break;case"MultiPoint":h=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(h,o),l>a&&(this.instructions.push([R.CUSTOM,a,l,t,i,Rt,n]),this.hitDetectionInstructions.push([R.CUSTOM,a,l,t,s||i,Rt,n]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),l=this.coordinates.length,this.instructions.push([R.CUSTOM,a,l,t,i,void 0,n]),this.hitDetectionInstructions.push([R.CUSTOM,a,l,t,s||i,void 0,n]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[R.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[R.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,n,r=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==R.END_GEOMETRY?r=e:n==R.BEGIN_GEOMETRY&&(s[2]=e,vs(this.hitDetectionInstructions,r,e),r=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=ut(i||j)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=ut(i||zt);const s=t.getLineCap();e.lineCap=s!==void 0?s:qt;const n=t.getLineDash();e.lineDash=n?n.slice():ot;const r=t.getLineDashOffset();e.lineDashOffset=r||at;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:$t;const a=t.getWidth();e.lineWidth=a!==void 0?a:Qt;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:te,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[R.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[R.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!Bt(t.currentLineDash,n)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=h)&&(e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[R.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Os(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;we(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class on extends Yt{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!Se(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,n);this.instructions.push([R.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([R.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=[];for(let a=0,h=s.length;a<h;a+=t.getStride())(!this.maxExtent||Se(this.maxExtent,s.slice(a,a+2)))&&n.push(s[a],s[a+1]);const r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,2);this.instructions.push([R.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([R.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class an extends Yt{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[R.MOVE_TO_LINE_TO,n,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const s=this.state,n=s.strokeStyle,r=s.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([R.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,ot,at],mt);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ft),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,n=s.strokeStyle,r=s.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([R.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,ot,at],mt);const o=t.getEnds(),a=t.getFlatCoordinates(),h=t.getStride();let l=0;for(let d=0,u=o.length;d<u;++d)l=this.drawFlatCoordinates_(a,l,o[d],h);this.hitDetectionInstructions.push(ft),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ft),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ft),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(mt)}}class Qe extends Yt{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,r=n.fillStyle!==void 0,o=n.strokeStyle!==void 0,a=i.length;this.instructions.push(mt),this.hitDetectionInstructions.push(mt);for(let h=0;h<a;++h){const l=i[h],d=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,l,s,!0,!o),f=[R.MOVE_TO_LINE_TO,d,u];this.instructions.push(f),this.hitDetectionInstructions.push(f),o&&(this.instructions.push($e),this.hitDetectionInstructions.push($e)),e=l}return r&&(this.instructions.push(Zt),this.hitDetectionInstructions.push(Zt)),o&&(this.instructions.push(ft),this.hitDetectionInstructions.push(ft)),e}drawCircle(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_FILL_STYLE,j]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,ot,at]);const o=t.getFlatCoordinates(),a=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const l=[R.CIRCLE,h];this.instructions.push(mt,l),this.hitDetectionInstructions.push(mt,l),s.fillStyle!==void 0&&(this.instructions.push(Zt),this.hitDetectionInstructions.push(Zt)),s.strokeStyle!==void 0&&(this.instructions.push(ft),this.hitDetectionInstructions.push(ft)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_FILL_STYLE,j]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,ot,at]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(a,0,o,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_FILL_STYLE,j]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([R.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,ot,at]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),h=t.getStride();let l=0;for(let d=0,u=o.length;d<u;++d)l=this.drawFlatCoordinatess_(a,l,o[d],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=Yi(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}}function ln(c,t,e,i,s){const n=[];let r=e,o=0,a=t.slice(e,2);for(;o<c&&r+s<i;){const[h,l]=a.slice(-2),d=t[r+s],u=t[r+s+1],f=Math.sqrt((d-h)*(d-h)+(u-l)*(u-l));if(o+=f,o>=c){const _=(c-o+f)/f,p=J(h,d,_),g=J(l,u,_);a.push(p,g),n.push(a),a=[p,g],o==c&&(r+=s),o=0}else if(o<c)a.push(t[r+s],t[r+s+1]),r+=s;else{const _=f-o,p=J(h,d,_/f),g=J(l,u,_/f);a.push(p,g),n.push(a),a=[p,g],o=0,r+=s}}return o>0&&n.push(a),n}function hn(c,t,e,i,s){let n=e,r=e,o=0,a=0,h=e,l,d,u,f,_,p,g,x,m,S;for(d=e;d<i;d+=s){const y=t[d],E=t[d+1];_!==void 0&&(m=y-_,S=E-p,f=Math.sqrt(m*m+S*S),g!==void 0&&(a+=u,l=Math.acos((g*m+x*S)/(u*f)),l>c&&(a>o&&(o=a,n=h,r=d),a=0,h=d-s)),u=f,g=m,x=S),_=y,p=E}return a+=f,a>o?[h,d]:[n,r]}const oe={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class cn extends Yt{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[j]={fillStyle:j},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,n=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!s&&!n)return;const o=this.coordinates;let a=o.length;const h=t.getType();let l=null,d=t.getStride();if(r.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!rt(this.maxExtent,t.getExtent()))return;let u;if(l=t.getFlatCoordinates(),h=="LineString")u=[l.length];else if(h=="MultiLineString")u=t.getEnds();else if(h=="Polygon")u=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const g=t.getEndss();u=[];for(let x=0,m=g.length;x<m;++x)u.push(g[x][0])}this.beginGeometry(t,e,i);const f=r.repeat,_=f?void 0:r.textAlign;let p=0;for(let g=0,x=u.length;g<x;++g){let m;f?m=ln(f*this.resolution,l,p,u[g],d):m=[l.slice(p,u[g])];for(let S=0,y=m.length;S<y;++S){const E=m[S];let I=0,T=E.length;if(_==null){const F=hn(r.maxAngle,E,0,E.length,2);I=F[0],T=F[1]}for(let F=I;F<T;F+=d)o.push(E[F],E[F+1]);const L=o.length;p=u[g],this.drawChars_(a,L),a=L}}this.endGeometry(e)}else{let u=r.overflow?null:[];switch(h){case"Point":case"MultiPoint":l=t.getFlatCoordinates();break;case"LineString":l=t.getFlatMidpoint();break;case"Circle":l=t.getCenter();break;case"MultiLineString":l=t.getFlatMidpoints(),d=2;break;case"Polygon":l=t.getFlatInteriorPoint(),r.overflow||u.push(l[2]/this.resolution),d=3;break;case"MultiPolygon":const y=t.getFlatInteriorPoints();l=[];for(let E=0,I=y.length;E<I;E+=3)r.overflow||u.push(y[E+2]/this.resolution),l.push(y[E],y[E+1]);if(l.length===0)return;d=2;break}const f=this.appendFlatPointCoordinates(l,d);if(f===a)return;if(u&&(f-a)/2!==l.length/d){let y=a/2;u=u.filter((E,I)=>{const T=o[(y+I)*2]===l[I*d]&&o[(y+I)*2+1]===l[I*d+1];return T||--y,T})}this.saveTextStates_();const _=r.backgroundFill?this.createFill(this.fillStyleToState(r.backgroundFill)):null,p=r.backgroundStroke?this.createStroke(this.strokeStyleToState(r.backgroundStroke)):null;this.beginGeometry(t,e,i);let g=r.padding;if(g!=pt&&(r.scale[0]<0||r.scale[1]<0)){let y=r.padding[0],E=r.padding[1],I=r.padding[2],T=r.padding[3];r.scale[0]<0&&(E=-E,T=-T),r.scale[1]<0&&(y=-y,I=-I),g=[y,E,I,T]}const x=this.pixelRatio;this.instructions.push([R.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==pt?pt:g.map(function(y){return y*x}),_,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const m=1/x,S=_?_.slice(0):null;S&&(S[1]=j),this.hitDetectionInstructions.push([R.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,g,S,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?j:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||bt,justify:e.justify,textBaseline:e.textBaseline||ee,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,h=oe[s.textBaseline],l=this.textOffsetY_*a,d=this.text_,u=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([R.DRAW_CHARS,t,e,h,s.overflow,o,s.maxAngle,a,l,n,u*a,d,r,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([R.DRAW_CHARS,t,e,h,s.overflow,o&&j,s.maxAngle,a,l,n,u*a,d,r,1/a,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,s,n;if(!t)this.text_="";else{const r=t.getFill();r?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=ut(r.getColor()||j)):(s=null,this.textFillState_=s);const o=t.getStroke();if(!o)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const p=o.getLineDash(),g=o.getLineDashOffset(),x=o.getWidth(),m=o.getMiterLimit();n.lineCap=o.getLineCap()||qt,n.lineDash=p?p.slice():ot,n.lineDashOffset=g===void 0?at:g,n.lineJoin=o.getLineJoin()||$t,n.lineWidth=x===void 0?Qt:x,n.miterLimit=m===void 0?te:m,n.strokeStyle=ut(o.getColor()||zt)}i=this.textState_;const a=t.getFont()||li;Ni(a);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=a,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||ee,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||pt,i.scale=h===void 0?[1,1]:h;const l=t.getOffsetX(),d=t.getOffsetY(),u=t.getRotateWithView(),f=t.getKeepUpright(),_=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=l===void 0?0:l,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=u===void 0?!1:u,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=_===void 0?0:_,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:N(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+N(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const dn={Circle:Qe,Default:Yt,Image:on,LineString:an,Polygon:Qe,Text:cn};class un{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];if(n===void 0){const r=dn[e];n=new r(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n}return n}}function ke(c,t,e,i){let s=c[t],n=c[t+1],r=0;for(let o=t+i;o<e;o+=i){const a=c[o],h=c[o+1];r+=Math.sqrt((a-s)*(a-s)+(h-n)*(h-n)),s=a,n=h}return r}function fn(c,t,e,i,s,n,r,o,a,h,l,d,u=!0){let f=c[t],_=c[t+1],p=0,g=0,x=0,m=0;function S(){p=f,g=_,t+=i,f=c[t],_=c[t+1],m+=x,x=Math.sqrt((f-p)*(f-p)+(_-g)*(_-g))}do S();while(t<e-i&&m+x<n);let y=x===0?0:(n-m)/x;const E=J(p,f,y),I=J(g,_,y),T=t-i,L=m,F=n+o*a(h,s,l);for(;t<e-i&&m+x<F;)S();y=x===0?0:(F-m)/x;const b=J(p,f,y),P=J(g,_,y);let D=!1;if(u)if(d){const k=[E,I,b,P];Ki(k,0,4,2,d,k,k),D=k[0]>k[2]}else D=E>b;const O=Math.PI,G=[],w=T+i===t;t=T,x=0,m=L,f=c[t],_=c[t+1];let v;if(w){S(),v=Math.atan2(_-g,f-p),D&&(v+=v>0?-O:O);const k=(b+E)/2,M=(P+I)/2;return G[0]=[k,M,(F-n)/2,v,s],G}s=s.replace(/\n/g," ");for(let k=0,M=s.length;k<M;){S();let A=Math.atan2(_-g,f-p);if(D&&(A+=A>0?-O:O),v!==void 0){let q=A-v;if(q+=q>O?-2*O:q<-O?2*O:0,Math.abs(q)>r)return null}v=A;const W=k;let X=0;for(;k<M;++k){const q=D?M-k-1:k,Nt=o*a(h,s[q],l);if(t+i<e&&m+x<n+X+Nt/2)break;X+=Nt}if(k===W)continue;const C=D?s.substring(M-W,M-k):s.substring(W,k);y=x===0?0:(n+X/2-m)/x;const wt=J(p,f,y),Lt=J(g,_,y);G.push([wt,Lt,X/2,A,C]),n+=X}return G}class mi{constructor(){Ke(this,"pushMethodArgs_",(...t)=>(this.push_(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ue(),{get:(t,e)=>{if(typeof Ue()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,i)=>(this.push_(e,i),!0)})}push_(...t){const e=this.instructions_,i=this.zIndex+this.offset_;e[i]||(e[i]=[]),e[i].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,s=e.length;i<s;++i){const n=e[i];if(typeof n=="function"){n(t);continue}const r=e[++i];if(typeof t[n]=="function")t[n](...r);else{if(typeof r=="function"){t[n]=r(t);continue}t[n]=r}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Ct=Gt(),ht=[],st=[],nt=[],ct=[];function ti(c){return c[3].declutterBox}const ei=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function xe(c,t){return t==="start"?t=ei.test(c)?"right":"left":t==="end"&&(t=ei.test(c)?"left":"right"),oe[t]}function gn(c,t,e){return e>0&&c.push(`
`,""),c.push(t,""),c}function _n(c,t,e){return e%2===0&&(c+=t),c}class xn{constructor(t,e,i,s,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=gt(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new mi:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const r=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],h=this.pixelRatio,l=[a.scale[0]*h,a.scale[1]*h],d=a.justify?oe[a.justify]:xe(Array.isArray(t)?t[0]:t,a.textAlign||bt),u=s&&r.lineWidth?r.lineWidth:0,f=Array.isArray(t)?t:String(t).split(`
`).reduce(gn,[]),{width:_,height:p,widths:g,heights:x,lineWidths:m}=Ui(a,f),S=_+u,y=[],E=(S+2)*l[0],I=(p+u)*l[1],T={width:E<0?Math.floor(E):Math.ceil(E),height:I<0?Math.floor(I):Math.ceil(I),contextInstructions:y};(l[0]!=1||l[1]!=1)&&y.push("scale",l),s&&(y.push("strokeStyle",r.strokeStyle),y.push("lineWidth",u),y.push("lineCap",r.lineCap),y.push("lineJoin",r.lineJoin),y.push("miterLimit",r.miterLimit),y.push("setLineDash",[r.lineDash]),y.push("lineDashOffset",r.lineDashOffset)),i&&y.push("fillStyle",o.fillStyle),y.push("textBaseline","middle"),y.push("textAlign","center");const L=.5-d;let F=d*S+L*u;const b=[],P=[];let D=0,O=0,G=0,w=0,v;for(let k=0,M=f.length;k<M;k+=2){const A=f[k];if(A===`
`){O+=D,D=0,F=d*S+L*u,++w;continue}const W=f[k+1]||a.font;W!==v&&(s&&b.push("font",W),i&&P.push("font",W),v=W),D=Math.max(D,x[G]);const X=[A,F+L*g[G]+d*(g[G]-m[w]),.5*(u+D)+O];F+=g[G],s&&b.push("strokeText",X),i&&P.push("fillText",X),++G}return Array.prototype.push.apply(y,b),Array.prototype.push.apply(y,P),this.labels_[n]=T,T}replayTextBackground_(t,e,i,s,n,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),r&&(this.alignAndScaleFill_=r[2],t.fillStyle=r[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,r,o,a,h,l,d,u,f,_,p,g){o*=u[0],a*=u[1];let x=i-o,m=s-a;const S=n+h>t?t-h:n,y=r+l>e?e-l:r,E=_[3]+S*u[0]+_[1],I=_[0]+y*u[1]+_[2],T=x-_[3],L=m-_[0];(p||d!==0)&&(ht[0]=T,ct[0]=T,ht[1]=L,st[1]=L,st[0]=T+E,nt[0]=st[0],nt[1]=L+I,ct[1]=nt[1]);let F;return d!==0?(F=Ft(gt(),i,s,1,1,d,-i,-s),K(F,ht),K(F,st),K(F,nt),K(F,ct),Ee(Math.min(ht[0],st[0],nt[0],ct[0]),Math.min(ht[1],st[1],nt[1],ct[1]),Math.max(ht[0],st[0],nt[0],ct[0]),Math.max(ht[1],st[1],nt[1],ct[1]),Ct)):Ee(Math.min(T,T+E),Math.min(L,L+I),Math.max(T,T+E),Math.max(L,L+I),Ct),f&&(x=Math.round(x),m=Math.round(m)),{drawImageX:x,drawImageY:m,drawImageW:S,drawImageH:y,originX:h,originY:l,declutterBox:{minX:Ct[0],minY:Ct[1],maxX:Ct[2],maxY:Ct[3],value:g},canvasTransform:F,scale:u}}replayImageOrLabel_(t,e,i,s,n,r,o){const a=!!(r||o),h=s.declutterBox,l=o?o[2]*s.scale[0]/2:0;return h.minX-l<=e[0]&&h.maxX+l>=0&&h.minY-l<=e[1]&&h.maxY+l>=0&&(a&&this.replayTextBackground_(t,ht,st,nt,ct,r,o),Hi(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=K(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),e!==1&&t.scale(e,e)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],e[1]&&(t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6]))}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],r=this.createLabel(t,e,s,i),o=this.strokeStates[i],a=this.pixelRatio,h=xe(Array.isArray(t)?t[0]:t,n.textAlign||bt),l=oe[n.textBaseline||ee],d=o&&o.lineWidth?o.lineWidth:0,u=r.width/a-2*n.scale[0],f=h*u+2*(.5-h)*d,_=l*r.height/a+2*(.5-l)*d;return{label:r,anchorX:f,anchorY:_}}execute_(t,e,i,s,n,r,o,a){const h=this.zIndexContext_;let l;this.pixelCoordinates_&&Bt(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=Tt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Vi(this.renderedTransform_,i));let d=0;const u=s.length;let f=0,_,p,g,x,m,S,y,E,I,T,L,F,b,P=0,D=0;const O=this.coordinateCache_,G=this.viewRotation_,w=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,v={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:G},k=this.instructions!=s||this.overlaps?0:200;let M,A,W,X;for(;d<u;){const C=s[d];switch(C[0]){case R.BEGIN_GEOMETRY:M=C[1],X=C[3],M.getGeometry()?o!==void 0&&!rt(o,X.getExtent())?d=C[2]+1:++d:d=C[2],h&&(h.zIndex=C[4]);break;case R.BEGIN_PATH:P>k&&(this.fill_(t),P=0),D>k&&(t.stroke(),D=0),!P&&!D&&(t.beginPath(),m=NaN,S=NaN),++d;break;case R.CIRCLE:f=C[1];const Lt=l[f],q=l[f+1],Nt=l[f+2],wi=l[f+3],Me=Nt-Lt,Ae=wi-q,ve=Math.sqrt(Me*Me+Ae*Ae);t.moveTo(Lt+ve,q),t.arc(Lt,q,ve,0,2*Math.PI,!0),++d;break;case R.CLOSE_PATH:t.closePath(),++d;break;case R.CUSTOM:f=C[1],_=C[2];const Li=C[3],ki=C[4],Oe=C[5];v.geometry=Li,v.feature=M,d in O||(O[d]=[]);const kt=O[d];Oe?Oe(l,f,_,2,kt):(kt[0]=l[f],kt[1]=l[f+1],kt.length=2),h&&(h.zIndex=C[6]),ki(kt,v),++d;break;case R.DRAW_IMAGE:f=C[1],_=C[2],I=C[3],p=C[4],g=C[5];let he=C[6];const Di=C[7],Mi=C[8],Ai=C[9],Pe=C[10];let ce=C[11];const vi=C[12];let Kt=C[13];x=C[14]||"declutter";const Dt=C[15];if(!I&&C.length>=20){T=C[19],L=C[20],F=C[21],b=C[22];const U=this.drawLabelWithPointPlacement_(T,L,F,b);I=U.label,C[3]=I;const _t=C[23];p=(U.anchorX-_t)*this.pixelRatio,C[4]=p;const H=C[24];g=(U.anchorY-H)*this.pixelRatio,C[5]=g,he=I.height,C[6]=he,Kt=I.width,C[13]=Kt}let de;C.length>25&&(de=C[25]);let ue,Ut,Ht;C.length>17?(ue=C[16],Ut=C[17],Ht=C[18]):(ue=pt,Ut=null,Ht=null),Pe&&w?ce+=G:!Pe&&!w&&(ce-=G);let Oi=0;for(;f<_;f+=2){if(de&&de[Oi++]<Kt/this.pixelRatio)continue;const U=this.calculateImageOrLabelDimensions_(I.width,I.height,l[f],l[f+1],Kt,he,p,g,Mi,Ai,ce,vi,n,ue,!!Ut||!!Ht,M),_t=[t,e,I,U,Di,Ut,Ht];if(a){let H,$,V;if(Dt){const B=_-f;if(!Dt[B]){Dt[B]={args:_t,declutterMode:x};continue}const Y=Dt[B];H=Y.args,$=Y.declutterMode,delete Dt[B],V=ti(H)}let tt,et;if(H&&($!=="declutter"||!a.collides(V))&&(tt=!0),(x!=="declutter"||!a.collides(U.declutterBox))&&(et=!0),$==="declutter"&&x==="declutter"){const B=tt&&et;tt=B,et=B}tt&&($!=="none"&&a.insert(V),this.replayImageOrLabel_.apply(this,H)),et&&(x!=="none"&&a.insert(U.declutterBox),this.replayImageOrLabel_.apply(this,_t))}else this.replayImageOrLabel_.apply(this,_t)}++d;break;case R.DRAW_CHARS:const be=C[1],Ge=C[2],fe=C[3],Pi=C[4];b=C[5];const bi=C[6],We=C[7],Be=C[8];F=C[9];const ge=C[10];T=C[11],Array.isArray(T)&&(T=T.reduce(_n,"")),L=C[12];const Xe=[C[13],C[13]];x=C[14]||"declutter";const Gi=C[15],_e=this.textStates[L],Mt=_e.font,At=[_e.scale[0]*We,_e.scale[1]*We];let vt;Mt in this.widths_?vt=this.widths_[Mt]:(vt={},this.widths_[Mt]=vt);const Ye=ke(l,be,Ge,2),Ne=Math.abs(At[0])*He(Mt,T,vt);if(Pi||Ne<=Ye){const U=this.textStates[L].textAlign,_t=(Ye-Ne)*xe(T,U),H=fn(l,be,Ge,2,T,_t,bi,Math.abs(At[0]),He,Mt,vt,w?0:this.viewRotation_,Gi);t:if(H){const $=[];let V,tt,et,B,Y;if(F)for(V=0,tt=H.length;V<tt;++V){Y=H[V],et=Y[4],B=this.createLabel(et,L,"",F),p=Y[2]+(At[0]<0?-ge:ge),g=fe*B.height+(.5-fe)*2*ge*At[1]/At[0]-Be;const it=this.calculateImageOrLabelDimensions_(B.width,B.height,Y[0],Y[1],B.width,B.height,p,g,0,0,Y[3],Xe,!1,pt,!1,M);if(a&&x==="declutter"&&a.collides(it.declutterBox))break t;$.push([t,e,B,it,1,null,null])}if(b)for(V=0,tt=H.length;V<tt;++V){Y=H[V],et=Y[4],B=this.createLabel(et,L,b,""),p=Y[2],g=fe*B.height-Be;const it=this.calculateImageOrLabelDimensions_(B.width,B.height,Y[0],Y[1],B.width,B.height,p,g,0,0,Y[3],Xe,!1,pt,!1,M);if(a&&x==="declutter"&&a.collides(it.declutterBox))break t;$.push([t,e,B,it,1,null,null])}a&&x!=="none"&&a.load($.map(ti));for(let it=0,Wi=$.length;it<Wi;++it)this.replayImageOrLabel_.apply(this,$[it])}}++d;break;case R.END_GEOMETRY:if(r!==void 0){M=C[1];const U=r(M,X,x);if(U)return U}++d;break;case R.FILL:k?P++:this.fill_(t),++d;break;case R.MOVE_TO_LINE_TO:for(f=C[1],_=C[2],A=l[f],W=l[f+1],t.moveTo(A,W),m=A+.5|0,S=W+.5|0,f+=2;f<_;f+=2)A=l[f],W=l[f+1],y=A+.5|0,E=W+.5|0,(f==_-2||y!==m||E!==S)&&(t.lineTo(A,W),m=y,S=E);++d;break;case R.SET_FILL_STYLE:this.alignAndScaleFill_=C[2],P&&(this.fill_(t),P=0,D&&(t.stroke(),D=0)),t.fillStyle=C[1],++d;break;case R.SET_STROKE_STYLE:D&&(t.stroke(),D=0),this.setStrokeStyle_(t,C),++d;break;case R.STROKE:k?D++:t.stroke(),++d;break;default:++d;break}}P&&this.fill_(t),D&&t.stroke()}execute(t,e,i,s,n,r){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,r)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,n)}}const xt=["Polygon","Circle","LineString","Image","Text","Default"],yi=["Image","Text"],pn=xt.filter(c=>!yi.includes(c));let Ci=!1,Si=!1;function mn(){let c=0;const t=i=>{const s=yt(1,1,null,{willReadFrequently:i});let n=0;const r=performance.now();for(;performance.now()-r<50;++n)s.fillStyle=`rgba(255,0,${n%256},1)`,s.fillRect(0,0,1,1),s.getImageData(0,0,1,1);return c=n>c?n:c,n};Ci={[t(!0)]:!0,[t(!1)]:!1,[t(void 0)]:void 0}[c],Si=!0}class yn{constructor(t,e,i,s,n,r,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=gt(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(n,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const n=t[i];for(const r in n){const o=n[r];s[r]=new xn(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,n=t.length;s<n;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,n,r){Si===!1&&mn(),s=Math.round(s);const o=s*2+1,a=Ft(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=yt(o,o,null,{willReadFrequently:Ci}));const l=this.hitDetectionContext_;l.canvas.width!==o||l.canvas.height!==o?(l.canvas.width=o,l.canvas.height=o):h||l.clearRect(0,0,o,o);let d;this.renderBuffer_!==void 0&&(d=Gt(),Ps(d,t),we(d,e*(this.renderBuffer_+s),d));const u=Cn(s);let f;function _(E,I,T){const L=l.getImageData(0,0,o,o).data;for(let F=0,b=u.length;F<b;F++)if(L[u[F]]>0){if(!r||T==="none"||f!=="Image"&&f!=="Text"||r.includes(E)){const P=(u[F]-3)/4,D=s-P%o,O=s-(P/o|0),G=n(E,I,D*D+O*O);if(G)return G}l.clearRect(0,0,o,o);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(jt);let g,x,m,S,y;for(g=p.length-1;g>=0;--g){const E=p[g].toString();for(m=this.executorsByZIndex_[E],x=xt.length-1;x>=0;--x)if(f=xt[x],S=m[f],S!==void 0&&(y=S.executeHitDetection(l,a,i,_,d),y))return y}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],r=e[3],o=[i,s,i,r,n,r,n,s];return Tt(o,0,8,2,t,o),o}isEmpty(){return ie(this.executorsByZIndex_)}execute(t,e,i,s,n,r,o){const a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(o?bs:jt),r=r||xt;const h=xt.length;for(let l=0,d=a.length;l<d;++l){const u=a[l].toString(),f=this.executorsByZIndex_[u];for(let _=0,p=r.length;_<p;++_){const g=r[_],x=f[g];if(x!==void 0){const m=o===null?void 0:x.getZIndexContext(),S=m?m.getContext():t,y=this.maxExtent_&&g!=="Image"&&g!=="Text";if(y&&(S.save(),this.clip(S,i)),!m||g==="Text"||g==="Image"?x.execute(S,e,i,s,n,o):m.pushFunction(E=>x.execute(E,e,i,s,n,o)),y&&S.restore(),m){m.offset();const E=a[l]*h+xt.indexOf(g);this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(m)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(jt);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(n=>{n.draw(this.renderedContext_),n.clear()}),t[e[i]].length=0}}const pe={};function Cn(c){if(pe[c]!==void 0)return pe[c];const t=c*2+1,e=c*c,i=new Array(e+1);for(let n=0;n<=c;++n)for(let r=0;r<=c;++r){const o=n*n+r*r;if(o>e)break;let a=i[o];a||(a=[],i[o]=a),a.push(((c+n)*t+(c+r))*4+3),n>0&&a.push(((c-n)*t+(c+r))*4+3),r>0&&(a.push(((c+n)*t+(c-r))*4+3),n>0&&a.push(((c-n)*t+(c-r))*4+3))}const s=[];for(let n=0,r=i.length;n<r;++n)i[n]&&s.push(...i[n]);return pe[c]=s,s}class Sn extends pi{constructor(t,e,i,s,n,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Gs(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=gt()}drawImages_(t,e,i,s){if(!this.image_)return;const n=Tt(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=a*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let l=0,d=n.length;l<d;l+=2){const u=n[l]-this.imageAnchorX_,f=n[l+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const _=u+this.imageAnchorX_,p=f+this.imageAnchorY_;Ft(o,_,p,1,1,h,-_,-p),r.save(),r.transform.apply(r,o),r.translate(_,p),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=a)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=Tt(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const a=n[e]+this.textOffsetX_,h=n[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(a-this.textOffsetX_,h-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,a,h),this.textFillState_&&r.fillText(this.text_,a,h))}}moveToLineTo_(t,e,i,s,n){const r=this.context_,o=Tt(t,e,i,s,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;n&&(a-=2);for(let h=2;h<a;h+=2)r.lineTo(o[h],o[h+1]);return n&&r.closePath(),i}drawRings_(t,e,i,s){for(let n=0,r=i.length;n<r;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!rt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Zi(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),r=this.context_;r.beginPath(),r.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!rt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(rt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let n=0;const r=t.getEnds(),o=t.getStride();i.beginPath();for(let a=0,h=r.length;a<h;++a)n=this.moveToLineTo_(s,n,r[a],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),r=t.getStride();e.beginPath();for(let o=0,a=n.length;o<a;++o){const h=n[o];s=this.drawRings_(i,s,h,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Bt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:bt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ut(i||j)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),n=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),a=e.getWidth(),h=e.getMiterLimit(),l=n||ot;this.strokeState_={lineCap:s!==void 0?s:qt,lineDash:this.pixelRatio_===1?l:l.map(d=>d*this.pixelRatio_),lineDashOffset:(r||at)*this.pixelRatio_,lineJoin:o!==void 0?o:$t,lineWidth:(a!==void 0?a:Qt)*this.pixelRatio_,miterLimit:h!==void 0?h:te,strokeStyle:ut(i||zt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:ut(f||j)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),_=i.getLineCap(),p=i.getLineDash(),g=i.getLineDashOffset(),x=i.getLineJoin(),m=i.getWidth(),S=i.getMiterLimit();this.textStrokeState_={lineCap:_!==void 0?_:qt,lineDash:p||ot,lineDashOffset:g||at,lineJoin:x!==void 0?x:$t,lineWidth:m!==void 0?m:Qt,miterLimit:S!==void 0?S:te,strokeStyle:ut(f||zt)}}const s=t.getFont(),n=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),h=t.getScaleArray(),l=t.getText(),d=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:s!==void 0?s:li,textAlign:d!==void 0?d:bt,textBaseline:u!==void 0?u:ee},this.text_=l!==void 0?Array.isArray(l)?l.reduce((f,_,p)=>f+=p%2?" ":_,""):l:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=a!==void 0?a:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Q=.5;function En(c,t,e,i,s,n,r,o,a){const h=a?hi(s):s,l=c[0]*Q,d=c[1]*Q,u=yt(l,d);u.imageSmoothingEnabled=!1;const f=u.canvas,_=new Sn(u,Q,s,null,r,o,a?ji(Ji(),a):null),p=e.length,g=Math.floor((256*256*256-1)/p),x={};for(let S=1;S<=p;++S){const y=e[S-1],E=y.getStyleFunction()||i;if(!E)continue;let I=E(y,n);if(!I)continue;Array.isArray(I)||(I=[I]);const L=(S*g).toString(16).padStart(7,"#00000");for(let F=0,b=I.length;F<b;++F){const P=I[F],D=P.getGeometryFunction()(y);if(!D||!rt(h,D.getExtent()))continue;const O=P.clone(),G=O.getFill();G&&G.setColor(L);const w=O.getStroke();w&&(w.setColor(L),w.setLineDash(null)),O.setText(void 0);const v=P.getImage();if(v){const W=v.getImageSize();if(!W)continue;const X=yt(W[0],W[1],void 0,{alpha:!1}),C=X.canvas;X.fillStyle=L,X.fillRect(0,0,C.width,C.height),O.setImage(new zi({img:C,anchor:v.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:v.getOrigin(),opacity:1,size:v.getSize(),scale:v.getScale(),rotation:v.getRotation(),rotateWithView:v.getRotateWithView()}))}const k=O.getZIndex()||0;let M=x[k];M||(M={},x[k]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]);const A=D.getType();if(A==="GeometryCollection"){const W=D.getGeometriesArrayRecursive();for(let X=0,C=W.length;X<C;++X){const wt=W[X];M[wt.getType().replace("Multi","")].push(wt,O)}}else M[A.replace("Multi","")].push(D,O)}}const m=Object.keys(x).map(Number).sort(jt);for(let S=0,y=m.length;S<y;++S){const E=x[m[S]];for(const I in E){const T=E[I];for(let L=0,F=T.length;L<F;L+=2){_.setStyle(T[L+1]);for(let b=0,P=t.length;b<P;++b)_.setTransform(t[b]),_.drawGeometry(T[L])}}}return u.getImageData(0,0,f.width,f.height)}function Rn(c,t,e){const i=[];if(e){const s=Math.floor(Math.round(c[0])*Q),n=Math.floor(Math.round(c[1])*Q),r=(ze(s,0,e.width-1)+ze(n,0,e.height-1)*e.width)*4,o=e.data[r],a=e.data[r+1],l=e.data[r+2]+256*(a+256*o),d=Math.floor((256*256*256-1)/t.length);l&&l%d===0&&i.push(t[l/d-1])}return i}const In=.5,Ei={Point:An,LineString:kn,Polygon:On,MultiPoint:vn,MultiLineString:Dn,MultiPolygon:Mn,GeometryCollection:Ln,Circle:Fn};function Tn(c,t){return parseInt(N(c),10)-parseInt(N(t),10)}function ii(c,t){const e=Ri(c,t);return e*e}function Ri(c,t){return In*c/t}function Fn(c,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(n||r){const a=c.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(n,r),a.drawCircle(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=c.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function si(c,t,e,i,s,n,r,o){const a=[],h=e.getImage();if(h){let u=!0;const f=h.getImageState();f==Pt.LOADED||f==Pt.ERROR?u=!1:f==Pt.IDLE&&h.load(),u&&a.push(h.ready())}const l=e.getFill();l&&l.loading()&&a.push(l.ready());const d=a.length>0;return d&&Promise.all(a).then(()=>s(null)),wn(c,t,e,i,n,r,o),d}function wn(c,t,e,i,s,n,r){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,s);if(e.getRenderer())Ii(c,a,e,t,r);else{const l=Ei[a.getType()];l(c,a,e,t,r,n)}}function Ii(c,t,e,i,s){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)Ii(c,r[o],e,i,s);return}c.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function Ln(c,t,e,i,s,n){const r=t.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const h=Ei[r[o].getType()];h(c,r[o],e,i,s,n)}}function kn(c,t,e,i,s){const n=e.getStroke();if(n){const o=c.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,n),o.drawLineString(t,i,s)}const r=e.getText();if(r&&r.getText()){const o=c.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,s)}}function Dn(c,t,e,i,s){const n=e.getStroke();if(n){const o=c.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,n),o.drawMultiLineString(t,i,s)}const r=e.getText();if(r&&r.getText()){const o=c.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,s)}}function Mn(c,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(r||n){const a=c.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,r),a.drawMultiPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=c.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function An(c,t,e,i,s,n){const r=e.getImage(),o=e.getText(),a=o&&o.getText(),h=n&&r&&a?{}:void 0;if(r){if(r.getImageState()!=Pt.LOADED)return;const l=c.getBuilder(e.getZIndex(),"Image");l.setImageStyle(r,h),l.drawPoint(t,i,s)}if(a){const l=c.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o,h),l.drawText(t,i,s)}}function vn(c,t,e,i,s,n){const r=e.getImage(),o=r&&r.getOpacity()!==0,a=e.getText(),h=a&&a.getText(),l=n&&o&&h?{}:void 0;if(o){if(r.getImageState()!=Pt.LOADED)return;const d=c.getBuilder(e.getZIndex(),"Image");d.setImageStyle(r,l),d.drawMultiPoint(t,i,s)}if(h){const d=c.getBuilder(e.getZIndex(),"Text");d.setTextStyle(a,l),d.drawText(t,i,s)}}function On(c,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(n||r){const a=c.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,r),a.drawPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=c.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}const ni=[];let Et=null;function Pn(){Et=yt(1,1,void 0,{willReadFrequently:!0})}class bn extends qi{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=gt(),this.pixelTransform=gt(),this.inversePixelTransform=gt(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){Et||Pn(),Et.clearRect(0,0,1,1);let s;try{Et.drawImage(t,e,i,1,1,0,0,1,1),s=Et.getImageData(0,0,1,1).data}catch{return Et=null,null}return s}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let n,r;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&Bt(Ve(t.style.backgroundColor),Ve(i)))){const o=t.firstElementChild;$i(o)&&(r=o.getContext("2d"))}if(r&&Qi(r.canvas.style.transform,e)?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=es?ts():document.createElement("div"),n.className=s;let o=n.style;o.position="absolute",o.width="100%",o.height="100%",r=yt();const a=r.canvas;n.appendChild(a),o=a.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=n,this.context=r}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=Ws(i),n=Bs(i),r=Xs(i),o=Ys(i);K(e.coordinateToPixelTransform,s),K(e.coordinateToPixelTransform,n),K(e.coordinateToPixelTransform,r),K(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;K(a,s),K(a,n),K(a,r),K(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}prepareContainer(t,e){const i=t.extent,s=t.viewState.resolution,n=t.viewState.rotation,r=t.pixelRatio,o=Math.round(St(i)/s*r),a=Math.round(se(i)/s*r);Ft(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/r,1/r,n,-o/2,-a/2),is(this.inversePixelTransform,this.pixelTransform);const h=ss(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const l=this.context.canvas;l.width!=o||l.height!=a?(l.width=o,l.height=a):this.context.clearRect(0,0,o,a),h!==l.style.transform&&(l.style.transform=h)}}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const n=new ns(t,this.inversePixelTransform,i,e);s.dispatchEvent(n)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(It.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(It.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new mi),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(It.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(It.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,s,n,r,o){const a=n/2,h=r/2,l=s/e,d=-l,u=-t[0]+o,f=-t[1];return Ft(this.tempTransform,a,h,l,d,-i,u,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Gn extends bn{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.extendX_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Gt(),this.wrappedRenderedExtent_=Gt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,n=e.viewState,r=n.center,o=n.resolution,a=n.projection,h=n.rotation,l=a.getExtent(),d=this.getLayer().getSource(),u=this.getLayer().getDeclutter(),f=e.pixelRatio,_=e.viewHints,p=!(_[Vt.ANIMATING]||_[Vt.INTERACTING]),g=this.context,x=Math.round(St(s)/o*f),m=Math.round(se(s)/o*f),S=d.getWrapX()&&a.canWrapX(),y=S?St(l):null,E=S?Math.ceil((s[2]-l[2])/y)+(this.extendX_?2:1):1;let I=S?Math.floor((s[0]-l[0])/y)-(this.extendX_?1:0):0;do{let T=this.getRenderTransform(r,o,0,f,x,m,I*y);e.declutter&&(T=T.slice(0)),t.execute(g,[g.canvas.width,g.canvas.height],T,h,p,i===void 0?xt:i?yi:pn,i?u&&e.declutter[u]:void 0)}while(++I<E)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=yt(this.context.canvas.width,this.context.canvas.height,ni))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,rs(this.context),ni.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.viewState;this.prepareContainer(t,e);const n=this.context,r=this.replayGroup_;let o=r&&!r.isEmpty();if(!o&&!(this.getLayer().hasListener(It.PRERENDER)||this.getLayer().hasListener(It.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(n,t),s.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const a=os(i.extent);o=rt(a,t.extent),this.clipped_=o&&!Ot(a,t.extent),this.clipped_&&this.clipUnrotated(n,t,a)}return o&&this.renderWorlds(r,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&n.restore(),this.postRender(n,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,n=this.renderedResolution_,r=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,h=this.getLayer(),l=[],d=i[0]*Q,u=i[1]*Q;l.push(this.getRenderTransform(s,n,r,Q,d,u,0).slice());const f=h.getSource(),_=o.getExtent();if(f.getWrapX()&&o.canWrapX()&&!Ot(_,a)){let p=a[0];const g=St(_);let x=0,m;for(;p<_[0];)--x,m=g*x,l.push(this.getRenderTransform(s,n,r,Q,d,u,m).slice()),p+=g;for(x=0,p=a[2];p>_[2];)++x,m=g*x,l.push(this.getRenderTransform(s,n,r,Q,d,u,m).slice()),p-=g}this.hitDetectionImageData_=En(i,l,this.renderedFeatures_,h.getStyleFunction(),a,n,r,ii(n,this.renderedPixelRatio_),null)}e(Rn(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,n){var u,f;if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),h={},l=function(_,p,g){const x=N(_),m=h[x];if(m){if(m!==!0&&g<m.distanceSq){if(g===0)return h[x]=!0,n.splice(n.lastIndexOf(m),1),s(_,a,p);m.geometry=p,m.distanceSq=g}}else{if(g===0)return h[x]=!0,s(_,a,p);n.push(h[x]={feature:_,layer:a,geometry:p,distanceSq:g,callback:s})}},d=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,r,o,i,l,d?(f=(u=e.declutter)==null?void 0:u[d])==null?void 0:f.all().map(_=>_.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[Vt.ANIMATING],n=t.viewHints[Vt.INTERACTING],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&s||!o&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,h=t.viewState,l=h.projection,d=h.resolution,u=t.pixelRatio,f=e.getRevision(),_=e.getRenderBuffer();let p=e.getRenderOrder();p===void 0&&(p=Tn);const g=h.center.slice(),x=we(a,_*d),m=x.slice(),S=[x.slice()],y=l.getExtent(),E=i.getWrapX()&&l.canWrapX();if(this.extendX_=!1,E){const w=i.getExtent();w&&!Ns(w)&&(this.extendX_=w[0]<y[0]||w[2]>y[2])}if(E&&(!Ot(y,t.extent)||this.extendX_)){const w=St(y),v=Math.max(St(x)/2,w);let k=y[0],M=y[2];this.extendX_&&(k-=w,M+=w),x[0]=k-v,x[2]=M+v,as(g,l);const A=Ks(S[0],l);A[0]<y[0]&&A[2]<y[2]?S.push([A[0]+w,A[1],A[2]+w,A[3]]):A[0]>y[0]&&A[2]>y[2]&&S.push([A[0]-w,A[1],A[2]-w,A[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedPixelRatio_===u&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&this.renderedFrameDeclutter_===!!t.declutter&&Ot(this.wrappedRenderedExtent_,x))return Bt(this.renderedExtent_,m)||(this.hitDetectionImageData_=null,this.renderedExtent_=m),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const I=new un(Ri(d,u),x,d,u);let T;for(let w=0,v=S.length;w<v;++w)i.loadFeatures(S[w],d,l);const L=ii(d,u);let F=!0;const b=(w,v)=>{let k;const M=w.getStyleFunction()||e.getStyleFunction();if(M&&(k=M(w,d)),k){const A=this.renderFeature(w,L,k,I,T,this.getLayer().getDeclutter(),v);F=F&&!A}},P=hi(x),D=i.getFeaturesInExtent(P);p&&D.sort(p);for(let w=0,v=D.length;w<v;++w)b(D[w],w);this.renderedFeatures_=D,this.ready=F;const O=I.finish(),G=new yn(x,d,u,i.getOverlaps(),O,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=d,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=m,this.wrappedRenderedExtent_=x,this.renderedCenter_=g,this.renderedProjection_=l,this.renderedPixelRatio_=u,this.replayGroup_=G,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,n,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let h=0,l=i.length;h<l;++h)a=si(s,t,i[h],e,this.boundHandleStyleImageChange_,n,r,o)||a;else a=si(s,t,i,e,this.boundHandleStyleImageChange_,n,r,o);return a}}class Zn extends ls{constructor(t){super(t)}createRenderer(){return new Gn(this)}}let Wn=!1;function Bn(c,t,e,i,s,n,r){const o=new XMLHttpRequest;o.open("GET",typeof c=="function"?c(e,i,s):c,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=Wn,o.onload=function(a){if(!o.status||o.status>=200&&o.status<300){const h=t.getType();try{let l;h=="text"||h=="json"?l=o.responseText:h=="xml"?l=o.responseXML||o.responseText:h=="arraybuffer"&&(l=o.response),l?n(t.readFeatures(l,{extent:e,featureProjection:s}),t.readProjection(l)):r()}catch{r()}}else r()},o.onerror=r,o.send()}function ri(c,t){return function(e,i,s,n,r){Bn(c,t,e,i,s,(o,a)=>{this.addFeatures(o),n!==void 0&&n(o)},()=>{this.changed(),r!==void 0&&r()})}}function Xn(c,t){return[[-1/0,-1/0,1/0,1/0]]}function jn(c,t){return[c]}class Ti extends Us{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Ti(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ne(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=re(t,Le.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Yn(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Yn(c){if(typeof c=="function")return c;let t;return Array.isArray(c)?t=c:(Jt(typeof c.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[c]),function(){return t}}function Fi(c,t,e,i){const s=[];let n=Gt();for(let r=0,o=e.length;r<o;++r){const a=e[r];n=gi(c,t,a[0],i),s.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=a[a.length-1]}return s}function ae(c,t,e,i,s,n,r){let o,a;const h=(e-t)/i;if(h===1)o=t;else if(h===2)o=t,a=s;else if(h!==0){let l=c[t],d=c[t+1],u=0;const f=[0];for(let g=t+i;g<e;g+=i){const x=c[g],m=c[g+1];u+=Math.sqrt((x-l)*(x-l)+(m-d)*(m-d)),f.push(u),l=x,d=m}const _=s*u,p=Hs(f,_);p<0?(a=(_-f[-p-2])/(f[-p-1]-f[-p-2]),o=t+(-p-2)*i):o=t+p*i}r=r>1?r:2,n=n||new Array(r);for(let l=0;l<r;++l)n[l]=o===void 0?NaN:a===void 0?c[o+l]:J(c[o+l],c[o+i+l],a);return n}function Re(c,t,e,i,s,n){if(e==t)return null;let r;if(s<c[t+i-1])return n?(r=c.slice(t,t+i),r[i-1]=s,r):null;if(c[e-1]<s)return n?(r=c.slice(e-i,e),r[i-1]=s,r):null;if(s==c[t+i-1])return c.slice(t,t+i);let o=t/i,a=e/i;for(;o<a;){const u=o+a>>1;s<c[(u+1)*i-1]?a=u:o=u+1}const h=c[o*i-1];if(s==h)return c.slice((o-1)*i,(o-1)*i+i);const l=c[(o+1)*i-1],d=(s-h)/(l-h);r=[];for(let u=0;u<i-1;++u)r.push(J(c[(o-1)*i+u],c[o*i+u],d));return r.push(s),r}function Nn(c,t,e,i,s,n,r){if(r)return Re(c,t,e[e.length-1],i,s,n);let o;if(s<c[i-1])return n?(o=c.slice(0,i),o[i-1]=s,o):null;if(c[c.length-1]<s)return n?(o=c.slice(c.length-i),o[i-1]=s,o):null;for(let a=0,h=e.length;a<h;++a){const l=e[a];if(t!=l){if(s<c[t+i-1])return null;if(s<=c[l-1])return Re(c,t,l,i,s,!1);t=l}}return null}class Ie extends hs{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ne),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(re(t[e],Le.CHANGE,this.changed,this))}clone(){const t=new Ie(me(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Xt(this.getExtent(),t,e))return s;const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)s=n[r].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){Vs(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)Zs(t,e[i].getExtent());return t}getGeometries(){return me(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let n=0,r=i.length;n<r;++n){const o=i[n],a=o.getSimplifiedGeometry(t);e.push(a),a!==o&&(s=!0)}return s?new Ie(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=_i(this.getExtent()));const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)s[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(me(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function me(c){return c.map(t=>t.clone())}class Wt extends le{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){lt(this.flatCoordinates,t),this.changed()}clone(){const t=new Wt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Xt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(cs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ds(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return us(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Re(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Rt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ae(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ke(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Wt(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=di(this.flatCoordinates,0,t,this.stride),this.changed()}}class Te extends le{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,n=[],r=[];for(let a=0,h=s.length;a<h;++a){const l=s[a];lt(n,l.getFlatCoordinates()),r.push(n.length)}const o=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(o,n),this.ends_=r}}appendLineString(t){lt(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Te(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Xt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_s(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Nn(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return ye(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Wt(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let n=0;for(let r=0,o=e.length;r<o;++r){const a=e[r],h=new Wt(t.slice(n,a),i);s.push(h),n=a}return s}getLength(){const t=this.ends_;let e=0,i=0;for(let s=0,n=t.length;s<n;++s)i+=ke(this.flatCoordinates,e,t[s],this.stride),e=t[s];return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,n=this.stride;for(let r=0,o=s.length;r<o;++r){const a=s[r],h=ae(e,i,a,n,.5);lt(t,h),i=a}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=ui(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new Te(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return xs(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ps(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class De extends le{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){lt(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new De(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Xt(this.getExtent(),t,e))return s;const n=this.flatCoordinates,r=this.stride;for(let o=0,a=n.length;o<a;o+=r){const h=js(t,e,n[o],n[o+1]);if(h<s){s=h;for(let l=0;l<r;++l)i[l]=n[o+l];i.length=r}}return s}getCoordinates(){return Rt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Ze(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let n=0,r=t.length;n<r;n+=i){const o=new Ze(t.slice(n,n+i),e);s.push(o)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,n=e.length;s<n;s+=i){const r=e[s],o=e[s+1];if(Js(t,r,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=di(this.flatCoordinates,0,t,this.stride),this.changed()}}class Fe extends le{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,n=[],r=[];for(let o=0,a=s.length;o<a;++o){const h=s[o],l=n.length,d=h.getEnds();for(let u=0,f=d.length;u<f;++u)d[u]+=l;lt(n,h.getFlatCoordinates()),r.push(d)}e=s.length===0?this.getLayout():s[0].getLayout(),t=n,i=r}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;lt(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,n=e.length;s<n;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new Fe(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<Xt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ms(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ys(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Cs(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Ss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),je(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ce(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Fi(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=fi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new De(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Es(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=je(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Rs(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new Fe(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let n=0,r=i.length;n<r;++n)i[n]-=e;return new Je(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let n=0;for(let r=0,o=i.length;r<o;++r){const a=i[r].slice(),h=a[a.length-1];if(n!==0)for(let d=0,u=a.length;d<u;++d)a[d]-=n;const l=new Je(e.slice(n,h),t,a);s.push(l),n=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Is(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ts(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const oi=gt();class z{constructor(t,e,i,s,n,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=n,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?zs(this.flatCoordinates_):gi(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=_i(this.getExtent());this.flatInteriorPoints_=Fs(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=ws(this.flatCoordinates_,this.ends_),e=Fi(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=fi(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ae(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let s=0,n=i.length;s<n;++s){const r=i[s],o=ae(t,e,r,2,.5);lt(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Ls(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const s=se(i)/se(e);Ft(oi,i[0],i[3],s,-s,0,0,0),Tt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,oi,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new z(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=qs((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=ci(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=ui(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,s);break;case"Polygon":s=[],i.length=ks(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,s);break}return s&&(this.simplifiedGeometry_=new z(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}z.prototype.getFlatCoordinates=z.prototype.getOrientedFlatCoordinates;class ai{constructor(t){this.rbush_=new rn(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[N(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,n=e.length;s<n;s++){const r=t[s],o=e[s],a={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[s]=a,this.items_[N(o)]=a}this.rbush_.load(i)}remove(t){const e=N(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[N(e)],s=[i.minX,i.minY,i.maxX,i.maxY];xi(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,n=t.length;s<n;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return ie(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Ee(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Z={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class dt extends nn{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Jn extends Ds{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=$s,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Jt(this.format_,"`format` must be set when `url` is set"),this.loader_=ri(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:Xn;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new ai:null,this.loadedExtentsRtree_=new ai,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&i===void 0&&(i=new Qs(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=N(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new dt(Z.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof z||(this.featureChangeKeys_[t]=[re(e,Le.CHANGE,this.handleFeatureChange_,this),re(e,tn.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof z){const n=this.idIndex_[s];n instanceof z?Array.isArray(n)?n.push(e):this.idIndex_[s]=[n,e]:i=!1}else i=!1}return i&&(Jt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let n=0,r=t.length;n<r;n++){const o=t[n],a=N(o);this.addToIndex_(a,o)&&i.push(o)}for(let n=0,r=i.length;n<r;n++){const o=i[n],a=N(o);this.setupChangeEvents_(a,o);const h=o.getGeometry();if(h){const l=h.getExtent();e.push(l),s.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Z.ADDFEATURE))for(let n=0,r=i.length;n<r;n++)this.dispatchEvent(new dt(Z.ADDFEATURE,i[n]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Z.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Z.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(qe.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(qe.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(ne);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new dt(Z.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(s){const n=s.getGeometry();if(n instanceof z||n.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const s=i.getGeometry();if(s instanceof z||s.intersectsExtent(t)){const n=e(i);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),ie(this.nullGeometryFeatures_)||lt(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=en(t,e);return[].concat(...s.map(n=>this.featuresRtree_.getInExtent(n)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let n=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||sn,this.featuresRtree_.forEachInExtent(a,function(h){if(e(h)){const l=h.getGeometry(),d=o;if(o=l instanceof z?0:l.closestPointXY(i,s,r,o),o<d){n=h;const u=Math.sqrt(o);a[0]=i-u,a[1]=s-u,a[2]=i+u,a[3]=s+u}}}),n}getExtent(t){var e;return((e=this.featuresRtree_)==null?void 0:e.getExtent(t))??null}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=N(e),s=e.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const r=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}const n=e.getId();if(n!==void 0){const r=n.toString();this.idIndex_[r]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[r]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new dt(Z.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:N(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ie(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let r=0,o=n.length;r<o;++r){const a=n[r];s.forEachInExtent(a,function(l){return Ot(l.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new dt(Z.FEATURESLOADSTART)),this.loader_.call(this,a,e,i,l=>{--this.loadingExtentsCount_,this.dispatchEvent(new dt(Z.FEATURESLOADEND,void 0,l))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new dt(Z.FEATURESLOADERROR))}),s.insert(a,{extent:a.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(s){if(xi(s.extent,t))return s});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,s=t.length;i<s;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=N(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(ne),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const n=s.toString(),r=this.idIndex_[n];r===t?delete this.idIndex_[n]:Array.isArray(r)&&(r.splice(r.indexOf(t),1),r.length===1&&(this.idIndex_[n]=r[0]))}return delete this.uidIndex_[e],this.hasListener(Z.REMOVEFEATURE)&&this.dispatchEvent(new dt(Z.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Jt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(ri(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}export{un as B,bn as C,yi as D,yn as E,Ti as F,Ie as G,Q as H,Wt as L,Te as M,z as R,Zn as V,mi as Z,Fe as a,Jn as b,De as c,En as d,jn as e,ii as g,Rn as h,Bn as l,si as r};
