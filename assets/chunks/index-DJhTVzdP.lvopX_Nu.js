const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.Cy-zUl9H.js","assets/chunks/addCommonStyleSheet.BNGCnIMO.js","assets/chunks/map.DiiNQ3pp.js","assets/chunks/when.BR7zwNJC.js","assets/chunks/dayjs.min.Ba62AOpW.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/index.BUIxO2d3.js","assets/chunks/static.CMAEWrCw.js","assets/chunks/repeat.Cj0PdIYK.js","assets/chunks/directive.CvdRHFdJ.js","assets/chunks/directive-helpers.D8iRSD1N.js","assets/chunks/unsafe-html.CKtBt7Dp.js","assets/chunks/toolcool-range-slider.min.BBXDELo7.js","assets/chunks/orient2d.DArCjZZA.js","assets/chunks/index.2GfG_t-c.js"])))=>i.map(i=>d[i]);
import{aL as E,a2 as L,v,x as b,p as B,c as M,o as O,G as k,j as x,w as R,t as P,k as c,a5 as V}from"./framework.BisDmvbf.js";import{_ as j,a as w,m as d,h as p,i as H,j as T,k as _,n as K,o as N,p as G}from"./eo-dash.CE5cdMyY.js";import{i as U}from"./easing-CH0-9wR8.CTB3jml5.js";import{x as D}from"./mdi.G5RYduzi.js";import J from"./EodashLayoutSwitcher-X62ffFWp.BmQc0oon.js";import{u as z}from"./mosaic-ByH9wgDF.B-YHaGVp.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./VTooltip-CifBbpCx.qVwN7yqv.js";import"./forwardRefs-64mgSLjK.ngFVEZNQ.js";import"./transition-BwFOaDL9.s8Yr6DNP.js";const Y=o=>i=>{let r="";return o.forEach(e=>{const a=e.property;if(!e.icon&&!e.unitLabel||!i.properties[a])return;e.icon&&(r+=e.icon);let t=i.properties[a];typeof t=="number"&&!Number.isInteger(t)&&(t=t.toFixed(1)),r+=t,e.unitLabel&&(r+=e.unitLabel)}),r},Z=o=>{var a;const r=[{key:"collection",title:"Collections",type:"multiselect",placeholder:"Select collections",inline:!1,filterKeys:((a=w().stac)==null?void 0:a.map(t=>t.id))||[],...T.value&&{state:{[T.value]:!0}}}],e=o.map(t=>{const s=`properties.${t.property}`;return t.type==="range"?{key:s,title:t.title||t.property,type:"range",expanded:!0,filterKeys:[t.min||0,t.max||100],state:{min:t.min??0,max:t.max??100}}:t.type==="multiselect"?{key:s,title:t.title||t.property,type:"multiselect",placeholder:t.placeholder||`Select ${t.property}`,inline:!1,filterKeys:t.filterKeys||[],state:t.state}:t.type==="select"?{key:s,title:t.title||t.property,type:"select",placeholder:t.placeholder||`Select ${t.title||t.property}`,filterKeys:t.filterKeys||[],state:t.state}:null}).filter(Boolean);return[...r,...e]},q=(o,i)=>{const r=[];return i.forEach(e=>{const a=`properties.${e.property}`,t=o[a];if(t){if(e.type==="range"&&t.state){const{min:s,max:l}=t.state;s!==void 0&&s>(e.min||0)&&r.push(`${e.property}>=${s}`),l!==void 0&&l<(e.max||100)&&r.push(`${e.property}<=${l}`)}else if(e.type==="multiselect"&&t.stringifiedState){const s=t.stringifiedState;s.length>0&&r.push(`${e.property} IN (${s})`)}else if(e.type==="select"&&t.stringifiedState){const s=t.stringifiedState;s&&r.push(`${e.property}='${s}'`)}}}),r.join(" AND ")},Q=(o,i,r)=>{var s,l;const e=w(),a=new URLSearchParams;(s=o.collection)!=null&&s.stringifiedState&&a.append("collections",o.collection.stringifiedState.replaceAll(" ","")),(l=p.value)!=null&&l.lonLatExtent&&r&&a.append("bbox",G([...p.value.lonLatExtent]).join(","));const t=q(o,i);return t&&a.append("filter",t),a.append("limit","100"),`${e.stacEndpoint}/search?${a.toString()}`},W=(o,i,r)=>{let e=new AbortController;return(a,t)=>({url:Q(t,o,i),fetchFn:async s=>{e.abort(),e=new AbortController;const l=e.signal;return await _.get(s,{signal:l}).then(n=>n.data.features).catch(n=>n.name==="AbortError"||n.name==="CanceledError"?r.value:(console.error(n),[]))}})},X=(o,i)=>r=>{o.value=r.detail.results,S(o.value,i)},$=(o,i,r)=>async e=>{var t,s,l,n;const a=e.detail;a&&(i?((t=o.selectedCompareStac)==null?void 0:t.id)===a.collection?o.selectedCompareItem=a:await o.loadSelectedCompareSTAC(a.collection,!1,a):((s=o.selectedStac)==null?void 0:s.id)===a.collection?o.selectedItem=a:await o.loadSelectedSTAC(a.collection,!1,a),K.showButton=!0,(n=(l=r.value)==null?void 0:l.selectInteractions["stac-items"])==null||n.highlightById([a.id],{padding:[100,100,100,100],duration:1200,easing:U}))},ee=o=>i=>{var r,e;(e=(r=o.value)==null?void 0:r.selectInteractions["stac-items"])==null||e.highlightById([i.detail.id])},te=o=>()=>{var i,r;(r=(i=o.value)==null?void 0:i.selectInteractions["stac-items"])==null||r.highlightById([])};function S(o,i){var s;const r=i.value;let e=(s=r==null?void 0:r.layers)==null?void 0:s.find(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="AnalysisGroup"});if(!r||!o)return;e||(e={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers"},layers:[]},r.layers=[...r.layers,e]);const a={type:"Vector",properties:{id:"stac-items",title:"STAC Items"},source:{type:"Vector",url:"data:application/geo+json,"+encodeURIComponent(JSON.stringify({type:"FeatureCollection",features:o})),format:"GeoJSON",projection:"EPSG:3857"},style:{"fill-color":"transparent","stroke-color":"#003170"},interactions:[{type:"select",options:{id:"stac-items",condition:"pointermove",style:{"stroke-color":"white","stroke-width":3}}},{type:"select",options:{id:"stac-items",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]};if(e.layers.some(l=>{var n;return((n=l.properties)==null?void 0:n.id)==="stac-items"})){r.addOrUpdateLayer(a);return}else e.layers.unshift(a),r.layers=[...r.layers]}const re=(o,i,r)=>{if(!i)return;let e;const a=()=>{clearTimeout(e),e=setTimeout(()=>{var t,s;((t=r.value)==null?void 0:t.projection)!="globe"&&((s=o.value)==null||s.search())},500)};v(()=>{var t;(t=r.value)==null||t.map.on("moveend",a)}),b(()=>{var t;(t=r.value)==null||t.map.un("moveend",a)})},se=(o,i)=>{v(()=>{S(o.value,i)}),N(()=>{S(o.value,i)})};function oe(o,i){const r=e=>{var s,l,n;if(e.detail.originalEvent.type!=="pointermove")return;const a=(l=(s=e.detail)==null?void 0:s.feature)==null?void 0:l.getId();if(!a)return;const t=(n=o.value.results)==null?void 0:n.find(y=>y.id===a);t&&(o.value.selectedResult=t)};v(()=>{var e;(e=i.value)==null||e.addEventListener("select",r)}),b(()=>{var e;(e=i.value)==null||e.removeEventListener("select",r)})}function ae(o,i,r,e){const a=$(i,e,r),t=s=>{var y,g,h;if(s.detail.originalEvent.type!=="click")return;const l=(g=(y=s.detail)==null?void 0:y.feature)==null?void 0:g.getId();if(!l)return;const n=(h=o.value.results)==null?void 0:h.find(f=>(f==null?void 0:f.id)===l);n&&a(new CustomEvent("select",{detail:n}))};v(()=>{var s;(s=r.value)==null||s.addEventListener("select",t)}),b(()=>{var s;(s=r.value)==null||s.removeEventListener("select",t)})}const ie=".item-catalog-container[data-v-7e173e83]{overflow:hidden}.itemfilter-scroll[data-v-7e173e83]{flex:1;min-height:0;overflow:hidden;padding:.5rem;--eox-itemfilter-results-color: var(--v-theme-primary) !important}.title[data-v-7e173e83]{padding:1em;margin:.2em;flex-shrink:0}",le=[".imageProperty",".subTitleProperty",".filterProperties",".items","externalFilter"],ne={slot:"filterstitle",style:{margin:"14px 8px"}},ce={slot:"resultstitle",style:{margin:"14px 8px"}},ue={__name:"index",props:{title:{type:String,default:"Explore Catalog"},layoutTarget:{type:String,default:"lite"},layoutIcon:{type:String,default:D},filtersTitle:{type:String,default:"Filters:"},resultsTitle:{type:String,default:"Items:"},bboxFilter:{type:Boolean,default:!0},imageProperty:{type:String,default:"assets.thumbnail.href"},filters:{type:Array,default:()=>[{property:"eo:cloud_cover",type:"range",title:"Cloud Cover (%)",min:0,max:100,icon:'<svg style="height: 1rem; transform: translateY(-2px); fill: currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>weather-cloudy</title><path d="M6,19A5,5 0 0,1 1,14A5,5 0 0,1 6,9C7,6.65 9.3,5 12,5C15.43,5 18.24,7.66 18.5,11.03L19,11A4,4 0 0,1 23,15A4,4 0 0,1 19,19H6M19,13H17V12A5,5 0 0,0 12,7C9.5,7 7.45,8.82 7.06,11.19C6.73,11.07 6.37,11 6,11A3,3 0 0,0 3,14A3,3 0 0,0 6,17H19A2,2 0 0,0 21,15A2,2 0 0,0 19,13Z" /></svg>',unitLabel:"%"}]},useMosaic:{type:Boolean,default:!1},enableCompare:{type:Boolean,default:!1}},async setup(o){let i,r;customElements.get("eox-itemfilter")||([i,r]=E(()=>V(()=>import("./main.Cy-zUl9H.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),await i,r());const e=o,a=L("root"),t=L("itemfilter");v(async()=>{}),b(()=>{s.selectedItem=null});const s=w();e.useMosaic&&s.mosaicEndpoint&&z(s.mosaicEndpoint,{},s);const l=B([]);s.stacEndpoint&&([i,r]=E(()=>_.get(s.stacEndpoint+"/search?limit=100").then(F=>l.value=F.data.features)),await i,r());const n=l.value,y=Z(e.filters),g=Y(e.filters),h=W(e.filters,e.bboxFilter,l),f=X(l,e.enableCompare?d:p),C=$(s,e.enableCompare,e.enableCompare?d:p);se(l,e.enableCompare?d:p),re(t,e.bboxFilter,e.enableCompare?d:p),ae(t,s,e.enableCompare?d:p,e.enableCompare),oe(t,e.enableCompare?d:p);const I=ee(e.enableCompare?d:p),A=te(e.enableCompare?d:p);return(F,u)=>(O(),M("div",{ref_key:"root",ref:a,class:"d-flex flex-column item-catalog-container"},[k(H,{class:"title align-center justify-space-between flex-shrink-0"},{default:R(()=>[u[4]||(u[4]=x("h4",null,"Catalog Items",-1)),k(J,{target:o.layoutTarget,icon:o.layoutIcon},null,8,["target","icon"])]),_:1}),x("eox-itemfilter",{class:"itemfilter-scroll",ref:"itemfilter",titleProperty:"id",".imageProperty":o.imageProperty,".subTitleProperty":c(g),".filterProperties":c(y),".items":c(n),onSelect:u[0]||(u[0]=(...m)=>c(C)&&c(C)(...m)),onFilter:u[1]||(u[1]=(...m)=>c(f)&&c(f)(...m)),"onMouseenter:result":u[2]||(u[2]=(...m)=>c(I)&&c(I)(...m)),"onMouseleave:result":u[3]||(u[3]=(...m)=>c(A)&&c(A)(...m)),externalFilter:c(h)},[x("h4",ne,P(o.filtersTitle),1),x("h4",ce,P(o.resultsTitle),1)],40,le)],512))}},we=j(ue,[["styles",[ie]],["__scopeId","data-v-7e173e83"]]);export{we as default};
