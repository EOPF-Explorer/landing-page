const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.DmN1KyAH.js","assets/chunks/commonjsHelpers.Cpj98o6Y.js","assets/chunks/WMTS.DqfTZ5CB.js","assets/chunks/framework.CUPgR5JI.js","assets/chunks/webimage.CU41Mh7j.js"])))=>i.map(i=>d[i]);
var cg=Object.defineProperty;var hg=(r,e,t)=>e in r?cg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ee=(r,e,t)=>hg(r,typeof e!="symbol"?e+"":e,t);import{bn as fg,t as At,ab as xe,bo as dg,bp as lt,bq as pg,br as mg,ar as Ws,bs as el,y as as,x as li,w as Mo,P as wn,L as Tr,u as Xt,bt as Oo,bu as ne,bv as te,bw as W,bx as Vl,by as Hs,bz as gg,bA as yg,bB as Yr,bC as Zs,c as Hf,bD as ce,bE as F,bF as _e,bG as ke,bH as kt,bI as ui,bJ as Xr,bK as $i,bL as Zf,bM as Ys,bN as Ks,bO as K,bP as I,bQ as V,bR as No,bS as Qe,bT as _t,bU as Xl,bV as Yf,bW as Js,bX as ln,bY as _g,bZ as Kf,b_ as Ar,b$ as Wt,c0 as Le,v as bg,c1 as xg,G as Qr,S as zc,c2 as vg,c3 as Ft,c4 as fr,b as ql,a8 as Eg,a7 as wg,c5 as Qs,c6 as Tg,c7 as ji,c8 as Sg,c9 as Rg,V as ls,aR as qr,ca as Bc,aQ as dr,cb as tl,bi as Wr,cc as fn,l as Kr,O as Ag,cd as Pg,ce as Ig,cf as gr,b9 as Vi,aM as Do,cg as yr,ch as Ni,i as Jn,aS as dt,H as We,ci as Qn,cj as Vn,ck as Cg,X as Te,cl as Jf,cm as ft,cn as Wl,co as Lg,cp as Fg,E as Tt,cq as ue,cr as Hl,cs as tr,ct as Mg,cu as Zl,cv as rl,cw as nl,cx as en,cy as Og,cz as il,cA as Ea,cB as Ng,cC as sl,cD as Qf,cE as Dg,cF as Un,cG as Ug,cH as Gc,cI as kg,cJ as Yl,cK as zg,_ as ed,cL as Or,cM as us,cN as Bg,cO as Gg,cP as Se,cQ as Uo,cR as Xi,cS as Pt,cT as Tn,cU as An,cV as $g,cW as he,cX as td,aK as rd,cY as jg,cZ as nd,c_ as id,c$ as Vg,d0 as Xg,d1 as qi,a1 as qg,aN as cs,an as Cr,Q as Hr,d2 as Wg,d3 as tn,d4 as ko,a0 as Kl,am as eo,d5 as sd,d6 as dn,d7 as Hg,d8 as Zg,ba as od,d9 as rr,da as Yg,db as Kg,dc as zo,dd as Jg,B as ad,de as Qg,aL as ey,j as to,aP as $c,df as ty,dg as ry,dh as ny,di as iy,dj as sy,aH as Jl,aU as nn,dk as Pn,dl as oy,dm as ay,dn as Wi,dp as wa,dq as Hi,dr as hs,ds as ly,$ as uy,Z as cy,dt as jc,du as Vc,ay as ci,as as In,at as Ql,dv as Ur,bd as eu,dw as ld,dx as ud,dy as hy,ac as fy,aF as hi,aJ as tu,aC as cd,ae as ol,aB as ru,aD as ro,dz as hd,aE as dy,aG as py,az as Wn,aA as no,a6 as io,dA as my,dB as gy,b4 as nu,q as yy,dC as Xc,dD as _y,dE as Bo,b7 as by,aY as al,ai as ll,aX as xy,dF as fd,dG as vy,aa as Ey,a9 as wy,dH as iu,dI as qc,g as Ty,h as Sy,dJ as ul,dK as dd,dL as Wc,dM as Hc,dN as so,dO as pd,dP as Ry,dQ as md,dR as Ay,dS as Py,dT as Iy,dU as Cy,dV as Ly,dW as Fy,dX as My,bc as Oy,W as Ny,dY as Dy,dZ as Uy,d_ as ky}from"./WMTS.DqfTZ5CB.js";import{g as Go,c as gn}from"./commonjsHelpers.Cpj98o6Y.js";import{a5 as sn}from"./framework.CUPgR5JI.js";const zy={Point:jy,LineString:Vy,Polygon:Hy,MultiPoint:qy,MultiLineString:Xy,MultiPolygon:Wy},By={Point:Zy,LineString:Yy,Polygon:Ky,MultiPoint:Qy,MultiLineString:Jy,MultiPolygon:e_};class Gy extends fg{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,n){const i=e,s=Zc(i.geometry,t),o=new At;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const n=e,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return Zc(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const n=e.spatialReference.wkid;return xe("EPSG:"+n)}return null}writeGeometryObject(e,t){return Yc(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={};if(!e.hasProperties())return n.attributes={},n;const i=e.getProperties(),s=e.getGeometry();if(s){n.geometry=Yc(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(xe(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return dg(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,s=e.length;i<s;++i)n.push(this.writeFeatureObject(e[i],t));return{features:n}}}function Zc(r,e){if(!r)return null;let t;if(typeof r.x=="number"&&typeof r.y=="number")t="Point";else if(r.points)t="MultiPoint";else if(r.paths)r.paths.length===1?t="LineString":t="MultiLineString";else if(r.rings){const i=r,s=fi(i),o=$y(i.rings,s);o.length===1?(t="Polygon",r=Object.assign({},r,{rings:o[0]})):(t="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=zy[t];return lt(n(r),!1,e)}function $y(r,e){const t=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)t.length=0,pg(t,0,r[s],e.length),mg(t,0,t.length,e.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=n.length-1;s>=0;s--){const u=n[s][0];if(Ws(new el(u).getExtent(),new el(a).getExtent())){n[s].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function jy(r){let e;return r.m!==void 0&&r.z!==void 0?e=new Xt([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?e=new Xt([r.x,r.y,r.z],"XYZ"):r.m!==void 0?e=new Xt([r.x,r.y,r.m],"XYM"):e=new Xt([r.x,r.y]),e}function Vy(r){const e=fi(r);return new Tr(r.paths[0],e)}function Xy(r){const e=fi(r);return new li(r.paths,e)}function fi(r){let e="XY";return r.hasZ===!0&&r.hasM===!0?e="XYZM":r.hasZ===!0?e="XYZ":r.hasM===!0&&(e="XYM"),e}function qy(r){const e=fi(r);return new Mo(r.points,e)}function Wy(r){const e=fi(r);return new as(r.rings,e)}function Hy(r){const e=fi(r);return new wn(r.rings,e)}function Zy(r,e){const t=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")n={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")n={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")n={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return n}function fs(r){const e=r.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Yy(r,e){const t=fs(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:[r.getCoordinates()]}}function Ky(r,e){const t=fs(r);return{hasZ:t.hasZ,hasM:t.hasM,rings:r.getCoordinates(!1)}}function Jy(r,e){const t=fs(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:r.getCoordinates()}}function Qy(r,e){const t=fs(r);return{hasZ:t.hasZ,hasM:t.hasM,points:r.getCoordinates()}}function e_(r,e){const t=fs(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function Yc(r,e){const t=By[r.getType()];return t(lt(r,!0,e),e)}const Fr="http://www.opengis.net/gml",t_=/^\s*$/;class J extends Oo{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:te(this.readFeaturesInternal),featureMembers:ne(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let i=null;if(n=="FeatureCollection")i=W([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",u="p0";if(!o&&e.childNodes){o=[],a={};for(let f=0,m=e.childNodes.length;f<m;++f){const p=e.childNodes[f];if(p.nodeType===1){const y=p.nodeName.split(":").pop();if(!o.includes(y)){let b="",E=0;const v=p.namespaceURI;for(const w in a){if(a[w]===v){b=w;break}++E}b||(b=l+E,a[b]=v),o.push(b+":"+y)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[u]=f}const h={},c=Array.isArray(o)?o:[o];for(const f in a){const m={};for(let p=0,y=c.length;p<y;++p)(c[p].includes(":")?c[p].split(":")[0]:u)===f&&(m[c[p].split(":").pop()]=n=="featureMembers"?te(this.readFeatureElement,this):ne(this.readFeatureElement,this));h[a[f]]=m}n=="featureMember"||n=="member"?i=W(void 0,h,e,t):i=W([],h,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),W(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Vl(i,n):void 0}readGeometryElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?lt(i,!1,n):void 0}readFeatureElementInternal(e,t,n){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let u;const h=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(u=Hs(l,!1),t_.test(u)&&(u=void 0)):(n&&(u=h==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),u?h!=="boundedBy"&&(i=h):u=this.readFeatureElementInternal(l,t,!1));const c=l.attributes.length;if(c>0&&!(u instanceof gg)){u={_content_:u};for(let f=0;f<c;f++){const m=l.attributes[f].name;u[m]=l.attributes[f].value}}s[h]?(s[h]instanceof Array||(s[h]=[s[h]]),s[h].push(u)):s[h]=u}if(!n)return s;const o=new At(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||yg(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Xt(n,"XYZ")}readMultiPoint(e,t){const n=W([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new Mo(n)}readMultiLineString(e,t){const n=W([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new li(n)}readMultiPolygon(e,t){const n=W([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new as(n)}pointMemberParser(e,t){Yr(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Yr(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Yr(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Tr(n,"XYZ")}readFlatLinearRing(e,t){const n=W(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new el(n,"XYZ")}readPolygon(e,t){const n=W([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Zs(i,n[o]),s.push(i.length);return new wn(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return W(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return xe(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}J.prototype.namespace=Fr;J.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};J.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};J.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};J.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:te(J.prototype.pointMemberParser),pointMembers:te(J.prototype.pointMemberParser)}};J.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:te(J.prototype.lineStringMemberParser),lineStringMembers:te(J.prototype.lineStringMemberParser)}};J.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:te(J.prototype.polygonMemberParser),polygonMembers:te(J.prototype.polygonMemberParser)}};J.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:te(J.prototype.readFlatCoordinatesFromNode)}};J.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:te(J.prototype.readLineString)}};J.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:te(J.prototype.readPolygon)}};J.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ne(J.prototype.readFlatLinearRing)}};const r_=Fr+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",n_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class ye extends J{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Fr].featureMember=te(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:r_}readFlatCoordinates(e,t){const n=Hs(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const u=xe(s);u&&(o=u.getAxisOrientation())}const a=n.trim().split(/\s+/),l=[];for(let u=0,h=a.length;u<h;u++){const c=a[u].split(/,+/),f=parseFloat(c[0]),m=parseFloat(c[1]),p=c.length===3?parseFloat(c[2]):0;o.startsWith("en")?l.push(f,m,p):l.push(m,f,p)}return l}readBox(e,t){const n=W([null],this.BOX_PARSERS_,e,t,this);return Hf(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=W(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=W(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),ce("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const c=t.getProperties();for(const f in c){const m=c[f];m!=null&&(l.push(f),u.push(m),f==a||typeof m.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=F(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=F(_e)))}}const h=Object.assign({},s);h.node=e,ke(h,s.serializers,kt(void 0,o),u,n,l)}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}else if(e.nodeName==="Curve"){const o=ce(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();ke({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Vl(t,i):o=lt(t,!0,i),ke(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(e){const t=ce(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,u=new Array(l);for(let h=0;h<l;++h){const c=a[h];u[h]=this.getCoords_(c,o,s)}_e(e,u.join(" "))}writeCurveSegments_(e,t,n){const i=ce(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();ke({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=ce(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),ce(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const i=ce(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeRing(e,t,n){const i=ce(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}getCoords_(e,t,n){let s=(t?xe(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(n){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),u=this.getCoords_(l,o,s);_e(a,u)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();ke({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,kt("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const i=ce(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();ke({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];ke({node:e},this.ENVELOPE_SERIALIZERS,ui,a,n,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return ce("http://www.opengis.net/gml",n_[i.nodeName])}}ye.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:ne(ye.prototype.readFlatCoordinates)}};ye.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:ye.prototype.innerBoundaryIsParser,outerBoundaryIs:ye.prototype.outerBoundaryIsParser}};ye.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:te(ye.prototype.readFlatCoordinates)}};ye.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ne(J.prototype.readPoint),MultiPoint:ne(J.prototype.readMultiPoint),LineString:ne(J.prototype.readLineString),MultiLineString:ne(J.prototype.readMultiLineString),LinearRing:ne(J.prototype.readLinearRing),Polygon:ne(J.prototype.readPolygon),MultiPolygon:ne(J.prototype.readMultiPolygon),Box:ne(ye.prototype.readBox)}};ye.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(ye.prototype.writeCurveOrLineString),MultiCurve:F(ye.prototype.writeMultiCurveOrLineString),Point:F(ye.prototype.writePoint),MultiPoint:F(ye.prototype.writeMultiPoint),LineString:F(ye.prototype.writeCurveOrLineString),MultiLineString:F(ye.prototype.writeMultiCurveOrLineString),LinearRing:F(ye.prototype.writeLinearRing),Polygon:F(ye.prototype.writeSurfaceOrPolygon),MultiPolygon:F(ye.prototype.writeMultiSurfaceOrPolygon),Surface:F(ye.prototype.writeSurfaceOrPolygon),MultiSurface:F(ye.prototype.writeMultiSurfaceOrPolygon),Envelope:F(ye.prototype.writeEnvelope)}};ye.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(ye.prototype.writeLineStringOrCurveMember),curveMember:F(ye.prototype.writeLineStringOrCurveMember)}};ye.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:F(ye.prototype.writeRing),innerBoundaryIs:F(ye.prototype.writeRing)}};ye.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(ye.prototype.writePointMember)}};ye.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(ye.prototype.writeSurfaceOrPolygonMember),polygonMember:F(ye.prototype.writeSurfaceOrPolygonMember)}};ye.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(_e),upperCorner:F(_e)}};const i_=Fr+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",s_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class j extends J{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:i_,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const n=W([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new li(n)}readFlatCurveRing(e,t){const n=W([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=n.length;s<o;++s)Zs(i,n[s].getFlatCoordinates());return i}readMultiSurface(e,t){const n=W([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new as(n)}curveMemberParser(e,t){Yr(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Yr(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return W([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return W([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return W([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return W([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=W(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=W(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}readSurface(e,t){const n=W([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Zs(i,n[o]),s.push(i.length);return new wn(i,"XYZ",s)}}readCurve(e,t){const n=W([null],this.CURVE_PARSERS,e,t,this);if(n)return new Tr(n,"XYZ")}readEnvelope(e,t){const n=W([null],this.ENVELOPE_PARSERS,e,t,this);return Hf(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let n=Hs(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const l=t[0].srsName;if((l?xe(l).getAxisOrientation():"enu")==="neu")for(let c=0,f=s.length;c<f;c+=3){const m=s[c],p=s[c+1];s[c]=p,s[c+1]=m}const h=s.length;if(h==2&&s.push(0),h!==0)return s}readFlatPosList(e,t){const n=Hs(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?xe(s).getAxisOrientation():"enu",l=n.split(/\s+/);let u=2;e.getAttribute("srsDimension")?u=Xr(e.getAttribute("srsDimension")):e.getAttribute("dimension")?u=Xr(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?u=Xr(e.parentNode.getAttribute("srsDimension")):o&&(u=Xr(o));const h=a.startsWith("en");let c,f,m;const p=[];for(let y=0,b=l.length;y<b;y+=u)c=parseFloat(l[y]),f=parseFloat(l[y+1]),m=u===3?parseFloat(l[y+2]):0,h?p.push(c,f,m):p.push(f,c,m);return p}writePos_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=a?xe(a).getAxisOrientation():"enu",u=t.getCoordinates();let h=l.startsWith("en")?u[0]+" "+u[1]:u[1]+" "+u[0];if(s){const c=u[2]||0;h+=" "+c}_e(e,h)}getCoords_(e,t,n){let s=(t?xe(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(n){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),u=l.length,h=new Array(u);let c;for(let f=0;f<u;++f)c=l[f],h[f]=this.getCoords_(c,a,s);_e(e,h.join(" "))}writePoint(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ce(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];ke({node:e},this.ENVELOPE_SERIALIZERS,ui,a,n,o,this)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=ce(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),ce(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();ke({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=ce(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=ce(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}else if(e.nodeName==="Curve"){const o=ce(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();ke({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();ke({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,kt("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();ke({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(e,t,n){const i=ce(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writePointMember(e,t,n){const i=ce(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeSurfacePatches_(e,t,n){const i=ce(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeCurveSegments_(e,t,n){const i=ce(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Vl(t,i):o=lt(t,!0,i),ke(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const c=t.getProperties();for(const f in c){const m=c[f];m!=null&&(l.push(f),u.push(m),f==a||typeof m.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=F(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=F(_e)))}}const h=Object.assign({},s);h.node=e,ke(h,s.serializers,kt(void 0,o),u,n,l)}writeFeatureMembers_(e,t,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=F(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,ke(l,a,kt(s,o),t,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return ce(this.namespace,s_[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),ce(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=ce(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(n,e,[i]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=ce(this.namespace,"featureMembers");n.setAttributeNS($i,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(n,e,[i]),n}}j.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:ne(j.prototype.readFlatPos),posList:ne(j.prototype.readFlatPosList),coordinates:ne(ye.prototype.readFlatCoordinates)}};j.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:j.prototype.interiorParser,exterior:j.prototype.exteriorParser}};j.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ne(J.prototype.readPoint),MultiPoint:ne(J.prototype.readMultiPoint),LineString:ne(J.prototype.readLineString),MultiLineString:ne(J.prototype.readMultiLineString),LinearRing:ne(J.prototype.readLinearRing),Polygon:ne(J.prototype.readPolygon),MultiPolygon:ne(J.prototype.readMultiPolygon),Surface:ne(j.prototype.readSurface),MultiSurface:ne(j.prototype.readMultiSurface),Curve:ne(j.prototype.readCurve),MultiCurve:ne(j.prototype.readMultiCurve),Envelope:ne(j.prototype.readEnvelope)}};j.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:te(j.prototype.curveMemberParser),curveMembers:te(j.prototype.curveMemberParser)}};j.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:te(j.prototype.surfaceMemberParser),surfaceMembers:te(j.prototype.surfaceMemberParser)}};j.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:te(J.prototype.readLineString),Curve:te(j.prototype.readCurve)}};j.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:te(J.prototype.readPolygon),Surface:te(j.prototype.readSurface)}};j.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:ne(j.prototype.readPatch)}};j.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:ne(j.prototype.readSegment)}};j.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:te(j.prototype.readFlatPosList),upperCorner:te(j.prototype.readFlatPosList)}};j.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:ne(j.prototype.readPolygonPatch)}};j.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Zf(j.prototype.readLineStringSegment)}};J.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ne(J.prototype.readFlatLinearRing),Ring:ne(j.prototype.readFlatCurveRing)}};j.prototype.writeFeatures;j.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:F(j.prototype.writeRing),interior:F(j.prototype.writeRing)}};j.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(_e),upperCorner:F(_e)}};j.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(j.prototype.writeSurfaceOrPolygonMember),polygonMember:F(j.prototype.writeSurfaceOrPolygonMember)}};j.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(j.prototype.writePointMember)}};j.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(j.prototype.writeLineStringOrCurveMember),curveMember:F(j.prototype.writeLineStringOrCurveMember)}};j.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(j.prototype.writeCurveOrLineString),MultiCurve:F(j.prototype.writeMultiCurveOrLineString),Point:F(j.prototype.writePoint),MultiPoint:F(j.prototype.writeMultiPoint),LineString:F(j.prototype.writeCurveOrLineString),MultiLineString:F(j.prototype.writeMultiCurveOrLineString),LinearRing:F(j.prototype.writeLinearRing),Polygon:F(j.prototype.writeSurfaceOrPolygon),MultiPolygon:F(j.prototype.writeMultiSurfaceOrPolygon),Surface:F(j.prototype.writeSurfaceOrPolygon),MultiSurface:F(j.prototype.writeMultiSurfaceOrPolygon),Envelope:F(j.prototype.writeEnvelope)}};const su=j;su.prototype.writeFeatures;su.prototype.writeFeaturesNode;const Xe=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],o_="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",a_={rte:gd,trk:yd,wpt:_d},l_=K(Xe,{rte:te(gd),trk:te(yd),wpt:te(_d)}),u_=K(Xe,{text:I(V,"linkText"),type:I(V,"linkType")}),c_=K(Xe,{name:I(V),email:U_,link:ds}),h_=K(Xe,{name:I(V),desc:I(V),author:I(O_),copyright:I(N_),link:ds,time:I(No),keywords:I(V),bounds:D_,extensions:$o}),f_=K(Xe,{year:I(Qe),license:I(V)}),d_=K(Xe,{rte:F(G_),trk:F($_),wpt:F(V_)});class p_ extends Oo{constructor(e){super(),e=e||{},this.dataProjection=xe("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Ys(e)):Ks(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(t);if(n)return n}return null}readMetadataFromNode(e){if(!Xe.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Xe.includes(t.namespaceURI)&&t.localName==="metadata")return W({},h_,t,[]);return null}readFeatureFromNode(e,t){if(!Xe.includes(e.namespaceURI))return null;const n=a_[e.localName];if(!n)return null;const i=n(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!Xe.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=W([],l_,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=ce("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",$i),n.setAttributeNS($i,"xsi:schemaLocation",o_),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),ke({node:n},d_,M_,e,[t]),n}}const m_=K(Xe,{name:I(V),cmt:I(V),desc:I(V),src:I(V),link:ds,number:I(Qe),extensions:$o,type:I(V),rtept:k_}),g_=K(Xe,{ele:I(_t),time:I(No)}),y_=K(Xe,{name:I(V),cmt:I(V),desc:I(V),src:I(V),link:ds,number:I(Qe),type:I(V),extensions:$o,trkseg:B_}),__=K(Xe,{trkpt:z_}),b_=K(Xe,{ele:I(_t),time:I(No)}),x_=K(Xe,{ele:I(_t),time:I(No),magvar:I(_t),geoidheight:I(_t),name:I(V),cmt:I(V),desc:I(V),src:I(V),link:ds,sym:I(V),type:I(V),fix:I(V),sat:I(Qe),hdop:I(_t),vdop:I(_t),pdop:I(_t),ageofdgpsdata:I(_t),dgpsid:I(Qe),extensions:$o}),v_=["text","type"],E_=K(Xe,{text:F(_e),type:F(_e)}),w_=K(Xe,["name","cmt","desc","src","link","number","type","rtept"]),T_=K(Xe,{name:F(_e),cmt:F(_e),desc:F(_e),src:F(_e),link:F(lu),number:F(Js),type:F(_e),rtept:Yf(F(uu))}),S_=K(Xe,["ele","time"]),R_=K(Xe,["name","cmt","desc","src","link","number","type","trkseg"]),A_=K(Xe,{name:F(_e),cmt:F(_e),desc:F(_e),src:F(_e),link:F(lu),number:F(Js),type:F(_e),trkseg:Yf(F(j_))}),P_=kt("trkpt"),I_=K(Xe,{trkpt:F(uu)}),C_=K(Xe,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),L_=K(Xe,{ele:F(ln),time:F(_g),magvar:F(ln),geoidheight:F(ln),name:F(_e),cmt:F(_e),desc:F(_e),src:F(_e),link:F(lu),sym:F(_e),type:F(_e),fix:F(_e),sat:F(Js),hdop:F(ln),vdop:F(ln),pdop:F(ln),ageofdgpsdata:F(ln),dgpsid:F(Js)}),F_={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function M_(r,e,t){const n=r.getGeometry();if(n){const i=F_[n.getType()];if(i){const s=e[e.length-1].node;return ce(s.namespaceURI,i)}}}function ou(r,e,t,n){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,e.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,e.hasM=!0):r.push(0),r}function au(r,e,t){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],r.hasZ&&(e[s*i+2]=e[s*4+2]),r.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return n}function O_(r,e){const t=W({},c_,r,e);if(t)return t}function N_(r,e){const t=W({},f_,r,e);if(t){const n=r.getAttribute("author");return n!==null&&(t.author=n),t}}function D_(r,e){const t=e[e.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function U_(r,e){const t=e[e.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(t.email=`${n}@${i}`)}function ds(r,e){const t=e[e.length-1],n=r.getAttribute("href");n!==null&&(t.link=n),Yr(u_,r,e)}function $o(r,e){const t=e[e.length-1];t.extensionsNode_=r}function k_(r,e){const t=W({},g_,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;ou(i,s,r,t)}}function z_(r,e){const t=W({},b_,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;ou(i,s,r,t)}}function B_(r,e){const t=e[e.length-1];Yr(__,r,e);const n=t.flatCoordinates;t.ends.push(n.length)}function gd(r,e){const t=e[0],n=W({flatCoordinates:[],layoutOptions:{}},m_,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=au(s,i),a=new Tr(i,o);lt(a,!1,t);const l=new At(a);return l.setProperties(n,!0),l}function yd(r,e){const t=e[0],n=W({flatCoordinates:[],ends:[],layoutOptions:{}},y_,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=au(o,i,s),l=new li(i,a,s);lt(l,!1,t);const u=new At(l);return u.setProperties(n,!0),u}function _d(r,e){const t=e[0],n=W({},x_,r,e);if(!n)return;const i={},s=ou([],i,r,n),o=au(i,s),a=new Xt(s,o);lt(a,!1,t);const l=new At(a);return l.setProperties(n,!0),l}function lu(r,e,t){r.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];ke({node:r},E_,ui,s,t,v_)}function uu(r,e,t){const n=t[t.length-1],s=n.node.namespaceURI,o=n.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=r.nodeName=="rtept"?S_[s]:C_[s],u=Xl(o,l);ke({node:r,properties:o},L_,ui,u,t,l)}function G_(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const h=lt(o,!0,n);s.geometryLayout=h.getLayout(),i.rtept=h.getCoordinates()}const a=t[t.length-1].node,l=w_[a.namespaceURI],u=Xl(i,l);ke(s,T_,ui,u,t,l)}function $_(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const h=lt(o,!0,n);i.trkseg=h.getLineStrings()}const a=t[t.length-1].node,l=R_[a.namespaceURI],u=Xl(i,l);ke(s,A_,ui,u,t,l)}function j_(r,e,t){const n={node:r};n.geometryLayout=e.getLayout(),n.properties={},ke(n,I_,P_,e.getCoordinates(),t)}function V_(r,e,t){const n=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=lt(s,!0,n);i.geometryLayout=o.getLayout(),uu(r,o.getCoordinates(),t)}}class cu extends Kf{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Ps(e),this.adaptOptions(t))}readFeatureFromText(e,t){return Ar()}readFeatures(e,t){return this.readFeaturesFromText(Ps(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return Ar()}readGeometry(e,t){return this.readGeometryFromText(Ps(e),this.adaptOptions(t))}readGeometryFromText(e,t){return Ar()}readProjection(e){return this.readProjectionFromText(Ps(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return Ar()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return Ar()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return Ar()}}function Ps(r){return typeof r=="string"?r:""}const X_=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,q_=/^H.([A-Z]{3}).*?:(.*)/,W_=/^HFDTE(\d{2})(\d{2})(\d{2})/,H_=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,Z_=/\r\n|\r|\n/;class Y_ extends cu{constructor(e){super(),e=e||{},this.dataProjection=xe("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const n=this.altitudeMode_,i=e.split(Z_),s={},o=[];let a=2e3,l=0,u=1,h=-1,c,f;for(c=0,f=i.length;c<f;++c){const b=i[c];let E;if(b.charAt(0)=="B"){if(E=X_.exec(b),E){const v=parseInt(E[1],10),w=parseInt(E[2],10),P=parseInt(E[3],10);let T=parseInt(E[4],10)+parseInt(E[5],10)/6e4;this.lad_&&(T+=parseInt(b.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),E[6]=="S"&&(T=-T);let R=parseInt(E[7],10)+parseInt(E[8],10)/6e4;if(this.lod_&&(R+=parseInt(b.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),E[9]=="W"&&(R=-R),o.push(R,T),n!="none"){let D;n=="gps"?D=parseInt(E[11],10):n=="barometric"?D=parseInt(E[12],10):D=0,o.push(D)}let C=Date.UTC(a,l,u,v,w,P);C<h&&(C=Date.UTC(a,l,u+1,v,w,P)),o.push(C/1e3),h=C}}else if(b.charAt(0)=="H")E=H_.exec(b),E?(u=parseInt(E[1],10),l=parseInt(E[2],10)-1,a=2e3+parseInt(E[3],10)):(E=W_.exec(b),E?(u=parseInt(E[1],10),l=parseInt(E[2],10)-1,a=2e3+parseInt(E[3],10)):(E=q_.exec(b),E&&(s[E[1]]=E[2].trim())));else if(b.charAt(0)=="I"){const v=parseInt(b.slice(1,3),10);for(let w=0;w<v;w++){const P=b.slice(7+w*7,10+w*7);if(P==="LAD"||P==="LOD"){const T=parseInt(b.slice(3+w*7,5+w*7),10)-1,R=parseInt(b.slice(5+w*7,7+w*7),10);P==="LAD"?(this.lad_=!0,this.ladStart_=T,this.ladStop_=R):P==="LOD"&&(this.lod_=!0,this.lodStart_=T,this.lodStop_=R)}}}}if(o.length===0)return null;const m=n=="none"?"XYM":"XYZM",p=new Tr(o,m),y=new At(lt(p,!1,t));return y.setProperties(s,!0),y}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}}const tt={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Sn={};Sn[tt.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Sn[tt.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Sn[tt.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Sn.none={none:{supports:[],formats:[],qualities:[]}};const K_=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Kc=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,J_=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Q_(r){let e=r.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Sn[tt.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...e.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function e0(r){const e=r.getComplianceLevelSupportedFeatures(),t=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=t&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=t&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=t&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...n],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function t0(r){const e=r.getComplianceLevelSupportedFeatures(),t=r.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...r.imageInfo.extraFeatures],formats:t,qualities:r.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const jo={};jo[tt.VERSION1]=Q_;jo[tt.VERSION2]=e0;jo[tt.VERSION3]=t0;class r0{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return tt.VERSION1;case"http://iiif.io/api/image/2/context.json":return tt.VERSION2;case"http://iiif.io/api/image/3/context.json":return tt.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(tt.VERSION1)&&this.imageInfo.identifier)return tt.VERSION1;break}Wt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case tt.VERSION1:if(K_.test(this.imageInfo.profile))return this.imageInfo.profile;break;case tt.VERSION3:if(J_.test(this.imageInfo.profile))return this.imageInfo.profile;break;case tt.VERSION2:if(typeof this.imageInfo.profile=="string"&&Kc.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Kc.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Sn.none.none:Sn[e][t]}getTileSourceOptions(e){const t=e||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:jo[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}class hu{read(e){if(!e)return null;if(typeof e=="string"){const t=Ys(e);return this.readFromDocument(t)}return Ks(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Ar()}}const n0="http://www.w3.org/1999/xlink";function di(r){return r.getAttributeNS(n0,"href")}const It=[null,"http://www.opengis.net/ows/1.1"],i0=K(It,{ServiceIdentification:I(P0),ServiceProvider:I(C0),OperationsMetadata:I(R0)});class bd extends hu{constructor(){super()}readFromNode(e){const t=W({},i0,e,[]);return t||null}}const s0=K(It,{DeliveryPoint:I(V),City:I(V),AdministrativeArea:I(V),PostalCode:I(V),Country:I(V),ElectronicMailAddress:I(V)}),o0=K(It,{Value:Le(L0)}),a0=K(It,{AllowedValues:I(b0)}),l0=K(It,{Phone:I(A0),Address:I(_0)}),u0=K(It,{HTTP:I(T0)}),c0=K(It,{Get:Le(w0),Post:void 0}),h0=K(It,{DCP:I(E0)}),f0=K(It,{Operation:S0}),d0=K(It,{Voice:I(V),Facsimile:I(V)}),p0=K(It,{Constraint:Le(x0)}),m0=K(It,{IndividualName:I(V),PositionName:I(V),ContactInfo:I(v0)}),g0=K(It,{Abstract:I(V),AccessConstraints:I(V),Fees:I(V),Title:I(V),ServiceTypeVersion:I(V),ServiceType:I(V)}),y0=K(It,{ProviderName:I(V),ProviderSite:I(di),ServiceContact:I(I0)});function _0(r,e){return W({},s0,r,e)}function b0(r,e){return W({},o0,r,e)}function x0(r,e){const t=r.getAttribute("name");if(t)return W({name:t},a0,r,e)}function v0(r,e){return W({},l0,r,e)}function E0(r,e){return W({},u0,r,e)}function w0(r,e){const t=di(r);if(t)return W({href:t},p0,r,e)}function T0(r,e){return W({},c0,r,e)}function S0(r,e){const t=r.getAttribute("name"),n=W({},h0,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function R0(r,e){return W({},f0,r,e)}function A0(r,e){return W({},d0,r,e)}function P0(r,e){return W({},g0,r,e)}function I0(r,e){return W({},m0,r,e)}function C0(r,e){return W({},y0,r,e)}function L0(r,e){return V(r)}function Jc(r,e,t,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let l=2;l<n;++l)i[s++]=r[o++]}return i.length=s,i}class F0 extends cu{constructor(e){super(),e=e||{},this.dataProjection=xe("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t);return new At(n)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const n=bg(this.geometryLayout_),i=O0(e,n,this.factor_);Jc(i,0,i.length,n,i);const s=xg(i,0,i.length,n),o=new Tr(s,this.geometryLayout_);return lt(o,!1,this.adaptOptions(t))}writeFeatureText(e,t){const n=e.getGeometry();if(n)return this.writeGeometryText(n,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=lt(e,!0,this.adaptOptions(t));const n=e.getFlatCoordinates(),i=e.getStride();return Jc(n,0,n.length,i,n),M0(n,i,this.factor_)}}function M0(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<e;++n,++s){const a=r[s],l=a-i[n];i[n]=a,r[s]=l}return N0(r,t)}function O0(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;const s=D0(r,t);for(let o=0,a=s.length;o<a;)for(n=0;n<e;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function N0(r,e){e=e||1e5;for(let t=0,n=r.length;t<n;++t)r[t]=Math.round(r[t]*e);return U0(r)}function D0(r,e){e=e||1e5;const t=k0(r);for(let n=0,i=t.length;n<i;++n)t[n]/=e;return t}function U0(r){for(let e=0,t=r.length;e<t;++e){const n=r[e];r[e]=n<0?~(n<<1):n<<1}return z0(r)}function k0(r){const e=B0(r);for(let t=0,n=e.length;t<n;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function z0(r){let e="";for(let t=0,n=r.length;t<n;++t)e+=G0(r[t]);return e}function B0(r){const e=[];let t=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;t|=(o&31)<<n,o<32?(e.push(t),t=0,n=0):n+=5}return e}function G0(r){let e,t="";for(;r>=32;)e=(32|r&31)+63,t+=String.fromCharCode(e),r>>=5;return e=r+63,t+=String.fromCharCode(e),t}class we extends j{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,n)}}we.prototype.namespace="http://www.opengis.net/gml/3.2";we.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:ne(j.prototype.readFlatPos),posList:ne(j.prototype.readFlatPosList),coordinates:ne(ye.prototype.readFlatCoordinates)}};we.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:j.prototype.interiorParser,exterior:j.prototype.exteriorParser}};we.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ne(J.prototype.readPoint),MultiPoint:ne(J.prototype.readMultiPoint),LineString:ne(J.prototype.readLineString),MultiLineString:ne(J.prototype.readMultiLineString),LinearRing:ne(J.prototype.readLinearRing),Polygon:ne(J.prototype.readPolygon),MultiPolygon:ne(J.prototype.readMultiPolygon),Surface:ne(we.prototype.readSurface),MultiSurface:ne(j.prototype.readMultiSurface),Curve:ne(we.prototype.readCurve),MultiCurve:ne(j.prototype.readMultiCurve),Envelope:ne(we.prototype.readEnvelope)}};we.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:te(j.prototype.curveMemberParser),curveMembers:te(j.prototype.curveMemberParser)}};we.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:te(j.prototype.surfaceMemberParser),surfaceMembers:te(j.prototype.surfaceMemberParser)}};we.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:te(J.prototype.readLineString),Curve:te(j.prototype.readCurve)}};we.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:te(J.prototype.readPolygon),Surface:te(j.prototype.readSurface)}};we.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:ne(j.prototype.readPatch)}};we.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:ne(j.prototype.readSegment)}};we.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:te(j.prototype.readFlatPosList),upperCorner:te(j.prototype.readFlatPosList)}};we.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:ne(j.prototype.readPolygonPatch)}};we.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Zf(j.prototype.readLineStringSegment)}};we.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:te(J.prototype.pointMemberParser),pointMembers:te(J.prototype.pointMemberParser)}};we.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:te(J.prototype.lineStringMemberParser),lineStringMembers:te(J.prototype.lineStringMemberParser)}};we.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:te(J.prototype.polygonMemberParser),polygonMembers:te(J.prototype.polygonMemberParser)}};we.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:te(J.prototype.readFlatCoordinatesFromNode)}};we.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:te(J.prototype.readLineString)}};we.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:te(J.prototype.readPolygon)}};we.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:ne(J.prototype.readFlatLinearRing),Ring:ne(we.prototype.readFlatCurveRing)}};we.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:F(j.prototype.writeRing),interior:F(j.prototype.writeRing)}};we.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:F(_e),upperCorner:F(_e)}};we.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:F(j.prototype.writeSurfaceOrPolygonMember),polygonMember:F(j.prototype.writeSurfaceOrPolygonMember)}};we.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:F(j.prototype.writePointMember)}};we.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:F(j.prototype.writeLineStringOrCurveMember),curveMember:F(j.prototype.writeLineStringOrCurveMember)}};we.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:F(j.prototype.writeCurveOrLineString),MultiCurve:F(j.prototype.writeMultiCurveOrLineString),Point:F(we.prototype.writePoint),MultiPoint:F(j.prototype.writeMultiPoint),LineString:F(j.prototype.writeCurveOrLineString),MultiLineString:F(j.prototype.writeMultiCurveOrLineString),LinearRing:F(j.prototype.writeLinearRing),Polygon:F(j.prototype.writeSurfaceOrPolygon),MultiPolygon:F(j.prototype.writeMultiSurfaceOrPolygon),Surface:F(j.prototype.writeSurfaceOrPolygon),MultiSurface:F(j.prototype.writeMultiSurfaceOrPolygon),Envelope:F(j.prototype.writeEnvelope)}};class xd{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class $0 extends xd{constructor(e,t){super(e),this.conditions=t,Wt(this.conditions.length>=2,"At least 2 conditions are required")}}class j0 extends $0{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class V0 extends xd{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function X0(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(j0,e))}function q0(r,e,t){return new V0(r,e,t)}const Qc={"http://www.opengis.net/gml":{boundedBy:I(J.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:te(J.prototype.readFeaturesInternal)}},W0={"http://www.opengis.net/wfs":{totalInserted:I(Qe),totalUpdated:I(Qe),totalDeleted:I(Qe)},"http://www.opengis.net/wfs/2.0":{totalInserted:I(Qe),totalUpdated:I(Qe),totalDeleted:I(Qe)}},H0={"http://www.opengis.net/wfs":{TransactionSummary:I(th,"transactionSummary"),InsertResults:I(nh,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:I(th,"transactionSummary"),InsertResults:I(nh,"insertIds")}},Z0={"http://www.opengis.net/wfs":{PropertyName:F(_e)},"http://www.opengis.net/wfs/2.0":{PropertyName:F(_e)}},vd={"http://www.opengis.net/wfs":{Insert:F(ih),Update:F(oh),Delete:F(sh),Property:F(ah),Native:F(lh)},"http://www.opengis.net/wfs/2.0":{Insert:F(ih),Update:F(oh),Delete:F(sh),Property:F(ah),Native:F(lh)}},Ed="feature",fu="http://www.w3.org/2000/xmlns/",du={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},cl={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},pu={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},eh={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},mu={"2.0.0":we,"1.1.0":j,"1.0.0":ye},Y0="1.1.0";class K0 extends Oo{constructor(e){super(),e=e||{},this.version_=e.version?e.version:Y0,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new mu[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:eh[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const i=[n];let s;this.version_==="2.0.0"?s=Qc:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=W([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Ys(e);return this.readTransactionResponseFromDocument(t)}return Ks(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Ys(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Ks(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Xr(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,W(t,Qc,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return W({},H0,e,[])}writeGetFeature(e){const t=ce(cl[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS($i,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Wt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(Wt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(n,{geometryName:e.geometryName,filter:i}),_h(t,e.featureTypes,[n])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),_h(t,[i.name],[n])});return t}combineBboxAndFilter(e,t,n,i){const s=q0(e,t,n);return i?X0(i,s):s}writeTransaction(e,t,n,i){const s=[],o=i.version?i.version:this.version_,a=ce(cl[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS($i,"xsi:schemaLocation",eh[o]);const u=J0(a,l,o,i);return e&&Is("Insert",e,s,u),t&&Is("Update",t,s,u),n&&Is("Delete",n,s,u),i.nativeElements&&Is("Native",i.nativeElements,s,u),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(t,n),xe(n.pop().srsName)}}return null}}function J0(r,e,t,n){const i=n.featurePrefix?n.featurePrefix:Ed;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},e)}function Is(r,e,t,n){ke(n,vd,kt(r),e,t)}function th(r,e){return W({},W0,r,e)}const Q0={"http://www.opengis.net/ogc":{FeatureId:te(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:te(function(r,e){return r.getAttribute("fid")})}};function rh(r,e){Yr(Q0,r,e)}const eb={"http://www.opengis.net/wfs":{Feature:rh},"http://www.opengis.net/wfs/2.0":{Feature:rh}};function nh(r,e){return W([],eb,r,e)}function ih(r,e,t){const n=t[t.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=ce(s,i);r.appendChild(a),o===2?ye.prototype.writeFeatureElement(a,e,t):o===3?j.prototype.writeFeatureElement(a,e,t):we.prototype.writeFeatureElement(a,e,t)}function wd(r,e,t){const i=t[t.length-1].version,s=du[i],o=ce(s,"Filter"),a=ce(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),r.appendChild(o)}function gu(r,e){r=r||Ed;const t=r+":";return e.startsWith(t)?e:t+e}function sh(r,e,t){const n=t[t.length-1];Wt(e.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=gu(s,i);r.setAttribute("typeName",a),r.setAttributeNS(fu,"xmlns:"+s,o);const l=e.getId();l!==void 0&&wd(r,l,t)}function oh(r,e,t){const n=t[t.length-1];Wt(e.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=gu(o,s),u=e.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(fu,"xmlns:"+o,a);const h=e.getId();if(h!==void 0){const c=e.getKeys(),f=[];for(let m=0,p=c.length;m<p;m++){const y=e.get(c[m]);if(y!==void 0){let b=c[m];y&&typeof y.getSimplifiedGeometry=="function"&&(b=u),f.push({name:b,value:y})}}ke({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},vd,kt("Property"),f,t),wd(r,h,t)}}function ah(r,e,t){const n=t[t.length-1],i=n.version,s=cl[i],a=ce(s,i==="2.0.0"?"ValueReference":"Name"),l=n.gmlVersion;if(r.appendChild(a),_e(a,e.name),e.value!==void 0&&e.value!==null){const u=ce(s,"Value");r.appendChild(u),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?ye.prototype.writeGeometryElement(u,e.value,t):l===3?j.prototype.writeGeometryElement(u,e.value,t):we.prototype.writeGeometryElement(u,e.value,t):_e(u,e.value)}}function lh(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&_e(r,e.value)}const Vo={"http://www.opengis.net/wfs":{Query:F(uh)},"http://www.opengis.net/wfs/2.0":{Query:F(uh)},"http://www.opengis.net/ogc":{During:F(fh),And:F(Cs),Or:F(Cs),Not:F(dh),BBOX:F(ch),Contains:F($r),Intersects:F($r),Within:F($r),DWithin:F(hh),PropertyIsEqualTo:F(Gt),PropertyIsNotEqualTo:F(Gt),PropertyIsLessThan:F(Gt),PropertyIsLessThanOrEqualTo:F(Gt),PropertyIsGreaterThan:F(Gt),PropertyIsGreaterThanOrEqualTo:F(Gt),PropertyIsNull:F(ph),PropertyIsBetween:F(mh),PropertyIsLike:F(gh)},"http://www.opengis.net/fes/2.0":{During:F(fh),And:F(Cs),Or:F(Cs),Not:F(dh),BBOX:F(ch),Contains:F($r),Disjoint:F($r),Intersects:F($r),ResourceId:F(rb),Within:F($r),DWithin:F(hh),PropertyIsEqualTo:F(Gt),PropertyIsNotEqualTo:F(Gt),PropertyIsLessThan:F(Gt),PropertyIsLessThanOrEqualTo:F(Gt),PropertyIsGreaterThan:F(Gt),PropertyIsGreaterThanOrEqualTo:F(Gt),PropertyIsNull:F(ph),PropertyIsBetween:F(mh),PropertyIsLike:F(gh)}};function uh(r,e,t){const n=t[t.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let u;s?u=gu(s,e):u=e;let h;i==="2.0.0"?h="typeNames":h="typeName",r.setAttribute(h,u),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(fu,"xmlns:"+s,o);const c=Object.assign({},n);c.node=r,ke(c,Z0,kt("PropertyName"),a,t);const f=n.filter;if(f){const m=ce(Xo(i),"Filter");r.appendChild(m),tb(m,f,t)}}function tb(r,e,t){const n=t[t.length-1],i={node:r};Object.assign(i,{context:n}),ke(i,Vo,kt(e.getTagName()),[e],t)}function ch(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=mu[s];pi(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.extent,t)}function rb(r,e,t){r.setAttribute("rid",e.rid)}function $r(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=mu[s];pi(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.geometry,t)}function hh(r,e,t){const s=t[t.length-1].context.version;$r(r,e,t);const o=ce(Xo(s),"Distance");_e(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),r.appendChild(o)}function fh(r,e,t){const s=t[t.length-1].context.version;oo(pu[s],"ValueReference",r,e.propertyName);const o=ce(Fr,"TimePeriod");r.appendChild(o);const a=ce(Fr,"begin");o.appendChild(a),yh(a,e.begin);const l=ce(Fr,"end");o.appendChild(l),yh(l,e.end)}function Cs(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const u=o[a];ke(s,Vo,kt(u.getTagName()),[u],t)}}function dh(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.condition;ke(s,Vo,kt(o.getTagName()),[o],t)}function Gt(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),pi(s,r,e.propertyName),ao(s,r,""+e.expression)}function ph(r,e,t){const s=t[t.length-1].context.version;pi(s,r,e.propertyName)}function mh(r,e,t){const s=t[t.length-1].context.version,o=Xo(s);pi(s,r,e.propertyName);const a=ce(o,"LowerBoundary");r.appendChild(a),ao(s,a,""+e.lowerBoundary);const l=ce(o,"UpperBoundary");r.appendChild(l),ao(s,l,""+e.upperBoundary)}function gh(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),pi(s,r,e.propertyName),ao(s,r,""+e.pattern)}function oo(r,e,t,n){const i=ce(r,e);_e(i,n),t.appendChild(i)}function ao(r,e,t){oo(Xo(r),"Literal",e,t)}function pi(r,e,t){r==="2.0.0"?oo(pu[r],"ValueReference",e,t):oo(du[r],"PropertyName",e,t)}function yh(r,e){const t=ce(Fr,"TimeInstant");r.appendChild(t);const n=ce(Fr,"timePosition");t.appendChild(n),_e(n,e)}function _h(r,e,t){const n=t[t.length-1],i=Object.assign({},n);i.node=r,ke(i,Vo,kt("Query"),e,t)}function Xo(r){let e;return r==="2.0.0"?e=pu[r]:e=du[r],e}const Me={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class bh{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readLineString());return t}readWkbHeader(e){const n=this.readUint8()>0,i=this.readUint32(n),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),u=(i&268435455)%1e3,h=["XY",o?"Z":"",a?"M":""].join(""),c=l?this.readUint32(n):null;if(e!==void 0&&e!==u)throw new Error("Unexpected WKB geometry type "+u);if(this.initialized_){if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=n,this.hasZ_=o,this.hasM_=a,this.layout_=h,this.srid_=c,this.initialized_=!0;return u}readWkbPayload(e){switch(e){case Me.POINT:return this.readPoint();case Me.LINE_STRING:return this.readLineString();case Me.POLYGON:case Me.TRIANGLE:return this.readPolygon();case Me.MULTI_POINT:return this.readMultiPoint();case Me.MULTI_LINE_STRING:return this.readMultiLineString();case Me.MULTI_POLYGON:case Me.POLYHEDRAL_SURFACE:case Me.TIN:return this.readMultiPolygon();case Me.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Me.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Me.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Me.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case Me.POINT:return new Xt(t,this.layout_);case Me.LINE_STRING:return new Tr(t,this.layout_);case Me.POLYGON:case Me.TRIANGLE:return new wn(t,this.layout_);case Me.MULTI_POINT:return new Mo(t,this.layout_);case Me.MULTI_LINE_STRING:return new li(t,this.layout_);case Me.MULTI_POLYGON:case Me.POLYHEDRAL_SURFACE:case Me.TIN:return new as(t,this.layout_);case Me.GEOMETRY_COLLECTION:return new Qr(t);default:return null}}getSrid(){return this.srid_}}class nb{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const n=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writePoint(e[n],t)}writePolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeLineString(e[n],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(1),this.writePoint(e[n],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(2),this.writeLineString(e[n],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(3),this.writePolygon(e[n],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof zc)return n(e.getLayout(),t);if(e instanceof Qr){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const n={Point:Me.POINT,LineString:Me.LINE_STRING,Polygon:Me.POLYGON,MultiPoint:Me.MULTI_POINT,MultiLineString:Me.MULTI_LINE_STRING,MultiPolygon:Me.MULTI_POLYGON,GeometryCollection:Me.GEOMETRY_COLLECTION},i=e.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof zc?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof Qr&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),n=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class ib extends Kf{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new At({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let n=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof Qr?n=i.getGeometriesArray():n=[i],n.map(s=>new At({geometry:s}))}readGeometry(e,t){const n=xh(e);if(!n)return null;const s=new bh(n).readGeometry();return this.viewCache_=n,t=this.getReadOptions(e,t),this.viewCache_=null,lt(s,!1,t)}readProjection(e){const t=this.viewCache_||xh(e);if(!t)return;const n=new bh(t);return n.readWkbHeader(),n.getSrid()&&xe("EPSG:"+n.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new Qr(e.map(n=>n.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const n=new nb({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&xe(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(lt(e,!0,t),i);const s=n.getBuffer();return this.hex_?sb(s):s}}function sb(r){const e=new Uint8Array(r);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function ob(r){const e=new Uint8Array(r.length/2);for(let t=0;t<r.length/2;t++)e[t]=parseInt(r.substr(t*2,2),16);return new DataView(e.buffer)}function xh(r){return typeof r=="string"?ob(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const ab={POINT:Xt,LINESTRING:Tr,POLYGON:wn,MULTIPOINT:Mo,MULTILINESTRING:li,MULTIPOLYGON:as},Td="EMPTY",Sd="Z",Rd="M",lb="ZM",Ce={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},ub={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class cb{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let n=e,i;if(e=="(")i=Ce.LEFT_PAREN;else if(e==",")i=Ce.COMMA;else if(e==")")i=Ce.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")i=Ce.NUMBER,n=this.readNumber_();else if(this.isAlpha_(e))i=Ce.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")i=Ce.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:n,type:i}}readNumber_(){let e;const t=this.index_;let n=!1,i=!1;do e=="."?n=!0:(e=="e"||e=="E")&&(i=!0),e=this.nextChar_();while(this.isNumeric_(e,n)||!i&&(e=="e"||e=="E")||i&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class hb{constructor(e){this.lexer_=e,this.token_={position:0,type:Ce.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(Ce.TEXT)){const n=t.value;n===Sd?e="XYZ":n===Rd?e="XYM":n===lb&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(Ce.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(Ce.COMMA));if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(Ce.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(Ce.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(Ce.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(Ce.LEFT_PAREN)){let e;if(this.token_.type==Ce.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(Ce.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(Ce.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(Ce.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let n=0;n<t;++n){const i=this.token_;if(this.match(Ce.NUMBER))e.push(i.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(Ce.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(Ce.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(Ce.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(Ce.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(Ce.TEXT)&&this.token_.value==Td;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(Ce.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(n)return new Qr([]);const o=this.parseGeometryCollectionText_();return new Qr(o)}const i=ab[t];if(!i)throw new Error("Invalid geometry type: "+t);let s;if(n)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new i(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class fb extends cu{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new cb(e);return new hb(t).parse()}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t),i=new At;return i.setGeometry(n),i}readFeaturesFromText(e,t){let n=[];const i=this.readGeometryFromText(e,t);this.splitCollection_&&i.getType()=="GeometryCollection"?n=i.getGeometriesArray():n=[i];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new At;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(e,t){const n=this.parse_(e);return lt(n,!1,t)}writeFeatureText(e,t){const n=e.getGeometry();return n?this.writeGeometryText(n,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const n=[];for(let s=0,o=e.length;s<o;++s)n.push(e[s].getGeometry());const i=new Qr(n);return this.writeGeometryText(i,t)}writeGeometryText(e,t){return Id(lt(e,!0,t))}}function Ad(r){const e=r.getCoordinates();return e.length===0?"":e.join(" ")}function db(r){const e=[],t=r.getPoints();for(let n=0,i=t.length;n<i;++n)e.push("("+Ad(t[n])+")");return e.join(",")}function pb(r){const e=[],t=r.getGeometries();for(let n=0,i=t.length;n<i;++n)e.push(Id(t[n]));return e.join(",")}function yu(r){const e=r.getCoordinates(),t=[];for(let n=0,i=e.length;n<i;++n)t.push(e[n].join(" "));return t.join(",")}function mb(r){const e=[],t=r.getLineStrings();for(let n=0,i=t.length;n<i;++n)e.push("("+yu(t[n])+")");return e.join(",")}function Pd(r){const e=[],t=r.getLinearRings();for(let n=0,i=t.length;n<i;++n)e.push("("+yu(t[n])+")");return e.join(",")}function gb(r){const e=[],t=r.getPolygons();for(let n=0,i=t.length;n<i;++n)e.push("("+Pd(t[n])+")");return e.join(",")}function yb(r){const e=r.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=Sd),(e==="XYM"||e==="XYZM")&&(t+=Rd),t}const _b={Point:Ad,LineString:yu,Polygon:Pd,MultiPoint:db,MultiLineString:mb,MultiPolygon:gb,GeometryCollection:pb};function Id(r){const e=r.getType(),t=_b[e],n=t(r);let i=ub[e];if(typeof r.getFlatCoordinates=="function"){const s=yb(r);s.length>0&&(i+=" "+s)}return n.length===0?i+" "+Td:i+"("+n+")"}const it=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function ps(r){return vg(r[0].version,"1.3")>=0}const bb=K(it,{Service:I(Gb),Capability:I(Bb)}),xb=K(it,{Request:I(Yb),Exception:I(Xb),Layer:I(qb),UserDefinedSymbolization:I(kb)});class vb extends hu{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=W({version:this.version},bb,e,[]);return t||null}}const Cd={Name:I(V),Title:I(V),Abstract:I(V),KeywordList:I(Dd),OnlineResource:I(di),ContactInformation:I($b),Fees:I(V),AccessConstraints:I(V)},Eb=K(it,Cd),wb=K(it,{...Cd,LayerLimit:I(Qe),MaxWidth:I(Qe),MaxHeight:I(Qe)}),Tb=K(it,{ContactPersonPrimary:I(jb),ContactPosition:I(V),ContactAddress:I(Vb),ContactVoiceTelephone:I(V),ContactFacsimileTelephone:I(V),ContactElectronicMailAddress:I(V)}),Sb=K(it,{ContactPerson:I(V),ContactOrganization:I(V)}),Rb=K(it,{AddressType:I(V),Address:I(V),City:I(V),StateOrProvince:I(V),PostCode:I(V),Country:I(V)}),Ab=K(it,{Format:te(V)}),Ld={Name:I(V),Title:I(V),Abstract:I(V),KeywordList:I(Dd),BoundingBox:Le(Od),Dimension:Le(Wb),Attribution:I(Ub),AuthorityURL:Le(Qb),Identifier:Le(V),MetadataURL:Le(ex),DataURL:Le(Nr),FeatureListURL:Le(Nr),Style:Le(tx),Layer:Le(qo)},Fd=K(it,{...Ld,SRS:Le(V),Extent:I(Hb),ScaleHint:Le(Zb),LatLonBoundingBox:I((r,e)=>Od(r,e,!1)),Layer:Le(qo)}),Md=K(it,{...Ld,CRS:Le(V),EX_GeographicBoundingBox:I(zb),MinScaleDenominator:I(_t),MaxScaleDenominator:I(_t),Layer:Le(qo)}),Pb=K(it,{Title:I(V),OnlineResource:I(di),LogoURL:I(Nd)}),Ib=K(it,{westBoundLongitude:I(_t),eastBoundLongitude:I(_t),southBoundLatitude:I(_t),northBoundLatitude:I(_t)}),Cb=K(it,{GetCapabilities:I(Si),GetMap:I(Si),GetFeatureInfo:I(Si),DescribeLayer:I(Si),GetLegendGraphic:I(Si)}),Lb=K(it,{Format:Le(V),DCPType:Le(Kb)}),Fb=K(it,{HTTP:I(Jb)}),Mb=K(it,{Get:I(Nr),Post:I(Nr)}),Ob=K(it,{Name:I(V),Title:I(V),Abstract:I(V),LegendURL:Le(Nd),StyleSheetURL:I(Nr),StyleURL:I(Nr)}),Nb=K(it,{Format:I(V),OnlineResource:I(di)}),Db=K(it,{Keyword:te(V)});function Ub(r,e){return W({},Pb,r,e)}function kb(r,e){return{SupportSLD:!!Ft(r.getAttribute("SupportSLD")),UserLayer:!!Ft(r.getAttribute("UserLayer")),UserStyle:!!Ft(r.getAttribute("UserStyle")),RemoteWFS:!!Ft(r.getAttribute("RemoteWFS")),InlineFeatureData:!!Ft(r.getAttribute("InlineFeatureData")),RemoteWCS:!!Ft(r.getAttribute("RemoteWCS"))}}function Od(r,e,t=!0){const n=[fr(r.getAttribute("minx")),fr(r.getAttribute("miny")),fr(r.getAttribute("maxx")),fr(r.getAttribute("maxy"))],i=[fr(r.getAttribute("resx")),fr(r.getAttribute("resy"))],s={extent:n,res:i};return t&&(ps(e)?s.crs=r.getAttribute("CRS"):s.srs=r.getAttribute("SRS")),s}function zb(r,e){const t=W({},Ib,r,e);if(!t)return;const n=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function Bb(r,e){return W({},xb,r,e)}function Gb(r,e){return W({},ps(e)?wb:Eb,r,e)}function $b(r,e){return W({},Tb,r,e)}function jb(r,e){return W({},Sb,r,e)}function Vb(r,e){return W({},Rb,r,e)}function Xb(r,e){return W([],Ab,r,e)}function qb(r,e){const t=W({},ps(e)?Md:Fd,r,e);return t.Layer===void 0?Object.assign(t,qo(r,e)):t}function qo(r,e){const t=ps(e),n=e[e.length-1],i=W({},t?Md:Fd,r,e);if(!i)return;let s=Ft(r.getAttribute("queryable"));s===void 0&&(s=n.queryable),i.queryable=s!==void 0?s:!1;let o=Xr(r.getAttribute("cascaded"));o===void 0&&(o=n.cascaded),i.cascaded=o;let a=Ft(r.getAttribute("opaque"));a===void 0&&(a=n.opaque),i.opaque=a!==void 0?a:!1;let l=Ft(r.getAttribute("noSubsets"));l===void 0&&(l=n.noSubsets),i.noSubsets=l!==void 0?l:!1;let u=fr(r.getAttribute("fixedWidth"));u||(u=n.fixedWidth),i.fixedWidth=u;let h=fr(r.getAttribute("fixedHeight"));h||(h=n.fixedHeight),i.fixedHeight=h;const c=["Style","AuthorityURL"];t?c.push("CRS"):c.push("SRS","Dimension"),c.forEach(function(m){if(m in n){const p=i[m]||[];i[m]=p.concat(n[m])}});const f=["BoundingBox","Attribution"];return t?f.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):f.push("LatLonBoundingBox","ScaleHint","Extent"),f.forEach(function(m){if(!(m in i)){const p=n[m];i[m]=p}}),i}function Wb(r,e){const t={name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol")};return ps(e)&&Object.assign(t,{default:r.getAttribute("default"),multipleValues:Ft(r.getAttribute("multipleValues")),nearestValue:Ft(r.getAttribute("nearestValue")),current:Ft(r.getAttribute("current")),values:V(r)}),t}function Hb(r,e){return{name:r.getAttribute("name"),default:r.getAttribute("default"),nearestValue:Ft(r.getAttribute("nearestValue"))}}function Zb(r,e){return{min:fr(r.getAttribute("min")),max:fr(r.getAttribute("max"))}}function Nr(r,e){return W({},Nb,r,e)}function Yb(r,e){return W({},Cb,r,e)}function Kb(r,e){return W({},Fb,r,e)}function Jb(r,e){return W({},Mb,r,e)}function Si(r,e){return W({},Lb,r,e)}function Nd(r,e){const t=Nr(r,e);if(t){const n=[Xr(r.getAttribute("width")),Xr(r.getAttribute("height"))];return t.size=n,t}}function Qb(r,e){const t=Nr(r,e);if(t)return t.name=r.getAttribute("name"),t}function ex(r,e){const t=Nr(r,e);if(t)return t.type=r.getAttribute("type"),t}function tx(r,e){return W({},Ob,r,e)}function Dd(r,e){return W([],Db,r,e)}const rx="_feature",nx="_layer";class ix extends Oo{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new ye,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const n=e.localName;let i=[];if(e.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,u=t[0],h=nx,c=l.localName.replace(h,"");if(this.layers_&&!this.layers_.includes(c))continue;const f=c+rx;u.featureType=f,u.featureNS=this.featureNS_;const m={};m[f]=te(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const p=K([u.featureNS,null],m);l.setAttribute("namespaceURI",this.featureNS_);const y=W([],p,l,t,this.gmlFormat_);y&&Zs(i,y)}if(n=="FeatureCollection"){const s=W([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const n={};return t&&Object.assign(n,this.getReadOptions(e,t)),this.readFeatures_(e,[n])}}const Sr=[null,"http://www.opengis.net/wmts/1.0"],mi=[null,"http://www.opengis.net/ows/1.1"],sx=K(Sr,{Contents:I(mx)});let _u=class extends hu{constructor(){super(),this.owsParser_=new bd}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=W(n,sx,e,[]),n||null):null}};const ox=K(Sr,{Layer:Le(gx),TileMatrixSet:Le(yx)}),ax=K(Sr,{Style:Le(_x),Format:Le(V),TileMatrixSetLink:Le(bx),Dimension:Le(xx),ResourceURL:Le(vx)},K(mi,{Title:I(V),Abstract:I(V),WGS84BoundingBox:I(kd),BoundingBox:Le(Ex),Identifier:I(V)})),lx=K(Sr,{LegendURL:Le(wx)},K(mi,{Title:I(V),Identifier:I(V)})),ux=K(Sr,{TileMatrixSet:I(V),TileMatrixSetLimits:I(Sx)}),cx=K(Sr,{TileMatrixLimits:te(Rx)}),hx=K(Sr,{TileMatrix:I(V),MinTileRow:I(Qe),MaxTileRow:I(Qe),MinTileCol:I(Qe),MaxTileCol:I(Qe)}),fx=K(Sr,{Default:I(V),Value:Le(V)},K(mi,{Identifier:I(V)})),Ud=K(mi,{LowerCorner:te(hl),UpperCorner:te(hl)}),dx=K(Sr,{WellKnownScaleSet:I(V),TileMatrix:Le(Tx)},K(mi,{SupportedCRS:I(V),Identifier:I(V),BoundingBox:I(kd)})),px=K(Sr,{TopLeftCorner:I(hl),ScaleDenominator:I(_t),TileWidth:I(Qe),TileHeight:I(Qe),MatrixWidth:I(Qe),MatrixHeight:I(Qe)},K(mi,{Identifier:I(V)}));function mx(r,e){return W({},ox,r,e)}function gx(r,e){return W({},ax,r,e)}function yx(r,e){return W({},dx,r,e)}function _x(r,e){const t=W({},lx,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function bx(r,e){return W({},ux,r,e)}function xx(r,e){return W({},fx,r,e)}function vx(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return t&&(s.format=t),n&&(s.template=n),i&&(s.resourceType=i),s}function kd(r,e){const t=W([],Ud,r,e);if(t.length==2)return ql(t)}function Ex(r,e){const t=r.getAttribute("crs"),n=W([],Ud,r,e);if(n.length==2)return{extent:ql(n),crs:t}}function wx(r,e){const t={};return t.format=r.getAttribute("format"),t.href=di(r),t}function hl(r,e){const t=V(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function Tx(r,e){return W({},px,r,e)}function Sx(r,e){return W([],cx,r,e)}function Rx(r,e){return W({},hx,r,e)}window.eoxMapAdvancedOlFormats={EsriJSON:Gy,GML:su,GPX:p_,IGC:Y_,IIIFInfo:r0,KML:wg,OWS:bd,Polyline:F0,TopoJSON:Eg,WFS:K0,WKB:ib,WKT:fb,WMSCapabilities:vb,WMSGetFeatureInfo:ix,WMTSCapabilities:_u};function zd(r,e,t){const n=[];let i=r(0),s=r(1),o=e(i),a=e(s);const l=[s,i],u=[a,o],h=[1,0],c={};let f=1e5,m,p,y,b,E,v;for(;--f>0&&h.length>0;)y=h.pop(),i=l.pop(),o=u.pop(),v=y.toString(),v in c||(n.push(o[0],o[1]),c[v]=!0),b=h.pop(),s=l.pop(),a=u.pop(),E=(y+b)/2,m=r(E),p=e(m),Tg(p[0],p[1],o[0],o[1],a[0],a[1])<t?(n.push(a[0],a[1]),v=b.toString(),c[v]=!0):(h.push(b,E,E,y),u.push(a,p,p,o),l.push(s,m,m,i));return n}function Ax(r,e,t,n,i){const s=xe("EPSG:4326");return zd(function(o){return[r,e+(t-e)*o]},Qs(s,n),i)}function Px(r,e,t,n,i){const s=xe("EPSG:4326");return zd(function(o){return[e+(t-e)*o,r]},Qs(s,n),i)}function Ix(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],n=Math.sqrt(e*e+t*t),i=r.frameState,s=ji(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Sg(i.viewState.resolution,n);let a;return new Rg(r.context,n,i.extent,s,i.viewState.rotation,o,a)}const Cx=new qr({color:"rgba(0,0,0,0.2)"}),Lx=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class Fx extends ls{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:Cx,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?Bc.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?Bc.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new dr({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new tl({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Wr({color:"rgba(0,0,0,1)"}),stroke:new qr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new dr({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new tl({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Wr({color:"rgba(0,0,0,1)"}),stroke:new qr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(fn.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:Lx,this.setSource(new Kr({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Ag,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new dr({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&Pg(n,this.projection_),this.loadedExtent_&&(Ig(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=gr(s,e);if(this.renderedExtent_&&Vi(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,Do(o)))return;const a=yr(o),l=t*t/4;(!this.projection_||!Ni(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,t,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let c;for(;h>this.featurePool_.length;)c=new At,this.featurePool_.push(c);const f=i.getFeaturesCollection();f.clear();let m=0,p,y;for(p=0,y=this.meridians_.length;p<y;++p)c=this.featurePool_[m++],c.setGeometry(this.meridians_[p]),c.setStyle(this.lineStyle_),f.push(c);for(p=0,y=this.parallels_.length;p<y;++p)c=this.featurePool_[m++],c.setGeometry(this.parallels_[p]),c.setStyle(this.lineStyle_),f.push(c)}addMeridian_(e,t,n,i,s,o){const a=this.getMeridian_(e,t,n,i,o);if(Jn(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new Xt([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,n,i,s,o){const a=this.getParallel_(e,t,n,i,o);if(Jn(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new Xt([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=yr(s);let a=s;if(t){const p=i[0]*n,y=i[1]*n;a=[o[0]-p/2,o[1]-y/2,o[0]+p/2,o[1]+y/2]}let l=0,u=0,h=this.latLabelPosition_<.5;const c=this.projection_.getExtent(),f=dt(c);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ws(c,s)){l=Math.floor((s[0]-c[0])/f),u=Math.ceil((s[2]-c[2])/f);const p=Math.abs(t)>Math.PI/2;h=h!==p}const m=Ix(e);for(let p=l;p<=u;++p){let y=this.meridians_.length+this.parallels_.length,b,E,v,w;if(this.meridiansLabels_)for(E=0,v=this.meridiansLabels_.length;E<v;++E){const P=this.meridians_[E];if(!t&&p===0)w=this.getMeridianPoint_(P,s,E);else{const T=P.clone();T.translate(p*f,0),T.rotate(-t,o),w=this.getMeridianPoint_(T,a,E),w.rotate(t,o)}b=this.featurePool_[y++],b.setGeometry(w),b.set("graticule_label",this.meridiansLabels_[E].text),m.drawFeature(b,this.lonLabelStyle_(b))}if(this.parallelsLabels_&&(p===l&&h||p===u&&!h))for(E=0,v=this.parallels_.length;E<v;++E){const P=this.parallels_[E];if(!t&&p===0)w=this.getParallelPoint_(P,s,E);else{const T=P.clone();T.translate(p*f,0),T.rotate(-t,o),w=this.getParallelPoint_(T,a,E),w.rotate(t,o)}b=this.featurePool_[y++],b.setGeometry(w),b.set("graticule_label",this.parallelsLabels_[E].text),m.drawFeature(b,this.latLabelStyle_(b))}}}createGraticule_(e,t,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=dt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ws(a,e)&&(dt(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const u=[We(t[0],this.minX_,this.maxX_),We(t[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(u);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let c=We(h[0],this.minLon_,this.maxLon_),f=We(h[1],this.minLat_,this.maxLat_);const m=this.maxLines_;let p,y,b,E,v=e;o||(v=[We(e[0],this.minX_,this.maxX_),We(e[1],this.minY_,this.maxY_),We(e[2],this.minX_,this.maxX_),We(e[3],this.minY_,this.maxY_)]);const w=Qn(v,this.toLonLatTransform_,void 0,8);let P=w[3],T=w[2],R=w[1],C=w[0];if(o||(Vn(v,this.bottomLeft_)&&(C=this.minLon_,R=this.minLat_),Vn(v,this.bottomRight_)&&(T=this.maxLon_,R=this.minLat_),Vn(v,this.topLeft_)&&(C=this.minLon_,P=this.maxLat_),Vn(v,this.topRight_)&&(T=this.maxLon_,P=this.maxLat_),P=We(P,f,this.maxLat_),T=We(T,c,this.maxLon_),R=We(R,this.minLat_,f),C=We(C,this.minLon_,c)),c=Math.floor(c/s)*s,E=We(c,this.minLon_,this.maxLon_),y=this.addMeridian_(E,R,P,i,e,0),p=0,o)for(;(E-=s)>=C&&p++<m;)y=this.addMeridian_(E,R,P,i,e,y);else for(;E!=this.minLon_&&p++<m;)E=Math.max(E-s,this.minLon_),y=this.addMeridian_(E,R,P,i,e,y);if(E=We(c,this.minLon_,this.maxLon_),p=0,o)for(;(E+=s)<=T&&p++<m;)y=this.addMeridian_(E,R,P,i,e,y);else for(;E!=this.maxLon_&&p++<m;)E=Math.min(E+s,this.maxLon_),y=this.addMeridian_(E,R,P,i,e,y);for(this.meridians_.length=y,this.meridiansLabels_&&(this.meridiansLabels_.length=y),f=Math.floor(f/s)*s,b=We(f,this.minLat_,this.maxLat_),y=this.addParallel_(b,C,T,i,e,0),p=0;b!=this.minLat_&&p++<m;)b=Math.max(b-s,this.minLat_),y=this.addParallel_(b,C,T,i,e,y);for(b=We(f,this.minLat_,this.maxLat_),p=0;b!=this.maxLat_&&p++<m;)b=Math.min(b+s,this.maxLat_),y=this.addParallel_(b,C,T,i,e,y);this.parallels_.length=y,this.parallelsLabels_&&(this.parallelsLabels_.length=y)}getInterval_(e){const t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,u=this.intervals_.length;l<u;++l){const h=We(this.intervals_[l]/2,0,90),c=We(n,-90+h,90-h);if(o[0]=t-h,o[1]=c-h,a[0]=t+h,a[1]=c+h,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,n,i,s){const o=Ax(e,t,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new Tr(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,n){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),u=We(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),c=[i[s-1]+(i[o-1]-i[s-1])*(u-i[s])/(i[o]-i[s]),u],f=this.meridiansLabels_[n].geom;return f.setCoordinates(c),f}getMeridians(){return this.meridians_}getParallel_(e,t,n,i,s){const o=Px(e,t,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new Tr(o,"XY"),a}getParallelPoint_(e,t,n){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),u=We(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),h=i[s+1]+(i[o+1]-i[s+1])*(u-i[s])/(i[o]-i[s]),c=[u,h],f=this.parallelsLabels_[n].geom;return f.setCoordinates(c),f}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=xe("EPSG:4326"),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=Qs(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,u){u=u||2;const h=i(a,l,u);for(let c=0,f=h.length;c<f;c+=u)h[c]<o&&(h[c]+=360);return h}}this.fromLonLatTransform_=Qs(t,e);const s=Qn([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(yr(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}function Cn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lo(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}function fl(r,e,t,n,i,s,o){o=o??Cn();const a=1/(r-e),l=1/(t-n),u=1/(i-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*u,o[11]=0,o[12]=(r+e)*a,o[13]=(n+t)*l,o[14]=(s+i)*u,o[15]=1,o}function vh(r,e,t,n,i){return i=i??Cn(),i[0]=r[0]*e,i[1]=r[1]*e,i[2]=r[2]*e,i[3]=r[3]*e,i[4]=r[4]*t,i[5]=r[5]*t,i[6]=r[6]*t,i[7]=r[7]*t,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,i[11]=r[11]*n,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function Mx(r,e,t,n,i){i=i??Cn();let s,o,a,l,u,h,c,f,m,p,y,b;return r===i?(i[12]=r[0]*e+r[4]*t+r[8]*n+r[12],i[13]=r[1]*e+r[5]*t+r[9]*n+r[13],i[14]=r[2]*e+r[6]*t+r[10]*n+r[14],i[15]=r[3]*e+r[7]*t+r[11]*n+r[15]):(s=r[0],o=r[1],a=r[2],l=r[3],u=r[4],h=r[5],c=r[6],f=r[7],m=r[8],p=r[9],y=r[10],b=r[11],i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=u,i[5]=h,i[6]=c,i[7]=f,i[8]=m,i[9]=p,i[10]=y,i[11]=b,i[12]=s*e+u*t+m*n+r[12],i[13]=o*e+h*t+p*n+r[13],i[14]=a*e+c*t+y*n+r[14],i[15]=l*e+f*t+b*n+r[15]),i}function Ox(r,e,t,n){return n=n??Cn(),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r,n[13]=e,n[14]=t,n[15]=1,n}const ms=34962,gs=34963,bu=35044,uo=35048,Nx=5121,Dx=5123,Ux=5125,Bd=5126,Eh=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function kx(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!Cg},e);const t=Eh.length;for(let n=0;n<t;++n)try{const i=r.getContext(Eh[n],e);if(i)return i}catch{}return null}const zx={STATIC_DRAW:bu};class ei{constructor(e,t){this.array_=null,this.type_=e,Wt(e===ms||e===gs,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:zx.STATIC_DRAW}ofSize(e){return this.array_=new(Ls(this.type_))(e),this}fromArray(e){return this.array_=Ls(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Ls(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Ls(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Ls(r){switch(r){case ms:return Float32Array;case gs:return Uint32Array;default:return Float32Array}}const Fs={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Bx=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Gx=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class wh{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||Bx),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||Gx),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,n[0],n[1],o,a,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Te(s.canvas);if(!e.renderTargets[l]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}const hr={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},et={UNSIGNED_BYTE:Nx,UNSIGNED_SHORT:Dx,UNSIGNED_INT:Ux,FLOAT:Bd},co={};function Th(r){return"shared/"+r}let Sh=0;function $x(){const r="unique/"+Sh;return Sh+=1,r}function jx(r){let e=co[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:kx(t)},co[r]=e}return e.users+=1,e.context}function Vx(r){const e=co[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=t.canvas;i.width=1,i.height=1,delete co[r]}class Xx extends Jf{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Th(e.canvasCacheKey):$x(),this.gl_=jx(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Fs.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Fs.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=ft(),this.offsetScaleMatrix_=ft(),this.tmpMat4_=Cn(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new wh({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new wh({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Th(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Te(e);let i=this.bufferCache_[n];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=Te(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Fs.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Fs.RESTORED,this.boundHandleWebGLContextRestored_),Vx(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,e),t&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const n=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}bindAttribute(e,t,n){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,n,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,n,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(hr.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(hr.ZOOM,e.viewState.zoom),this.setUniformFloatValue(hr.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(hr.PIXEL_RATIO,i),this.setUniformFloatVec2(hr.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(hr.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(hr.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(hr.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,lo(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Te(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Te(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Wl(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,n,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,s))}enableAttributes(e){const t=qx(e);let n=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||Bd,t,n),n+=s.size*Gd(s.type)}}handleWebGLContextLost(e){Lg(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n,i){const s=this.gl_;n=n||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,u=0,h=s.RGBA,c=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,h,c,t):t?s.texImage2D(s.TEXTURE_2D,a,l,h,c,t):s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,h,c,null),n}}function qx(r){let e=0;for(let t=0;t<r.length;t++){const n=r[t];e+=n.size*Gd(n.type)}return e}function Gd(r){switch(r){case et.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case et.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case et.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case et.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Wx extends Fg{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(Tt.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===ue.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Hl){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(Tt.CHANGE,this.handleTileChange_)}}uploadTile(){Ar()}setReady(){this.ready=!0,this.dispatchEvent(Tt.CHANGE)}handleTileChange_(){this.tile.getState()===ue.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(Tt.CHANGE,this.handleTileChange_)}}function $d(r,e,t){const n=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function Hx(r,e,t,n){$d(r,e,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function Rh(r,e,t,n,i,s){const o=r.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),$d(o,e,s&&l);const u=t.byteLength/n[1];let h=1;u%8===0?h=8:u%4===0?h=4:u%2===0&&(h=2);let c;switch(i){case 1:{c=o.LUMINANCE;break}case 2:{c=o.LUMINANCE_ALPHA;break}case 3:{c=o.RGB;break}case 4:{c=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,c,n[0],n[1],0,c,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let kn=null;function Zx(){kn=en(1,1,void 0,{willReadFrequently:!0})}class Yx extends Wx{constructor(e){super(e),this.textures=[],this.renderSize_=tr(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new ei(ms,bu);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var n;const t=(n=this.helper)==null?void 0:n.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof Hl||n instanceof Mg?i=n.getImage():i=n.getData();const s=nl(i);if(s){const v=t.createTexture();this.textures.push(v),this.bandCount=4,Hx(t,v,s,n.interpolate),this.setReady();return}i=rl(i);const o=n.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=i instanceof Float32Array,u=a[0]*a[1],h=l?Float32Array:Uint8Array,c=h.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/c/a[0]);const m=Math.ceil(this.bandCount/4);if(m===1){const v=t.createTexture();this.textures.push(v),Rh(e,v,i,a,this.bandCount,n.interpolate),this.setReady();return}const p=new Array(m);for(let v=0;v<m;++v){const w=t.createTexture();this.textures.push(w);const P=v<m-1?4:(this.bandCount-1)%4+1;p[v]=new h(u*P)}let y=0,b=0;const E=a[0]*this.bandCount;for(let v=0;v<a[1];++v){for(let w=0;w<E;++w){const P=i[b+w],T=Math.floor(y/this.bandCount),R=w%this.bandCount,C=Math.floor(R/4),D=p[C],U=D.length/u,M=R%4;D[T*U+M]=P,++y}b+=f/c}for(let v=0;v<m;++v){const w=this.textures[v],P=p[v],T=P.length/u;Rh(e,w,P,a,T,n.interpolate)}this.setReady()}getImagePixelData_(e,t,n){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];kn||Zx(),kn.clearRect(0,0,1,1);const a=e.width,l=e.height,u=a-2*i,h=l-2*i,c=i+Math.floor(u*(t/s)),f=i+Math.floor(h*(n/o));let m;try{kn.drawImage(e,c,f,1,1,0,0,1,1),m=kn.getImageData(0,0,1,1).data}catch{return kn=null,null}return m}getArrayPixelData_(e,t,n,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],u=t[1],h=l+2*s,c=u+2*s,f=s+Math.floor(l*(n/o)),m=s+Math.floor(u*(i/a));if(e instanceof DataView){const y=e.byteLength/(h*c),b=y*(m*h+f),E=e.buffer.slice(b,b+y);return new DataView(E)}const p=this.bandCount*(m*h+f);return e.slice(p,p+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Zl){const n=this.tile.getData(),i=rl(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(nl(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class ys extends Og{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=ft(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(il.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(fn.PRECOMPOSE)){const i=new Ea(fn.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(fn.POSTCOMPOSE)){const i=new Ea(fn.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,u=l.getRenderer();if(!(u instanceof ys)){t=!0;continue}const h=l.getClassName();if((t||h!==i)&&(n+=1,t=!1),i=h,u===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Xx({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(il.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){Wl(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new Ea(e,this.inversePixelTransform_,n,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(fn.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(fn.POSTRENDER,e,t)}}const Kx={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function Ah(r){return 1/(r+2)}function Jx(){return{tileIds:new Set,representationsByZ:{}}}function Ph(r,e){return r.tileIds.has(Te(e))}function Ih(r,e,t){const n=r.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),r.tileIds.add(Te(e.tile))}function Ta(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=gr(e,ed(t.extent,r.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(e=gr(e,i))}return e}function dl(r,e){return`${Te(r)},${r.getKey()},${r.getRevision()},${Un(e)}`}class Qx extends ys{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=ft(),this.tempMat4=Cn(),this.tempTileRange_=new Ng(0,0,0,0),this.tempTileCoord_=sl(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Qf(n),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Do(Ta(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return Ar()}enqueueTiles(e,t,n,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),h=l.getGutterForProjection(o.projection),c=Te(l);c in e.wantedTiles||(e.wantedTiles[c]={});const f=e.wantedTiles[c],m=this.tileRepresentationCache,p=a.getMapInternal(),y=Math.max(n-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection)),b=o.rotation,E=b?Dg(o.center,o.resolution,b,e.size):void 0;for(let v=n;v>=y;--v){const w=u.getTileRangeForExtentAndZ(t,v,this.tempTileRange_),P=u.getResolution(v);for(let T=w.minX;T<=w.maxX;++T)for(let R=w.minY;R<=w.maxY;++R){if(b&&!u.tileCoordIntersectsViewport([v,T,R],E))continue;const C=sl(v,T,R,this.tempTileCoord_),D=dl(l,C);let U,M;if(m.containsKey(D)&&(U=m.get(D),M=U.tile),(!U||U.tile.key!==l.getKey())&&(M=l.getTile(v,T,R,e.pixelRatio,o.projection),!M)||Ph(i,M))continue;U?U.setTile(M):(U=this.createTileRepresentation({tile:M,grid:u,helper:this.helper,gutter:h}),m.set(D,U)),Ih(i,U,v);const z=M.getKey();f[z]=!0,M.getState()===ue.IDLE&&(e.tileQueue.isKeyQueued(z)||e.tileQueue.enqueue([M,c,u.getTileCoordCenter(C),P]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,i,s,o,a,l,u,h,c){}renderTileMask(e,t,n,i){}drawTile_(e,t,n,i,s,o,a){if(!t.ready)return;const u=t.tile.tileCoord,h=Un(u),c=h in o?o[h]:1,f=a.getResolution(n),m=tr(a.getTileSize(n),this.tempSize_),p=a.getOrigin(n),y=a.getTileCoordExtent(u),b=c<1?-1:Ah(n);c<1&&(e.animate=!0);const E=e.viewState,v=E.center[0],w=E.center[1],P=m[0]+2*i,T=m[1]+2*i,R=P/T,C=(v-p[0])/(m[0]*f),D=(p[1]-w)/(m[1]*f),U=E.resolution/f,M=u[1],z=u[2];Ug(this.tileTransform_),Gc(this.tileTransform_,2/(e.size[0]*U/P),-2/(e.size[1]*U/P)),kg(this.tileTransform_,E.rotation),Gc(this.tileTransform_,1,1/R),Yl(this.tileTransform_,(m[0]*(M-C)-i)/P,(m[1]*(z-D)-i)/T),this.renderTile(t,this.tileTransform_,e,s,f,m,p,y,b,i,c)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=Ta(e,e.extent),u=o.getZForResolution(n.resolution,s.zDirection),h=Jx(),c=i.getPreload();if(e.nextExtent){const w=o.getZForResolution(n.nextResolution,s.zDirection),P=Ta(e,e.nextExtent);this.enqueueTiles(e,P,w,h,c)}this.enqueueTiles(e,l,u,h,0),c>0&&setTimeout(()=>{this.enqueueTiles(e,l,u-1,h,c-1)},0);const f={};let m=!1;const p=h.representationsByZ;if(u in p){const w=Te(this),P=e.time;for(const T of p[u]){const R=T.tile;if(R.getState()===ue.EMPTY)continue;const C=R.tileCoord;if(T.ready){const M=R.getAlpha(w,P);if(M===1){R.endTransition(w);continue}m=!0;const z=Un(C);f[z]=M}if(this.renderComplete=!1,this.findAltTiles_(o,C,u+1,h))continue;const U=o.getMinZoom();for(let M=u-1;M>=U&&!this.findAltTiles_(o,C,M,h);--M);}}const y=Object.keys(p).map(Number).sort(zg);if(this.beforeTilesMaskRender(e))for(let w=0,P=y.length;w<P;++w){const T=y[w];for(const R of p[T]){const C=R.tile.tileCoord;if(Un(C)in f)continue;const U=o.getTileCoordExtent(C);this.renderTileMask(R,T,U,Ah(T))}}this.beforeTilesRender(e,m);for(let w=0,P=y.length;w<P;++w){const T=y[w];for(const R of p[T]){const C=R.tile.tileCoord;Un(C)in f||this.drawTile_(e,R,T,a,l,f,o)}}if(u in p)for(const w of p[u]){const P=w.tile.tileCoord;Un(P)in f&&this.drawTile_(e,w,u,a,l,f,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const E=this.helper.getCanvas(),v=this.tileRepresentationCache;for(;v.canExpireCache();)v.pop().dispose();return this.postRender(t,e),E}beforeFinalize(e){}findAltTiles_(e,t,n,i){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let h=s.minY;h<=s.maxY;++h){const c=dl(l,[n,u,h]);let f=!1;if(a.containsKey(c)){const m=a.get(c);m.ready&&!Ph(i,m.tile)&&(Ih(i,m,n),f=!0)}f||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const ae={...Kx,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},$s={TEXTURE_COORD:"a_textureCoord"},ev=[{name:$s.TEXTURE_COORD,size:2,type:et.FLOAT}];class tv extends Qx{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new ei(gs,bu),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const n of this.paletteTextures_)n.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const n of this.paletteTextures_)n.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new Yx(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,i,s,o,a,l,u,h,c){const f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(ev);let m=0;for(;m<e.textures.length;){const R=`${ae.TILE_TEXTURE_ARRAY}[${m}]`;this.helper.bindTexture(e.textures[m],m,R),++m}for(let R=0;R<this.paletteTextures_.length;++R){const C=this.paletteTextures_[R],D=C.getTexture(f);this.helper.bindTexture(D,m,C.name),++m}const p=n.viewState,y=o[0]+2*h,b=o[1]+2*h,v=e.tile.tileCoord,w=v[1],P=v[2];this.helper.setUniformMatrixValue(ae.TILE_TRANSFORM,lo(this.tempMat4,t)),this.helper.setUniformFloatValue(ae.TRANSITION_ALPHA,c),this.helper.setUniformFloatValue(ae.DEPTH,u);let T=i;h>0&&(T=l,gr(T,i,T)),this.helper.setUniformFloatVec4(ae.RENDER_EXTENT,T),this.helper.setUniformFloatValue(ae.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(ae.ZOOM,p.zoom),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_WIDTH,y),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_HEIGHT,b),this.helper.setUniformFloatValue(ae.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_X,a[0]+w*o[0]*s-h*s),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_Y,a[1]-P*o[1]*s+h*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const i=this.getLayer(),s=Or(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=i.getExtent();if(a&&!Vn(ed(a,o.projection),s))return null;const l=i.getSources(ql([s]),o.resolution);let u,h,c;for(u=l.length-1;u>=0;--u)if(h=l[u],h.getState()==="ready"){if(c=h.getTileGridForProjection(o.projection),h.getWrapX())break;const m=c.getExtent();if(!m||Vn(m,s))break}if(u<0)return null;const f=this.tileRepresentationCache;for(let m=c.getZForResolution(o.resolution);m>=c.getMinZoom();--m){const p=c.getTileCoordForCoordAndZ(s,m),y=dl(h,p);if(!f.containsKey(y))continue;const b=f.get(y);if(b.tile.getState()===ue.EMPTY)return null;if(!b.loaded)continue;const v=c.getOrigin(m),w=tr(c.getTileSize(m)),P=c.getResolution(m),T=(s[0]-v[0])/P-p[1]*w[0],R=(v[1]-s[1])/P-p[2]*w[1];return b.getPixelData(T,R)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const n of this.paletteTextures_)n.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class rv{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function nv(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function Jr(r){const e=r.toString();return e.includes(".")?e:e+".0"}function xu(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Jr).join(", ")})`}function js(r){const e=us(r),t=e.length>3?e[3]:1;return xu([e[0]/255,e[1]/255,e[2]/255,t])}function iv(r){const e=tr(r);return xu(e)}const Sa={};let sv=0;function ti(r){return r in Sa||(Sa[r]=sv++),Sa[r]}function Pr(r){return Jr(ti(r))}function Wo(r){return"u_var_"+r}function vu(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const Ra="getBandValue",jd="u_paletteTextures",Vd="featureId",Xd="geometryType",pl=-9999999;function ov(r,e,t,n){const i=Bg(r,e,t);return Eu(i,e,n)}function Re(r){return(e,t,n)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Eu(t.args[o],n,e);return r(s,e)}}const av={[he.Get]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),"a_prop_"+n},[he.Id]:r=>(r.featureId=!0,"a_"+Vd),[he.GeometryType]:r=>(r.geometryType=!0,"a_"+Xd),[he.LineMetric]:()=>"currentLineMetric",[he.Var]:(r,e)=>{const n=e.args[0].value;return n in r.variables||(r.variables[n]={name:n,type:e.type}),Wo(n)},[he.Has]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),`(a_prop_${n} != ${Jr(pl)})`},[he.Resolution]:()=>"u_resolution",[he.Zoom]:()=>"u_zoom",[he.Time]:()=>"u_time",[he.Any]:Re(r=>`(${r.join(" || ")})`),[he.All]:Re(r=>`(${r.join(" && ")})`),[he.Not]:Re(([r])=>`(!${r})`),[he.Equal]:Re(([r,e])=>`(${r} == ${e})`),[he.NotEqual]:Re(([r,e])=>`(${r} != ${e})`),[he.GreaterThan]:Re(([r,e])=>`(${r} > ${e})`),[he.GreaterThanOrEqualTo]:Re(([r,e])=>`(${r} >= ${e})`),[he.LessThan]:Re(([r,e])=>`(${r} < ${e})`),[he.LessThanOrEqualTo]:Re(([r,e])=>`(${r} <= ${e})`),[he.Multiply]:Re(r=>`(${r.join(" * ")})`),[he.Divide]:Re(([r,e])=>`(${r} / ${e})`),[he.Add]:Re(r=>`(${r.join(" + ")})`),[he.Subtract]:Re(([r,e])=>`(${r} - ${e})`),[he.Clamp]:Re(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[he.Mod]:Re(([r,e])=>`mod(${r}, ${e})`),[he.Pow]:Re(([r,e])=>`pow(${r}, ${e})`),[he.Abs]:Re(([r])=>`abs(${r})`),[he.Floor]:Re(([r])=>`floor(${r})`),[he.Ceil]:Re(([r])=>`ceil(${r})`),[he.Round]:Re(([r])=>`floor(${r} + 0.5)`),[he.Sin]:Re(([r])=>`sin(${r})`),[he.Cos]:Re(([r])=>`cos(${r})`),[he.Atan]:Re(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[he.Sqrt]:Re(([r])=>`sqrt(${r})`),[he.Match]:Re(r=>{const e=r[0],t=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[he.Between]:Re(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[he.Interpolate]:Re(([r,e,...t])=>{let n="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=n||t[i+1],a=t[i+2],l=t[i+3];let u;r===Jr(1)?u=`(${e} - ${s}) / (${a} - ${s})`:u=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${u}, 0.0, 1.0))`}return n}),[he.Case]:Re(r=>{const e=r[r.length-1];let t=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[he.In]:Re(([r,...e],t)=>{const n=nv("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[he.Array]:Re(r=>`vec${r.length}(${r.join(", ")})`),[he.Color]:Re(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`vec4(vec3(${r[0]} / 255.0), ${r[1]})`;const e=r.slice(0,3).map(n=>`${n} / 255.0`);if(r.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=r[3];return`vec4(${e.join(", ")}, ${t})`}),[he.Band]:Re(([r,e,t],n)=>{if(!(Ra in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const u=`${ae.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${u}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Ra]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${ae.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${ae.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${Ra}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[he.Palette]:(r,e)=>{const[t,...n]=e.args,i=n.length,s=new Uint8Array(i*4);for(let u=0;u<n.length;u++){const h=n[u].value,c=us(h),f=u*4;s[f]=c[0],s[f+1]=c[1],s[f+2]=c[2],s[f+3]=c[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${jd}[${r.paletteTextures.length}]`,a=new rv(o,s);r.paletteTextures.push(a);const l=Eu(t,Se,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Eu(r,e,t){if(r instanceof Gg){const n=av[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(t,r,e)}if((r.type&Se)>0)return Jr(r.value);if((r.type&Uo)>0)return r.value.toString();if((r.type&Xi)>0)return Pr(r.value.toString());if((r.type&Pt)>0)return js(r.value);if((r.type&Tn)>0)return xu(r.value);if((r.type&An)>0)return iv(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${$g(e)})`)}function lv(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Ch=.985,Fn=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,Mn=lv();class qd{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Jr(Mn["circle-radius"])} + ${Jr(Mn["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=js(Mn["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Jr(Mn["stroke-width"]),this.strokeColorExpression_=js(Mn["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Pr("round"),this.strokeJoinExpression_=Pr("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=js(Mn["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e,t){return this.uniforms_.push({name:e,type:t}),this}addAttribute(e,t,n,i){return this.attributes_.push({name:e,type:t,varyingName:e.replace(/^a_/,"v_"),varyingType:i??t,varyingExpression:n??e}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){return this.vertexShaderFunctions_.includes(e)?this:(this.vertexShaderFunctions_.push(e),this)}addFragmentShaderFunction(e){return this.fragmentShaderFunctions_.includes(e)?this:(this.fragmentShaderFunctions_.push(e),this)}getSymbolVertexShader(){return this.hasSymbol_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;

varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Ch} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Ch}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Pr("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Pr("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Pr("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Pr("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx;
  float currentRadiusPx = distanceFromSegment(currentPoint, v_segmentStart, v_segmentEnd);
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(
    v_measureStart,
    v_measureEnd,
    lengthToPoint / max(segmentLength, 1.17549429e-38)
  );

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Fn}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}function ie(r,e,t){const n=td();return ov(e,t,n,r)}function uv(r){const e=us(r),t=e[0]*256,n=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+n,i+s]}const cv=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function wu(r){return r===Pt||r===An?2:r===Tn?4:1}function ml(r){const e=wu(r);return e>1?`vec${e}`:"float"}function Wd(r,e){for(const t in e.variables){const n=e.variables[t],i=Wo(n.name);let s=ml(n.type);n.type===Pt&&(s="vec4"),r.addUniform(i,s)}for(const t in e.properties){const n=e.properties[t],i=ml(n.type),s=`a_prop_${n.name}`;n.type===Pt?(r.addAttribute(s,i,`unpackColor(${s})`,"vec4"),r.addVertexShaderFunction(cv)):r.addAttribute(s,i)}for(const t in e.functions)r.addVertexShaderFunction(e.functions[t]),r.addFragmentShaderFunction(e.functions[t])}function Hd(r,e){const t={};for(const n in r.variables){const i=r.variables[n],s=Wo(i.name);t[s]=()=>{const o=e[i.name];if(typeof o=="number")return o;if(typeof o=="boolean")return o?1:0;if(i.type===Pt){const a=[...us(o||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??(a[3]=1),a}return typeof o=="string"?ti(o):o}}return t}function Zd(r){const e={};for(const t in r.properties){const n=r.properties[t],i=s=>{const o=s.get(n.name);return n.type===Pt?uv([...us(o||"#eee")]):typeof o=="string"?ti(o):typeof o=="boolean"?o?1:0:o};e[`prop_${n.name}`]={size:wu(n.type),callback:i}}return e}class ho{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let n=0;n<e.length;n++)this.addFeature(e[n],t)}addFeature(e,t){let n=e.getGeometry();n&&(t&&(n=n.clone(),n.applyTransform(t)),this.addGeometry_(n,e))}clearFeatureEntryInPointBatch_(e){const t=Te(e),n=this.pointBatch.entries[t];if(n)return this.pointBatch.geometriesCount-=n.flatCoordss.length,delete this.pointBatch.entries[t],n}clearFeatureEntryInLineStringBatch_(e){const t=Te(e),n=this.lineStringBatch.entries[t];if(n)return this.lineStringBatch.verticesCount-=n.verticesCount,this.lineStringBatch.geometriesCount-=n.flatCoordss.length,delete this.lineStringBatch.entries[t],n}clearFeatureEntryInPolygonBatch_(e){const t=Te(e),n=this.polygonBatch.entries[t];if(n)return this.polygonBatch.verticesCount-=n.verticesCount,this.polygonBatch.ringsCount-=n.ringsCount,this.polygonBatch.geometriesCount-=n.flatCoordss.length,delete this.polygonBatch.entries[t],n}addGeometry_(e,t){var i;const n=e.getType();switch(n){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEndss(),t,Te(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,Te(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,Te(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,Te(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,Te(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(n,s.getFlatCoordinates(),null,t,Te(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,n,i,s,o,a){let l;switch(e){case"MultiPolygon":{const u=n;for(let h=0,c=u.length;h<c;h++){let f=u[h];const m=h>0?u[h-1]:null,p=m?m[m.length-1]:0,y=f[f.length-1];f=p>0?f.map(b=>b-p):f,this.addCoordinates_("Polygon",t.slice(p,y),f,i,s,o,a)}break}case"MultiLineString":{const u=n;for(let h=0,c=u.length;h<c;h++){const f=h>0?u[h-1]:0;this.addCoordinates_("LineString",t.slice(f,u[h]),null,i,s,o,a)}break}case"MultiPoint":for(let u=0,h=t.length;u<h;u+=o)this.addCoordinates_("Point",t.slice(u,u+2),null,i,s,null,null);break;case"Polygon":{const u=n;if(i instanceof rd){const f=jg(t,u);if(f.length>1){this.addCoordinates_("MultiPolygon",t,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const h=n.length,c=n.map((f,m,p)=>m>0?(f-p[m-1])/o:f/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=h,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(hv(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(c),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=h;for(let f=0,m=u.length;f<m;f++){const p=f>0?u[f-1]:0;this.addCoordinates_("LinearRing",t.slice(p,u[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(fv(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(e,t){const n=this.uidToRef_.get(e),i=n||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,n||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e,t){if(!this.uidToRef_.get(Te(e)))return;this.removeFeature(e);let n=e.getGeometry();n&&(t&&(n=n.clone(),n.applyTransform(t)),this.addGeometry_(n,e))}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,Te(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new ho;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let n=!0;for(const i of this.refToFeature_.values())e(i)&&(t.addFeature(i),n=!1);return n?new ho:t}}function hv(r,e){return e===2?r:r.filter((t,n)=>n%e<2)}function fv(r,e,t){return e===3&&t==="XYM"?r:e===4?r.filter((n,i)=>i%e!==2):e===3?r.map((n,i)=>i%e!==2?n:0):new Array(r.length*1.5).fill(0).map((n,i)=>i%3===2?0:r[Math.round(i/1.5)])}function Yd(){const r='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let u=e(t,0,i,x,!0);const l=[];if(!u||u.next===u.prev)return l;let c,h,y;if(o&&(u=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const u=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);u===u.next&&(u.steiner=!0),o.push(a(u))}o.sort(f);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,u,x)),t.length>80*x){c=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<h&&(h=o),x>e&&(e=x),o>n&&(n=o)}y=Math.max(e-c,n-h),y=0!==y?32767/y:0}return r(u,l,x,c,h,y,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=w(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=w(x/r|0,t[x],t[x+1],o);return o&&g(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,f,s,l,a,h){if(!t)return;!h&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let y=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),A(t),t=p.next,y=p.next;else if((t=p)===y){h?1===h?r(t=i(n(t),e),e,f,s,l,a,2):2===h&&u(t,e,f,s,l,a):r(n(t),e,f,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=h&&y(x,u,o,f,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,a=o.y,h=i.y,p=Math.min(u,f,s),g=Math.min(l,a,h),b=Math.max(u,f,s),M=Math.max(l,a,h),m=c(p,g,e,n,r),Z=c(b,M,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!g(n,x)&&b(n,r,r.next,x)&&Z(n,x)&&Z(x,n)&&(e.push(n.i,r.i,x.i),A(r),A(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function u(t,e,x,o,i,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&p(f,t)){let s=d(f,t);return f=n(f,f.next),s=n(s,s.next),r(f,e,x,o,i,u,0),void r(s,e,x,o,i,u,0)}t=t.next}f=f.next}while(f!==t)}function f(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(g(t,n))return n;do{if(g(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&h(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);Z(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==u);return o}(t,e);if(!r)return e;const x=d(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function y(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&h(t,e,n,r,x,o,i,u)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Z(t,e)&&Z(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||g(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){const x=m(v(t,e,n)),o=m(v(t,e,r)),i=m(v(n,r,t)),u=m(v(n,r,e));return x!==o&&i!==u||(!(0!==x||!M(t,n,e))||(!(0!==o||!M(t,r,e))||(!(0!==i||!M(n,t,r))||!(0!==u||!M(n,e,r)))))}function M(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m(t){return t>0?1:t<0?-1:0}function Z(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function d(t,e){const n=E(t.i,t.x,t.y),r=E(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){const x=E(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function I(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function z(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const F=[],P={vertexPosition:0,indexPosition:0};function B(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function N(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=F;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return B(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,P.vertexPosition=l,P.indexPosition=c,P}function R(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=I(f,[...h]),b=I(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,I(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,I(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function S(e,n,r,x,o){const i=2+o;let u=n;const f=e.slice(u,u+o);u+=o;const s=e[u++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[u++],t<s-1&&(c[t]=l);const a=e.slice(u,u+2*l),h=t(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...f);return u+2*l}const T="GENERATE_POLYGON_BUFFERS",_="GENERATE_POINT_BUFFERS",O="GENERATE_LINE_STRING_BUFFERS",U=self;U.onmessage=t=>{const e=t.data;switch(e.type){case _:{const t=3,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x,u=4*i*(r+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=x)l=N(o,t,s,f,r,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},e);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case O:{const t=[],n=[],r=e.customAttributesSize,x=3,o=new Float32Array(e.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(z(u,e.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+r)),i+=r,f=o[i++];const e=i,l=i+(f-1)*x,c=o[e]===o[l]&&o[e+1]===o[l+1];let a=0,h=0;for(let r=0;r<f-1;r++){let y=null;r>0?y=i+(r-1)*x:c&&(y=l-x);let p=null;r<f-2?p=i+(r+2)*x:c&&(p=e+x);const v=R(o,i+r*x,i+(r+1)*x,y,p,t,n,s,u,a,h);a=v.length,h=v.angle}i+=f*x}const l=Uint32Array.from(n),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},e);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case T:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=S(x,o,t,n,r);const i=Uint32Array.from(n),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:x.buffer},e);U.postMessage(f,[u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}const Di={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function Kd(r,e){e=e||[];const t=256,n=t-1;return e[0]=Math.floor(r/t/t/t)/n,e[1]=Math.floor(r/t/t)%t/n,e[2]=Math.floor(r/t)%t/n,e[3]=r%t/n,e}function Jd(r){let e=0;const t=256,n=t-1;return e+=Math.round(r[0]*t*t*t*n),e+=Math.round(r[1]*t*t*n),e+=Math.round(r[2]*t*n),e+=Math.round(r[3]*n),e}function Tu(r,e,t,n){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);let l=(a==null?void 0:a[0])??a;l===pl&&console.warn('The "has" operator might return false positives.'),l===void 0?l=pl:l===null&&(l=0),r[n+i++]=l,!(!o.size||o.size===1)&&(r[n+i++]=a[1],!(o.size<3)&&(r[n+i++]=a[2],!(o.size<4)&&(r[n+i++]=a[3])))}return i}function Ho(r){return Object.keys(r).reduce((e,t)=>e+(r[t].size||1),0)}function dv(r,e,t,n){const i=(2+Ho(t))*r.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let u=0,h=l.flatCoordss.length;u<h;u++)s[0]=l.flatCoordss[u][0],s[1]=l.flatCoordss[u][1],Or(n,s),e[o++]=s[0],e[o++]=s[1],o+=Tu(e,t,l,o)}return e}function pv(r,e,t,n){const i=3*r.verticesCount+(1+Ho(t))*r.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let u=0,h=l.flatCoordss.length;u<h;u++){s.length=l.flatCoordss[u].length,nd(l.flatCoordss[u],0,s.length,3,n,s,3),o+=Tu(e,t,l,o),e[o++]=s.length/3;for(let c=0,f=s.length;c<f;c+=3)e[o++]=s[c],e[o++]=s[c+1],e[o++]=s[c+2]}}return e}function mv(r,e,t,n){const i=2*r.verticesCount+(1+Ho(t))*r.geometriesCount+r.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const l=r.entries[a];for(let u=0,h=l.flatCoordss.length;u<h;u++){s.length=l.flatCoordss[u].length,nd(l.flatCoordss[u],0,s.length,2,n,s),o+=Tu(e,t,l,o),e[o++]=l.ringsVerticesCounts[u].length;for(let c=0,f=l.ringsVerticesCounts[u].length;c<f;c++)e[o++]=l.ringsVerticesCounts[u][c];for(let c=0,f=s.length;c<f;c+=2)e[o++]=s[c],e[o++]=s[c+1]}}return e}function fo(r){return(JSON.stringify(r).split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0),0)>>>0).toString()}function Su(r,e,t,n){if(`${n}radius`in r&&n!=="icon-"){let i=ie(t,r[`${n}radius`],Se);if(`${n}radius2`in r){const s=ie(t,r[`${n}radius2`],Se);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${ie(t,r[`${n}stroke-width`],Se)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=ie(t,r[`${n}scale`],An);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&e.setSymbolOffsetExpression(ie(t,r[`${n}displacement`],Tn)),`${n}rotation`in r&&e.setSymbolRotationExpression(ie(t,r[`${n}rotation`],Se)),`${n}rotate-with-view`in r&&e.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function Qd(r,e,t,n,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Ru(r,e,t,n,i){const s=new Image;s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],Wt(typeof r[`${n}src`]=="string",`WebGL layers do not support expressions for the ${n}src style property`),s.src=r[`${n}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`u_texture${i}_size`,"vec2");const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`u_texture${i}`,"sampler2D"),o}function Au(r,e,t,n,i){let s=ie(t,r[`${e}offset`],An);if(`${e}offset-origin`in r)switch(r[`${e}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function gv(r,e,t,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Su(r,e,n,"circle-");let i=null;"circle-opacity"in r&&(i=ie(n,r["circle-opacity"],Se));let s="coordsPx";"circle-scale"in r&&(s=`coordsPx / ${ie(n,r["circle-scale"],An)}`);let o=null;"circle-fill-color"in r&&(o=ie(n,r["circle-fill-color"],Pt));let a=null;"circle-stroke-color"in r&&(a=ie(n,r["circle-stroke-color"],Pt));let l=ie(n,r["circle-radius"],Se),u=null;"circle-stroke-width"in r&&(u=ie(n,r["circle-stroke-width"],Se),l=`(${l} + ${u} * 0.5)`);const h=`circleDistanceField(${s}, ${l})`,c=Qd(h,o,a,u,i);e.setSymbolColorExpression(c)}function yv(r,e,t,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Su(r,e,n,"shape-");let i=null;"shape-opacity"in r&&(i=ie(n,r["shape-opacity"],Se));let s="coordsPx";"shape-scale"in r&&(s=`coordsPx / ${ie(n,r["shape-scale"],An)}`);let o=null;"shape-fill-color"in r&&(o=ie(n,r["shape-fill-color"],Pt));let a=null;"shape-stroke-color"in r&&(a=ie(n,r["shape-stroke-color"],Pt));let l=null;"shape-stroke-width"in r&&(l=ie(n,r["shape-stroke-width"],Se));const u=ie(n,r["shape-points"],Se);let h="0.";"shape-angle"in r&&(h=ie(n,r["shape-angle"],Se));let c,f=ie(n,r["shape-radius"],Se);if(l!==null&&(f=`${f} + ${l} * 0.5`),"shape-radius2"in r){let p=ie(n,r["shape-radius2"],Se);l!==null&&(p=`${p} + ${l} * 0.5`),c=`starDistanceField(${s}, ${u}, ${f}, ${p}, ${h})`}else c=`regularDistanceField(${s}, ${u}, ${f}, ${h})`;const m=Qd(c,o,a,l,i);e.setSymbolColorExpression(m)}function _v(r,e,t,n){let i="vec4(1.0)";"icon-color"in r&&(i=ie(n,r["icon-color"],Pt)),"icon-opacity"in r&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${ie(n,r["icon-opacity"],Se)})`);const s=fo(r["icon-src"]),o=Ru(r,e,t,"icon-",s);if(e.setSymbolColorExpression(`${i} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in r&&"icon-height"in r&&e.setSymbolSizeExpression(`vec2(${ie(n,r["icon-width"],Se)}, ${ie(n,r["icon-height"],Se)})`),"icon-offset"in r&&"icon-size"in r){const a=ie(n,r["icon-size"],Tn),l=e.getSymbolSizeExpression();e.setSymbolSizeExpression(a);const u=Au(r,"icon-",n,"v_quadSizePx",a);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(Su(r,e,n,"icon-"),"icon-anchor"in r){const a=ie(n,r["icon-anchor"],Tn);let l="1.0";"icon-scale"in r&&(l=ie(n,r["icon-scale"],An));let u;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?u=`${a} * ${l}`:r["icon-anchor-x-units"]==="pixels"?u=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?u=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:u=`${a} * v_quadSizePx`;let h=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":h=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":h=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":h=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${h}`)}}function bv(r,e,t,n){if("stroke-color"in r&&e.setStrokeColorExpression(ie(n,r["stroke-color"],Pt)),"stroke-pattern-src"in r){const i=fo(r["stroke-pattern-src"]),s=Ru(r,e,t,"stroke-pattern-",i);let o=s,a="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(o=ie(n,r["stroke-pattern-size"],Tn),a=Au(r,"stroke-pattern-",n,s,o));let l="0.";"stroke-pattern-spacing"in r&&(l=ie(n,r["stroke-pattern-spacing"],Se)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;const u=`u_texture${i}`;let h="1.";"stroke-color"in r&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${u}, ${s}, ${a}, ${o}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&e.setStrokeWidthExpression(ie(n,r["stroke-width"],Se)),"stroke-offset"in r&&e.setStrokeOffsetExpression(ie(n,r["stroke-offset"],Se)),"stroke-line-cap"in r&&e.setStrokeCapExpression(ie(n,r["stroke-line-cap"],Xi)),"stroke-line-join"in r&&e.setStrokeJoinExpression(ie(n,r["stroke-line-join"],Xi)),"stroke-miter-limit"in r&&e.setStrokeMiterLimitExpression(ie(n,r["stroke-miter-limit"],Se)),"stroke-line-dash"in r){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Pr("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${Pr("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=r["stroke-line-dash"].map(m=>ie(n,m,Se));i.length%2===1&&(i=[...i,...i]);let s="0.";"stroke-line-dash-offset"in r&&(s=ie(n,r["stroke-line-dash-offset"],Se));const a=`dashDistanceField_${fo(r["stroke-line-dash"])}`,l=i.map((m,p)=>`float dashLength${p}`).join(", "),u=i.map((m,p)=>`dashLength${p}`).join(" + ");let h="0.",c=`getSingleDashDistance(distance, radius, ${h}, dashLength0, totalDashLength, capType, lineWidth)`;for(let m=2;m<i.length;m+=2)h=`${h} + dashLength${m-2} + dashLength${m-1}`,c=`min(${c}, getSingleDashDistance(distance, radius, ${h}, dashLength${m}, totalDashLength, capType, lineWidth))`;n.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${u};
  return ${c};
}`;const f=i.map((m,p)=>`${m}`).join(", ");e.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width, ${f})`)}}function xv(r,e,t,n){if("fill-color"in r&&e.setFillColorExpression(ie(n,r["fill-color"],Pt)),"fill-pattern-src"in r){const i=fo(r["fill-pattern-src"]),s=Ru(r,e,t,"fill-pattern-",i);let o=s,a="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(o=ie(n,r["fill-pattern-size"],Tn),a=Au(r,"fill-pattern-",n,s,o)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${i}`;let u="1.";"fill-color"in r&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${l}, ${s}, ${a}, ${o}, pxOrigin, pxPos)`)}}function ep(r,e,t){const n=vu(),i=new qd,s={};if("icon-src"in r?_v(r,i,s,n):"shape-points"in r?yv(r,i,s,n):"circle-radius"in r&&gv(r,i,s,n),bv(r,i,s,n),xv(r,i,s,n),t){const l=ie(n,t,Uo);i.setFragmentDiscardExpression(`!${l}`)}const o={};function a(l,u,h,c){if(!n[l])return;const f=ml(h),m=wu(h);i.addAttribute(`a_${u}`,f),o[u]={size:m,callback:c}}return a("geometryType",Xd,Xi,l=>ti(id(l.getGeometry()))),a("featureId",Vd,Xi|Se,l=>{const u=l.getId()??null;return typeof u=="string"?ti(u):u}),Wd(i,n),{builder:i,attributes:{...o,...Zd(n)},uniforms:{...s,...Hd(n,e)}}}function vv(r){const e=Array.isArray(r)?r:[r];if("style"in e[0]){const t=[],n=e,i=[];for(const s of n){const o=Array.isArray(s.style)?s.style:[s.style];let a=s.filter;s.else&&i.length&&(a=["all",...i.map(u=>["!",u])],s.filter&&a.push(s.filter),a.length<3&&(a=a[1])),s.filter&&i.push(s.filter);const l=o.map(u=>({style:u,...a&&{filter:a}}));t.push(...l)}return t}return"builder"in e[0]?e:e.map(t=>({style:t}))}const Ev=[];let Aa;function wv(){return Aa||(Aa=Yd()),Aa}let Tv=0;const or={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class Sv{constructor(e,t,n,i,s){this.helper_,this.hitDetectionEnabled_=!!i;let o=e;if(!("builder"in e)){const h=e,c=ep(h.style,t,h.filter);o={builder:c.builder,attributes:c.attributes,uniforms:c.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!o.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=o.builder.getFillVertexShader(),this.fillFragmentShader_=o.builder.getFillFragmentShader()),this.hasStroke_=!!o.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=o.builder.getStrokeVertexShader(),this.strokeFragmentShader_=o.builder.getStrokeFragmentShader()),this.hasSymbol_=!!o.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=o.builder.getSymbolVertexShader(),this.symbolFragmentShader_=o.builder.getSymbolFragmentShader()),this.featureFilter_=null,s&&(this.featureFilter_=this.computeFeatureFilter(s));const l=this.hitDetectionEnabled_?{hitColor:{callback(){return Kd(this.ref,Ev)},size:4}}:{};this.customAttributes_=Object.assign({},l,o.attributes),this.uniforms_=o.uniforms;const u=Object.entries(this.customAttributes_).map(([h,c])=>({name:`a_${h}`,size:c.size||1,type:et.FLOAT}));this.polygonAttributesDesc_=[{name:or.POSITION,size:2,type:et.FLOAT},...u],this.lineStringAttributesDesc_=[{name:or.SEGMENT_START,size:2,type:et.FLOAT},{name:or.MEASURE_START,size:1,type:et.FLOAT},{name:or.SEGMENT_END,size:2,type:et.FLOAT},{name:or.MEASURE_END,size:1,type:et.FLOAT},{name:or.JOIN_ANGLES,size:2,type:et.FLOAT},{name:or.DISTANCE,size:1,type:et.FLOAT},{name:or.PARAMETERS,size:1,type:et.FLOAT},...u],this.pointAttributesDesc_=[{name:or.POSITION,size:2,type:et.FLOAT},{name:or.INDEX,size:1,type:et.FLOAT},...u],this.setHelper(n)}computeFeatureFilter(e){const t=td();let n;try{n=Vg(e,Uo,t)}catch{return null}if(t.mapState||t.variables.size>0)return null;const i=Xg();return s=>{if(i.properties=s.getPropertiesInternal(),t.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return i.geometryType=id(s.getGeometry()),n(i)}}async generateBuffers(e,t){let n=e;if(this.featureFilter_&&(n=n.filter(this.featureFilter_),n.isEmpty()))return null;const i=this.generateRenderInstructions_(n,t),[s,o,a]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",t),this.generateBuffersForType_(i.lineStringInstructions,"LineString",t),this.generateBuffersForType_(i.pointInstructions,"Point",t)]),l=qi(ft(),t);return{polygonBuffers:s,lineStringBuffers:o,pointBuffers:a,invertVerticesTransform:l}}generateRenderInstructions_(e,t){const n=this.hasFill_?mv(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?pv(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?dv(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:n,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,n){if(e===null)return null;const i=Tv++;let s;switch(t){case"Polygon":s=Di.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Di.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Di.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:n,customAttributesSize:Ho(this.customAttributes_)},a=wv();return a.postMessage(o,[e.buffer]),e=null,new Promise(l=>{const u=h=>{const c=h.data;if(c.id!==i||(a.removeEventListener("message",u),!this.helper_.getGL()))return;const f=new ei(ms,uo).fromArrayBuffer(c.vertexBuffer),m=new ei(gs,uo).fromArrayBuffer(c.indexBuffer);this.helper_.flushBufferData(f),this.helper_.flushBufferData(m),l([m,f])};a.addEventListener("message",u)})}render(e,t,n){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,n),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,n),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,n)}renderInternal_(e,t,n,i,s,o){const a=e.getSize();a!==0&&(this.helper_.useProgram(n,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i),o(),this.helper_.drawElements(0,a))}setHelper(e,t=null){this.helper_=e,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1])))}}const ar=new Uint8Array(4);class tp{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){qg(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return ar[0]=0,ar[1]=0,ar[2]=0,ar[3]=0,ar;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return ar[0]=this.data_[n*4],ar[1]=this.data_[n*4+1],ar[2]=this.data_[n*4+2],ar[3]=this.data_[n*4+3],ar}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}function rp(r,e){const t=r.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=r.extent,a=i?dt(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}const On={...hr,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class np extends ys{constructor(e,t){const n={[On.RENDER_EXTENT]:[0,0,0,0],[On.PATTERN_ORIGIN]:[0,0],[On.GLOBAL_ALPHA]:1};super(e,{uniforms:n,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=cs(),this.currentTransform_=ft(),this.tmpCoords_=[0,0],this.tmpTransform_=ft(),this.tmpMat4_=Cn(),this.currentFrameStateTransform_=ft(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new ho,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let n;this.batch_.addFeatures(t.getFeatures(),n),this.sourceListenKeys_=[Cr(t,Hr.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,n)),Cr(t,Hr.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,n),this),Cr(t,Hr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Cr(t,Hr.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=vv(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new Sv(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new tp(this.helper))}handleSourceFeatureAdded_(e,t){const n=t.feature;this.batch_.addFeature(n,e)}handleSourceFeatureChanged_(e,t){const n=t.feature;this.batch_.changeFeature(n,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){Wg(this.tmpTransform_,this.currentFrameStateTransform_),ji(this.tmpTransform_,e),this.helper.setUniformMatrixValue(On.PROJECTION_MATRIX,lo(this.tmpMat4_,this.tmpTransform_)),qi(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(On.SCREEN_TO_WORLD_MATRIX,lo(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,qi(this.tmpTransform_,e),Or(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(On.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=rp(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[tn.ANIMATING]&&!e.viewHints[tn.INTERACTING],o=!Vi(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,h=t instanceof ko?t.getRenderBuffer():0,c=Kl(e.extent,h*u);n.loadFeatures(c,u,l),this.ready=!1;const f=this.helper.makeProjectionTransform(e,ft()),m=this.styleRenderers_.map((p,y)=>p.generateBuffers(this.batch_,f).then(b=>{this.buffers_[y]&&this.disposeBuffers(this.buffers_[y]),this.buffers_[y]=b}));Promise.all(m).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,n,i,s){let o=n;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),Yl(this.currentFrameStateTransform_,o*s,0);for(let a=0,l=this.styleRenderers_.length;a<l;a++){const u=this.styleRenderers_[a],h=this.buffers_[a];h&&u.render(h,e,()=>{this.applyUniforms_(h.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++o<i)}forEachFeatureAtCoordinate(e,t,n,i,s){if(Wt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=Or(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=Jd(l),h=this.batch_.getFeatureFromRef(u);if(h)return i(h,this.getLayer(),null)}disposeBuffers(e){const t=n=>{for(const i of n)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach(e=>{e&&this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){eo(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const Rr={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},Rv=["#00f","#0ff","#0f0","#ff0","#f00"];class Av extends ko{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(Rr.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:Rv),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const n=e.weight?e.weight:"weight";this.weight_=n,this.setRenderOrder(null)}getBlur(){return this.get(Rr.BLUR)}getGradient(){return this.get(Rr.GRADIENT)}getRadius(){return this.get(Rr.RADIUS)}handleGradientChanged_(){this.gradient_=Pv(this.getGradient())}setBlur(e){const t=this.get(Rr.BLUR);if(this.set(Rr.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(Rr.GRADIENT,e)}setRadius(e){const t=this.get(Rr.RADIUS);if(this.set(Rr.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new qd,t=vu(),n=ie(t,this.filter_,Uo);let i=ie(t,this.getRadius(),Se),s=ie(t,this.getBlur(),Se);const o={};typeof this.getBlur()=="number"&&(s="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const a={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const c=typeof this.weight_=="string"?f=>f.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:f=>{const m=c(f);return m!==void 0?We(m,0,1):1}},l="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const c=["clamp",this.weight_,0,1];l=ie(t,c,Se)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${s});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${s}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${s}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${n}`),Wd(e,t);const u=Zd(t),h=Hd(t,this.styleVariables_);return new np(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...u,...a},uniforms:{...h,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function Pv(r){const n=en(1,256),i=n.createLinearGradient(0,0,1,256),s=1/(r.length-1);for(let o=0,a=r.length;o<a;++o)i.addColorStop(o*s,r[o]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}class Pu extends sd{constructor(e,t,n,i,s){const o=s!==void 0?dn.IDLE:dn.LOADED;super(e,t,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=dn.ERROR):this.state=dn.LOADED,this.changed()}load(){this.state==dn.IDLE&&(this.state=dn.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class Iv extends Hg{constructor(e){super(e),this.vectorRenderer_=new Zg(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=ft(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=Or(this.coordinateToVectorPixelTransform_,Or(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){var h;const t=e.pixelRatio,n=e.viewState,i=n.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),od(a,this.layerImageRatio_));const l=dt(a)/i,u=rr(a)/i;if(!s[tn.ANIMATING]&&!s[tn.INTERACTING]&&!Do(a)){o.useContainer(null,null);const c=o.context,f=e.layerStatesArray[e.layerIndex],m=Object.assign({},f,{opacity:1}),p=Object.assign({},e,{extent:a,size:[l,u],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[m],layerIndex:0,declutter:null}),y=this.getLayer().getDeclutter();y&&(p.declutter={[y]:new Yg(9)});const b=new Pu(a,i,t,c.canvas,function(E){o.prepareFrame(p)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(p,null),o.renderDeclutter(p),o.renderDeferred(p),E())});b.addEventListener(Tt.CHANGE,()=>{if(b.getState()!==dn.LOADED)return;this.image=b;const E=b.getPixelRatio(),v=Kg(b.getResolution())*t/E;this.renderedResolution=v,this.coordinateToVectorPixelTransform_=Wl(this.coordinateToVectorPixelTransform_,l/2,u/2,1/v,-1/v,0,-n.center[0],-n.center[1])}),b.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!((h=this.getLayer().getSource())!=null&&h.loading)&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,i,s):super.forEachFeatureAtCoordinate(e,t,n,i,s)}}class Cv extends ko{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Iv(this)}}class Lv extends ys{constructor(e,t){const n=t.uniforms||{},i=ft();n[hr.PROJECTION_MATRIX]=i,super(e,{uniforms:n,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new ei(ms,uo),this.indicesBuffer_=new ei(gs,uo),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:et.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:et.FLOAT},{name:"a_index",size:1,type:et.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:et.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:et.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=cs(),this.currentTransform_=i,this.renderTransform_=ft(),this.invertRenderTransform_=ft(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=Yd(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Di.GENERATE_POINT_BUFFERS){const u=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=u,qi(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Cr(o,Hr.ADDFEATURE,this.handleSourceFeatureAdded_,this),Cr(o,Hr.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Cr(o,Hr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Cr(o,Hr.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{const l=a.getGeometry();l&&l.getType()==="Point"&&(this.featureCache_[Te(a)]={feature:a,properties:a.getProperties(),flatCoordinates:l.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new tp(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,n=t.getGeometry();n&&n.getType()==="Point"&&(this.featureCache_[Te(t)]={feature:t,properties:t.getProperties(),flatCoordinates:n.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,n=Te(t),i=this.featureCache_[n],s=t.getGeometry();i?s&&s.getType()==="Point"?(i.properties=t.getProperties(),i.flatCoordinates=s.getFlatCoordinates()):(delete this.featureCache_[n],this.featureCount_--):s&&s.getType()==="Point"&&(this.featureCache_[n]={feature:t,properties:t.getProperties(),flatCoordinates:s.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,n=Te(t);n in this.featureCache_&&(delete this.featureCache_[n],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=rp(e,this.getLayer());return this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[tn.ANIMATING]&&!e.viewHints[tn.INTERACTING],o=!Vi(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,h=t instanceof ko?t.getRenderBuffer():0,c=Kl(e.extent,h*u);n.loadFeatures(c,u,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=ft();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=i*this.featureCount_,o=this.renderInstructions_&&this.renderInstructions_.length===s?this.renderInstructions_:new Float32Array(s);this.renderInstructions_=null;let a=[];const l=[];let u=-1;e.viewState.projection;for(const c in this.featureCache_){const f=this.featureCache_[c];if(a[0]=f.flatCoordinates[0],a[1]=f.flatCoordinates[1],Or(t,a),o[++u]=a[0],o[++u]=a[1],this.hitDetectionEnabled_){const m=Kd(u+5,l);o[++u]=m[0],o[++u]=m[1],o[++u]=m[2],o[++u]=m[3],o[++u]=Number(c)}for(let m=0;m<this.customAttributes.length;m++){const p=this.customAttributes[m].callback(f.feature,f.properties);o[++u]=p}}const h={id:++this.lastSentId,type:Di.GENERATE_POINT_BUFFERS,renderInstructions:o.buffer,customAttributesSize:i-2};h.projectionTransform=t,this.ready=!1,this.worker_.postMessage(h,[o.buffer])}forEachFeatureAtCoordinate(e,t,n,i,s){if(Wt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=Or(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=Jd(l),h=this.renderInstructions_[u],c=Math.floor(h).toString(),m=this.getLayer().getSource().getFeatureByUid(c);if(m)return i(m,this.getLayer(),null)}renderWorlds(e,t,n,i,s){let o=n;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),Yl(this.currentTransform_,o*s,0),ji(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){eo(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class Fv extends zo{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=ep(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new Lv(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function Lh(r,e){const t=`
    attribute vec2 ${$s.TEXTURE_COORD};
    uniform mat4 ${ae.TILE_TRANSFORM};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.TEXTURE_RESOLUTION};
    uniform float ${ae.TEXTURE_ORIGIN_X};
    uniform float ${ae.TEXTURE_ORIGIN_Y};
    uniform float ${ae.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${$s.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${ae.TEXTURE_ORIGIN_X} + ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${ae.TEXTURE_ORIGIN_Y} - ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${ae.TILE_TRANSFORM} * vec4(${$s.TEXTURE_COORD}, ${ae.DEPTH}, 1.0);
    }
  `,n={...vu(),bandCount:e},i=[];if(r.color!==void 0){const c=ie(n,r.color,Pt);i.push(`color = ${c};`)}if(r.contrast!==void 0){const c=ie(n,r.contrast,Se);i.push(`color.rgb = clamp((${c} + 1.0) * color.rgb - (${c} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const c=ie(n,r.exposure,Se);i.push(`color.rgb = clamp((${c} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const c=ie(n,r.saturation,Se);i.push(`
      float saturation = ${c} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const c=ie(n,r.gamma,Se);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${c}));`)}if(r.brightness!==void 0){const c=ie(n,r.brightness,Se);i.push(`color.rgb = clamp(color.rgb + ${c}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let c=0;c<o;++c){const f=n.variables[Object.keys(n.variables)[c]];if(!(f.name in r.variables))throw new Error(`Missing '${f.name}' in style variables`);const m=Wo(f.name);s[m]=function(){let p=r.variables[f.name];return typeof p=="string"&&(p=ti(p)),p!==void 0?p:-9999999}}const a=Object.keys(s).map(function(c){return`uniform float ${c};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${ae.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${jd}[${n.paletteTextures.length}];`);const u=Object.keys(n.functions).map(function(c){return n.functions[c]}),h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${ae.RENDER_EXTENT};
    uniform float ${ae.TRANSITION_ALPHA};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.RESOLUTION};
    uniform float ${ae.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${ae.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${ae.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${ae.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${ae.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${ae.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${ae.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:h,uniforms:s,paletteTextures:n.paletteTextures}}class po extends Jg{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(il.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Lh(this.style_,this.getSourceBandCount_());return new tv(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(i=n.renderFrame(e));return i}render(e,t){this.rendered=!0;const n=e.viewState,i=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const u=i[a],h=u.getState();if(h=="loading"){const c=()=>{u.getState()=="ready"&&(u.removeEventListener("change",c),this.changed())};u.addEventListener("change",c)}s=s&&h=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=Lh(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}po.prototype.dispose;class Mv extends zo{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new np(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}var Mt=Uint8Array,Xn=Uint16Array,Ov=Int32Array,ip=new Mt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sp=new Mt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Nv=new Mt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),op=function(r,e){for(var t=new Xn(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Ov(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},ap=op(ip,2),lp=ap.b,Dv=ap.r;lp[28]=258,Dv[258]=28;var Uv=op(sp,0),kv=Uv.b,gl=new Xn(32768);for(var Ve=0;Ve<32768;++Ve){var Br=(Ve&43690)>>1|(Ve&21845)<<1;Br=(Br&52428)>>2|(Br&13107)<<2,Br=(Br&61680)>>4|(Br&3855)<<4,gl[Ve]=((Br&65280)>>8|(Br&255)<<8)>>1}var Ui=function(r,e,t){for(var n=r.length,i=0,s=new Xn(e);i<n;++i)r[i]&&++s[r[i]-1];var o=new Xn(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new Xn(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],h=e-r[i],c=o[r[i]-1]++<<h,f=c|(1<<h)-1;c<=f;++c)a[gl[c]>>l]=u}else for(a=new Xn(n),i=0;i<n;++i)r[i]&&(a[i]=gl[o[r[i]-1]++]>>15-r[i]);return a},_s=new Mt(288);for(var Ve=0;Ve<144;++Ve)_s[Ve]=8;for(var Ve=144;Ve<256;++Ve)_s[Ve]=9;for(var Ve=256;Ve<280;++Ve)_s[Ve]=7;for(var Ve=280;Ve<288;++Ve)_s[Ve]=8;var up=new Mt(32);for(var Ve=0;Ve<32;++Ve)up[Ve]=5;var zv=Ui(_s,9,1),Bv=Ui(up,5,1),Pa=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},Zt=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Ia=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Gv=function(r){return(r+7)/8|0},$v=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Mt(r.subarray(e,t))},jv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lt=function(r,e,t){var n=new Error(e||jv[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Lt),!t)throw n;return n},Iu=function(r,e,t,n){var i=r.length,s=0;if(!i||e.f&&!e.l)return t||new Mt(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new Mt(i*3));var u=function(Be){var De=t.length;if(Be>De){var Ge=new Mt(Math.max(De*2,Be));Ge.set(t),t=Ge}},h=e.f||0,c=e.p||0,f=e.b||0,m=e.l,p=e.d,y=e.m,b=e.n,E=i*8;do{if(!m){h=Zt(r,c,1);var v=Zt(r,c+1,3);if(c+=3,v)if(v==1)m=zv,p=Bv,y=9,b=5;else if(v==2){var R=Zt(r,c,31)+257,C=Zt(r,c+10,15)+4,D=R+Zt(r,c+5,31)+1;c+=14;for(var U=new Mt(D),M=new Mt(19),z=0;z<C;++z)M[Nv[z]]=Zt(r,c+z*3,7);c+=C*3;for(var q=Pa(M),d=(1<<q)-1,g=Ui(M,q,1),z=0;z<D;){var _=g[Zt(r,c,d)];c+=_&15;var w=_>>4;if(w<16)U[z++]=w;else{var x=0,S=0;for(w==16?(S=3+Zt(r,c,3),c+=2,x=U[z-1]):w==17?(S=3+Zt(r,c,7),c+=3):w==18&&(S=11+Zt(r,c,127),c+=7);S--;)U[z++]=x}}var k=U.subarray(0,R),O=U.subarray(R);y=Pa(k),b=Pa(O),m=Ui(k,y,1),p=Ui(O,b,1)}else Lt(1);else{var w=Gv(c)+4,P=r[w-4]|r[w-3]<<8,T=w+P;if(T>i){l&&Lt(0);break}a&&u(f+P),t.set(r.subarray(w,T),f),e.b=f+=P,e.p=c=T*8,e.f=h;continue}if(c>E){l&&Lt(0);break}}a&&u(f+131072);for(var N=(1<<y)-1,G=(1<<b)-1,Y=c;;Y=c){var x=m[Ia(r,c)&N],Z=x>>4;if(c+=x&15,c>E){l&&Lt(0);break}if(x||Lt(2),Z<256)t[f++]=Z;else if(Z==256){Y=c,m=null;break}else{var B=Z-254;if(Z>264){var z=Z-257,re=ip[z];B=Zt(r,c,(1<<re)-1)+lp[z],c+=re}var se=p[Ia(r,c)&G],oe=se>>4;se||Lt(3),c+=se&15;var O=kv[oe];if(oe>3){var re=sp[oe];O+=Ia(r,c)&(1<<re)-1,c+=re}if(c>E){l&&Lt(0);break}a&&u(f+131072);var Fe=f+B;if(f<O){var pe=s-O,Ne=Math.min(O,Fe);for(pe+f<0&&Lt(3);f<Ne;++f)t[f]=n[pe+f]}for(;f<Fe;++f)t[f]=t[f-O]}}e.l=m,e.p=Y,e.b=f,e.f=h,m&&(h=1,e.m=y,e.d=p,e.n=b)}while(!h);return f!=t.length&&o?$v(t,0,f):t.subarray(0,f)},Vv=new Mt(0),Xv=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Lt(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},qv=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Wv=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Lt(6,"invalid zlib data"),(r[1]>>5&1)==1&&Lt(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Hv(r,e){return Iu(r,{i:2},e,e)}function Zv(r,e){var t=Xv(r);return t+8>r.length&&Lt(6,"invalid gzip data"),Iu(r.subarray(t,-8),{i:2},new Mt(qv(r)),e)}function Yv(r,e){return Iu(r.subarray(Wv(r),-4),{i:2},e,e)}function Kv(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Zv(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Hv(r,e):Yv(r,e)}var Jv=typeof TextDecoder<"u"&&new TextDecoder,Qv=0;try{Jv.decode(Vv,{stream:!0}),Qv=1}catch{}var eE=Object.defineProperty,ki=Math.pow,ze=(r,e)=>eE(r,"name",{value:e,configurable:!0}),at=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())});ze((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:ze((s,o)=>{let a=document.createElement("img"),l=new AbortController,u=l.signal;return a.cancel=()=>{l.abort()},t||(r.getHeader().then(h=>{h.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):h.tileType===2?n="image/png":h.tileType===3?n="image/jpeg":h.tileType===4?n="image/webp":h.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(s.z,s.x,s.y,u).then(h=>{if(h){let c=new Blob([h.data],{type:n}),f=window.URL.createObjectURL(c);a.src=f,a.cancel=void 0,o(void 0,a)}}).catch(h=>{if(h.name!=="AbortError")throw h}),a},"createTile"),_removeTile:ze(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var tE=ze(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:ze(()=>n.abort(),"cancel")}},"v3compat"),rE=class{constructor(e){this.tilev4=ze((t,n)=>at(this,null,function*(){if(t.type==="json"){let m=t.url.substr(10),p=this.tiles.get(m);if(p||(p=new Zi(m),this.tiles.set(m,p)),this.metadata)return{data:yield p.getTileJson(t.url)};let y=yield p.getHeader();return(y.minLon>=y.maxLon||y.minLat>=y.maxLat)&&console.error(`Bounds of PMTiles archive ${y.minLon},${y.minLat},${y.maxLon},${y.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:y.minZoom,maxzoom:y.maxZoom,bounds:[y.minLon,y.minLat,y.maxLon,y.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new Zi(o),this.tiles.set(o,a));let l=s[2],u=s[3],h=s[4],c=yield a.getHeader(),f=yield a==null?void 0:a.getZxy(+l,+u,+h,n.signal);if(f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(c.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=tE(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};ze(rE,"Protocol");function cp(r,e){return(e>>>0)*4294967296+(r>>>0)}ze(cp,"toNum");function hp(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return cp(r,i);throw new Error("Expected varint not more than 10 bytes")}ze(hp,"readVarintRemainder");function zn(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,hp(n,r))}ze(zn,"readVarint");function Cu(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}ze(Cu,"rotate");function fp(r,e){let t=ki(2,r),n=e,i=e,s=e,o=[0,0],a=1;for(;a<t;)n=1&s/2,i=1&(s^n),Cu(a,o,n,i),o[0]+=a*n,o[1]+=a*i,s=s/4,a*=2;return[r,o[0],o[1]]}ze(fp,"idOnLevel");var nE=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function dp(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>ki(2,r)-1||t>ki(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=nE[r],i=ki(2,r),s=0,o=0,a=0,l=[e,t],u=i/2;for(;u>0;)s=(l[0]&u)>0?1:0,o=(l[1]&u)>0?1:0,a+=u*u*(3*s^o),Cu(u,l,s,o),u=u/2;return n+a}ze(dp,"zxyToTileId");function iE(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return fp(t,r-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}ze(iE,"tileIdToZxy");var sE=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(sE||{});function Zo(r,e){return at(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Kv(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}ze(Zo,"defaultDecompress");var Bn=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Bn||{});function pp(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}ze(pp,"tileTypeExt");var oE=127;function mp(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,s=e-r[i].tileId;if(s>0)t=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}ze(mp,"findTile");var aE=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return at(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};ze(aE,"FileSource");var gp=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return at(this,null,function*(){let s,o;n?o=n:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&u.status===416){let f=u.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let m=+f.substr(8);u=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${m-1}`}})}let h=u.headers.get("Etag");if(h!=null&&h.startsWith("W/")&&(h=null),u.status===416||i&&h&&h!==i)throw this.mustReload=!0,new yl(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let c=u.headers.get("Content-Length");if(u.status===200&&(!c||+c>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:h||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};ze(gp,"FetchSource");var lE=gp;function $t(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*ki(2,32)+n}ze($t,"getUint64");function yp(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:$t(t,8),rootDirectoryLength:$t(t,16),jsonMetadataOffset:$t(t,24),jsonMetadataLength:$t(t,32),leafDirectoryOffset:$t(t,40),leafDirectoryLength:$t(t,48),tileDataOffset:$t(t,56),tileDataLength:$t(t,64),numAddressedTiles:$t(t,72),numTileEntries:$t(t,80),numTileContents:$t(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}ze(yp,"bytesToHeader");function Lu(r){let e={buf:new Uint8Array(r),pos:0},t=zn(e),n=[],i=0;for(let s=0;s<t;s++){let o=zn(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)n[s].runLength=zn(e);for(let s=0;s<t;s++)n[s].length=zn(e);for(let s=0;s<t;s++){let o=zn(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}ze(Lu,"deserializeIndex");var _p=class extends Error{};ze(_p,"EtagMismatch");var yl=_p;function Fu(r,e){return at(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,oE),i=yp(n,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=Lu(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}ze(Fu,"getHeaderAndRoot");function Mu(r,e,t,n,i){return at(this,null,function*(){let s=yield r.getBytes(t,n,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=Lu(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}ze(Mu,"getDirectory");var uE=class{constructor(e=100,t=!0,n=Zo){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return at(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield Fu(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return at(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield Mu(e,this.decompress,t,n,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return at(this,null,function*(){this.cache.delete(e.getKey())})}};ze(uE,"ResolvedValueCache");var bp=class{constructor(e=100,t=!0,n=Zo){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return at(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((s,o)=>{Fu(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return at(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,u)=>{Mu(e,this.decompress,t,n,i).then(h=>{l(h),this.prune()}).catch(h=>{u(h)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return at(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,n)})}};ze(bp,"SharedPromiseCache");var cE=bp,xp=class{constructor(e,t,n){typeof e=="string"?this.source=new lE(e):this.source=e,n?this.decompress=n:this.decompress=Zo,t?this.cache=t:this.cache=new cE}getHeader(){return at(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return at(this,null,function*(){let s=dp(e,t,n),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let u=0;u<=3;u++){let h=yield this.cache.getDirectory(this.source,a,l,o),c=mp(h,s);if(c){if(c.runLength>0){let f=yield this.source.getBytes(o.tileDataOffset+c.offset,c.length,i,o.etag);return{data:yield this.decompress(f.data,o.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}a=o.leafDirectoryOffset+c.offset,l=c.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return at(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(s){if(s instanceof yl)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw s}})}getMetadataAttempt(){return at(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return at(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof yl)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return at(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=pp(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};ze(xp,"PMTiles");var Zi=xp;class hE extends ad{constructor(e){super(Tt.ERROR),this.error=e}}function pt(r){return(e,...t)=>fE(r,e,t)}function gi(r,e){return pt(vp(r,e).get)}const{apply:fE,getOwnPropertyDescriptor:vp,getPrototypeOf:Ou,ownKeys:dE}=Reflect,{iterator:bs,toStringTag:pE}=Symbol,mE=Object,{create:Nu,defineProperty:gE}=mE,yE=Array,_E=yE.prototype,Ep=_E[bs],bE=pt(Ep),wp=ArrayBuffer,xE=wp.prototype;gi(xE,"byteLength");const Fh=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Fh&&gi(Fh.prototype,"byteLength");const Tp=Ou(Uint8Array);Tp.from;const St=Tp.prototype;St[bs];pt(St.keys);pt(St.values);pt(St.entries);pt(St.set);pt(St.reverse);pt(St.fill);pt(St.copyWithin);pt(St.sort);pt(St.slice);pt(St.subarray);gi(St,"buffer");gi(St,"byteOffset");gi(St,"length");gi(St,pE);const vE=Uint8Array,Sp=Uint16Array,Du=Uint32Array,EE=Float32Array,Yi=Ou([][bs]()),Rp=pt(Yi.next),wE=pt(function*(){}().next),TE=Ou(Yi),SE=DataView.prototype,RE=pt(SE.getUint16),Uu=WeakMap,Ap=Uu.prototype,Pp=pt(Ap.get),AE=pt(Ap.set),Ip=new Uu,PE=Nu(null,{next:{value:function(){const e=Pp(Ip,this);return Rp(e)}},[bs]:{value:function(){return this}}});function IE(r){if(r[bs]===Ep&&Yi.next===Rp)return r;const e=Nu(PE);return AE(Ip,e,bE(r)),e}const CE=new Uu,LE=Nu(TE,{next:{value:function(){const e=Pp(CE,this);return wE(e)},writable:!0,configurable:!0}});for(const r of dE(Yi))r!=="next"&&gE(LE,r,vp(Yi,r));const Cp=new wp(4),FE=new EE(Cp),ME=new Du(Cp),lr=new Sp(512),ur=new vE(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(lr[r]=0,lr[r|256]=32768,ur[r]=24,ur[r|256]=24):e<-14?(lr[r]=1024>>-e-14,lr[r|256]=1024>>-e-14|32768,ur[r]=-e-1,ur[r|256]=-e-1):e<=15?(lr[r]=e+15<<10,lr[r|256]=e+15<<10|32768,ur[r]=13,ur[r|256]=13):e<128?(lr[r]=31744,lr[r|256]=64512,ur[r]=24,ur[r|256]=24):(lr[r]=31744,lr[r|256]=64512,ur[r]=13,ur[r|256]=13)}const ku=new Du(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,ku[r]=e|t}for(let r=1024;r<2048;++r)ku[r]=939524096+(r-1024<<13);const yi=new Du(64);for(let r=1;r<31;++r)yi[r]=r<<23;yi[31]=1199570944;yi[32]=2147483648;for(let r=33;r<63;++r)yi[r]=2147483648+(r-32<<23);yi[63]=3347054592;const Lp=new Sp(64);for(let r=1;r<64;++r)r!==32&&(Lp[r]=1024);function OE(r){const e=r>>10;return ME[0]=ku[Lp[e]+(r&1023)]+yi[e],FE[0]}function Fp(r,e,...t){return OE(RE(r,e,...IE(t)))}var zu={exports:{}};function Mp(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],u=e+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",u);const c=new RegExp(u).exec(s);if(n&&console.log("[xml-utils] match:",c),c)return c[1]}}zu.exports=Mp;zu.exports.default=Mp;var NE=zu.exports;const Ca=Go(NE);var Bu={exports:{}},Gu={exports:{}},$u={exports:{}};function Op(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}$u.exports=Op;$u.exports.default=Op;var DE=$u.exports,ju={exports:{}};function Np(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}ju.exports=Np;ju.exports.default=Np;var UE=ju.exports,Vu={exports:{}};function Dp(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}Vu.exports=Dp;Vu.exports.default=Dp;var kE=Vu.exports;const zE=DE,La=UE,Mh=kE;function Up(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=zE(r,`<${e}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let l=La(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",u),u===!1)if(i){let m=0,p=1,y=0;for(;(l=La(a,"[ /]"+e+">",m))!==-1;){const b=a.substring(m,l+1);if(p+=Mh(b,"<"+e+`[ 
	>]`),y+=Mh(b,"</"+e+">"),y>=p)break;m=l}}else l=La(a,"[ /]"+e+">",0);const h=o+e.length+l+1;if(n&&console.log("[xml-utils] end:",h),h===-1)return;const c=r.slice(o,h);let f;return u?f=null:f=c.slice(c.indexOf(">")+1,c.lastIndexOf("<")),{inner:f,outer:c,start:o,end:h}}Gu.exports=Up;Gu.exports.default=Up;var BE=Gu.exports;const GE=BE;function kp(r,e,t){const n=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=GE(r,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}Bu.exports=kp;Bu.exports.default=kp;var $E=Bu.exports;const jE=Go($E),zi={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},cr={};for(const r in zi)zi.hasOwnProperty(r)&&(cr[zi[r]]=parseInt(r,10));const VE=[cr.BitsPerSample,cr.ExtraSamples,cr.SampleFormat,cr.StripByteCounts,cr.StripOffsets,cr.StripRowCounts,cr.TileByteCounts,cr.TileOffsets,cr.SubIFDs],Fa={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},de={};for(const r in Fa)Fa.hasOwnProperty(r)&&(de[Fa[r]]=parseInt(r,10));const Rt={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},XE={Unspecified:0},hP={AddCompression:1},fP={None:0,Deflate:1,Zstandard:2},qE={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function WE(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function HE(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function ZE(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const u=r[a];i[l]=e[u]/65536*256,i[l+1]=e[u+s]/65536*256,i[l+2]=e[u+o]/65536*256}return i}function YE(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],u=r[i+3];n[s]=255*((255-o)/256)*((255-u)/256),n[s+1]=255*((255-a)/256)*((255-u)/256),n[s+2]=255*((255-l)/256)*((255-u)/256)}return n}function KE(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const JE=.95047,QE=1,ew=1.08883;function tw(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let u=(o+16)/116,h=a/500+u,c=u-l/200,f,m,p;h=JE*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=QE*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=ew*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),f=h*3.2406+u*-1.5372+c*-.4986,m=h*-.9689+u*1.8758+c*.0415,p=h*.0557+u*-.204+c*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,n[s]=Math.max(0,Math.min(1,f))*255,n[s+1]=Math.max(0,Math.min(1,m))*255,n[s+2]=Math.max(0,Math.min(1,p))*255}return n}const zp=new Map;function on(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>zp.set(t,e))}async function Bp(r){const e=zp.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}on([void 0,1],()=>sn(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(r=>r.default));on(5,()=>sn(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(r=>r.default));on(6,()=>{throw new Error("old style JPEG compression is not supported.")});on(7,()=>sn(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(r=>r.default));on([8,32946],()=>sn(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));on(32773,()=>sn(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(r=>r.default));on(34887,()=>sn(()=>import("./lerc.DmN1KyAH.js"),__vite__mapDeps([7,5,8,1,9,10])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));on(50001,()=>sn(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([11,1])).then(r=>r.default));function Yo(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function rw(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=Yo(a,n,i);for(let u=0;u<i;++u){const h=Math.min(Math.round(o*u),t-1);for(let c=0;c<n;++c){const f=Math.min(Math.round(s*c),e-1),m=a[h*e+f];l[u*n+c]=m}}return l})}function Hn(r,e,t){return(1-t)*r+t*e}function nw(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=Yo(a,n,i);for(let u=0;u<i;++u){const h=o*u,c=Math.floor(h),f=Math.min(Math.ceil(h),t-1);for(let m=0;m<n;++m){const p=s*m,y=p%1,b=Math.floor(p),E=Math.min(Math.ceil(p),e-1),v=a[c*e+b],w=a[c*e+E],P=a[f*e+b],T=a[f*e+E],R=Hn(Hn(v,w,y),Hn(P,T,y),h%1);l[u*n+m]=R}}return l})}function iw(r,e,t,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return rw(r,e,t,n,i);case"bilinear":case"linear":return nw(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function sw(r,e,t,n,i,s){const o=e/n,a=t/i,l=Yo(r,n,i,s);for(let u=0;u<i;++u){const h=Math.min(Math.round(a*u),t-1);for(let c=0;c<n;++c){const f=Math.min(Math.round(o*c),e-1);for(let m=0;m<s;++m){const p=r[h*e*s+f*s+m];l[u*n*s+c*s+m]=p}}}return l}function ow(r,e,t,n,i,s){const o=e/n,a=t/i,l=Yo(r,n,i,s);for(let u=0;u<i;++u){const h=a*u,c=Math.floor(h),f=Math.min(Math.ceil(h),t-1);for(let m=0;m<n;++m){const p=o*m,y=p%1,b=Math.floor(p),E=Math.min(Math.ceil(p),e-1);for(let v=0;v<s;++v){const w=r[c*e*s+b*s+v],P=r[c*e*s+E*s+v],T=r[f*e*s+b*s+v],R=r[f*e*s+E*s+v],C=Hn(Hn(w,P,y),Hn(T,R,y),h%1);l[u*n*s+m*s+v]=C}}}return l}function aw(r,e,t,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return sw(r,e,t,n,i,s);case"bilinear":case"linear":return ow(r,e,t,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function lw(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function _l(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function uw(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function cw(r,e,t,n,i,s,o){const a=new DataView(r),l=t===2?o*s:o*s*n,u=t===2?1:n,h=_l(e,i,l),c=parseInt("1".repeat(i),2);if(e===1){let f;t===1?f=n*i:f=i;let m=s*f;m&7&&(m=m+7&-8);for(let p=0;p<o;++p){const y=p*m;for(let b=0;b<s;++b){const E=y+b*u*i;for(let v=0;v<u;++v){const w=E+v*i,P=(p*s+b)*u+v,T=Math.floor(w/8),R=w%8;if(R+i<=8)h[P]=a.getUint8(T)>>8-i-R&c;else if(R+i<=16)h[P]=a.getUint16(T)>>16-i-R&c;else if(R+i<=24){const C=a.getUint16(T)<<8|a.getUint8(T+2);h[P]=C>>24-i-R&c}else h[P]=a.getUint32(T)>>32-i-R&c}}}}return h.buffer}class Gp{constructor(e,t,n,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return Fp(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return _l(n,i,t)}async getTileOrStrip(e,t,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=n*o*a+t*o+e);let h,c;this.isTiled?(h=this.fileDirectory.TileOffsets[l],c=this.fileDirectory.TileByteCounts[l]):(h=this.fileDirectory.StripOffsets[l],c=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:h,length:c}],s))[0];let m;return u===null||!u[l]?(m=(async()=>{let p=await i.decode(this.fileDirectory,f);const y=this.getSampleFormat(),b=this.getBitsPerSample();return uw(y,b)&&(p=cw(p,y,this.planarConfiguration,this.getSamplesPerPixel(),b,this.getTileWidth(),this.getBlockHeight(t))),p})(),u!==null&&(u[l]=m)):m=u[l],{x:e,y:t,sample:n,data:await m}}async _readRaster(e,t,n,i,s,o,a,l,u){const h=this.getTileWidth(),c=this.getTileHeight(),f=this.getWidth(),m=this.getHeight(),p=Math.max(Math.floor(e[0]/h),0),y=Math.min(Math.ceil(e[2]/h),Math.ceil(f/h)),b=Math.max(Math.floor(e[1]/c),0),E=Math.min(Math.ceil(e[3]/c),Math.ceil(m/c)),v=e[2]-e[0];let w=this.getBytesPerPixel();const P=[],T=[];for(let D=0;D<t.length;++D)this.planarConfiguration===1?P.push(lw(this.fileDirectory.BitsPerSample,0,t[D])/8):P.push(0),T.push(this.getReaderForSample(t[D]));const R=[],{littleEndian:C}=this;for(let D=b;D<E;++D)for(let U=p;U<y;++U){let M;this.planarConfiguration===1&&(M=this.getTileOrStrip(U,D,0,s,u));for(let z=0;z<t.length;++z){const q=z,d=t[z];this.planarConfiguration===2&&(w=this.getSampleByteSize(d),M=this.getTileOrStrip(U,D,d,s,u));const g=M.then(_=>{const x=_.data,S=new DataView(x),k=this.getBlockHeight(_.y),O=_.y*c,N=_.x*h,G=O+k,Y=(_.x+1)*h,Z=T[q],B=Math.min(k,k-(G-e[3]),m-O),re=Math.min(h,h-(Y-e[2]),f-N);for(let se=Math.max(0,e[1]-O);se<B;++se)for(let oe=Math.max(0,e[0]-N);oe<re;++oe){const Fe=(se*h+oe)*w,pe=Z.call(S,Fe+P[q],C);let Ne;i?(Ne=(se+O-e[1])*v*t.length+(oe+N-e[0])*t.length+q,n[Ne]=pe):(Ne=(se+O-e[1])*v+oe+N-e[0],n[q][Ne]=pe)}});R.push(g)}}if(await Promise.all(R),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let D;return i?D=aw(n,e[2]-e[0],e[3]-e[1],o,a,t.length,l):D=iw(n,e[2]-e[0],e[3]-e[1],o,a,l),D.width=o,D.height=a,D}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=h[2]-h[0],f=h[3]-h[1],m=c*f,p=this.getSamplesPerPixel();if(!t||!t.length)for(let v=0;v<p;++v)t.push(v);else for(let v=0;v<t.length;++v)if(t[v]>=p)return Promise.reject(new RangeError(`Invalid sample index '${t[v]}'.`));let y;if(n){const v=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);y=_l(v,w,m*t.length),l&&y.fill(l)}else{y=[];for(let v=0;v<t.length;++v){const w=this.getArrayForSample(t[v],m);Array.isArray(l)&&v<l.length?w.fill(l[v]):l&&!Array.isArray(l)&&w.fill(l),y.push(w)}}const b=i||await Bp(this.fileDirectory);return await this._readRaster(h,t,y,n,b,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===Rt.RGB){let E=[0,1,2];if(this.fileDirectory.ExtraSamples!==XE.Unspecified&&a){E=[];for(let v=0;v<this.fileDirectory.BitsPerSample.length;v+=1)E.push(v)}return this.readRasters({window:e,interleave:t,samples:E,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let c;switch(h){case Rt.WhiteIsZero:case Rt.BlackIsZero:case Rt.Palette:c=[0];break;case Rt.CMYK:c=[0,1,2,3];break;case Rt.YCbCr:case Rt.CIELab:c=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:u,interleave:!0,samples:c,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:m}=this,p=await this.readRasters(f),y=2**this.fileDirectory.BitsPerSample[0];let b;switch(h){case Rt.WhiteIsZero:b=WE(p,y);break;case Rt.BlackIsZero:b=HE(p,y);break;case Rt.Palette:b=ZE(p,m.ColorMap);break;case Rt.CMYK:b=YE(p);break;case Rt.YCbCr:b=KE(p);break;case Rt.CIELab:b=tw(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const E=new Uint8Array(b.length/3),v=new Uint8Array(b.length/3),w=new Uint8Array(b.length/3);for(let P=0,T=0;P<b.length;P+=3,++T)E[T]=b[P],v[T]=b[P+1],w[T]=b[P+2];b=[E,v,w]}return b.width=p.width,b.height=p.height,b}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=jE(n,"Item");e===null?i=i.filter(s=>Ca(s,"sample")===void 0):i=i.filter(s=>Number(Ca(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[Ca(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,u,h,c]=this.fileDirectory.ModelTransformation,m=[[0,0],[0,t],[n,0],[n,t]].map(([b,E])=>[a+i*b+s*E,c+l*b+u*E]),p=m.map(b=>b[0]),y=m.map(b=>b[1]);return[Math.min(...p),Math.min(...y),Math.max(...p),Math.max(...y)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*n,u=a+s[1]*t;return[Math.min(o,l),Math.min(a,u),Math.max(o,l),Math.max(a,u)]}}}class hw{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Fp(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class fw{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const dw=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class pw{constructor(e=dw,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{sn(()=>import("./decoder.tqM1uIvc.js"),[]).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Bp(e).then(n=>n.decode(e,t)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Oh=`\r
\r
`;function $p(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,n]of r)e[t.toLowerCase()]=n;return e}function mw(r){const e=r.split(`\r
`).map(t=>{const n=t.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return $p(e)}function gw(r){const[e,...t]=r.split(";").map(i=>i.trim()),n=t.map(i=>i.split("="));return{type:e,params:$p(n)}}function bl(r){let e,t,n;return r&&([,e,t,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function yw(r,e){let t=null;const n=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=n.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(Oh),h=mw(l.substr(0,u)),{start:c,end:f,total:m}=bl(h["content-range"]),p=t+s.length+u+Oh.length,y=parseInt(f,10)+1-parseInt(c,10);i.push({headers:h,data:r.slice(p,p+y),offset:c,length:y,fileSize:m}),t=p+y+4}return i}class Xu{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class _w extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function bw(r){return new Promise(e=>setTimeout(e,r))}function xw(r,e){const t=Array.isArray(r)?r:Array.from(r),n=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,n[s]])}class ri extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ri),this.name="AbortError"}}class vw extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Ew=vw;class ww{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class Nh{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class Tw extends Xu{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new _w({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:m}of e){let p=f+m;const{fileSize:y}=this;y!==null&&(p=Math.min(p,y));const b=Math.floor(f/this.blockSize)*this.blockSize;for(let E=b;E<p;E+=this.blockSize){const v=Math.floor(E/this.blockSize);!this.blockCache.has(v)&&!this.blockRequests.has(v)&&(this.blockIdsToFetch.add(v),i.push(v)),this.blockRequests.has(v)&&n.push(this.blockRequests.get(v)),s.push(v)}}await bw(),this.fetchBlocks(t);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const f of l){const m=this.blockRequests.get(f);if(!m)throw new Error(`Block ${f} is not in the block requests`);a.push(m)}await Promise.allSettled(a)}if(t&&t.aborted)throw new ri("Request was aborted");const u=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),h=u.filter(f=>!f);if(h.length)throw new Ew(h,"Request failed");const c=new Map(xw(s,u));return this.readSliceData(e,c)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,u=l-a.offset,h=Math.min(u+this.blockSize,a.data.byteLength),c=a.data.slice(u,h),f=new ww(l,c.byteLength,c,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(n.push(o),i=o):(s.push(new Nh(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new Nh(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(e,t){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const h=t.get(u),c=h.offset-n.offset,f=h.top-i;let m=0,p=0,y;c<0?m=-c:c>0&&(p=c),f<0?y=h.length-m:y=i-h.offset-m;const b=new Uint8Array(h.data,m,y);l.set(b,p)}return a})}}class qu{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Wu{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class Sw extends qu{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Rw extends Wu{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new Sw(n)}}class Aw extends qu{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Pw extends Wu{constructRequest(e,t){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new Aw(s,o))},s.onerror=i,s.onabort=()=>i(new ri("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Ma={};class Iw extends qu{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Cw extends Wu{constructor(e){super(e),this.parsedUrl=Ma.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Ma)}constructRequest(e,t){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",h=>{u.push(h)}),o.on("end",()=>{const h=Buffer.concat(u).buffer;l(h)}),o.on("error",i)});n(new Iw(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new ri("Request aborted")),t.addEventListener("abort",()=>s.destroy(new ri("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Hu extends Xu{constructor(e,t,n,i){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:i,params:s}=gw(n.getHeader("content-type"));if(i==="multipart/byteranges"){const c=yw(await n.getData(),s.boundary);return this._fileSize=c[0].fileSize||null,c}const o=await n.getData(),{start:a,end:l,total:u}=bl(n.getHeader("content-range"));this._fileSize=u||null;const h=[{data:o,offset:a,length:l-a}];if(e.length>1){const c=await Promise.all(e.slice(1).map(f=>this.fetchSlice(f,t)));return h.concat(c)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=bl(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Zu(r,{blockSize:e,cacheSize:t}){return e===null?r:new Tw(r,{blockSize:e,cacheSize:t})}function Lw(r,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new Rw(r,t),a=new Hu(o,e,n,i);return Zu(a,s)}function Fw(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new Pw(r),o=new Hu(s,e,t,n);return Zu(o,i)}function Mw(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new Cw(r),o=new Hu(s,e,t,n);return Zu(o,i)}function xl(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?Lw(r,t):typeof XMLHttpRequest<"u"?Fw(r,t):Mw(r,t)}class Ow extends Xu{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function Nw(r){return new Ow(r)}function vl(r){switch(r){case de.BYTE:case de.ASCII:case de.SBYTE:case de.UNDEFINED:return 1;case de.SHORT:case de.SSHORT:return 2;case de.LONG:case de.SLONG:case de.FLOAT:case de.IFD:return 4;case de.RATIONAL:case de.SRATIONAL:case de.DOUBLE:case de.LONG8:case de.SLONG8:case de.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function Dw(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=qE[e[n]],s=e[n+1]?zi[e[n+1]]:null,o=e[n+2],a=e[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Nn(r,e,t,n){let i=null,s=null;const o=vl(e);switch(e){case de.BYTE:case de.ASCII:case de.UNDEFINED:i=new Uint8Array(t),s=r.readUint8;break;case de.SBYTE:i=new Int8Array(t),s=r.readInt8;break;case de.SHORT:i=new Uint16Array(t),s=r.readUint16;break;case de.SSHORT:i=new Int16Array(t),s=r.readInt16;break;case de.LONG:case de.IFD:i=new Uint32Array(t),s=r.readUint32;break;case de.SLONG:i=new Int32Array(t),s=r.readInt32;break;case de.LONG8:case de.IFD8:i=new Array(t),s=r.readUint64;break;case de.SLONG8:i=new Array(t),s=r.readInt64;break;case de.RATIONAL:i=new Uint32Array(t*2),s=r.readUint32;break;case de.SRATIONAL:i=new Int32Array(t*2),s=r.readInt32;break;case de.FLOAT:i=new Float32Array(t),s=r.readFloat32;break;case de.DOUBLE:i=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===de.RATIONAL||e===de.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(r,n+a*o);return e===de.ASCII?new TextDecoder("utf-8").decode(i):i}class Uw{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class Ms extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class jp{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const h=await this.getImageCount(),c=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[p,y]=l.getOrigin(),[b,E]=l.getResolution();a=[p+t[0]*b,y+t[1]*E,p+t[2]*b,y+t[3]*E]}const m=a||c;if(n){if(s)throw new Error("Both width and resX passed");s=(m[2]-m[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(m[3]-m[1])/i}}if(s||o){const m=[];for(let p=0;p<h;++p){const y=await this.getImage(p),{SubfileType:b,NewSubfileType:E}=y.fileDirectory;(p===0||b===2||E&1)&&m.push(y)}m.sort((p,y)=>p.getWidth()-y.getWidth());for(let p=0;p<m.length;++p){const y=m[p],b=(c[2]-c[0])/y.getWidth(),E=(c[3]-c[1])/y.getHeight();if(u=y,s&&s>b||o&&o>E)break}}let f=t;if(a){const[m,p]=l.getOrigin(),[y,b]=u.getResolution(l);f=[Math.round((a[0]-m)/y),Math.round((a[1]-p)/b),Math.round((a[2]-m)/y),Math.round((a[3]-p)/b)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return u.readRasters({...e,window:f})}}class ni extends jp{constructor(e,t,n,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new fw((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let c=0;c<s;l+=t,++c){const f=i.readUint16(l),m=i.readUint16(l+2),p=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let y,b;const E=vl(m),v=l+(this.bigTiff?12:8);if(E*p<=(this.bigTiff?8:4))y=Nn(i,m,p,v);else{const w=i.readOffset(v),P=vl(m)*p;if(i.covers(w,P))y=Nn(i,m,p,w);else{const T=await this.getSlice(w,P);y=Nn(T,m,p,w)}}p===1&&VE.indexOf(f)===-1&&!(m===de.RATIONAL||m===de.SRATIONAL)?b=y[0]:b=y,a[zi[f]]=b}const u=Dw(a),h=i.readOffset(e+n+t*s);return new Uw(a,u,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Ms?new Ms(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Ms(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Gp(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Ms)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===Nn(i,de.ASCII,t.length,e)){const o=Nn(i,de.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(i=await this.getSlice(e,a));const l=Nn(i,de.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,h])=>{this.ghostValues[u]=h})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],s=new hw(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=u?s.getUint64(8,a):s.getUint32(4,a);return new ni(e,a,u,h,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class kw extends jp{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(n);return new Gp(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function zw(r,e={},t){return ni.fromSource(xl(r,e),t)}async function Bw(r,e){return ni.fromSource(Nw(r),e)}async function Gw(r,e=[],t={},n){const i=await ni.fromSource(xl(r,t),n),s=await Promise.all(e.map(o=>ni.fromSource(xl(o,t))));return new kw(i,s)}const $w=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,jw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Vw{constructor(e){this.gl_=e,this.program_=El(e,jw,$w),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,n,i,s,o,a,l,u,h,c,f,m){const p=this.gl_;l===void 0&&(l=i),u===void 0&&(u=s),o===void 0&&(o=t),a===void 0&&(a=n),h===void 0&&(h=o),c===void 0&&(c=a),f===void 0&&(f=p.canvas.width),m===void 0&&(m=p.canvas.height),p.bindTexture(p.TEXTURE_2D,e),p.useProgram(this.program_),p.bindBuffer(p.ARRAY_BUFFER,this.positionBuffer),p.enableVertexAttribArray(this.positionLocation),p.vertexAttribPointer(this.positionLocation,2,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,this.texcoordBuffer),p.enableVertexAttribArray(this.texcoordLocation),p.vertexAttribPointer(this.texcoordLocation,2,p.FLOAT,!1,0,0);let y=fl(0,f,0,m,-1,1);y=Mx(y,l,u,0),y=vh(y,h,c,1),p.uniformMatrix4fv(this.matrixLocation,!1,y);let b=Ox(i/t,s/n,0);b=vh(b,o/t,a/n,1),p.uniformMatrix4fv(this.textureMatrixLocation,!1,b),p.uniform1i(this.textureLocation,0),p.drawArrays(p.TRIANGLES,0,this.positions.length/2)}}function Dh(r,e,t){const n=r.createShader(e);if(n===null)throw new Error("Shader compilation failed");if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){const i=r.getShaderInfoLog(n);throw i===null?new Error("Shader info log creation failed"):new Error(i)}return n}function El(r,e,t){const n=r.createProgram(),i=Dh(r,r.VERTEX_SHADER,t),s=Dh(r,r.FRAGMENT_SHADER,e);if(n===null)throw new Error("Program creation failed");if(r.attachShader(n,i),r.attachShader(n,s),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw r.getProgramInfoLog(n)===null?new Error("Program info log creation failed"):new Error;return n}const Xw=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,qw=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,Ww=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,Hw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Zw(r,e,t,n){let i;return t&&t.length?i=t.shift():Qg?i=new OffscreenCanvas(r||300,e||300):i=document.createElement("canvas"),r&&(i.width=r),e&&(i.height=e),i.getContext("webgl",n)}function Yw(r){const e=r.canvas;e.width=1,e.height=1,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)}const Uh=[];function Kw(r,e,t,n,i,s,o,a,l,u,h,c,f,m){const p=Math.round(n*e),y=Math.round(n*t);r.canvas.width=p,r.canvas.height=y;let b,E;if(E=r.createTexture(),r.bindTexture(r.TEXTURE_2D,E),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),f?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,p,y,0,r.RGBA,h,null),b=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,b),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,E,0),b===null)throw new Error("Could not create framebuffer");if(E===null)throw new Error("Could not create texture");if(l.length===0)return{width:p,height:y,framebuffer:b,texture:E};const v=cs();l.forEach(function(M,z,q){ey(v,M.extent)});let w,P,T;const R=1/i;{if(w=r.createTexture(),E===null)throw new Error("Could not create texture");P=Math.round(dt(v)*R),T=Math.round(rr(v)*R);const M=r.getParameter(r.MAX_TEXTURE_SIZE),z=Math.max(P,T),q=z>M?M/z:1,d=Math.round(P*q),g=Math.round(T*q);r.bindTexture(r.TEXTURE_2D,w),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),f?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,d,g,0,r.RGBA,h,null);const _=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,_),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,w,0);const x=new Vw(r);l.forEach(function(S,k,O){const N=(S.extent[0]-v[0])*R*q,G=-(S.extent[3]-v[3])*R*q,Y=dt(S.extent)*R*q,Z=rr(S.extent)*R*q;if(r.bindFramebuffer(r.FRAMEBUFFER,_),r.viewport(0,0,d,g),S.clipExtent){const B=(S.clipExtent[0]-v[0])*R*q,re=-(S.clipExtent[3]-v[3])*R*q,se=dt(S.clipExtent)*R*q,oe=rr(S.clipExtent)*R*q;r.enable(r.SCISSOR_TEST),r.scissor(f?B:Math.round(B),f?re:Math.round(re),f?se:Math.round(B+se)-Math.round(B),f?oe:Math.round(re+oe)-Math.round(re))}x.drawImage(S.texture,S.width,S.height,u,u,S.width-2*u,S.height-2*u,f?N:Math.round(N),f?G:Math.round(G),f?Y:Math.round(N+Y)-Math.round(N),f?Z:Math.round(G+Z)-Math.round(G),d,g),r.disable(r.SCISSOR_TEST)}),r.deleteFramebuffer(_)}const C=to(o),D=to(v),U=M=>{const z=(M[0][0]-C[0])/s*n,q=-(M[0][1]-C[1])/s*n,d=(M[1][0]-C[0])/s*n,g=-(M[1][1]-C[1])/s*n,_=(M[2][0]-C[0])/s*n,x=-(M[2][1]-C[1])/s*n;return{u1:d,v1:g,u0:z,v0:q,u2:_,v2:x}};r.bindFramebuffer(r.FRAMEBUFFER,b),r.viewport(0,0,p,y);{const M=[],z=[],q=El(r,Hw,Ww);r.useProgram(q);const d=r.getUniformLocation(q,"u_texture");r.bindTexture(r.TEXTURE_2D,w),r.uniform1i(d,0),a.getTriangles().forEach(function(N,G,Y){const Z=N.source,B=N.target,{u1:re,v1:se,u0:oe,v0:Fe,u2:pe,v2:Ne}=U(B),Be=(Z[0][0]-D[0])/i/P,De=-(Z[0][1]-D[1])/i/T,Ge=(Z[1][0]-D[0])/i/P,H=-(Z[1][1]-D[1])/i/T,mt=(Z[2][0]-D[0])/i/P,ir=-(Z[2][1]-D[1])/i/T;M.push(re,se,oe,Fe,pe,Ne),z.push(Ge,H,Be,De,mt,ir)});const g=fl(0,p,y,0,-1,1),_=r.getUniformLocation(q,"u_matrix");r.uniformMatrix4fv(_,!1,g);const x=r.getAttribLocation(q,"a_position"),S=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,S),r.bufferData(r.ARRAY_BUFFER,new Float32Array(M),r.STATIC_DRAW),r.vertexAttribPointer(x,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(x);const k=r.getAttribLocation(q,"a_texcoord"),O=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,O),r.bufferData(r.ARRAY_BUFFER,new Float32Array(z),r.STATIC_DRAW),r.vertexAttribPointer(k,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(k),r.drawArrays(r.TRIANGLES,0,M.length/2)}if(c){const M=El(r,qw,Xw);r.useProgram(M);const z=fl(0,p,y,0,-1,1),q=r.getUniformLocation(M,"u_matrix");r.uniformMatrix4fv(q,!1,z);const d=Array.isArray(c)?c:[0,0,0,255],g=r.getUniformLocation(M,"u_val");r.uniform4fv(g,d);const _=r.getAttribLocation(M,"a_position"),x=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,x),r.vertexAttribPointer(_,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(_);const S=a.getTriangles().reduce(function(k,O){const N=O.target,{u1:G,v1:Y,u0:Z,v0:B,u2:re,v2:se}=U(N);return k.concat([G,Y,Z,B,Z,B,re,se,re,se,G,Y])},[]);r.bufferData(r.ARRAY_BUFFER,new Float32Array(S),r.STATIC_DRAW),r.drawArrays(r.LINES,0,S.length/2)}return{width:p,height:y,framebuffer:b,texture:E}}class Jw extends Zl{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,n=t.getExtent(),i=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?i?gr(n,i):n:i;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?gr(s,o):s;if($c(l)===0){this.state=ue.EMPTY;return}n&&(a?a=gr(a,n):a=n);const u=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=ty(t,h,l,u);if(!isFinite(c)||c<=0){this.state=ue.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:ry;if(this.triangulation_=new ny(t,h,l,a,c*f,u,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=ue.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let m=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(m[1]=We(m[1],a[1],a[3]),m[3]=We(m[3],a[1],a[3])):m=gr(m,a)),!$c(m))this.state=ue.EMPTY;else{let p=0,y=0;t.canWrapX()&&(p=dt(n),y=Math.floor((m[0]-n[0])/p)),iy(m.slice(),t,!0).forEach(E=>{const v=this.sourceTileGrid_.getTileRangeForExtentAndZ(E,this.sourceZ_),w=e.getTileFunction;for(let P=v.minX;P<=v.maxX;P++)for(let T=v.minY;T<=v.maxY;T++){const R=w(this.sourceZ_,P,T,this.pixelRatio_);if(R){const C=y*p;this.sourceTiles_.push({tile:R,offset:C})}}++y}),this.sourceTiles_.length===0&&(this.state=ue.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(P=>{var G;const T=P.tile;if(!T||T.getState()!==ue.LOADED)return;const R=T.getSize(),C=this.gutter_;let D;const U=rl(T.getData());U?D=U:(t=!0,D=sy(nl(T.getData())));const M=[R[0]+2*C,R[1]+2*C],z=D instanceof Float32Array,q=M[0]*M[1],d=z?Float32Array:Uint8ClampedArray,g=new d(D.buffer),_=d.BYTES_PER_ELEMENT,x=_*g.length/q,S=g.byteLength/M[1],k=Math.floor(S/_/M[0]),O=this.sourceTileGrid_.getTileCoordExtent(T.tileCoord);O[0]+=P.offset,O[2]+=P.offset;const N=(G=this.clipExtent_)==null?void 0:G.slice();N&&(N[0]+=P.offset,N[2]+=P.offset),e.push({extent:O,clipExtent:N,data:g,dataType:d,bytesPerPixel:x,pixelSize:M,bandCount:k})}),this.sourceTiles_.length=0,e.length===0){this.state=ue.ERROR,this.changed();return}const n=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(n),s=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],a=s*this.pixelRatio_,l=o*this.pixelRatio_,u=this.targetTileGrid_.getResolution(n),h=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=e[0].bandCount,m=new e[0].dataType(f*a*l),p=Zw(a,l,Uh,{premultipliedAlpha:!1,antialias:!1});let y;const b=p.RGBA;let E;e[0].dataType==Float32Array?(E=p.FLOAT,p.getExtension("WEBGL_color_buffer_float"),p.getExtension("OES_texture_float"),p.getExtension("EXT_float_blend"),y=p.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(E=p.UNSIGNED_BYTE,y=this.interpolate);const v=4,w=Math.ceil(f/v);for(let P=w-1;P>=0;--P){const T=[];for(let d=0,g=e.length;d<g;++d){const _=e[d],x=_.pixelSize,S=x[0],k=x[1],O=new _.dataType(v*S*k),N=_.data;let G=P*v;for(let Z=0,B=O.length;Z<B;Z+=v)O[Z]=N[G],O[Z+1]=N[G+1],O[Z+2]=N[G+2],O[Z+3]=N[G+3],G+=f;const Y=p.createTexture();p.bindTexture(p.TEXTURE_2D,Y),y?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR)):(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,b,S,k,0,b,E,O),T.push({extent:_.extent,clipExtent:_.clipExtent,texture:Y,width:S,height:k})}const{framebuffer:R,width:C,height:D}=Kw(p,s,o,this.pixelRatio_,h,u,c,this.triangulation_,T,this.gutter_,E,this.renderEdges_,y),U=C,M=D*v,z=new e[0].dataType(U*M);p.bindFramebuffer(p.FRAMEBUFFER,R),p.readPixels(0,0,C,D,p.RGBA,E,z);let q=P*v;for(let d=0,g=z.length;d<g;d+=v){const _=(U-1-(d/M|0))*M+d%M;m[q]=z[_],m[q+1]=z[_+1],m[q+2]=z[_+2],m[q+3]=z[_+3],q+=f}}if(Yw(p),Uh.push(p.canvas),t){const P=en(s,o),T=new ImageData(m,s);P.putImageData(T,0,0),this.reprojData_=P.canvas}else this.reprojData_=m;this.reprojSize_=[Math.round(a),Math.round(l)],this.state=ue.LOADED,this.changed()}load(){if(this.state!==ue.IDLE&&this.state!==ue.ERROR)return;this.state=ue.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n!==ue.IDLE&&n!==ue.LOADING)return;e++;const i=Cr(t,Tt.CHANGE,()=>{const s=t.getState();(s==ue.LOADED||s==ue.ERROR||s==ue.EMPTY)&&(eo(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==ue.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(eo),this.sourcesListenerKeys_=null}}class xs extends Jl{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let n=e.tileGrid;n===void 0&&t&&(n=nn({extent:Pn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?tr(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?tr(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||Ni(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,i,s){const o=this.tileGrid||this.getTileGridForProjection(s||i),a=Math.max.apply(null,o.getResolutions().map((m,p)=>{const y=tr(o.getTileSize(p)),b=this.getTileSize(p);return Math.max(b[0]/y[0],b[1]/y[1])})),l=this.getTileGridForProjection(i),u=[e,t,n],h=this.getTileCoordForTileUrlFunction(u,i),c=Object.assign({sourceProj:s||i,sourceTileGrid:o,targetProj:i,targetTileGrid:l,tileCoord:u,wrappedTileCoord:h,pixelRatio:a,gutter:this.gutter_,getTileFunction:(m,p,y,b)=>this.getTile(m,p,y,b),transformMatrix:this.transformMatrix},this.tileOptions),f=new Jw(c);return f.key=this.getKey(),f}getTile(e,t,n,i,s){var w;const o=this.getProjection();if(s&&(o&&!Ni(o,s)||this.transformMatrix))return this.getReprojTile_(e,t,n,s,o);const a=this.getTileSize(e),l=this.loader_,u=new AbortController,h={signal:u.signal,crossOrigin:this.crossOrigin_},c=this.getTileCoordForTileUrlFunction([e,t,n]);if(!c)return null;const f=c[0],m=c[1],p=c[2],y=(w=this.getTileGrid())==null?void 0:w.getFullTileRange(f);y&&(h.maxY=y.getHeight()-1);function b(){return Wi(function(){return l(f,m,p,h)})}const E=Object.assign({tileCoord:[e,t,n],loader:b,size:a,controller:u},this.tileOptions),v=new Zl(E);return v.key=this.getKey(),v.addEventListener(Tt.CHANGE,this.handleTileChange_),v}handleTileChange_(e){const t=e.target,n=Te(t),i=t.getState();let s;i==ue.LOADING?(this.tileLoadingKeys_[n]=!0,s=wa.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==ue.ERROR?wa.TILELOADERROR:i==ue.LOADED?wa.TILELOADEND:void 0),s&&this.dispatchEvent(new oy(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Ni(t,e))&&!this.transformMatrix)return this.tileGrid;const n=Te(e);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=ay(e)),this.tileGridForProjection_[n]}setTileGridForProjection(e,t){const n=xe(e);if(n){const i=Te(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function Qw(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function e1(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=Rt;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const kh="STATISTICS_MAXIMUM",zh="STATISTICS_MINIMUM",Oa=256;let Na;function t1(){return Na||(Na=new pw),Na}function r1(r){try{return r.getBoundingBox(!0)}catch{return[0,0,r.getWidth(),r.getHeight()]}}function n1(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function i1(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function s1(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=xe(t);if(!n){const i=jc(e.ProjLinearUnitsGeoKey);i&&(n=new Vc({code:t,units:i}))}return n}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let n=xe(t);if(!n){const i=jc(e.GeogAngularUnitsGeoKey);i&&(n=new Vc({code:t,units:i}))}return n}return null}function o1(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function a1(r,e){let t;return r.blob?t=Bw(r.blob):r.overviews?t=Gw(r.url,r.overviews,e):t=zw(r.url,e),t.then(o1)}function Ci(r,e,t,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)Ci(r[o],e[o],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function l1(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function u1(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class Yu extends xs{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=a1(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){Hi(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],s=s1(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const s=t[n].fileDirectory.ModelTransformation;if(s){const[o,a,l,u,h,c,f,m]=s,p=ji(ji([1/Math.sqrt(o*o+h*h),0,0,-1/Math.sqrt(a*a+c*c),u,m],[o,h,a,c,0,0]),[1,0,0,1,-u,-m]);this.transformMatrix=p,this.addAlpha_=!0;break}}}configure_(e){let t,n,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let h=0;const c=e.length;for(let b=0;b<c;++b){const E=[],v=[];e[b].forEach(U=>{Qw(U)?v.push(U):E.push(U)});const w=E.length;if(v.length>0&&v.length!==w)throw new Error(`Expected one mask per image found ${v.length} masks and ${w} images`);let P,T;const R=new Array(w),C=new Array(w),D=new Array(w);l[b]=new Array(w),u[b]=new Array(w);for(let U=0;U<w;++U){const M=E[U],z=M.getGDALNoData();u[b][U]=M.getGDALMetadata(0),l[b][U]=z;const q=this.sourceInfo_[b].bands;a[b]=q?q.length:M.getSamplesPerPixel();const d=w-(U+1);P||(P=r1(M)),T||(T=n1(M));const g=i1(M,E[0]);D[d]=g[0];const _=[M.getTileWidth(),M.getTileHeight()];_[0]!==_[1]&&_[1]<Oa&&(_[0]=Oa,_[1]=Oa),R[d]=_;const x=g[0]/Math.abs(g[1]);C[d]=[_[0],_[1]/x]}if(t?gr(t,P,t):t=P,!n)n=T;else{const U=`Origin mismatch for source ${b}, got [${T}] but expected [${n}]`;Ci(n,T,0,U,this.viewRejector)}if(!o)o=D,this.resolutionFactors_[b]=1;else{o.length-h>D.length&&(h=o.length-D.length);const U=o[o.length-1]/D[D.length-1];this.resolutionFactors_[b]=U;const M=D.map(q=>q*=U),z=`Resolution mismatch for source ${b}, got [${M}] but expected [${o}]`;Ci(o.slice(h,o.length),M,.02,z,this.viewRejector)}i?Ci(i.slice(h,i.length),C,.01,`Tile size mismatch for source ${b}`,this.viewRejector):i=C,s?Ci(s.slice(h,s.length),R,0,`Tile size mismatch for source ${b}`,this.viewRejector):s=R,this.sourceImagery_[b]=E.reverse(),this.sourceMasks_[b]=v.reverse()}for(let b=0,E=this.sourceImagery_.length;b<E;++b){const v=this.sourceImagery_[b];for(;v.length<o.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let b=0;b<c;++b){if(this.sourceInfo_[b].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[b].length){this.addAlpha_=!0;break}const E=l[b],v=this.sourceInfo_[b].bands;if(v){for(let w=0;w<v.length;++w)if(E[v[w]-1]!==null){this.addAlpha_=!0;break e}continue}for(let w=0;w<E.length;++w)if(E[w]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let b=0;b<c;++b)f+=a[b];this.bandCount=f;const m=new hs({extent:t,minZoom:h,origin:n,resolutions:o,tileSizes:i});this.tileGrid=m,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let y=t;if(this.transformMatrix){const b=qi(ft(),this.transformMatrix.slice()),E=ly(v=>Or(b,v));y=Qn(t,E)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:cy(yr(y),this.projection),extent:uy(y,this.projection),zoom:p})}loadTile_(e,t,n,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,u=this.sourceInfo_,h=t1();for(let c=0;c<o;++c){const f=u[c],m=this.resolutionFactors_[c],p=[Math.round(t*(s[0]*m)),Math.round(n*(s[1]*m)),Math.round((t+1)*(s[0]*m)),Math.round((n+1)*(s[1]*m))],y=this.sourceImagery_[c][e];let b;f.bands&&(b=f.bands.map(function(T){return T-1}));let E;"nodata"in f&&f.nodata!==null?E=f.nodata:b?E=b.map(function(T){return l[c][T]}):E=l[c];const v={window:p,width:s[0],height:s[1],samples:b,fillValue:E,pool:h,interleave:!1,signal:i.signal};e1(this.convertToRGB_,y)?a[c]=y.readRGB(v):a[c]=y.readRasters(v);const w=o+c,P=this.sourceMasks_[c][e];if(!P){a[w]=Promise.resolve(null);continue}a[w]=P.readRasters({window:p,width:s[0],height:s[1],samples:[0],pool:h,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(c){throw Hi(c),c})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,h=this.addAlpha_,c=e[0]*e[1],f=c*o;let m;u?m=new Uint8Array(f):m=new Float32Array(f);let p=0;for(let y=0;y<c;++y){let b=h;for(let E=0;E<s;++E){const v=i[E];let w=v.min,P=v.max,T,R;if(u){const C=n[E][0];w===void 0&&(C&&zh in C?w=parseFloat(C[zh]):w=l1(t[E][0])),P===void 0&&(C&&kh in C?P=parseFloat(C[kh]):P=u1(t[E][0])),T=255/(P-w),R=-w*T}for(let C=0;C<a[E];++C){const D=t[E][C][y];let U;if(u?U=We(T*D+R,0,255):U=D,!h)m[p]=U;else{let M=v.nodata;if(M===void 0){let q;v.bands?q=v.bands[C]-1:q=C,M=l[E][q]}const z=isNaN(M);(!z&&D!==M||z&&!isNaN(D))&&(b=!1,m[p]=U)}p++}if(!b){const C=s+E,D=t[C];D&&!D[0][y]&&(b=!0)}}h&&(b||(m[p]=255),p++)}return m}}Yu.prototype.getView;class je{constructor(e){this.name=e}toString(){return this.name}}je.GeoTIFF=new je("GeoTIFF");je.ImageStatic=new je("ImageStatic");je.PMTilesRaster=new je("PMTilesRaster");je.PMTilesVector=new je("PMTilesVector");je.TileJSON=new je("TileJSON");je.TileWMS=new je("TileWMS");je.WMTS=new je("WMTS");je.XYZ=new je("XYZ");function c1(r){const e=r.load||ci,t=r.imageExtent,n=r.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=n,e(i,r.url).then(s=>{const o=dt(t)/s.width,a=rr(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class Vp extends In{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,n=e.imageLoadFunction!==void 0?e.imageLoadFunction:Ql;super({attributions:e.attributions,interpolate:e.interpolate,projection:xe(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new sd(this.imageExtent_,void 0,1,c1({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),n(this.image,s),ci(i))})),this.image.addEventListener(Tt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return Jn(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function Ku(r,e,t,n){const i=document.createElement("script"),s="olc_"+Te(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class h1 extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class f1 extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Xp(r){return new Promise(function(e,t){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(u){const h="Error parsing response text as JSON: "+u.message;t(new Error(h));return}e(l);return}t(new h1(a))}function i(o){t(new f1(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function qp(r,e){return e.includes("://")?e:new URL(e,r).href}class Ko extends Ur{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:xe("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Ku(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=xe("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const u=eu(t,n);i=Qn(e.bounds,u)}const s=Pn(n),o=e.minzoom||0,a=e.maxzoom||22,l=nn({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=ld(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(h){return Jn(u,h.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}var Wp={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(gn,function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(c,f){return c.indexOf(f)===-1?c.length:c.indexOf(f)}function i(c){var f=c.replace(/^v/,"").replace(/\+.*$/,""),m=n(f,"-"),p=f.substring(0,m).split(".");return p.push(f.substring(m+1)),p}function s(c){return isNaN(Number(c))?c:Number(c)}function o(c){if(typeof c!="string")throw new TypeError("Invalid argument expected string");if(!t.test(c))throw new Error("Invalid argument not valid semver ('"+c+"' received)")}function a(c,f){[c,f].forEach(o);for(var m=i(c),p=i(f),y=0;y<Math.max(m.length-1,p.length-1);y++){var b=parseInt(m[y]||0,10),E=parseInt(p[y]||0,10);if(b>E)return 1;if(E>b)return-1}var v=m[m.length-1],w=p[p.length-1];if(v&&w){var P=v.split(".").map(s),T=w.split(".").map(s);for(y=0;y<Math.max(P.length,T.length);y++){if(P[y]===void 0||typeof T[y]=="string"&&typeof P[y]=="number")return-1;if(T[y]===void 0||typeof P[y]=="string"&&typeof T[y]=="number"||P[y]>T[y])return 1;if(T[y]>P[y])return-1}}else if(v||w)return v?-1:1;return 0}var l=[">",">=","=","<","<="],u={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function h(c){if(typeof c!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof c);if(l.indexOf(c)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(c){return typeof c=="string"&&t.test(c)},a.compare=function(c,f,m){h(m);var p=a(c,f);return u[m].indexOf(p)>-1},a})})(Wp);var d1=Wp.exports,wl=d1;const Ju="1.1.0",$=!0,ee={classification:"https://stac-extensions.github.io/classification/v2.0.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.2.0/schema.json",eo:"https://stac-extensions.github.io/eo/v2.0.0/schema.json",file:"https://stac-extensions.github.io/file/v2.1.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.2.0/schema.json",projection:"https://stac-extensions.github.io/projection/v2.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v2.0.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.1.0/schema.json",version:"https://stac-extensions.github.io/version/v1.2.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},yn={itemAndCollection:{"classification:":ee.classification,"cube:":ee.datacube,"eo:":ee.eo,"file:":ee.file,"label:":ee.label,"pc:":ee.pointcloud,"processing:":ee.processing,"proj:":ee.projection,"raster:":ee.raster,"sar:":ee.sar,"sat:":ee.sat,"sci:":ee.scientific,"view:":ee.view,version:ee.version,deprecated:ee.version,published:ee.timestamps,expires:ee.timestamps,unpublished:ee.timestamps},catalog:{},collection:{},item:{}};yn.collection=Object.assign(yn.collection,yn.itemAndCollection);yn.item=Object.assign(yn.item,yn.itemAndCollection);var Li={parseExtension(r){let e=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]};let t=r.match(/(\d+\.\d+(\.\d+)([a-z_.-][\w.-]+)?)/i);if(t)return{id:r,version:t[1]};if(r in ee)return{id:r,version:"0.0.0"}}},ge={version:Ju,extensions:{},set(r){if(typeof r.stac_version!="string"?ge.version="0.6.0":ge.version=r.stac_version,Array.isArray(r.stac_extensions))for(let e of r.stac_extensions){let t=Li.parseExtension(e);t&&(ge.extensions[t.id]=t.version)}},before(r,e=null){return ge.compare("<",r,e)},compare(r,e,t=null){let n=t?ge.extensions[t]:ge.version;return typeof n>"u"?!1:wl.compare(n,e,r)}},A={type(r){let e=typeof r;if(e==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return e},is(r,e){return Array.isArray(e)?e.includes(A.type(r)):A.type(r)===e},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],delete r[e],!0):!1},copy(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],!0):!1},forAll(r,e,t){if(r[e]&&typeof r[e]=="object")for(let n in r[e])t(r[e][n])},toArray(r,e){return typeof r[e]<"u"&&!Array.isArray(r[e])?(r[e]=[r[e]],!0):!1},flattenArray(r,e,t,n=!1){if(Array.isArray(r[e])){for(let i in r[e])if(typeof t[i]=="string"){let s=r[e][i];r[t[i]]=n?[s]:s}return delete r[e],!0}return!1},flattenOneElementArray(r,e,t=!1){return!t&&Array.isArray(r[e])?r[e].length===1?(r[e]=r[e][0],!0):!1:!0},removeFromArray(r,e,t){if(Array.isArray(r[e])){let n=r[e].indexOf(t);return n>-1&&r[e].splice(n,1),!0}return!1},pickFirst(r,e){return Array.isArray(r[e])&&r[e].length>0?(r[e]=r[e][0],!0):(delete r[e],!1)},ensure(r,e,t){return A.type(t)!==A.type(r[e])&&(r[e]=t),!0},upgradeExtension(r,e){let{id:t,version:n}=Li.parseExtension(e),i=r.stac_extensions.findIndex(s=>{let o=Li.parseExtension(s);return o&&o.id===t&&wl.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=e,!0):!1},addExtension(r,e){let{id:t,version:n}=Li.parseExtension(e),i=r.stac_extensions.findIndex(s=>{if(s===e)return!0;let o=Li.parseExtension(s);return!!(o&&o.id===t&&wl.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(e):r.stac_extensions[i]=e,r.stac_extensions.sort(),!0},removeExtension(r,e){return A.removeFromArray(r,"stac_extensions",e)},migrateExtensionShortnames(r){let e=Object.keys(ee),t=Object.values(ee);return A.mapValues(r,"stac_extensions",e,t)},populateExtensions(r,e){let t=[];(e=="catalog"||e=="collection")&&t.push(r),(e=="item"||e=="collection")&&A.isObject(r.assets)&&(t=t.concat(Object.values(r.assets))),e=="collection"&&A.isObject(r.item_assets)&&(t=t.concat(Object.values(r.item_assets))),e=="collection"&&A.isObject(r.summaries)&&t.push(r.summaries),e=="item"&&A.isObject(r.properties)&&t.push(r.properties),t.push(r.links);let n;for(;n=t.pop();)Object.keys(n).forEach(i=>{Array.isArray(n.bands)&&(t=t.concat(n.bands));let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=yn[e][s[0]];A.is(o,"string")&&A.addExtension(r,o)}})},mapValues(r,e,t,n){let i=s=>{let o=t.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[e])?r[e]=r[e].map(i):typeof r[e]<"u"&&(r[e]=i(r[e])),!0},mapObject(r,e){for(let t in r)r[t]=e(r[t],t)},moveTo(r,e,t,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=A.isDefined,s(r[e])?(t[e]=n&&!i?r[e][0]:r[e],delete r[e],!0):!1},runAll(r,e,t,n){for(let i in r)i.startsWith("migrate")||r[i](e,t,n)},toUTC(r,e){if(A.is(r[e],"string"))try{return r[e]=this.toISOString(r[e]),!0}catch{}return delete r[e],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(/\.0+(?=[-\+Z])/,"")},formatString(r,e,t){const n=i=>A.is(i,["string","number"])?t.replaceAll("{}",i):i;Array.isArray(r[e])?r[e]=r[e].map(n):r[e]=n(r[e])}},pr={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")},toMultihash(r,e,t){if(!pr.multihash||!A.is(r[e],"string"))return!1;try{const n=pr.multihash.encode(pr.hexToUint8(r[e]),t);return r[e]=pr.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},Qu={migrate(r,e=!0){return ge.set(r),e&&(r.stac_version=Ju),r.type="Catalog",A.ensure(r,"stac_extensions",[]),ge.before("1.0.0-rc.1")&&A.migrateExtensionShortnames(r),A.ensure(r,"id",""),A.ensure(r,"description",""),A.ensure(r,"links",[]),A.runAll(Qu,r,r),ge.before("0.8.0")&&A.populateExtensions(r,"catalog"),r}},ec={migrate(r,e=!0){return Qu.migrate(r,e),r.type="Collection",ge.before("1.0.0-rc.1")&&A.migrateExtensionShortnames(r),A.ensure(r,"license","other"),A.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),A.runAll(ec,r,r),A.isObject(r.properties)&&(A.removeFromArray(r,"stac_extensions","commons"),delete r.properties),ge.before("0.8.0")&&A.populateExtensions(r,"collection"),ge.before("1.0.0-beta.1")&&A.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(A.ensure(r,"extent",{}),ge.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),A.ensure(r.extent,"spatial",{}),A.ensure(r.extent.spatial,"bbox",[]),A.ensure(r.extent,"temporal",{}),A.ensure(r.extent.temporal,"interval",[]),ge.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let e,t;for(let n of r.extent.temporal.interval){if(n[0]===null)e=null;else if(typeof n[0]=="string"&&e!==null)try{let i=new Date(n[0]);(typeof e>"u"||i<e)&&(e=i)}catch{}if(n[1]===null)t=null;else if(typeof n[1]=="string"&&t!==null)try{let i=new Date(n[1]);(typeof t>"u"||i>t)&&(t=i)}catch{}}r.extent.temporal.interval.unshift([e?A.toISOString(e):null,t?A.toISOString(t):null])}if(r.extent.spatial.bbox.length>1){let e=r.extent.spatial.bbox.reduce((t,n)=>Array.isArray(n)?Math.max(n.length,t):t,4);if(e>=4){let t=new Array(e).fill(null),n=e/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];t[s]===null?t[s]=o:s<n?t[s]=Math.min(o,t[s]):t[s]=Math.max(o,t[s])}}t.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(t)}}}},collectionAssets(r){ge.before("1.0.0-rc.1")&&A.removeExtension(r,"collection-assets"),Ki.migrateAll(r)},itemAsset(r){ge.before("1.0.0-beta.2")&&A.rename(r,"item_assets","assets"),A.removeExtension(r,ee["item-assets"]),Ki.migrateAll(r,"item_assets")},summaries(r){if(A.ensure(r,"summaries",{}),ge.before("0.8.0")&&A.isObject(r.other_properties)){for(let e in r.other_properties){let t=r.other_properties[e];Array.isArray(t.extent)&&t.extent.length===2?r.summaries[e]={minimum:t.extent[0],maximum:t.extent[1]}:Array.isArray(t.values)&&(t.values.filter(n=>Array.isArray(n)).length===t.values.length?r.summaries[e]=t.values.reduce((n,i)=>n.concat(i),[]):r.summaries[e]=t.values)}delete r.other_properties}if(ge.before("1.0.0-beta.1")&&A.isObject(r.properties)&&!r.links.find(e=>["child","item"].includes(e.rel)))for(let e in r.properties){let t=r.properties[e];Array.isArray(t)||(t=[t]),r.summaries[e]=t}ge.before("1.0.0-rc.1")&&A.mapObject(r.summaries,e=>(A.rename(e,"min","minimum"),A.rename(e,"max","maximum"),e)),vs.migrate(r.summaries,r,!0),A.moveTo(r.summaries,"sci:doi",r,!0)&&A.addExtension(r,ee.scientific),A.moveTo(r.summaries,"sci:publications",r,!0,!0)&&A.addExtension(r,ee.scientific),A.moveTo(r.summaries,"sci:citation",r,!0)&&A.addExtension(r,ee.scientific),A.moveTo(r.summaries,"cube:dimensions",r,!0)&&A.addExtension(r,ee.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},tc={migrate(r,e=null,t=!0){ge.set(r),t&&(r.stac_version=Ju),A.ensure(r,"stac_extensions",[]),ge.before("1.0.0-rc.1")&&A.migrateExtensionShortnames(r),A.ensure(r,"id",""),A.ensure(r,"type","Feature"),A.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&A.ensure(r,"bbox",[]),A.ensure(r,"properties",{}),A.ensure(r,"links",[]),A.ensure(r,"assets",{});let n=!1;return A.isObject(e)&&A.isObject(e.properties)&&(A.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},e.properties,r.properties),n=!0),A.runAll(tc,r,r),vs.migrate(r.properties,r),Ki.migrateAll(r),(ge.before("0.8.0")||n)&&A.populateExtensions(r,"item"),r}},Hp={migrate(r,e=!0){return A.ensure(r,"collections",[]),A.ensure(r,"links",[]),A.runAll(Hp,r,r),r.collections=r.collections.map(t=>ec.migrate(t,e)),r}},Zp={migrate(r,e=!0){return A.ensure(r,"type","FeatureCollection"),A.ensure(r,"features",[]),A.ensure(r,"links",[]),A.runAll(Zp,r,r),r.features=r.features.map(t=>tc.migrate(t,null,e)),r}},Ki={migrateAll(r,e="assets"){for(let t in r[e])Ki.migrate(r[e][t],r)},migrate(r,e){return A.runAll(Ki,r,e),vs.migrate(r,e),r},mediaTypes(r){A.is(r.type,"string")&&A.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])}},Tl={migrateAll(r,e){if(ge.before("1.0.0")){const t=A.isObject(e.properties)&&Array.isArray(e.properties.bands)?e.properties.bands:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];A.is(i,"number")&&A.isObject(t[i])&&(i=t[i]),A.isObject(i)||(i={}),r["eo:bands"][n]=i}}if(ge.before("1.1.0-beta.1")&&(Array.isArray(r["raster:bands"])||Array.isArray(r["eo:bands"]))){A.ensure(r,"bands",[]);const t=r["raster:bands"]||[],n=r["eo:bands"]||[],i=Math.max(t.length,n.length);for(let s=0;s<i;s++)A.ensure(r.bands,s,{}),Object.assign(r.bands[s],t[s],n[s]),r.bands[s]=Tl.migrate(r.bands[s],e);delete r["raster:bands"],delete r["eo:bands"]}},migrate(r,e){return A.runAll(Tl,r,e),vs.migrate(r,e),r},eo(r){ge.before("2.0.0-beta.1","eo")&&(A.rename(r,"common_name","eo:common_name"),A.rename(r,"center_wavelength","eo:center_wavelength"),A.rename(r,"full_width_half_max","eo:full_width_half_max"),A.rename(r,"solar_illumination","eo:solar_illumination"))},raster(r){ge.before("2.0.0-beta.1","raster")&&(A.rename(r,"sampling","raster:sampling"),A.rename(r,"bits_per_sample","raster:bits_per_sample"),A.rename(r,"spatial_resolution","raster:spatial_resolution"),A.rename(r,"scale","raster:scale"),A.rename(r,"offset","raster:offset"),A.rename(r,"histogram","raster:histogram"))}},vs={migrate(r,e,t=!1){return A.runAll(vs,r,e,t),r},_commonMetadata(r,e){ge.before("1.0.0-rc.3")&&(A.toUTC(r,"created"),A.toUTC(r,"updated")),Tl.migrateAll(r,e)},_timestamps(r,e){A.toUTC(r,"published"),A.toUTC(r,"expires"),A.toUTC(r,"unpublished"),A.upgradeExtension(e,ee.timestamps)},_versioningIndicator(r,e){A.upgradeExtension(e,ee.version)},checksum(r,e){ge.before("0.9.0")&&pr.multihash&&(A.rename(r,"checksum:md5","checksum:multihash")&&pr.toMultihash(r,"checksum:multihash","md5"),A.rename(r,"checksum:sha1","checksum:multihash")&&pr.toMultihash(r,"checksum:multihash","sha1"),A.rename(r,"checksum:sha2","checksum:multihash")&&pr.toMultihash(r,"checksum:multihash","sha2-256"),A.rename(r,"checksum:sha3","checksum:multihash")&&pr.toMultihash(r,"checksum:multihash","sha3-256")),ge.before("1.0.0-rc.1")&&A.rename(r,"checksum:multihash","file:checksum")&&A.addExtension(e,ee.file),A.removeExtension(e,"checksum")},classification(r,e){ge.before("1.1.0","classification")&&A.forAll(r,"classification:classes",t=>A.rename(t,"color-hint","color_hint")),ge.before("2.0.0","classification")&&A.forAll(r,"classification:classes",t=>A.ensure(t,"name",t.description)),A.upgradeExtension(e,ee.classification)},cube(r,e){A.upgradeExtension(e,ee.datacube)},dtr(r,e){ge.before("0.9.0")&&(A.rename(r,"dtr:start_datetime","start_datetime"),A.rename(r,"dtr:end_datetime","end_datetime"),A.removeExtension(e,"datetime-range"))},eo(r,e){ge.before("0.9.0")&&(A.rename(r,"eo:epsg","proj:epsg")&&A.addExtension(e,ee.projection),A.rename(r,"eo:platform","platform"),A.rename(r,"eo:instrument","instruments")&&A.toArray(r,"instruments"),A.rename(r,"eo:constellation","constellation"),A.rename(r,"eo:off_nadir","view:off_nadir")&&A.addExtension(e,ee.view),A.rename(r,"eo:azimuth","view:azimuth")&&A.addExtension(e,ee.view),A.rename(r,"eo:incidence_angle","view:incidence_angle")&&A.addExtension(e,ee.view),A.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&A.addExtension(e,ee.view),A.rename(r,"eo:sun_elevation","view:sun_elevation")&&A.addExtension(e,ee.view)),ge.before("1.0.0-beta.1")&&A.rename(r,"eo:gsd","gsd"),A.upgradeExtension(e,ee.eo)},file(r,e,t){A.rename(r,"file:bits_per_sample","raster:bits_per_sample")&&A.addExtension(e,ee.raster),A.rename(r,"file:data_type","data_type"),A.rename(r,"file:unit","unit"),Array.isArray(r["file:nodata"])&&r["file:nodata"].length>1&&A.copy(r,"file:nodata","nodata:values"),A.rename(r,"file:nodata","nodata")&&!t&&A.pickFirst(r,"nodata"),A.upgradeExtension(e,ee.file)},label(r,e){ge.before("0.8.0")&&(A.rename(r,"label:property","label:properties"),A.rename(r,"label:task","label:tasks"),A.rename(r,"label:overview","label:overviews")&&A.toArray(r,"label:overviews"),A.rename(r,"label:method","label:methods"),A.toArray(r,"label:classes")),A.upgradeExtension(e,ee.label)},pc(r,e){ge.before("0.8.0")&&A.rename(r,"pc:schema","pc:schemas"),A.upgradeExtension(e,ee.pointcloud)},processing(r,e){A.upgradeExtension(e,ee.processing)},proj(r,e){A.rename(r,"proj:epsg","proj:code")&&A.formatString(r,"proj:code","EPSG:{}"),A.upgradeExtension(e,ee.projection)},raster(r,e){A.upgradeExtension(e,ee.raster)},sar(r,e,t){A.rename(r,"sar:incidence_angle","view:incidence_angle")&&A.addExtension(e,ee.view),A.rename(r,"sar:pass_direction","sat:orbit_state")&&A.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&A.addExtension(e,ee.sat),ge.before("0.7.0")&&(A.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],t),A.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],t),A.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],t),A.rename(r,"sar:off_nadir","view:off_nadir")&&A.addExtension(e,ee.view)),ge.before("0.9.0")&&(A.rename(r,"sar:platform","platform"),A.rename(r,"sar:instrument","instruments")&&A.toArray(r,"instruments"),A.rename(r,"sar:constellation","constellation"),A.rename(r,"sar:type","sar:product_type"),A.rename(r,"sar:polarization","sar:polarizations"),A.flattenOneElementArray(r,"sar:absolute_orbit",t)&&A.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&A.addExtension(e,ee.sat),A.flattenOneElementArray(r,"sar:relative_orbit",t)&&A.rename(r,"sar:relative_orbit","sat:relative_orbit")&&A.addExtension(e,ee.sat)),A.upgradeExtension(e,ee.sar)},sat(r,e){ge.before("0.9.0")&&(A.rename(r,"sat:off_nadir_angle","sat:off_nadir"),A.rename(r,"sat:azimuth_angle","sat:azimuth"),A.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),A.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),A.upgradeExtension(e,ee.sat)},sci(r,e){A.upgradeExtension(e,ee.scientific)},item(r){ge.before("0.8.0")&&(A.rename(r,"item:license","license"),A.rename(r,"item:providers","providers"))},table(r,e){A.upgradeExtension(e,ee.table)},view(r,e){A.upgradeExtension(e,ee.view)}},Gn={item(r,e=null,t=!0){return tc.migrate(r,e,t)},catalog(r,e=!0){return Qu.migrate(r,e)},collection(r,e=!0){return ec.migrate(r,e)},collectionCollection(r,e=!0){return Hp.migrate(r,e)},itemCollection(r,e=!0){return Zp.migrate(r,e)},stac(r,e=!0){return r.type==="Feature"?Gn.item(r,null,e):r.type==="FeatureCollection"?Gn.itemCollection(r,e):r.type==="Collection"||!r.type&&A.isDefined(r.extent)&&A.isDefined(r.license)?Gn.collection(r,e):!r.type&&Array.isArray(r.collections)?Gn.collectionCollection(r,e):Gn.catalog(r,e)},enableMultihash(r){pr.multihash=r}},p1=Gn;const m1=Go(p1);function wt(r){return typeof r=="string"&&r.length>0}function qn(r,e,t,n=1e-8){if(typeof r!="number")return null;const i=e-n,s=t+n;return r<i||r>s?null:Math.min(Math.max(r,e),t)}function bt(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function g1(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function y1(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function Yp(r){const e={minimum:null,maximum:null},t=l=>l.minimum!==null&&l.maximum!==null,n=r.getMetadata("statistics");if(bt(n)&&(typeof n.minimum=="number"&&(e.minimum=n.minimum),typeof n.maximum=="number"&&(e.maximum=n.maximum),t(e)))return e;const i=r.getMetadata("raster:histogram");if(bt(i)&&(typeof i.min=="number"&&(e.minimum=i.min),typeof i.max=="number"&&(e.maximum=i.max),t(e)))return e;const s=r.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((l,u)=>(l.minimum=Math.min(l.minimum,u.value),l.maximum=Math.max(l.maximum,u.value),l),e),t(e)))return e;const o=r.getMetadata("file:values");if(Array.isArray(o)&&(o.reduce((l,u)=>(l.minimum=Math.min(l.minimum,...u.values),l.maximum=Math.max(l.maximum,...u.values),l),e),t(e)))return e;const a=r.getMetadata("data_type");return a&&(e.minimum=g1(a),e.maximum=y1(a)),e}function Kp(r){let e=[];const t=r.getMetadata("nodata");if(typeof t<"u")e.push(t);else{const n=r.getMetadata("file:nodata");if(typeof n<"u")e=n;else{const i=r.getMetadata("classification:classes");Array.isArray(i)&&(e=i.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}function _i(r){let e=r.length>=6,t=r[0],n=r[e?3:2],i=r[1],s=r[e?4:3],o={west:t,east:n,south:i,north:s};return e&&(o.base=r[2],o.height=r[5]),o}function Da(r){let{west:e,east:t,south:n,north:i}=_i(r);return[[[e,i],[e,n],[t,n],[t,i],[e,i]]]}function _1(r){if(r=_r(r,!0),!r)return null;let e=_i(r),t=[];if(em(r)){let n=(e.west+360+e.east)/2;n>180&&(n-=360),t.push(n)}else t.push((e.west+e.east)/2);return t.push((e.south+e.north)/2),typeof e.base<"u"&&t.push((e.base+e.height)/2),t}function Jp(r){if(Array.isArray(r[0]))return r.map(Jp);const[e,t]=r;return[qn(e,-180,180),qn(t,-90,90)]}function Vs(r){return bt(r)&&(r.bbox&&(r.bbox=_r(r.bbox)),r.type==="FeatureCollection"?r.features.forEach(e=>Vs(e)):r.type==="Feature"?r.geometry=Vs(r.geometry):r.type==="GeometryCollection"?r.geometries.forEach(e=>Vs(e)):r.coordinates&&(r.coordinates=Jp(r.coordinates))),r}function Qp(r){if(r.every(n=>typeof n=="number")&&(r=[r]),r=r.map(n=>_r(n)).filter(n=>n!==null),!Array.isArray(r)||r.length===0)return null;let e=r.reduce((n,i)=>{if(em(i)){let{west:s,east:o,south:a,north:l}=_i(i);n.push(Da([-180,a,o,l])),n.push(Da([s,a,180,l]))}else n.push(Da(i));return n},[]),t=null;if(e.length===1?t={type:"Polygon",coordinates:e[0]}:e.length>1&&(t={type:"MultiPolygon",coordinates:e}),t)return{type:"Feature",geometry:t,properties:{}}}function _r(r,e=!1){if(!Array.isArray(r)||![4,6].includes(r.length))return null;let{west:t,east:n,south:i,north:s,base:o,height:a}=_i(r);return t=qn(t,-180,180),i=qn(i,-90,90),n=qn(n,-180,180),s=qn(s,-90,90),e&&r.length===6?r=[t,i,o,n,s,a]:r=[t,i,n,s],r.some(l=>l===null)?null:r}function em(r){if(r=_r(r),!r)return!1;let{west:e,east:t}=_i(r);return e>t}function rc(r){if(!Array.isArray(r)||r.length===0)return null;const e={west:null,south:null,east:null,north:null},t=["west","south"];for(let i of r){if(i=_r(i),!i)continue;const s=_i(i);for(const o in s)if(e[o]===null)e[o]=s[o];else{const a=t.includes(o)?Math.min:Math.max;e[o]=a(e[o],s[o])}}let n=[e.west,e.south,e.east,e.north];return _r(n)}class Es{constructor(e,t={},n=[]){if(!bt(e))throw new Error("Given data is not an object");if(e instanceof Es){for(let i of n)this[i]=e[i];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in e)typeof this[i]>"u"&&(i in t?this[i]=t[i](e[i],this):this[i]=e[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(e=!0){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return _1(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let n=this[t];if(t in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)typeof n[s].toJSON=="function"?i[s]=n[s].toJSON():i[s]=n[s];n=i}e[t]=n}),e}}var tm={exports:{}},Fi={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */Fi.exports;var Bh;function b1(){return Bh||(Bh=1,function(r,e){(function(t){var n=e&&!e.nodeType&&e,i=r&&!r.nodeType&&r,s=typeof gn=="object"&&gn;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,u=1,h=26,c=38,f=700,m=72,p=128,y="-",b=/^xn--/,E=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=l-u,T=Math.floor,R=String.fromCharCode,C;function D(N){throw new RangeError(w[N])}function U(N,G){for(var Y=N.length,Z=[];Y--;)Z[Y]=G(N[Y]);return Z}function M(N,G){var Y=N.split("@"),Z="";Y.length>1&&(Z=Y[0]+"@",N=Y[1]),N=N.replace(v,".");var B=N.split("."),re=U(B,G).join(".");return Z+re}function z(N){for(var G=[],Y=0,Z=N.length,B,re;Y<Z;)B=N.charCodeAt(Y++),B>=55296&&B<=56319&&Y<Z?(re=N.charCodeAt(Y++),(re&64512)==56320?G.push(((B&1023)<<10)+(re&1023)+65536):(G.push(B),Y--)):G.push(B);return G}function q(N){return U(N,function(G){var Y="";return G>65535&&(G-=65536,Y+=R(G>>>10&1023|55296),G=56320|G&1023),Y+=R(G),Y}).join("")}function d(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:l}function g(N,G){return N+22+75*(N<26)-((G!=0)<<5)}function _(N,G,Y){var Z=0;for(N=Y?T(N/f):N>>1,N+=T(N/G);N>P*h>>1;Z+=l)N=T(N/P);return T(Z+(P+1)*N/(N+c))}function x(N){var G=[],Y=N.length,Z,B=0,re=p,se=m,oe,Fe,pe,Ne,Be,De,Ge,H,mt;for(oe=N.lastIndexOf(y),oe<0&&(oe=0),Fe=0;Fe<oe;++Fe)N.charCodeAt(Fe)>=128&&D("not-basic"),G.push(N.charCodeAt(Fe));for(pe=oe>0?oe+1:0;pe<Y;){for(Ne=B,Be=1,De=l;pe>=Y&&D("invalid-input"),Ge=d(N.charCodeAt(pe++)),(Ge>=l||Ge>T((a-B)/Be))&&D("overflow"),B+=Ge*Be,H=De<=se?u:De>=se+h?h:De-se,!(Ge<H);De+=l)mt=l-H,Be>T(a/mt)&&D("overflow"),Be*=mt;Z=G.length+1,se=_(B-Ne,Z,Ne==0),T(B/Z)>a-re&&D("overflow"),re+=T(B/Z),B%=Z,G.splice(B++,0,re)}return q(G)}function S(N){var G,Y,Z,B,re,se,oe,Fe,pe,Ne,Be,De=[],Ge,H,mt,ir;for(N=z(N),Ge=N.length,G=p,Y=0,re=m,se=0;se<Ge;++se)Be=N[se],Be<128&&De.push(R(Be));for(Z=B=De.length,B&&De.push(y);Z<Ge;){for(oe=a,se=0;se<Ge;++se)Be=N[se],Be>=G&&Be<oe&&(oe=Be);for(H=Z+1,oe-G>T((a-Y)/H)&&D("overflow"),Y+=(oe-G)*H,G=oe,se=0;se<Ge;++se)if(Be=N[se],Be<G&&++Y>a&&D("overflow"),Be==G){for(Fe=Y,pe=l;Ne=pe<=re?u:pe>=re+h?h:pe-re,!(Fe<Ne);pe+=l)ir=Fe-Ne,mt=l-Ne,De.push(R(g(Ne+ir%mt,0))),Fe=T(ir/mt);De.push(R(g(Fe,0))),re=_(Y,H,Z==B),Y=0,++Z}++Y,++G}return De.join("")}function k(N){return M(N,function(G){return b.test(G)?x(G.slice(4).toLowerCase()):G})}function O(N){return M(N,function(G){return E.test(G)?"xn--"+S(G):G})}if(o={version:"1.3.2",ucs2:{decode:z,encode:q},decode:x,encode:S,toASCII:O,toUnicode:k},n&&i)if(r.exports==n)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else t.punycode=o})(gn)}(Fi,Fi.exports)),Fi.exports}var Ua={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Gh;function x1(){return Gh||(Gh=1,function(r){(function(e,t){r.exports?r.exports=t():e.IPv6=t(e)})(gn,function(e){var t=e&&e.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,u=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(u=7);var h;for(h=0;h<l&&a[h]!=="";h++);if(h<u)for(a.splice(h,1,"0000");a.length<u;)a.splice(h,0,"0000");for(var c,f=0;f<u;f++){c=a[f].split("");for(var m=0;m<3&&(c[0]==="0"&&c.length>1);m++)c.splice(0,1);a[f]=c.join("")}var p=-1,y=0,b=0,E=-1,v=!1;for(f=0;f<u;f++)v?a[f]==="0"?b+=1:(v=!1,b>y&&(p=E,y=b)):a[f]==="0"&&(v=!0,E=f,b=1);b>y&&(p=E,y=b),y>1&&a.splice(p,y,""),l=a.length;var w="";for(a[0]===""&&(w=":"),f=0;f<l&&(w+=a[f],f!==l-1);f++)w+=":";return a[l-1]===""&&(w+=":"),w}function i(){return e.IPv6===this&&(e.IPv6=t),this}return{best:n,noConflict:i}})}(Ua)),Ua.exports}var ka={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var $h;function v1(){return $h||($h=1,function(r){(function(e,t){r.exports?r.exports=t():e.SecondLevelDomains=t(e)})(gn,function(e){var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})}(ka)),ka.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(e,t){r.exports?r.exports=t(b1(),x1(),v1()):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(gn,function(e,t,n,i){var s=i&&i.URI;function o(d,g){var _=arguments.length>=1,x=arguments.length>=2;if(!(this instanceof o))return _?x?new o(d,g):new o(d):new o;if(d===void 0){if(_)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&_)throw new TypeError("null is not a valid argument for URI");return this.href(d),g!==void 0?this.absoluteTo(g):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,u=Object.prototype.hasOwnProperty;function h(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function f(d){return c(d)==="Array"}function m(d,g){var _={},x,S;if(c(g)==="RegExp")_=null;else if(f(g))for(x=0,S=g.length;x<S;x++)_[g[x]]=!0;else _[g]=!0;for(x=0,S=d.length;x<S;x++){var k=_&&_[d[x]]!==void 0||!_&&g.test(d[x]);k&&(d.splice(x,1),S--,x--)}return d}function p(d,g){var _,x;if(f(g)){for(_=0,x=g.length;_<x;_++)if(!p(d,g[_]))return!1;return!0}var S=c(g);for(_=0,x=d.length;_<x;_++)if(S==="RegExp"){if(typeof d[_]=="string"&&d[_].match(g))return!0}else if(d[_]===g)return!0;return!1}function y(d,g){if(!f(d)||!f(g)||d.length!==g.length)return!1;d.sort(),g.sort();for(var _=0,x=d.length;_<x;_++)if(d[_]!==g[_])return!1;return!0}function b(d){var g=/^\/+|\/+$/g;return d.replace(g,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var g=d.nodeName.toLowerCase();if(!(g==="input"&&d.type!=="image"))return o.domAttributes[g]}};function E(d){return escape(d)}function v(d){return encodeURIComponent(d).replace(/[!'()*]/g,E).replace(/\*/g,"%2A")}o.encode=v,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=v,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,g){var _=o.encode(d+"");return g===void 0&&(g=o.escapeQuerySpace),g?_.replace(/%20/g,"+"):_},o.decodeQuery=function(d,g){d+="",g===void 0&&(g=o.escapeQuerySpace);try{return o.decode(g?d.replace(/\+/g,"%20"):d)}catch{return d}};var w={encode:"encode",decode:"decode"},P,T=function(d,g){return function(_){try{return o[g](_+"").replace(o.characters[d][g].expression,function(x){return o.characters[d][g].map[x]})}catch{return _}}};for(P in w)o[P+"PathSegment"]=T("pathname",w[P]),o[P+"UrnPathSegment"]=T("urnpath",w[P]);var R=function(d,g,_){return function(x){var S;_?S=function(G){return o[g](o[_](G))}:S=o[g];for(var k=(x+"").split(d),O=0,N=k.length;O<N;O++)k[O]=S(k[O]);return k.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,g){var _;return g||(g={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),_=d.indexOf("#"),_>-1&&(g.fragment=d.substring(_+1)||null,d=d.substring(0,_)),_=d.indexOf("?"),_>-1&&(g.query=d.substring(_+1)||null,d=d.substring(0,_)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(g.protocol=null,d=d.substring(2),d=o.parseAuthority(d,g)):(_=d.indexOf(":"),_>-1&&(g.protocol=d.substring(0,_)||null,g.protocol&&!g.protocol.match(o.protocol_expression)?g.protocol=void 0:d.substring(_+1,_+3).replace(/\\/g,"/")==="//"?(d=d.substring(_+3),d=o.parseAuthority(d,g)):(d=d.substring(_+1),g.urn=!0))),g.path=d,g},o.parseHost=function(d,g){d||(d=""),d=d.replace(/\\/g,"/");var _=d.indexOf("/"),x,S;if(_===-1&&(_=d.length),d.charAt(0)==="[")x=d.indexOf("]"),g.hostname=d.substring(1,x)||null,g.port=d.substring(x+2,_)||null,g.port==="/"&&(g.port=null);else{var k=d.indexOf(":"),O=d.indexOf("/"),N=d.indexOf(":",k+1);N!==-1&&(O===-1||N<O)?(g.hostname=d.substring(0,_)||null,g.port=null):(S=d.substring(0,_).split(":"),g.hostname=S[0]||null,g.port=S[1]||null)}return g.hostname&&d.substring(_).charAt(0)!=="/"&&(_++,d="/"+d),g.preventInvalidHostname&&o.ensureValidHostname(g.hostname,g.protocol),g.port&&o.ensureValidPort(g.port),d.substring(_)||"/"},o.parseAuthority=function(d,g){return d=o.parseUserinfo(d,g),o.parseHost(d,g)},o.parseUserinfo=function(d,g){var _=d,x=d.indexOf("\\");x!==-1&&(d=d.replace(/\\/g,"/"));var S=d.indexOf("/"),k=d.lastIndexOf("@",S>-1?S:d.length-1),O;return k>-1&&(S===-1||k<S)?(O=d.substring(0,k).split(":"),g.username=O[0]?o.decode(O[0]):null,O.shift(),g.password=O[0]?o.decode(O.join(":")):null,d=_.substring(k+1)):(g.username=null,g.password=null),d},o.parseQuery=function(d,g){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var _={},x=d.split("&"),S=x.length,k,O,N,G=0;G<S;G++)k=x[G].split("="),O=o.decodeQuery(k.shift(),g),N=k.length?o.decodeQuery(k.join("="),g):null,O!=="__proto__"&&(u.call(_,O)?((typeof _[O]=="string"||_[O]===null)&&(_[O]=[_[O]]),_[O].push(N)):_[O]=N);return _},o.build=function(d){var g="",_=!1;return d.protocol&&(g+=d.protocol+":"),!d.urn&&(g||d.hostname)&&(g+="//",_=!0),g+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&_&&(g+="/"),g+=d.path),typeof d.query=="string"&&d.query&&(g+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(g+="#"+d.fragment),g},o.buildHost=function(d){var g="";if(d.hostname)o.ip6_expression.test(d.hostname)?g+="["+d.hostname+"]":g+=d.hostname;else return"";return d.port&&(g+=":"+d.port),g},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var g="";return d.username&&(g+=o.encode(d.username)),d.password&&(g+=":"+o.encode(d.password)),g&&(g+="@"),g},o.buildQuery=function(d,g,_){var x="",S,k,O,N;for(k in d)if(k!=="__proto__"&&u.call(d,k))if(f(d[k]))for(S={},O=0,N=d[k].length;O<N;O++)d[k][O]!==void 0&&S[d[k][O]+""]===void 0&&(x+="&"+o.buildQueryParameter(k,d[k][O],_),g!==!0&&(S[d[k][O]+""]=!0));else d[k]!==void 0&&(x+="&"+o.buildQueryParameter(k,d[k],_));return x.substring(1)},o.buildQueryParameter=function(d,g,_){return o.encodeQuery(d,_)+(g!==null?"="+o.encodeQuery(g,_):"")},o.addQuery=function(d,g,_){if(typeof g=="object")for(var x in g)u.call(g,x)&&o.addQuery(d,x,g[x]);else if(typeof g=="string"){if(d[g]===void 0){d[g]=_;return}else typeof d[g]=="string"&&(d[g]=[d[g]]);f(_)||(_=[_]),d[g]=(d[g]||[]).concat(_)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,g,_){if(typeof g=="object")for(var x in g)u.call(g,x)&&o.setQuery(d,x,g[x]);else if(typeof g=="string")d[g]=_===void 0?null:_;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,g,_){var x,S,k;if(f(g))for(x=0,S=g.length;x<S;x++)d[g[x]]=void 0;else if(c(g)==="RegExp")for(k in d)g.test(k)&&(d[k]=void 0);else if(typeof g=="object")for(k in g)u.call(g,k)&&o.removeQuery(d,k,g[k]);else if(typeof g=="string")_!==void 0?c(_)==="RegExp"?!f(d[g])&&_.test(d[g])?d[g]=void 0:d[g]=m(d[g],_):d[g]===String(_)&&(!f(_)||_.length===1)?d[g]=void 0:f(d[g])&&(d[g]=m(d[g],_)):d[g]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,g,_,x){switch(c(g)){case"String":break;case"RegExp":for(var S in d)if(u.call(d,S)&&g.test(S)&&(_===void 0||o.hasQuery(d,S,_)))return!0;return!1;case"Object":for(var k in g)if(u.call(g,k)&&!o.hasQuery(d,k,g[k]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(_)){case"Undefined":return g in d;case"Boolean":var O=!!(f(d[g])?d[g].length:d[g]);return _===O;case"Function":return!!_(d[g],g,d);case"Array":if(!f(d[g]))return!1;var N=x?p:y;return N(d[g],_);case"RegExp":return f(d[g])?x?p(d[g],_):!1:!!(d[g]&&d[g].match(_));case"Number":_=String(_);case"String":return f(d[g])?x?p(d[g],_):!1:d[g]===_;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],g=[],_=0,x=0;x<arguments.length;x++){var S=new o(arguments[x]);d.push(S);for(var k=S.segment(),O=0;O<k.length;O++)typeof k[O]=="string"&&g.push(k[O]),k[O]&&_++}if(!g.length||!_)return new o("");var N=new o("").segment(g);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&N.path("/"+N.path()),N.normalize()},o.commonPath=function(d,g){var _=Math.min(d.length,g.length),x;for(x=0;x<_;x++)if(d.charAt(x)!==g.charAt(x)){x--;break}return x<1?d.charAt(0)===g.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(x)!=="/"||g.charAt(x)!=="/")&&(x=d.substring(0,x).lastIndexOf("/")),d.substring(0,x+1))},o.withinString=function(d,g,_){_||(_={});var x=_.start||o.findUri.start,S=_.end||o.findUri.end,k=_.trim||o.findUri.trim,O=_.parens||o.findUri.parens,N=/[a-z0-9-]=["']?$/i;for(x.lastIndex=0;;){var G=x.exec(d);if(!G)break;var Y=G.index;if(_.ignoreHtml){var Z=d.slice(Math.max(Y-3,0),Y);if(Z&&N.test(Z))continue}for(var B=Y+d.slice(Y).search(S),re=d.slice(Y,B),se=-1;;){var oe=O.exec(re);if(!oe)break;var Fe=oe.index+oe[0].length;se=Math.max(se,Fe)}if(se>-1?re=re.slice(0,se)+re.slice(se).replace(k,""):re=re.replace(k,""),!(re.length<=G[0].length)&&!(_.ignore&&_.ignore.test(re))){B=Y+re.length;var pe=g(re,Y,B,d);if(pe===void 0){x.lastIndex=B;continue}pe=String(pe),d=d.slice(0,Y)+pe+d.slice(B),x.lastIndex=Y+pe.length}}return x.lastIndex=0,d},o.ensureValidHostname=function(d,g){var _=!!d,x=!!g,S=!1;if(x&&(S=p(o.hostProtocols,g)),S&&!_)throw new TypeError("Hostname cannot be empty, if protocol is "+g);if(d&&d.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var g=Number(d);if(!(a(g)&&g>0&&g<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var g={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(g.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(g.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(g.SecondLevelDomains=i.SecondLevelDomains.noConflict()),g}else i.URI===this&&(i.URI=s);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(g,_){return g===void 0?this._parts[d]||"":(this._parts[d]=g||null,this.build(!_),this)}}function D(d,g){return function(_,x){return _===void 0?this._parts[d]||"":(_!==null&&(_=_+"",_.charAt(0)===g&&(_=_.substring(1))),this._parts[d]=_,this.build(!x),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=D("query","?"),l.fragment=D("fragment","#"),l.search=function(d,g){var _=this.query(d,g);return typeof _=="string"&&_.length?"?"+_:_},l.hash=function(d,g){var _=this.fragment(d,g);return typeof _=="string"&&_.length?"#"+_:_},l.pathname=function(d,g){if(d===void 0||d===!0){var _=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(_):_}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!g),this},l.path=l.pathname,l.href=function(d,g){var _;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var x=d instanceof o,S=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var k=o.getDomAttribute(d);d=d[k]||"",S=!1}if(!x&&S&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(x||S){var O=x?d._parts:d;for(_ in O)_!=="query"&&u.call(this._parts,_)&&(this._parts[_]=O[_]);O.query&&this.query(O.query,!1)}else throw new TypeError("invalid input");return this.build(!g),this},l.is=function(d){var g=!1,_=!1,x=!1,S=!1,k=!1,O=!1,N=!1,G=!this._parts.urn;switch(this._parts.hostname&&(G=!1,_=o.ip4_expression.test(this._parts.hostname),x=o.ip6_expression.test(this._parts.hostname),g=_||x,S=!g,k=S&&n&&n.has(this._parts.hostname),O=S&&o.idn_expression.test(this._parts.hostname),N=S&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return G;case"absolute":return!G;case"domain":case"name":return S;case"sld":return k;case"ip":return g;case"ip4":case"ipv4":case"inet4":return _;case"ip6":case"ipv6":case"inet6":return x;case"idn":return O;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return N}return null};var U=l.protocol,M=l.port,z=l.hostname;l.protocol=function(d,g){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return U.call(this,d,g)},l.scheme=l.protocol,l.port=function(d,g){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),M.call(this,d,g))},l.hostname=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var _={preventInvalidHostname:this._parts.preventInvalidHostname},x=o.parseHost(d,_);if(x!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=_.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return z.call(this,d,g)},l.origin=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var _=this.protocol(),x=this.authority();return x?(_?_+"://":"")+this.authority():""}else{var S=o(d);return this.protocol(S.protocol()).authority(S.authority()).build(!g),this}},l.host=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var _=o.parseHost(d,this._parts);if(_!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.authority=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var _=o.parseAuthority(d,this._parts);if(_!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!g),this},l.userinfo=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var _=o.buildUserinfo(this._parts);return _&&_.substring(0,_.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!g),this},l.resource=function(d,g){var _;return d===void 0?this.path()+this.search()+this.hash():(_=o.parse(d),this._parts.path=_.path,this._parts.query=_.query,this._parts.fragment=_.fragment,this.build(!g),this)},l.subdomain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,_)||""}else{var x=this._parts.hostname.length-this.domain().length,S=this._parts.hostname.substring(0,x),k=new RegExp("^"+h(S));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(k,d),this.build(!g),this}},l.domain=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.match(/\./g);if(_&&_.length<2)return this._parts.hostname;var x=this._parts.hostname.length-this.tld(g).length-1;return x=this._parts.hostname.lastIndexOf(".",x-1)+1,this._parts.hostname.substring(x)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var S=new RegExp(h(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(S,d)}return this.build(!g),this}},l.tld=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(g=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.lastIndexOf("."),x=this._parts.hostname.substring(_+1);return g!==!0&&n&&n.list[x.toLowerCase()]&&n.get(this._parts.hostname)||x}else{var S;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))S=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(S,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");S=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(S,d)}else throw new TypeError("cannot set TLD empty");return this.build(!g),this}},l.directory=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var _=this._parts.path.length-this.filename().length-1,x=this._parts.path.substring(0,_)||(this._parts.hostname?"/":"");return d?o.decodePath(x):x}else{var S=this._parts.path.length-this.filename().length,k=this._parts.path.substring(0,S),O=new RegExp("^"+h(k));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(O,d),this.build(!g),this}},l.filename=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var _=this._parts.path.lastIndexOf("/"),x=this._parts.path.substring(_+1);return d?o.decodePathSegment(x):x}else{var S=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(S=!0);var k=new RegExp(h(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(k,d),S?this.normalizePath(g):this.build(!g),this}},l.suffix=function(d,g){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var _=this.filename(),x=_.lastIndexOf("."),S,k;return x===-1?"":(S=_.substring(x+1),k=/^[a-z0-9%]+$/i.test(S)?S:"",d?o.decodePathSegment(k):k)}else{d.charAt(0)==="."&&(d=d.substring(1));var O=this.suffix(),N;if(O)d?N=new RegExp(h(O)+"$"):N=new RegExp(h("."+O)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return N&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(N,d)),this.build(!g),this}},l.segment=function(d,g,_){var x=this._parts.urn?":":"/",S=this.path(),k=S.substring(0,1)==="/",O=S.split(x);if(d!==void 0&&typeof d!="number"&&(_=g,g=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(k&&O.shift(),d<0&&(d=Math.max(O.length+d,0)),g===void 0)return d===void 0?O:O[d];if(d===null||O[d]===void 0)if(f(g)){O=[];for(var N=0,G=g.length;N<G;N++)!g[N].length&&(!O.length||!O[O.length-1].length)||(O.length&&!O[O.length-1].length&&O.pop(),O.push(b(g[N])))}else(g||typeof g=="string")&&(g=b(g),O[O.length-1]===""?O[O.length-1]=g:O.push(g));else g?O[d]=b(g):O.splice(d,1);return k&&O.unshift(""),this.path(O.join(x),_)},l.segmentCoded=function(d,g,_){var x,S,k;if(typeof d!="number"&&(_=g,g=d,d=void 0),g===void 0){if(x=this.segment(d,g,_),!f(x))x=x!==void 0?o.decode(x):void 0;else for(S=0,k=x.length;S<k;S++)x[S]=o.decode(x[S]);return x}if(!f(g))g=typeof g=="string"||g instanceof String?o.encode(g):g;else for(S=0,k=g.length;S<k;S++)g[S]=o.encode(g[S]);return this.segment(d,g,_)};var q=l.query;return l.query=function(d,g){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var _=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),x=d.call(this,_);return this._parts.query=o.buildQuery(x||_,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!g),this):q.call(this,d,g)},l.setQuery=function(d,g,_){var x=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)x[d]=g!==void 0?g:null;else if(typeof d=="object")for(var S in d)u.call(d,S)&&(x[S]=d[S]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(_=g),this.build(!_),this},l.addQuery=function(d,g,_){var x=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(x,d,g===void 0?null:g),this._parts.query=o.buildQuery(x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(_=g),this.build(!_),this},l.removeQuery=function(d,g,_){var x=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(x,d,g),this._parts.query=o.buildQuery(x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(_=g),this.build(!_),this},l.hasQuery=function(d,g,_){var x=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(x,d,g,_)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var g=this._parts.path;if(!g)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;g=o.recodePath(g);var _,x="",S,k;for(g.charAt(0)!=="/"&&(_=!0,g="/"+g),(g.slice(-3)==="/.."||g.slice(-2)==="/.")&&(g+="/"),g=g.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),_&&(x=g.substring(1).match(/^(\.\.\/)+/)||"",x&&(x=x[0]));S=g.search(/\/\.\.(\/|$)/),S!==-1;){if(S===0){g=g.substring(3);continue}k=g.substring(0,S).lastIndexOf("/"),k===-1&&(k=S),g=g.substring(0,k)+g.substring(S+3)}return _&&this.is("relative")&&(g=x+g.substring(1)),this._parts.path=g,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,g=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.unicode=function(){var d=o.encode,g=o.decode;o.encode=v,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=g}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var g="";if(d._parts.protocol&&(g+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&e?(g+=e.toUnicode(d._parts.hostname),d._parts.port&&(g+=":"+d._parts.port)):g+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(g+="/"),g+=d.path(!0),d._parts.query){for(var _="",x=0,S=d._parts.query.split("&"),k=S.length;x<k;x++){var O=(S[x]||"").split("=");_+="&"+o.decodeQuery(O[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),O[1]!==void 0&&(_+="="+o.decodeQuery(O[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}g+="?"+_.substring(1)}return g+=o.decodeQuery(d.hash(),!0),g},l.absoluteTo=function(d){var g=this.clone(),_=["protocol","username","password","hostname","port"],x,S,k;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),g._parts.protocol||(g._parts.protocol=d._parts.protocol,this._parts.hostname))return g;for(S=0;k=_[S];S++)g._parts[k]=d._parts[k];return g._parts.path?(g._parts.path.substring(-2)===".."&&(g._parts.path+="/"),g.path().charAt(0)!=="/"&&(x=d.directory(),x=x||(d.path().indexOf("/")===0?"/":""),g._parts.path=(x?x+"/":"")+g._parts.path,g.normalizePath())):(g._parts.path=d._parts.path,g._parts.query||(g._parts.query=d._parts.query)),g.build(),g},l.relativeTo=function(d){var g=this.clone().normalize(),_,x,S,k,O;if(g._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),_=g._parts,x=d._parts,k=g.path(),O=d.path(),k.charAt(0)!=="/")throw new Error("URI is already relative");if(O.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(_.protocol===x.protocol&&(_.protocol=null),_.username!==x.username||_.password!==x.password||_.protocol!==null||_.username!==null||_.password!==null)return g.build();if(_.hostname===x.hostname&&_.port===x.port)_.hostname=null,_.port=null;else return g.build();if(k===O)return _.path="",g.build();if(S=o.commonPath(k,O),!S)return g.build();var N=x.path.substring(S.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return _.path=N+_.path.substring(S.length)||"./",g.build()},l.equals=function(d){var g=this.clone(),_=new o(d),x={},S={},k={},O,N,G;if(g.normalize(),_.normalize(),g.toString()===_.toString())return!0;if(O=g.query(),N=_.query(),g.query(""),_.query(""),g.toString()!==_.toString()||O.length!==N.length)return!1;x=o.parseQuery(O,this._parts.escapeQuerySpace),S=o.parseQuery(N,this._parts.escapeQuerySpace);for(G in x)if(u.call(x,G)){if(f(x[G])){if(!y(x[G],S[G]))return!1}else if(x[G]!==S[G])return!1;k[G]=!0}for(G in S)if(u.call(S,G)&&!k[G])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(tm);var E1=tm.exports;const Ji=Go(E1),jh=["http","https"];function w1(r,e,t=!0){return T1(r,e,!1,t)}function T1(r,e=null,t=!1,n=!0){let i=Ji(r);if(e&&i.is("relative")){let s=Ji(e),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),t&&(i.query(""),i.fragment("")),n?i.toString():i}const Sl="application/geo+json",S1=["application/json",Sl,"text/json"],Vh=["image/gif","image/jpeg","image/apng","image/png","image/webp"],rm=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],nm=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(rm);function nc(r,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof r>"u"?!0:typeof r!="string"?!1:(e=e.map(n=>n.toLowerCase()),e.includes(r.toLowerCase()))}function R1(r,e=!1){return nc(r,S1,e)}class im extends Es{constructor(e,t=null,n={},i=[]){super(e,n,["_context"].concat(i)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?w1(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?e?this.href:Ji(this.href):null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=this.getAbsoluteUrl(!1);t||(t=Ji(this.href));const n=t.protocol().toLowerCase(),i=t.suffix().toLowerCase();return wt(n)&&!jh.includes(n)?!1:wt(this.type)&&Vh.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&wt(i)&&(i==="jpg"||Vh.includes("image/"+i)))}isType(e){return wt(this.type)&&nc(this.type,e)}isGeoTIFF(){return this.isType(nm)}isCOG(){return this.isType(rm)}isHTTP(){let e=this.getAbsoluteUrl(!1);if(!e)return null;const t=e.protocol().toLowerCase();return wt(t)&&jh.includes(t)}isPreview(){return!1}}class ic extends im{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(n=>bt(n)?new ic(n,t):n):[]}}class sm extends Es{constructor(e,t=null,n={},i=[]){if(super(e,Object.assign({links:ic.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(e=!0){return e?this._url:Ji(this._url)}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(n=>R1(n.type,t))}getStacLinkWithRel(e,t=!0){const n=this.getStacLinksWithRel(e,t);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>bt(e)&&wt(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class sc extends sm{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class ii extends Es{constructor(e,t=null,n=null){super(e,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof t=="string"?parseInt(t,10):t),this._context||(this._context=n)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getMinMaxValues(){return Yp(this)}getNoDataValues(){return Kp(this)}static fromBands(e,t=null){let n=[];if(Array.isArray(e))for(let i in e){const s=e[i],o=s instanceof ii?s:new ii(s,i,t);n.push(o)}return n}}const A1=["created","updated","published","expires","unpublished","bands"];class qt extends im{constructor(e,t=null,n=null){const i={bands:ii.fromBands,alternate:qt.fromAssets};super(e,n,i,["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefinition()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context instanceof qt)return this._context.getMetadata(e);if(this._context&&!A1.includes(e))return this._context.getMetadata(e)}getBands(){return this.bands||[]}findVisualBands(){const e={red:null,green:null,blue:null},t=this.getBands();for(const i in t){const s=parseInt(i,10),o=t[s];bt(o)&&wt(o["eo:common_name"])&&o["eo:common_name"]in e&&(e[o["eo:common_name"]]=o)}return Object.values(e).every(i=>i!==null)?e:null}findBand(e,t="name"){Array.isArray(e)||(e=[e]);const n=this.getBands(),i=n.findIndex(s=>bt(s)&&e.includes(s[t]));return i>=0?n[i]:null}getBand(e){return bt(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(){return Yp(this)}getNoDataValues(){return Kp(this)}isDefinition(){return!wt(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const e=["thumbnail","overview"];return e.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(t=>e.includes(t))}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>e.includes(n))}static fromAssets(e,t=null){let n={};if(bt(e))for(let i in e){const s=e[i],o=s instanceof qt?s:new qt(s,i,t);n[i]=o}return n}}function om(r){if(!r)return;const e=String(r),t=e.indexOf("@"),n=t!==-1?e.substr(t+1):void 0,i=t!==-1?e.substr(0,t):e,s=String(i).replace(/-/g,"_").split("_");if(!s.length||s.length>4)return;const o=s.shift();if(!o)return;const a={keyword:n,language:o.toLowerCase()};if(!s.length)return a;if(s.length===3){const h=s.pop();h&&(a.variant=h.toUpperCase())}let l=s.pop();if(l.length>3&&(a.keyword=l,l=s.pop()),l&&(a.country=l.toUpperCase()),!s.length)return a;const u=s.pop();return typeof u=="string"&&u.length>=1&&(a.script=u[0].toUpperCase()+u.substring(1).toLowerCase()),a}function P1(r){const e={};return r.forEach(t=>{const{language:n,country:i}=om(t);if(!n)throw new Error(`Locale ${t} is not parsable`);e[n]||(e[n]={countries:{},firstCountry:void 0,main:void 0});const s=e[n];i?(s.countries[i]=t,s.firstCountry||(s.firstCountry=t)):s.main=t}),e}function Rl(r,e,t,n){const i=Array.isArray(r)?P1(r):r;if(!e&&t)return Rl(r,t,void 0);if(!e)return;const{language:s,country:o}=om(e);if(!s)return t;if(!i[s])return e===t?void 0:Rl(r,t,null);const{countries:a,main:l=t,firstCountry:u}=i[s];return!a||!o?l:a[o]?a[o]:l}class Ir extends sm{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getLocaleLink(e,t=null){let n=this.getStacLinksWithRel("alternate").filter(o=>wt(o.hreflang)),i;Array.isArray(this.languages)?i=this.languages.map(o=>o.code):i=n.map(o=>o.hreflang);let s=Rl(i,e,t);return n.find(o=>o.hreflang===s)||null}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let n=this.getAssets().filter(i=>i.isPreview());if(n.length===0&&(n=this.getLinks().filter(i=>i.isPreview())),n.length===0){const i=this.getAsset("thumbnail");i&&n.push(i)}if(e&&(n=n.filter(i=>i.canBrowserDisplayImage())),t&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(t)||s.getKey()===t;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(e=!0,t=!1){var i;return(i=this.rankGeoTIFFs(e,t)[0])==null?void 0:i.asset}rankGeoTIFFs(e=!0,t=!1,n=null,i=null){bt(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(nm);e&&(o=o.filter(l=>l.isHTTP()&&(!t||l.isCOG())));let a=Object.entries(n);for(let l of o){let u=0;if(a.length>0){let h=a.filter(([c])=>l.hasRole(c,!0)).map(([,c])=>c);h.length>0&&(u+=Math.max(...h))}!t&&l.isCOG()&&(u+=2),l.findVisualBands()&&(u+=1),typeof i=="function"&&(u+=i(l)),s.push({asset:l,score:u})}return s.sort((l,u)=>u.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),n=this.getAssets();for(let s of n){let o=s.findBand(t,"eo:common_name");o&&(e[o["eo:common_name"]]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return bt(this.assets)&&this.assets[e]||null}getAssets(){return bt(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(n=>n.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>nc(t.type,e))}equals(e){return this===e?!0:!(e instanceof Ir)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}supportsExtension(e){if(!Array.isArray(this.stac_extensions))return!1;let t=new RegExp("^"+e.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(n=>t.test(n))}}class am extends Ir{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(n=>n.method===e||!e&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class I1 extends am{constructor(e,t=null){super(e,t)}}function Mi(r){if(wt(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function C1(r,e){return new Date(r.valueOf()+(e-r)/2)}function lm(r){if(!Array.isArray(r)||r.length===0)return null;let e,t;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{e=n(e,i,Math.min),t=n(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}class Al extends am{constructor(e,t=null){const n={assets:qt.fromAssets,item_assets:qt.fromAssets};super(e,t,n)}toGeoJSON(){let e=Qp(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0?_r(e[0]):null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1?[_r(e[0])]:e.length>1?e.slice(1).map(_r):null}getRawBoundingBoxes(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.spatial)==null?void 0:n.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.temporal)==null?void 0:n.interval;return Array.isArray(e)&&e.length>0?e.filter(i=>Array.isArray(i)&&(wt(i[0])||wt(i[1]))).map(i=>i.map(s=>Mi(s))):[]}getSummary(e){if(bt(this.summaries))return this.summaries[e]}getBands(){let e=this.getMetadata("bands");return Array.isArray(e)||(e=this.getSummary("bands")),Array.isArray(e)?ii.fromBands(e,this):[]}}class L1 extends sc{constructor(e,t=null){const n={collections:i=>i.map(s=>s instanceof Al?s:new Al(s))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return rc(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return lm(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class mo extends Ir{constructor(e,t=null){super(e,t,{assets:qt.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return _r(this.bbox)}getBoundingBoxes(){const e=this.getBoundingBox();return e?[e]:[]}getDateTime(){let e=Mi(this.properties.datetime);if(!e){let t=Mi(this.properties.start_datetime),n=Mi(this.properties.end_datetime);return t&&n?C1(t,n):t||n}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return wt(this.properties.start_datetime)||wt(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:wt(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(n=>Mi(n)))}getMetadata(e){return this.properties[e]}getBands(){const e=this.getMetadata("bands");return Array.isArray(e)?ii.fromBands(e,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class um extends sc{constructor(e,t=null){const n={features:i=>i.map(s=>s instanceof mo?s:new mo(s))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return rc(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return lm(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function Os(r,e=!0,t=!1){return e&&(r=m1.stac(r,t)),r.type==="Feature"?new mo(r):r.type==="FeatureCollection"?new um(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new Al(r):!r.type&&Array.isArray(r.collections)?new L1(r):new I1(r)}const F1="https://stac-extensions.github.io/label/v1.*/schema.json",cm=new Wr({color:"rgba(0,0,0,0)"});function hm(r,e,t="rgba(255,255,255,0.4)",n=5){let i=cm;t&&(i=new Wr({color:t}));const s=new qr({color:r,width:e});return new dr({image:new ud({fill:i,stroke:s,radius:n}),fill:i,stroke:s})}const M1=hm("#3399CC",3),Xh=hm("#ff9933",2,null);function O1(r,e){const t={url:r.getAbsoluteUrl()};let n=r,i=r.getBands();i.length===1&&(n=i[0],i=[]);const{minimum:s,maximum:o}=n.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof o=="number"&&(t.max=o),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:u,maximum:h}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof h=="number"&&(typeof t.max>"u"||h>t.max)&&(t.max=h)}const a=n.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const u of i){const h=u.getNoDataValues();if(h.length>0){if(typeof l>"u")l=h[0];else if(l!==h[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=r.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function qh(r,e=void 0){let t=e;if(hy()){const n=r.getMetadata("proj:code");if(n)try{if(n.startsWith("EPSG:")){const i=parseInt(n.replace("EPSG:",""),10);t=await fy(i)}}catch{}}return t}function Wh(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(cm),t}function N1(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}var fm=Object.defineProperty,Hh=Object.getOwnPropertySymbols,D1=Object.prototype.hasOwnProperty,U1=Object.prototype.propertyIsEnumerable,Zh=(r,e,t)=>e in r?fm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,go=(r,e)=>{for(var t in e||(e={}))D1.call(e,t)&&Zh(r,t,e[t]);if(Hh)for(var t of Hh(e))U1.call(e,t)&&Zh(r,t,e[t]);return r},Jo=(r,e)=>fm(r,"name",{value:e,configurable:!0}),k1=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())}),dm=class extends xs{constructor(e){super(go(go({},e),{state:"loading"})),this.loadImage=Jo(n=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=n}),"loadImage");const t=new Zi(e.url);t.getHeader().then(n=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||nn({extent:Pn(i),maxResolution:e.maxResolution,minZoom:n.minZoom,maxZoom:n.maxZoom,tileSize:e.tileSize}),this.setLoader((s,o,a)=>k1(this,null,function*(){const l=yield t.getZxy(s,o,a);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),h=yield this.loadImage(u);return URL.revokeObjectURL(u),h})),this.setState("ready")})}};Jo(dm,"PMTilesRasterSource");var Yh=dm,pm=class extends hi{constructor(e){super(go(go({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new tu})),this.tileLoadFunction=Jo((t,n)=>{const i=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),o=n.match(s);if(!(o&&o.length>=4))throw Error("Could not parse tile URL");const a=+o[1],l=+o[2],u=+o[3];i.setLoader((h,c,f)=>{this.pmtiles_.getZxy(a,l,u).then(m=>{if(m){const p=i.getFormat();i.setFeatures(p.readFeatures(m.data,{extent:h,featureProjection:f})),i.setState(ue.LOADED)}else i.setFeatures([]),i.setState(ue.EMPTY)}).catch(m=>{i.setFeatures([]),i.setState(ue.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new Zi(e.url),this.pmtiles_.getHeader().then(t=>{const n=e.projection||"EPSG:3857",i=e.extent||Pn(n);this.tileGrid=e.tileGrid||nn({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};Jo(pm,"PMTilesVectorSource");var z1=pm;class oc extends cd{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||M1,this.collectionStyle_=e.collectionStyle||Xh,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(n=>this.configure_(n,e.url,e.children,e.assets,e.bands)).catch(n=>this.handleError_(n))}async fetch_(e,t="json"){const n=await fetch(e);if(!n.ok)throw new Error(`Unexpected response from ${e}: ${n.status}`);return t==="json"?await n.json():t==="text"?await n.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const n=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!n||Do(n)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new hE(e))}configure_(e,t=null,n=null,i=null,s=[]){let o;e instanceof qt||e instanceof Ir?o=e:(o=Os(e,!this.disableMigration_),t&&t.includes("://")&&o.setAbsoluteUrl(t)),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Wh(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=h=>this.handleError_(h),u=[];n&&u.push(this.setChildren(n,null,!1).catch(l)),i&&u.push(this.setAssets(i,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const n=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new oc(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(n)}async addPreviewImage_(e){const t=await qh(e,"EPSG:4326"),n=e.getContext().getBoundingBoxes();if(n.length!==1)return;const i=n[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:ol(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(je.ImageStatic,s,e));const o=new ru({source:new Vp(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=N1(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new Zi(n.url).getHeader();let l;switch(a.tileType){case Bn.Mvt:l=new z1(await i(je.PMTilesVector,n));break;case Bn.Avif:case Bn.Jpeg:case Bn.Png:case Bn.Webp:l=new Yh(await i(je.PMTilesRaster,n));break;default:return}s.push(l);break;case"tilejson":s.push(new Ko(await i(je.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const c in e["wms:layers"]){const f=e["wms:layers"][c]||"";let m="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][c]=="string"&&(m=e["wms:styles"][c]);const p=Object.assign({LAYERS:f,STYLES:m},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(p.FORMAT=e.type);const y=await i(je.TileWMS,Object.assign({},n,{params:p}));s.push(new py(y))}break;case"wmts":const u=await this.getWmtsCapabilities_(t);if(!u)return;let h=[];Array.isArray(e["wmts:layer"])?h=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(h=[e["wmts:layer"]]);for(const c of h){let f=Object.assign({},n,{layer:c});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await i(je.WMTS,f);const m=hd(u,f);m!==null&&s.push(new dy(m))}break;case"xyz":s.push(new ro(await i(je.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof hi?a=new Wn({source:o,declutter:!0}):o instanceof Yh?a=new po({source:o}):a=new no({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[O1(e,this.bands_)],convertToRGB:"auto"};const i=await qh(e);i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(je.GeoTIFF,n,e));const s=new Yu(n),o=new Promise((a,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):a()})});try{await o;const a=new po({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let n={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(n=await this.getSourceOptions_(je.XYZ,n,e));const i=new no({source:new ro(n)});return this.addLayer_(i,e),i}addLayer_(e,t=null,n=0){t&&e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Qp(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=this.createGeoJsonLayer_(e,Wh(this.boundsStyle_,this),this.displayFootprint_);return n.set("bounds",!0),n.on("change",()=>this.setMap_(n.getMapInternal())),this.addLayer_(n,t,1),n}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),n=this.createGeoJsonLayer_(t);return this.addLayer_(n,e),n}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,n=!0){const i=new io,s=new Kr({format:i,loader:(o,a,l)=>{e=Vs(e);const u=i.readFeatures(e,{featureProjection:l});s.addFeatures(u)}});return t||(t=Xh),new ls({source:s,style:t,visible:n})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof mo))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),n;t.length>1&&(n=t.find(s=>s.roles.includes("labels-vector"))),n||(n=e.getAsset("vector_labels")),n||(t=e.getAssets().filter(s=>s.type===Sl&&!s.roles),t.length===1&&(n=t[0]));const i=e.getLinksWithRels(["source"]);if(n&&i.length>0){const s=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return Os(l)}catch(l){return this.handleError_(l),null}}),o=(await Promise.all(s)).filter(a=>a instanceof Ir);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(n)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const o=t.item(s);o.get("stac")&&!o.get("bounds")&&t.removeAt(s)}const n=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async o=>await this.addLayerForLink(o));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const s=i.map(async o=>{if(o){if(o.type===Sl)return await this.addGeoJson_(o);if(o.isGeoTIFF())return await this.addGeoTiff_(o);if(o.canBrowserDisplayImage())return await this.addPreviewImage_(o)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(n instanceof sc)await this.addChildren_(n.getAll(),this.childrenOptions_);else if(n instanceof Ir){if(n.isItem()&&n.supportsExtension(F1)&&n.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const o=n.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(o&&this.displayOverview_&&(a=await this.addGeoTiff_(o)),this.displayPreview_&&(!o||!a)){const l=n.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof qt)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let n=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?n=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=n.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):n.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),n}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const n=this.getData();this.assets_=e.map(i=>n instanceof Ir&&typeof i=="string"?n.getAsset(i):i instanceof qt?i:new qt(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,n=!0){e instanceof um?this.children_=e.getAll():bt(e)&&e.type==="FeatureCollection"?this.children_=Os(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof Ir?i:Os(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&bt(t)&&(this.childrenOptions_=t),n&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const n=this.getData();n&&(t=n.getBoundingBox());const i=this.getChildren();if(i){const s=i.map(o=>o.getBoundingBox());t=rc(s)}if(t)return ol(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const n=t.getMetadata("attribution");n&&n.push(n)}return e}getSource(){return null}async getWmtsCapabilities_(e){try{const t=new URL(e);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const n=await this.fetch_(t.toString(),"text");return new _u().read(n)}catch{return null}}}var B1=8,G1={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},$1={"*":{type:"source"}},j1=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],V1={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},X1={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},q1={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},W1={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},H1={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Z1={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Y1={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},K1=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],J1={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Q1={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},eT={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},rT={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nT={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},iT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},sT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},oT={type:"array",value:"*"},aT={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},lT={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},uT={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},cT={type:"array",value:"*",minimum:1},hT={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},fT={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},dT={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},pT={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},mT=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],gT={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},yT={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},_T={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},bT={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},xT={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},vT={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},ET={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},wT={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},TT={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},ST={"*":{type:"string"}},RT={$version:B1,$root:G1,sources:$1,source:j1,source_vector:V1,source_raster:X1,source_raster_dem:q1,source_geojson:W1,source_video:H1,source_image:Z1,layer:Y1,layout:K1,layout_background:J1,layout_fill:Q1,layout_circle:eT,layout_heatmap:tT,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:rT,layout_symbol:nT,layout_raster:iT,layout_hillshade:sT,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:oT,filter_operator:aT,geometry_type:lT,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:uT,expression:cT,light:hT,sky:fT,terrain:dT,projection:pT,paint:mT,paint_fill:gT,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:yT,paint_circle:_T,paint_heatmap:bT,paint_symbol:xT,paint_raster:vT,paint_hillshade:ET,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:wT,transition:TT,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:ST};const AT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function PT(r,e){const t={};for(const n in r)n!=="ref"&&(t[n]=r[n]);return AT.forEach(n=>{n in e&&(t[n]=e[n])}),t}function mm(r){r=r.slice();const e=Object.create(null);for(let t=0;t<r.length;t++)e[r[t].id]=r[t];for(let t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=PT(r[t],e[r[t].ref]));return r}class mr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ac{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new ac(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const Qo={kind:"null"},X={kind:"number"},me={kind:"string"},fe={kind:"boolean"},br={kind:"color"},ea={kind:"projectionDefinition"},_n={kind:"object"},le={kind:"value"},IT={kind:"error"},ta={kind:"collator"},ra={kind:"formatted"},na={kind:"padding"},Qi={kind:"colorArray"},ia={kind:"numberArray"},ws={kind:"resolvedImage"},sa={kind:"variableAnchorOffsetCollection"};function Ot(r,e){return{kind:"array",itemType:r,N:e}}function He(r){if(r.kind==="array"){const e=He(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}else return r.kind}const CT=[Qo,X,me,fe,br,ea,ra,_n,Ot(le),na,ia,Qi,ws,sa];function es(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!es(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of CT)if(!es(t,e))return null}}return`Expected ${He(r)} but found ${He(e)} instead.`}function lc(r,e){return e.some(t=>t.kind===r.kind)}function bn(r,e){return e.some(t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r)}function Gr(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const gm=.96422,ym=1,_m=.82521,bm=4/29,Zn=6/29,xm=3*Zn*Zn,LT=Zn*Zn*Zn,FT=Math.PI/180,MT=180/Math.PI;function vm(r){return r=r%360,r<0&&(r+=360),r}function Em([r,e,t,n]){r=za(r),e=za(e),t=za(t);let i,s;const o=Ba((.2225045*r+.7168786*e+.0606169*t)/ym);r===e&&e===t?i=s=o:(i=Ba((.4360747*r+.3850649*e+.1430804*t)/gm),s=Ba((.0139322*r+.0971045*e+.7141733*t)/_m));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),n]}function za(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ba(r){return r>LT?Math.pow(r,1/3):r/xm+bm}function wm([r,e,t,n]){let i=(r+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=ym*$a(i),s=gm*$a(s),o=_m*$a(o),[Ga(3.1338561*s-1.6168667*i-.4906146*o),Ga(-.9787684*s+1.9161415*i+.033454*o),Ga(.0719453*s-.2289914*i+1.4052427*o),n]}function Ga(r){return r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055,r<0?0:r>1?1:r}function $a(r){return r>Zn?r*r*r:xm*(r-bm)}function OT(r){const[e,t,n,i]=Em(r),s=Math.sqrt(t*t+n*n);return[Math.round(s*1e4)?vm(Math.atan2(n,t)*MT):NaN,s,e,i]}function NT([r,e,t,n]){return r=isNaN(r)?0:r*FT,wm([t,Math.cos(r)*e,Math.sin(r)*e,n])}function DT([r,e,t,n]){r=vm(r),e/=100,t/=100;function i(s){const o=(s+r/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),n]}const UT=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function Tm(r,e){return UT(r,e)?r[e]:void 0}function kT(r){if(r=r.toLowerCase().trim(),r==="transparent")return[0,0,0,0];const e=Tm(zT,r);if(e){const[i,s,o]=e;return[i/255,s/255,o/255,1]}if(r.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(r)){const s=r.length<6?1:2;let o=1;return[Ns(r.slice(o,o+=s)),Ns(r.slice(o,o+=s)),Ns(r.slice(o,o+=s)),Ns(r.slice(o,o+s)||"ff")]}if(r.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=r.match(i);if(s){const[o,a,l,u,h,c,f,m,p,y,b,E]=s,v=[u||" ",f||" ",y].join("");if(v==="  "||v==="  /"||v===",,"||v===",,,"){const w=[l,c,p].join(""),P=w==="%%%"?100:w===""?255:0;if(P){const T=[$n(+a/P,0,1),$n(+h/P,0,1),$n(+m/P,0,1),b?Kh(+b,E):1];if(Jh(T))return T}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=r.match(t);if(n){const[i,s,o,a,l,u,h,c,f]=n,m=[o||" ",l||" ",h].join("");if(m==="  "||m==="  /"||m===",,"||m===",,,"){const p=[+s,$n(+a,0,100),$n(+u,0,100),c?Kh(+c,f):1];if(Jh(p))return DT(p)}}}function Ns(r){return parseInt(r.padEnd(2,r),16)/255}function Kh(r,e){return $n(e?r/100:r,0,1)}function $n(r,e,t){return Math.min(Math.max(e,r),t)}function Jh(r){return!r.some(Number.isNaN)}const zT={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function xn(r,e,t){return r+t*(e-r)}function ts(r,e,t){return r.map((n,i)=>xn(n,e[i],t))}class Oe{constructor(e,t,n,i=1,s=!0){this.r=e,this.g=t,this.b=n,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof Oe)return e;if(typeof e!="string")return;const t=kT(e);if(t)return new Oe(...t,!1)}get rgb(){const{r:e,g:t,b:n,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,n/s,i])}get hcl(){return this.overwriteGetter("hcl",OT(this.rgb))}get lab(){return this.overwriteGetter("lab",Em(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(e,t,n,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=ts(e.rgb,t.rgb,n);return new Oe(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=e.hcl,[u,h,c,f]=t.hcl;let m,p;if(!isNaN(s)&&!isNaN(u)){let w=u-s;u>s&&w>180?w-=360:u<s&&s-u>180&&(w+=360),m=s+n*w}else isNaN(s)?isNaN(u)?m=NaN:(m=u,(a===1||a===0)&&(p=h)):(m=s,(c===1||c===0)&&(p=o));const[y,b,E,v]=NT([m,p??xn(o,h,n),xn(a,c,n),xn(l,f,n)]);return new Oe(y,b,E,v,!1)}case"lab":{const[s,o,a,l]=wm(ts(e.lab,t.lab,n));return new Oe(s,o,a,l,!1)}}}}Oe.black=new Oe(0,0,0,1);Oe.white=new Oe(1,1,1,1);Oe.transparent=new Oe(0,0,0,0);Oe.red=new Oe(1,0,0,1);class uc{constructor(e,t,n){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const BT=["bottom","center","top"];class Pl{constructor(e,t,n,i,s,o){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=s,this.verticalAlign=o}}class Mr{constructor(e){this.sections=e}static fromString(e){return new Mr([new Pl(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Mr?e:Mr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Qt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qt)return e;if(typeof e=="number")return new Qt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Qt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Qt(ts(e.values,t.values,n))}}class er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof er)return e;if(typeof e=="number")return new er([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new er(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new er(ts(e.values,t.values,n))}}class Nt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Nt)return e;if(typeof e=="string"){const n=Oe.parse(e);return n?new Nt([n]):void 0}if(!Array.isArray(e))return;const t=[];for(const n of e){if(typeof n!="string")return;const i=Oe.parse(n);if(!i)return;t.push(i)}return new Nt(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n,i="rgb"){const s=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)s.push(Oe.interpolate(e.values[o],t.values[o],n,i));return new Nt(s)}}class Ye extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const GT=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class xr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof xr)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if(typeof n!="string"||!GT.has(n)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new xr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const i=e.values,s=t.values;if(i.length!==s.length)throw new Ye(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new Ye(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,u]=i[a+1],[h,c]=s[a+1];o.push([xn(l,h,n),xn(u,c,n)])}return new xr(o)}}class an{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new an({name:e,available:!1}):null}}class Yt{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new Yt(e,t,n)}static parse(e){if(e instanceof Yt)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new Yt(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new Yt(e.from,e.to,e.transition);if(typeof e=="string")return new Yt(e,e,1)}}function Sm(r,e,t,n){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rs(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Yt||r instanceof Oe||r instanceof uc||r instanceof Mr||r instanceof Qt||r instanceof er||r instanceof Nt||r instanceof xr||r instanceof an)return!0;if(Array.isArray(r)){for(const e of r)if(!rs(e))return!1;return!0}else if(typeof r=="object"){for(const e in r)if(!rs(r[e]))return!1;return!0}else return!1}function rt(r){if(r===null)return Qo;if(typeof r=="string")return me;if(typeof r=="boolean")return fe;if(typeof r=="number")return X;if(r instanceof Oe)return br;if(r instanceof Yt)return ea;if(r instanceof uc)return ta;if(r instanceof Mr)return ra;if(r instanceof Qt)return na;if(r instanceof er)return ia;if(r instanceof Nt)return Qi;if(r instanceof xr)return sa;if(r instanceof an)return ws;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=rt(n);if(!t)t=i;else{if(t===i)continue;t=le;break}}return Ot(t||le,e)}else return _n}function Bi(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Oe||r instanceof Yt||r instanceof Mr||r instanceof Qt||r instanceof er||r instanceof Nt||r instanceof xr||r instanceof an?r.toString():JSON.stringify(r)}class si{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!rs(e[1]))return t.error("invalid value");const n=e[1];let i=rt(n);const s=t.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new si(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ds={string:me,number:X,boolean:fe,object:_n};class Kt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=1,i;const s=e[0];if(s==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in Ds)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=Ds[u],n++}else a=le;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],n++}i=Ot(a,l)}else{if(!Ds[s])throw new Error(`Types doesn't contain name = ${s}`);i=Ds[s]}const o=[];for(;n<e.length;n++){const a=t.parse(e[n],n,le);if(!a)return null;o.push(a)}return new Kt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(es(this.type,rt(n))){if(t===this.args.length-1)throw new Ye(`Expected value to be of type ${He(this.type)}, but found ${He(rt(n))} instead.`)}else return n}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Qh={"to-boolean":fe,"to-color":br,"to-number":X,"to-string":me};class Zr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Qh[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Qh[n],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,le);if(!a)return null;s.push(a)}return new Zr(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Oe)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?n=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:n=Sm(t[0],t[1],t[2],t[3]),!n))return new Oe(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ye(n||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=Qt.parse(t);if(i)return i}throw new Ye(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=er.parse(t);if(i)return i}throw new Ye(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=Nt.parse(t);if(i)return i}throw new Ye(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=xr.parse(t);if(i)return i}throw new Ye(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Ye(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Mr.fromString(Bi(this.args[0].evaluate(e)));case"resolvedImage":return an.fromString(Bi(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Bi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const $T=["Unknown","Point","LineString","Polygon"];class Rm{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$T[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Oe.parse(e),this._parseColorCache.set(e,t)),t}}class oa{constructor(e,t,n=[],i,s=new ac,o=[]){this.registry=e,this.path=n,this.key=n.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,s={}){return t?this.concat(t,n,i)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function n(i,s,o){return o==="assert"?new Kt(s,[i]):o==="coerce"?new Zr(s,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=n(o,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=n(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof si)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new Rm;try{o=new si(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i=typeof e=="number"?this.path.concat(e):this.path,s=n?this.scope.concat(n):this.scope;return new oa(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const n=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new mr(n,e))}checkSubtype(e,t){const n=es(e,t);return n&&this.error(n),n}}class aa{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;n.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new aa(n,i):null}outputDefined(){return this.result.outputDefined()}}class la{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new la(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class cc{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,X),i=t.parse(e[2],2,Ot(t.expectedType||le));if(!n||!i)return null;const s=i.type;return new cc(s.itemType,n,i)}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Ye(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Ye(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Ye(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class hc{constructor(e,t){this.type=fe,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,le),i=t.parse(e[2],2,le);return!n||!i?null:lc(n.type,[fe,me,X,Qo,le])?new hc(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(n.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!bn(t,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${He(rt(t))} instead.`);if(!bn(n,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${He(rt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class yo{constructor(e,t,n){this.type=X,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,le),i=t.parse(e[2],2,le);if(!n||!i)return null;if(!lc(n.type,[fe,me,X,Qo,le]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,X);return s?new yo(n,i,s):null}else return new yo(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!bn(t,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${He(rt(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),bn(n,["string"])){const s=n.indexOf(t,i);return s===-1?-1:[...n.slice(0,s)].length}else{if(bn(n,["array"]))return n.indexOf(t,i);throw new Ye(`Expected second argument to be of type array or string, but found ${He(rt(n))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class fc{constructor(e,t,n,i,s,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let h=e[u];const c=e[u+1];Array.isArray(h)||(h=[h]);const f=t.concat(u);if(h.length===0)return f.error("Expected at least one branch label.");for(const p of h){if(typeof p!="number"&&typeof p!="string")return f.error("Branch labels must be numbers or strings.");if(typeof p=="number"&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof p=="number"&&Math.floor(p)!==p)return f.error("Numeric branch labels must be integer values.");if(!n)n=rt(p);else if(f.checkSubtype(n,rt(p)))return null;if(typeof s[String(p)]<"u")return f.error("Branch labels must be unique.");s[String(p)]=o.length}const m=t.parse(c,u,i);if(!m)return null;i=i||m.type,o.push(m)}const a=t.parse(e[1],1,le);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(n,a.type)?null:new fc(n,i,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(rt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class dc{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,fe);if(!a)return null;const l=t.parse(e[o+1],o+1,n);if(!l)return null;i.push([a,l]),n=n||l.type}const s=t.parse(e[e.length-1],e.length-1,n);if(!s)return null;if(!n)throw new Error("Can't infer output type");return new dc(n,i,s)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class _o{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,le),i=t.parse(e[2],2,X);if(!n||!i)return null;if(!lc(n.type,[Ot(le),me,le]))return t.error(`Expected first argument to be of type array or string, but found ${He(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,X);return s?new _o(n.type,n,i,s):null}else return new _o(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),bn(t,["string"]))return[...t].slice(n,i).join("");if(bn(t,["array"]))return t.slice(n,i);throw new Ye(`Expected first argument to be of type array or string, but found ${He(rt(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Am(r,e){const t=r.length-1;let n=0,i=t,s=0,o,a;for(;n<=i;)if(s=Math.floor((n+i)/2),o=r[s],a=r[s+1],o<=e){if(s===t||e<a)return s;n=s+1}else if(o>e)i=s-1;else throw new Ye("Input is not a number.");return 0}class ua{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of n)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,X);if(!n)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,h=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const c=t.parse(l,h,s);if(!c)return null;s=s||c.type,i.push([a,c])}return new ua(s,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const o=Am(t,i);return n[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function jT(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ja,ef;function VT(){if(ef)return ja;ef=1,ja=r;function r(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var s=this.sampleCurveX(n)-e;if(Math.abs(s)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n=n-s/o}var a=0,l=1;for(n=e,i=0;i<20&&(s=this.sampleCurveX(n),!(Math.abs(s-e)<t));i++)e>s?a=n:l=n,n=(l-a)*.5+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ja}var XT=VT(),qT=jT(XT);class vr{constructor(e,t,n,i,s){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let s=0;if(e.name==="exponential")s=Va(t,e.base,n,i);else if(e.name==="linear")s=Va(t,1,n,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new qT(o[0],o[1],o[2],o[3]).solve(Va(t,1,n,i))}return s}static parse(e,t){let[n,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(h=>typeof h!="number"||h<0||h>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,X),!s)return null;const a=[];let l=null;(n==="interpolate-hcl"||n==="interpolate-lab")&&t.expectedType!=Qi?l=br:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const h=o[u],c=o[u+1],f=u+3,m=u+4;if(typeof h!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(a.length&&a[a.length-1][0]>=h)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const p=t.parse(c,m,l);if(!p)return null;l=l||p.type,a.push([h,p])}return!Gr(l,X)&&!Gr(l,ea)&&!Gr(l,br)&&!Gr(l,na)&&!Gr(l,ia)&&!Gr(l,Qi)&&!Gr(l,sa)&&!Gr(l,Ot(X))?t.error(`Type ${He(l)} is not interpolatable.`):new vr(l,n,i,s,a)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const o=Am(t,i),a=t[o],l=t[o+1],u=vr.interpolationFactor(this.interpolation,i,a,l),h=n[o].evaluate(e),c=n[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return xn(h,c,u);case"color":return Oe.interpolate(h,c,u);case"padding":return Qt.interpolate(h,c,u);case"colorArray":return Nt.interpolate(h,c,u);case"numberArray":return er.interpolate(h,c,u);case"variableAnchorOffsetCollection":return xr.interpolate(h,c,u);case"array":return ts(h,c,u);case"projectionDefinition":return Yt.interpolate(h,c,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return Oe.interpolate(h,c,u,"hcl");case"colorArray":return Nt.interpolate(h,c,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Oe.interpolate(h,c,u,"lab");case"colorArray":return Nt.interpolate(h,c,u,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Va(r,e,t,n){const i=n-t,s=r-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class ns{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const i=t.expectedType;i&&i.kind!=="value"&&(n=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,s.push(l)}if(!n)throw new Error("No output type");return i&&s.some(a=>es(i,a.type))?new ns(le,s):new ns(n,s)}evaluate(e){let t=null,n=0,i;for(const s of this.args)if(n++,t=s.evaluate(e),t&&t instanceof an&&!t.available&&(i||(i=t.name),t=null,n===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function tf(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function WT(r,e,t){return e===t}function HT(r,e,t){return e!==t}function ZT(r,e,t){return e<t}function YT(r,e,t){return e>t}function KT(r,e,t){return e<=t}function JT(r,e,t){return e>=t}function Pm(r,e,t,n){return n.compare(e,t)===0}function QT(r,e,t,n){return!Pm(r,e,t,n)}function eS(r,e,t,n){return n.compare(e,t)<0}function tS(r,e,t,n){return n.compare(e,t)>0}function rS(r,e,t,n){return n.compare(e,t)<=0}function nS(r,e,t,n){return n.compare(e,t)>=0}function bi(r,e,t){const n=r!=="=="&&r!=="!=";return class Im{constructor(s,o,a){this.type=fe,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,le);if(!l)return null;if(!tf(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${He(l.type)}'.`);let u=o.parse(s[2],2,le);if(!u)return null;if(!tf(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${He(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${He(l.type)}' and '${He(u.type)}'.`);n&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new Kt(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new Kt(l.type,[u])));let h=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(h=o.parse(s[3],3,ta),!h)return null}return new Im(l,u,h)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const l=rt(o),u=rt(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new Ye(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=rt(o),u=rt(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const iS=bi("==",WT,Pm),sS=bi("!=",HT,QT),oS=bi("<",ZT,eS),aS=bi(">",YT,tS),lS=bi("<=",KT,rS),uS=bi(">=",JT,nS);class ca{constructor(e,t,n){this.type=ta,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,fe);if(!i)return null;const s=t.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,fe);if(!s)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,me),!o)?null:new ca(i,s,o)}evaluate(e){return new uc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class pc{constructor(e,t,n,i,s){this.type=me,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,X);if(!n)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,me),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,me),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,X),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,X),!l)?null:new pc(n,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class mc{constructor(e){this.type=ra,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,X),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,Ot(me)),!u))return null;let h=null;if(a["text-color"]&&(h=t.parse(a["text-color"],1,br),!h))return null;let c=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!BT.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(c=t.parse(a["vertical-align"],1,me),!c)return null}const f=i[i.length-1];f.scale=l,f.font=u,f.textColor=h,f.verticalAlign=c}else{const l=t.parse(e[o],1,le);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new mc(i)}evaluate(e){const t=n=>{const i=n.content.evaluate(e);return rt(i)===ws?new Pl("",i,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Pl(Bi(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)};return new Mr(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class gc{constructor(e){this.type=ws,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,me);return n?new gc(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=an.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class yc{constructor(e){this.type=X,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${He(n.type)} instead.`):new yc(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new Ye(`Expected value to be of type string or array, but found ${He(rt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Er=8192;function cS(r,e){const t=hS(r[0]),n=dS(r[1]),i=Math.pow(2,e.z);return[Math.round(t*i*Er),Math.round(n*i*Er)]}function _c(r,e){const t=Math.pow(2,e.z),n=(r[0]/Er+e.x)/t,i=(r[1]/Er+e.y)/t;return[fS(n),pS(i)]}function hS(r){return(180+r)/360}function fS(r){return r*360-180}function dS(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function pS(r){return 360/Math.PI*Math.atan(Math.exp((180-r*360)*Math.PI/180))-90}function Ts(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function is(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function mS(r,e,t){return e[1]>r[1]!=t[1]>r[1]&&r[0]<(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1])+e[0]}function gS(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],s=r[0]-t[0],o=r[1]-t[1];return n*o-s*i===0&&n*s<=0&&i*o<=0}function ha(r,e,t,n){const i=[e[0]-r[0],e[1]-r[1]],s=[n[0]-t[0],n[1]-t[1]];return xS(s,i)===0?!1:!!(rf(r,e,t,n)&&rf(t,n,r,e))}function yS(r,e,t){for(const n of t)for(let i=0;i<n.length-1;++i)if(ha(r,e,n[i],n[i+1]))return!0;return!1}function xi(r,e,t=!1){let n=!1;for(const i of e)for(let s=0;s<i.length-1;s++){if(gS(r,i[s],i[s+1]))return t;mS(r,i[s],i[s+1])&&(n=!n)}return n}function _S(r,e){for(const t of e)if(xi(r,t))return!0;return!1}function Cm(r,e){for(const t of r)if(!xi(t,e))return!1;for(let t=0;t<r.length-1;++t)if(yS(r[t],r[t+1],e))return!1;return!0}function bS(r,e){for(const t of e)if(Cm(r,t))return!0;return!1}function xS(r,e){return r[0]*e[1]-r[1]*e[0]}function rf(r,e,t,n){const i=r[0]-t[0],s=r[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=n[0]-t[0],u=n[1]-t[1],h=i*u-l*s,c=o*u-l*a;return h>0&&c<0||h<0&&c>0}function bc(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=[];for(let o=0;o<r[i].length;o++){const a=cS(r[i][o],t);Ts(e,a),s.push(a)}n.push(s)}return n}function Lm(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=bc(r[i],e,t);n.push(s)}return n}function Fm(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=n*.5;let s=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;s===0&&(s=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=s}Ts(e,r)}function vS(r){r[0]=r[1]=1/0,r[2]=r[3]=-1/0}function nf(r,e,t,n){const i=Math.pow(2,n.z)*Er,s=[n.x*Er,n.y*Er],o=[];for(const a of r)for(const l of a){const u=[l.x+s[0],l.y+s[1]];Fm(u,e,t,i),o.push(u)}return o}function sf(r,e,t,n){const i=Math.pow(2,n.z)*Er,s=[n.x*Er,n.y*Er],o=[];for(const a of r){const l=[];for(const u of a){const h=[u.x+s[0],u.y+s[1]];Ts(e,h),l.push(h)}o.push(l)}if(e[2]-e[0]<=i/2){vS(e);for(const a of o)for(const l of a)Fm(l,e,t,i)}return o}function ES(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const s=bc(e.coordinates,n,i),o=nf(r.geometry(),t,n,i);if(!is(t,n))return!1;for(const a of o)if(!xi(a,s))return!1}if(e.type==="MultiPolygon"){const s=Lm(e.coordinates,n,i),o=nf(r.geometry(),t,n,i);if(!is(t,n))return!1;for(const a of o)if(!_S(a,s))return!1}return!0}function wS(r,e){const t=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=r.canonicalID();if(e.type==="Polygon"){const s=bc(e.coordinates,n,i),o=sf(r.geometry(),t,n,i);if(!is(t,n))return!1;for(const a of o)if(!Cm(a,s))return!1}if(e.type==="MultiPolygon"){const s=Lm(e.coordinates,n,i),o=sf(r.geometry(),t,n,i);if(!is(t,n))return!1;for(const a of o)if(!bS(a,s))return!1}return!0}class vn{constructor(e,t){this.type=fe,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(rs(e[1])){const n=e[1];if(n.type==="FeatureCollection"){const i=[];for(const s of n.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new vn(n,s)}}else if(n.type==="Feature"){const i=n.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new vn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new vn(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return ES(e,this.geometries);if(e.geometryType()==="LineString")return wS(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Mm{constructor(e=[],t=(n,i)=>n<i?-1:n>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(n(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=(e<<1)+1;const a=o+1;if(a<this.length&&n(t[a],t[o])<0&&(o=a),n(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function TS(r,e){if(r.length<=1)return[r];const n=[];let i,s;for(const o of r){const a=SS(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&n.push(i),i=[o]):i.push(o))}return i&&n.push(i),n}function SS(r){let e=0;for(let t=0,n=r.length,i=n-1,s,o;t<n;i=t++)s=r[t],o=r[i],e+=(o.x-s.x)*(s.y+o.y);return e}const RS=6378.137,of=1/298.257223563,af=of*(2-of),lf=Math.PI/180;class xc{constructor(e){const t=lf*RS*1e3,n=Math.cos(e*lf),i=1/(1-af*(1-n*n)),s=Math.sqrt(i);this.kx=t*s*n,this.ky=t*s*i*(1-af)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n=1/0,i,s,o,a;for(let l=0;l<e.length-1;l++){let u=e[l][0],h=e[l][1],c=this.wrap(e[l+1][0]-u)*this.kx,f=(e[l+1][1]-h)*this.ky,m=0;(c!==0||f!==0)&&(m=(this.wrap(t[0]-u)*this.kx*c+(t[1]-h)*this.ky*f)/(c*c+f*f),m>1?(u=e[l+1][0],h=e[l+1][1]):m>0&&(u+=c/this.kx*m,h+=f/this.ky*m)),c=this.wrap(t[0]-u)*this.kx,f=(t[1]-h)*this.ky;const p=c*c+f*f;p<n&&(n=p,i=u,s=h,o=l,a=m)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Il=100,Cl=50;function Om(r,e){return e[0]-r[0]}function bo(r){return r[1]-r[0]+1}function Dr(r,e){return r[1]>=r[0]&&r[1]<e}function Ll(r,e){if(r[0]>r[1])return[null,null];const t=bo(r);if(e){if(t===2)return[r,null];const i=Math.floor(t/2);return[[r[0],r[0]+i],[r[0]+i,r[1]]]}if(t===1)return[r,null];const n=Math.floor(t/2)-1;return[[r[0],r[0]+n],[r[0]+n+1,r[1]]]}function Fl(r,e){if(!Dr(e,r.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)Ts(t,r[n]);return t}function Ml(r){const e=[1/0,1/0,-1/0,-1/0];for(const t of r)for(const n of t)Ts(e,n);return e}function uf(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function vc(r,e,t){if(!uf(r)||!uf(e))return NaN;let n=0,i=0;return r[2]<e[0]&&(n=e[0]-r[2]),r[0]>e[2]&&(n=r[0]-e[2]),r[1]>e[3]&&(i=r[1]-e[3]),r[3]<e[1]&&(i=e[1]-r[3]),t.distance([0,0],[n,i])}function mn(r,e,t){const n=t.pointOnLine(e,r);return t.distance(r,n.point)}function Ec(r,e,t,n,i){const s=Math.min(mn(r,[t,n],i),mn(e,[t,n],i)),o=Math.min(mn(t,[r,e],i),mn(n,[r,e],i));return Math.min(s,o)}function AS(r,e,t,n,i){if(!(Dr(e,r.length)&&Dr(n,t.length)))return 1/0;let o=1/0;for(let a=e[0];a<e[1];++a){const l=r[a],u=r[a+1];for(let h=n[0];h<n[1];++h){const c=t[h],f=t[h+1];if(ha(l,u,c,f))return 0;o=Math.min(o,Ec(l,u,c,f,i))}}return o}function PS(r,e,t,n,i){if(!(Dr(e,r.length)&&Dr(n,t.length)))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let l=n[0];l<=n[1];++l)if(o=Math.min(o,i.distance(r[a],t[l])),o===0)return o;return o}function IS(r,e,t){if(xi(r,e,!0))return 0;let n=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(n=Math.min(n,mn(r,[o,s],t)),n===0))return n;const a=t.pointOnLine(i,r);if(n=Math.min(n,t.distance(r,a.point)),n===0)return n}return n}function CS(r,e,t,n){if(!Dr(e,r.length))return NaN;for(let s=e[0];s<=e[1];++s)if(xi(r[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=r[s],a=r[s+1];for(const l of t)for(let u=0,h=l.length,c=h-1;u<h;c=u++){const f=l[c],m=l[u];if(ha(o,a,f,m))return 0;i=Math.min(i,Ec(o,a,f,m,n))}}return i}function cf(r,e){for(const t of r)for(const n of t)if(xi(n,e,!0))return!0;return!1}function LS(r,e,t,n=1/0){const i=Ml(r),s=Ml(e);if(n!==1/0&&vc(i,s,t)>=n)return n;if(is(i,s)){if(cf(r,e))return 0}else if(cf(e,r))return 0;let o=1/0;for(const a of r)for(let l=0,u=a.length,h=u-1;l<u;h=l++){const c=a[h],f=a[l];for(const m of e)for(let p=0,y=m.length,b=y-1;p<y;b=p++){const E=m[b],v=m[p];if(ha(c,f,E,v))return 0;o=Math.min(o,Ec(c,f,E,v,t))}}return o}function hf(r,e,t,n,i,s){if(!s)return;const o=vc(Fl(n,s),i,t);o<e&&r.push([o,s,[0,0]])}function Us(r,e,t,n,i,s,o){if(!s||!o)return;const a=vc(Fl(n,s),Fl(i,o),t);a<e&&r.push([a,s,o])}function xo(r,e,t,n,i=1/0){let s=Math.min(n.distance(r[0],t[0][0]),i);if(s===0)return s;const o=new Mm([[0,[0,r.length-1],[0,0]]],Om),a=Ml(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],h=e?Cl:Il;if(bo(u)<=h){if(!Dr(u,r.length))return NaN;if(e){const c=CS(r,u,t,n);if(isNaN(c)||c===0)return c;s=Math.min(s,c)}else for(let c=u[0];c<=u[1];++c){const f=IS(r[c],t,n);if(s=Math.min(s,f),s===0)return 0}}else{const c=Ll(u,e);hf(o,s,n,r,a,c[0]),hf(o,s,n,r,a,c[1])}}return s}function vo(r,e,t,n,i,s=1/0){let o=Math.min(s,i.distance(r[0],t[0]));if(o===0)return o;const a=new Mm([[0,[0,r.length-1],[0,t.length-1]]],Om);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],h=l[2],c=e?Cl:Il,f=n?Cl:Il;if(bo(u)<=c&&bo(h)<=f){if(!Dr(u,r.length)&&Dr(h,t.length))return NaN;let m;if(e&&n)m=AS(r,u,t,h,i),o=Math.min(o,m);else if(e&&!n){const p=r.slice(u[0],u[1]+1);for(let y=h[0];y<=h[1];++y)if(m=mn(t[y],p,i),o=Math.min(o,m),o===0)return o}else if(!e&&n){const p=t.slice(h[0],h[1]+1);for(let y=u[0];y<=u[1];++y)if(m=mn(r[y],p,i),o=Math.min(o,m),o===0)return o}else m=PS(r,u,t,h,i),o=Math.min(o,m)}else{const m=Ll(u,e),p=Ll(h,n);Us(a,o,i,r,t,m[0],p[0]),Us(a,o,i,r,t,m[0],p[1]),Us(a,o,i,r,t,m[1],p[0]),Us(a,o,i,r,t,m[1],p[1])}}return o}function FS(r,e){const t=r.geometry(),n=t.flat().map(o=>_c([o.x,o.y],r.canonical));if(t.length===0)return NaN;const i=new xc(n[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,vo(n,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,vo(n,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,xo(n,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function MS(r,e){const t=r.geometry(),n=t.flat().map(o=>_c([o.x,o.y],r.canonical));if(t.length===0)return NaN;const i=new xc(n[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,vo(n,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,vo(n,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,xo(n,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function OS(r,e){const t=r.geometry();if(t.length===0||t[0].length===0)return NaN;const n=TS(t).map(o=>o.map(a=>a.map(l=>_c([l.x,l.y],r.canonical)))),i=new xc(n[0][0][0][1]);let s=1/0;for(const o of e)for(const a of n){switch(o.type){case"Point":s=Math.min(s,xo([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,xo(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,LS(a,o.coordinates,i,s));break}if(s===0)return s}return s}function Xa(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class En{constructor(e,t){this.type=X,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(rs(e[1])){const n=e[1];if(n.type==="FeatureCollection")return new En(n,n.features.map(i=>Xa(i.geometry)).flat());if(n.type==="Feature")return new En(n,Xa(n.geometry));if("type"in n&&"coordinates"in n)return new En(n,Xa(n))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return FS(e,this.geometries);if(e.geometryType()==="LineString")return MS(e,this.geometries);if(e.geometryType()==="Polygon")return OS(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ss{constructor(e){this.type=le,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return n==null?t.error("Global state property must be defined."):typeof n!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ss(n)}evaluate(e){var t;const n=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!n||Object.keys(n).length===0?null:Tm(n,this.key)}eachChild(){}outputDefined(){return!1}}const fa={"==":iS,"!=":sS,">":aS,"<":oS,">=":uS,"<=":lS,array:Kt,at:cc,boolean:Kt,case:dc,coalesce:ns,collator:ca,format:mc,image:gc,in:hc,"index-of":yo,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:yc,let:aa,literal:si,match:fc,number:Kt,"number-format":pc,object:Kt,slice:_o,step:ua,string:Kt,"to-boolean":Zr,"to-color":Zr,"to-number":Zr,"to-string":Zr,var:la,within:vn,distance:En,"global-state":Ss};class Dt{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=Dt.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,h]of a){l=new oa(t.registry,Eo,t.path,null,t.scope);const c=[];let f=!1;for(let m=1;m<e.length;m++){const p=e[m],y=Array.isArray(u)?u[m-1]:u.type,b=l.parse(p,1+c.length,y);if(!b){f=!0;break}c.push(b)}if(!f){if(Array.isArray(u)&&u.length!==c.length){l.error(`Expected ${u.length} arguments, but found ${c.length} instead.`);continue}for(let m=0;m<c.length;m++){const p=Array.isArray(u)?u[m]:u.type,y=c[m];l.concat(m+1).checkSubtype(p,y.type)}if(l.errors.length===0)return new Dt(n,s,h,c)}}if(a.length===1)t.errors.push(...l.errors);else{const h=(a.length?a:o).map(([f])=>DS(f)).join(" | "),c=[];for(let f=1;f<e.length;f++){const m=t.parse(e[f],1+c.length);if(!m)return null;c.push(He(m.type))}t.error(`Expected arguments of type ${h}, but found (${c.join(", ")}) instead.`)}return null}static register(e,t){Dt.definitions=t;for(const n in t)e[n]=Dt}}function ff(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const s=i?i.evaluate(r):1,o=Sm(e,t,n,s);if(o)throw new Ye(o);return new Oe(e/255,t/255,n/255,s,!1)}function df(r,e){return r in e}function qa(r,e){const t=e[r];return typeof t>"u"?null:t}function NS(r,e,t,n){for(;t<=n;){const i=t+n>>1;if(e[i]===r)return!0;e[i]>r?n=i-1:t=i+1}return!1}function un(r){return{type:r}}Dt.register(fa,{error:[IT,[me],(r,[e])=>{throw new Ye(e.evaluate(r))}],typeof:[me,[le],(r,[e])=>He(rt(e.evaluate(r)))],"to-rgba":[Ot(X,4),[br],(r,[e])=>{const[t,n,i,s]=e.evaluate(r).rgb;return[t*255,n*255,i*255,s]}],rgb:[br,[X,X,X],ff],rgba:[br,[X,X,X,X],ff],has:{type:fe,overloads:[[[me],(r,[e])=>df(e.evaluate(r),r.properties())],[[me,_n],(r,[e,t])=>df(e.evaluate(r),t.evaluate(r))]]},get:{type:le,overloads:[[[me],(r,[e])=>qa(e.evaluate(r),r.properties())],[[me,_n],(r,[e,t])=>qa(e.evaluate(r),t.evaluate(r))]]},"feature-state":[le,[me],(r,[e])=>qa(e.evaluate(r),r.featureState||{})],properties:[_n,[],r=>r.properties()],"geometry-type":[me,[],r=>r.geometryType()],id:[le,[],r=>r.id()],zoom:[X,[],r=>r.globals.zoom],"heatmap-density":[X,[],r=>r.globals.heatmapDensity||0],elevation:[X,[],r=>r.globals.elevation||0],"line-progress":[X,[],r=>r.globals.lineProgress||0],accumulated:[le,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[X,un(X),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[X,un(X),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:X,overloads:[[[X,X],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[X],(r,[e])=>-e.evaluate(r)]]},"/":[X,[X,X],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[X,[X,X],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[X,[],()=>Math.LN2],pi:[X,[],()=>Math.PI],e:[X,[],()=>Math.E],"^":[X,[X,X],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[X,[X],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[X,[X],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[X,[X],(r,[e])=>Math.log(e.evaluate(r))],log2:[X,[X],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[X,[X],(r,[e])=>Math.sin(e.evaluate(r))],cos:[X,[X],(r,[e])=>Math.cos(e.evaluate(r))],tan:[X,[X],(r,[e])=>Math.tan(e.evaluate(r))],asin:[X,[X],(r,[e])=>Math.asin(e.evaluate(r))],acos:[X,[X],(r,[e])=>Math.acos(e.evaluate(r))],atan:[X,[X],(r,[e])=>Math.atan(e.evaluate(r))],min:[X,un(X),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[X,un(X),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[X,[X],(r,[e])=>Math.abs(e.evaluate(r))],round:[X,[X],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[X,[X],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[X,[X],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[fe,[me,le],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[fe,[le],(r,[e])=>r.id()===e.value],"filter-type-==":[fe,[me],(r,[e])=>r.geometryType()===e.value],"filter-<":[fe,[me,le],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[fe,[le],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[fe,[me,le],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[fe,[le],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[fe,[me,le],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[fe,[le],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[fe,[me,le],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[fe,[le],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[fe,[le],(r,[e])=>e.value in r.properties()],"filter-has-id":[fe,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[fe,[Ot(me)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[fe,[Ot(le)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[fe,[me,Ot(le)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[fe,[me,Ot(le)],(r,[e,t])=>NS(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:fe,overloads:[[[fe,fe],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[un(fe),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:fe,overloads:[[[fe,fe],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[un(fe),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[fe,[fe],(r,[e])=>!e.evaluate(r)],"is-supported-script":[fe,[me],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return t?t(e.evaluate(r)):!0}],upcase:[me,[me],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[me,[me],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[me,un(le),(r,e)=>e.map(t=>Bi(t.evaluate(r))).join("")],"resolved-locale":[me,[ta],(r,[e])=>e.evaluate(r).resolvedLocale()]});function DS(r){return Array.isArray(r)?`(${r.map(He).join(", ")})`:`(${He(r.type)}...)`}function Eo(r){if(r instanceof la)return Eo(r.boundExpression);if(r instanceof Dt&&r.name==="error")return!1;if(r instanceof ca)return!1;if(r instanceof vn)return!1;if(r instanceof En)return!1;if(r instanceof Ss)return!1;const e=r instanceof Zr||r instanceof Kt;let t=!0;return r.eachChild(n=>{e?t=t&&Eo(n):t=t&&n instanceof si}),t?wc(r)&&Sc(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function wc(r){if(r instanceof Dt){if(r.name==="get"&&r.args.length===1)return!1;if(r.name==="feature-state")return!1;if(r.name==="has"&&r.args.length===1)return!1;if(r.name==="properties"||r.name==="geometry-type"||r.name==="id")return!1;if(/^filter-/.test(r.name))return!1}if(r instanceof vn||r instanceof En)return!1;let e=!0;return r.eachChild(t=>{e&&!wc(t)&&(e=!1)}),e}function Tc(r){if(r instanceof Dt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(t=>{e&&!Tc(t)&&(e=!1)}),e}function Sc(r,e){if(r instanceof Dt&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(n=>{t&&!Sc(n,e)&&(t=!1)}),t}function Ol(r){return{result:"success",value:r}}function jn(r){return{result:"error",value:r}}function US(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function kS(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function zS(r){return!!r.expression&&r.expression.interpolated}function Nm(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&rt(r)===_n}class BS{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Rm,this._defaultValue=t?VS(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new Ye(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function GS(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in fa}function Dm(r,e){const t=new oa(fa,Eo,[],e?jS(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Ol(new BS(n,e)):jn(t.errors)}class pf{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Tc(t.expression),this.globalStateRefs=da(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}}class mf{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Tc(t.expression),this.globalStateRefs=da(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}interpolationFactor(e,t,n){return this.interpolationType?vr.interpolationFactor(this.interpolationType,e,t,n):0}}function $S(r,e){const t=Dm(r,e);if(t.result==="error")return t;const n=t.value.expression,i=wc(n);if(!i&&!US(e))return jn([new mr("","data expressions not supported")]);const s=Sc(n,["zoom"]);if(!s&&!kS(e))return jn([new mr("","zoom expressions not supported")]);const o=Xs(n);if(!o&&!s)return jn([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof mr)return jn([o]);if(o instanceof vr&&!zS(e))return jn([new mr("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Ol(i?new pf("constant",t.value):new pf("source",t.value));const a=o instanceof vr?o.interpolation:void 0;return Ol(i?new mf("camera",t.value,o.labels,a):new mf("composite",t.value,o.labels,a))}function Xs(r){let e=null;if(r instanceof aa)e=Xs(r.result);else if(r instanceof ns){for(const t of r.args)if(e=Xs(t),e)break}else(r instanceof ua||r instanceof vr)&&r.input instanceof Dt&&r.input.name==="zoom"&&(e=r);return e instanceof mr||r.eachChild(t=>{const n=Xs(t);n instanceof mr?e=n:!e&&n?e=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function da(r,e=new Set){return r instanceof Ss&&e.add(r.key),r.eachChild(t=>{da(t,e)}),e}function jS(r){const e={color:br,string:me,number:X,enum:me,boolean:fe,formatted:ra,padding:na,numberArray:ia,colorArray:Qi,projectionDefinition:ea,resolvedImage:ws,variableAnchorOffsetCollection:sa};return r.type==="array"?Ot(e[r.value]||le,r.length):e[r.type]}function VS(r){if(r.type==="color"&&Nm(r.default))return new Oe(0,0,0,0);switch(r.type){case"color":return Oe.parse(r.default)||null;case"padding":return Qt.parse(r.default)||null;case"numberArray":return er.parse(r.default)||null;case"colorArray":return Nt.parse(r.default)||null;case"variableAnchorOffsetCollection":return xr.parse(r.default)||null;case"projectionDefinition":return Yt.parse(r.default)||null;default:return r.default===void 0?null:r.default}}function Um(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Um(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const XS={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qS(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Um(r)||(r=wo(r));const e=Dm(r,XS);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=km(r);return{filter:(n,i,s)=>e.value.evaluate(n,i,{},s),needGeometry:t,getGlobalStateRefs:()=>da(e.value.expression)}}}function WS(r,e){return r<e?-1:r>e?1:0}function km(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(km(r[e]))return!0;return!1}function wo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Wa(r[1],r[2],"=="):e==="!="?ks(Wa(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wa(r[1],r[2],e):e==="any"?HS(r.slice(1)):e==="all"?["all"].concat(r.slice(1).map(wo)):e==="none"?["all"].concat(r.slice(1).map(wo).map(ks)):e==="in"?gf(r[1],r.slice(2)):e==="!in"?ks(gf(r[1],r.slice(2))):e==="has"?yf(r[1]):e==="!has"?ks(yf(r[1])):!0}function Wa(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function HS(r){return["any"].concat(r.map(wo))}function gf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(WS)]]:["filter-in-small",r,["literal",e]]}}function yf(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function ks(r){return["!",r]}function ss(r){return typeof r=="object"?["literal",r]:r}function ZS(r,e){let t=r.stops;if(!t)return YS(r,e);const n=t&&typeof t[0][0]=="object",i=n||r.property!==void 0,s=n||!i;return t=t.map(o=>!i&&e.tokens&&typeof o[1]=="string"?[o[0],eR(o[1])]:[o[0],ss(o[1])]),n?KS(r,e,t):s?QS(r,e,t):Nl(r,e,t)}function YS(r,e){const t=["get",r.property];if(r.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,r.default];{const n=[e.type==="color"?"to-color":e.type,t,ss(r.default)];return e.type==="array"&&n.splice(1,0,e.value,e.length||null),n}}function Rc(r){switch(r.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function KS(r,e,t){const n={},i={},s=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;n[u]===void 0&&(n[u]={zoom:u,type:r.type,property:r.property,default:r.default},i[u]=[],s.push(u)),i[u].push([l[0].value,l[1]])}if(Pc({},e)==="exponential"){const a=[Rc(r),["linear"],["zoom"]];for(const l of s){const u=Nl(n[l],e,i[l]);Yn(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const u=Nl(n[l],e,i[l]);Yn(a,l,u,!0)}return Ac(a),a}}function JS(r,e){if(r!==void 0)return r;if(e!==void 0)return e}function _f(r,e){const t=ss(JS(r.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function Nl(r,e,t){const n=Pc(r,e),i=["get",r.property];if(n==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",i,o[0]],o[1]);return s.push(_f(r,e)),s}else if(n==="categorical"){const s=["match",i];for(const o of t)Yn(s,o[0],o[1],!1);return s.push(_f(r,e)),s}else if(n==="interval"){const s=["step",["number",i]];for(const o of t)Yn(s,o[0],o[1],!0);return Ac(s),r.default===void 0?s:["case",["==",["typeof",i],"number"],s,ss(r.default)]}else if(n==="exponential"){const s=r.base!==void 0?r.base:1,o=[Rc(r),s===1?["linear"]:["exponential",s],["number",i]];for(const a of t)Yn(o,a[0],a[1],!1);return r.default===void 0?o:["case",["==",["typeof",i],"number"],o,ss(r.default)]}else throw new Error(`Unknown property function type ${n}`)}function QS(r,e,t,n=["zoom"]){const i=Pc(r,e);let s,o=!1;if(i==="interval")s=["step",n],o=!0;else if(i==="exponential"){const a=r.base!==void 0?r.base:1;s=[Rc(r),a===1?["linear"]:["exponential",a],n]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)Yn(s,a[0],a[1],o);return Ac(s),s}function Ac(r){r[0]==="step"&&r.length===3&&(r.push(0),r.push(r[3]))}function Yn(r,e,t,n){r.length>3&&e===r[r.length-2]||(n&&r.length===2||r.push(e),r.push(t))}function Pc(r,e){return r.type?r.type:e.expression.interpolated?"exponential":"interval"}function eR(r){const e=["concat"],t=/{([^{}]+)}/g;let n=0;for(let i=t.exec(r);i!==null;i=t.exec(r)){const s=r.slice(n,t.lastIndex-i[0].length);n=t.lastIndex,s.length>0&&e.push(s),e.push(["get",i[1]])}if(e.length===1)return r;if(n<r.length)e.push(r.slice(n));else if(e.length===2)return["to-string",e[1]];return e}const tR=RT;var bf={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Ri=" ",xf=/(italic|oblique)$/i,vf={};function Dl(r,e,t){var n=vf[r];if(!n){Array.isArray(r)||(r=[r]);for(var i=400,s="normal",o=[],a,l,u=0,h=r.length;u<h;++u){var c=r[u],f=c.split(" "),m=f[f.length-1].toLowerCase();m=="normal"||m=="italic"||m=="oblique"?(s=l?s:m,l=!0,f.pop(),m=f[f.length-1].toLowerCase()):xf.test(m)&&(m=m.replace(xf,""),s=l?s:f[f.length-1].replace(m,""),l=!0);for(var p in bf){var y=f.length>1?f[f.length-2].toLowerCase():"";if(m==p||m==p.replace("-","")||y+"-"+m==p){i=a?i:bf[p],f.pop(),y&&p.startsWith(y)&&f.pop();break}}!a&&typeof m=="number"&&(i=m,a=!0);var b=f.join(Ri).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");b.indexOf(Ri)!==-1&&(b='"'+b+'"'),o.push(b)}n=vf[r]=[s,i,o]}return n[0]+Ri+n[1]+Ri+e+"px"+(t?"/"+t:"")+Ri+n[2]}const zm="https://api.mapbox.com";function Ic(r){const e="mapbox://";return r.indexOf(e)!==0?"":r.slice(e.length)}function rR(r,e,t){if(typeof r=="string")return[{id:"default",url:Ef(r,e,t)}];for(const n of r)n.url=Ef(n.url,e,t);return r}function Ef(r,e,t){const n=Ic(r);if(!n)return decodeURI(new URL(r,t).href);const i="sprites/";if(n.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${r}`);const s=n.slice(i.length);return`${zm}/styles/v1/${s}/sprite?access_token=${e}`}function To(r,e){const t=Ic(r);if(!t)return decodeURI(new URL(r,location.href).href);const n="styles/";if(t.indexOf(n)!==0)throw new Error(`unexpected style url: ${r}`);const i=t.slice(n.length);return`${zm}/styles/v1/${i}?&access_token=${e}`}const nR=["a","b","c","d"];function qs(r,e,t,n){const i=new URL(r,n||location.href),s=Ic(r);if(!s)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`]}return nR.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const Jt=Object.freeze({}),wf={},Tf={};let iR=0;function Cc(r){return r.id||(r.id=iR++),r.id}function sR(r,e){return Cc(r)+"."+Te(e)}function Bm(r){let e=wf[r.id];return e||(e={},wf[Cc(r)]=e),e}function oR(r){let e=Tf[r.id];return e||(e={},Tf[Cc(r)]=e),e}function Ha(r){return r*Math.PI/180}const wr=function(){const r=[];for(let e=78271.51696402048;r.length<=24;e/=2)r.push(e);return r}();function pa(r,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(r,e);const t=document.createElement("canvas");return t.width=r,t.height=e,t}function Lc(r,e){let t=0;const n=e.length;for(;t<n;++t)if(e[t]<r&&t+1<n){const s=e[t]/e[t+1];return t+Math.log(e[t]/r)/Math.log(s)}return n-1}function Oi(r,e){const t=Math.floor(r),n=Math.pow(2,r-t);return e[t]/n}const Dn={};function oi(r,e,t={},n){if(e in Dn)return n&&(n.url=Dn[e][0].url),Dn[e][1];const i=t.transformRequest&&t.transformRequest(e,r)||e,s=function(l){return delete Dn[e],Promise.reject(new Error("Error fetching source "+e))},o=function(l){return delete Dn[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=Wi(()=>i).then(l=>l instanceof Response?(n&&(n.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),n&&(n.url=l.url),fetch(l).then(o).catch(s))).catch(s);return Dn[e]=[i,a],a}function Gm(r,e){if(typeof r=="string")if(r.trim().startsWith("{"))try{const t=JSON.parse(r);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return r=To(r,e.accessToken),oi("Style",r,e);else return Promise.resolve(r)}const Sf={};function $m(r,e,t={}){const n=[e,JSON.stringify(r)].toString();let i=Sf[n];if(!i||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof my)a.setLoader((h,c,f)=>{const m=function(p){p.arrayBuffer().then(y=>{const E=a.getFormat().readFeatures(y,{extent:h,featureProjection:f});a.setFeatures(E)})};Wi(()=>u).then(p=>{if(p instanceof Response)return m(p);fetch(p).then(m).catch(y=>a.setState(ue.ERROR))}).catch(p=>a.setState(ue.ERROR))});else{const h=a.getImage();Wi(()=>u).then(c=>{if(typeof c=="string"){h.src=c;return}const f=m=>m.blob().then(p=>{const y=URL.createObjectURL(p);h.addEventListener("load",()=>URL.revokeObjectURL(y)),h.addEventListener("error",()=>URL.revokeObjectURL(y)),h.src=y});if(c instanceof Response)return f(c);fetch(c).then(f).catch(m=>a.setState(ue.ERROR))}).catch(c=>a.setState(ue.ERROR))}});const o=r.url;if(o&&!r.tiles){const a=qs(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},r,{url:void 0,tiles:a}),tileLoadFunction:s});else{const l={};i=oi("Source",a[0],t,l).then(function(u){return u.tiles=u.tiles.map(function(h){return u.scheme==="tms"&&(h=h.replace("{y}","{-y}")),qs(h,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else r.tiles?(r=Object.assign({},r,{tiles:r.tiles.map(function(a){return r.scheme==="tms"&&(a=a.replace("{y}","{-y}")),qs(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},r),tileLoadFunction:s})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));Sf[n]=i}return i}function Rf(r,e,t,n){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],s=pa(i[0],i[1]),o=s.getContext("2d");o.drawImage(r,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,i[0],i[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;const l=a.data;for(let u=0,h=a.width;u<h;++u)for(let c=0,f=a.height;c<f;++c){const m=(c*h+u)*4;l[m+3]>0&&o.arc(u,c,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function aR(r,e,t){const n=Math.max(0,Math.min(1,(t-r)/(e-r)));return n*n*(3-2*n)}function Af(r,e,t){const n=pa(e.width,e.height),i=n.getContext("2d");i.drawImage(r,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let u=0,h=s.height;u<h;++u){const c=(u*l+a)*4,f=o[c+3]/255,m=.75,p=.1,y=aR(m-p,m+p,f);y>0?(o[c+0]=Math.round(255*t.r*y),o[c+1]=Math.round(255*t.g*y),o[c+2]=Math.round(255*t.b*y),o[c+3]=Math.round(255*y)):o[c+3]=0}return i.putImageData(s,0,0),n}const lR=Array(256).join("");function Ul(r,e){if(e>=.05){let t="";const n=r.split(`
`),i=lR.slice(0,Math.round(e/.1));for(let s=0,o=n.length;s<o;++s)s>0&&(t+=`
`),t+=n[s].split("").join(i);return t}return r}let Za;function jm(){return Za||(Za=pa(1,1).getContext("2d")),Za}function cn(r,e){return jm().measureText(r).width+(r.length-1)*e}const So={};gy.on("propertychange",()=>{for(const r in So)delete So[r]});function kl(r,e,t,n){if(r.indexOf(`
`)!==-1){const o=r.split(`
`),a=[];for(let l=0,u=o.length;l<u;++l)a.push(kl(o[l],e,t,n));return a.join(`
`)}const i=t+","+e+","+r+","+n;let s=So[i];if(!s){const o=r.split(" ");if(o.length>1){const a=jm();a.font=e;const u=a.measureText("M").width*t;let h="";const c=[];for(let f=0,m=o.length;f<m;++f){const p=o[f],y=h+(h?" ":"")+p;cn(y,n)<=u?h=y:(h&&c.push(h),h=p)}h&&c.push(h);for(let f=0,m=c.length;f<m&&m>1;++f){const p=c[f];if(cn(p,n)<u*.35){const y=f>0?cn(c[f-1],n):1/0,b=f<m-1?cn(c[f+1],n):1/0;c.splice(f,1),m-=1,y<b?(c[f-1]+=" "+p,f-=1):c[f]=p+" "+c[f]}}for(let f=0,m=c.length-1;f<m;++f){const p=c[f],y=c[f+1];if(cn(p,n)>u*.7&&cn(y,n)<u*.6){const b=p.split(" "),E=b.pop();cn(E,n)<u*.2&&(c[f]=b.join(" "),c[f+1]=E+" "+y),m-=1}}s=c.join(`
`)}else s=r;s=Ul(s,n),So[i]=s}return s}const uR=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],Pf={};function cR(r,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){let t;for(let n=0,i=r.length;n<i;++n){const s=r[n];if(s in Pf)continue;Pf[s]=!0;const a=Dl(s,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let n=0,i=t.length;n<i;++n){const s=t[n],o=s[0];if(uR.includes(o))continue;const a=s[1],l=s[2];if(!(await document.fonts.load(`${l} ${a} 16px "${o}"`)).some(h=>h.family.replace(/^['"]|['"]$/g,"").toLowerCase()===o.toLowerCase()&&h.weight==a&&h.style===l)){const h=e.replace("{font-family}",o.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",o.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+h+'"]')){const c=document.createElement("link");c.href=h,c.rel="stylesheet",document.head.appendChild(c)}}}})(),r}const hR={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},fR={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},dR=function(r,e){const t=$S(r,e);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return t.value},zt={zoom:0,distanceFromCenter:0};Dt.register(fa,{...Dt.definitions,pitch:[{kind:"number"},[],r=>zt.pitch||90],"distance-from-center":[{kind:"number"},[],r=>zt.distanceFromCenter||0]});let zs,Ya;function Q(r,e,t,n,i,s){const o=r.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[o]||(i[o]={});const a=i[o];if(!a[t]){let l=(r[e]||Jt)[t];const u=tR[`${e}_${r.type}`][t];l===void 0&&(l=u.default);let h=GS(l);if(!h&&Nm(l)&&(l=ZS(l,u),h=!0),h){const c=dR(l,u);a[t]=c.evaluate.bind(c)}else u.type=="color"&&(l=Oe.parse(l)),a[t]=function(){return l}}return a[t](zt,n,s)}function If(r,e,t,n){return Q(r,"layout",`${t}-allow-overlap`,e,n)?Q(r,"layout",`${t}-ignore-placement`,e,n)?"none":"obstacle":"declutter"}function pR(r,e,t,n){if(n||console.warn("No filterCache provided to evaluateFilter()"),!(r in n))try{n[r]=qS(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),n[r]=function(){return!1}}return n[r](zt,t)}function jr(r,e){if(r){if(r.a===0||e===0)return;const t=r.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(r.r*255/t)+","+Math.round(r.g*255/t)+","+Math.round(r.b*255/t)+","+t*e+")"}return r}const mR=/\{[^{}}]*\}/g;function Ka(r,e){return r.replace(mR,function(t){return e[t.slice(1,-1)]||""})}function Cf(r,e){let t=r.split(":")[0];return t===r&&(t="default"),e[t]}const gR={};function yR(r,e,t,n=wr,i=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");gR[sR(e,r)]=Array.from(arguments);const l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(const T in s){const R=s[T];Wi(()=>R).then(async C=>{let D;if(typeof Image<"u"){const U=new Image;if(typeof C=="string")U.crossOrigin="anonymous",U.src=C;else{let M;C instanceof Request?M=await fetch(C):C instanceof Response&&(M=C);const z=await M.blob();D=URL.createObjectURL(z),U.src=D}U.addEventListener("load",function M(){U.removeEventListener("load",M),l[T]={image:U,size:[U.width,U.height]},r.changed(),D&&URL.revokeObjectURL(D)}),U.addEventListener("error",function M(){URL.revokeObjectURL(D),U.removeEventListener("error",M)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const U=self;U.postMessage({action:"loadImage",src:C}),U.addEventListener("message",function(z){z.data.action==="imageLoaded"&&z.data.src===C&&(l[T]={image:z.data.image,size:[z.data.image.width,z.data.image.height]})})}})}const u=mm(e.layers),h={},c=[],f={},m={},p=Bm(e),y=oR(e);let b;for(let T=0,R=u.length;T<R;++T){const C=u[T],D=C.id;if(typeof t=="string"&&C.source==t||Array.isArray(t)&&t.indexOf(D)!==-1){const U=C["source-layer"];if(b){if(C.source!==b)throw new Error(`Layer "${D}" does not use source "${b}`)}else{b=C.source;const z=e.sources[b];if(!z)throw new Error(`Source "${b}" is not defined`);const q=z.type;if(q!=="vector"&&q!=="geojson")throw new Error(`Source "${b}" is not of type "vector" or "geojson", but "${q}"`)}let M=h[U];M||(M=[],h[U]=M),M.push({layer:C,index:T}),c.push(D)}}const E=new qr,v=new Wr,w=[],P=function(T,R,C){var k,O,N;const D=((N=(O=(k=r.getSource)==null?void 0:k.call(r))==null?void 0:O.format_)==null?void 0:N.layerName_)??"mvt:layer",U=T.getProperties(),M=h[U[D]];if(!M)return;let z=n.indexOf(R);z==-1&&(z=Lc(R,n)),zt.zoom=z,zt.distanceFromCenter=0;const q=T.getGeometry(),d=hR[q.getType()],g=r.get("map");if(g&&g instanceof nu&&d===1){const G=g.getSize();if(G){const Y=g.getView().getCenter(),Z=yr(q.getExtent());zt.distanceFromCenter=yy(Y,Z)/R/G[1]}}const _={id:T.getId(),properties:U,type:d},x=r.get("mapbox-featurestate")[T.getId()];let S=-1;for(let G=0,Y=M.length;G<Y;++G){const Z=M[G],B=Z.layer,re=B.id;if(C!==void 0&&C!==re)continue;const se=B.layout||Jt,oe=B.paint||Jt;if(se.visibility==="none"||"minzoom"in B&&z<B.minzoom||"maxzoom"in B&&z>=B.maxzoom)continue;const Fe=B.filter;if(!Fe||pR(re,Fe,_,y)){let pe,Ne,Be,De,Ge,H;const mt=Z.index;if(d==3&&(B.type=="fill"||B.type=="fill-extrusion"))if(Ne=Q(B,"paint",B.type+"-opacity",_,p,x),B.type+"-pattern"in oe){const Ze=Q(B,"paint",B.type+"-pattern",_,p,x);if(Ze){const qe=typeof Ze=="string"?Ka(Ze,U):Ze.toString(),$e=Cf(qe,l);if(i&&i[qe]&&$e){++S,H=w[S],(!H||!H.getFill()||H.getStroke()||H.getText())&&(H=new dr({fill:new Wr}),w[S]=H),Be=H.getFill(),H.setZIndex(mt);const Ue=qe+"."+Ne;let nt=m[Ue];if(!nt){const ve=i[qe],Pe=pa(ve.width,ve.height),st=Pe.getContext("2d");st.globalAlpha=Ne,st.drawImage($e.image,ve.x,ve.y,ve.width,ve.height,0,0,ve.width,ve.height),nt=st.createPattern(Pe,"repeat"),m[Ue]=nt}Be.setColor(nt)}}}else pe=jr(Q(B,"paint",B.type+"-color",_,p,x),Ne),B.type+"-outline-color"in oe&&(Ge=jr(Q(B,"paint",B.type+"-outline-color",_,p,x),Ne)),Ge||(Ge=pe),(pe||Ge)&&(++S,H=w[S],(!H||pe&&!H.getFill()||!pe&&H.getFill()||Ge&&!H.getStroke()||!Ge&&H.getStroke()||H.getText())&&(H=new dr({fill:pe?new Wr:void 0,stroke:Ge?new qr:void 0}),w[S]=H),pe&&(Be=H.getFill(),Be.setColor(pe)),Ge&&(De=H.getStroke(),De.setColor(Ge),De.setWidth(.5)),H.setZIndex(mt));if(d!=1&&B.type=="line"){"line-pattern"in oe?pe=void 0:pe=jr(Q(B,"paint","line-color",_,p,x),Q(B,"paint","line-opacity",_,p,x));const Ze=Q(B,"paint","line-width",_,p,x);pe&&Ze>0&&(++S,H=w[S],(!H||!H.getStroke()||H.getFill()||H.getText())&&(H=new dr({stroke:new qr}),w[S]=H),De=H.getStroke(),De.setLineCap(Q(B,"layout","line-cap",_,p,x)),De.setLineJoin(Q(B,"layout","line-join",_,p,x)),De.setMiterLimit(Q(B,"layout","line-miter-limit",_,p,x)),De.setColor(pe),De.setWidth(Ze),De.setLineDash(oe["line-dasharray"]?Q(B,"paint","line-dasharray",_,p,x).map(function(qe){return qe*Ze}):null),H.setZIndex(mt))}let ir=!1,Ae=null,kc=0,Ln,xt,ba;if((d==1||d==2)&&"icon-image"in se){const Ze=Q(B,"layout","icon-image",_,p,x);if(Ze){Ln=typeof Ze=="string"?Ka(Ze,U):Ze.toString();let qe;const $e=a?a(r,Ln):void 0,Ue=Cf(Ln,l);if(i&&i[Ln]&&Ue||$e){const nt=Q(B,"layout","icon-rotation-alignment",_,p,x);if(d==2){const ve=T.getGeometry();if(ve.getFlatMidpoint||ve.getFlatMidpoints){const Pe=ve.getExtent();if(Math.sqrt(Math.max(Math.pow((Pe[2]-Pe[0])/R,2),Math.pow((Pe[3]-Pe[1])/R,2)))>150){const ct=ve.getType()==="MultiLineString"?ve.getFlatMidpoints():ve.getFlatMidpoint();if(Ya||(zs=[NaN,NaN],Ya=new rd("Point",zs,[],2,{},void 0)),qe=Ya,zs[0]=ct[0],zs[1]=ct[1],Q(B,"layout","symbol-placement",_,p,x)==="line"&&nt==="map"){const Ht=ve.getStride(),vt=ve.getFlatCoordinates();for(let Ct=0,Ke=vt.length-Ht;Ct<Ke;Ct+=Ht){const gt=vt[Ct],Bt=vt[Ct+1],Je=vt[Ct+Ht],zr=vt[Ct+Ht+1],og=Math.min(gt,Je),ag=Math.max(gt,Je),va=ct[0],lg=ct[1],ug=(zr-Bt)*(va-gt)-(Je-gt)*(lg-Bt);if(Math.abs(ug)<.001&&va<=ag&&va>=og){kc=Math.atan2(Bt-zr,Je-gt);break}}}}}}if(d!==2||qe){const ve=Q(B,"layout","icon-size",_,p,x),Pe=oe["icon-color"]!==void 0?Q(B,"paint","icon-color",_,p,x):null;if(!Pe||Pe.a!==0){const st=Q(B,"paint","icon-halo-color",_,p,x),ct=Q(B,"paint","icon-halo-width",_,p,x);let sr=`${Ln}.${ve}.${ct}.${st}`;if(Pe!==null&&(sr+=`.${Pe}`),xt=f[sr],!xt){const Ht=If(B,_,"icon",p);let vt;"icon-offset"in se&&(vt=Q(B,"layout","icon-offset",_,p,x).slice(0),vt[0]*=ve,vt[1]*=-ve);let Ct=Pe?[Pe.r*255,Pe.g*255,Pe.b*255,Pe.a]:void 0;if($e){const Ke={color:Ct,rotateWithView:nt==="map",displacement:vt,declutterMode:Ht,scale:ve};typeof $e=="string"?Ke.src=$e:(Ke.img=$e,Ke.imgSize=[$e.width,$e.height]),xt=new Xc(Ke)}else{const Ke=i[Ln];let gt,Bt,Je;if(ct)Ke.sdf?(gt=Rf(Af(Ue.image,Ke,Pe||[0,0,0,1]),{x:0,y:0,width:Ke.width,height:Ke.height,pixelRatio:Ke.pixelRatio},ct,st),Ct=void 0):gt=Rf(Ue.image,Ke,ct,st);else{if(Ke.sdf&&!Ue.unSDFed){const zr=Af(Ue.image,{x:0,y:0,width:Ue.size[0],height:Ue.size[1]},{r:1,g:1,b:1});Ue.image=zr,Ue.unSDFed=!0}gt=Ue.image,Bt=[Ke.width,Ke.height],Je=[Ke.x,Ke.y]}xt=new Xc({color:Ct,img:gt,imgSize:Ue.size,size:Bt,offset:Je,rotateWithView:nt==="map",scale:ve/Ke.pixelRatio,displacement:vt,declutterMode:Ht})}f[sr]=xt}}xt&&(++S,H=w[S],(!H||!H.getImage()||H.getFill()||H.getStroke())&&(H=new dr,w[S]=H),H.setGeometry(qe),xt.setRotation(kc+Ha(Q(B,"layout","icon-rotate",_,p,x))),xt.setOpacity(Q(B,"paint","icon-opacity",_,p,x)),xt.setAnchor(fR[Q(B,"layout","icon-anchor",_,p,x)]),H.setImage(xt),Ae=H.getText(),H.setText(void 0),H.setZIndex(mt),ir=!0,ba=!1)}else ba=!0}}}if(d==1&&B.type==="circle"){++S,H=w[S],(!H||!H.getImage()||H.getFill()||H.getStroke())&&(H=new dr,w[S]=H);const Ze="circle-radius"in oe?Q(B,"paint","circle-radius",_,p,x):5,qe=jr(Q(B,"paint","circle-stroke-color",_,p,x),Q(B,"paint","circle-stroke-opacity",_,p,x)),$e=Q(B,"paint","circle-translate",_,p,x),Ue=jr(Q(B,"paint","circle-color",_,p,x),Q(B,"paint","circle-opacity",_,p,x)),nt=Q(B,"paint","circle-stroke-width",_,p,x),ve=Ze+"."+qe+"."+Ue+"."+nt+"."+$e[0]+"."+$e[1];xt=f[ve],xt||(xt=new ud({radius:Ze,displacement:[$e[0],-$e[1]],stroke:qe&&nt>0?new qr({width:nt,color:qe}):void 0,fill:Ue?new Wr({color:Ue}):void 0,declutterMode:"none"}),f[ve]=xt),H.setImage(xt),Ae=H.getText(),H.setText(void 0),H.setGeometry(void 0),H.setZIndex(mt),ir=!0}let ut,Ei,wi,kr,Ti,xa;if("text-field"in se){kr=Math.round(Q(B,"layout","text-size",_,p,x));const Ze=Q(B,"layout","text-font",_,p,x);wi=Q(B,"layout","text-line-height",_,p,x),Ei=Dl(o?o(Ze,e.metadata?e.metadata["ol:webfonts"]:void 0):Ze,kr,wi),Ei.includes("sans-serif")||(Ei+=",sans-serif"),Ti=Q(B,"layout","text-letter-spacing",_,p,x),xa=Q(B,"layout","text-max-width",_,p,x);const qe=Q(B,"layout","text-field",_,p,x);typeof qe=="object"&&qe.sections?qe.sections.length===1?ut=qe.toString():ut=qe.sections.reduce(($e,Ue,nt)=>{const ve=Ue.fontStack?Ue.fontStack.split(","):Ze,Pe=Dl(o?o(ve):ve,kr*(Ue.scale||1),wi);let st=Ue.text;if(st===`
`)return $e.push(`
`,""),$e;if(d==2)return $e.push(Ul(st,Ti),Pe),$e;st=kl(st,Pe,xa,Ti).split(`
`);for(let ct=0,sr=st.length;ct<sr;++ct)ct>0&&$e.push(`
`,""),$e.push(st[ct],Pe);return $e},[]):ut=Ka(qe,U).trim(),Ne=Q(B,"paint","text-opacity",_,p,x)}if(ut&&Ne&&!ba){ir||(++S,H=w[S],(!H||!H.getText()||H.getFill()||H.getStroke())&&(H=new dr,w[S]=H),H.setImage(void 0),H.setGeometry(void 0));const Ze=If(B,_,"text",p);H.getText()||H.setText(Ae),Ae=H.getText(),(!Ae||"getDeclutterMode"in Ae&&Ae.getDeclutterMode()!==Ze)&&(Ae=new tl({padding:[2,2,2,2],declutterMode:Ze}),H.setText(Ae));const qe=Q(B,"layout","text-transform",_,p,x);qe=="uppercase"?ut=Array.isArray(ut)?ut.map((Je,zr)=>zr%2?Je:Je.toUpperCase()):ut.toUpperCase():qe=="lowercase"&&(ut=Array.isArray(ut)?ut.map((Je,zr)=>zr%2?Je:Je.toLowerCase()):ut.toLowerCase());const $e=Array.isArray(ut)?ut:d==2?Ul(ut,Ti):kl(ut,Ei,xa,Ti);if(Ae.setText($e),Ae.setFont(Ei),Ae.setRotation(Ha(Q(B,"layout","text-rotate",_,p,x))),typeof Ae.setKeepUpright=="function"){const Je=Q(B,"layout","text-keep-upright",_,p,x);Ae.setKeepUpright(Je)}const Ue=Q(B,"layout","text-anchor",_,p,x),nt=ir||d==1?"point":Q(B,"layout","symbol-placement",_,p,x);let ve;if(nt==="line-center"?(Ae.setPlacement("line"),ve="center"):Ae.setPlacement(nt),nt==="line"&&typeof Ae.setRepeat=="function"){const Je=Q(B,"layout","symbol-spacing",_,p,x);Ae.setRepeat(Je*2)}Ae.setOverflow(nt==="point");let Pe=Q(B,"paint","text-halo-width",_,p,x);const st=Q(B,"layout","text-offset",_,p,x),ct=Q(B,"paint","text-translate",_,p,x);let sr=0,Ht=0;if(nt=="point"){ve="center",Ue.indexOf("left")!==-1?(ve="left",Ht=Pe):Ue.indexOf("right")!==-1&&(ve="right",Ht=-Pe);const Je=Q(B,"layout","text-rotation-alignment",_,p,x);Ae.setRotateWithView(Je=="map")}else Ae.setMaxAngle(Ha(Q(B,"layout","text-max-angle",_,p,x))*ut.length/$e.length),Ae.setRotateWithView(!1);Ae.setTextAlign(ve);let vt="middle";Ue.indexOf("bottom")==0?(vt="bottom",sr=-Pe-.5*(wi-1)*kr):Ue.indexOf("top")==0&&(vt="top",sr=Pe+.5*(wi-1)*kr),Ae.setTextBaseline(vt);const Ct=Q(B,"layout","text-justify",_,p,x);Ae.setJustify(Ct==="auto"?void 0:Ct),Ae.setOffsetX(st[0]*kr+Ht+ct[0]),Ae.setOffsetY(st[1]*kr+sr+ct[1]),v.setColor(jr(Q(B,"paint","text-color",_,p,x),Ne)),Ae.setFill(v);const Ke=jr(Q(B,"paint","text-halo-color",_,p,x),Ne);if(Ke&&Pe>0){E.setColor(Ke),Pe*=2;const Je=.5*kr;E.setWidth(Pe<=Je?Pe:Je),Ae.setStroke(E)}else Ae.setStroke(void 0);const gt=Q(B,"layout","text-padding",_,p,x),Bt=Ae.getPadding();gt!==Bt[0]&&(Bt[0]=gt,Bt[1]=gt,Bt[2]=gt,Bt[3]=gt),H.setZIndex(mt)}}}if(S>-1)return w.length=S+1,w};return r.setStyle(P),r.set("mapbox-layers",c),r.set("mapbox-source",b),r.set("mapbox-featurestate",r.get("mapbox-featurestate")||{}),P}function Vm(r){return function(e){const t=e.buffers,n=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const f=new Array(a);for(let p=0;p<a;++p)f[p]=new ImageData(new Uint8ClampedArray(t[p]),s,o);return r(f,n).data.buffer}const u=new Uint8ClampedArray(l),h=new Array(a),c=new Array(a);for(let f=0;f<a;++f)h[f]=new Uint8ClampedArray(t[f]),c[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let p=0;p<a;++p){const y=h[p];c[p][0]=y[f],c[p][1]=y[f+1],c[p][2]=y[f+2],c[p][3]=y[f+3]}const m=r(c,n);u[f]=m[0],u[f+1]=m[1],u[f+2]=m[2],u[f+3]=m[3]}return u.buffer}}function _R(r,e){const n=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+Vm.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",e),i}function bR(r,e){const t=Vm(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class xR extends Jf{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const n=new Array(t);if(t)for(let i=0;i<t;++i)n[i]=_R(e,this.onWorkerMessage_.bind(this,i));else n[0]=bR(e,this.onWorkerMessage_.bind(this,0));this.workers_=n,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,n){this.enqueue_({inputs:e,meta:t,callback:n}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,n=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,h=[];for(let c=0,f=i.length;c<f;++c)h.push(i[c].slice(u,u+a));this.workers_[l].postMessage({buffers:h,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},h)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let n,i;if(t===1)n=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,u=a*o;n.set(new Uint8ClampedArray(l),u),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(n,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const Lf={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Ff extends ad{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class Fc extends In{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=wR(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(Tt.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new _y(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:ft(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:ER(this.layers_),pixelRatio:1,pixelToCoordinateTransform:ft(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Te(this),renderTargets:{}},this.setAttributions(function(n){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],u=l instanceof Bo?l:l.getSource();if(!u)continue;const h=(s=u.getAttributions())==null?void 0:s(n);typeof h=="string"?i.push(h):h!==void 0&&i.push(...h)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new xR({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=yr(e);i.size[0]=Math.ceil(dt(e)/t),i.size[1]=Math.ceil(rr(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let n=0,i=this.layers_.length;n<i;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Vi(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=vR(this.layers_[s],e);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new Ff(Lf.BEFOREOPERATIONS,e,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,i){if(t||!n)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Vi(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(dt(s)/o),u=Math.round(rr(s)/o);a=en(l,u),this.renderedImageCanvas_=new Pu(s,o,1,a.canvas)}a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Ff(Lf.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,i=this.layers_.length;n<i&&(t=this.layers_[n].getSource().getResolutions(e),!t);++n);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Fc.prototype.dispose;let hn=null;function vR(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const n=e.size[0],i=e.size[1];if(n===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!hn)hn=en(n,i,void 0,{willReadFrequently:!0});else{const a=hn.canvas;a.width!==n||a.height!==i?hn=en(n,i,void 0,{willReadFrequently:!0}):hn.clearRect(0,0,n,i)}return hn.drawImage(o,0,0,n,i),hn.getImageData(0,0,n,i)}function ER(r){return r.map(function(e){return e.getLayerState()})}function wR(r){const e=r.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=TR(r[n]);return t}function TR(r){let e;return r instanceof Bo?r instanceof Jl?e=new no({source:r}):r instanceof In&&(e=new ru({source:r})):e=r,e}function SR(r,e){const t=r[0],n=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=n-1,u=i-1,h=[0,0,0,0],c=2*Math.PI,f=Math.PI/2,m=Math.PI*e.sunEl/180,p=Math.PI*e.sunAz/180,y=Math.cos(m),b=Math.sin(m),E=e.highlightColor,v=e.shadowColor,w=e.accentColor,P=e.encoding;let T,R,C,D,U,M,z,q,d,g,_,x,S,k,O,N,G,Y,Z,B,re,se;function oe(Fe,pe="mapbox"){if(pe==="mapbox")return(Fe[0]*256*256+Fe[1]*256+Fe[2])*.1-1e4;if(pe==="terrarium")return Fe[0]*256+Fe[1]+Fe[2]/256-32768}for(R=0;R<=u;++R)for(U=R===0?0:R-1,M=R===u?u:R+1,T=0;T<=l;++T)C=T===0?0:T-1,D=T===l?l:T+1,z=(R*n+C)*4,h[0]=s[z],h[1]=s[z+1],h[2]=s[z+2],h[3]=s[z+3],q=e.vert*oe(h,P),z=(R*n+D)*4,h[0]=s[z],h[1]=s[z+1],h[2]=s[z+2],h[3]=s[z+3],d=e.vert*oe(h,P),g=(d-q)/a,z=(U*n+T)*4,h[0]=s[z],h[1]=s[z+1],h[2]=s[z+2],h[3]=s[z+3],q=e.vert*oe(h,P),z=(M*n+T)*4,h[0]=s[z],h[1]=s[z+1],h[2]=s[z+2],h[3]=s[z+3],d=e.vert*oe(h,P),_=(d-q)/a,S=Math.atan2(_,-g),S<0?S=f-S:S>f?S=c-S+f:S=f-S,x=Math.atan(Math.sqrt(g*g+_*_)),se=b*Math.cos(x)+y*Math.sin(x)*Math.cos(p-S),k=Math.cos(x),O=255*se,Z=Math.min(Math.max(2*e.sunEl,0),1),B=1.875-e.opacity*1.75,re=e.opacity!==.5?f*((Math.pow(B,x)-1)/(Math.pow(B,f)-1)):x,G={r:(1-k)*w.r*Z*255,g:(1-k)*w.g*Z*255,b:(1-k)*w.b*Z*255,a:(1-k)*w.a*Z*255},N=Math.abs(((S+p)/Math.PI+.5)%2-1),Y={r:(E.r*(1-N)+v.r*N)*O,g:(E.g*(1-N)+v.g*N)*O,b:(E.b*(1-N)+v.b*N)*O,a:(E.a*(1-N)+v.a*N)*O},z=(R*n+T)*4,o[z]=G.r*(1-N)+Y.r,o[z+1]=G.g*(1-N)+Y.g,o[z+2]=G.b*(1-N)+Y.b,o[z+3]=s[z+3]*e.opacity*Z*Math.sin(re);return new ImageData(o,n,i)}function RR(r,e=512){return r.getExtent()?nn({extent:r.getExtent(),tileSize:e,maxZoom:22}).getResolutions():wr}function Xm(r,e){return e.accessToken||(e=Object.assign({},e),new URL(r).searchParams.forEach((n,i)=>{e.accessToken=n,e.accessTokenParam=i})),e}function AR(r,e,t="",n={},i=void 0){let s,o,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,n=a):l=t,typeof n=="string"?(s=n,a={}):(s=n.styleUrl,a=n),a.updateSource===!1&&(u=!1),i||(i=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:To(s,a.accessToken),a=Xm(s,a)),new Promise(function(h,c){Gm(e,a).then(function(f){if(f.version!=8)return c(new Error("glStyle version 8 required."));if(!(r instanceof ls||r instanceof Wn))return c(new Error("Can only apply to VectorLayer or VectorTileLayer"));const m=r instanceof Wn?"vector":"geojson";if(l?Array.isArray(l)?o=f.layers.find(function(P){return P.id===l[0]}).source:o=l:(o=f.layers.find(function(P){return P.source&&f.sources[P.source].type===m}).source,l=o),!o)return c(new Error(`No ${m} source found in the glStyle.`));function p(){if(!u)return Promise.resolve();if(r instanceof Wn)return Hm(f.sources[o],s,a).then(function(C){const D=r.getSource();D?C!==D&&(D.setTileUrlFunction(C.getTileUrlFunction()),typeof D.setUrls=="function"&&typeof C.getUrls=="function"&&D.setUrls(C.getUrls()),D.format_||(D.format_=C.format_),D.getAttributions()||D.setAttributions(C.getAttributions()),D.getTileLoadFunction()===vy&&D.setTileLoadFunction(C.getTileLoadFunction()),Ni(D.getProjection(),C.getProjection())&&(D.tileGrid=C.getTileGrid())):r.setSource(C);const U=r.getSource().getTileGrid();!isFinite(r.getMaxResolution())&&!isFinite(r.getMinZoom())&&U.getMinZoom()>0&&r.setMaxResolution(Oi(Math.max(0,U.getMinZoom()-1e-12),U.getResolutions()))});const P=f.sources[o];let T=r.getSource();(!T||T.get("mapbox-source")!==P)&&(T=Km(P,s,a));const R=r.getSource();return R?T!==R&&(R.getAttributions()||R.setAttributions(T.getAttributions()),R.format_||(R.format_=T.getFormat()),R.url_=T.getUrl()):r.setSource(T),Promise.resolve()}let y,b;const E={},v={};function w(){if(!b&&(!f.sprite||E)){if(a.projection&&!i){const C=xe(a.projection).getUnits();C!=="m"&&(i=wr.map(D=>D/al[C]))}let P;const T=r.getSource();T instanceof hi&&T.format_ instanceof tu&&(P=T.format_.layerName_),b=yR(r,f,l,i,E,v,(R,C=a.webfonts)=>cR(R,C),a.getImage,P),r.getStyle()?p().then(h).catch(c):c(new Error(`Nothing to show for source [${o}]`))}else b?(r.setStyle(b),p().then(h).catch(c)):c(new Error("Something went wrong trying to apply style."))}if(f.sprite){const P=rR(f.sprite,a.accessToken,s||location.href);y=window.devicePixelRatio>=1.5?.5:1;const T=y==.5?"@2x":"";Promise.all(P.map(function(R){const C=new URL(R.url);let D=C.origin+C.pathname+T+".json"+C.search;return new Promise(function(U,M){oi("Sprite",D,a).then(U).catch(function(z){D=C.origin+C.pathname+".json"+C.search,oi("Sprite",D,a).then(U).catch(M)})}).then(function(U){U===void 0&&c(new Error("No sprites found."));let M;if(M=C.origin+C.pathname+T+".png"+C.search,a.transformRequest){const z=a.transformRequest(M,"SpriteImage")||M;(z instanceof Request||z instanceof Promise)&&(M=z)}v[R.id]=M;for(const z in U){const q=R.id=="default"?z:`${R.id}:${z}`;E[q]=U[z]}}).catch(function(U){c(new Error(`Sprites cannot be loaded: ${D}: ${U.message}`))})})).then(w).catch(c)}else w()}).catch(c)})}function qm(r,e){let t;return r.some(function(n){if(n.id==e)return t=n.source,!0}),t}function PR(r,e){const t=r.bounds;if(t){const n=ll([t[0],t[1]],e),i=ll([t[2],t[3]],e);return[n[0],n[1],i[0],i[1]]}return xe(e).getExtent()}function Wm(r,e,t){const n=new Ko({tileJSON:e,tileSize:r.tileSize||e.tileSize||512}),i=n.getTileJSON(),s=n.getTileGrid(),o=xe(t.projection||"EPSG:3857"),a=PR(i,o),l=o.getExtent(),u=i.minzoom||0,h=i.maxzoom||22,c={attributions:n.getAttributions(),projection:o,tileGrid:new hs({origin:l?to(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:RR(o,e.tileSize).slice(0,h+1),tileSize:s.getTileSize(0)})};return Array.isArray(i.tiles)?c.urls=i.tiles:c.url=i.tiles,c}function IR(r,e,t,n){const i={id:r.id,type:r.type},s=r.layout||{},o=r.paint||{};i.paint=o,zt.zoom=Lc(e,t.resolutions||wr),zt.distanceFromCenter=0;let a;const l=Q(i,"paint","background-color",Jt,n);return o["background-opacity"]!==void 0&&(a=Q(i,"paint","background-opacity",Jt,n)),s.visibility=="none"?void 0:jr(l,a)}function CR(r,e,t){const n=document.createElement("div");return n.className="ol-mapbox-style-background",n.style.position="absolute",n.style.width="100%",n.style.height="100%",new zo({source:new Bo({}),render(i){const s=IR(r,i.viewState.resolution,e,t);return n.style.backgroundColor=s,n}})}function Hm(r,e,t){return new Promise(function(n,i){$m(r,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=Wm(r,s,t);a.tileLoadFunction=o,a.format=new tu({layerName:"mvt:layer"});const l=new hi(a);l.set("mapbox-source",r),n(l)}).catch(i)})}function LR(r,e,t){const n=new Wn({declutter:!0,visible:!1});return Hm(r,e,t).then(function(i){n.setSource(i)}).catch(function(i){n.setSource(void 0)}),n}function Zm(r){return`{bbox-${(r?r.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function FR(r,e,t){return new Promise(function(n,i){$m(r,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new Ko({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=Wm(r,s,t).tileGrid,t.projection&&(a.projection=xe(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(u,h,c){const f=Zm(c);let m=l(u,h,c);if(m.indexOf(f)!=-1){const p=a.getTileGrid().getTileCoordExtent(u);m=m.replace(f,p.toString())}return m}),a.set("mapbox-source",r),n(a)}).catch(function(s){i(s)})})}function Ym(r,e,t){const n=new no;return FR(r,e,t).then(function(i){n.setSource(i)}).catch(function(){n.setSource(void 0)}),n}function MR(r,e,t){const n=Ym(r,e,t);return new ru({source:new Fc({operationType:"image",operation:SR,sources:[n]})})}function Km(r,e,t){const n=t.projection?new io({dataProjection:t.projection}):new io,i=r.data,s={};if(typeof i=="string"){const[a]=qs(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(c,f,m)=>{const p=Zm(m);return a.replace(p,`${c.join(",")}`)},h=new Kr({attributions:r.attribution,format:n,loader:(c,f,m,p,y)=>{const b=typeof u=="function"?u(c,f,m):u;oi("GeoJSON",b,t).then(E=>{const v=h.getFormat().readFeatures(E,{featureProjection:m});h.addFeatures(v),p(v)}).catch(E=>{h.removeLoadedExtent(c),y()})},strategy:fd});return h.set("mapbox-source",r),h}const l=new Kr({attributions:r.attribution,format:n,url:a,loader:(u,h,c,f,m)=>{oi("GeoJSON",a,t).then(p=>{const y=l.getFormat().readFeatures(p,{featureProjection:c});l.addFeatures(y),f(y)}).catch(p=>{l.removeLoadedExtent(u),m()})}});return l}s.features=n.readFeatures(i,{featureProjection:"EPSG:3857"});const o=new Kr(Object.assign({attributions:r.attribution,format:n},s));return o.set("mapbox-source",r),o}function OR(r,e,t){return new ls({declutter:!0,source:Km(r,e,t),visible:!1})}function NR(r,e,t){let n=null;return function(i){r.paint&&"raster-opacity"in r.paint&&i.frameState.viewState.zoom!==n&&(n=i.frameState.viewState.zoom,delete t[r.id],DR(r,e,n,t))}}function DR(r,e,t,n){zt.zoom=t,zt.distanceFromCenter=0;const i=Q(r,"paint","raster-opacity",Jt,n);e.setOpacity(i)}function UR(r,e){function t(){const n=e.get("mapbox-style");if(!n)return;const i=mm(n.layers),s=r.get("mapbox-layers"),o=i.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});r.get("visible")!==o&&r.setVisible(o)}r.on("change",t),t()}function kR(r,e,t,n){const i=Bm(r),s=r.layers,o=t.type,a=t.source||qm(s,t.ref),l=r.sources[a];let u;if(o=="background")u=CR(t,n,i);else if(l.type=="vector")u=LR(l,e,n);else if(l.type=="raster")u=Ym(l,e,n),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",NR(t,u,i));else if(l.type=="geojson")u=OR(l,e,n);else if(l.type=="raster-dem"&&t.type=="hillshade"){const c=MR(l,e,n);u=c,c.getSource().on("beforeoperations",function(f){const m=f.data;m.resolution=xy(n.projection||"EPSG:3857",f.resolution,yr(f.extent),"m"),zt.zoom=Lc(f.resolution,n.resolutions||wr),zt.distanceFromCenter=0,m.encoding=l.encoding,m.vert=5*Q(t,"paint","hillshade-exaggeration",Jt,i),m.sunAz=Q(t,"paint","hillshade-illumination-direction",Jt,i),m.sunEl=35,m.opacity=.3,m.highlightColor=Q(t,"paint","hillshade-highlight-color",Jt,i),m.shadowColor=Q(t,"paint","hillshade-shadow-color",Jt,i),m.accentColor=Q(t,"paint","hillshade-accent-color",Jt,i)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const h=a;return u&&u.set("mapbox-source",h),u}function Mf(r,e,t,n){const i=[];let s=null;if(e instanceof nu){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const c=n.projection?xe(n.projection):s.getProjection();s=new by(Object.assign(s.getProperties(),{maxResolution:wr[0]/al[c.getUnits()],projection:n.projection||s.getProjection()})),e.setView(s)}"center"in r&&!s.getCenter()&&s.setCenter(ll(r.center,s.getProjection())),"zoom"in r&&s.getZoom()===void 0&&s.setResolution(wr[0]/al[s.getProjection().getUnits()]/Math.pow(2,r.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",r),e.set("mapbox-metadata",{styleUrl:t,options:n});const o=r.layers;let a=[],l,u,h;for(let c=0,f=o.length;c<f;++c){const m=o[c],p=m.type;if(p=="heatmap"){console.debug(`layers[${c}].type "${p}" not supported`);continue}else h=m.source||qm(o,m.ref),(!h||h!=u)&&(a.length&&(i.push(Of(l,a,r,t,e,n)),a=[]),l=kR(r,t,m,n),l instanceof ls||l instanceof Wn||(a=[]),u=l.get("mapbox-source")),a.push(m.id)}return i.push(Of(l,a,r,t,e,n)),Promise.all(i)}function zR(r,e,t={}){let n,i;if(typeof r=="string"||r instanceof HTMLElement?i=new nu({target:r}):i=r,typeof e=="string"){const s=e.startsWith("data:")?location.href:To(e,t.accessToken);t=Xm(s,t),n=new Promise(function(o,a){Gm(e,t).then(function(l){Mf(l,i,s,t).then(function(){o(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else n=new Promise(function(s,o){Mf(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:To(t.styleUrl,t.accessToken),t).then(function(){s(i)}).catch(o)});return n}function Of(r,e,t,n,i,s={}){let o=24,a=0;const l=t.layers;for(let u=0,h=l.length;u<h;++u){const c=l[u];e.indexOf(c.id)!==-1&&(o=Math.min("minzoom"in c?c.minzoom:0,o),a=Math.max("maxzoom"in c?c.maxzoom:24,a))}return new Promise(function(u,h){const c=function(){const m=r.getSource();if(!m||m.getState()==="error"){h(new Error("Error accessing data for source "+r.get("mapbox-source")));return}if("getTileGrid"in m){const p=m.getTileGrid();if(p){const y=p.getMinZoom();(o>0||y>0)&&r.setMaxResolution(Math.min(Oi(Math.max(0,o-1e-12),wr),Oi(Math.max(0,y-1e-12),p.getResolutions()))),a<24&&r.setMinResolution(Oi(a,wr))}}else o>0&&r.setMaxResolution(Oi(Math.max(0,o-1e-12),wr));m instanceof Kr||m instanceof hi?AR(r,t,e,Object.assign({styleUrl:n},s)).then(function(){UR(r,i),u()}).catch(h):u()};r.set("mapbox-layers",e);const f=i.getLayers();f.getArray().indexOf(r)===-1&&f.push(r),r.getSource()?c():r.once("change:source",c)})}class BR extends cd{constructor(e={}){const{mapboxStyle:t,applyOptions:n,...i}=e;super(i),t&&this.applyMapboxStyle(t,n)}applyMapboxStyle(e,t){return zR(this,e,t)}}Ey(wy);window.eoxMapAdvancedOlLayers={Graticule:Fx,Heatmap:Av,Layer:zo,VectorImage:Cv,WebGLPoints:Fv,WebGLTile:po,WebGLVector:Mv,STAC:oc,MapboxStyle:BR};function GR(r){const e=r[0],t=new Array(e);let n=1<<e-1,i,s;for(i=0;i<e;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),t[i]=String.fromCharCode(s),n>>=1;return t.join("")}const $R='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class jR extends Ur{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:xe("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],n=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=Pn(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=nn({extent:s,minZoom:t.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const u=this.culture_,h=this.hidpi_,c=this.placeholderTiles_;if(this.tileUrlFunction=iu(t.imageUrlSubdomains.map(function(f){const m=[0,0,0],p=t.imageUrl.replace("{subdomain}",f).replace("{culture}",u);return function(y,b,E){if(!y)return;sl(y[0],y[1],y[2],m);const v=new URL(p.replace("{quadkey}",GR(m))),w=v.searchParams;return h&&(w.set("dpi","d1"),w.set("device","mobile")),c===!0?w.delete("n"):c===!1&&w.set("n","z"),v.toString()}})),t.imageryProviders){const f=eu(xe("EPSG:4326"),this.getProjection());this.setAttributions(m=>{const p=[],y=m.viewState,b=this.getTileGrid(),E=b.getZForResolution(y.resolution,this.zDirection),w=b.getTileCoordForCoordAndZ(y.center,E)[0];return t.imageryProviders.map(function(P){let T=!1;const R=P.coverageAreas;for(let C=0,D=R.length;C<D;++C){const U=R[C];if(w>=U.zoomMin&&w<=U.zoomMax){const M=U.bbox,z=[M[1],M[0],M[3],M[2]],q=Qn(z,f);if(Jn(q,m.extent)){T=!0;break}}}T&&p.push(P.attribution)}),p.push($R),p})}this.setState("ready")}}class VR extends ro{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,e)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",t),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const XR="https://tile.googleapis.com/v1/createSession",qR="https://tile.googleapis.com/v1/2dtiles",WR="https://tile.googleapis.com/tile/v1/viewport",HR=22;class ZR extends Ur{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const n={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(n.imageFormat=e.imageFormat),e.scale&&(n.scale=e.scale),t&&(n.highDpi=!0),e.layerTypes&&(n.layerTypes=e.layerTypes),e.styles&&(n.styles=e.styles),e.overlay===!0&&(n.overlay=!0),e.apiOptions&&(n.apiOptions=e.apiOptions),this.sessionTokenRequest_=n,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=XR+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(e,t);if(!n.ok){try{const c=await n.json();this.error_=new Error(c.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=nn({extent:Pn(this.getProjection()),maxZoom:HR,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(c,f,m){const p=c[0],y=c[1],b=c[2];return`${qR}/${p}/${y}/${b}?session=${a}&key=${l}`};const u=parseInt(i.expiry,10)*1e3,h=Math.max(u-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[tn.ANIMATING]||e.viewHints[tn.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,n]=qc(Ty(e.extent),e.viewState.projection),[i,s]=qc(Sy(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${n}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const u=this.sessionTokenValue_,h=this.apiKey_,c=`${WR}?session=${u}&key=${h}&${l}`;return this.previousViewportAttribution_=await fetch(c).then(f=>f.json()).then(f=>f.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let Jm=class extends Hl{constructor(e,t,n,i,s,o,a){super(t,n,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==ue.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=en(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};class YR extends Ur{constructor(e){const t=e.size,n=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||ul;let u=l*i;switch(n){case"default":for(;s>u||o>u;)a.push([Math.ceil(s/u),Math.ceil(o/u)]),u+=u;break;case"truncated":let R=s,C=o;for(;R>u||C>u;)a.push([Math.ceil(R/u),Math.ceil(C/u)]),R>>=1,C>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const h=[i],c=[0];for(let R=1,C=a.length;R<C;R++)h.push(i<<R),c.push(a[R-1][0]*a[R-1][1]+c[R-1]);h.reverse();const f=new hs({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:h});let m=e.url;m&&!m.includes("{TileGroup}")&&!m.includes("{tileIndex}")&&(m+="{TileGroup}/{z}-{x}-{y}.jpg");const p=dd(m);let y=l*i;function b(R){return function(C,D,U){if(!C)return;const M=C[0],z=C[1],q=C[2],d=z+q*a[M][0],g=(d+c[M])/y|0,_={z:M,x:z,y:q,tileIndex:d,TileGroup:"TileGroup"+g};return R.replace(/\{(\w+?)\}/g,function(x,S){return _[S]})}}const E=iu(p.map(b)),v=Jm.bind(null,tr(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:v,tileGrid:f,tileUrlFunction:E,transition:e.transition}),this.zDirection=e.zDirection;const w=f.getTileCoordForCoordAndResolution(yr(f.getExtent()),h[h.length-1]),P=E(w,1,null),T=new Image;T.addEventListener("error",()=>{y=l,this.changed()}),T.src=P}}function Ai(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class KR extends Ur{constructor(e){const t=e||{};let n=t.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=t.version||tt.VERSION2,s=t.sizes||[],o=t.size;Wt(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],u=t.tileSize,h=t.tilePixelRatio||1,c=t.format||"jpg",f=t.quality||(t.version==tt.VERSION1?"native":"default");let m=t.resolutions||[];const p=t.supports||[],y=t.extent||[0,-l,a,0],b=s!=null&&Array.isArray(s)&&s.length>0,E=u!==void 0&&(typeof u=="number"&&Number.isInteger(u)&&u>0||Array.isArray(u)&&u.length>0),v=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let w,P,T;if(m.sort(function(U,M){return M-U}),E||v)if(u!=null&&(typeof u=="number"&&Number.isInteger(u)&&u>0?(w=u,P=u):Array.isArray(u)&&u.length>0&&((u.length==1||u[1]==null&&Number.isInteger(u[0]))&&(w=u[0],P=u[0]),u.length==2&&(Number.isInteger(u[0])&&Number.isInteger(u[1])?(w=u[0],P=u[1]):u[0]==null&&Number.isInteger(u[1])&&(w=u[1],P=u[1])))),(w===void 0||P===void 0)&&(w=ul,P=ul),m.length==0){T=Math.max(Math.ceil(Math.log(a/w)/Math.LN2),Math.ceil(Math.log(l/P)/Math.LN2));for(let U=T;U>=0;U--)m.push(Math.pow(2,U))}else{const U=Math.max(...m);T=Math.round(Math.log(U)/Math.LN2)}else if(w=a,P=l,m=[],b){s.sort(function(M,z){return M[0]-z[0]}),T=-1;const U=[];for(let M=0;M<s.length;M++){const z=a/s[M][0];if(m.length>0&&m[m.length-1]==z){U.push(M);continue}m.push(z),T++}if(U.length>0)for(let M=0;M<U.length;M++)s.splice(U[M]-M,1)}else m.push(1),s.push([a,l]),T=0;const R=new hs({tileSize:[w,P],extent:y,origin:to(y),resolutions:m}),C=function(U,M,z){let q,d;const g=U[0];if(g>T)return;const _=U[1],x=U[2],S=m[g];if(!(_===void 0||x===void 0||S===void 0||_<0||Math.ceil(a/S/w)<=_||x<0||Math.ceil(l/S/P)<=x)){if(v||E){const k=_*w*S,O=x*P*S;let N=w*S,G=P*S,Y=w,Z=P;if(k+N>a&&(N=a-k),O+G>l&&(G=l-O),k+w*S>a&&(Y=Math.floor((a-k+S-1)/S)),O+P*S>l&&(Z=Math.floor((l-O+S-1)/S)),k==0&&N==a&&O==0&&G==l)q="full";else if(!v||p.includes("regionByPx"))q=k+","+O+","+N+","+G;else if(p.includes("regionByPct")){const B=Ai(k/a*100),re=Ai(O/l*100),se=Ai(N/a*100),oe=Ai(G/l*100);q="pct:"+B+","+re+","+se+","+oe}i==tt.VERSION3&&(!v||p.includes("sizeByWh"))?d=Y+","+Z:!v||p.includes("sizeByW")?d=Y+",":p.includes("sizeByH")?d=","+Z:p.includes("sizeByWh")?d=Y+","+Z:p.includes("sizeByPct")&&(d="pct:"+Ai(100/S))}else if(q="full",b){const k=s[g][0],O=s[g][1];i==tt.VERSION3?k==a&&O==l?d="max":d=k+","+O:k==a?d="full":d=k+","}else d=i==tt.VERSION3?"max":"full";return n+q+"/"+d+"/0/"+f+"."+c}},D=Jm.bind(null,tr(u||256).map(function(U){return U*h}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:D,tileGrid:R,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:C,transition:t.transition}),this.zDirection=t.zDirection}}function Qm(r,e,t,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/n,l=[Wc(dt(e)/a,Hc),Wc(rr(e)/a,Hc)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const u=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return so(u,s)}function JR(r){const e=r.load?r.load:ci,t=xe(r.projection||"EPSG:3857"),n=r.ratio??1.5,i=r.crossOrigin??null;return function(s,o,a){a=r.hidpi?a:1;const l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,r.params),s=pd(s,o,a,n);const u=Qm(r.url,s,o,a,t,l),h=new Image;return h.crossOrigin=i,e(h,u).then(c=>{const f=dt(s)/c.width*a;return{image:c,extent:s,resolution:f,pixelRatio:a}})}}class QR extends In{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Ql,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=JR({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),ci(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class eA extends In{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,n,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==n&&Ws(s.getExtent(),e))return s;e=e.slice(),od(e,this.ratio_);const o=dt(e)/t,a=rr(e)/t,l=[o*n,a*n],u=this.canvasFunction_.call(this,e,t,n,l,i);return u&&(s=new Pu(e,t,n,u)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function tA(r,e,t,n){const i=dt(r),s=rr(r),o=e[0],a=e[1],l=.0254/n;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function rA(r,e,t,n,i,s,o){const a=tA(t,n,s,o),l=yr(t),u={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(u,e),so(r,u)}function nA(r){const e=r.load||ci,t=r.useOverlay??!1,n=r.metersPerUnit||1,i=r.displayDpi||96,s=r.ratio??1,o=r.crossOrigin??null;return function(a,l,u){const h=new Image;h.crossOrigin=o,a=pd(a,l,u,s);const c=dt(a)/l,f=rr(a)/l,m=[c*u,f*u],p=rA(r.url,r.params,a,m,t,n,i);return e(h,p).then(y=>({image:y,extent:a,pixelRatio:u}))}}class iA extends In{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Ql,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=nA({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),ci(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}const sA=new Error("Image failed to load");function eg(r,e,t,n,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(sA)),a.src=md(r,e,t,n,i.maxY)})}function Nf(r){return function(e,t,n,i){const s=Ry(r,e,t,n);return eg(s,e,t,n,i)}}function oA(r){return function(e,t,n,i){const s=r(e,t,n,i);return eg(s,e,t,n,i)}}function Df(r){let e;if(Array.isArray(r))e=Nf(r);else if(typeof r=="string"){const t=dd(r);e=Nf(t)}else if(typeof r=="function")e=oA(r);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let Uf=0;function kf(r){return Array.isArray(r)?r.join(`
`):typeof r=="string"?r:(++Uf,"url-function-key-"+Uf)}class tg extends xs{constructor(e){e=e||{};let t=e.loader,n;e.url&&(t=Df(e.url),n=kf(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:n,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=Df(e);this.setLoader(t),this.setKey(kf(e)),this.getState()!=="ready"&&this.setState("ready")}}const aA={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},lA={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function rg(r,e){if(!e.length)return r;const t=new URL(r,"file:/");if(t.pathname.split("/").includes("collections"))return Hi('The "collections" query parameter cannot be added to collection endpoints'),r;const n=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",n);const i=r.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function uA(r,e,t){let n,i;for(let s=0;s<r.length;++s){const o=r[s];if(o.rel==="item"){if(o.type===e){n=o.href;break}(aA[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return t&&(n=rg(n,t)),n}function cA(r,e,t,n){let i,s;const o={};for(let a=0;a<r.length;++a){const l=r[a];if(o[l.type]=l.href,l.rel==="item"){if(l.type===e){i=l.href;break}lA[l.type]&&(s=l.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const l=t[a];if(o[l]){i=o[l];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return n&&(i=rg(i,n)),i}function zf(r,e,t,n){let i=r.projection;if(!i&&(typeof e.crs=="string"?i=xe(e.crs):"uri"in e.crs&&(i=xe(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(R=>R.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),l=e.tileMatrices,u={};for(let R=0;R<l.length;++R){const C=l[R];u[C.id]=C}const h={},c=[];if(n)for(let R=0;R<n.length;++R){const C=n[R],D=C.tileMatrix;c.push(D),h[D]=C}else for(let R=0;R<l.length;++R){const C=l[R].id;c.push(C)}const f=c.length,m=new Array(f),p=new Array(f),y=new Array(f),b=new Array(f),E=[-1/0,-1/0,1/0,1/0];for(let R=0;R<f;++R){const C=c[R],D=u[C],U=D.pointOfOrigin;a?m[R]=[U[1],U[0]]:m[R]=U,p[R]=D.cellSize,y[R]=[D.matrixWidth,D.matrixHeight],b[R]=[D.tileWidth,D.tileHeight];const M=h[C];if(M){const z=D.cellSize*D.tileWidth,q=m[R][0]+M.minTileCol*z,d=m[R][0]+(M.maxTileCol+1)*z,g=D.cellSize*D.tileHeight,_=D.cornerOfOrigin==="bottomLeft";let x,S;_?(x=m[R][1]+M.minTileRow*g,S=m[R][1]+(M.maxTileRow+1)*g):(x=m[R][1]-(M.maxTileRow+1)*g,S=m[R][1]-M.minTileRow*g),gr(E,[q,x,d,S],E)}}const v=new hs({origins:m,resolutions:p,sizes:y,tileSizes:b,extent:n?E:void 0}),w=r.context,P=r.url;function T(R,C,D){if(!R)return;const U=c[R[0]],M=u[U],z=M.cornerOfOrigin==="bottomLeft",q={tileMatrix:U,tileCol:R[1],tileRow:z?-R[2]-1:R[2]};if(n){const g=h[M.id];if(q.tileCol<g.minTileCol||q.tileCol>g.maxTileCol||q.tileRow<g.minTileRow||q.tileRow>g.maxTileRow)return}Object.assign(q,w);const d=t.replace(/\{(\w+?)\}/g,function(g,_){return q[_]});return qp(P,d)}return{grid:v,projection:i,urlTemplate:t,urlFunction:T}}function hA(r,e){const t=e.tileMatrixSetLimits;let n;if(e.dataType==="map")n=uA(e.links,r.mediaType,r.collections);else if(e.dataType==="vector")n=cA(e.links,r.mediaType,r.supportedMediaTypes,r.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return zf(r,e.tileMatrixSet,n,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=qp(r.url,s);return Xp(o).then(function(a){return zf(r,a,n,t)})}function ng(r){return Xp(r.url).then(function(e){return hA(r,e)})}class fA extends Ur{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};ng(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Hi(e),this.setState("error")}}class dA extends hi{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};ng(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Hi(e),this.setState("error")}}const pA='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',mA='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',gA='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',yA={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},_A={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class bA extends ro{constructor(e){const t=e.layer.indexOf("-"),n=t==-1?e.layer:e.layer.slice(0,t),i=_A[n]||{minZoom:0,maxZoom:20,retina:!0},s=yA[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,u=[pA,mA,Ay];e.layer.startsWith("stamen_")&&u.splice(1,0,gA),super({attributions:u,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class xA extends Ur{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=cs(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const n in this.params_)t[e++]=n+"-"+this.params_[n];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,n,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const u=Py(Iy(e),a.length);l=a[u]}return Qm(l,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}setParams(e){this.params_=Object.assign({},e),this.setKey(this.getKeyForParams_())}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=tr(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=Cy(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,n,a)}}class vA extends tg{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",n=e.source,i=e.color||"grey";super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:n!==void 0?n.getWrapX():void 0});const s=()=>{var a;this.projection=e.projection!==void 0?xe(e.projection):n!==void 0?n.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:n!==void 0?n.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:n!==void 0?n.zDirection:this.zDirection,n instanceof xs&&(this.transformMatrix=((a=n.transformMatrix)==null?void 0:a.slice())||null);const o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((l,u)=>tr(o.getTileSize(u)).map(h=>Math.max(Math.floor(h),1)))),this.setLoader((l,u,h,c)=>{const f=md(t,l,u,h,c.maxY),[m,p]=this.getTileSize(l),y=en(m,p);return y.strokeStyle=i,y.strokeRect(.5,.5,m+.5,p+.5),y.fillStyle=i,y.strokeStyle="white",y.textAlign="center",y.textBaseline="middle",y.font="24px sans-serif",y.lineWidth=4,y.strokeText(f,m/2,p/2,m),y.fillText(f,m/2,p/2,m),Promise.resolve(y.canvas)}),this.setState("ready")};if(n===void 0||n.getState()==="ready")s();else{const o=()=>{n.getState()==="ready"&&(n.removeEventListener(Tt.CHANGE,o),s())};n.addEventListener(Tt.CHANGE,o)}}}class EA extends My{constructor(e,t,n,i,s,o){super(e,t),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,n){this.state==ue.EMPTY&&n===!0?(this.state=ue.IDLE,Oy(this,Tt.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):n===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=ue.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=ue.LOADED,this.changed()}loadInternal_(){if(this.state==ue.IDLE)if(this.state=ue.LOADING,this.jsonp_)Ku(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(ue.EMPTY)}}class wA extends Jl{constructor(e){if(super({projection:xe("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=Ly,this.template_=void 0,this.jsonp_=e.jsonp||!1,this.tileCache_=new Qf(512),e.url)if(this.jsonp_)Ku(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s),a=this.getTile(o[0],o[1],o[2],1,this.getProjection());a.getState()==ue.IDLE&&a.load(),a.forDataAtCoordinate(e,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=xe("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const h=eu(t,n);i=Qn(e.bounds,h)}const s=Pn(n),o=e.minzoom||0,a=e.maxzoom||22,l=nn({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const u=e.grids;if(!u){this.setState("error");return}if(this.tileUrlFunction_=ld(u,l),e.attribution){const h=i!==void 0?i:s;this.setAttributions(function(c){return Jn(h,c.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,n,i,s){const o=[e,t,n],a=this.getTileCoordForTileUrlFunction(o,s),l=this.tileUrlFunction_(a,i,s),u=`${this.getKey()},${Fy(e,t,n)}`;if(this.tileCache_.containsKey(u))return this.tileCache_.get(u);this.tileCache_.expireCache();const h=new EA(o,l!==void 0?ue.IDLE:ue.EMPTY,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache_.set(u,h),h}}class TA extends Kr{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const n=t.getGeometry();return Wt(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){var i;(i=this.source)==null||i.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Tt.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Tt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=cs(),t=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(Te(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Ny(u,e),Kl(e,t,e);const h=this.source.getFeaturesInExtent(e).filter(function(c){const f=Te(c);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(h,e))}}}}createCluster(e,t){const n=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Dy(n,l.getCoordinates()):e.splice(a,1)}Uy(n,1/e.length);const i=yr(t),s=this.interpolationRatio,o=new Xt([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new At({geometry:o,features:e})}}class Ro extends TA{constructor(e={}){super({...e,createCluster:Ro.defaultCreateCluster,geometryFunction:Ro.defaultGeometryFunction})}static defaultCreateCluster(e,t){const n=t.length===1&&t[0].getGeometry()instanceof wn?t[0].getGeometry():e,i=new At({geometry:n,features:t});if(t.length===1){const s=t[0];for(const o in s.getProperties())o!=="geometry"&&i.set(o,s.get(o))}return i}static defaultGeometryFunction(e){const t=e&&e.getGeometry();return t instanceof Xt?t:t instanceof wn?t.getInteriorPoint():null}}class SA extends Ur{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new _u().read(e),s=hd(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=iu(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?so(e,n):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in n?n[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t==="KVP"?l=so(l,a):l=l.replace(/\{(\w+?)\}/g,(u,h)=>a[h]),l}}}const Lr=new Uint8Array([102,103,98,3,102,103,98,0]),Ut=4,Pi=4,Ii=4,Rs=4,Vr=new Int32Array(2),Bf=new Float32Array(Vr.buffer),Gf=new Float64Array(Vr.buffer),Bs=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var zl;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(zl||(zl={}));class nr{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new nr(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Vr[0]=this.readInt32(e),Bf[0]}readFloat64(e){return Vr[Bs?0:1]=this.readInt32(e),Vr[Bs?1:0]=this.readInt32(e+4),Gf[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Bf[0]=t,this.writeInt32(e,Vr[0])}writeFloat64(e,t){Gf[0]=t,this.writeInt32(e,Vr[Bs?0:1]),this.writeInt32(e+4,Vr[Bs?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Pi+Ii)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Ii;t++)e+=String.fromCharCode(this.readInt8(this.position_+Pi+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=Pi;const i=this.bytes_.subarray(e,e+n);return t===zl.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Pi}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Ii)throw new Error("FlatBuffers: file identifier must be length "+Ii);for(let t=0;t<Ii;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Pi+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}var Ie,ht=((Ie={})[Ie.Byte=0]="Byte",Ie[Ie.UByte=1]="UByte",Ie[Ie.Bool=2]="Bool",Ie[Ie.Short=3]="Short",Ie[Ie.UShort=4]="UShort",Ie[Ie.Int=5]="Int",Ie[Ie.UInt=6]="UInt",Ie[Ie.Long=7]="Long",Ie[Ie.ULong=8]="ULong",Ie[Ie.Float=9]="Float",Ie[Ie.Double=10]="Double",Ie[Ie.String=11]="String",Ie[Ie.Json=12]="Json",Ie[Ie.DateTime=13]="DateTime",Ie[Ie.Binary=14]="Binary",Ie);class ot{constructor(){Ee(this,"bb",null);Ee(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new ot).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Rs),(t||new ot).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):ht.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,ht.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,o,a,l,u,h,c,f){return ot.startColumn(e),ot.addName(e,t),ot.addType(e,n),ot.addTitle(e,i),ot.addDescription(e,s),ot.addWidth(e,o),ot.addPrecision(e,a),ot.addScale(e,l),ot.addNullable(e,u),ot.addUnique(e,h),ot.addPrimaryKey(e,c),ot.addMetadata(e,f),ot.endColumn(e)}}var be,yt=((be={})[be.Unknown=0]="Unknown",be[be.Point=1]="Point",be[be.LineString=2]="LineString",be[be.Polygon=3]="Polygon",be[be.MultiPoint=4]="MultiPoint",be[be.MultiLineString=5]="MultiLineString",be[be.MultiPolygon=6]="MultiPolygon",be[be.GeometryCollection=7]="GeometryCollection",be[be.CircularString=8]="CircularString",be[be.CompoundCurve=9]="CompoundCurve",be[be.CurvePolygon=10]="CurvePolygon",be[be.MultiCurve=11]="MultiCurve",be[be.MultiSurface=12]="MultiSurface",be[be.Curve=13]="Curve",be[be.Surface=14]="Surface",be[be.PolyhedralSurface=15]="PolyhedralSurface",be[be.TIN=16]="TIN",be[be.Triangle=17]="Triangle",be);class Et{constructor(){Ee(this,"bb",null);Ee(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Et).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Rs),(t||new Et).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):yt.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Et).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,yt.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,o,a,l,u){return Et.startGeometry(e),Et.addEnds(e,t),Et.addXy(e,n),Et.addZ(e,i),Et.addM(e,s),Et.addT(e,o),Et.addTm(e,a),Et.addType(e,l),Et.addParts(e,u),Et.endGeometry(e)}}class Vt{constructor(){Ee(this,"bb",null);Ee(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Vt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Rs),(t||new Vt).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new Et).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new ot).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return Vt.startFeature(e),Vt.addGeometry(e,t),Vt.addProperties(e,n),Vt.addColumns(e,i),Vt.endFeature(e)}}function Ja(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let $f=new TextDecoder;function RA(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],u=l.name;switch(l.type){case ht.Bool:t[u]=!!i.getUint8(o),o+=1;break;case ht.Byte:t[u]=i.getInt8(o),o+=1;break;case ht.UByte:t[u]=i.getUint8(o),o+=1;break;case ht.Short:t[u]=i.getInt16(o,!0),o+=2;break;case ht.UShort:t[u]=i.getUint16(o,!0),o+=2;break;case ht.Int:t[u]=i.getInt32(o,!0),o+=4;break;case ht.UInt:t[u]=i.getUint32(o,!0),o+=4;break;case ht.Long:t[u]=Number(i.getBigInt64(o,!0)),o+=8;break;case ht.ULong:t[u]=Number(i.getBigUint64(o,!0)),o+=8;break;case ht.Float:t[u]=i.getFloat32(o,!0),o+=4;break;case ht.Double:t[u]=i.getFloat64(o,!0),o+=8;break;case ht.DateTime:case ht.String:{let h=i.getUint32(o,!0);o+=4,t[u]=$f.decode(n.subarray(o,o+h)),o+=h;break}case ht.Json:{let h=i.getUint32(o,!0);o+=4;let c=$f.decode(n.subarray(o,o+h));t[u]=JSON.parse(c),o+=h;break}case ht.Binary:{let h=i.getUint32(o,!0);o+=4,t[u]=n.subarray(o,o+h),o+=h;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const Mc=new Uint8Array(0);function AA(){return this._source.cancel()}function PA(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function IA(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=Mc,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:PA(e,t.value)}})}function CA(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=Mc,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function LA(r){return typeof r.slice=="function"?r:new ma(typeof r.read=="function"?r:r.getReader())}function ma(r){this._source=r,this._array=Mc,this._index=0}ma.prototype.read=IA;ma.prototype.slice=CA;ma.prototype.cancel=AA;class jt{constructor(){Ee(this,"bb",null);Ee(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new jt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Rs),(t||new jt).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,o,a){return jt.startCrs(e),jt.addOrg(e,t),jt.addCode(e,n),jt.addName(e,i),jt.addDescription(e,s),jt.addWkt(e,o),jt.addCodeString(e,a),jt.endCrs(e)}}class Ao{constructor(){Ee(this,"bb",null);Ee(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new Ao).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Rs),(t||new Ao).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):yt.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new ot).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new jt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,yt.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function ga(r){let e=Ao.getRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:n,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}const Fo=class Fo{constructor(){Ee(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};Ee(Fo,"global",new Fo);let Po=Fo;const FA=40,MA=16;function ya(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function OA(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=n,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*ig(r,e,t,n){class i{constructor(m,p){Ee(this,"_level");Ee(this,"nodes");this._level=p,this.nodes=m}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(m){this.nodes[1]=m}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,u=OA(r,e),h=u[0][0],c=[new i([0,1],u.length-1)];for(;c.length!==0;){let f=c.shift(),m=f.startNodeIdx(),p=m>=h,y=(()=>{let[,v]=u[f.level()],w=Math.min(f.endNodeIdx()+e,v);return p&&w<v?w+1:w})(),b=y-m,E=new DataView(await n(40*m,40*b));for(let v=m;v<y;v++){let w=v-m,P=40*w;if(a<E.getFloat64(P+0,!0)||l<E.getFloat64(P+8,!0)||s>E.getFloat64(P+16,!0)||o>E.getFloat64(P+24,!0))continue;let T=E.getBigUint64(P+32,!0);if(p){let U=(()=>{if(v<r-1){let z=(w+1)*40;return E.getBigUint64(z+32,!0)-T}return null})(),M=v-h;yield[Number(T),M,Number(U)];continue}let R=Po.global.extraRequestThreshold()/40,C=c[c.length-1];if(C!==void 0&&C.level()===f.level()-1&&T<C.endNodeIdx()+R){C.extendEndNodeIdx(Number(T));continue}let D=(()=>{let U=f.level()-1;return new i([Number(T),Number(T)+1],U)})();C!==void 0&&(C.level(),D.level()),c.push(D)}}}class Oc{constructor(e,t,n,i){Ee(this,"bytes");Ee(this,"header");Ee(this,"headerLength");Ee(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=n,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((o,a)=>Lr[a]===o))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(8,!0);if(t>10485760||t<8)throw Error("Invalid header size");let n=e.subarray(12,12+t),i=ga(new nr(n)),s=ya(i.featuresCount,i.indexNodeSize);return new Oc(e,i,t,s)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=async(i,s)=>{let o=t+i;return this.bytes.slice(o,o+s).buffer};for await(let i of ig(this.header.featuresCount,this.header.indexNodeSize,e,n)){let[s,o]=i,a=this.readFeature(s);yield{id:o,feature:a}}}lengthBeforeTree(){return Lr.length+Ut+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),n=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+n),s=new Uint8Array(n+Ut);s.set(i,Ut);let o=new nr(s);return o.setPosition(Ut),Vt.getRootAsFeature(o)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Bl=function(r,e){return Bl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Bl(r,e)};function NA(r,e){Bl(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ai(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(h){try{u(n.next(h))}catch(c){o(c)}}function l(h){try{u(n.throw(h))}catch(c){o(c)}}function u(h){h.done?s(h.value):i(h.value).then(a,l)}u((n=n.apply(r,[])).next())})}function rn(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function vi(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function os(r){return this instanceof os?(this.v=r,this):new os(r)}function DA(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(m){return new Promise(function(p,y){s.push([f,m,p,y])>1||a(f,m)})})}function a(f,m){try{l(n[f](m))}catch(p){c(s[0][3],p)}}function l(f){f.value instanceof os?Promise.resolve(f.value.v).then(u,h):c(s[0][2],f)}function u(f){a("next",f)}function h(f){a("throw",f)}function c(f,m){f(m),s.shift(),s.length&&a(s[0][0],s[0][1])}}var sg=function(r){NA(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();function Gl(r){r!=null&&typeof r.then=="function"&&r.then(Lo,Lo)}var Qa=0,jf=1,Rn=2,Io=3,$l=4,Co=1024,Lo=function(){};function Kn(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function pn(r,e){var t=r.state>=Io;return Promise.resolve(e).then(function(n){return!t&&r.state>=$l?Kn(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function Nc(r,e){var t,n;if(!(r.state>=Rn))if(r.state=Rn,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Gi(r);else try{for(var i=vi(r.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Gi(r){var e,t;if(!(r.state>=Io)){r.state<Rn&&Nc(r),r.state=Io,r.buffer=void 0;try{for(var n=vi(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,o=r.pending===void 0?Kn(r):r.pending.then(function(){return Kn(r)});s.resolve(pn(r,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function Vf(r){r.state>=$l||(r.state<Io&&Gi(r),r.state=$l)}function UA(r,e){if(Gl(e),r.pushes.length>=Co)throw new sg("No more than "+Co+" pending calls to push are allowed on a single repeater.");if(r.state>=Rn)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(l){r.state<Rn&&(r.err=l),Vf(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(pn(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(l){return r.onnext=l})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(l){return r.pushes.push({resolve:l,value:t})});var s=!0,o={},a=n.catch(function(l){if(s)throw l});return o.then=function(l,u){return s=!1,Promise.prototype.then.call(n,l,u)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(n,l)},o.finally=n.finally.bind(n),r.pending=t.then(function(){return a}).catch(function(l){r.err=l,Vf(r)}),o}function kA(r){var e=Nc.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function zA(r){if(!(r.state>=jf)){r.state=jf;var e=UA.bind(null,r),t=kA(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return Nc(r)})}}var Gs=new WeakMap,As=function(){function r(e,t){Gs.set(this,{executor:e,buffer:t,err:void 0,state:Qa,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Lo,onstop:Lo})}return r.prototype.next=function(e){Gl(e);var t=Gs.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=Co)throw new sg("No more than "+Co+" pending calls to next are allowed on a single repeater.");if(t.state<=Qa&&zA(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=pn(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,pn(t,s.value)}else if(t.state>=Rn)return Gi(t),pn(t,Kn(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},r.prototype.return=function(e){Gl(e);var t=Gs.get(this);if(t===void 0)throw new Error("WeakMap error");return Gi(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),pn(t,Kn(t))},r.prototype.throw=function(e){var t=Gs.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Qa||t.state>=Rn||typeof t.buffer<"u"&&!t.buffer.empty?(Gi(t),t.err==null&&(t.err=e),pn(t,Kn(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=BA,r.merge=GA,r.zip=$A,r.latest=jA,r}();function _a(r,e){var t,n,i=[],s=function(u){u!=null&&typeof u[Symbol.asyncIterator]=="function"?i.push(u[Symbol.asyncIterator]()):u!=null&&typeof u[Symbol.iterator]=="function"?i.push(u[Symbol.iterator]()):i.push(function(){return DA(this,arguments,function(){return rn(this,function(f){switch(f.label){case 0:return e.yieldValues?[4,os(u)]:[3,3];case 1:return[4,f.sent()];case 2:f.sent(),f.label=3;case 3:return e.returnValues?[4,os(u)]:[3,5];case 4:return[2,f.sent()];case 5:return[2]}})})}())};try{for(var o=vi(r),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function BA(r){var e=this,t=_a(r,{returnValues:!0});return new As(function(n,i){return ai(e,void 0,void 0,function(){var s,o,a,l,u,h;return rn(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),c.label=1;case 1:c.trys.push([1,,5,7]),l=void 0,u=0,h=function(){var f,m,p,y,b,E;return rn(this,function(v){switch(v.label){case 0:f=u;try{for(m=(b=void 0,vi(t)),p=m.next();!p.done;p=m.next())y=p.value,Promise.resolve(y.next()).then(function(w){w.done?(i(),a===void 0&&(a=w)):u===f&&(u++,s(w))},function(w){return i(w)})}catch(w){b={error:w}}finally{try{p&&!p.done&&(E=m.return)&&E.call(m)}finally{if(b)throw b.error}}return[4,new Promise(function(w){return s=w})];case 1:return l=v.sent(),l===void 0?[3,3]:[4,n(l.value)];case 2:v.sent(),v.label=3;case 3:return[2]}})},c.label=2;case 2:return o?[3,4]:[5,h()];case 3:return c.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(f){return f.return&&f.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}function GA(r){var e=this,t=_a(r,{yieldValues:!0});return new As(function(n,i){return ai(e,void 0,void 0,function(){var s,o,a,l=this;return rn(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var h,c;o=!0;try{for(var f=vi(s),m=f.next();!m.done;m=f.next()){var p=m.value;p()}}catch(y){h={error:y}}finally{try{m&&!m.done&&(c=f.return)&&c.call(f)}finally{if(h)throw h.error}}}),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,Promise.all(t.map(function(h,c){return ai(l,void 0,void 0,function(){var f,m;return rn(this,function(p){switch(p.label){case 0:p.trys.push([0,,6,9]),p.label=1;case 1:return o?[3,5]:(Promise.resolve(h.next()).then(function(y){return s[c](y)},function(y){return i(y)}),[4,new Promise(function(y){s[c]=y})]);case 2:return f=p.sent(),f===void 0?[3,4]:f.done?(a=f,[2]):[4,n(f.value)];case 3:p.sent(),p.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return m=h.return,m?[4,h.return()]:[3,8];case 7:m=p.sent(),p.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return u.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function $A(r){var e=this,t=_a(r,{returnValues:!0});return new As(function(n,i){return ai(e,void 0,void 0,function(){var s,o,a,l;return rn(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),u.label=1;case 1:u.trys.push([1,,6,8]),u.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(h){return h.next()})).then(function(h){return s(h)},function(h){return i(h)}),[4,new Promise(function(h){return s=h})]);case 3:return a=u.sent(),a===void 0?[2]:(l=a.map(function(h){return h.value}),a.some(function(h){return h.done})?[2,l]:[4,n(l)]);case 4:return u.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(h){return h.return&&h.return()}))];case 7:return u.sent(),[7];case 8:return[2]}})})})}function jA(r){var e=this,t=_a(r,{yieldValues:!0,returnValues:!0});return new As(function(n,i){return ai(e,void 0,void 0,function(){var s,o,a,l,u,h=this;return rn(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var f,m;s();try{for(var p=vi(o),y=p.next();!y.done;y=p.next()){var b=y.value;b()}}catch(E){f={error:E}}finally{try{y&&!y.done&&(m=p.return)&&m.call(p)}finally{if(f)throw f.error}}a=!0}),c.label=1;case 1:return c.trys.push([1,,5,7]),Promise.all(t.map(function(f){return f.next()})).then(function(f){return s(f)},function(f){return i(f)}),[4,new Promise(function(f){return s=f})];case 2:return l=c.sent(),l===void 0?[2]:(u=l.map(function(f){return f.value}),l.every(function(f){return f.done})?[2,u]:[4,n(u.slice())]);case 3:return c.sent(),[4,Promise.all(t.map(function(f,m){return ai(h,void 0,void 0,function(){var p;return rn(this,function(y){switch(y.label){case 0:if(l[m].done)return[2,l[m].value];y.label=1;case 1:return a?[3,4]:(Promise.resolve(f.next()).then(function(b){return o[m](b)},function(b){return i(b)}),[4,new Promise(function(b){return o[m]=b})]);case 2:return p=y.sent(),p===void 0?[2,l[m].value]:p.done?[2,p.value]:(u[m]=p.value,[4,n(u.slice())]);case 3:return y.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,c.sent()];case 5:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}class Dc{constructor(e,t,n,i,s,o={}){Ee(this,"headerClient");Ee(this,"header");Ee(this,"headerLength");Ee(this,"indexLength");Ee(this,"nocache");Ee(this,"headers");this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s,this.headers=o}static async open(e,t,n={}){let i,s=new Xf(e,t,n),o=2024+(()=>{let h,c=0;for(h=0;h<3;h++)c+=MA**h*FA;return c})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((h,c)=>Lr[c]===h))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await s.getRange(12,i,o,"header"),l=ga(new nr(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let u=ya(l.featuresCount,l.indexNodeSize);return new Dc(s,l,i,u,t,n)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(l,u)=>n.getRange(t+l,u,0,"index"),s=[],o=[];for await(let l of ig(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[u,h]=l,[,,c]=l;if(c||(c=4),o.length===0){o.push([u,c,h]);continue}let f=o[o.length-1];u-(f[0]+f[1])>Po.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([u,c,h])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*As.merge(a)}lengthBeforeTree(){return Lr.length+Ut+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new Xf(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[n]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-n;for(let[l,,u]of e){let h=await this.readFeature(o,l,a);yield{id:u,feature:h},a=0}o.logUsage("feature")}async readFeature(e,t,n){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,n,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,n,"feature data")),a=new Uint8Array(i+Ut);a.set(o,Ut);let l=new nr(a);return l.setPosition(Ut),Vt.getRootAsFeature(l)}}class Xf{constructor(e,t,n={}){Ee(this,"httpClient");Ee(this,"bytesEverUsed",0);Ee(this,"bytesEverFetched",0);Ee(this,"buffer",new ArrayBuffer(0));Ee(this,"head",0);if(typeof e=="string")this.httpClient=new qf(e,t,n);else if(e instanceof qf)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,n);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class qf{constructor(e,t,n={}){Ee(this,"url");Ee(this,"nocache");Ee(this,"headers");Ee(this,"requestsEverMade",0);Ee(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=n}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}async function*VA(r,e,t,n){if(!r.subarray(0,3).every((c,f)=>Lr[f]===c))throw Error("Not a FlatGeobuf file");if(t){let c=Oc.open(r);for await(let f of c.selectBbox(t))yield e(f.id,f.feature,c.header);return}let i=new nr(r),s=i.readUint32(Lr.length);i.setPosition(Lr.length+Ut);let o=ga(i),a=Lr.length+Ut+s,{indexNodeSize:l,featuresCount:u}=o;l>0&&(a+=ya(u,l));let h=0;for(;a<i.capacity();){let c=i.readUint32(a);i.setPosition(a+Ut);let f=Vt.getRootAsFeature(i);yield e(h++,f,o),a+=Ut+c}}async function*XA(r,e,t){let n,i=LA(r),s=async m=>await i.slice(m),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((m,p)=>Lr[p]===m))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new nr(o),l=a.readUint32(0);o=new Uint8Array(await s(l));let u=ga(a=new nr(o)),{indexNodeSize:h,featuresCount:c}=u;if(h>0){let m=ya(c,h);await s(m)}let f=0;for(;n=await WA(s,u,e,f++);)yield n}async function*qA(r,e,t,n,i=!1,s={}){let o=await Dc.open(r,i,s);for await(let a of o.selectBbox(e))yield t(a.id,a.feature,o.header)}async function WA(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new nr(i),o=s.readUint32(0);i=new Uint8Array(await r(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new nr(a)).setPosition(Ut),t(n,Vt.getRootAsFeature(s),e)}function jl(r,e){let t=e;if(t===yt.Unknown&&(t=r.type()),t===yt.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let o=r.parts(s),a=o.type();i.push(jl(o,a))}return{type:yt[t],geometries:i}}if(t===yt.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(jl(r.parts(s),yt.Polygon));return{type:yt[t],coordinates:i.map(s=>s.coordinates)}}let n=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case yt.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case yt.MultiPoint:case yt.LineString:return Ja(o,a);case yt.MultiLineString:case yt.Polygon:return function(l,u,h){let c;if(!h||h.length===0)return[Ja(l,u)];let f=0,m=Array.from(h).map(p=>l.slice(f,f=p<<1));return u&&(f=0,c=Array.from(h).map(p=>u.slice(f,f=p))),m.map((p,y)=>Ja(p,c?c[y]:void 0))}(o,a,i.endsArray())}}(r,t);return{type:yt[t],coordinates:n}}function Uc(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:jl(e.geometry(),t.geometryType),properties:RA(e,n)}}async function*HA(r,e,t){yield*VA(r,Uc,e)}function ZA(r,e){return XA(r,Uc)}function YA(r,e,t,n=!1,i={}){return qA(r,e,Uc,t,n,i)}function KA(r,e,t,n=!1,i={}){return r instanceof Uint8Array?HA(r,e):r instanceof ReadableStream?ZA(r):YA(r,e,t,n,i)}const Wf=new io({featureProjection:"EPSG:3857"});class JA extends Kr{constructor(e){super({url:e.url,attributions:e.attributions,wrapX:e.wrapX,format:Wf,strategy:fd}),this.ressourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const n=ol(e,t.getCode(),"EPSG:4326");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}}async loader(e,t,n,i,s){const o=this.fgbBoundingBox(e,n);try{if(o.minX!==-1/0){const a=[],l=KA(this.ressourceURL,o);for await(const u of l){const h=Wf.readFeature(u);a.push(h)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={BingMaps:jR,CartoDB:VR,Cluster:Ro,DataTile:xs,GeoTIFF:Yu,Google:ZR,IIIF:KR,Image:In,ImageArcGISRest:QR,ImageCanvas:eA,ImageMapGuide:iA,ImageStatic:Vp,ImageTile:tg,OGCMapTile:fA,OGCVectorTile:dA,Raster:Fc,Source:Bo,StadiaMaps:bA,TileArcGISRest:xA,TileDebug:vA,TileImage:Ur,TileJSON:Ko,UrlTile:ky,UTFGrid:wA,Zoomify:YR,WMTSCapabilities:SA,FlatGeoBuf:JA};const gP=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{hP as L,fP as a,gP as i};
