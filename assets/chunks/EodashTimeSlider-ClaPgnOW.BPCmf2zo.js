import{u as b,i as M}from"./mosaic-ByH9wgDF.CapV14ci.js";import{_ as A,a as C,s as B,d as k,an as T,ba as p,o as c,f as L}from"./eo-dash.C1AFROO3.js";import"./main.BCWBqgOj.js";import"./main.Cy-zUl9H.js";import{c as V}from"./create-layers-config-BrGl0JJZ.DA-zhAiv.js";import{q as j,c as y,e as I,p as F,o as S,j as v,k as g,h as G}from"./framework.BisDmvbf.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./mdi.CdEehoCo.js";import"./addCommonStyleSheet.BNGCnIMO.js";import"./dayjs.min.Ba62AOpW.js";import"./when.BR7zwNJC.js";import"./map.DiiNQ3pp.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./getElement.CdRlZPdn.js";import"./index.BIJR-IiI.js";import"./index.BUIxO2d3.js";import"./static.CMAEWrCw.js";import"./repeat.Cj0PdIYK.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.D8iRSD1N.js";import"./unsafe-html.CKtBt7Dp.js";import"./orient2d.DArCjZZA.js";import"./index.2GfG_t-c.js";const N="eox-itemfilter[data-v-936c4bd1]{--inline-container-height: 40px}",P=[".for",".animate",".initDate"],q={class:"d-flex g-10 align-center"},z=[".filters"],K={__name:"EodashTimeSlider",props:{filters:{type:Array,default:()=>[]},animate:{type:Boolean,default:!0},useMosaic:{type:Boolean,default:!0},mosaicIndicators:{type:Array,default:()=>["sentinel-2-l2a"]}},setup(u){const n=u,s=C(),h=G(()=>!n.useMosaic||!s.mosaicEndpoint?!1:!n.mosaicIndicators||!n.mosaicIndicators.length?!0:n.mosaicIndicators.includes(c.value)),m=F(!1);j(c,async()=>{var e,t,a,r;if(await new Promise(i=>setTimeout(i,400)),h.value){m.value=!0,p.value+=1;return}const o=(t=(e=T.value)==null?void 0:e.layers)==null?void 0:t.find(i=>{var f;return((f=i.properties)==null?void 0:f.id)==="AnalysisGroup"});if(!o||!(o!=null&&o.layers.length)){m.value=!1;return}for(const i of o.layers)if((r=(a=i==null?void 0:i.properties)==null?void 0:a.timeControlValues)!=null&&r.length){m.value=!0;return}m.value=!1,p.value+=1},{immediate:!0}),s.mosaicEndpoint&&n.useMosaic&&b(s.mosaicEndpoint,void 0,s,n.mosaicIndicators);let l=[0,0],E="";const _=async o=>{const{date:e}=o.detail,[t,a]=e;if(!(t==l[0]&&a==l[1])){if(E!==c.value&&(setTimeout(()=>{console.log("[eodash] Triggering timeslider update"),p.value+=1},400),E=c.value),l=[t,a],!h.value){k.value=t.toISOString();return}M(s.mosaicEndpoint,{timeRange:[t.toISOString(),a.toISOString()],collection:c.value,cloudCover:d||void 0})}};let d=null;const O=o=>{var a,r;if(!h.value)return;const{filters:e}=o.detail,t=((r=(a=e.find(i=>i.key==="eo:cloud_cover"))==null?void 0:a.state)==null?void 0:r.max)||null;t===null||t===d||[0,100].includes(t)||(d=t,t===100&&(d=null),M(s.mosaicEndpoint,{timeRange:l==null?void 0:l.map(i=>new Date(i).toISOString()),collection:c.value,cloudCover:t}))},{selectedStac:R}=B(C()),D=async o=>{const{generate:e,selectedRangeItems:t}=o.detail,a=await Promise.all(Object.values(t).flatMap(async r=>{const i=[];for(const f of r)await V(R.value,L,f.originalDate).then(x=>{x=w(x),i.push({layers:x,date:f.originalDate})});return i})).then(r=>r.flat());e({mapLayers:a})};function w(o){return o.map(e=>e.type==="Group"?(e.layers=w(e.layers),e):(e.source&&(e.source.crossOrigin="anonymous"),e))}return(o,e)=>m.value?(S(),y("eox-timecontrol",{key:g(p),ref:"eoxTimecontrol",".for":g(T),onSelect:_,titleKey:"title",externalMapRendering:"",".animate":u.animate,".initDate":g(k)},[v("div",q,[e[0]||(e[0]=v("eox-timecontrol-date",{class:"flex-grow-1"},null,-1)),v("eox-timecontrol-picker",{".range":!1,".showDots":!0,".showItems":!0,".popup":!0},null,32),u.filters.length?(S(),y("eox-itemfilter",{key:0,onFilter:O,".inlineMode":!0,showResults:!1,".filters":g(u.filters)},null,40,z)):I("v-if",!0),u.animate?(S(),y("eox-timecontrol-timelapse",{key:1,onExport:D},null,32)):I("v-if",!0)]),e[1]||(e[1]=v("eox-timecontrol-timeline",{class:"mt-2"},null,-1))],40,P)):I("v-if",!0)}},ve=A(K,[["styles",[N]],["__scopeId","data-v-936c4bd1"]]);export{ve as default};
